<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>FreeBSD 使用手冊</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><meta name="description" content="歡迎使用 FreeBSD！ 本使用手冊涵蓋範圍包括了 FreeBSD 12.0-RELEASE 與 FreeBSD 11.3-RELEASE 的安裝與平日操作的說明。 這份使用手冊是很多人的集體創作，而且仍然『持續不斷』的進行中，因此部份章節可能尚未仍未完成，如果您有興趣協助本計畫的話，請寄電子郵件至 FreeBSD 文件專案郵遞論壇。 在 FreeBSD 網站 可以找到本手冊的最新版本，舊版文件可從 https://docs.FreeBSD.org/doc/ 取得。本文件也提供各種格式與不同壓縮方式的版本可自 FreeBSD FTP 伺服器 或是其中一個 鏡像網站 下載。 列印出來的實體書面資料可在 FreeBSD 商城 購買。 此外，您可在 搜尋頁面 中搜尋本文件或其他文件的資料。" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div xml:lang="zh_TW" class="book" lang="zh_TW"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp59116984"></a>FreeBSD 使用手冊</h1></div><div><div xmlns="http://www.w3.org/1999/xhtml" class="author"><h3 class="author"><span class="orgname">FreeBSD 文件計劃</span></h3></div></div><div>修訂: <a href="https://svnweb.freebsd.org/changeset/doc/52701"><span class="svnref">52701</span></a></div><div><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="copyright" lang="en">Copyright © 1995-2019 The FreeBSD Documentation Project</p></div><div><div xmlns="http://www.w3.org/1999/xhtml" class="legalnotice"><a id="legalnotice"></a><p class="legalnotice-title"><strong>版權</strong></p><p xml:lang="en" lang="en">Redistribution and use in source (XML DocBook) and 'compiled'
    forms (XML, HTML, PDF, PostScript, RTF and so forth) with or without
    modification, are permitted provided that the following conditions are
    met:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p xml:lang="en" lang="en">Redistributions of source code (XML DocBook) must retain the
        above copyright notice, this list of conditions and the following
        disclaimer as the first lines of this file unmodified.</p></li><li class="listitem"><p xml:lang="en" lang="en">Redistributions in compiled form (transformed to other DTDs,
        converted to PDF, PostScript, RTF and other formats) must
        reproduce the above copyright notice, this list of conditions and
        the following disclaimer in the documentation and/or other
        materials provided with the distribution.</p></li></ol></div><div xmlns="" class="important"><h3 class="admontitle">重要: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">THIS DOCUMENTATION IS PROVIDED BY THE FREEBSD DOCUMENTATION
      PROJECT "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
      BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
      FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL
      THE FREEBSD DOCUMENTATION PROJECT BE LIABLE FOR ANY DIRECT, INDIRECT,
      INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
      BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS
      OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
      ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
      TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
      USE OF THIS DOCUMENTATION, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
      DAMAGE.</p></div></div></div><div><div xmlns="http://www.w3.org/1999/xhtml" class="legalnotice"><a id="trademarks"></a><p>FreeBSD 是 FreeBSD 基金會的註冊商標。</p><p>3Com 和 HomeConnect 是 3Com Corporation 的註冊商標。</p><p>3ware 是 3ware Inc 的註冊商標。</p><p>ARM 是 ARM Limited. 的註冊商標。</p><p>Adaptec 是 Adaptec, Inc. 的註冊商標。</p><p>Adobe, Acrobat, Acrobat Reader, Flash 以及 PostScript 是 Adobe Systems Incorporated 在美國和/或其他國家的商標或註冊商標。</p><p>Apple, AirPort, FireWire, iMac, iPhone, iPad, Mac, Macintosh, Mac OS, Quicktime 以及 TrueType 是 Apple Inc. 在美國以及其他國家的註冊商標。</p><p>Android 是 Google Inc 的商標。</p><p>Heidelberg, Helvetica, Palatino 以及 Times Roman 是 Heidelberger Druckmaschinen AG 在美國以及其他國家的商標或註冊商標。</p><p>IBM, AIX, OS/2, PowerPC, PS/2, S/390 以及 ThinkPad 是 International Business Machines Corporation 在美國和其他國家的商標。</p><p>IEEE, POSIX 以及 802 是 Institute of Electrical and Electronics Engineers, Inc. 在美國的註冊商標。</p><p>Intel, Celeron, Centrino, Core, EtherExpress, i386, i486, Itanium, Pentium 以及 Xeon 是 Intel Corporation 及其分支機構在美國和其他國家的商標或註冊商標。</p><p>Intuit 和 Quicken 是 Intuit Inc., 或其子公司在美國和其他國家的商標或註冊商標。</p><p>Linux 是 Linus Torvalds 的註冊商標。</p><p>LSI Logic, AcceleRAID, eXtremeRAID, MegaRAID 以及 Mylex 是 LSI Logic Corp 的商標或註冊商標。</p><p>Microsoft, IntelliMouse, MS-DOS, Outlook, Windows, Windows Media 以及 Windows NT 是 Microsoft Corporation 在美國和/或其他國家的商標或註冊商標。</p><p>Motif, OSF/1 以及 UNIX 是 The Open Group 在美國和其他國家的註冊商標； IT DialTone 和 The Open Group 是其商標。</p><p>Oracle 是 Oracle Corporation 的註冊商標。</p><p>RealNetworks, RealPlayer, 和 RealAudio 是 RealNetworks, Inc. 的註冊商標。</p><p>Red Hat, RPM, 是 Red Hat, Inc. 在美國和其他國家的註冊商標。</p><p>Sun, Sun Microsystems, Java, Java Virtual Machine, JDK, JRE, JSP, JVM, Netra, OpenJDK, Solaris, StarOffice, SunOS 以及 VirtualBox 是 Sun Microsystems, Inc. 在美國和其他國家的商標或註冊商標。</p><p>MATLAB 是 The MathWorks, Inc. 的註冊商標。</p><p>SpeedTouch 是 Thomson 的商標。</p><p>VMware 是 VMware, Inc. 的商標。</p><p>Mathematica 是 Wolfram Research, Inc 的註冊商標。</p><p>XFree86 是 The XFree86 Project, Inc 的商標。</p><p>Ogg Vorbis 以及 Xiph.Org 是 Xiph.Org 的商標。</p><p>許多製造商和經銷商使用一些稱為商標的圖案或文字設計來區別自己的產品。 本文件中出現的眾多商標，以及 FreeBSD Project 本身廣所人知的商標，後面將以 <span class="quote">“<span class="quote">™</span>”</span> 或 <span class="quote">“<span class="quote">®</span>”</span> 符號來標示。</p></div></div><div>  2018-12-20 14:29:19 由 rcyu.</div><div><div xmlns="http://www.w3.org/1999/xhtml" class="abstract"><div class="abstract-title">摘要</div><p>歡迎使用 FreeBSD！ 本使用手冊涵蓋範圍包括了 <span class="emphasis"><em>FreeBSD 12.0-RELEASE</em></span> 與 <span class="emphasis"><em>FreeBSD 11.3-RELEASE</em></span> 的安裝與平日操作的說明。 這份使用手冊是很多人的集體創作，而且仍然『持續不斷』的進行中，因此部份章節可能尚未仍未完成，如果您有興趣協助本計畫的話，請寄電子郵件至 <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-doc" target="_top">FreeBSD 文件專案郵遞論壇</a>。</p><p>在 <a class="link" href="https://www.FreeBSD.org/" target="_top">FreeBSD 網站</a> 可以找到本手冊的最新版本，舊版文件可從 <code class="uri"><a class="uri" href="https://docs.FreeBSD.org/doc/" target="_top">https://docs.FreeBSD.org/doc/</a></code> 取得。本文件也提供各種格式與不同壓縮方式的版本可自 <a class="link" href="https://download.freebsd.org/ftp/doc/" target="_top">FreeBSD FTP 伺服器</a> 或是其中一個 <a class="link" href="#mirrors-ftp" title="A.2. FTP 站">鏡像網站</a> 下載。 列印出來的實體書面資料可在 <a class="link" href="https://www.freebsdmall.com/" target="_top">FreeBSD 商城</a> 購買。 此外，您可在 <a class="link" href="../../../../search/index.html" target="_top">搜尋頁面</a> 中搜尋本文件或其他文件的資料。</p></div></div></div><hr /></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="preface"><a href="#book-preface">序</a></span></dt><dt><span class="part"><a href="#getting-started">I. 入門</a></span></dt><dd><dl><dt><span class="chapter"><a href="#introduction">1. 簡介</a></span></dt><dd><dl><dt><span class="sect1"><a href="#introduction-synopsis">1.1. 概述</a></span></dt><dt><span class="sect1"><a href="#nutshell">1.2. 歡迎使用 FreeBSD！</a></span></dt><dd><dl><dt><span class="sect2"><a href="#os-overview">1.2.1. FreeBSD 能做什麼？</a></span></dt><dt><span class="sect2"><a href="#introduction-nutshell-users">1.2.2. 誰在用 FreeBSD？</a></span></dt></dl></dd><dt><span class="sect1"><a href="#history">1.3. 關於 FreeBSD 計劃</a></span></dt><dd><dl><dt><span class="sect2"><a href="#intro-history">1.3.1. FreeBSD 歷史簡介</a></span></dt><dt><span class="sect2"><a href="#goals">1.3.2. FreeBSD 計劃目標</a></span></dt><dt><span class="sect2"><a href="#development">1.3.3. FreeBSD 開發模式</a></span></dt><dt><span class="sect2"><a href="#third-party-programs">1.3.4. 第三方程式</a></span></dt><dt><span class="sect2"><a href="#idp60675768">1.3.5. 其他文件</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#bsdinstall">2. 安裝 FreeBSD</a></span></dt><dd><dl><dt><span class="sect1"><a href="#bsdinstall-synopsis">2.1. 概述</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-hardware">2.2. 最低硬體需求</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-pre">2.3. 安裝前準備工作</a></span></dt><dd><dl><dt><span class="sect2"><a href="#bsdinstall-installation-media">2.3.1. 準備安裝的媒體</a></span></dt><dd><dl><dt><span class="sect3"><a href="#bsdinstall-usb">2.3.1.1. 寫入映象檔到 <acronym class="acronym">USB</acronym></a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#bsdinstall-start">2.4. 開始安裝</a></span></dt><dd><dl><dt><span class="sect2"><a href="#bsdinstall-starting-i386">2.4.1. 在 <span class="trademark">i386</span>™ 及 amd64 開機</a></span></dt><dt><span class="sect2"><a href="#idp63641400">2.4.2. 在 <span class="trademark">PowerPC</span>® 開機</a></span></dt><dt><span class="sect2"><a href="#idp63661752">2.4.3. 在 <span class="trademark">SPARC64</span>® 開機</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-view-probe">2.4.4. FreeBSD 開機選單</a></span></dt></dl></dd><dt><span class="sect1"><a href="#using-bsdinstall">2.5. 使用 <span class="application">bsdinstall</span></a></span></dt><dd><dl><dt><span class="sect2"><a href="#bsdinstall-keymap">2.5.1. 選擇鍵盤對應表選單</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-hostname">2.5.2. 設定主機名稱</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-components">2.5.3. 選擇要安裝的元件</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-netinstall">2.5.4. 從網路安裝</a></span></dt></dl></dd><dt><span class="sect1"><a href="#bsdinstall-partitioning">2.6. 配置磁碟空間</a></span></dt><dd><dl><dt><span class="sect2"><a href="#configtuning-initial">2.6.1. 規劃分割區配置</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-part-guided">2.6.2. 引導式磁碟分割</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-part-manual">2.6.3. 手動磁碟分割</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-part-zfs">2.6.4. Root-on-ZFS 自動磁碟分割</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-part-shell">2.6.5. Shell 模式磁碟分割</a></span></dt></dl></dd><dt><span class="sect1"><a href="#bsdinstall-final-warning">2.7. 確認安裝</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-post">2.8. 安裝後注意事項</a></span></dt><dd><dl><dt><span class="sect2"><a href="#bsdinstall-post-root">2.8.1. 設定 <code class="systemitem">root</code> 密碼</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-config-network-dev">2.8.2. 設定網路介面卡</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-timezone">2.8.3. 設定時區</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-sysconf">2.8.4. 開啟服務</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-crashdump">2.8.5. 開啟當機資訊 (Crash Dump)</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-addusers">2.8.6. 新增使用者</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-final-conf">2.8.7. 最後設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#bsdinstall-install-trouble">2.9. 疑難排解</a></span></dt><dt><span class="sect1"><a href="#using-live-cd">2.10. 使用 Live <acronym class="acronym">CD</acronym></a></span></dt></dl></dd><dt><span class="chapter"><a href="#basics">3. FreeBSD 基礎</a></span></dt><dd><dl><dt><span class="sect1"><a href="#basics-synopsis">3.1. 概述</a></span></dt><dt><span class="sect1"><a href="#consoles">3.2. 虛擬 Console 與終端機</a></span></dt><dd><dl><dt><span class="sect2"><a href="#consoles-virtual">3.2.1. 虛擬 Console</a></span></dt><dt><span class="sect2"><a href="#consoles-singleuser">3.2.2. 單使用者模式</a></span></dt><dt><span class="sect2"><a href="#consoles-vidcontrol">3.2.3. 更改 Console 影像模式</a></span></dt></dl></dd><dt><span class="sect1"><a href="#users-synopsis">3.3. 使用者與基礎帳號管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#users-introduction">3.3.1. 帳號類型</a></span></dt><dd><dl><dt><span class="sect3"><a href="#users-system">3.3.1.1. 系統帳號</a></span></dt><dt><span class="sect3"><a href="#users-user">3.3.1.2. 使用者帳號</a></span></dt><dt><span class="sect3"><a href="#users-superuser">3.3.1.3. 超級使用者帳號</a></span></dt></dl></dd><dt><span class="sect2"><a href="#users-modifying">3.3.2. 管理帳號</a></span></dt><dd><dl><dt><span class="sect3"><a href="#users-adduser">3.3.2.1. <code class="command">adduser</code></a></span></dt><dt><span class="sect3"><a href="#users-rmuser">3.3.2.2. <code class="command">rmuser</code></a></span></dt><dt><span class="sect3"><a href="#users-chpass">3.3.2.3. <code class="command">chpass</code></a></span></dt><dt><span class="sect3"><a href="#users-passwd">3.3.2.4. <code class="command">passwd</code></a></span></dt><dt><span class="sect3"><a href="#users-pw">3.3.2.5. <code class="command">pw</code></a></span></dt></dl></dd><dt><span class="sect2"><a href="#users-groups">3.3.3. 管理群組</a></span></dt></dl></dd><dt><span class="sect1"><a href="#permissions">3.4. 權限</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp64837048">3.4.1. 權限符號</a></span></dt><dt><span class="sect2"><a href="#idp64892088">3.4.2. FreeBSD 檔案旗標</a></span></dt><dt><span class="sect2"><a href="#idp64911544">3.4.3. <code class="literal">setuid</code> 、<code class="literal">setgid</code> 與 <code class="literal">sticky</code> 權限</a></span></dt></dl></dd><dt><span class="sect1"><a href="#dirstructure">3.5. 目錄結構</a></span></dt><dt><span class="sect1"><a href="#disk-organization">3.6. 磁碟組織</a></span></dt><dt><span class="sect1"><a href="#mount-unmount">3.7. 掛載與卸載檔案系統</a></span></dt><dd><dl><dt><span class="sect2"><a href="#disks-fstab">3.7.1. <code class="filename">fstab</code> 檔</a></span></dt><dt><span class="sect2"><a href="#disks-mount">3.7.2. 使用 mount(8)</a></span></dt><dt><span class="sect2"><a href="#disks-umount">3.7.3. 使用 umount(8)</a></span></dt></dl></dd><dt><span class="sect1"><a href="#basics-processes">3.8. 程序與 Daemon</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp65473336">3.8.1. 檢視程序</a></span></dt><dt><span class="sect2"><a href="#basics-daemons">3.8.2. 終止程序</a></span></dt></dl></dd><dt><span class="sect1"><a href="#shells">3.9. Shell</a></span></dt><dd><dl><dt><span class="sect2"><a href="#changing-shells">3.9.1. 變更 Shell</a></span></dt><dt><span class="sect2"><a href="#idp65690680">3.9.2. 進階 Shell 技巧</a></span></dt></dl></dd><dt><span class="sect1"><a href="#editors">3.10. 文字編輯器</a></span></dt><dt><span class="sect1"><a href="#basics-devices">3.11. 裝置及裝置節點</a></span></dt><dt><span class="sect1"><a href="#basics-more-information">3.12. 操作手冊</a></span></dt><dd><dl><dt><span class="sect2"><a href="#basics-info">3.12.1. GNU Info 檔</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ports">4. 安裝應用程式：套件與 Port</a></span></dt><dd><dl><dt><span class="sect1"><a href="#ports-synopsis">4.1. 概述</a></span></dt><dt><span class="sect1"><a href="#ports-overview">4.2. 安裝軟體的概要</a></span></dt><dt><span class="sect1"><a href="#ports-finding-applications">4.3. 搜尋軟體</a></span></dt><dt><span class="sect1"><a href="#pkgng-intro">4.4. 使用 <span class="application">pkg</span> 管理 Binary 套件</a></span></dt><dd><dl><dt><span class="sect2"><a href="#pkgng-initial-setup">4.4.1. 開始使用 <span class="application">pkg</span></a></span></dt><dt><span class="sect2"><a href="#pkgng-pkg-info">4.4.2. 取得有關已安裝套件的資訊</a></span></dt><dt><span class="sect2"><a href="#pkgng-installing-deinstalling">4.4.3. 安裝與移除套件</a></span></dt><dt><span class="sect2"><a href="#pkgng-upgrading">4.4.4. 升級已安裝套件</a></span></dt><dt><span class="sect2"><a href="#pkgng-auditing">4.4.5. 稽查已安裝套件</a></span></dt><dt><span class="sect2"><a href="#pkgng-autoremove">4.4.6. 自動移除未使用的套件</a></span></dt><dt><span class="sect2"><a href="#pkgng-backup">4.4.7. 還原套件資料庫</a></span></dt><dt><span class="sect2"><a href="#pkgng-clean">4.4.8. 移除過時的套件</a></span></dt><dt><span class="sect2"><a href="#pkgng-set">4.4.9. 修改套件 Metadata</a></span></dt></dl></dd><dt><span class="sect1"><a href="#ports-using">4.5. 使用 Port 套件集</a></span></dt><dd><dl><dt><span class="sect2"><a href="#ports-skeleton">4.5.1. 安裝 Port</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp66154680">4.5.1.1. 自訂 Port 安裝</a></span></dt></dl></dd><dt><span class="sect2"><a href="#ports-removing">4.5.2. 移除已安裝的 Port</a></span></dt><dt><span class="sect2"><a href="#ports-upgrading">4.5.3. 升級 Port</a></span></dt><dd><dl><dt><span class="sect3"><a href="#ports-upgrading-tools">4.5.3.1. 升級與管理 Port 的工具</a></span></dt><dt><span class="sect3"><a href="#portmaster">4.5.3.2. 使用 <span class="application">Portmaster</span> 升級 Port</a></span></dt><dt><span class="sect3"><a href="#portupgrade">4.5.3.3. 使用 Portupgrade 升級 Port</a></span></dt></dl></dd><dt><span class="sect2"><a href="#ports-disk-space">4.5.4. Port 與磁碟空間</a></span></dt></dl></dd><dt><span class="sect1"><a href="#ports-poudriere">4.6. 使用 <span class="application">Poudriere</span> 編譯套件</a></span></dt><dd><dl><dt><span class="sect2"><a href="#poudriere-initialization">4.6.1. 初始化 Jail 與 Port 樹</a></span></dt><dt><span class="sect2"><a href="#idp66422200">4.6.2. 設定 pkg 客戶端使用 Poudriere 檔案庫</a></span></dt></dl></dd><dt><span class="sect1"><a href="#ports-nextsteps">4.7. 安裝後的注意事項</a></span></dt><dt><span class="sect1"><a href="#ports-broken">4.8. 處理損壞的 Port</a></span></dt></dl></dd><dt><span class="chapter"><a href="#x11">5. X Window 系統</a></span></dt><dd><dl><dt><span class="sect1"><a href="#x11-synopsis">5.1. 概述</a></span></dt><dt><span class="sect1"><a href="#x-understanding">5.2. 術語</a></span></dt><dt><span class="sect1"><a href="#x-install">5.3. 安裝 <span class="application">Xorg</span></a></span></dt><dt><span class="sect1"><a href="#x-config">5.4. <span class="application">Xorg</span> 設定</a></span></dt><dd><dl><dt><span class="sect2"><a href="#x-config-quick-start">5.4.1. 快速開始</a></span></dt><dt><span class="sect2"><a href="#x-config-user-group">5.4.2. 可加速影像處理的使用者群組</a></span></dt><dt><span class="sect2"><a href="#x-config-kms">5.4.3. 核心模式設定 (Kernel Mode Setting, <acronym class="acronym">KMS</acronym>)</a></span></dt><dt><span class="sect2"><a href="#x-config-files">5.4.4. 設定檔</a></span></dt><dd><dl><dt><span class="sect3"><a href="#x-config-files-directory">5.4.4.1. 目錄</a></span></dt><dt><span class="sect3"><a href="#x-config-files-single-or-multi">5.4.4.2. 單檔或多檔</a></span></dt></dl></dd><dt><span class="sect2"><a href="#x-config-video-cards">5.4.5. 顯示卡</a></span></dt><dt><span class="sect2"><a href="#x-config-monitors">5.4.6. 顯示器</a></span></dt><dt><span class="sect2"><a href="#x-config-input">5.4.7. 輸入裝置</a></span></dt><dd><dl><dt><span class="sect3"><a href="#x-config-input-keyboard">5.4.7.1. 鍵盤</a></span></dt><dt><span class="sect3"><a href="#x11-input-mice">5.4.7.2. 滑鼠與指標裝置</a></span></dt></dl></dd><dt><span class="sect2"><a href="#x-config-manual-configuration">5.4.8. 手動設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#x-fonts">5.5. 在 <span class="application">Xorg</span> 使用字型</a></span></dt><dd><dl><dt><span class="sect2"><a href="#type1">5.5.1. Type1 字型</a></span></dt><dt><span class="sect2"><a href="#truetype">5.5.2. <span class="trademark">TrueType</span>® 字型</a></span></dt><dt><span class="sect2"><a href="#antialias">5.5.3. 反鋸齒字型</a></span></dt></dl></dd><dt><span class="sect1"><a href="#x-xdm">5.6. X 顯示管理程式</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67045048">5.6.1. 設定 <span class="application">XDM</span></a></span></dt><dt><span class="sect2"><a href="#idp67086904">5.6.2. 設定遠端存取</a></span></dt></dl></dd><dt><span class="sect1"><a href="#x11-wm">5.7. 桌面環境</a></span></dt><dd><dl><dt><span class="sect2"><a href="#x11-wm-gnome">5.7.1. GNOME</a></span></dt><dt><span class="sect2"><a href="#x11-wm-kde">5.7.2. KDE</a></span></dt><dt><span class="sect2"><a href="#x11-wm-xfce">5.7.3. Xfce</a></span></dt></dl></dd><dt><span class="sect1"><a href="#x-compiz-fusion">5.8. 安裝 Compiz Fusion</a></span></dt><dd><dl><dt><span class="sect2"><a href="#x-compiz-video-card">5.8.1. 設定 FreeBSD nVidia 驅動程式</a></span></dt><dt><span class="sect2"><a href="#xorg-configuration">5.8.2. 設定 xorg.conf 來啟動桌面特效</a></span></dt><dt><span class="sect2"><a href="#compiz-fusion">5.8.3. 安裝與設定 Compiz Fusion</a></span></dt></dl></dd><dt><span class="sect1"><a href="#x11-understanding">5.9. 疑難排解</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67319352">5.9.1. 設定 <span class="trademark">Intel</span>® <code class="literal">i810</code> 繪圖晶片組</a></span></dt><dt><span class="sect2"><a href="#idp67330744">5.9.2. 加入寬螢幕平板顯示器到設定檔</a></span></dt><dt><span class="sect2"><a href="#compiz-troubleshooting">5.9.3. Compiz Fusion 疑難排解</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="part"><a href="#common-tasks">II. 一般作業</a></span></dt><dd><dl><dt><span class="chapter"><a href="#desktop">6. 桌面應用程式</a></span></dt><dd><dl><dt><span class="sect1"><a href="#desktop-synopsis">6.1. 概述</a></span></dt><dt><span class="sect1"><a href="#desktop-browsers">6.2. 瀏覽器</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67394744">6.2.1. Firefox</a></span></dt><dt><span class="sect2"><a href="#idp67410232">6.2.2. Opera</a></span></dt><dt><span class="sect2"><a href="#idp67448760">6.2.3. Konqueror</a></span></dt><dt><span class="sect2"><a href="#idp67462712">6.2.4. Chromium</a></span></dt></dl></dd><dt><span class="sect1"><a href="#desktop-productivity">6.3. 辦工工具</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67520824">6.3.1. Calligra</a></span></dt><dt><span class="sect2"><a href="#idp67534904">6.3.2. AbiWord</a></span></dt><dt><span class="sect2"><a href="#idp67543736">6.3.3. The GIMP</a></span></dt><dt><span class="sect2"><a href="#idp67555640">6.3.4. Apache OpenOffice</a></span></dt><dt><span class="sect2"><a href="#idp67592760">6.3.5. LibreOffice</a></span></dt></dl></dd><dt><span class="sect1"><a href="#desktop-viewers">6.4. 文件閱覽程式</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67637304">6.4.1. Xpdf</a></span></dt><dt><span class="sect2"><a href="#idp67662392">6.4.2. <span class="application">gv</span></a></span></dt><dt><span class="sect2"><a href="#idp67677496">6.4.3. Geeqie</a></span></dt><dt><span class="sect2"><a href="#idp67688888">6.4.4. ePDFView</a></span></dt><dt><span class="sect2"><a href="#idp67698616">6.4.5. Okular</a></span></dt></dl></dd><dt><span class="sect1"><a href="#desktop-finance">6.5. 財務</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67182008">6.5.1. GnuCash</a></span></dt><dt><span class="sect2"><a href="#idp67760440">6.5.2. Gnumeric</a></span></dt><dt><span class="sect2"><a href="#idp67769528">6.5.3. KMyMoney</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#multimedia">7. 多媒體</a></span></dt><dd><dl><dt><span class="sect1"><a href="#multimedia-synopsis">7.1. 概述</a></span></dt><dt><span class="sect1"><a href="#sound-setup">7.2. 設定音效卡</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67835832">7.2.1. 設定自訂核心支援音效</a></span></dt><dt><span class="sect2"><a href="#sound-testing">7.2.2. 測試音效</a></span></dt><dt><span class="sect2"><a href="#bluetooth-headset">7.2.3. 設定藍芽音效裝置</a></span></dt><dt><span class="sect2"><a href="#troubleshooting">7.2.4. 疑難排解音效</a></span></dt><dt><span class="sect2"><a href="#sound-multiple-sources">7.2.5. 使用多個音效來源</a></span></dt><dt><span class="sect2"><a href="#idp67973816">7.2.6. 設定混音器頻道的預設值</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sound-mp3">7.3. MP3 音樂</a></span></dt><dd><dl><dt><span class="sect2"><a href="#mp3-players">7.3.1. MP3 播放器</a></span></dt><dt><span class="sect2"><a href="#rip-cd">7.3.2. 擷取 <acronym class="acronym">CD</acronym> 音軌</a></span></dt><dt><span class="sect2"><a href="#mp3-encoding">7.3.3. MP3 編碼與解碼</a></span></dt></dl></dd><dt><span class="sect1"><a href="#video-playback">7.4. 影片播放</a></span></dt><dd><dl><dt><span class="sect2"><a href="#video-interface">7.4.1. 偵測影像處理能力</a></span></dt><dd><dl><dt><span class="sect3"><a href="#video-interface-xvideo">7.4.1.1. XVideo</a></span></dt></dl></dd><dt><span class="sect2"><a href="#video-ports">7.4.2. 可處理影像的 Port 與套件</a></span></dt><dd><dl><dt><span class="sect3"><a href="#video-mplayer">7.4.2.1. <span class="application">MPlayer</span> 與 <span class="application">MEncoder</span></a></span></dt><dt><span class="sect3"><a href="#video-xine">7.4.2.2. <span class="application">xine</span> 影像播放器</a></span></dt><dt><span class="sect3"><a href="#video-ports-transcode">7.4.2.3. <span class="application">Transcode</span> 工具</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#tvcard">7.5. 電視卡</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp68325176">7.5.1. 載入驅動程式</a></span></dt><dt><span class="sect2"><a href="#idp68340024">7.5.2. 好用的應用程式</a></span></dt><dt><span class="sect2"><a href="#idp68357944">7.5.3. 疑難排解</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mythtv">7.6. MythTV</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp68379576">7.6.1. 硬體</a></span></dt><dt><span class="sect2"><a href="#idp68389944">7.6.2. 設定 MythTV 後端</a></span></dt></dl></dd><dt><span class="sect1"><a href="#scanners">7.7. 影像掃描器</a></span></dt><dd><dl><dt><span class="sect2"><a href="#scanners-kernel-usb">7.7.1. 檢查掃描器</a></span></dt><dt><span class="sect2"><a href="#idp68455608">7.7.2. <span class="application">SANE</span> 設定</a></span></dt><dt><span class="sect2"><a href="#idp68507704">7.7.3. 掃描器權限</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#kernelconfig">8. 設定 FreeBSD 核心</a></span></dt><dd><dl><dt><span class="sect1"><a href="#kernelconfig-synopsis">8.1. 概述</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-custom-kernel">8.2. 為何要編譯自訂的核心?</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-devices">8.3. 偵測系統硬體</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-config">8.4. 設定檔</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-building">8.5. 編譯與安裝自訂核心</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-trouble">8.6. 如果發生錯誤</a></span></dt></dl></dd><dt><span class="chapter"><a href="#printing">9. 列印</a></span></dt><dd><dl><dt><span class="sect1"><a href="#printing-quick-start">9.1. 快速開始</a></span></dt><dt><span class="sect1"><a href="#printing-connections">9.2. 印表機連線</a></span></dt><dd><dl><dt><span class="sect2"><a href="#printing-connections-summary">9.2.1. 摘要</a></span></dt></dl></dd><dt><span class="sect1"><a href="#printing-pdls">9.3. 常見的頁面描述語言</a></span></dt><dd><dl><dt><span class="sect2"><a href="#print-pdls-table">9.3.1. 轉換 <span class="trademark">PostScript</span>® 至其他 <acronym class="acronym">PDL</acronym></a></span></dt><dt><span class="sect2"><a href="#print-pdls-summary">9.3.2. 摘要</a></span></dt></dl></dd><dt><span class="sect1"><a href="#printing-direct">9.4. 直接列印</a></span></dt><dt><span class="sect1"><a href="#printing-lpd">9.5. <acronym class="acronym">LPD</acronym> (行列式印表機 Daemon)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#printing-lpd-setup">9.5.1. 初始設定</a></span></dt><dt><span class="sect2"><a href="#printing-lpd-lpr">9.5.2. 使用 lpr(1) 列印</a></span></dt><dt><span class="sect2"><a href="#printing-lpd-filters">9.5.3. 過濾器</a></span></dt><dd><dl><dt><span class="sect3"><a href="#printing-lpd-filters-stairstep">9.5.3.1. 避免在純文字印表機階梯狀列印</a></span></dt><dt><span class="sect3"><a href="#printing-lpd-filters-enscript">9.5.3.2. 使用 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/enscript/pkg-descr">print/enscript</a> 在 <span class="trademark">PostScript</span>® 印表機美化純文字內容</a></span></dt><dt><span class="sect3"><a href="#printing-lpd-filters-ps2pcl">9.5.3.3. 列印 <span class="trademark">PostScript</span>® 到 <acronym class="acronym">PCL</acronym> 印表機</a></span></dt><dt><span class="sect3"><a href="#printing-lpd-filters-smart">9.5.3.4. 智慧過濾器</a></span></dt><dt><span class="sect3"><a href="#printing-lpd-filters-othersmart">9.5.3.5. 其他智慧過濾器</a></span></dt></dl></dd><dt><span class="sect2"><a href="#printing-lpd-queues">9.5.4. 多序列</a></span></dt><dt><span class="sect2"><a href="#printing-lpd-monitor">9.5.5. 監視與控制列印</a></span></dt><dd><dl><dt><span class="sect3"><a href="#printing-lpd-monitor-lpq">9.5.5.1. lpq(1)</a></span></dt><dt><span class="sect3"><a href="#printing-lpd-monitor-lprm">9.5.5.2. lprm(1)</a></span></dt><dt><span class="sect3"><a href="#printing-lpd-monitor-lpc">9.5.5.3. lpc(8)</a></span></dt></dl></dd><dt><span class="sect2"><a href="#printing-lpd-shared">9.5.6. 分享印表機</a></span></dt><dd><dl><dt><span class="sect3"><a href="#printing-shared-aliases">9.5.6.1. 別名</a></span></dt><dt><span class="sect3"><a href="#printing-shared-headers">9.5.6.2. 頁首</a></span></dt></dl></dd><dt><span class="sect2"><a href="#printing-lpd-references">9.5.7. 參考文獻</a></span></dt></dl></dd><dt><span class="sect1"><a href="#printing-other">9.6. 其他列印系統</a></span></dt><dd><dl><dt><span class="sect2"><a href="#printing-other-cups">9.6.1. <acronym class="acronym">CUPS</acronym> (Common <span class="trademark">UNIX</span>® Printing
	System)</a></span></dt><dt><span class="sect2"><a href="#printing-other-hplip">9.6.2. HPLIP</a></span></dt><dt><span class="sect2"><a href="#printing-other-lprng">9.6.3. LPRng</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#linuxemu">10. <span class="trademark">Linux</span>® Binary 相容性</a></span></dt><dd><dl><dt><span class="sect1"><a href="#linuxemu-synopsis">10.1. 概述</a></span></dt><dt><span class="sect1"><a href="#linuxemu-lbc-install">10.2. 設定 <span class="trademark">Linux</span>® Binary 相容性</a></span></dt><dd><dl><dt><span class="sect2"><a href="#linuxemu-libs-manually">10.2.1. 手動安裝其他程式庫</a></span></dt><dt><span class="sect2"><a href="#idp69370168">10.2.2. 安裝 <span class="trademark">Linux</span>® <acronym class="acronym">ELF</acronym> Binary</a></span></dt><dt><span class="sect2"><a href="#idp69396408">10.2.3. 安裝以 <span class="trademark">Linux</span>® <acronym class="acronym">RPM</acronym> 為基礎的應用程式</a></span></dt><dt><span class="sect2"><a href="#idp69403832">10.2.4. 設定主機名稱解析器</a></span></dt></dl></dd><dt><span class="sect1"><a href="#linuxemu-advanced">10.3. 進階主題</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#system-administration">III. 系統管理</a></span></dt><dd><dl><dt><span class="chapter"><a href="#config-tuning">11. 設定與調校</a></span></dt><dd><dl><dt><span class="sect1"><a href="#config-synopsis">11.1. 概述</a></span></dt><dt><span class="sect1"><a href="#configtuning-starting-services">11.2. 啟動服務</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp69744312">11.2.1. 延伸應用程式設定</a></span></dt><dt><span class="sect2"><a href="#idp69755960">11.2.2. 使用服務來啟動其他服務</a></span></dt></dl></dd><dt><span class="sect1"><a href="#configtuning-cron">11.3. 設定 cron(8)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#configtuning-installcrontab">11.3.1. 建立使用者的 Crontab</a></span></dt></dl></dd><dt><span class="sect1"><a href="#configtuning-rcd">11.4. 管理 FreeBSD 中的服務</a></span></dt><dd><dl><dt><span class="sect2"><a href="#configtuning-core-configuration">11.4.1. 管理系統特定的設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#config-network-setup">11.5. 設定網路介面卡</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp69940536">11.5.1. 找到正確的驅動程式</a></span></dt><dd><dl><dt><span class="sect3"><a href="#config-network-ndis">11.5.1.1. 使用 <span class="trademark">Windows</span>® <acronym class="acronym">NDIS</acronym> 驅動程式</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp69475128">11.5.2. 設定網路卡</a></span></dt><dt><span class="sect2"><a href="#config-network-testing">11.5.3. 測試與疑難排解</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp69555768">11.5.3.1. 測試乙太網路卡</a></span></dt><dt><span class="sect3"><a href="#idp70017208">11.5.3.2. 疑難排解</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#configtuning-virtual-hosts">11.6. 虛擬主機</a></span></dt><dt><span class="sect1"><a href="#configtuning-syslog">11.7. 設定系統日誌</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp69424312">11.7.1. 設定本地日誌</a></span></dt><dt><span class="sect2"><a href="#idp70118968">11.7.2. 日誌管理與翻轉</a></span></dt><dt><span class="sect2"><a href="#network-syslogd">11.7.3. 設定遠端日誌</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70203320">11.7.3.1. 日誌伺服器設定</a></span></dt><dt><span class="sect3"><a href="#idp70239160">11.7.3.2. 日誌客戶端設定</a></span></dt><dt><span class="sect3"><a href="#idp70251192">11.7.3.3. 日誌伺服器除錯</a></span></dt><dt><span class="sect3"><a href="#idp70266168">11.7.3.4. 安全注意事項</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#configtuning-configfiles">11.8. 設定檔</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp70279096">11.8.1. <code class="filename">/etc</code> 配置</a></span></dt><dt><span class="sect2"><a href="#idp70303416">11.8.2. 主機名稱</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70305336">11.8.2.1. <code class="filename">/etc/resolv.conf</code></a></span></dt><dt><span class="sect3"><a href="#idp70337848">11.8.2.2. <code class="filename">/etc/hosts</code></a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#configtuning-sysctl">11.9. 使用 sysctl(8) 調校</a></span></dt><dd><dl><dt><span class="sect2"><a href="#configtuning-sysctlconf">11.9.1. <code class="filename">sysctl.conf</code></a></span></dt><dt><span class="sect2"><a href="#sysctl-readonly">11.9.2. 唯讀 sysctl(8)</a></span></dt></dl></dd><dt><span class="sect1"><a href="#configtuning-disk">11.10. 調校磁碟</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp70401976">11.10.1. Sysctl 變數</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70402616">11.10.1.1. <code class="varname">vfs.vmiodirenable</code></a></span></dt><dt><span class="sect3"><a href="#idp70408632">11.10.1.2. <code class="varname">vfs.write_behind</code></a></span></dt><dt><span class="sect3"><a href="#idp70416824">11.10.1.3. <code class="varname">vfs.hirunningspace</code></a></span></dt><dt><span class="sect3"><a href="#idp70427064">11.10.1.4. <code class="varname">vm.swap_idle_enabled</code></a></span></dt><dt><span class="sect3"><a href="#idp70431928">11.10.1.5. <code class="varname">hw.ata.wc</code></a></span></dt><dt><span class="sect3"><a href="#idp70456376">11.10.1.6. <code class="literal">SCSI_DELAY</code>
	  (<code class="varname">kern.cam.scsi_delay</code>)</a></span></dt></dl></dd><dt><span class="sect2"><a href="#soft-updates">11.10.2. 軟更新</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70459448">11.10.2.1. 有關軟更新的更多詳細資訊</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#configtuning-kernel-limits">11.11. 調校核心限制</a></span></dt><dd><dl><dt><span class="sect2"><a href="#file-process-limits">11.11.1. 檔案/程序限制</a></span></dt><dd><dl><dt><span class="sect3"><a href="#kern-maxfiles">11.11.1.1. <code class="varname">kern.maxfiles</code></a></span></dt><dt><span class="sect3"><a href="#idp70551992">11.11.1.2. <code class="varname">kern.ipc.soacceptqueue</code></a></span></dt></dl></dd><dt><span class="sect2"><a href="#nmbclusters">11.11.2. 網路限制</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70591032">11.11.2.1. <code class="varname">net.inet.ip.portrange.*</code></a></span></dt><dt><span class="sect3"><a href="#idp70598840">11.11.2.2. <code class="literal">TCP</code> 頻寬延遲乘積</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp70611128">11.11.3. 虛擬記憶體</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70611768">11.11.3.1. <code class="varname">kern.maxvnodes</code></a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#adding-swap-space">11.12. 增加交換空間</a></span></dt><dd><dl><dt><span class="sect2"><a href="#new-drive-swap">11.12.1. 使用新硬碟或既有分割區增加交換空間</a></span></dt><dt><span class="sect2"><a href="#create-swapfile">11.12.2. 建立交換檔</a></span></dt></dl></dd><dt><span class="sect1"><a href="#acpi-overview">11.13. 電源與資源管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#acpi-config">11.13.1. 設定 <acronym class="acronym">ACPI</acronym></a></span></dt><dt><span class="sect2"><a href="#ACPI-comprob">11.13.2. 常見問題</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70770360">11.13.2.1. 滑鼠問題</a></span></dt><dt><span class="sect3"><a href="#idp70772536">11.13.2.2. 待機/喚醒</a></span></dt><dt><span class="sect3"><a href="#idp70811064">11.13.2.3. 系統無回應</a></span></dt><dt><span class="sect3"><a href="#idp70821432">11.13.2.4. 當機</a></span></dt><dt><span class="sect3"><a href="#idp70827064">11.13.2.5. 系統在待機或關機後仍開機</a></span></dt><dt><span class="sect3"><a href="#ACPI-aslanddump">11.13.2.6. BIOS 含有有問題的 Bytecode</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp70851256">11.13.3. 覆蓋預設的 <acronym class="acronym">AML</acronym></a></span></dt><dt><span class="sect2"><a href="#ACPI-submitdebug">11.13.4. 取得與回報除錯資訊</a></span></dt><dt><span class="sect2"><a href="#ACPI-References">11.13.5. 參考文獻</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#boot">12. FreeBSD 開機程序</a></span></dt><dd><dl><dt><span class="sect1"><a href="#boot-synopsis">12.1. 概述</a></span></dt><dt><span class="sect1"><a href="#boot-introduction">12.2. FreeBSD 開機程序</a></span></dt><dd><dl><dt><span class="sect2"><a href="#boot-boot0">12.2.1. 開機管理程式</a></span></dt><dt><span class="sect2"><a href="#boot-boot1">12.2.2. 階段一與階段二</a></span></dt><dt><span class="sect2"><a href="#boot-loader">12.2.3. 階段三</a></span></dt><dt><span class="sect2"><a href="#boot-init">12.2.4. 最終階段</a></span></dt><dd><dl><dt><span class="sect3"><a href="#boot-singleuser">12.2.4.1. 單使用者模式</a></span></dt><dt><span class="sect3"><a href="#boot-multiuser">12.2.4.2. 多使用者模式</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#boot-splash">12.3. 設定開機啟動畫面</a></span></dt><dt><span class="sect1"><a href="#device-hints">12.4. 裝置提示</a></span></dt><dt><span class="sect1"><a href="#boot-shutdown">12.5. 關機程序</a></span></dt></dl></dd><dt><span class="chapter"><a href="#security">13. 安全性</a></span></dt><dd><dl><dt><span class="sect1"><a href="#security-synopsis">13.1. 概述</a></span></dt><dt><span class="sect1"><a href="#security-intro">13.2. 簡介</a></span></dt><dd><dl><dt><span class="sect2"><a href="#security-accounts">13.2.1. 防止登入</a></span></dt><dt><span class="sect2"><a href="#security-accountmgmt">13.2.2. 帳號升級授權</a></span></dt><dt><span class="sect2"><a href="#security-passwords">13.2.3. 密碼編碼方式</a></span></dt><dt><span class="sect2"><a href="#security-pwpolicy">13.2.4. 強制密碼政策</a></span></dt><dt><span class="sect2"><a href="#security-rkhunter">13.2.5. 偵測 Root 工具 (Rootkit)</a></span></dt><dt><span class="sect2"><a href="#security-ids">13.2.6. Binary 檢驗</a></span></dt><dt><span class="sect2"><a href="#security-tuning">13.2.7. 系統安全性調校</a></span></dt></dl></dd><dt><span class="sect1"><a href="#one-time-passwords">13.3. 一次性密碼</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp71807928">13.3.1. 初始化 <acronym class="acronym">OPIE</acronym></a></span></dt><dt><span class="sect2"><a href="#idp71814072">13.3.2. 在不安全連線下做初始化</a></span></dt><dt><span class="sect2"><a href="#idp71832248">13.3.3. 產生單組一次性密碼</a></span></dt><dt><span class="sect2"><a href="#idp71842616">13.3.4. 產生多組一次性密碼</a></span></dt><dt><span class="sect2"><a href="#idp71851576">13.3.5. 限制使用 <span class="trademark">UNIX</span>® 密碼</a></span></dt></dl></dd><dt><span class="sect1"><a href="#tcpwrappers">13.4. TCP Wrapper</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp71894840">13.4.1. 初始設定</a></span></dt><dt><span class="sect2"><a href="#idp71914040">13.4.2. 進階設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#kerberos5">13.5. <span class="application">Kerberos</span></a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp71986104">13.5.1. 設定 Heimdal <acronym class="acronym">KDC</acronym></a></span></dt><dt><span class="sect2"><a href="#idp63142200">13.5.2. 設定伺服器使用 <span class="application">Kerberos</span></a></span></dt><dt><span class="sect2"><a href="#idp72064568">13.5.3. 設定客戶端使用 <span class="application">Kerberos</span></a></span></dt><dt><span class="sect2"><a href="#idp72113080">13.5.4. 與 <acronym class="acronym">MIT</acronym> 的差異</a></span></dt><dt><span class="sect2"><a href="#idp72125496">13.5.5. <span class="application">Kerberos</span> 提示、技巧與疑難排解</a></span></dt><dt><span class="sect2"><a href="#idp72161976">13.5.6. 減輕 <span class="application">Kerberos</span> 的限制</a></span></dt><dt><span class="sect2"><a href="#idp72186296">13.5.7. 相關資源與延伸資訊</a></span></dt></dl></dd><dt><span class="sect1"><a href="#openssl">13.6. OpenSSL</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp72220088">13.6.1. 產生憑証</a></span></dt><dt><span class="sect2"><a href="#idp72274872">13.6.2. 使用憑證</a></span></dt></dl></dd><dt><span class="sect1"><a href="#ipsec">13.7. <acronym class="acronym">VPN</acronym> over
	<acronym class="acronym">IPsec</acronym></a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp72350776">13.7.1. 在 FreeBSD 上設定 <acronym class="acronym">VPN</acronym></a></span></dt></dl></dd><dt><span class="sect1"><a href="#openssh">13.8. OpenSSH</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp72454328">13.8.1. 使用 SSH 客戶端工具</a></span></dt><dd><dl><dt><span class="sect3"><a href="#security-ssh-keygen">13.8.1.1. 以金鑰為基礎的認證</a></span></dt><dt><span class="sect3"><a href="#security-ssh-tunneling">13.8.1.2. <acronym class="acronym">SSH</acronym> 通道</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp72610104">13.8.2. 開啟 SSH 伺服器</a></span></dt><dt><span class="sect2"><a href="#idp72627000">13.8.3. SSH 伺服器安全性</a></span></dt></dl></dd><dt><span class="sect1"><a href="#fs-acl">13.9. 存取控制清單</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp72666552">13.9.1. 開啟 <acronym class="acronym">ACL</acronym> 支援</a></span></dt><dt><span class="sect2"><a href="#idp72691128">13.9.2. 使用 <acronym class="acronym">ACL</acronym></a></span></dt></dl></dd><dt><span class="sect1"><a href="#security-pkg">13.10. 監視第三方安全性問題</a></span></dt><dt><span class="sect1"><a href="#security-advisories">13.11. FreeBSD 安全報告</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp72762424">13.11.1. 安全報告的格式</a></span></dt></dl></dd><dt><span class="sect1"><a href="#security-accounting">13.12. 程序追蹤</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp72836280">13.12.1. 開啟並使用程序追蹤</a></span></dt></dl></dd><dt><span class="sect1"><a href="#security-resourcelimits">13.13. 限制資源</a></span></dt><dd><dl><dt><span class="sect2"><a href="#users-limiting">13.13.1. 設定登入類別</a></span></dt><dt><span class="sect2"><a href="#idp73055928">13.13.2. 開啟並設定資源限制</a></span></dt></dl></dd><dt><span class="sect1"><a href="#security-sudo">13.14. 使用 Sudo 分享管理權限</a></span></dt><dd><dl><dt><span class="sect2"><a href="#security-sudo-loggin">13.14.1. 記錄輸出</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#jails">14. Jail</a></span></dt><dd><dl><dt><span class="sect1"><a href="#jails-synopsis">14.1. 概述</a></span></dt><dt><span class="sect1"><a href="#jails-terms">14.2. Jail 相關術語</a></span></dt><dt><span class="sect1"><a href="#jails-build">14.3. 建立和控制 Jail</a></span></dt><dt><span class="sect1"><a href="#jails-tuning">14.4. 調校與管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#jails-tuning-utilities">14.4.1. 在 FreeBSD 中調校 Jail 的系統工具</a></span></dt><dt><span class="sect2"><a href="#jails-tuning-admintools">14.4.2. 在 FreeBSD Port 套件集中的高層級管理工具</a></span></dt><dt><span class="sect2"><a href="#jails-updating">14.4.3. 持續 Jail 的修補與更新</a></span></dt></dl></dd><dt><span class="sect1"><a href="#jails-application">14.5. 更新多個 Jail</a></span></dt><dd><dl><dt><span class="sect2"><a href="#jails-service-jails-template">14.5.1. 建立範本</a></span></dt><dt><span class="sect2"><a href="#jails-service-jails-creating">14.5.2. 建立 Jail</a></span></dt><dt><span class="sect2"><a href="#jails-service-jails-upgrading">14.5.3. 升級</a></span></dt></dl></dd><dt><span class="sect1"><a href="#jails-ezjail">14.6. 使用 <span class="application">ezjail</span> 管理 Jail</a></span></dt><dd><dl><dt><span class="sect2"><a href="#jails-ezjail-install">14.6.1. 安裝 <span class="application">ezjail</span></a></span></dt><dt><span class="sect2"><a href="#jails-ezjail-initialsetup">14.6.2. 初始設定</a></span></dt><dt><span class="sect2"><a href="#jails-ezjail-create">14.6.3. 建立並啟動新的 Jail</a></span></dt><dt><span class="sect2"><a href="#jails-ezjail-update">14.6.4. 更新 Jail</a></span></dt><dd><dl><dt><span class="sect3"><a href="#jails-ezjail-update-os">14.6.4.1. 更新作業系統</a></span></dt><dt><span class="sect3"><a href="#jails-ezjail-update-ports">14.6.4.2. 更新 Port</a></span></dt></dl></dd><dt><span class="sect2"><a href="#jails-ezjail-control">14.6.5. 控制 Jail</a></span></dt><dd><dl><dt><span class="sect3"><a href="#jails-ezjail-control-stop-start">14.6.5.1. 停止與啟動 Jail</a></span></dt><dt><span class="sect3"><a href="#jails-ezjail-control-backup">14.6.5.2. 封存與還原 Jail</a></span></dt></dl></dd><dt><span class="sect2"><a href="#jails-ezjail-example-bind">14.6.6. 完整範例：在 Jail 中安裝 <span class="application">BIND</span></a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#mac">15. 強制存取控制 (MAC)</a></span></dt><dd><dl><dt><span class="sect1"><a href="#mac-synopsis">15.1. 概述</a></span></dt><dt><span class="sect1"><a href="#mac-inline-glossary">15.2. 關鍵詞</a></span></dt><dt><span class="sect1"><a href="#mac-understandlabel">15.3. 了解 MAC 標籤</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp74021560">15.3.1. 標籤設定</a></span></dt><dt><span class="sect2"><a href="#idp74050360">15.3.2. 預先定義的標籤</a></span></dt><dt><span class="sect2"><a href="#idp74084408">15.3.3. 數值標籤</a></span></dt><dt><span class="sect2"><a href="#idp74090552">15.3.4. 使用者標籤</a></span></dt><dt><span class="sect2"><a href="#idp74110904">15.3.5. 網路介面標籤</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mac-planning">15.4. 規劃安全架構</a></span></dt><dt><span class="sect1"><a href="#mac-policies">15.5. 可用的 MAC 管理政策</a></span></dt><dd><dl><dt><span class="sect2"><a href="#mac-seeotheruids">15.5.1. MAC See Other UIDs 政策</a></span></dt><dt><span class="sect2"><a href="#mac-bsdextended">15.5.2. MAC BSD Extended 政策</a></span></dt><dt><span class="sect2"><a href="#mac-ifoff">15.5.3. MAC Interface Silencing 政策</a></span></dt><dt><span class="sect2"><a href="#mac-portacl">15.5.4. MAC Port Access Control 政策</a></span></dt><dt><span class="sect2"><a href="#mac-partition">15.5.5. MAC Partition 政策</a></span></dt><dt><span class="sect2"><a href="#mac-mls">15.5.6. MAC Multi-Level Security 模組</a></span></dt><dt><span class="sect2"><a href="#mac-biba">15.5.7. MAC Biba 模組</a></span></dt><dt><span class="sect2"><a href="#mac-lomac">15.5.8. MAC Low-watermark 模組</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mac-userlocked">15.6. User Lock Down</a></span></dt><dt><span class="sect1"><a href="#mac-implementing">15.7. 在 MAC Jail 中使用 Nagios</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp74076216">15.7.1. 建立不安全的使用者類別</a></span></dt><dt><span class="sect2"><a href="#idp74080952">15.7.2. 設定使用者</a></span></dt><dt><span class="sect2"><a href="#idp74491320">15.7.3. 建立關聯檔 (Context File)</a></span></dt><dt><span class="sect2"><a href="#idp74498616">15.7.4. 載入程式設定</a></span></dt><dt><span class="sect2"><a href="#idp74502584">15.7.5. 測試設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mac-troubleshoot">15.8. MAC 架構疑難排解</a></span></dt></dl></dd><dt><span class="chapter"><a href="#audit">16. 安全事件稽查</a></span></dt><dd><dl><dt><span class="sect1"><a href="#audit-synopsis">16.1. 概述</a></span></dt><dt><span class="sect1"><a href="#audit-inline-glossary">16.2. 關鍵詞</a></span></dt><dt><span class="sect1"><a href="#audit-config">16.3. 稽查設定</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp74680632">16.3.1. 事件選擇表示法</a></span></dt><dt><span class="sect2"><a href="#idp74783416">16.3.2. 設定檔</a></span></dt><dd><dl><dt><span class="sect3"><a href="#audit-auditcontrol">16.3.2.1. The <code class="filename">audit_control</code> File</a></span></dt><dt><span class="sect3"><a href="#audit-audituser">16.3.2.2. The <code class="filename">audit_user</code> File</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#audit-administration">16.4. 查看稽查線索</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp74883128">16.4.1. 使用 Audit Pipes 即時監視</a></span></dt><dt><span class="sect2"><a href="#idp74908728">16.4.2. 翻轉與壓縮 Audit Trail 檔</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#disks">17. 儲存設備</a></span></dt><dd><dl><dt><span class="sect1"><a href="#disks-synopsis">17.1. 概述</a></span></dt><dt><span class="sect1"><a href="#disks-adding">17.2. 加入磁碟</a></span></dt><dt><span class="sect1"><a href="#disks-growing">17.3. 重設大小與擴增磁碟</a></span></dt><dt><span class="sect1"><a href="#usb-disks">17.4. <acronym class="acronym">USB</acronym> 儲存裝置</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp75067192">17.4.1. 裝置設定</a></span></dt><dt><span class="sect2"><a href="#idp75186232">17.4.2. 自動掛載可移除的媒體</a></span></dt></dl></dd><dt><span class="sect1"><a href="#creating-cds">17.5. 建立與使用 <acronym class="acronym">CD</acronym> 媒體</a></span></dt><dd><dl><dt><span class="sect2"><a href="#atapicam">17.5.1. 支援的裝置</a></span></dt><dt><span class="sect2"><a href="#cdrecord">17.5.2. 燒錄 <acronym class="acronym">CD</acronym></a></span></dt><dt><span class="sect2"><a href="#mkisofs">17.5.3. 寫入資料到一個 <acronym class="acronym">ISO</acronym> 檔案系統</a></span></dt><dt><span class="sect2"><a href="#mounting-cd">17.5.4. 使用資料 <acronym class="acronym">CD</acronym></a></span></dt><dt><span class="sect2"><a href="#duplicating-audiocds">17.5.5. 複製音樂 <acronym class="acronym">CD</acronym></a></span></dt></dl></dd><dt><span class="sect1"><a href="#creating-dvds">17.6. 建立與使用 <acronym class="acronym">DVD</acronym> 媒體</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp75436856">17.6.1. 設定</a></span></dt><dt><span class="sect2"><a href="#idp75468600">17.6.2. 燒錄資料 <acronym class="acronym">DVD</acronym></a></span></dt><dt><span class="sect2"><a href="#idp75514168">17.6.3. 燒錄 <acronym class="acronym">DVD</acronym>-Video</a></span></dt><dt><span class="sect2"><a href="#idp75524408">17.6.4. 使用 <acronym class="acronym">DVD+RW</acronym></a></span></dt><dt><span class="sect2"><a href="#idp75561784">17.6.5. 使用 <acronym class="acronym">DVD-RW</acronym></a></span></dt><dt><span class="sect2"><a href="#idp75611832">17.6.6. 多階段燒錄 (Multi-Session)</a></span></dt><dt><span class="sect2"><a href="#idp75619384">17.6.7. 取得更多資訊</a></span></dt><dt><span class="sect2"><a href="#creating-dvd-ram">17.6.8. 使用 <acronym class="acronym">DVD-RAM</acronym></a></span></dt></dl></dd><dt><span class="sect1"><a href="#floppies">17.7. 建立與使用軟碟</a></span></dt><dt><span class="sect1"><a href="#backup-basics">17.8. 備份基礎概念</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp75669816">17.8.1. 檔案系統備份</a></span></dt><dt><span class="sect2"><a href="#idp75722680">17.8.2. 目錄備份</a></span></dt><dt><span class="sect2"><a href="#backups-tapebackups">17.8.3. 使用資料磁帶備份</a></span></dt><dt><span class="sect2"><a href="#backups-programs-amanda">17.8.4. 第三方備份工具</a></span></dt><dt><span class="sect2"><a href="#idp75801912">17.8.5. 緊急還原</a></span></dt></dl></dd><dt><span class="sect1"><a href="#disks-virtual">17.9. 記憶體磁碟</a></span></dt><dd><dl><dt><span class="sect2"><a href="#disks-mdconfig">17.9.1. 連接與解除連接既有的映象檔</a></span></dt><dt><span class="sect2"><a href="#disks-md-freebsd5">17.9.2. 建立以檔案或記憶體為基底的磁碟</a></span></dt></dl></dd><dt><span class="sect1"><a href="#snapshots">17.10. 檔案系統快照</a></span></dt><dt><span class="sect1"><a href="#quotas">17.11. 磁碟配額</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp75990968">17.11.1. 開啟磁碟配額</a></span></dt><dt><span class="sect2"><a href="#idp76013240">17.11.2. 設定配額限制</a></span></dt><dt><span class="sect2"><a href="#idp76034488">17.11.3. 檢查配額限制與磁碟使用狀況</a></span></dt><dt><span class="sect2"><a href="#idp76050616">17.11.4. NFS 上的配額</a></span></dt></dl></dd><dt><span class="sect1"><a href="#disks-encrypting">17.12. 磁碟分割區加密</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp76085432">17.12.1. 使用 <span class="application">gbde</span> 做磁碟加密</a></span></dt><dt><span class="sect2"><a href="#disks-encrypting-geli">17.12.2. 使用 <code class="command">geli</code> 做磁碟加密</a></span></dt></dl></dd><dt><span class="sect1"><a href="#swap-encrypting">17.13. 交換空間加密</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp76252344">17.13.1. 設定已加密的交換空間</a></span></dt><dt><span class="sect2"><a href="#idp76289336">17.13.2. 加密的交換空間檢驗</a></span></dt></dl></dd><dt><span class="sect1"><a href="#disks-hast">17.14. 高可用存儲空間 (<acronym class="acronym">HAST</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp76339768">17.14.1. HAST 運作模式</a></span></dt><dt><span class="sect2"><a href="#idp76371256">17.14.2. HAST 設定</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp76439608">17.14.2.1. 容錯移轉設定</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp76492728">17.14.3. 疑難排解</a></span></dt><dd><dl><dt><span class="sect3"><a href="#disks-hast-sb">17.14.3.1. 自 Split-brain 情況復原</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="#geom">18. GEOM: 模組化磁碟轉換框架</a></span></dt><dd><dl><dt><span class="sect1"><a href="#geom-synopsis">18.1. 概述</a></span></dt><dt><span class="sect1"><a href="#geom-striping">18.2. RAID0 - 串連 (Striping)</a></span></dt><dt><span class="sect1"><a href="#geom-mirror">18.3. RAID1 - 鏡像 (Mirroring)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#geom-mirror-metadata">18.3.1. Metadata 問題</a></span></dt><dt><span class="sect2"><a href="#geom-mirror-two-new-disks">18.3.2. 使用兩個新磁碟建立鏡像</a></span></dt><dt><span class="sect2"><a href="#geom-mirror-existing-drive">18.3.3. 使用既有磁碟建立鏡像</a></span></dt><dt><span class="sect2"><a href="#gmirror-troubleshooting">18.3.4. 疑難排解</a></span></dt><dt><span class="sect2"><a href="#idp76872888">18.3.5. 自磁碟故障復原</a></span></dt></dl></dd><dt><span class="sect1"><a href="#geom-raid3">18.4. <acronym class="acronym">RAID</acronym>3 - 位元級串連與獨立奇偶校驗</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp76924600">18.4.1. 建立 Dedicated <acronym class="acronym">RAID</acronym>3 陣列</a></span></dt></dl></dd><dt><span class="sect1"><a href="#geom-graid">18.5. 軟體 <acronym class="acronym">RAID</acronym> 裝置</a></span></dt><dd><dl><dt><span class="sect2"><a href="#geom-graid-creating">18.5.1. 建立陣列</a></span></dt><dt><span class="sect2"><a href="#geom-graid-volumes">18.5.2. 多磁碟區</a></span></dt><dt><span class="sect2"><a href="#geom-graid-converting">18.5.3. 轉換單一磁碟為鏡像</a></span></dt><dt><span class="sect2"><a href="#geom-graid-inserting">18.5.4. 插入新磁碟到陣列</a></span></dt><dt><span class="sect2"><a href="#geom-graid-removing">18.5.5. 從陣列移除磁碟</a></span></dt><dt><span class="sect2"><a href="#geom-graid-stopping">18.5.6. 停止陣列</a></span></dt><dt><span class="sect2"><a href="#geom-graid-status">18.5.7. 檢查陣列狀態</a></span></dt><dt><span class="sect2"><a href="#geom-graid-deleting">18.5.8. 刪除陣列</a></span></dt><dt><span class="sect2"><a href="#geom-graid-unexpected">18.5.9. 刪除預期之外的陣列</a></span></dt></dl></dd><dt><span class="sect1"><a href="#geom-ggate">18.6. <acronym class="acronym">GEOM</acronym> Gate Network</a></span></dt><dt><span class="sect1"><a href="#geom-glabel">18.7. 磁碟裝置標籤</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp77152056">18.7.1. 標籤類型與範例</a></span></dt></dl></dd><dt><span class="sect1"><a href="#geom-gjournal">18.8. UFS Journaling 透過 <acronym class="acronym">GEOM</acronym></a></span></dt></dl></dd><dt><span class="chapter"><a href="#zfs">19. Z 檔案系統 (<acronym class="acronym">ZFS</acronym>)</a></span></dt><dd><dl><dt><span class="sect1"><a href="#zfs-differences">19.1. 什麼使 <acronym class="acronym">ZFS</acronym> 與眾不同</a></span></dt><dt><span class="sect1"><a href="#zfs-quickstart">19.2. 快速入門指南</a></span></dt><dd><dl><dt><span class="sect2"><a href="#zfs-quickstart-single-disk-pool">19.2.1. 單磁碟儲存池</a></span></dt><dt><span class="sect2"><a href="#zfs-quickstart-raid-z">19.2.2. RAID-Z</a></span></dt><dt><span class="sect2"><a href="#zfs-quickstart-recovering-raid-z">19.2.3. 復原 <acronym class="acronym">RAID-Z</acronym></a></span></dt><dt><span class="sect2"><a href="#zfs-quickstart-data-verification">19.2.4. 資料檢驗</a></span></dt></dl></dd><dt><span class="sect1"><a href="#zfs-zpool">19.3. <code class="command">zpool</code> 管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#zfs-zpool-create">19.3.1. 建立與摧毀儲存池</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-attach">19.3.2. 加入與移除裝置</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-status">19.3.3. 檢查儲存池狀態</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-clear">19.3.4. 清除錯誤</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-replace">19.3.5. 更換運作中的裝置</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-resilver">19.3.6. 處理故障裝置</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-scrub">19.3.7. 清潔儲存池</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-selfheal">19.3.8. 自我修復</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-online">19.3.9. 擴增儲存池</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-import">19.3.10. 匯入與匯出儲存池</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-upgrade">19.3.11. 升級儲存儲存池</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-history">19.3.12. 顯示已記錄的儲存池歷史日誌</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-iostat">19.3.13. 監視效能</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-split">19.3.14. 分割儲存儲存池</a></span></dt></dl></dd><dt><span class="sect1"><a href="#zfs-zfs">19.4. <code class="command">zfs</code> 管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#zfs-zfs-create">19.4.1. 建立與摧毀資料集</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-volume">19.4.2. 建立與摧毀磁碟區</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-rename">19.4.3. 重新命名資料集</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-set">19.4.4. 設定資料集屬性</a></span></dt><dd><dl><dt><span class="sect3"><a href="#zfs-zfs-set-share">19.4.4.1. 取得與設定共享屬性</a></span></dt></dl></dd><dt><span class="sect2"><a href="#zfs-zfs-snapshot">19.4.5. 管理快照 (Snapshot)</a></span></dt><dd><dl><dt><span class="sect3"><a href="#zfs-zfs-snapshot-creation">19.4.5.1. 建立快照</a></span></dt><dt><span class="sect3"><a href="#zfs-zfs-snapshot-diff">19.4.5.2. 比對快照</a></span></dt><dt><span class="sect3"><a href="#zfs-zfs-snapshot-rollback">19.4.5.3. 使用快照還原</a></span></dt><dt><span class="sect3"><a href="#zfs-zfs-snapshot-snapdir">19.4.5.4. 從快照還原個別檔案</a></span></dt></dl></dd><dt><span class="sect2"><a href="#zfs-zfs-clones">19.4.6. 管理複本 (Clone)</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-send">19.4.7. 備份 (Replication)</a></span></dt><dd><dl><dt><span class="sect3"><a href="#zfs-send-incremental">19.4.7.1. 漸進式備份</a></span></dt><dt><span class="sect3"><a href="#zfs-send-ssh">19.4.7.2. 透過 <span class="application">SSH</span> 傳送加密的備份</a></span></dt></dl></dd><dt><span class="sect2"><a href="#zfs-zfs-quota">19.4.8. 資料集、使用者以及群組配額</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-reservation">19.4.9. 保留空間</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-compression">19.4.10. 壓縮 (Compression)</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-deduplication">19.4.11. 去重複 (Deduplication)</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-jail">19.4.12. <acronym class="acronym">ZFS</acronym> 與 Jail</a></span></dt></dl></dd><dt><span class="sect1"><a href="#zfs-zfs-allow">19.5. 委託管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#zfs-zfs-allow-create">19.5.1. 委託資料集建立</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-allow-allow">19.5.2. 委託權限委託</a></span></dt></dl></dd><dt><span class="sect1"><a href="#zfs-advanced">19.6. 進階主題</a></span></dt><dd><dl><dt><span class="sect2"><a href="#zfs-advanced-tuning">19.6.1. 調校</a></span></dt><dt><span class="sect2"><a href="#zfs-advanced-i386">19.6.2. i386 上的 <acronym class="acronym">ZFS</acronym></a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp78541624">19.6.2.1. 記憶體</a></span></dt><dt><span class="sect3"><a href="#idp78544312">19.6.2.2. 核心設定</a></span></dt><dt><span class="sect3"><a href="#idp78548664">19.6.2.3. 載入程式可調參數</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#zfs-links">19.7. 其他資源</a></span></dt><dt><span class="sect1"><a href="#zfs-term">19.8. <acronym class="acronym">ZFS</acronym> 特色與術語</a></span></dt></dl></dd><dt><span class="chapter"><a href="#filesystems">20. 其他檔案系統</a></span></dt><dd><dl><dt><span class="sect1"><a href="#filesystems-synopsis">20.1. 概述</a></span></dt><dt><span class="sect1"><a href="#filesystems-linux">20.2. <span class="trademark">Linux</span>® 檔案系統</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp78880440">20.2.1. <acronym class="acronym">ext2</acronym></a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#virtualization">21. 虛擬化</a></span></dt><dd><dl><dt><span class="sect1"><a href="#virtualization-synopsis">21.1. 概述</a></span></dt><dt><span class="sect1"><a href="#virtualization-guest-parallels">21.2. 在 <span class="trademark">Mac OS</span>® X 的 <span class="application">Parallels</span> 安裝 FreeBSD 為客端</a></span></dt><dd><dl><dt><span class="sect2"><a href="#virtualization-guest-parallels-install">21.2.1. 在 Parallels/<span class="trademark">Mac OS</span>® X 安裝 FreeBSD</a></span></dt><dt><span class="sect2"><a href="#virtualization-guest-parallels-configure">21.2.2. 在 <span class="application">Parallels</span> 設定 FreeBSD</a></span></dt></dl></dd><dt><span class="sect1"><a href="#virtualization-guest-virtualpc">21.3. 在 <span class="trademark">Windows</span>® 的 <span class="application">Virtual PC</span> 安裝 FreeBSD 為客端</a></span></dt><dd><dl><dt><span class="sect2"><a href="#virtualization-guest-virtualpc-install">21.3.1. 在 <span class="application">Virtual PC</span> 安裝 FreeBSD</a></span></dt><dt><span class="sect2"><a href="#virtualization-guest-virtualpc-configure">21.3.2. 在 <span class="application">Virtual PC</span> 設定 FreeBSD</a></span></dt></dl></dd><dt><span class="sect1"><a href="#virtualization-guest-vmware">21.4. 在 <span class="trademark">Mac OS</span>® 的 <span class="application">VMware Fusion</span> 安裝 FreeBSD 為客端</a></span></dt><dd><dl><dt><span class="sect2"><a href="#virtualization-guest-vmware-install">21.4.1. 在 <span class="application">VMware Fusion</span> 安裝 FreeBSD</a></span></dt><dt><span class="sect2"><a href="#virtualization-guest-vmware-configure">21.4.2. 在 <span class="application">VMware Fusion</span> 設定 FreeBSD</a></span></dt></dl></dd><dt><span class="sect1"><a href="#virtualization-guest-virtualbox">21.5. 在 <span class="trademark">VirtualBox</span>™ 安裝 FreeBSD 作為客端</a></span></dt><dt><span class="sect1"><a href="#virtualization-host-virtualbox">21.6. 以 FreeBSD 作為主端使用 <span class="trademark">VirtualBox</span>™</a></span></dt><dd><dl><dt><span class="sect2"><a href="#virtualization-virtualbox-install">21.6.1. 安裝 <span class="trademark">VirtualBox</span>™</a></span></dt><dt><span class="sect2"><a href="#virtualization-virtualbox-usb-support">21.6.2. <span class="trademark">VirtualBox</span>™ USB 支援</a></span></dt><dt><span class="sect2"><a href="#virtualization-virtualbox-host-dvd-cd-access">21.6.3. <span class="trademark">VirtualBox</span>™ Host <acronym class="acronym">DVD</acronym>/<acronym class="acronym">CD</acronym> 存取</a></span></dt></dl></dd><dt><span class="sect1"><a href="#virtualization-host-bhyve">21.7. 以 FreeBSD 作為主端安裝 <span class="application">bhyve</span></a></span></dt><dd><dl><dt><span class="sect2"><a href="#virtualization-bhyve-prep">21.7.1. 準備主端</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-freebsd">21.7.2. 建立 FreeBSD 客端</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-linux">21.7.3. 建立 <span class="trademark">Linux</span>® 客端</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-uefi">21.7.4. 使用 <acronym class="acronym">UEFI</acronym> 韌體開機 <span class="application">bhyve</span> 虛擬機器</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-framebuffer">21.7.5. 供 <span class="application">bhyve</span> 客端用的圖型化 <acronym class="acronym">UEFI</acronym> Framebuffer</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-zfs">21.7.6. 在 <span class="application">bhyve</span> 客端使用 <acronym class="acronym">ZFS</acronym></a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-nmdm">21.7.7. 虛擬機器 Console</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-managing">21.7.8. 管理虛擬機器</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-onboot">21.7.9. Persistent 設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#virtualization-host-xen">21.8. 以 FreeBSD 作為主端安裝 <span class="trademark">Xen</span>™</a></span></dt><dd><dl><dt><span class="sect2"><a href="#virtualization-host-xen-requirements">21.8.1. <span class="trademark">Xen</span>™ Dom0 的硬體需求</a></span></dt><dt><span class="sect2"><a href="#virtualization-host-xen-dom0-setup">21.8.2. <span class="trademark">Xen</span>™ Dom0 控制領域安裝</a></span></dt><dt><span class="sect2"><a href="#virtualization-host-xen-domu-setup">21.8.3. <span class="trademark">Xen</span>™ DomU 客端 VM 設置</a></span></dt><dt><span class="sect2"><a href="#virtualization-host-xen-troubleshooting">21.8.4. 疑難排解</a></span></dt><dd><dl><dt><span class="sect3"><a href="#virtualization-host-xen-troubleshooting-host">21.8.4.1. 主端開機疑難排解</a></span></dt><dt><span class="sect3"><a href="#virtualization-host-xen-troubleshooting-guest">21.8.4.2. 客端建立疑難排解</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="#l10n">22. 在地化 - <acronym class="acronym">i18n</acronym>/<acronym class="acronym">L10n</acronym> 使用與安裝</a></span></dt><dd><dl><dt><span class="sect1"><a href="#l10n-synopsis">22.1. 概述</a></span></dt><dt><span class="sect1"><a href="#using-localization">22.2. 使用語系</a></span></dt><dd><dl><dt><span class="sect2"><a href="#setting-locale">22.2.1. 設定登入 Shell 的語系</a></span></dt><dd><dl><dt><span class="sect3"><a href="#login-class">22.2.1.1. 登入類別 (Login Class) 法</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idp79884344">22.2.1.1.1. 變更登入類別的工具</a></span></dt></dl></dd><dt><span class="sect3"><a href="#startup-file">22.2.1.2. Shell 啟動檔 (Startup File) 法</a></span></dt></dl></dd><dt><span class="sect2"><a href="#setting-console">22.2.2. Console 設定</a></span></dt><dt><span class="sect2"><a href="#idp80000184">22.2.3. Xorg 設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#l10n-compiling">22.3. 尋找 <acronym class="acronym">i18n</acronym> 應用程式</a></span></dt><dt><span class="sect1"><a href="#lang-setup">22.4. 特定語言的語系設定</a></span></dt><dd><dl><dt><span class="sect2"><a href="#ru-localize">22.4.1. 俄語 (KOI8-R 編碼)</a></span></dt><dt><span class="sect2"><a href="#idp80136632">22.4.2. 其他特定語言資源</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#updating-upgrading">23. 更新與升級 FreeBSD</a></span></dt><dd><dl><dt><span class="sect1"><a href="#updating-upgrading-synopsis">23.1. 概述</a></span></dt><dt><span class="sect1"><a href="#updating-upgrading-freebsdupdate">23.2. FreeBSD 更新</a></span></dt><dd><dl><dt><span class="sect2"><a href="#freebsdupdate-config-file">23.2.1. 設定檔</a></span></dt><dt><span class="sect2"><a href="#freebsdupdate-security-patches">23.2.2. 套用安全性修補</a></span></dt><dt><span class="sect2"><a href="#freebsdupdate-upgrade">23.2.3. 執行主要及次要版號升級</a></span></dt><dd><dl><dt><span class="sect3"><a href="#freebsd-update-custom-kernel-9x">23.2.3.1. 在 FreeBSD 9.X 及之後版本自訂核心</a></span></dt><dt><span class="sect3"><a href="#freebsdupdate-portsrebuild">23.2.3.2. 主要版號升級後的套件升級</a></span></dt></dl></dd><dt><span class="sect2"><a href="#freebsdupdate-system-comparison">23.2.4. 比對系統狀態</a></span></dt></dl></dd><dt><span class="sect1"><a href="#updating-upgrading-documentation">23.3. 更新文件集</a></span></dt><dd><dl><dt><span class="sect2"><a href="#updating-installed-documentation">23.3.1. 自原始碼更新說明文件</a></span></dt><dt><span class="sect2"><a href="#doc-ports-install-package">23.3.2. 自 Port 更新說明文件</a></span></dt></dl></dd><dt><span class="sect1"><a href="#current-stable">23.4. 追蹤開發分支</a></span></dt><dd><dl><dt><span class="sect2"><a href="#current">23.4.1. 使用 FreeBSD-CURRENT</a></span></dt><dt><span class="sect2"><a href="#stable">23.4.2. 使用 FreeBSD-STABLE</a></span></dt></dl></dd><dt><span class="sect1"><a href="#makeworld">23.5. 從原始碼更新 FreeBSD</a></span></dt><dd><dl><dt><span class="sect2"><a href="#updating-src-quick-start">23.5.1. 快速開始</a></span></dt><dt><span class="sect2"><a href="#updating-src-preparing">23.5.2. 準備原始碼更新</a></span></dt><dt><span class="sect2"><a href="#updating-src-obtaining-src">23.5.3. 更新原始碼</a></span></dt><dt><span class="sect2"><a href="#updating-src-building">23.5.4. 從原始碼編譯</a></span></dt><dd><dl><dt><span class="sect3"><a href="#updating-src-building-clean-build">23.5.4.1. 執行清除編譯</a></span></dt><dt><span class="sect3"><a href="#updating-src-building-jobs">23.5.4.2. 設定工作數量</a></span></dt><dt><span class="sect3"><a href="#updating-src-building-only-kernel">23.5.4.3. 只編譯核心</a></span></dt><dt><span class="sect3"><a href="#updating-src-building-custom-kernel">23.5.4.4. 編譯自訂核心</a></span></dt></dl></dd><dt><span class="sect2"><a href="#updating-src-installing">23.5.5. 安裝編譯好的程式</a></span></dt><dt><span class="sect2"><a href="#updating-src-completing">23.5.6. 完成更新</a></span></dt><dd><dl><dt><span class="sect3"><a href="#updating-src-completing-merge-mergemaster">23.5.6.1. 使用 mergemaster(8) 合併設定檔案</a></span></dt><dt><span class="sect3"><a href="#updating-src-completing-check-old">23.5.6.2. 檢查過時的檔案與程式庫</a></span></dt><dt><span class="sect3"><a href="#updating-src-completing-restart">23.5.6.3. 更新後重新啟動</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#small-lan">23.6. 多部機器追蹤</a></span></dt></dl></dd><dt><span class="chapter"><a href="#dtrace">24. DTrace</a></span></dt><dd><dl><dt><span class="sect1"><a href="#dtrace-synopsis">24.1. 概述</a></span></dt><dt><span class="sect1"><a href="#dtrace-implementation">24.2. 實作差異</a></span></dt><dt><span class="sect1"><a href="#dtrace-enable">24.3. 開啟 DTrace 支援</a></span></dt><dt><span class="sect1"><a href="#dtrace-using">24.4. 使用 DTrace</a></span></dt></dl></dd><dt><span class="chapter"><a href="#usb-device-mode">25. USB Device Mode / USB OTG</a></span></dt><dd><dl><dt><span class="sect1"><a href="#usb-device-mode-synopsis">25.1. 概述</a></span></dt><dt><span class="sect1"><a href="#usb-device-mode-terminals">25.2. <acronym class="acronym">USB</acronym> 虛擬序列埠</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp80971576">25.2.1. 設定 USB 裝置模式序列埠</a></span></dt><dt><span class="sect2"><a href="#idp80983224">25.2.2. 自 FreeBSD 連線到 USB 裝置模式序列埠</a></span></dt><dt><span class="sect2"><a href="#idp80986424">25.2.3. 自 macOS 連線到 USB 裝置模式序列埠</a></span></dt><dt><span class="sect2"><a href="#idp80992824">25.2.4. 自 Linux 連線到 USB 裝置模式序列埠</a></span></dt><dt><span class="sect2"><a href="#idp80995128">25.2.5. 自 Microsoft Windows 10 連線到 USB 裝置模式序列埠</a></span></dt></dl></dd><dt><span class="sect1"><a href="#usb-device-mode-network">25.3. <acronym class="acronym">USB</acronym> 裝置模式網路介面</a></span></dt><dt><span class="sect1"><a href="#usb-device-mode-storage">25.4. <acronym class="acronym">USB</acronym> 虛擬儲存裝置</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp81016120">25.4.1. 使用 cfumass 啟動 Script 設定 USB 大容量儲存目標</a></span></dt><dt><span class="sect2"><a href="#idp81037880">25.4.2. 使用其他方式設定 USB 大容量存儲目標</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="part"><a href="#network-communication">IV. 網路通訊</a></span></dt><dd><dl><dt><span class="chapter"><a href="#serialcomms">26. 序列通訊</a></span></dt><dd><dl><dt><span class="sect1"><a href="#serial-synopsis">26.1. 概述</a></span></dt><dt><span class="sect1"><a href="#serial">26.2. 序列術語與硬體</a></span></dt><dd><dl><dt><span class="sect2"><a href="#term-cables-null">26.2.1. 序列線與埠</a></span></dt><dt><span class="sect2"><a href="#serial-hw-config">26.2.2. 序列埠設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#term">26.3. 終端機</a></span></dt><dd><dl><dt><span class="sect2"><a href="#term-config">26.3.1. 終端機設定</a></span></dt><dt><span class="sect2"><a href="#term-debug">26.3.2. 連線疑難排解</a></span></dt></dl></dd><dt><span class="sect1"><a href="#dialup">26.4. 撥入服務</a></span></dt><dd><dl><dt><span class="sect2"><a href="#dialup-ttys">26.4.1. 數據機設定</a></span></dt><dt><span class="sect2"><a href="#idp81703992">26.4.2. 疑難排解</a></span></dt></dl></dd><dt><span class="sect1"><a href="#dialout">26.5. 撥出服務</a></span></dt><dd><dl><dt><span class="sect2"><a href="#hayes-unsupported">26.5.1. 使用 Stock Hayes 數據機</a></span></dt><dt><span class="sect2"><a href="#direct-at">26.5.2. 使用 <code class="literal">AT</code> 指令</a></span></dt><dt><span class="sect2"><a href="#gt-failure">26.5.3. <code class="literal">@</code> 符號無法運作</a></span></dt><dt><span class="sect2"><a href="#dial-command-line">26.5.4. 從指令列撥號</a></span></dt><dt><span class="sect2"><a href="#set-bps">26.5.5. 設定 <acronym class="acronym">bps</acronym> 率</a></span></dt><dt><span class="sect2"><a href="#terminal-server">26.5.6. 透過終端伺服器存取多個主機</a></span></dt><dt><span class="sect2"><a href="#tip-multiline">26.5.7. 在 <code class="command">tip</code> 使用超過一行</a></span></dt><dt><span class="sect2"><a href="#multi-controlp">26.5.8. 使用強制字元</a></span></dt><dt><span class="sect2"><a href="#uppercase">26.5.9. 大寫字元</a></span></dt><dt><span class="sect2"><a href="#tip-filetransfer">26.5.10. 使用 <code class="command">tip</code> 傳輸檔案</a></span></dt><dt><span class="sect2"><a href="#zmodem-tip">26.5.11. 在 <span class="application">zmodem</span> 使用 <code class="command">tip</code>?</a></span></dt></dl></dd><dt><span class="sect1"><a href="#serialconsole-setup">26.6. 設定序列 Console</a></span></dt><dd><dl><dt><span class="sect2"><a href="#serialconsole-howto-fast">26.6.1. 快速序列 Console 設定</a></span></dt><dt><span class="sect2"><a href="#serialconsole-howto">26.6.2. 深入序列 Console 設定</a></span></dt><dt><span class="sect2"><a href="#idp82032696">26.6.3. 設定使用更快的序列埠速度</a></span></dt><dt><span class="sect2"><a href="#serialconsole-ddb">26.6.4. 從序列線路 (Serial Line) 進入 DDB 除錯程式</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ppp-and-slip">27. <acronym class="acronym">PPP</acronym></a></span></dt><dd><dl><dt><span class="sect1"><a href="#ppp-and-slip-synopsis">27.1. 概述</a></span></dt><dt><span class="sect1"><a href="#userppp">27.2. 設定 <acronym class="acronym">PPP</acronym></a></span></dt><dd><dl><dt><span class="sect2"><a href="#userppp-staticIP">27.2.1. 基礎設定</a></span></dt><dt><span class="sect2"><a href="#idp82200248">27.2.2. 進階設定</a></span></dt><dd><dl><dt><span class="sect3"><a href="#userppp-PAPnCHAP">27.2.2.1. PAP 與 CHAP 認證</a></span></dt><dt><span class="sect3"><a href="#userppp-nat">27.2.2.2. 使用 <acronym class="acronym">PPP</acronym> 網路位址轉譯功能</a></span></dt></dl></dd><dt><span class="sect2"><a href="#userppp-final">27.2.3. 最終系統設定</a></span></dt><dt><span class="sect2"><a href="#idp82282808">27.2.4. 使用 <code class="command">ppp</code></a></span></dt><dt><span class="sect2"><a href="#userppp-mgetty">27.2.5. 設定撥入服務</a></span></dt></dl></dd><dt><span class="sect1"><a href="#ppp-troubleshoot">27.3. <acronym class="acronym">PPP</acronym> 連線疑難排解</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp82359736">27.3.1. 檢查裝置節點</a></span></dt><dt><span class="sect2"><a href="#idp82387256">27.3.2. 手動連線</a></span></dt><dt><span class="sect2"><a href="#idp82444856">27.3.3. 除錯</a></span></dt></dl></dd><dt><span class="sect1"><a href="#pppoe">27.4. 在乙太網路使用 <acronym class="acronym">PPP</acronym> (PPPoE)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp82493624">27.4.1. 使用 PPPoE 服務標籤</a></span></dt><dt><span class="sect2"><a href="#ppp-3com">27.4.2. 在 <span class="trademark">3Com</span>® <span class="trademark">HomeConnect</span>® ADSL Modem Dual Link 使用 PPPoE</a></span></dt></dl></dd><dt><span class="sect1"><a href="#pppoa">27.5. 在 ATM 使用 <span class="application">PPP</span> (PPPoA)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp82532408">27.5.1. 使用 mpd</a></span></dt><dt><span class="sect2"><a href="#idp82577720">27.5.2. 使用 pptpclient</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#mail">28. 電子郵件</a></span></dt><dd><dl><dt><span class="sect1"><a href="#mail-synopsis">28.1. 概述</a></span></dt><dt><span class="sect1"><a href="#mail-using">28.2. 郵件組成</a></span></dt><dt><span class="sect1"><a href="#sendmail">28.3. <span class="application">Sendmail</span> 設定檔</a></span></dt><dt><span class="sect1"><a href="#mail-changingmta">28.4. 更改郵件傳輸代理程式</a></span></dt><dd><dl><dt><span class="sect2"><a href="#mail-disable-sendmail">28.4.1. 關閉 <span class="application">Sendmail</span></a></span></dt><dt><span class="sect2"><a href="#idp82840376">28.4.2. 替換預設的 <acronym class="acronym">MTA</acronym></a></span></dt></dl></dd><dt><span class="sect1"><a href="#mail-trouble">28.5. 疑難排解</a></span></dt><dt><span class="sect1"><a href="#mail-advanced">28.6. 進階主題</a></span></dt><dd><dl><dt><span class="sect2"><a href="#mail-config">28.6.1. 基礎設定</a></span></dt><dt><span class="sect2"><a href="#mail-domain">28.6.2. 網域中的郵件</a></span></dt></dl></dd><dt><span class="sect1"><a href="#outgoing-only">28.7. 寄件設定</a></span></dt><dt><span class="sect1"><a href="#SMTP-dialup">28.8. 在撥號連線使用郵件</a></span></dt><dt><span class="sect1"><a href="#SMTP-Auth">28.9. SMTP 認證</a></span></dt><dt><span class="sect1"><a href="#mail-agents">28.10. 郵件使用者代理程式</a></span></dt><dd><dl><dt><span class="sect2"><a href="#mail-command">28.10.1. <code class="command">mail</code></a></span></dt><dt><span class="sect2"><a href="#mutt-command">28.10.2. <span class="application">mutt</span></a></span></dt><dt><span class="sect2"><a href="#alpine-command">28.10.3. <span class="application">alpine</span></a></span></dt></dl></dd><dt><span class="sect1"><a href="#mail-fetchmail">28.11. 使用 <span class="application">fetchmail</span></a></span></dt><dt><span class="sect1"><a href="#mail-procmail">28.12. 使用 <span class="application">procmail</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#network-servers">29. 網路伺服器</a></span></dt><dd><dl><dt><span class="sect1"><a href="#network-servers-synopsis">29.1. 概述</a></span></dt><dt><span class="sect1"><a href="#network-inetd">29.2. <span class="application">inetd</span> 超級伺服器</a></span></dt><dd><dl><dt><span class="sect2"><a href="#network-inetd-conf">29.2.1. 設定檔</a></span></dt><dt><span class="sect2"><a href="#network-inetd-cmdline">29.2.2. 指令列選項</a></span></dt><dt><span class="sect2"><a href="#network-inetd-security">29.2.3. 安全注意事項</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-nfs">29.3. 網路檔案系統 (NFS)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#network-configuring-nfs">29.3.1. 設定伺服器</a></span></dt><dt><span class="sect2"><a href="#idp83702456">29.3.2. 設定客戶端</a></span></dt><dt><span class="sect2"><a href="#idp83728824">29.3.3. 鎖定</a></span></dt><dt><span class="sect2"><a href="#network-amd">29.3.4. 使用 amd(8) 自動掛載</a></span></dt><dt><span class="sect2"><a href="#network-autofs">29.3.5. 使用 autofs(5) 自動掛載</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-nis">29.4. 網路資訊系統 (<acronym class="acronym">NIS</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp83887672">29.4.1. <acronym class="acronym">NIS</acronym> 術語與程序</a></span></dt><dt><span class="sect2"><a href="#idp83921080">29.4.2. 主機類型</a></span></dt><dt><span class="sect2"><a href="#idp83955640">29.4.3. 規劃注意事項</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp83975608">29.4.3.1. 選擇 <acronym class="acronym">NIS</acronym> 網域名稱</a></span></dt><dt><span class="sect3"><a href="#idp83999928">29.4.3.2. 實體伺服器需求</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp84004152">29.4.4. 設定 <acronym class="acronym">NIS</acronym> Master 伺服器</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp84030904">29.4.4.1. 初始化 <acronym class="acronym">NIS</acronym> 對應表</a></span></dt><dt><span class="sect3"><a href="#idp84066616">29.4.4.2. 新增使用者</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp84086200">29.4.5. 設定 <acronym class="acronym">NIS</acronym> Slave 伺服器</a></span></dt><dt><span class="sect2"><a href="#idp84109752">29.4.6. 設定 <acronym class="acronym">NIS</acronym> 客戶端</a></span></dt><dt><span class="sect2"><a href="#idp84135992">29.4.7. <acronym class="acronym">NIS</acronym> 安全性</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp84167480">29.4.7.1. 阻擋部份使用者</a></span></dt></dl></dd><dt><span class="sect2"><a href="#network-netgroups">29.4.8. 使用 Netgroups</a></span></dt><dt><span class="sect2"><a href="#idp84315448">29.4.9. 密碼格式</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-ldap">29.5. 輕量級目錄存取協定 (<acronym class="acronym">LDAP</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp84339512">29.5.1. <acronym class="acronym">LDAP</acronym> 術語與結構</a></span></dt><dt><span class="sect2"><a href="#ldap-config">29.5.2. 設定 <acronym class="acronym">LDAP</acronym> 伺服器</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-dhcp">29.6. 動態主機設置協定 (<acronym class="acronym">DHCP</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp84500408">29.6.1. 設定 <acronym class="acronym">DHCP</acronym> 客戶端</a></span></dt><dt><span class="sect2"><a href="#network-dhcp-server">29.6.2. 安裝並設定 <acronym class="acronym">DHCP</acronym> 伺服器</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-dns">29.7. 網域名稱系統 (<acronym class="acronym">DNS</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp84649144">29.7.1. 要架設名稱伺服器的原因</a></span></dt><dt><span class="sect2"><a href="#idp84689336">29.7.2. <acronym class="acronym">DNS</acronym> 伺服器設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-apache">29.8. Apache HTTP 伺服器</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp84719672">29.8.1. 設定並啟動 Apache</a></span></dt><dt><span class="sect2"><a href="#idp84790072">29.8.2. 虛擬主機</a></span></dt><dt><span class="sect2"><a href="#idp84804792">29.8.3. Apache 模組</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp84809272">29.8.3.1. <code class="filename">mod_ssl</code></a></span></dt><dt><span class="sect3"><a href="#idp84815928">29.8.3.2. <code class="filename">mod_perl</code></a></span></dt><dt><span class="sect3"><a href="#idp84837944">29.8.3.3. <code class="filename">mod_php</code></a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp84876856">29.8.4. 動態網站</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp84880696">29.8.4.1. Django</a></span></dt><dt><span class="sect3"><a href="#idp84894904">29.8.4.2. Ruby on Rails</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#network-ftp">29.9. 檔案傳輸協定 (<acronym class="acronym">FTP</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp84905144">29.9.1. 設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-samba">29.10. <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 用戶端檔案與列印服務 (Samba)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp84980024">29.10.1. 伺服器設定</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp84997304">29.10.1.1. 全域設定</a></span></dt><dt><span class="sect3"><a href="#idp85025080">29.10.1.2. 安全性設定</a></span></dt><dt><span class="sect3"><a href="#idp85035448">29.10.1.3. <span class="application">Samba</span> 使用者</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp85044920">29.10.2. 啟動 <span class="application">Samba</span></a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-ntp">29.11. NTP 時間校對</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp85065656">29.11.1. <acronym class="acronym">NTP</acronym> 設定</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp85070136">29.11.1.1. <code class="filename">/etc/ntp.conf</code> 檔</a></span></dt><dt><span class="sect3"><a href="#idp85106488">29.11.1.2. 在 <code class="filename">/etc/rc.conf</code> 中的 NTP 設定項目</a></span></dt><dt><span class="sect3"><a href="#idp85130424">29.11.1.3. <span class="application">Ntpd</span> 與無權限的 <code class="literal">ntpd</code> 使用者</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp85163832">29.11.2. 在 <acronym class="acronym">PPP</acronym> 連線使用 <acronym class="acronym">NTP</acronym></a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-iscsi">29.12. <acronym class="acronym">iSCSI</acronym> Initiator 與 Target 設定</a></span></dt><dd><dl><dt><span class="sect2"><a href="#network-iscsi-target">29.12.1. 設定 <acronym class="acronym">iSCSI</acronym> Target</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp85232952">29.12.1.1. 認證</a></span></dt></dl></dd><dt><span class="sect2"><a href="#network-iscsi-initiator">29.12.2. 設定 <acronym class="acronym">iSCSI</acronym> Initiator</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp85255992">29.12.2.1. 不使用設定檔連線到 Target</a></span></dt><dt><span class="sect3"><a href="#idp84854584">29.12.2.2. 使用設定檔連線到 Target</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="#firewalls">30. 防火牆</a></span></dt><dd><dl><dt><span class="sect1"><a href="#firewalls-intro">30.1. 概述</a></span></dt><dt><span class="sect1"><a href="#firewalls-concepts">30.2. 防火牆概念</a></span></dt><dt><span class="sect1"><a href="#firewalls-pf">30.3. PF</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp85400120">30.3.1. 開啟 <span class="application">PF</span></a></span></dt><dt><span class="sect2"><a href="#pf-tutorial">30.3.2. <span class="application">PF</span> 規則集</a></span></dt><dd><dl><dt><span class="sect3"><a href="#pftut-gateway">30.3.2.1. 使用 NAT 的簡單通訊閘</a></span></dt><dt><span class="sect3"><a href="#pftut-ftp">30.3.2.2. 建立 <acronym class="acronym">FTP</acronym> Proxy</a></span></dt><dt><span class="sect3"><a href="#pftut-icmp">30.3.2.3. 管理 <acronym class="acronym">ICMP</acronym></a></span></dt><dd><dl><dt><span class="sect4"><a href="#pftut-pathmtudisc">30.3.2.3.1. Path <acronym class="acronym">MTU</acronym> Discovery</a></span></dt></dl></dd><dt><span class="sect3"><a href="#pftut-tables">30.3.2.4. 使用 Tables</a></span></dt><dt><span class="sect3"><a href="#pftut-overload">30.3.2.5. 使用 Overload Tables 保護 <acronym class="acronym">SSH</acronym></a></span></dt><dt><span class="sect3"><a href="#pftut-spamd">30.3.2.6. <acronym class="acronym">SPAM</acronym> 防護</a></span></dt><dt><span class="sect3"><a href="#pftut-hygiene">30.3.2.7. 網路保健</a></span></dt><dt><span class="sect3"><a href="#pftut-unrouteables">30.3.2.8. 處理不可路由 (Non-Routable) 的位址</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp85974712">30.3.3. 開啟 <span class="application">ALTQ</span></a></span></dt></dl></dd><dt><span class="sect1"><a href="#firewalls-ipfw">30.4. <span class="application">IPFW</span></a></span></dt><dd><dl><dt><span class="sect2"><a href="#firewalls-ipfw-enable">30.4.1. 開啟 <span class="application">IPFW</span></a></span></dt><dt><span class="sect2"><a href="#firewalls-ipfw-rules">30.4.2. <span class="application">IPFW</span> 規則語法</a></span></dt><dt><span class="sect2"><a href="#idp86162488">30.4.3. 範例規則集</a></span></dt><dt><span class="sect2"><a href="#in-kernel-nat">30.4.4. 核心內 <acronym class="acronym">NAT</acronym></a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp86353464">30.4.4.1. Port 重新導向</a></span></dt><dt><span class="sect3"><a href="#idp86373432">30.4.4.2. 位址重新導向</a></span></dt><dt><span class="sect3"><a href="#idp86405432">30.4.4.3. Userspace <acronym class="acronym">NAT</acronym></a></span></dt></dl></dd><dt><span class="sect2"><a href="#firewalls-ipfw-cmd">30.4.5. <span class="application">IPFW</span> 指令</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp86450872">30.4.5.1. 記錄防火牆訊息</a></span></dt><dt><span class="sect3"><a href="#firewalls-ipfw-rules-script">30.4.5.2. 建立規則 Script</a></span></dt></dl></dd><dt><span class="sect2"><a href="#firewalls-ipfw-kernelconfig">30.4.6. <span class="application">IPFW</span> 核心選項</a></span></dt></dl></dd><dt><span class="sect1"><a href="#firewalls-ipf">30.5. IPFILTER (IPF)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp86558264">30.5.1. 開啟 <span class="application">IPF</span></a></span></dt><dt><span class="sect2"><a href="#idp86596152">30.5.2. <span class="application">IPF</span> 規則語法</a></span></dt><dt><span class="sect2"><a href="#idp86691256">30.5.3. 範例規則集</a></span></dt><dt><span class="sect2"><a href="#idp86740536">30.5.4. 設定 <acronym class="acronym">NAT</acronym></a></span></dt><dt><span class="sect2"><a href="#idp86838968">30.5.5. 檢視 <span class="application">IPF</span> 統計資訊</a></span></dt><dt><span class="sect2"><a href="#idp86533304">30.5.6. <span class="application">IPF</span> 日誌</a></span></dt></dl></dd><dt><span class="sect1"><a href="#firewalls-blacklistd">30.6. Blacklistd</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp86916152">30.6.1. 開啟 Blacklistd</a></span></dt><dt><span class="sect2"><a href="#idp86954680">30.6.2. 建立 Blacklistd 規則集</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp86957368">30.6.2.1. 本地規則</a></span></dt><dt><span class="sect3"><a href="#idp87002040">30.6.2.2. 遠端規則</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp87020088">30.6.3. Blacklistd 客戶端設定</a></span></dt><dt><span class="sect2"><a href="#idp87027768">30.6.4. Blacklistd 管理</a></span></dt><dt><span class="sect2"><a href="#idp87040696">30.6.5. 從封鎖清單移除主機</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#advanced-networking">31. 進階網路設定</a></span></dt><dd><dl><dt><span class="sect1"><a href="#advanced-networking-synopsis">31.1. 概述</a></span></dt><dt><span class="sect1"><a href="#network-routing">31.2. 通訊閘與路由</a></span></dt><dd><dl><dt><span class="sect2"><a href="#network-routing-default">31.2.1. 路由基礎概念</a></span></dt><dt><span class="sect2"><a href="#network-static-routes">31.2.2. 設定路由器使用靜態路由</a></span></dt><dt><span class="sect2"><a href="#network-routing-troubleshooting">31.2.3. 疑難排解</a></span></dt><dt><span class="sect2"><a href="#network-routing-multicast">31.2.4. 群播 (Multicast) 注意事項</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-wireless">31.3. 無線網路</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp87243320">31.3.1. 無線網路基礎</a></span></dt><dt><span class="sect2"><a href="#network-wireless-quick-start">31.3.2. 快速開始</a></span></dt><dt><span class="sect2"><a href="#network-wireless-basic">31.3.3. 基礎設定</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp87286712">31.3.3.1. 核心設定</a></span></dt><dt><span class="sect3"><a href="#idp87329208">31.3.3.2. 設定正確的區域</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp87336632">31.3.4. 主從式 (Infrastructure)</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp87338552">31.3.4.1. FreeBSD 客戶端</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idp87339192">31.3.4.1.1. 如何尋找存取點</a></span></dt><dt><span class="sect4"><a href="#idp87386168">31.3.4.1.2. 基礎設定</a></span></dt><dd><dl><dt><span class="sect5"><a href="#idp87388728">31.3.4.1.2.1. 選擇存取點</a></span></dt><dt><span class="sect5"><a href="#idp87404088">31.3.4.1.2.2. 認證</a></span></dt><dt><span class="sect5"><a href="#idp87419064">31.3.4.1.2.3. 使用 <acronym class="acronym">DHCP</acronym> 取得 <acronym class="acronym">IP</acronym> 位址</a></span></dt><dt><span class="sect5"><a href="#idp87434296">31.3.4.1.2.4. 靜態 <acronym class="acronym">IP</acronym> 位址</a></span></dt></dl></dd><dt><span class="sect4"><a href="#network-wireless-wpa">31.3.4.1.3. <acronym class="acronym">WPA</acronym></a></span></dt><dd><dl><dt><span class="sect5"><a href="#network-wireless-wpa-wpa-psk">31.3.4.1.3.1. <acronym class="acronym">WPA-PSK</acronym></a></span></dt><dt><span class="sect5"><a href="#network-wireless-wpa-eap-tls">31.3.4.1.3.2. <acronym class="acronym">WPA</acronym> 加上 <acronym class="acronym">EAP-TLS</acronym></a></span></dt><dt><span class="sect5"><a href="#network-wireless-wpa-eap-ttls">31.3.4.1.3.3. <acronym class="acronym">WPA</acronym> 加上 <acronym class="acronym">EAP-TTLS</acronym></a></span></dt><dt><span class="sect5"><a href="#network-wireless-wpa-eap-peap">31.3.4.1.3.4. <acronym class="acronym">WPA</acronym> 加上 <acronym class="acronym">EAP-PEAP</acronym></a></span></dt></dl></dd><dt><span class="sect4"><a href="#network-wireless-wep">31.3.4.1.4. <acronym class="acronym">WEP</acronym></a></span></dt></dl></dd></dl></dd><dt><span class="sect2"><a href="#idp87783736">31.3.5. 對等式 (Ad-hoc)</a></span></dt><dt><span class="sect2"><a href="#network-wireless-ap">31.3.6. FreeBSD 主機存取點</a></span></dt><dd><dl><dt><span class="sect3"><a href="#network-wireless-ap-basic">31.3.6.1. 基礎設定</a></span></dt><dt><span class="sect3"><a href="#idp87848120">31.3.6.2. 無認證或加密的 Host-based 存取點</a></span></dt><dt><span class="sect3"><a href="#network-wireless-ap-wpa">31.3.6.3. <acronym class="acronym">WPA2</acronym> Host-based 存取點</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idp87893176">31.3.6.3.1. <acronym class="acronym">WPA2-PSK</acronym></a></span></dt></dl></dd><dt><span class="sect3"><a href="#idp87945912">31.3.6.4. <acronym class="acronym">WEP</acronym> Host-based 存取點</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp87997240">31.3.7. 同時使用有線及無線連線</a></span></dt><dt><span class="sect2"><a href="#idp88000696">31.3.8. 疑難排解</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-usb-tethering">31.4. USB 網路共享</a></span></dt><dt><span class="sect1"><a href="#network-bluetooth">31.5. 藍牙</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp88042936">31.5.1. 載入藍牙支援</a></span></dt><dt><span class="sect2"><a href="#idp88083384">31.5.2. 尋找其他藍牙裝置</a></span></dt><dt><span class="sect2"><a href="#idp88114104">31.5.3. 裝置配對</a></span></dt><dt><span class="sect2"><a href="#idp88148792">31.5.4. 使用 <acronym class="acronym">PPP</acronym> Profile 存取網路</a></span></dt><dt><span class="sect2"><a href="#idp88180920">31.5.5. 藍牙通訊協定</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp88182200">31.5.5.1. Logical Link Control and Adaptation Protocol
	  (<acronym class="acronym">L2CAP</acronym>)</a></span></dt><dt><span class="sect3"><a href="#idp88217400">31.5.5.2. Radio Frequency Communication
	  (<acronym class="acronym">RFCOMM</acronym>)</a></span></dt><dt><span class="sect3"><a href="#idp88236344">31.5.5.3. Service Discovery Protocol
	  (<acronym class="acronym">SDP</acronym>)</a></span></dt><dt><span class="sect3"><a href="#idp88296120">31.5.5.4. <acronym class="acronym">OBEX</acronym> Object Push
	  (<acronym class="acronym">OPUSH</acronym>)</a></span></dt><dt><span class="sect3"><a href="#idp88329528">31.5.5.5. Serial Port Profile (<acronym class="acronym">SPP</acronym>)</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp88339128">31.5.6. 疑難排解</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-bridging">31.6. 橋接</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp88386232">31.6.1. 開啟橋接</a></span></dt><dt><span class="sect2"><a href="#idp88423480">31.6.2. 開啟 Spanning Tree</a></span></dt><dt><span class="sect2"><a href="#idp88441912">31.6.3. 橋接介面參數</a></span></dt><dt><span class="sect2"><a href="#idp88489272">31.6.4. <acronym class="acronym">SNMP</acronym> 監視</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-aggregation">31.7. Link Aggregation 與容錯移轉</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp88574520">31.7.1. 設定範例</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-diskless">31.8. <acronym class="acronym">PXE</acronym> 無磁碟作業</a></span></dt><dd><dl><dt><span class="sect2"><a href="#network-pxe-nfs">31.8.1. 設定 <acronym class="acronym">PXE</acronym> 環境</a></span></dt><dt><span class="sect2"><a href="#network-pxe-setting-up-dhcp">31.8.2. 設定 <acronym class="acronym">DHCP</acronym> 伺服器</a></span></dt><dt><span class="sect2"><a href="#idp88879032">31.8.3. <acronym class="acronym">PXE</acronym> 問題除錯</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-ipv6">31.9. <acronym class="acronym">IPv6</acronym></a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp89022008">31.9.1. <acronym class="acronym">IPv6</acronym> 位址的背景知識</a></span></dt><dt><span class="sect2"><a href="#idp89099448">31.9.2. 設定 <acronym class="acronym">IPv6</acronym></a></span></dt><dt><span class="sect2"><a href="#idp89107896">31.9.3. 連線到 Provider</a></span></dt><dt><span class="sect2"><a href="#idp89142840">31.9.4. Router Advertisement 與 Host Auto Configuration</a></span></dt><dt><span class="sect2"><a href="#idp89166392">31.9.5. <acronym class="acronym">IPv6</acronym> 與 <acronym class="acronym">IPv6</acronym> 位址對應表</a></span></dt></dl></dd><dt><span class="sect1"><a href="#carp">31.10. 共用位址備援協定 (<acronym class="acronym">CARP</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#carp-10x">31.10.1. 使用 <acronym class="acronym">CARP</acronym> 於 FreeBSD 10 及之後版本</a></span></dt><dt><span class="sect2"><a href="#carp-9x">31.10.2. 使用 <acronym class="acronym">CARP</acronym> 於 FreeBSD 9 及先前版本</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-vlan">31.11. VLANs</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#appendices">V. 附錄</a></span></dt><dd><dl><dt><span class="appendix"><a href="#mirrors">A. 取得 FreeBSD</a></span></dt><dd><dl><dt><span class="sect1"><a href="#mirrors-cdrom">A.1. <acronym class="acronym">CD</acronym> 與 <acronym class="acronym">DVD</acronym> 合集</a></span></dt><dt><span class="sect1"><a href="#mirrors-ftp">A.2. <acronym class="acronym">FTP</acronym> 站</a></span></dt><dt><span class="sect1"><a href="#svn">A.3. 使用 <span class="application">Subversion</span></a></span></dt><dd><dl><dt><span class="sect2"><a href="#svn-intro">A.3.1. 簡介</a></span></dt><dt><span class="sect2"><a href="#svn-ssl-certificates">A.3.2. 根 <acronym class="acronym">SSL</acronym> 憑證</a></span></dt><dt><span class="sect2"><a href="#svn-svnlite">A.3.3. <span class="application">Svnlite</span></a></span></dt><dt><span class="sect2"><a href="#svn-install">A.3.4. 安裝</a></span></dt><dt><span class="sect2"><a href="#svn-usage">A.3.5. 執行 <span class="application">Subversion</span></a></span></dt><dt><span class="sect2"><a href="#svn-mirrors">A.3.6. <span class="application">Subversion</span> 鏡像站</a></span></dt><dt><span class="sect2"><a href="#idp89943864">A.3.7. 取得更多資訊</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mirrors-rsync">A.4. 使用 <span class="application">rsync</span></a></span></dt></dl></dd><dt><span class="appendix"><a href="#bibliography">B. 參考書目</a></span></dt><dd><dl><dt><span class="sect1"><a href="#bibliography-freebsd">B.1. FreeBSD 相關書籍</a></span></dt><dt><span class="sect1"><a href="#bibliography-userguides">B.2. 使用指南</a></span></dt><dt><span class="sect1"><a href="#bibliography-adminguides">B.3. 管理指南</a></span></dt><dt><span class="sect1"><a href="#bibliography-programmers">B.4. 開發指南</a></span></dt><dt><span class="sect1"><a href="#bibliography-osinternals">B.5. 深入作業系統</a></span></dt><dt><span class="sect1"><a href="#bibliography-security">B.6. 安全性參考文獻</a></span></dt><dt><span class="sect1"><a href="#bibliography-hardware">B.7. 硬體參考文獻</a></span></dt><dt><span class="sect1"><a href="#bibliography-history">B.8. <span class="trademark">UNIX</span>® 歷史</a></span></dt><dt><span class="sect1"><a href="#bibliography-journals">B.9. 期刊與雜誌</a></span></dt></dl></dd><dt><span class="appendix"><a href="#eresources">C. 網路資源</a></span></dt><dd><dl><dt><span class="sect1"><a href="#eresources-www">C.1. 網站</a></span></dt><dt><span class="sect1"><a href="#eresources-mail">C.2. 郵遞論壇 (Mailing List)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#eresources-summary">C.2.1. 論壇摘要</a></span></dt><dt><span class="sect2"><a href="#eresources-subscribe">C.2.2. 如何訂閱</a></span></dt><dt><span class="sect2"><a href="#eresources-charters">C.2.3. 論壇章程</a></span></dt><dt><span class="sect2"><a href="#eresources-mailfiltering">C.2.4. 郵遞論壇過濾項目</a></span></dt></dl></dd><dt><span class="sect1"><a href="#eresources-news">C.3. Usenet 新聞群組</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp91154232">C.3.1. BSD 專屬新聞群組</a></span></dt><dt><span class="sect2"><a href="#idp91164344">C.3.2. 其他相關的 <span class="trademark">UNIX</span>® 新聞群組</a></span></dt><dt><span class="sect2"><a href="#idp91174072">C.3.3. X 視窗系統</a></span></dt></dl></dd><dt><span class="sect1"><a href="#eresources-web">C.4. 官方鏡像站</a></span></dt></dl></dd><dt><span class="appendix"><a href="#pgpkeys">D. Open<acronym class="acronym">PGP</acronym> 金鑰</a></span></dt><dd><dl><dt><span class="sect1"><a href="#pgpkeys-officers">D.1. 人員</a></span></dt><dd><dl><dt><span class="sect2"><a href="#pgpkey-security-officer">D.1.1. Security Officer Team <code class="email">&lt;<a xmlns="" class="email" href="mailto:security-officer@FreeBSD.org">security-officer@FreeBSD.org</a>&gt;</code></a></span></dt><dt><span class="sect2"><a href="#pgpkey-secteam-secretary">D.1.2. Security Team Secretary <code class="email">&lt;<a xmlns="" class="email" href="mailto:secteam-secretary@FreeBSD.org">secteam-secretary@FreeBSD.org</a>&gt;</code></a></span></dt><dt><span class="sect2"><a href="#pgpkey-core-secretary">D.1.3. Core Team Secretary <code class="email">&lt;<a xmlns="" class="email" href="mailto:core-secretary@FreeBSD.org">core-secretary@FreeBSD.org</a>&gt;</code></a></span></dt><dt><span class="sect2"><a href="#pgpkey-portmgr-secretary">D.1.4. Ports Management Team Secretary <code class="email">&lt;<a xmlns="" class="email" href="mailto:portmgr-secretary@FreeBSD.org">portmgr-secretary@FreeBSD.org</a>&gt;</code></a></span></dt><dt><span class="sect2"><a href="#pgpkey-doceng-secretary">D.1.5. <code class="email">&lt;<a xmlns="" class="email" href="mailto:doceng-secretary@FreeBSD.org">doceng-secretary@FreeBSD.org</a>&gt;</code></a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="glossary"><a href="#freebsd-glossary">FreeBSD 詞彙表</a></span></dt><dt><span class="index"><a href="#idp92327736">索引</a></span></dt></dl></div><div class="list-of-figures"><div class="toc-title">附圖目錄</div><dl><dt>2.1. <a href="#bsdinstall-newboot-loader-menu">FreeBSD 開機載入程式選單</a></dt><dt>2.2. <a href="#bsdinstall-boot-options-menu">FreeBSD 開機選項選單</a></dt><dt>2.3. <a href="#bsdinstall-choose-mode">歡迎選單</a></dt><dt>2.4. <a href="#bsdinstall-keymap-select-default">鍵盤對應表選擇</a></dt><dt>2.5. <a href="#bsdinstall-config-keymap">選擇鍵盤選單</a></dt><dt>2.6. <a href="#bsdinstall-keymap-10">改進後的鍵盤對應表選單</a></dt><dt>2.7. <a href="#bsdinstall-config-hostname">設定主機名稱</a></dt><dt>2.8. <a href="#bsdinstall-config-components">選擇要安裝的元件</a></dt><dt>2.9. <a href="#bsdinstall-netinstall-notify">從網路安裝</a></dt><dt>2.10. <a href="#bsdinstall-netinstall-mirror">選擇鏡像站</a></dt><dt>2.11. <a href="#bsdinstall-zfs-partmenu">FreeBSD 10.x 或更新版本的磁碟分割選項</a></dt><dt>2.12. <a href="#bsdinstall-part-guided-disk">自多個磁碟選擇</a></dt><dt>2.13. <a href="#bsdinstall-part-entire-part">選擇完整磁碟或分割區</a></dt><dt>2.14. <a href="#bsdinstall-part-review">確認已建立的分割區</a></dt><dt>2.15. <a href="#bsdinstall-part-manual-create">手動建立分割區</a></dt><dt>2.16. <a href="#bsdinstall-part-manual-partscheme">手動建立分割區</a></dt><dt>2.17. <a href="#bsdinstall-part-manual-addpart">手動建立分割區</a></dt><dt>2.18. <a href="#bsdinstall-zfs-menu"><acronym class="acronym">ZFS</acronym> 磁碟分割選單</a></dt><dt>2.19. <a href="#bsdinstall-zfs-vdev_type"><acronym class="acronym">ZFS</acronym> 儲存池類型</a></dt><dt>2.20. <a href="#bsdinstall-zfs-disk_select">磁碟選擇</a></dt><dt>2.21. <a href="#bsdinstall-zfs-vdev_invalid">無效的選擇</a></dt><dt>2.22. <a href="#bsdinstall-zfs-disk_info">分析磁碟</a></dt><dt>2.23. <a href="#bsdinstall-zfs-geli_password">磁碟加密密碼</a></dt><dt>2.24. <a href="#bsdinstall-zfs-warning">最後修改</a></dt><dt>2.25. <a href="#bsdinstall-final-confirmation">最後確認</a></dt><dt>2.26. <a href="#bsdinstall-distfile-fetching">取得發行版檔案</a></dt><dt>2.27. <a href="#bsdinstall-distfile-verify">檢驗發行版檔案</a></dt><dt>2.28. <a href="#bsdinstall-distfile-extract">解開發行版檔案</a></dt><dt>2.29. <a href="#bsdinstall-post-set-root-passwd">設定 <code class="systemitem">root</code> 密碼</a></dt><dt>2.30. <a href="#bsdinstall-configure-net-interface">選擇網路介面卡</a></dt><dt>2.31. <a href="#bsdinstall-wireless-scan">掃描無線網路存取點</a></dt><dt>2.32. <a href="#bsdinstall-wireless-accesspoints">選擇無線網路</a></dt><dt>2.33. <a href="#bsdinstall-wireless-wpa2">WPA2 設定</a></dt><dt>2.34. <a href="#bsdinstall-configure-net-ipv4">選擇 <acronym class="acronym">IPv4</acronym> 網路</a></dt><dt>2.35. <a href="#bsdinstall-net-ipv4-dhcp">選擇 <acronym class="acronym">IPv4</acronym> <acronym class="acronym">DHCP</acronym> 設定</a></dt><dt>2.36. <a href="#bsdinstall-net-ipv4-static"><acronym class="acronym">IPv4</acronym> 靜態位置設定</a></dt><dt>2.37. <a href="#bsdinstall-net-ipv6">選擇 IPv6 網路</a></dt><dt>2.38. <a href="#bsdinstall-net-ipv6-slaac">選擇 IPv6 SLAAC 設定</a></dt><dt>2.39. <a href="#bsdinstall-net-ipv6-static">IPv6 靜態位置設定</a></dt><dt>2.40. <a href="#bsdinstall-net-dns-config">DNS 設定</a></dt><dt>2.41. <a href="#bsdinstall-local-utc">選擇本地或 UTC 時鐘</a></dt><dt>2.42. <a href="#bsdinstall-timezone-region">選擇區域</a></dt><dt>2.43. <a href="#bsdinstall-timezone-country">選擇城市</a></dt><dt>2.44. <a href="#bsdinstall-timezone-zone">選擇時區</a></dt><dt>2.45. <a href="#bsdinstall-timezone-confirmation">確認時區</a></dt><dt>2.46. <a href="#bsdinstall-config-serv">選擇要開啟的其他服務</a></dt><dt>2.47. <a href="#bsdinstall-config-crashdump">開啟當機資訊 (Crash Dump)</a></dt><dt>2.48. <a href="#bsdinstall-add-user1">新增使用者帳號</a></dt><dt>2.49. <a href="#bsdinstall-add-user2">輸入使用者資訊</a></dt><dt>2.50. <a href="#bsdinstall-add-user3">離開使用者與群組管理</a></dt><dt>2.51. <a href="#bsdinstall-final-config">最後設定</a></dt><dt>2.52. <a href="#bsdinstall-final-modification-shell">手動設定</a></dt><dt>2.53. <a href="#bsdinstall-final-main">完成安裝</a></dt><dt>31.1. <a href="#idp88937144">使用 <acronym class="acronym">NFS</acronym> Root Mount 進行 <acronym class="acronym">PXE</acronym> 開機程序</a></dt></dl></div><div class="list-of-tables"><div class="toc-title">附表目錄</div><dl><dt>2.1. <a href="#idp63843256">磁碟分割表格式</a></dt><dt>3.1. <a href="#users-modifying-utilities">管理使用者帳號的工具</a></dt><dt>3.2. <a href="#idp64785336"><span class="trademark">UNIX</span>® 權限</a></dt><dt>3.3. <a href="#disks-naming">磁碟裝置名稱</a></dt><dt>3.4. <a href="#shell-env-vars">常用環境變數</a></dt><dt>5.1. <a href="#xdm-config-files">XDM 設定檔</a></dt><dt>7.1. <a href="#multimedia-sound-common-error-messages">常見錯誤訊息</a></dt><dt>9.1. <a href="#print-pdls-ps-to-other-tbl">輸出 <acronym class="acronym">PDL</acronym> 格式</a></dt><dt>12.1. <a href="#boot-loader-commands">載入程式內建指令</a></dt><dt>12.2. <a href="#boot-kernel">開機時核心互動參數</a></dt><dt>13.1. <a href="#resource-limits">登入類別限制資源類型</a></dt><dt>16.1. <a href="#event-selection">預設稽查事件類別</a></dt><dt>16.2. <a href="#event-prefixes">稽查事件類別字首</a></dt><dt>22.1. <a href="#locale-lang-country">常用語言及城市代碼</a></dt><dt>22.2. <a href="#locale-charset">已定義供特定字元集使用的終端機類型</a></dt><dt>22.3. <a href="#locale-console">Port 套件集中可用的 Console</a></dt><dt>22.4. <a href="#locale-xim">可用的輸入法</a></dt><dt>23.1. <a href="#updating-src-obtaining-src-repopath">FreeBSD 版本與檔案庫路徑</a></dt><dt>26.1. <a href="#serialcomms-signal-names"><acronym class="acronym">RS-232C</acronym> 信號名稱</a></dt><dt>26.2. <a href="#nullmodem-db25">DB-25 對 DB-25 Null-Modem 線</a></dt><dt>26.3. <a href="#nullmodem-db9">DB-9 對 DB-9 Null-Modem 線</a></dt><dt>26.4. <a href="#nullmodem-db9-25">DB-9 對 DB-25 Null-Modem 線</a></dt><dt>29.1. <a href="#idp83891512"><acronym class="acronym">NIS</acronym> 術語</a></dt><dt>29.2. <a href="#idp84185400">其他使用者</a></dt><dt>29.3. <a href="#idp84198328">其他系統</a></dt><dt>29.4. <a href="#idp84358072"><acronym class="acronym">DNS</acronym> 術語</a></dt><dt>30.1. <a href="#pfctl">有用的 <code class="command">pfctl</code> 選項</a></dt><dt>31.1. <a href="#routeflags">常見路由表標記</a></dt><dt>31.2. <a href="#idp87360568">站台功能代號</a></dt><dt>31.3. <a href="#reservedip6">已保留的 <acronym class="acronym">IPv6</acronym> 位址</a></dt></dl></div><div class="list-of-examples"><div class="toc-title">範例目錄</div><dl><dt>2.1. <a href="#bsdinstall-part-manual-splitfs">建立傳統分割的檔案系統分割區</a></dt><dt>3.1. <a href="#idp64538680">以超級使用者的身份安裝程式</a></dt><dt>3.2. <a href="#users-modifying-adduser">在 FreeBSD 新增使用者</a></dt><dt>3.3. <a href="#idp64675896"><code class="command">rmuser</code> 互動式帳號移除</a></dt><dt>3.4. <a href="#users-modifying-chpass-su">以超級使用者的身份使用 <code class="command">chpass</code></a></dt><dt>3.5. <a href="#users-modifying-chpass-ru">以一般使用者的身份使用 <code class="command">chpass</code></a></dt><dt>3.6. <a href="#idp64720952">更改您的密碼</a></dt><dt>3.7. <a href="#idp64724024">以超級使用者的身份更改其他使用者的密碼</a></dt><dt>3.8. <a href="#idp64432440">使用 pw(8) 新增群組</a></dt><dt>3.9. <a href="#idp64439096">使用 pw(8) 加入使用者帳號到新的群組</a></dt><dt>3.10. <a href="#idp64446904">使用 pw(8) 加入新成員到群組</a></dt><dt>3.11. <a href="#idp64451128">使用 id(1) 來查看所屬群組</a></dt><dt>3.12. <a href="#basics-disk-slice-part">磁碟、切割區及分區命名範例</a></dt><dt>3.13. <a href="#basics-concept-disk-model">磁碟的概念模型</a></dt><dt>5.1. <a href="#x-config-video-cards-file-intel">在單檔中選擇 <span class="trademark">Intel</span>® 影像驅動程式</a></dt><dt>5.2. <a href="#x-config-video-cards-file-radeon">在單檔中選擇 Radeon 影像驅動程式</a></dt><dt>5.3. <a href="#x-config-video-cards-file-vesa">在單檔中選擇 <acronym class="acronym">VESA</acronym> 影像驅動程式</a></dt><dt>5.4. <a href="#x-config-video-cards-file-scfb">在單檔中選擇 <code class="literal">scfb</code> 影像驅動程式</a></dt><dt>5.5. <a href="#idp66784952">在單檔中設定螢幕解析度</a></dt><dt>5.6. <a href="#idp66788408">手動設定顯示器頻率</a></dt><dt>5.7. <a href="#idp66810040">設定鍵盤配置</a></dt><dt>5.8. <a href="#idp66811960">設定多個鍵盤配置</a></dt><dt>5.9. <a href="#idp66818744">開啟鍵盤離開 X 功能</a></dt><dt>5.10. <a href="#idp66846136">設定滑鼠按鍵數</a></dt><dt>11.1. <a href="#idp70213944">日誌伺服器設定範例</a></dt><dt>11.2. <a href="#swapfile-10-and-later">建立交換檔於 FreeBSD 10.<em class="replaceable"><code>X</code></em> 及以後版本</a></dt><dt>11.3. <a href="#swapfile-9-and-earlier">建立交換檔於 FreeBSD 9.<em class="replaceable"><code>X</code></em> 及先前版本</a></dt><dt>12.1. <a href="#boot-boot0-example"><code class="filename">boot0</code> 螢幕截圖</a></dt><dt>12.2. <a href="#boot-boot2-example"><code class="filename">boot2</code> 螢幕截圖</a></dt><dt>12.3. <a href="#boot-insecure-console">在 <code class="filename">/etc/ttys</code> 設定不安全的 Console</a></dt><dt>13.1. <a href="#idp72589368">建立供 <acronym class="acronym">SMTP</acronym> 使用的安全通道</a></dt><dt>13.2. <a href="#idp72594360">安全存取 <acronym class="acronym">POP3</acronym> 伺服器</a></dt><dt>13.3. <a href="#idp72604728">跳過防火牆</a></dt><dt>14.1. <a href="#jails-ezjail-update-mergemaster-untrusted">在不信任的 Jail 做 mergemaster(8)</a></dt><dt>14.2. <a href="#jails-ezjail-update-mergemaster-trusted">在信任的 Jail 做 mergemaster(8)</a></dt><dt>14.3. <a href="#jails-ezjail-example-bind-steps">在 Jail 中執行 BIND</a></dt><dt>17.1. <a href="#idp75703736">在 <span class="application">ssh</span> 使用 <code class="command">dump</code></a></dt><dt>17.2. <a href="#idp75719608">在 <span class="application">ssh</span> 使用 <code class="command">dump</code> 透過 <code class="envar">RSH</code> 設定</a></dt><dt>17.3. <a href="#idp75728312">使用 <code class="command">tar</code> 備份目前目錄</a></dt><dt>17.4. <a href="#idp75735736">使用 <code class="command">tar</code> 還原目前目錄</a></dt><dt>17.5. <a href="#idp75760952">使用 <code class="command">ls</code> 與 <code class="command">cpio</code> 來製作目前目錄的遞迴備份</a></dt><dt>17.6. <a href="#idp75772344">使用 <code class="command">pax</code> 備份目前目錄</a></dt><dt>18.1. <a href="#idp77175352">在開機磁碟標記分割區標籤</a></dt><dt>23.1. <a href="#updating-src-building-jobs-example">增加編譯工作數</a></dt><dt>26.1. <a href="#ex-etc-ttys">設定終端機項目</a></dt><dt>29.1. <a href="#network-inetd-reread">重新庫入 <span class="application">inetd</span> 設定檔</a></dt><dt>29.2. <a href="#idp83754552">使用 <span class="application">amd</span> 掛載 Export</a></dt><dt>29.3. <a href="#idp83819320">使用 autofs(5) 掛載 Export</a></dt><dt>29.4. <a href="#idp85090360"><code class="filename">/etc/ntp.conf</code> 範例</a></dt><dt>31.1. <a href="#networking-lacp-aggregation-cisco"><span class="trademark">Cisco</span>® 交換器上設定 <acronym class="acronym">LACP</acronym> Aggregation</a></dt><dt>31.2. <a href="#networking-lagg-failover">容錯移轉模式</a></dt><dt>31.3. <a href="#networking-lagg-wired-and-wireless">乙太網路與無線介面間的容錯移轉模式</a></dt></dl></div><div class="preface"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="book-preface"></a>序</h1></div></div></div><h2 class="title"><a id="preface-audience"></a>給讀者的話</h2><p>若您是第一次接觸 FreeBSD 的新手，可以在本書第一部分找到 FreeBSD 的安裝程序，同時會逐步介紹 <span class="trademark">UNIX</span>® 的基礎概念與一些常用、共通的東西。而閱讀這部分並不難，只需要您有探索的精神和接受新概念。</p><p>讀完這些之後，手冊中的第二部分花很長篇幅介紹的各種廣泛主題，相當值得系統管理者去注意。 在閱讀這些章節的內容時所需要的背景知識，都註釋在該章的大綱裡面，若不熟的話，可在閱讀前先預習一番。</p><p>延伸閱讀方面，可參閱 <a class="xref" href="#bibliography" title="附錄 B. 參考書目">附錄 B, <em>參考書目</em></a>。</p><h2 class="title"><a id="preface-changes-from3"></a>自第三版後的主要修訂</h2><p>您目前看到的這本手冊代表著上百位貢獻者歷時 10 年所累積的心血之作。以下為自 2014 年發佈的兩冊第三版後所做的主要修訂：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="#dtrace" title="章 24. DTrace">章 24, <em>DTrace</em></a> 增加說明有關強大的 DTrace 效能分析工具的資訊。</p></li><li class="listitem"><p><a class="xref" href="#filesystems" title="章 20. 其他檔案系統">章 20, <em>其他檔案系統</em></a> 增加有關 FreeBSD 非原生檔案系統的資訊，如：來自 <span class="trademark">Sun</span>™ 的 ZSF。</p></li><li class="listitem"><p><a class="xref" href="#audit" title="章 16. 安全事件稽查">章 16, <em>安全事件稽查</em></a> 增加的內容涵蓋 FreeBSD 的新稽查功能及其使用說明。</p></li><li class="listitem"><p><a class="xref" href="#virtualization" title="章 21. 虛擬化">章 21, <em>虛擬化</em></a> 增加有關在虛擬化軟體安裝 FreeBSD  的資訊。</p></li><li class="listitem"><p><a class="xref" href="#bsdinstall" title="章 2. 安裝 FreeBSD">章 2, <em>安裝 FreeBSD</em></a> 增加的內容涵蓋使用新安裝工具 <span class="application">bsdinstall</span> 來安裝 FreeBSD。</p></li></ul></div><h2 class="title"><a id="preface-changes-from2"></a>自第二版後的主要修訂 (2004)</h2><p>您目前看到的這本手冊第三版是 FreeBSD 文件計劃的成員歷時兩年完成的心血之作。因文件內容成長到一定大小，印刷版需要分成兩冊發佈。新版的主要修訂部分如下：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="#config-tuning" title="章 11. 設定與調校">章 11, <em>設定與調校</em></a> 已針對新內容作更新，如：ACPI 電源管理、<code class="command">cron</code> 以及其他更多的核心調校選項說明內容。</p></li><li class="listitem"><p><a class="xref" href="#security" title="章 13. 安全性">章 13, <em>安全性</em></a> 增加了虛擬私人網路 (VPN)、檔案系統的存取控制 (ACL)，以及安全報告。</p></li><li class="listitem"><p><a class="xref" href="#mac" title="章 15. 強制存取控制 (MAC)">章 15, <em>強制存取控制 (MAC)</em></a> 是此版本新增的章節。該章介紹：什麼是 MAC 機制？以及如何運用它來使您的 FreeBSD 系統更安全。</p></li><li class="listitem"><p><a class="xref" href="#disks" title="章 17. 儲存設備">章 17, <em>儲存設備</em></a> 新增了像是：USB 隨身碟、檔案系統快照 (Snapshot)、檔案系統配額 (Quota) 、檔案與網路為基礎的檔案系統、以及如何對硬碟分割區作加密等詳解。</p></li><li class="listitem"><p><a class="xref" href="#ppp-and-slip" title="章 27. PPP">章 27, <em><acronym class="acronym">PPP</acronym></em></a> 增加了疑難排解的章節。</p></li><li class="listitem"><p><a class="xref" href="#mail" title="章 28. 電子郵件">章 28, <em>電子郵件</em></a> 新增有關如何使用其它的傳輸代理程式、SMTP 認證、UUCP、<span class="application">fetchmail</span>、<span class="application">procmail</span> 的運用以及其它進階主題。</p></li><li class="listitem"><p><a class="xref" href="#network-servers" title="章 29. 網路伺服器">章 29, <em>網路伺服器</em></a> 是該版中全新的一章。這一章介紹了如何架設 <span class="application">Apache HTTP 伺服器</span>、<span class="application">ftpd</span> 以及用於支援 <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 客戶端的 <span class="application">Samba</span>。其中有些段落來自原先的 <a class="xref" href="#advanced-networking" title="章 31. 進階網路設定">章 31, <em>進階網路設定</em></a> 。</p></li><li class="listitem"><p><a class="xref" href="#advanced-networking" title="章 31. 進階網路設定">章 31, <em>進階網路設定</em></a> 新增有關在 FreeBSD 中使用<span class="trademark">藍牙</span>®裝置、設定無線網路以及使用非同步傳輸模式 (Asynchronous Transfer Mode, ATM)  網路的介紹。</p></li><li class="listitem"><p>增加詞彙表，用以說明全書中出現的術語。</p></li><li class="listitem"><p>重新美編書中所列的圖表。</p></li></ul></div><h2 class="title"><a id="preface-changes"></a>自第一版後的主要修訂 (2001)</h2><p>本手冊的第二版是 FreeBSD 文件計劃的成員歷時兩年完成的心血之作。第二版包的主要變動如下：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>增加完整的目錄索引。</p></li><li class="listitem"><p>所有的 ASCII 圖表均改成圖檔格式的圖表。</p></li><li class="listitem"><p>每個章節均加入概述，以便快速的瀏覽該章節內容摘要、讀者所欲了解的部分。</p></li><li class="listitem"><p>內容架構重新組織成三大部分：<span class="quote">“<span class="quote">入門</span>”</span>、<span class="quote">“<span class="quote">系統管理</span>”</span> 以及 <span class="quote">“<span class="quote">附錄</span>”</span>。</p></li><li class="listitem"><p><a class="xref" href="#basics" title="章 3. FreeBSD 基礎">章 3, <em>FreeBSD 基礎</em></a> 新增了程序、Daemon 以及信號 (Signal) 的介紹。</p></li><li class="listitem"><p><a class="xref" href="#ports" title="章 4. 安裝應用程式：套件與 Port">章 4, <em>安裝應用程式：套件與 Port</em></a> 新增了介紹如何管理 Binary 套件的資訊。</p></li><li class="listitem"><p><a class="xref" href="#x11" title="章 5. X Window 系統">章 5, <em>X Window 系統</em></a> 經過全面改寫，著重於在 <span class="trademark">XFree86</span>™ 4.X 上的現代桌面技術，如： <span class="application">KDE</span> 和 <span class="application">GNOME</span>。</p></li><li class="listitem"><p><a class="xref" href="#boot" title="章 12. FreeBSD 開機程序">章 12, <em>FreeBSD 開機程序</em></a> 更新相關內容。</p></li><li class="listitem"><p><a class="xref" href="#disks" title="章 17. 儲存設備">章 17, <em>儲存設備</em></a> 分別以兩個章節 <span class="quote">“<span class="quote">磁碟</span>”</span> 與 <span class="quote">“<span class="quote">備份</span>”</span> 來撰寫。我們認為這樣子會比單一章節來得容易瞭解。還有關於 RAID (包含硬體、軟體 RAID) 的段落也新增上去了。</p></li><li class="listitem"><p><a class="xref" href="#serialcomms" title="章 26. 序列通訊">章 26, <em>序列通訊</em></a> 架構重新改寫，並更新至 FreeBSD 4.X/5.X 的內容。</p></li><li class="listitem"><p><a class="xref" href="#ppp-and-slip" title="章 27. PPP">章 27, <em><acronym class="acronym">PPP</acronym></em></a> 有相當程度的更新。</p></li><li class="listitem"><p><a class="xref" href="#advanced-networking" title="章 31. 進階網路設定">章 31, <em>進階網路設定</em></a> 加入許多新內容。</p></li><li class="listitem"><p><a class="xref" href="#mail" title="章 28. 電子郵件">章 28, <em>電子郵件</em></a> 大量新增了設定 <span class="application">sendmail</span> 的介紹。</p></li><li class="listitem"><p><a class="xref" href="#linuxemu" title="章 10. Linux® Binary 相容性">章 10, <em><span class="trademark">Linux</span>® Binary 相容性</em></a> 增加許多有關安裝 <span class="application"><span class="trademark">Oracle</span>®</span> 以及 <span class="application"><span class="trademark">SAP</span>® <span class="trademark">R/3</span>®</span> 的介紹。</p></li><li class="listitem"><p>此外，第二版還新加章節，以介紹下列新主題：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><a class="xref" href="#config-tuning" title="章 11. 設定與調校">章 11, <em>設定與調校</em></a>。</p></li><li class="listitem"><p><a class="xref" href="#multimedia" title="章 7. 多媒體">章 7, <em>多媒體</em></a>。</p></li></ul></div></li></ul></div><h2 class="title"><a id="preface-overview"></a>本書架構</h2><p>本書主要分為五大部分，第一部份<span class="emphasis"><em>入門</em></span>：介紹 FreeBSD 的安裝、基本操作。 讀者可根據自己的程度，循序或者跳過一些熟悉的主題來閱讀； 第二部分<span class="emphasis"><em>一般作業</em></span>：介紹 FreeBSD 常用功能，這部分可以不按順序來讀。 每章前面都會有概述，概述會描述本章節涵蓋的內容和讀者應該已知的， 這主要是讓讀者可以挑喜歡的章節閱讀； 第三部分<span class="emphasis"><em>系統管理</em></span>：介紹 FreeBSD 老手所感興趣的各種主題部分； 第四部分<span class="emphasis"><em>網路通訊</em></span>：則包括網路和各式伺服器主題；而第五部分則為附錄包含各種有關 FreeBSD 的資源。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#introduction" title="章 1. 簡介">章 1, <em>簡介</em></a></em></span></span></dt><dd><p>向新手介紹 FreeBSD。該篇說明了 FreeBSD 計劃的歷史、目標和開發模式。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#bsdinstall" title="章 2. 安裝 FreeBSD">章 2, <em>安裝 FreeBSD</em></a></em></span></span></dt><dd><p>帶領使用者走一次使用 <span class="application">bsdinstall</span> 在 FreeBSD 9.<em class="replaceable"><code>x</code></em> 及之後版本的完整安裝流程。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#basics" title="章 3. FreeBSD 基礎">章 3, <em>FreeBSD 基礎</em></a></em></span></span></dt><dd><p>涵蓋 FreeBSD 作業系統的基礎指令及功能。若您熟悉 <span class="trademark">Linux</span>® 或其他類 UNIX® 系統，您則可跳過此章。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#ports" title="章 4. 安裝應用程式：套件與 Port">章 4, <em>安裝應用程式：套件與 Port</em></a></em></span></span></dt><dd><p>涵蓋如何使用 FreeBSD 獨創的 <span class="quote">“<span class="quote">Port 套件集</span>”</span> 與標準 Binary 套件安裝第三方軟體。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#x11" title="章 5. X Window 系統">章 5, <em>X Window 系統</em></a></em></span></span></dt><dd><p>介紹 X Windows 系統概要及在 FreeBSD 上使用 X11，同時也會介紹常用的桌面環境如 <span class="application">KDE</span> 與 <span class="application">GNOME</span>。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#desktop" title="章 6. 桌面應用程式">章 6, <em>桌面應用程式</em></a></em></span></span></dt><dd><p>列出一些常用的桌面應用程式，例如：網頁瀏覽器、辦工工具並介紹如何安裝這些應用程式到 FreeBSD。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#multimedia" title="章 7. 多媒體">章 7, <em>多媒體</em></a></em></span></span></dt><dd><p>示範如何在您的系統設定音效及影像播放支援，同時會介紹幾個代表性的音訊及視訊應用程式。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a></em></span></span></dt><dd><p>說明為何需要設定新的核心並會提供設定、編譯與安裝的詳細操作說明。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#printing" title="章 9. 列印">章 9, <em>列印</em></a></em></span></span></dt><dd><p>介紹如何在 FreeBSD 管理印表機，包含橫幅頁面、列印帳務以及初始設定等資訊。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#linuxemu" title="章 10. Linux® Binary 相容性">章 10, <em><span class="trademark">Linux</span>® Binary 相容性</em></a></em></span></span></dt><dd><p>介紹 FreeBSD 的 <span class="trademark">Linux</span>® 相容性功能，同時提供許多熱門的 <span class="trademark">Linux</span>® 應用程式詳細的安裝操作說明，例如 <span class="application"><span class="trademark">Oracle</span>®</span> 及 <span class="application"><span class="trademark">Mathematica</span>®</span>。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#config-tuning" title="章 11. 設定與調校">章 11, <em>設定與調校</em></a></em></span></span></dt><dd><p>介紹可供系統管理者用來調校 FreeBSD 系統的可用參數來最佳化效率，同時也介紹 FreeBSD 用到的各種設定檔以及到何處尋找這些設定檔。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#boot" title="章 12. FreeBSD 開機程序">章 12, <em>FreeBSD 開機程序</em></a></em></span></span></dt><dd><p>介紹 FreeBSD 開機流程並說明如何使用設定選項控制開機流程。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#security" title="章 13. 安全性">章 13, <em>安全性</em></a></em></span></span></dt><dd><p>介紹許多可讓您的  FreeBSD 系統更安全的各種工具，包含 Kerberos, IPsec 及 OpenSSH。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#jails" title="章 14. Jail">章 14, <em>Jail</em></a></em></span></span></dt><dd><p>介紹 Jail Framework，以及 Jail 改進那些 FreeBSD 傳統 chroot 不足的地方。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#mac" title="章 15. 強制存取控制 (MAC)">章 15, <em>強制存取控制 (MAC)</em></a></em></span></span></dt><dd><p>說明什麼是強制存取控制 (Mandatory Access Control, MAC) 及這個機制如何用來確保 FreeBSD 系統的安全。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#audit" title="章 16. 安全事件稽查">章 16, <em>安全事件稽查</em></a></em></span></span></dt><dd><p>介紹什麼事 FreeBSD 事件稽查，如何安裝與設定，以及如何檢查與監控稽查線索。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#disks" title="章 17. 儲存設備">章 17, <em>儲存設備</em></a></em></span></span></dt><dd><p>介紹如何在 FreeBSD 管理儲存媒體及檔案系統，這包含了實體磁碟、RAID 陣列、光碟與磁帶媒體、記憶體為基礎的磁碟以及網路檔案系統。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#geom" title="章 18. GEOM: 模組化磁碟轉換框架">章 18, <em>GEOM: 模組化磁碟轉換框架</em></a></em></span></span></dt><dd><p>介紹在 FreeBSD 中的 GEOM Framework 是什麼，以及如何設定各種支援的 RAID 階層。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#filesystems" title="章 20. 其他檔案系統">章 20, <em>其他檔案系統</em></a></em></span></span></dt><dd><p>查看 FreeBSD 還支援那些非原生檔案系統，如 <span class="trademark">Sun</span>™ 的 Z 檔案系統。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#virtualization" title="章 21. 虛擬化">章 21, <em>虛擬化</em></a></em></span></span></dt><dd><p>介紹虛擬化系統提供了那些功能，以及如何在 FreeBSD 上使用。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#l10n" title="章 22. 在地化 - i18n/L10n 使用與安裝">章 22, <em>在地化 - <acronym class="acronym">i18n</acronym>/<acronym class="acronym">L10n</acronym> 使用與安裝</em></a></em></span></span></dt><dd><p>介紹如何在 FreeBSD 使用非英文的語言，這涵蓋了系統及應用層的在地化。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#updating-upgrading" title="章 23. 更新與升級 FreeBSD">章 23, <em>更新與升級 FreeBSD</em></a></em></span></span></dt><dd><p>說明 FreeBSD-STABLE、FreeBSD-CURRENT 以及 FreeBSD 發佈版之間的差異，並介紹那些使用者適何追蹤開發系統以及程序的概述，這涵蓋了使用者更新系統到最新安全性發佈版本的方法。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#dtrace" title="章 24. DTrace">章 24, <em>DTrace</em></a></em></span></span></dt><dd><p>介紹如何在 FreeBSD 設定及使用 <span class="trademark">Sun</span>™ 的 DTrace 工具，動態追蹤可以透過執行真實時間系統分析來協助定位效能問題。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#serialcomms" title="章 26. 序列通訊">章 26, <em>序列通訊</em></a></em></span></span></dt><dd><p>介紹如何使用撥入及撥出連線到您的 FreeBSD 系統的終端機與數據機。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#ppp-and-slip" title="章 27. PPP">章 27, <em><acronym class="acronym">PPP</acronym></em></a></em></span></span></dt><dd><p>介紹如何在 FreeBSD 使用 PPP 來連線遠端的系統。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#mail" title="章 28. 電子郵件">章 28, <em>電子郵件</em></a></em></span></span></dt><dd><p>說明組成電子郵件伺服器的各種元件，並深入說明如何設定最熱門的郵件伺服器軟體：<span class="application">sendmail</span>。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#network-servers" title="章 29. 網路伺服器">章 29, <em>網路伺服器</em></a></em></span></span></dt><dd><p>提供詳細的操作說明與範例設定檔，讓您可安裝您的 FreeBSD 機器為網路檔案伺服器、網域名稱伺服器、網路資訊系統伺服器或時間同步伺服器。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#firewalls" title="章 30. 防火牆">章 30, <em>防火牆</em></a></em></span></span></dt><dd><p>說明軟體為基礎的防火牆背後的理念，並提供可用於 FreeBSD 中不同的防火牆設定的詳細資訊。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#advanced-networking" title="章 31. 進階網路設定">章 31, <em>進階網路設定</em></a></em></span></span></dt><dd><p>介紹許多網路主題，包含在您的區域網路 (LAN) 分享網際網路連線給其他電腦、進階路由主題、無線網路、<span class="trademark">Bluetooth</span>®、ATM、IPv6 以及更多相關主題。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#mirrors" title="附錄 A. 取得 FreeBSD">附錄 A, <em>取得 FreeBSD</em></a></em></span></span></dt><dd><p>列出取得 FreeBSD CDROM 或 DVD 媒體的各種來源，以及在網際網路上的各種網站，讓您可以下載並安裝 FreeBSD。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#bibliography" title="附錄 B. 參考書目">附錄 B, <em>參考書目</em></a></em></span></span></dt><dd><p>本書觸及許多不同主題，可能會讓您想更深入的了解，參考書目列出了在文中引用的許多優秀書籍。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#eresources" title="附錄 C. 網路資源">附錄 C, <em>網路資源</em></a></em></span></span></dt><dd><p>介紹了可讓 FreeBSD 使用者提出問題以及參與有關 FreeBSD 技術會談的許多論壇。</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#pgpkeys" title="附錄 D. OpenPGP 金鑰">附錄 D, <em>Open<acronym class="acronym">PGP</acronym> 金鑰</em></a></em></span></span></dt><dd><p>列出了數個 FreeBSD 開發人員的 PGP 指紋。</p></dd></dl></div><h2 class="title"><a id="preface-conv"></a>本書的編排體裁</h2><p>為了提供有一致性且易於閱讀的內容，以下是一些本書所遵循的編排體裁。</p><h3 class="title"><a id="preface-conv-typographic"></a>文字編排體裁</h3><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="emphasis"><em>斜體字</em></span></span></dt><dd><p><span class="emphasis"><em>斜體字</em></span>用於：檔名、目錄、網址 (URL)、 強調語氣、以及第一次提及的技術詞彙。</p></dd><dt><span class="term"><code class="literal">等寬字</code></span></dt><dd><p><code class="literal">等寬字</code>用於： 錯誤訊息、指令、環境變數、Port 名稱、主機名稱、帳號、群組、裝置名稱、變數、程式碼等。</p></dd><dt><span class="term"><span class="application">粗體字</span></span></dt><dd><p>以<span class="keycap"><strong>粗體字</strong></span>表示：應用程式、指令、按鍵。</p></dd></dl></div><h3 class="title"><a id="preface-conv-commands"></a>使用者輸入</h3><p>鍵盤輸入以<span class="keycap"><strong>粗體字</strong></span>表示，以便與一般文字做區隔。 組合鍵是指同時按下一些按鍵，我們以 `<code class="literal">+</code>' 來表示連接，像是：</p><p xml:lang="en" lang="en">
    <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>Del</strong></span></p><p>是說，一起按 <span class="keycap"><strong>Ctrl</strong></span>、 <span class="keycap"><strong>Alt</strong></span> 以及 <span class="keycap"><strong>Del</strong></span> 鍵。</p><p>若要逐一按鍵，那麼會以逗號 (,) 來表示，像是：</p><p xml:lang="en" lang="en">
    <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>X</strong></span>,
    <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>S</strong></span></p><p>是說：先同時按下 <span class="keycap"><strong>Ctrl</strong></span> 與 <span class="keycap"><strong>X</strong></span> 鍵， 然後放開後再同時按 <span class="keycap"><strong>Ctrl</strong></span> 與 <span class="keycap"><strong>S</strong></span> 鍵。</p><h3 class="title"><a id="preface-conv-examples"></a>範例</h3><p>範例以  <code class="filename">C:\&gt;</code> 為開頭代表 <span class="trademark">MS-DOS</span>® 的指令。 若沒有特殊情況的話，這些指令應該是在 <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 環境的 <span class="quote">“<span class="quote">指令提示字元 (Command Prompt)</span>”</span> 視窗內執行。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">E:\&gt;</code> <strong class="userinput"><code>tools\fdimage floppies\kern.flp A:</code></strong></pre><p>範例以 <code class="prompt">#</code> 為開頭代表在 FreeBSD 中以超級使用者權限來執行的指令。 你可以先以 <code class="systemitem">root</code> 登入系統並下指令，或是以你自己的帳號登入再使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> 來取得超級使用者權限。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>dd if=kern.flp of=/dev/fd0</code></strong></pre><p>範例以 <code class="prompt">%</code> 為開頭代表在 FreeBSD 中以一般使用者帳號執行的指令。 除非有提到其他用法，否則都是預設為 C-shell 語法，用來設定環境變數以及下其他指令的意思。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>top</code></strong></pre><h2 class="title"><a id="preface-acknowledgements"></a>銘謝</h2><p>您所看到的這本書是經過數百個分散在世界各地的人所努力而來的結果。 無論他們只是糾正一些錯誤或提交完整的章節，所有的點滴貢獻都是非常寶貴有用的。</p><p>也有一些公司透過提供資金讓作者專注於撰稿、提供出版資金等模式來支持文件的寫作。 其中，BSDi (之後併入 <a class="link" href="http://www.windriver.com" target="_top">Wind River Systems</a>) 資助 FreeBSD 文件計劃成員來專職改善這本書直到 2000 年 3 月第一版的出版。(ISBN 1-57176-241-8) Wind River Systems 同時資助其他作者來對輸出架構做很多改進，以及給文章增加一些附加章節。這項工作結束於 2001 年 11 月第二版。(ISBN 1-57176-303-1) 在 2003-2004 兩年中，<a class="link" href="http://www.freebsdmall.com" target="_top">FreeBSD Mall, Inc</a> 把報酬支付給改進這本手冊以使第三版印刷版本能夠出版的志工。</p></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="getting-started"></a>部 I. 入門</h1></div></div></div><div class="partintro"><div xmlns=""></div><p>這部份是提供給初次使用 FreeBSD 的使用者和系統管理者。 這些章節包括：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>介紹 FreeBSD 給您。</p></li><li class="listitem"><p>在安裝過程給您指引。</p></li><li class="listitem"><p>教您 <span class="trademark">UNIX</span>® 的基礎及原理。</p></li><li class="listitem"><p>展示給您看如何安裝豐富的 FreeBSD 的應用軟體。</p></li><li class="listitem"><p>向您介紹 X，<span class="trademark">UNIX</span>® 的視窗系統以及詳細的桌面環境設定，讓您更有生產力。</p></li></ul></div><p>我們試著儘可能的讓這段文字的參考連結數目降到最低，讓您在讀使用手冊的這部份時可以不太需要常常前後翻頁。</p><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="chapter"><a href="#introduction">1. 簡介</a></span></dt><dd><dl><dt><span class="sect1"><a href="#introduction-synopsis">1.1. 概述</a></span></dt><dt><span class="sect1"><a href="#nutshell">1.2. 歡迎使用 FreeBSD！</a></span></dt><dd><dl><dt><span class="sect2"><a href="#os-overview">1.2.1. FreeBSD 能做什麼？</a></span></dt><dt><span class="sect2"><a href="#introduction-nutshell-users">1.2.2. 誰在用 FreeBSD？</a></span></dt></dl></dd><dt><span class="sect1"><a href="#history">1.3. 關於 FreeBSD 計劃</a></span></dt><dd><dl><dt><span class="sect2"><a href="#intro-history">1.3.1. FreeBSD 歷史簡介</a></span></dt><dt><span class="sect2"><a href="#goals">1.3.2. FreeBSD 計劃目標</a></span></dt><dt><span class="sect2"><a href="#development">1.3.3. FreeBSD 開發模式</a></span></dt><dt><span class="sect2"><a href="#third-party-programs">1.3.4. 第三方程式</a></span></dt><dt><span class="sect2"><a href="#idp60675768">1.3.5. 其他文件</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#bsdinstall">2. 安裝 FreeBSD</a></span></dt><dd><dl><dt><span class="sect1"><a href="#bsdinstall-synopsis">2.1. 概述</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-hardware">2.2. 最低硬體需求</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-pre">2.3. 安裝前準備工作</a></span></dt><dd><dl><dt><span class="sect2"><a href="#bsdinstall-installation-media">2.3.1. 準備安裝的媒體</a></span></dt><dd><dl><dt><span class="sect3"><a href="#bsdinstall-usb">2.3.1.1. 寫入映象檔到 <acronym class="acronym">USB</acronym></a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#bsdinstall-start">2.4. 開始安裝</a></span></dt><dd><dl><dt><span class="sect2"><a href="#bsdinstall-starting-i386">2.4.1. 在 <span class="trademark">i386</span>™ 及 amd64 開機</a></span></dt><dt><span class="sect2"><a href="#idp63641400">2.4.2. 在 <span class="trademark">PowerPC</span>® 開機</a></span></dt><dt><span class="sect2"><a href="#idp63661752">2.4.3. 在 <span class="trademark">SPARC64</span>® 開機</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-view-probe">2.4.4. FreeBSD 開機選單</a></span></dt></dl></dd><dt><span class="sect1"><a href="#using-bsdinstall">2.5. 使用 <span class="application">bsdinstall</span></a></span></dt><dd><dl><dt><span class="sect2"><a href="#bsdinstall-keymap">2.5.1. 選擇鍵盤對應表選單</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-hostname">2.5.2. 設定主機名稱</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-components">2.5.3. 選擇要安裝的元件</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-netinstall">2.5.4. 從網路安裝</a></span></dt></dl></dd><dt><span class="sect1"><a href="#bsdinstall-partitioning">2.6. 配置磁碟空間</a></span></dt><dd><dl><dt><span class="sect2"><a href="#configtuning-initial">2.6.1. 規劃分割區配置</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-part-guided">2.6.2. 引導式磁碟分割</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-part-manual">2.6.3. 手動磁碟分割</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-part-zfs">2.6.4. Root-on-ZFS 自動磁碟分割</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-part-shell">2.6.5. Shell 模式磁碟分割</a></span></dt></dl></dd><dt><span class="sect1"><a href="#bsdinstall-final-warning">2.7. 確認安裝</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-post">2.8. 安裝後注意事項</a></span></dt><dd><dl><dt><span class="sect2"><a href="#bsdinstall-post-root">2.8.1. 設定 <code class="systemitem">root</code> 密碼</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-config-network-dev">2.8.2. 設定網路介面卡</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-timezone">2.8.3. 設定時區</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-sysconf">2.8.4. 開啟服務</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-crashdump">2.8.5. 開啟當機資訊 (Crash Dump)</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-addusers">2.8.6. 新增使用者</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-final-conf">2.8.7. 最後設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#bsdinstall-install-trouble">2.9. 疑難排解</a></span></dt><dt><span class="sect1"><a href="#using-live-cd">2.10. 使用 Live <acronym class="acronym">CD</acronym></a></span></dt></dl></dd><dt><span class="chapter"><a href="#basics">3. FreeBSD 基礎</a></span></dt><dd><dl><dt><span class="sect1"><a href="#basics-synopsis">3.1. 概述</a></span></dt><dt><span class="sect1"><a href="#consoles">3.2. 虛擬 Console 與終端機</a></span></dt><dd><dl><dt><span class="sect2"><a href="#consoles-virtual">3.2.1. 虛擬 Console</a></span></dt><dt><span class="sect2"><a href="#consoles-singleuser">3.2.2. 單使用者模式</a></span></dt><dt><span class="sect2"><a href="#consoles-vidcontrol">3.2.3. 更改 Console 影像模式</a></span></dt></dl></dd><dt><span class="sect1"><a href="#users-synopsis">3.3. 使用者與基礎帳號管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#users-introduction">3.3.1. 帳號類型</a></span></dt><dd><dl><dt><span class="sect3"><a href="#users-system">3.3.1.1. 系統帳號</a></span></dt><dt><span class="sect3"><a href="#users-user">3.3.1.2. 使用者帳號</a></span></dt><dt><span class="sect3"><a href="#users-superuser">3.3.1.3. 超級使用者帳號</a></span></dt></dl></dd><dt><span class="sect2"><a href="#users-modifying">3.3.2. 管理帳號</a></span></dt><dd><dl><dt><span class="sect3"><a href="#users-adduser">3.3.2.1. <code class="command">adduser</code></a></span></dt><dt><span class="sect3"><a href="#users-rmuser">3.3.2.2. <code class="command">rmuser</code></a></span></dt><dt><span class="sect3"><a href="#users-chpass">3.3.2.3. <code class="command">chpass</code></a></span></dt><dt><span class="sect3"><a href="#users-passwd">3.3.2.4. <code class="command">passwd</code></a></span></dt><dt><span class="sect3"><a href="#users-pw">3.3.2.5. <code class="command">pw</code></a></span></dt></dl></dd><dt><span class="sect2"><a href="#users-groups">3.3.3. 管理群組</a></span></dt></dl></dd><dt><span class="sect1"><a href="#permissions">3.4. 權限</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp64837048">3.4.1. 權限符號</a></span></dt><dt><span class="sect2"><a href="#idp64892088">3.4.2. FreeBSD 檔案旗標</a></span></dt><dt><span class="sect2"><a href="#idp64911544">3.4.3. <code class="literal">setuid</code> 、<code class="literal">setgid</code> 與 <code class="literal">sticky</code> 權限</a></span></dt></dl></dd><dt><span class="sect1"><a href="#dirstructure">3.5. 目錄結構</a></span></dt><dt><span class="sect1"><a href="#disk-organization">3.6. 磁碟組織</a></span></dt><dt><span class="sect1"><a href="#mount-unmount">3.7. 掛載與卸載檔案系統</a></span></dt><dd><dl><dt><span class="sect2"><a href="#disks-fstab">3.7.1. <code class="filename">fstab</code> 檔</a></span></dt><dt><span class="sect2"><a href="#disks-mount">3.7.2. 使用 mount(8)</a></span></dt><dt><span class="sect2"><a href="#disks-umount">3.7.3. 使用 umount(8)</a></span></dt></dl></dd><dt><span class="sect1"><a href="#basics-processes">3.8. 程序與 Daemon</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp65473336">3.8.1. 檢視程序</a></span></dt><dt><span class="sect2"><a href="#basics-daemons">3.8.2. 終止程序</a></span></dt></dl></dd><dt><span class="sect1"><a href="#shells">3.9. Shell</a></span></dt><dd><dl><dt><span class="sect2"><a href="#changing-shells">3.9.1. 變更 Shell</a></span></dt><dt><span class="sect2"><a href="#idp65690680">3.9.2. 進階 Shell 技巧</a></span></dt></dl></dd><dt><span class="sect1"><a href="#editors">3.10. 文字編輯器</a></span></dt><dt><span class="sect1"><a href="#basics-devices">3.11. 裝置及裝置節點</a></span></dt><dt><span class="sect1"><a href="#basics-more-information">3.12. 操作手冊</a></span></dt><dd><dl><dt><span class="sect2"><a href="#basics-info">3.12.1. GNU Info 檔</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ports">4. 安裝應用程式：套件與 Port</a></span></dt><dd><dl><dt><span class="sect1"><a href="#ports-synopsis">4.1. 概述</a></span></dt><dt><span class="sect1"><a href="#ports-overview">4.2. 安裝軟體的概要</a></span></dt><dt><span class="sect1"><a href="#ports-finding-applications">4.3. 搜尋軟體</a></span></dt><dt><span class="sect1"><a href="#pkgng-intro">4.4. 使用 <span class="application">pkg</span> 管理 Binary 套件</a></span></dt><dd><dl><dt><span class="sect2"><a href="#pkgng-initial-setup">4.4.1. 開始使用 <span class="application">pkg</span></a></span></dt><dt><span class="sect2"><a href="#pkgng-pkg-info">4.4.2. 取得有關已安裝套件的資訊</a></span></dt><dt><span class="sect2"><a href="#pkgng-installing-deinstalling">4.4.3. 安裝與移除套件</a></span></dt><dt><span class="sect2"><a href="#pkgng-upgrading">4.4.4. 升級已安裝套件</a></span></dt><dt><span class="sect2"><a href="#pkgng-auditing">4.4.5. 稽查已安裝套件</a></span></dt><dt><span class="sect2"><a href="#pkgng-autoremove">4.4.6. 自動移除未使用的套件</a></span></dt><dt><span class="sect2"><a href="#pkgng-backup">4.4.7. 還原套件資料庫</a></span></dt><dt><span class="sect2"><a href="#pkgng-clean">4.4.8. 移除過時的套件</a></span></dt><dt><span class="sect2"><a href="#pkgng-set">4.4.9. 修改套件 Metadata</a></span></dt></dl></dd><dt><span class="sect1"><a href="#ports-using">4.5. 使用 Port 套件集</a></span></dt><dd><dl><dt><span class="sect2"><a href="#ports-skeleton">4.5.1. 安裝 Port</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp66154680">4.5.1.1. 自訂 Port 安裝</a></span></dt></dl></dd><dt><span class="sect2"><a href="#ports-removing">4.5.2. 移除已安裝的 Port</a></span></dt><dt><span class="sect2"><a href="#ports-upgrading">4.5.3. 升級 Port</a></span></dt><dd><dl><dt><span class="sect3"><a href="#ports-upgrading-tools">4.5.3.1. 升級與管理 Port 的工具</a></span></dt><dt><span class="sect3"><a href="#portmaster">4.5.3.2. 使用 <span class="application">Portmaster</span> 升級 Port</a></span></dt><dt><span class="sect3"><a href="#portupgrade">4.5.3.3. 使用 Portupgrade 升級 Port</a></span></dt></dl></dd><dt><span class="sect2"><a href="#ports-disk-space">4.5.4. Port 與磁碟空間</a></span></dt></dl></dd><dt><span class="sect1"><a href="#ports-poudriere">4.6. 使用 <span class="application">Poudriere</span> 編譯套件</a></span></dt><dd><dl><dt><span class="sect2"><a href="#poudriere-initialization">4.6.1. 初始化 Jail 與 Port 樹</a></span></dt><dt><span class="sect2"><a href="#idp66422200">4.6.2. 設定 pkg 客戶端使用 Poudriere 檔案庫</a></span></dt></dl></dd><dt><span class="sect1"><a href="#ports-nextsteps">4.7. 安裝後的注意事項</a></span></dt><dt><span class="sect1"><a href="#ports-broken">4.8. 處理損壞的 Port</a></span></dt></dl></dd><dt><span class="chapter"><a href="#x11">5. X Window 系統</a></span></dt><dd><dl><dt><span class="sect1"><a href="#x11-synopsis">5.1. 概述</a></span></dt><dt><span class="sect1"><a href="#x-understanding">5.2. 術語</a></span></dt><dt><span class="sect1"><a href="#x-install">5.3. 安裝 <span class="application">Xorg</span></a></span></dt><dt><span class="sect1"><a href="#x-config">5.4. <span class="application">Xorg</span> 設定</a></span></dt><dd><dl><dt><span class="sect2"><a href="#x-config-quick-start">5.4.1. 快速開始</a></span></dt><dt><span class="sect2"><a href="#x-config-user-group">5.4.2. 可加速影像處理的使用者群組</a></span></dt><dt><span class="sect2"><a href="#x-config-kms">5.4.3. 核心模式設定 (Kernel Mode Setting, <acronym class="acronym">KMS</acronym>)</a></span></dt><dt><span class="sect2"><a href="#x-config-files">5.4.4. 設定檔</a></span></dt><dd><dl><dt><span class="sect3"><a href="#x-config-files-directory">5.4.4.1. 目錄</a></span></dt><dt><span class="sect3"><a href="#x-config-files-single-or-multi">5.4.4.2. 單檔或多檔</a></span></dt></dl></dd><dt><span class="sect2"><a href="#x-config-video-cards">5.4.5. 顯示卡</a></span></dt><dt><span class="sect2"><a href="#x-config-monitors">5.4.6. 顯示器</a></span></dt><dt><span class="sect2"><a href="#x-config-input">5.4.7. 輸入裝置</a></span></dt><dd><dl><dt><span class="sect3"><a href="#x-config-input-keyboard">5.4.7.1. 鍵盤</a></span></dt><dt><span class="sect3"><a href="#x11-input-mice">5.4.7.2. 滑鼠與指標裝置</a></span></dt></dl></dd><dt><span class="sect2"><a href="#x-config-manual-configuration">5.4.8. 手動設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#x-fonts">5.5. 在 <span class="application">Xorg</span> 使用字型</a></span></dt><dd><dl><dt><span class="sect2"><a href="#type1">5.5.1. Type1 字型</a></span></dt><dt><span class="sect2"><a href="#truetype">5.5.2. <span class="trademark">TrueType</span>® 字型</a></span></dt><dt><span class="sect2"><a href="#antialias">5.5.3. 反鋸齒字型</a></span></dt></dl></dd><dt><span class="sect1"><a href="#x-xdm">5.6. X 顯示管理程式</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67045048">5.6.1. 設定 <span class="application">XDM</span></a></span></dt><dt><span class="sect2"><a href="#idp67086904">5.6.2. 設定遠端存取</a></span></dt></dl></dd><dt><span class="sect1"><a href="#x11-wm">5.7. 桌面環境</a></span></dt><dd><dl><dt><span class="sect2"><a href="#x11-wm-gnome">5.7.1. GNOME</a></span></dt><dt><span class="sect2"><a href="#x11-wm-kde">5.7.2. KDE</a></span></dt><dt><span class="sect2"><a href="#x11-wm-xfce">5.7.3. Xfce</a></span></dt></dl></dd><dt><span class="sect1"><a href="#x-compiz-fusion">5.8. 安裝 Compiz Fusion</a></span></dt><dd><dl><dt><span class="sect2"><a href="#x-compiz-video-card">5.8.1. 設定 FreeBSD nVidia 驅動程式</a></span></dt><dt><span class="sect2"><a href="#xorg-configuration">5.8.2. 設定 xorg.conf 來啟動桌面特效</a></span></dt><dt><span class="sect2"><a href="#compiz-fusion">5.8.3. 安裝與設定 Compiz Fusion</a></span></dt></dl></dd><dt><span class="sect1"><a href="#x11-understanding">5.9. 疑難排解</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67319352">5.9.1. 設定 <span class="trademark">Intel</span>® <code class="literal">i810</code> 繪圖晶片組</a></span></dt><dt><span class="sect2"><a href="#idp67330744">5.9.2. 加入寬螢幕平板顯示器到設定檔</a></span></dt><dt><span class="sect2"><a href="#compiz-troubleshooting">5.9.3. Compiz Fusion 疑難排解</a></span></dt></dl></dd></dl></dd></dl></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="introduction"></a>章 1. 簡介</h2></div><div><span class="authorgroup">Restructured, reorganized, and parts rewritten
	  by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Jim</span> <span class="surname">Mock</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#introduction-synopsis">1.1. 概述</a></span></dt><dt><span class="sect1"><a href="#nutshell">1.2. 歡迎使用 FreeBSD！</a></span></dt><dd><dl><dt><span class="sect2"><a href="#os-overview">1.2.1. FreeBSD 能做什麼？</a></span></dt><dt><span class="sect2"><a href="#introduction-nutshell-users">1.2.2. 誰在用 FreeBSD？</a></span></dt></dl></dd><dt><span class="sect1"><a href="#history">1.3. 關於 FreeBSD 計劃</a></span></dt><dd><dl><dt><span class="sect2"><a href="#intro-history">1.3.1. FreeBSD 歷史簡介</a></span></dt><dt><span class="sect2"><a href="#goals">1.3.2. FreeBSD 計劃目標</a></span></dt><dt><span class="sect2"><a href="#development">1.3.3. FreeBSD 開發模式</a></span></dt><dt><span class="sect2"><a href="#third-party-programs">1.3.4. 第三方程式</a></span></dt><dt><span class="sect2"><a href="#idp60675768">1.3.5. 其他文件</a></span></dt></dl></dd></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="introduction-synopsis"></a>1.1. 概述</h2></div></div></div><p>非常感謝您對 FreeBSD 感興趣！以下章節涵蓋 FreeBSD 計劃的各方面：比如它的歷史、目標、開發模式等等。</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FreeBSD 與其他作業系統之間的關係。</p></li><li class="listitem"><p>FreeBSD 計劃的歷史。</p></li><li class="listitem"><p>FreeBSD 計劃的目標。</p></li><li class="listitem"><p>FreeBSD 開源開發模式的基礎概念。</p></li><li class="listitem"><p>當然囉，還有 <span class="quote">“<span class="quote">FreeBSD</span>”</span> 這名字的由來。</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="nutshell"></a>1.2. 歡迎使用 FreeBSD！</h2></div></div></div><a id="idp60010936" class="indexterm"></a><p>FreeBSD 是一套開源、符合標準的類 Unix 的作業系統，適用於 x86 (32 與 64 位元), <span class="trademark">ARM</span>®, AArch64, <span class="trademark">RISC-V</span>®, <span class="trademark">MIPS</span>®, <span class="trademark">POWER</span>®, <span class="trademark">PowerPC</span>® 以及 Sun <span class="trademark">UltraSPARC</span>® 的電腦。它提供了現代作業系統所應具備的所有功能，例如：先佔式多工、記憶體保護、虛擬記憶體、多使用者架構、對稱多工處理 (SMP)、各種針對不同語言和框架的開源開發工具以及以 X Window 系統、KDE 及 GNOME 為主的桌面功能，而它有以下優勢：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>自由的開放原始碼授權</em></span>，授予您自由修改和擴充其原始碼並將其合併到開放原始碼專案或封閉的產品中的權力，不會對 Copyleft 授權施加典型的限制，也避免了授權不相容的潛在問題。</p></li><li class="listitem"><p><span class="emphasis"><em>強大的 TCP/IP 網路</em></span> <a id="idp60037432" class="indexterm"></a> - FreeBSD 以工業標準實作通訊協定並不斷改善效能與擴展性，這使得 FreeBSD 非常適合應用在伺服器、路由器/防火牆的角色 - 這也是許多公司和供應商使用它的原因。</p></li><li class="listitem"><p><span class="emphasis"><em>完全整合 OpenZFS</em></span>，包含 root-on-ZFS、ZFS 開機環境、故障管理、委託管理、對 Jail 的支援、FreeBSD 專屬的文件以及系統安裝程式的支援。</p></li><li class="listitem"><p><span class="emphasis"><em>鉅細靡遺的安全性功能</em></span>，從強制存取控制 (Mandatory Access Control, MAC) 框架到 Capsicum 功能以及沙盒機制。</p></li><li class="listitem"><p><span class="emphasis"><em>超過 3 萬個預編的套件</em></span>供所有支援的架構以及可簡單編譯依您的需求所客製的 Port 套件集。</p></li><li class="listitem"><p><span class="emphasis"><em>說明文件</em></span> - 除了操作手冊及由許多作者著作從系統管理到核心內部主題的書籍外，也有不僅只針對 Userspace Daemon、工具及設定檔，同樣也有針對核心驅動程式 APIs (第 9 節) 及各別驅動程式 (第 4 節) 的操作說明頁 ( <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=man&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">man</span>(1)</span></a> page)。</p></li><li class="listitem"><p><span class="emphasis"><em>簡單且具一致性的檔案庫架構與編譯系統</em></span> - FreeBSD 對所有的元件、核心與 Userspace 使用單一的檔案庫，加上統一、易於客製的編譯系統以及嚴謹的開發流程，讓 FreeBSD 的編譯基礎架構更容易與您產品的整合。</p></li><li class="listitem"><p><span class="emphasis"><em>忠於 Unix 哲學</em></span>，偏好可組合而非具寫死的 <span class="quote">“<span class="quote">多合一</span>”</span> 單一 Daemon。</p></li><li class="listitem"><p><a id="idp60058680" class="indexterm"></a> <span class="emphasis"><em>Linux 執行檔 (Binary) 相容性</em></span>，無需虛擬化即可執行許多 Linux 執行檔。</p></li></ul></div><p>FreeBSD 系統是基於美國加州大學柏克萊分校的電腦系統研究組 (Computer Systems Research Group 也就是 CSRG) 所發行的 4.4BSD-Lite<a id="idp60066872" class="indexterm"></a>，繼承了 BSD 系統開發的優良傳統。 除了由 CSRG 所提供的高品質的成果外，FreeBSD 計劃也投入了上千人時在擴充及微調，來讓系統在真實情境下能達到最大的效能與可靠性。 FreeBSD 提供了其他開源與商業產品的效能及穩定性，並結合其他產品所沒有的尖端功能。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="os-overview"></a>1.2.1. FreeBSD 能做什麼？</h3></div></div></div><p>FreeBSD 能應用的情境完全限制在你的想像力上。 從軟體開發到工廠自動化，庫存管控到遠程衛星天線的方位角校正；若您的需求可以用商用的 <span class="trademark">UNIX</span>® 產品來達成，那麼極有可能使用 FreeBSD 也能辦到！ FreeBSD 也受益於來自於全球各研究中心及大學所開發的數千個高品質的軟體 ，這些通常只需要花費很少的費用或根本就是免費的。</p><p>由於每個人都可以取得 FreeBSD 的原始程式碼， 這個系統可以被量身訂做成能執行任何原本完全無法想像的功能或計劃， 而對於從各廠商取得的作業系統通常沒有辦法這樣地被修改。 以下提供一些人們使用 FreeBSD 的例子：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>網際網路服務：</em></span> FreeBSD 內建強勁的網路功能使它成為網路服務 (如下例) 的理想平台：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>網頁伺服器</p></li><li class="listitem"><p>IPv4 及 IPv6 路由</p></li><li class="listitem"><p>防火牆<a id="idp60095800" class="indexterm"></a>以及 NAT<a id="idp60096952" class="indexterm"></a> (<span class="quote">“<span class="quote">IP 偽裝</span>”</span>) 通訊閘</p></li><li class="listitem"><p>檔案傳輸協定伺服器<a id="idp60101432" class="indexterm"></a></p></li><li class="listitem"><p><a id="idp60104760" class="indexterm"></a> <a id="idp60107320" class="indexterm"></a> 電子郵件伺服器</p></li><li class="listitem"><p>還有更多...</p></li></ul></div></li><li class="listitem"><p><span class="emphasis"><em>教育：</em></span>您是電腦科學相關領域的學生嗎？再也沒有比使用 FreeBSD 能學到更多作業系統、計算機結構、及網路的方法了。其中許多免費提供的 CAD，數學和圖形設計套件對於那些需要在電腦完成 <span class="emphasis"><em>其他</em></span> 工作的人也非常有用！</p></li><li class="listitem"><p><span class="emphasis"><em>研究：</em></span>有了完整的原始程式碼，FreeBSD 是研究作業系統及電腦科學的極佳環境。 具有免費且自由取得特性的 FreeBSD 也使得一個分置兩地的合作計劃，不必擔心版權及系統開放性的問題， 而能自在的交流。</p></li><li class="listitem"><p><span class="emphasis"><em>網路：</em></span> 你如果需要 路由器<a id="idp60124216" class="indexterm"></a>、名稱伺服器 (DNS)<a id="idp60126008" class="indexterm"></a> 或安全的防火牆， FreeBSD 可以輕易的將你沒有用到的 386 或 486 PC 變身成為絕佳的伺服器，甚至具有過濾封包的功能。</p></li><li class="listitem"><p><span class="emphasis"><em>嵌入式：</em></span> FreeBSD 是一套可用來建立嵌入式系統的傑出平台。 <a id="idp60130488" class="indexterm"></a> 支援 <span class="trademark">ARM</span>®, <span class="trademark">MIPS</span>® 以及 <span class="trademark">PowerPC</span>® 平台，再加上健全的網路環境、尖端的功能以及自由的 <a class="link" href="../../../../doc/en_US.ISO8859-1/books/faq/introduction.html#bsd-license-restrictions" target="_top">BSD 授權條款</a>，FreeBSD 成為用來建置嵌入式路由器、防火牆及其他裝置的絕佳基礎。</p></li><li class="listitem"><p><a id="idp60155320" class="indexterm"></a> <a id="idp60157368" class="indexterm"></a> <a id="idp60159160" class="indexterm"></a> <span class="emphasis"><em>桌面:</em></span> FreeBSD 同時也是低成本桌面解決方案中不錯的選擇，使用了免費的 X11 伺服器。FreeBSD 提供許多開源桌面環境可選擇，包含了標準 <span class="application">GNOME</span> 及 <span class="application">KDE</span> 圖型化使用者介面。FreeBSD 甚至可以透過中央伺服器做 <span class="quote">“<span class="quote">無磁碟</span>”</span> 開機，讓個人工作站變的更便宜、更易於管理。</p></li><li class="listitem"><p><span class="emphasis"><em>軟體開發：</em></span> 基本安裝的 FreeBSD 就包含了完整的程式開發工具，如 C/C++<a id="idp60167736" class="indexterm"></a> 編譯器及除錯器。 透過 Port 與套件管理系統也可支援需多其他語言。</p></li></ul></div><p>你可以經由燒錄 CD-ROM、DVD 或是從 FTP 站上抓回 FreeBSD。 詳情請參閱 <a class="xref" href="#mirrors" title="附錄 A. 取得 FreeBSD">附錄 A, <em>取得 FreeBSD</em></a> 取得 FreeBSD。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="introduction-nutshell-users"></a>1.2.2. 誰在用 FreeBSD？</h3></div></div></div><a id="idp60173240" class="indexterm"></a><p>FreeBSD 以其網頁 (Web) 服務功能而聞名 - 在 FreeBSD 上運作的網站包括 <a class="link" href="https://news.ycombinator.com/" target="_top">Hacker News</a>, <a class="link" href="http://www.netcraft.com/" target="_top">Netcraft</a>, <a class="link" href="http://www.163.com/" target="_top">NetEase</a>, <a class="link" href="https://signup.netflix.com/openconnect" target="_top">Netflix</a>, <a class="link" href="http://www.sina.com/" target="_top">Sina</a>, <a class="link" href="http://www.sony.co.jp/" target="_top">Sony Japan</a>, <a class="link" href="http://www.rambler.ru/" target="_top">Rambler</a>, <a class="link" href="http://www.yahoo.com/" target="_top">Yahoo!</a> 及 <a class="link" href="http://www.yandex.ru/" target="_top">Yandex</a>。</p><p>FreeBSD 先進的功能、成熟的安全性、可預測的發佈週期以及自由的授權條款，讓 FreeBSD 已經被用來做為建立許多商業、開源應用、裝置以及產品的平台，有許多世界上最大的資訊公司使用 FreeBSD：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://www.apache.org/" target="_top">Apache</a> <a id="idp60207800" class="indexterm"></a> - Apache 軟體基金會中大部分面對大眾的基礎設施，包括可能是世界上最大的 SVN 檔案庫 (擁有超過 140 萬次提交) 都是在 FreeBSD 上運作。</p></li><li class="listitem"><p><a class="link" href="http://www.apple.com/" target="_top">Apple</a> <a id="idp60212408" class="indexterm"></a> - OS X 大量借鑒 FreeBSD 的網路 Stack、虛擬檔案系統以及許多使用者空間的元件。Apple iOS 中含有從 FreeBSD 借鑒來的元素。</p></li><li class="listitem"><p><a class="link" href="http://www.cisco.com/" target="_top">Cisco</a> <a id="idp60217400" class="indexterm"></a> -  IronPort 網路安全及反垃圾郵件設備是採用改良後 FreeBSD 核心來運作。</p></li><li class="listitem"><p><a class="link" href="http://www.citrix.com/" target="_top">Citrix</a> <a id="idp60223800" class="indexterm"></a> - 安全設備的 NetScaler 產品線提供的第 4-7 層的負載均衡、內容快取、應用層防火牆、安全的 VPN 以及行動雲端網路存取，皆運用了 FreeBSD Shell 強大的功能。</p></li><li class="listitem"><p><a class="link" href="https://www.emc.com/isilon" target="_top">Dell EMC Isilon</a> <a id="idp60230584" class="indexterm"></a> - Isilon 的企業存儲設備是以 FreeBSD 為基礎。非常自由的 FreeBSD 授權條款讓 Isilon 整合了它們的智慧財產到整個核心，並專注打造自己的產品，而不是一個作業系統。</p></li><li class="listitem"><p><a class="link" href="http://www.quest.com/KACE" target="_top">Quest KACE</a> <a id="idp60235832" class="indexterm"></a> - KACE 系統管理設備中運作了 FreeBSD，是因為 FreeBSD 的可靠性、可擴展性以及支持其持續發展的社群。</p></li><li class="listitem"><p><a class="link" href="http://www.ixsystems.com/" target="_top">iXsystems</a> <a id="idp60240312" class="indexterm"></a> - 統合存儲 (Unified Storage) 設備的 TrueNAS 產品線是以 FreeBSD 為基礎。除了該公司自己的商業產品外，iXsystems 也管理著 TrueOS 和 FreeNAS 兩個開源計劃的開發。</p></li><li class="listitem"><p><a class="link" href="http://www.juniper.net/" target="_top">Juniper</a> <a id="idp60244792" class="indexterm"></a> -  JunOS 作業系統驅動了所有的 Juniper 網絡設備 (包括路由器，交換器，安全與網絡設備) 便是以 FreeBSD 為基礎。Juniper 在眾多廠商之中，展現了計劃與商業產品供應商之間的共生關係。由 Juniper 所開發的改進內容會回饋給 FreeBSD 來降低未來新功能從  FreeBSD 整合回 JunOS 的複雜性。</p></li><li class="listitem"><p><a class="link" href="http://www.mcafee.com/" target="_top">McAfee</a> <a id="idp60248888" class="indexterm"></a> - SecurOS 是 McAfee 企業防火牆產品的基礎，其中包含了 Sidewinder ，也是以 FreeBSD 為基礎。</p></li><li class="listitem"><p><a class="link" href="http://www.netapp.com/" target="_top">NetApp</a> <a id="idp60253752" class="indexterm"></a> - 存儲設備中的 Data ONTAP GX 產品線是以 FreeBSD 為基礎。除此之外，NetApp 還貢獻了回 FreeBSD 許多功能，包括新 BSD 條款授權的 hypervisor, bhyve。</p></li><li class="listitem"><p><a class="link" href="http://www.netflix.com/" target="_top">Netflix</a> <a id="idp60257976" class="indexterm"></a> - Netflix 用來以串流傳送電影到客戶的 OpenConnect 設備是以 FreeBSD 為基礎。 Netflix 也做了大量貢獻到程式碼庫，並致力於維持與主線 FreeBSD 的零修正關係。Netflix 的 OpenConnect 設備負責了北美所有的網路流量 32％ 以上。</p></li><li class="listitem"><p><a class="link" href="http://www.sandvine.com/" target="_top">Sandvine</a> <a id="idp60262456" class="indexterm"></a> - Sandvine 使用 FreeBSD 作為它的高性能即時網路處理平台的基礎來建立它們的智慧網路策略控制產品。</p></li><li class="listitem"><p><a class="link" href="http://www.sony.com/" target="_top">Sony</a> <a id="idp60267320" class="indexterm"></a> - PlayStation 4 遊戲主機使用了修改過的 FreeBSD 版本來運作。</p></li><li class="listitem"><p><a class="link" href="http://www.sophos.com/" target="_top">Sophos</a> <a id="idp60272184" class="indexterm"></a> - Sophos 電子郵件設備產品是以加強防護 (Hardened) 的 FreeBSD 為基礎，可掃描入站郵件中的垃圾郵件和病毒，同時也可監控出站郵件中的惡意軟體及敏感資訊。</p></li><li class="listitem"><p><a class="link" href="http://www.spectralogic.com/" target="_top">Spectra Logic</a> <a id="idp60289208" class="indexterm"></a> - 儲藏級儲存設備的 nTier 產品線以 FreeBSD 和 OpenZFS 來運作。</p></li><li class="listitem"><p><a class="link" href="https://www.stormshield.eu" target="_top">Stormshield</a> <a id="idp60296888" class="indexterm"></a> - Stormshield 網路安全設備使用了硬體化版本的 FreeBSD 做為基礎，BSD 授權條款讓他們可將其智慧財產與系統整合並同時回饋大量有趣的發展給社群。</p></li><li class="listitem"><p><a class="link" href="http://www.weather.com/" target="_top">The Weather Channel</a> <a id="idp60302648" class="indexterm"></a> - 被安裝在各地有線電視營運商前端，負責加入當地天氣預報到有線電視網路節目的 IntelliStar 設備便是使用 FreeBSD。</p></li><li class="listitem"><p><a class="link" href="http://www.verisign.com/" target="_top">Verisign</a> <a id="idp60307384" class="indexterm"></a> - VeriSign 主要經營 .com 與 .net 根網域名稱註冊業務以及隨附的 DNS 基礎設施運作。這些基礎設施的運作仰賴各種不同的網路作業系統包括 FreeBSD 來確保不會有單點故障的問題。</p></li><li class="listitem"><p><a class="link" href="http://www.voxer.com/" target="_top">Voxer</a> <a id="idp60311096" class="indexterm"></a> - Voxer 使用了 FreeBSD 的 ZFS 來驅動行動語音通訊平台，讓 Voxer 從 Solaris 改使用 FreeBSD 的原因是 FreeBSD 擁有詳盡的文件、更大型且活躍的社群、較便利的開發人員環境。除了提供關鍵的 <acronym class="acronym">ZFS</acronym> 和 DTrace 功能之外 FreeBSD 的 <acronym class="acronym">ZFS</acronym> 也支援了 TRIM。</p></li><li class="listitem"><p><a class="link" href="http://www.whatsapp.com/" target="_top">WhatsApp</a> <a id="idp60317624" class="indexterm"></a> - 當 WhatsApp 面臨需要一個每台伺服器能夠同時處理超過 100 萬個 TCP 連線的平台時，它們選擇了 FreeBSD。它們接著擴大規模到每台伺服器處理超過 250 萬的連線。</p></li><li class="listitem"><p><a class="link" href="http://wheelsystems.com/" target="_top">Wheel Systems</a> <a id="idp60338104" class="indexterm"></a> - FUDO 安全性設備讓企業可以監控、控制、記錄以及稽查在其系統中作業的承包商與管理員。這些功能皆是以 FreeBSD 最佳的安全性功能為基礎，包括 ZFS, GELI, Capsicum, HAST 及 auditdistd。</p></li></ul></div><p>FreeBSD 也催生了數個相關的開源計劃：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://bsdrp.net/" target="_top">BSD Router</a> <a id="idp60344760" class="indexterm"></a> - 以 FreeBSD 為基礎的大型企業路由器替代方案，專門設計為可在標準 PC 硬體上運作。</p></li><li class="listitem"><p><a class="link" href="http://www.freenas.org/" target="_top">FreeNAS</a> <a id="idp60349624" class="indexterm"></a> - 專為網路檔案伺服器設備使用所設計的 FreeBSD。提供了以 Python 為基礎的網頁介面來簡化 UFS 與 ZFS 檔案系統的管理，支援了 NFS、SMB/ CIFS、AFP、FTP 與 iSCSI，還有以 FreeBSD Jail 為基礎的套件系統。</p></li><li class="listitem"><p><a class="link" href="http://www.ghostbsd.org/" target="_top">GhostBSD</a> <a id="idp60354488" class="indexterm"></a> - 採用 Gnome 桌面環境的 FreeBSD 發行版。</p></li><li class="listitem"><p><a class="link" href="http://mfsbsd.vx.sk/" target="_top">mfsBSD</a> <a id="idp60359224" class="indexterm"></a> - 用來建置可完全從記憶體執行 FreeBSD 系統映像檔工具。</p></li><li class="listitem"><p><a class="link" href="http://www.nas4free.org/" target="_top">NAS4Free</a> <a id="idp60366904" class="indexterm"></a> - 以 FreeBSD 及 PHP 驅動網頁介面為基礎的檔案伺服器。</p></li><li class="listitem"><p><a class="link" href="http://www.opnsense.org/" target="_top">OPNSense</a> <a id="idp60384824" class="indexterm"></a> - OPNsense 是一個以 FreeBSD 為基礎的開源、易於使用及易於建置的防火牆和路由平台。OPNsense 有大多數在昂貴的商業防火牆上才有的功能。它帶來了商業產品的豐富功能集，同時擁有開放和安全的來源。</p></li><li class="listitem"><p><a class="link" href="https://www.trueos.org" target="_top">TrueOS</a> <a id="idp60389688" class="indexterm"></a> - 訂製版本的 FreeBSD，裝備了給桌面使用者使用的圖型化工具來展示 FreeBSD 強大的功能給所有使用者，專門設計來緩解使用者在 Windows 與 OS X 間的過渡。</p></li><li class="listitem"><p><a class="link" href="http://www.pfsense.org/" target="_top">pfSense</a> <a id="idp60394680" class="indexterm"></a> - 以 FreeBSD 為基礎的防火牆發行版，支援巨型陣列及大規模 IPv6。</p></li><li class="listitem"><p><a class="link" href="http://zrouter.org/" target="_top">ZRouter</a> <a id="idp60402744" class="indexterm"></a> - 嵌入式裝置韌體的開源替代方案，以 FreeBSD 為基礎，專門設計來取代現成路由器上的專用韌體。</p></li></ul></div><p>在 FreeBSD 基金會網站上可以找到<a class="link" href="https://www.freebsdfoundation.org/about/testimonials/" target="_top">以 FreeBSD 為基礎的產品與服務的公司的推薦</a> 清單。 Wikipedia 也維護了一份<a class="link" href="https://en.wikipedia.org/wiki/List_of_products_based_on_FreeBSD" target="_top">以 FreeBSD 為基礎的產品清單</a>。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="history"></a>1.3. 關於 FreeBSD 計劃</h2></div></div></div><p>接下來講的是 FreeBSD 計劃的背景，包含歷史、計劃目標以及開發模式。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="intro-history"></a>1.3.1. FreeBSD 歷史簡介</h3></div></div></div><a id="idp60467000" class="indexterm"></a><a id="idp60468664" class="indexterm"></a><a id="idp60470328" class="indexterm"></a><a id="idp60471608" class="indexterm"></a><a id="idp60473272" class="indexterm"></a><p>FreeBSD 計畫起源於 1993 年初， 那是源自於維護一組『非官方 386BSD 修正工具』計劃的最後三個協調人 Nate Williams，Rod Grimes 和 Jordan Hubbard。</p><a id="idp60477624" class="indexterm"></a><p>最初的目標是做出一份 386BSD 的中間版本的快照 (Snapshot) 來修正使用修正工具 (Patchkit) 機制無法解決的數個問題，也因此早期的計劃名稱叫做 386BSD 0.5 或 386BSD Interim 便是這個原因。</p><a id="idp60480952" class="indexterm"></a><p>386BSD 是 Bill Jolitz 的作業系統，在當時就已經忍受了將近一年的忽視，隨著修正工具日漸龐大的令人不舒服，他們決定提供一份過渡性的 <span class="quote">“<span class="quote">簡潔</span>”</span> 快照來幫助 Bill。 然而，由於 Bill Jolitz 忽然決定取消其對該計劃的認可，且沒有明確指出未來的打算，所以該計劃便突然面臨中止。</p><a id="idp60486584" class="indexterm"></a><a id="idp60489144" class="indexterm"></a><p>這三人認為這個目標即始沒有 Bill 的支持仍有保留的價值，最後他們採用 David Greenman 丟銅板決定的名字，也就是 "FreeBSD"。在詢問了當時的一些使用者意見之後決定了最初的目標，隨著目標越來越明確便開始著手進行。Jordan 找了 Walnut Creek CD-ROM 商討，著眼於如何改進 FreeBSD 的發行通路，讓那些不便上網的人可簡單的取得。 Walnut Creek CD-ROM 不只贊成以 CD 來發行 FreeBSD 的想法，同時提供了一台機器以及快速的網路。 若不是 Walnut Creek CD-ROM 在那個時間上史無前例的信任，這個默默無名的計劃很可能不會成為現在的 FreeBSD 快速的成長到今日這樣的規模。</p><a id="idp60491576" class="indexterm"></a><a id="idp60493240" class="indexterm"></a><a id="idp60495032" class="indexterm"></a><a id="idp60500536" class="indexterm"></a><a id="idp60502072" class="indexterm"></a><p>第一張以 CD-ROM (及網路) 發行的版本為 FreeBSD 1.0，是在 1993 年十二月發佈。 該版本採用了 U.C. Berkeley 以磁帶方式發行的 4.3BSD-Lite (<span class="quote">“<span class="quote">Net/2</span>”</span>) 及許多來自於 386BSD 和自由軟體基金會的元件為基礎。對於第一次發行而言還算成功，我們又接著於 1994 年 5 月發行了相當成功的 FreeBSD 1.1。</p><a id="idp60505656" class="indexterm"></a><a id="idp60507192" class="indexterm"></a><a id="idp60508216" class="indexterm"></a><a id="idp60509624" class="indexterm"></a><p>然而此後不久，另一個意外的風暴在 Novell 與 U.C. Berkeley 關於 Berkeley Net/2 磁帶之法律地位的訴訟確定之後形成。 U.C. Berkeley 承認大部份的 Net/2 的程式碼都是<span class="quote">“<span class="quote">侵佔來的</span>”</span>且是屬於 Novell 的財產 -- 事實上是當時不久前從 AT&amp;T 取得的。 Berkeley 得到的是 Novell 對於 4.4BSD-Lite 的<span class="quote">“<span class="quote">祝福</span>”</span>，最後當 4.4BSD-Lite 終於發行之後，便不再是侵佔行為。 而所有現有 Net/2 使用者都被強烈建議更換新版本，這包括了 FreeBSD。 於是，我們被要求於 1994 年 6 月底前停止散佈以 Net/2 為基礎的產品。在此前提之下，本計劃被允許在期限以前作最後一次發行，也就是 FreeBSD 1.1.5.1。</p><p>FreeBSD 便開始了這宛如『重新發明輪子』的艱鉅工作 -- 從全新的且不完整的 4.4BSD-Lite 重新整合。 這個 <span class="quote">“<span class="quote">Lite</span>”</span> 版本是不完整的，因為 Berkeley 的 CSRG 已經刪除了大量在建立一個可以開機執行的系統所需要的程式碼 (基於若干法律上的要求)，且該版本在 Intel 平台的移植是非常不完整的。 直到 1994 年 11 月本計劃才完成了這個轉移， 同時在該年 12 月底以 CD-ROM 以及網路的形式發行了 FreeBSD 2.0。 雖然該份版本在當時有點匆促粗糙，但仍是富有意義的成功。 隨之於 1995 年 6 月又發行了更容易安裝，更好的 FreeBSD 2.0.5。</p><p>自那時以來，FreeBSD 在每一次對先前版本改進穩定性、速度及功能時便會發佈一個新的發佈版本。</p><p>目前，長期的開發計畫繼續在 10.X-CURRENT (trunk) 分支中進行，而 10.X 的快照 (Snapshot) 版本可以在 <a class="link" href="ftp://ftp.FreeBSD.org/pub/FreeBSD/snapshots/" target="_top">快照伺服器</a> 取得。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="goals"></a>1.3.2. FreeBSD 計劃目標</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Jordan</span> <span class="surname">Hubbard</span></span>. </span></div></div></div><a id="idp60527416" class="indexterm"></a><p>FreeBSD 計劃的目標在於提供可作任意用途的軟體而不附帶任何限制條文。 我們之中許多人對程式碼 (以及計畫本身) 都有非常大的投入， 因此，當然不介意偶爾有一些資金上的補償，但我們並沒打算堅決地要求得到這類資助。 我們認為我們的首要<span class="quote">“<span class="quote">使命</span>”</span>是為任何人提供程式碼， 不管他們打算用這些程式碼做什麼， 因為這樣程式碼將能夠被更廣泛地使用，從而發揮其價值。 我認為這是自由軟體最基本的，同時也是我們所倡導的一個目標。</p><a id="idp60536248" class="indexterm"></a><a id="idp60537144" class="indexterm"></a><a id="idp60538552" class="indexterm"></a><p>我們程式碼樹中，有若干是以 GNU 通用公共授權條款 (GPL) 或者 GNU 較寬鬆通用公共授權條款 (LGPL) 發佈的那些程式碼帶有少許的附加限制，還好只是強制性的要求開放程式碼而不是別的。 由於使用 GPL 的軟體在商業用途上會增加若干複雜性，因此，如果可以選擇的話， 我們會比較喜歡使用限制相對更寬鬆的 BSD 版權來發佈軟體。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="development"></a>1.3.3. FreeBSD 開發模式</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Satoshi</span> <span class="surname">Asami</span></span>. </span></div></div></div><a id="idp60564792" class="indexterm"></a><p>FreeBSD 的開發是一個非常開放且具彈性的過程，就像從 <a class="link" href="../../../../doc/zh_TW.UTF-8/articles/contributors/article.html" target="_top">貢獻者名單</a> 所看到的，是由全世界成千上萬的貢獻者發展起來的。 FreeBSD 的開發基礎架構允許數以百計的開發者透過網際網路協同工作。 我們也經常關注著那些對我們的計畫感興趣的新開發者和新的創意， 那些有興趣更進一步參與計劃的人只需要在 <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hackers" target="_top">FreeBSD 技術討論郵遞論壇</a> 連繫我們。 <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-announce" target="_top">FreeBSD 公告郵遞論壇</a> 對那些希望了解我們進度的人也是相當有用的。</p><p>無論是單獨開發者或者封閉式的團隊合作，多瞭解 FreeBSD 計劃和它的開發過程會是不錯的：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">SVN 檔案庫<a id="development-cvs-repository"></a></span></dt><dd><p><a id="idp60580920" class="indexterm"></a> <a id="idp60582456" class="indexterm"></a> <a id="idp60584632" class="indexterm"></a> <a id="idp60587448" class="indexterm"></a> <a id="idp60589112" class="indexterm"></a> <a id="idp60594360" class="indexterm"></a>過去數年來 FreeBSD 的中央原始碼樹 (Source tree) 一直是以 <a class="link" href="http://www.nongnu.org/cvs/" target="_top">CVS</a> (Concurrent Versions System) 來維護的， 它是一套免費的原始碼控管工具。 從 2008 年 6 月起， FreeBSD 計劃開始改用 <a class="link" href="http://subversion.tigris.org" target="_top">SVN</a> (Subversion)。 這是一個必要的更換動作，因為隨著原始碼樹及歷史版本儲存的數量不斷快速擴張，<span class="application">CVS</span> 先天的技術限制越來越明顯。 文件計劃與 Port 套件集檔案庫也同樣於 2012 年 5 月及 2012 年 7 月由 <span class="application">CVS</span> 改為 <span class="application">SVN</span>。請參考 <a class="link" href="#synching">同步您的原始碼樹</a> 一節來取得有關如何取得 FreeBSD <code class="literal">src/</code> 檔案庫的更多資訊，以及 <a class="link" href="#ports-using" title="4.5. 使用 Port 套件集">使用 Port 套件集</a> 了解如何取得 FreeBSD Port 套件集。</p></dd><dt><span class="term">提交者名單<a id="development-committers"></a></span></dt><dd><p>所謂的 <em class="firstterm">提交者 (Committer)</em> 指的是對 Subversion 原始碼樹有 <span class="emphasis"><em>寫入</em></span> 權限的人， 並且被授予修改 FreeBSD 原始碼的權限。 (<span class="quote">“<span class="quote">committer</span>”</span> 一詞源自版本管理系統中的 <code class="command">commit</code> 指令，該指令是用來把新的修改提交給檔案庫)。 任何人都可以回報問題到 <a class="link" href="https://bugs.FreeBSD.org/submit/" target="_top">Bug Database</a>，在回報問題之前，可以使用 FreeBSD 郵遞清單、IRC 頻道或論壇來確認問題真的是一個錯誤 (Bug)。</p></dd><dt><span class="term">FreeBSD 核心團隊<a id="development-core"></a></span></dt><dd><p>如果把 FreeBSD 看成是一家公司的話， <em class="firstterm">FreeBSD 核心團隊 (FreeBSD core team)</em><a id="idp60632632" class="indexterm"></a> 就相當於公司的董事會。 核心團隊的主要職責在於確保此計劃的整體有良好的架構，以朝著正確的方向發展。 此外，邀請敬業且負責的開發者加入提交者的行列也是核心團隊的職責之一，隨著其他新成員的加入也招募新的核心團隊成員。 目前的核心團隊是在 2018 年 7 月從提交者候選人之中選出來的，這個選舉每兩年會舉辦一次。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">如同多數的開發者，核心團隊大部分成員加入 FreeBSD 開發都是志工性質而已， 並未從本計劃中獲得任何薪酬，所以這只是一個 <span class="quote">“<span class="quote">承諾</span>”</span> 不應該被誤解為 <span class="quote">“<span class="quote">保證支援</span>”</span> 才對。 前面用 <span class="quote">“<span class="quote">董事會</span>”</span> 來舉例可能不是很恰當，或許我們應該說： 他們是一群自願放棄原本的優渥生活、個人其他領域成就， 而選擇投入 FreeBSD 開發的熱血有為者才對！</p></div></dd><dt><span class="term">非官方貢獻者</span></dt><dd><p>最後一點，但這點絕非最不重要的， 最大的開發者團隊就是持續為我們提供回饋以及錯誤修正的使用者自己。 與 FreeBSD 非核心開發者互動的主要方式，便是透過訂閱 <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hackers" target="_top">FreeBSD 技術討論郵遞論壇</a> 來進行溝通，這方面可參考，請參閱 <a class="xref" href="#eresources" title="附錄 C. 網路資源">附錄 C, <em>網路資源</em></a> 以瞭解各式不同的 FreeBSD 郵遞論壇。</p><p><em class="citetitle"><a class="link" href="../../../../doc/zh_TW.UTF-8/articles/contributors/article.html" target="_top">FreeBSD 貢獻者名單</a></em> <a id="idp60647480" class="indexterm"></a> 相當長且不斷成長中， 只要有貢獻就會被列入其中， 要不要立即考慮貢獻 FreeBSD 一些回饋呢？</p><p>提供原始碼並非為這個計劃做貢獻的唯一方式； 需要大家投入的完整工作清單請參閱 <a class="link" href="../../../../index.html" target="_top">FreeBSD 計畫網站</a>。</p></dd></dl></div><p>總而言之，我們的開發模式像是由鬆散的同心圓所組織。這個集中模式的設計為的是讓 FreeBSD 的<span class="emphasis"><em>使用者</em></span>更便利，可以很容易的追蹤同一個中央的程式庫，避免把潛在的貢獻者排除在外！而我們的目標是提供一個穩定的作業系統，並有大量相關的 <a class="link" href="#ports" title="章 4. 安裝應用程式：套件與 Port">應用程式</a>，讓使用者能夠輕鬆的安裝與使用 — 而這個開發模式對我們要完成這個目標來說運作的非常好。</p><p>我們對於那些想要加入 FreeBSD 開發者的期待是： 請保持如同前人一樣的投入，以確保繼續成功！</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="third-party-programs"></a>1.3.4. 第三方程式</h3></div></div></div><p>除了基礎發行版之外，FreeBSD 提供了擁有上千個常用的程式的移植軟體的套件集，在撰寫本文的同時，已有超過 24,000 個 Port！Port 的範圍從 HTTP 伺服器到遊戲、語系、編輯器，幾乎所有東西都在裡面。完整的 Port 套件集需要將近 500 MB。要編譯一個 Port 您只需要切換目錄到您想安裝的程式目錄，然後輸入 <code class="command">make install</code>，接著系統便會處理剩下的動作。您編譯的每個 Port 完整原始發行版內容是動態下載的，所以您只需要有足夠的磁碟空間來編譯您想要的 Port。幾乎所有 Port 都提供已經預先編譯好的<span class="quote">“<span class="quote">套件</span>”</span>，您可以透過簡單的指令來安裝 (<code class="command">pkg install</code>)，提供那些不想要自行從原始碼編譯的人使用。更多有關套件與 Port 的資訊可於 <a class="xref" href="#ports" title="章 4. 安裝應用程式：套件與 Port">章 4, <em>安裝應用程式：套件與 Port</em></a> 取得。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp60675768"></a>1.3.5. 其他文件</h3></div></div></div><p>所有支援的 FreeBSD 版本都會在安裝程式中提供一個選項，讓您可以在初始化系統安裝的階段安裝額外的說明文件到 <code class="filename">/usr/local/share/doc/freebsd</code>。說明文件也可在往後隨時使用套件安裝，詳細說明於 <a class="xref" href="#doc-ports-install-package" title="23.3.2. 自 Port 更新說明文件">節 23.3.2, “自 Port 更新說明文件”</a>。您也可以使用任何支援 HTML 的瀏覽器進入下列 URL 檢視已安裝在本機的手冊：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">FreeBSD 使用手冊</span></dt><dd><p xml:lang="en" lang="en"><a class="link" href="file://localhost/usr/local/share/doc/freebsd/handbook/index.html" target="_top"><code class="filename">/usr/local/share/doc/freebsd/handbook/index.html</code></a></p></dd><dt><span class="term">FreeBSD 常見問答集</span></dt><dd><p xml:lang="en" lang="en"><a class="link" href="file://localhost/usr/local/share/doc/freebsd/faq/index.html" target="_top"><code class="filename">/usr/local/share/doc/freebsd/faq/index.html</code></a></p></dd></dl></div><p>此外，可在下列網址找到最新版 (也是更新最頻繁的版本)：<code class="uri"><a class="uri" href="https://www.FreeBSD.org/" target="_top">https://www.FreeBSD.org/</a></code>。</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall"></a>章 2. 安裝 FreeBSD</h2></div><div><span class="authorgroup">Restructured, reorganized, and parts rewritten
	  by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Jim</span> <span class="surname">Mock</span></span>. </span></div><div><span class="authorgroup">Updated for bsdinstall by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Gavin</span> <span class="surname">Atkinson</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Warren</span> <span class="surname">Block</span></span>. </span></div><div><span class="authorgroup">Updated for root-on-ZFS by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Allan</span> <span class="surname">Jude</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#bsdinstall-synopsis">2.1. 概述</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-hardware">2.2. 最低硬體需求</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-pre">2.3. 安裝前準備工作</a></span></dt><dd><dl><dt><span class="sect2"><a href="#bsdinstall-installation-media">2.3.1. 準備安裝的媒體</a></span></dt><dd><dl><dt><span class="sect3"><a href="#bsdinstall-usb">2.3.1.1. 寫入映象檔到 <acronym class="acronym">USB</acronym></a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#bsdinstall-start">2.4. 開始安裝</a></span></dt><dd><dl><dt><span class="sect2"><a href="#bsdinstall-starting-i386">2.4.1. 在 <span class="trademark">i386</span>™ 及 amd64 開機</a></span></dt><dt><span class="sect2"><a href="#idp63641400">2.4.2. 在 <span class="trademark">PowerPC</span>® 開機</a></span></dt><dt><span class="sect2"><a href="#idp63661752">2.4.3. 在 <span class="trademark">SPARC64</span>® 開機</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-view-probe">2.4.4. FreeBSD 開機選單</a></span></dt></dl></dd><dt><span class="sect1"><a href="#using-bsdinstall">2.5. 使用 <span class="application">bsdinstall</span></a></span></dt><dd><dl><dt><span class="sect2"><a href="#bsdinstall-keymap">2.5.1. 選擇鍵盤對應表選單</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-hostname">2.5.2. 設定主機名稱</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-components">2.5.3. 選擇要安裝的元件</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-netinstall">2.5.4. 從網路安裝</a></span></dt></dl></dd><dt><span class="sect1"><a href="#bsdinstall-partitioning">2.6. 配置磁碟空間</a></span></dt><dd><dl><dt><span class="sect2"><a href="#configtuning-initial">2.6.1. 規劃分割區配置</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-part-guided">2.6.2. 引導式磁碟分割</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-part-manual">2.6.3. 手動磁碟分割</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-part-zfs">2.6.4. Root-on-ZFS 自動磁碟分割</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-part-shell">2.6.5. Shell 模式磁碟分割</a></span></dt></dl></dd><dt><span class="sect1"><a href="#bsdinstall-final-warning">2.7. 確認安裝</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-post">2.8. 安裝後注意事項</a></span></dt><dd><dl><dt><span class="sect2"><a href="#bsdinstall-post-root">2.8.1. 設定 <code class="systemitem">root</code> 密碼</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-config-network-dev">2.8.2. 設定網路介面卡</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-timezone">2.8.3. 設定時區</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-sysconf">2.8.4. 開啟服務</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-crashdump">2.8.5. 開啟當機資訊 (Crash Dump)</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-addusers">2.8.6. 新增使用者</a></span></dt><dt><span class="sect2"><a href="#bsdinstall-final-conf">2.8.7. 最後設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#bsdinstall-install-trouble">2.9. 疑難排解</a></span></dt><dt><span class="sect1"><a href="#using-live-cd">2.10. 使用 Live <acronym class="acronym">CD</acronym></a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bsdinstall-synopsis"></a>2.1. 概述</h2></div></div></div><a id="idp60732600" class="indexterm"></a><p>有多種不同的方法可以執行 FreeBSD，根據所在環境，包含：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>一般虛擬機映像檔，可下載並匯入到您所選擇的虛擬環境。映像檔可從 <a class="link" href="https://www.freebsd.org/where.html" target="_top">Download FreeBSD</a> 頁面下載，KVM (<span class="quote">“<span class="quote">qcow2</span>”</span>), VMWare (<span class="quote">“<span class="quote">vmdk</span>”</span>), Hyper-V (<span class="quote">“<span class="quote">vhd</span>”</span>) 及原始裝置的映像檔都支援。這些並非安裝程式的映像檔，而是已經預先設定好 (<span class="quote">“<span class="quote">已安裝好</span>”</span>) 的實例，可直接使用並執行安裝後的作業。</p></li><li class="listitem"><p>託管服務虛擬機映像檔，可在 Amazon 的 <a class="link" href="https://aws.amazon.com/mp/solutions/freebsd/" target="_top">AWS Marketplace</a>, <a class="link" href="https://azuremarketplace.microsoft.com/en-us/marketplace/apps?search=freebsd&amp;page=1" target="_top">Microsoft Azure Marketplace</a> 和 <a class="link" href="https://console.cloud.google.com/launcher/details/freebsd-cloud/freebsd-11" target="_top">Google Cloud Platform</a> 等託管服務上運行的虛擬機映像檔。有關如何在 Azure 上部署 FreeBSD 的資訊可查詢 <a class="link" href="https://docs.microsoft.com/en-us/azure/virtual-machines/linux/freebsd-intro-on-azure" target="_top">Azure 說明文件</a>中的相關章節。</p></li><li class="listitem"><p>SD 卡映像檔，供嵌入式系統，如 Raspberry Pi 或 BeagleBone Black 使用的映像檔，可從 <a class="link" href="https://www.freebsd.org/where.html" target="_top">Download FreeBSD</a> 頁面下載，這些檔案必須先解壓縮後以原始映像檔的格式寫入 SD 卡以讓這些開發電路板能夠啟動。</p></li><li class="listitem"><p>安裝程式映像檔，用來安裝 FreeBSD 到硬碟，供一般的桌機、筆電或伺服器系統使用。</p></li></ul></div><p>此章接下來的部份會介紹第四個案例，說明如何使用文字介面為基礎的安裝程式 <span class="application">bsdinstall</span> 安裝 FreeBSD。</p><p>一般來說，本章所寫的安裝說明是針對 <span class="trademark">i386</span>™ 和 <acronym class="acronym">AMD64</acronym> 架構。如果可以用於其他平台，將會列表說明。 安裝程式和本章所敘述的內容可能會有些微差異，所以請將本章視為通用的指引，而不是完全照著來做。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">喜歡用圖形化安裝程式安裝 FreeBSD 的使用者， 可能會對 <span class="application">pc-sysinstall</span> 有興趣，這是 TrueOS 計畫所使用的。 他可以用來安裝圖形化桌面 (TrueOS) 或是指令列版本的 FreeBSD。 細節請參考 TrueOS 使用者 Handbook (<a class="link" href="https://www.trueos.org/handbook/trueos.html" target="_top">https://www.trueos.org/handbook/trueos.html</a>)。</p></div><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>最低的硬體需求和 FreeBSD 支援的架構。</p></li><li class="listitem"><p>如何建立 FreeBSD 的安裝媒體。</p></li><li class="listitem"><p>如何開始執行 <span class="application">bsdinstall</span>。</p></li><li class="listitem"><p><span class="application">bsdinstall</span> 會詢問的問題，問題代表的意思，以及如何回答。</p></li><li class="listitem"><p>安裝失敗時如何做故障排除。</p></li><li class="listitem"><p>如何在正式安裝前使用 live 版本的 FreeBSD。</p></li></ul></div><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>閱讀即將安裝的 FreeBSD 版本所附帶的硬體支援清單，並核對系統的硬體是否有支援。</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bsdinstall-hardware"></a>2.2. 最低硬體需求</h2></div></div></div><p>安裝 FreeBSD 的硬體需求隨 FreeBSD 的版本和硬體架構而不同。 FreeBSD 發行版支援的硬體架構和裝置會列在 <a class="link" href="../../../../releases/index.html" target="_top">FreeBSD 發佈資訊</a> 頁面。<a class="link" href="../../../../where.html" target="_top">FreeBSD 下載頁面</a>
也有建議如何正確的選擇在不同架構使用的映像檔。</p><p>FreeBSD 安裝程序需要至少 96 MB 的 <acronym class="acronym">RAM</acronym> 以及 1.5 GB 的硬碟空間。然而，如此少的記憶體及磁碟空間只適合在客製的應用上，如嵌入式設備。一般用途的桌面系統會需要更多的資源，2-4 GB RAM 與至少 8 GB 的硬碟空間是不錯的起點。</p><p>每一種架構的處理器需求概述如下：</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en">amd64</span></dt><dd><p>桌面電腦與筆記型電腦最常見的處理器類型，運用在近代的系統。<span class="trademark">Intel</span>® 稱該類型為 <acronym class="acronym">Intel64</acronym>，其他製造商則稱該類型為 <acronym class="acronym">x86-64</acronym>。</p><p>與 amd64 相容的處理器範例包含：<span class="trademark">AMD Athlon</span>™64, <span class="trademark">AMD Opteron</span>™, 多核心 <span class="trademark">Intel</span>® <span class="trademark">Xeon</span>™ 以及 <span class="trademark">Intel</span>® <span class="trademark">Core</span>™ 2 與之後的處理器。</p></dd><dt><span xml:lang="en" class="term" lang="en">i386</span></dt><dd><p>舊型的桌面電腦與筆記型電腦常使用此 32-bit, x86 架構。</p><p>幾乎所有含浮點運算單元的 i386 相容處理器都有支援。所有 <span class="trademark">Intel</span>® 486 或是更高階的處理器也有支援。</p><p>FreeBSD 可在有支援實體位址延伸 (Physical Address Extensions, <acronym class="acronym">PAE</acronym>) 功能的 <acronym class="acronym">CPU</acronym> 上運用該功能所帶來的優點。有開啟 <acronym class="acronym">PAE</acronym> 支援的核心會偵測超過 4 GB 的記憶體，並讓這些超過的記憶體能夠被系統使用。 但使用 <acronym class="acronym">PAE</acronym> 會限制裝置驅動程式及 FreeBSD 的其他功能，詳情請見 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pae&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pae</span>(4)</span></a>。</p></dd><dt><span xml:lang="en" class="term" lang="en">ia64</span></dt><dd><p>目前支援的處理器是 <span class="trademark">Itanium</span>® 和 <span class="trademark">Itanium</span>® 2。支援的晶片組包括 HP zx1， <span class="trademark">Intel</span>® 460GX 和 <span class="trademark">Intel</span>® E8870。 單處理器 (Uniprocessor, <acronym class="acronym">UP</acronym>) 和對稱多處理器 (Symmetric Multi-processor, <acronym class="acronym">SMP</acronym>) 的設定都有支援。</p></dd><dt><span xml:lang="en" class="term" lang="en">powerpc</span></dt><dd><p>所有內建 <acronym class="acronym">USB</acronym> 的 New World <acronym class="acronym">ROM</acronym> <span class="trademark">Apple</span>® <span class="trademark">Mac</span>® 系統都有支援。 <acronym class="acronym">SMP</acronym> 在多 <acronym class="acronym">CPU</acronym> 的機器都有支援。</p><p>32 位元的核心只能使用前 2 GB 的 <acronym class="acronym">RAM</acronym>。</p></dd><dt><span xml:lang="en" class="term" lang="en">sparc64</span></dt><dd><p>FreeBSD/sparc64 支援的系統列在 <a class="link" href="../../../../platforms/sparc.html" target="_top">FreeBSD/sparc64 計劃</a>。</p><p>所有超過一個處理器的系統都有支援 <acronym class="acronym">SMP</acronym>。需要專用的磁碟系統，因為此時無法和其他作業系統共用磁碟。</p></dd></dl></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bsdinstall-pre"></a>2.3. 安裝前準備工作</h2></div></div></div><p>一旦確定系統符合安裝 FreeBSD 的最低硬體需求，就可以下載安裝檔案並準備安裝的媒體。 做這些之前，先檢查以下核對清單的項目是否準備好了：</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>備份重要資料</strong></p><p>安裝任何作業系統前， <span class="emphasis"><em>總是</em></span> 要先備份所有重要資料。 不要儲存備份在即將安裝的系統上，而是將資料儲存在可移除磁碟，像是 <acronym class="acronym">USB</acronym> 隨身碟、網路上的另一個系統或是線上備份服務上。 開始安裝程序前要檢查備份，確定備份含有所有需要的檔案，一旦安裝程式格式化系統的磁碟，所有儲存在上面的資料都會遺失。</p></li><li class="step"><p class="title"><strong>決定 FreeBSD 安裝在哪裡</strong></p><p>如果 FreeBSD 是唯一一套要安裝到電腦的作業系統，這個步驟可以略過。 但是假如 FreeBSD 要和其他作業系統共用磁碟空間的話，就要決定 FreeBSD 要安裝在哪個磁碟或是哪個分割區 (Partition)。</p><p>在 i386 和 amd64 架構，可將磁碟分割成多個分割區，可以選擇下列兩種分割表格式 (Partitioning scheme) 的其中一種達成。 傳統的<em class="firstterm">主開機紀錄 (Master Boot Record, <acronym class="acronym">MBR</acronym>)</em> 的一個分割區表定義最多可有四個<em class="firstterm">主分割區</em> (Primary partition)，因一些歷史淵源，FreeBSD 稱這些主分割區為 <em class="firstterm">slice</em>，其中一個主分割區可作為<em class="firstterm">延伸分割區</em> (Extended partition)，延伸分割區又可分割成多個<em class="firstterm">邏輯分割區</em> (Logical partition)。 <em class="firstterm">GUID 分割區表</em> (GUID Partition Table, <acronym class="acronym">GPT</acronym>) 是較新和較簡單的分割磁碟的方法，一般 <acronym class="acronym">GPT</acronym> 實作允許每個磁碟多達 128 個分割區，不再需要使用邏輯分割區。</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">一些比較舊的作業系統，像是 <span class="trademark">Windows</span>® XP 並不相容 <acronym class="acronym">GPT</acronym> 分割表格式。 如果 FreeBSD 將和這類作業系統共用一個磁碟，則需要用 <acronym class="acronym">MBR</acronym> 分割表格式。</p></div><p>FreeBSD 開機啟動程式需要主分割區或是 <acronym class="acronym">GPT</acronym> 分割區。如果所有的主分割區或 <acronym class="acronym">GPT</acronym> 分割區都已使用，必須釋放其中一個分割區讓 FreeBSD 使用。如果要建立一個分割區而不刪除原有的資料，可以使用磁碟重設大小的工具來縮小現有的分割區，並使用釋放出來的空間建立新分割區。</p><p>各種免費和付費的磁碟重設大小工具列於 <a class="link" href="http://en.wikipedia.org/wiki/List_of_disk_partitioning_software" target="_top">http://en.wikipedia.org/wiki/List_of_disk_partitioning_software</a>。<span class="application">GParted Live</span> (<a class="link" href="http://gparted.sourceforge.net/livecd.php" target="_top">http://gparted.sourceforge.net/livecd.php</a>) 是內含分割區編輯程式 <span class="application">GParted</span> 的免費 Live <acronym class="acronym">CD</acronym>。 GParted 同時也被許多 Linux Live <acronym class="acronym">CD</acronym> 發行版所收錄。</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">在正確使用的情況下，磁碟重設大小的工具可以安全的建立讓新的分割區使用的空間。 但因仍有可能會誤選已經存在的分割區，所以在修改磁碟分割區前， 一定要備份重要資料，並確認備份的完整性。</p></div><p>在磁碟分割區中儲存不同的作業系統讓一台電腦可以安裝多個作業系統，另一種作法是使用虛擬化技術 (<a class="xref" href="#virtualization" title="章 21. 虛擬化">章 21, <em>虛擬化</em></a>) ，可讓多個作業系統同時間執行而不需要改變任何磁碟分割區。</p></li><li class="step"><p class="title"><strong>收集網路資訊</strong></p><p>部份 FreeBSD 安裝方式需要網路連線來下載安裝檔，因此之後的安裝程序，安裝程式進入設定系統網路的介面。</p><p>如果網路中有 <acronym class="acronym">DHCP</acronym> 伺服器，則可透過該伺服器自動設定網路，若無法使用 <acronym class="acronym">DHCP</acronym>，則需要從區域網路管理者或是網際網路服務供應商 (Internet Service Provider, ISP) 取得以的網路資訊供系統使用：</p><div class="orderedlist"><a id="bsdinstall-collect-network-information"></a><div class="orderedlist-title">需要的網路資訊</div><ol class="orderedlist" type="1"><li class="listitem"><p><acronym class="acronym">IP</acronym> 位址</p></li><li class="listitem"><p>子網路遮罩</p></li><li class="listitem"><p>預設通訊閘 <acronym class="acronym">IP</acronym> 位址</p></li><li class="listitem"><p>網路的網域名稱</p></li><li class="listitem"><p>網路 <acronym class="acronym">DNS</acronym> 伺服器 <acronym class="acronym">IP</acronym> 位址</p></li></ol></div></li><li class="step"><p class="title"><strong>檢查 FreeBSD 勘誤表</strong></p><p>儘管 FreeBSD 計劃努力確保每個 FreeBSD 發行版能夠儘可能地穩定，但臭蟲偶爾還是會悄悄出現，並有極小的可能會發生影響安裝流程的錯誤，當這些問題被發現並修正後，會被紀錄在 FreeBSD 網站的 FreeBSD 勘誤表 (<a class="link" href="../../../../releases/12.0R/errata.html" target="_top">https://www.freebsd.org/releases/12.0R/errata.html</a>)。 安裝前先檢查勘誤表，以確保沒有會影響到安裝的問題。</p><p>所有發行版的資訊和勘誤表可以在 FreeBSD 網站的發行資訊找到 (<a class="link" href="../../../../releases/index.html" target="_top">https://www.freebsd.org/releases/index.html</a>)。</p></li></ol></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-installation-media"></a>2.3.1. 準備安裝的媒體</h3></div></div></div><p>FreeBSD 安裝程式並不是一個可以在其他作業系統上執行的應用程式，反而您需要下載 FreeBSD 安裝檔，燒錄安裝檔到符合其檔案類型與大小的媒體 (<acronym class="acronym">CD</acronym>, <acronym class="acronym">DVD</acronym> 或 <acronym class="acronym">USB</acronym>)，然後開機從插入的媒體來安裝。</p><p>FreeBSD 的安裝檔可於 <a class="link" href="../../../../where.html#download" target="_top">www.freebsd.org/where.html#download</a> 取得。安裝檔的名稱由 FreeBSD 發佈版本、架構、以及檔案類型所組成，舉例，要從 <acronym class="acronym">DVD</acronym> 安裝 FreeBSD 10.2 到 amd64 的系統，需下載 <code class="filename">FreeBSD-10.2-RELEASE-amd64-dvd1.iso</code>，並燒錄這個檔案到 <acronym class="acronym">DVD</acronym>，然後使用插入 <acronym class="acronym">DVD</acronym> 來開機。</p><p>安裝檔有許多種可用的格式，格式會依據電腦架構及媒體類型的不同而異。</p><p><a id="bsdinstall-installation-media-uefi"></a>還有另一種安裝檔是給使用 <acronym class="acronym">UEFI</acronym> (Unified Extensible Firmware Interface) 開機的電腦使用，這些安裝檔的名稱會含有 <code class="filename">uefi</code>。</p><p>檔案類型：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">-bootonly.iso</code>：這是最精簡的安裝檔，檔案中只含安裝程式。 安裝時需要網際網路連線來下載所需的檔案以完成 FreeBSD 安裝。這個檔案應使用 <acronym class="acronym">CD</acronym> 燒錄應用程式燒錄到 <acronym class="acronym">CD</acronym> 使用。</p></li><li class="listitem"><p><code class="literal">-disc1.iso</code>：這個檔案含有所有安裝 FreeBSD 所需的檔案，包含原始碼及 Port 套件集。這個檔案應使用 <acronym class="acronym">CD</acronym> 燒錄應用程式燒錄到 <acronym class="acronym">CD</acronym> 使用。</p></li><li class="listitem"><p><code class="literal">-dvd1.iso</code>：這個檔案含有所有安裝 FreeBSD 所需的檔案，包含原始碼及 Port 套件集，也內含熱門的 Binary 套件可安裝視窗管理程式以及一些應用程式，如此便可從媒體安裝完整的系統，無須連線到網際網路。這個檔案應使用 <acronym class="acronym">DVD</acronym> 燒錄應用程式燒錄到 <acronym class="acronym">DVD</acronym> 使用。</p></li><li class="listitem"><p><code class="literal">-memstick.img</code>：這個檔案含有所有安裝 FreeBSD 所需的檔案，包含原始碼及 Port 套件集。這個檔案應依據以下操作指示寫入到 <acronym class="acronym">USB</acronym> 隨身碟使用。</p></li><li class="listitem"><p><code class="literal">-mini-memstick.img</code>：類似 <code class="literal">-bootonly.iso</code>，但不含安裝檔 (可依所要下載)，安裝時需要網際網路連線，可依 <a class="xref" href="#bsdinstall-usb" title="2.3.1.1. 寫入映象檔到 USB">節 2.3.1.1, “寫入映象檔到 <acronym class="acronym">USB</acronym>”</a> 的說明將此檔案寫入至 <acronym class="acronym">USB</acronym> 隨身碟。</p></li></ul></div><p>映像檔下載完成之後，下載同一個目錄之中的 <code class="filename">CHECKSUM.SHA256</code>。FreeBSD 提供 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sha256&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sha256</span>(1)</span></a> 可用來計算映像檔的 <em class="firstterm">校驗碼 (Checksum)</em>，使用方式為 <code class="command">sha256 <em class="replaceable"><code>imagefilename</code></em></code>，其他作業系統也會有類似的程式。</p><p>比對計算後的校驗碼與 <code class="filename">CHECKSUM.SHA256</code> 檔案中的值，校驗碼應該要完全相符，若校驗碼不相符，則代表該映像檔是損壞的，必須再下載一次。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-usb"></a>2.3.1.1. 寫入映象檔到 <acronym class="acronym">USB</acronym></h4></div></div></div><p><code class="filename">*.img</code> 檔案是隨身碟的完整內容的<span class="emphasis"><em>映像檔 (image)</em></span>，該檔案<span class="emphasis"><em>不能</em></span>直接用檔案的方式複製到目標裝置。有許多應用程式可用來寫入 <code class="filename">*.img</code> 到 <acronym class="acronym">USB</acronym> 隨身碟，本節會介紹其中兩種。</p><div xmlns="" class="important"><h3 class="admontitle">重要: </h3><p xmlns="http://www.w3.org/1999/xhtml">在繼續之前，請先備份 <acronym class="acronym">USB</acronym> 上的重要資料，這個程序會清除在隨身碟上既有的資料。</p></div><div class="procedure"><a id="bsdinstall-usb-dd"></a><div class="procedure-title">過程 2.1. 使用 <code class="command">dd</code> 來寫入映像檔</div><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">本範例使用 <code class="filename">/dev/da0</code> 做為目標裝置，是映像檔將會寫入的位置。 務必<span class="emphasis"><em>十分小心</em></span>確認要使用的裝置正確，因為這個指示會摧毀所有在指定目標裝置上已存在的資料。</p></div><ul class="procedure"><li class="step"><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dd</span>(1)</span></a> 指令列工具在 BSD, <span class="trademark">Linux</span>® 以及<span class="trademark">Mac OS</span>® 系統皆可使用。要使用 <code class="command">dd</code> 燒錄映像檔需先插入 <acronym class="acronym">USB</acronym> 隨身碟，然後確認隨身碟的裝置名稱。然後指定已下載的安裝檔名稱以及 <acronym class="acronym">USB</acronym> 隨身碟的裝置名稱。本例示範在已有的 FreeBSD 系統燒錄 amd64 安裝映像檔到第一個 <acronym class="acronym">USB</acronym> 裝置。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>dd if=<em class="replaceable"><code>FreeBSD-10.2-RELEASE-amd64-memstick.img</code></em> of=/dev/<em class="replaceable"><code>da0</code></em> bs=1M conv=sync</code></strong></pre><p>若這個指示執行失敗，請確認 <acronym class="acronym">USB</acronym> 隨身碟是否還未掛載，以及該裝置名稱是否指向這個隨身碟，而不是一個分割區。有些作業系統可能需要使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sudo&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sudo</span>(8)</span></a> 來執行這個指令。且 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dd</span>(1)</span></a> 的指令語法在不同的作業系統上有些不同，例如在 <span class="trademark">Mac OS</span>® 需要使用小寫的 <code class="option">bs=1m</code>，而在 <span class="trademark">Linux</span>® 這類的系統可能會暫存寫入動作，要強制完成所有寫入動作，需使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sync&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sync</span>(8)</span></a>。</p></li></ul></div><div class="procedure"><a id="idp63614776"></a><div class="procedure-title">過程 2.2. 使用 <span class="trademark">Windows</span>® 來寫入映象檔</div><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">務必確認指定的磁碟機代號正確，因在指定磁碟機上的既有資料將會被覆蓋與摧毀。</p></div><ol class="procedure" type="1"><li class="step"><p class="title"><strong>取得 <span class="application">Image Writer <span class="trademark">Windows</span>® 版</span></strong></p><p><span class="application">Image Writer <span class="trademark">Windows</span>® 版</span> 是一個免費的應用程式，可以正確地將映像檔寫入隨身碟。可從 <code class="uri"><a class="uri" href="https://sourceforge.net/projects/win32diskimager/" target="_top">https://sourceforge.net/projects/win32diskimager/</a></code> 下載，並解壓縮到一個資料夾。</p></li><li class="step"><p class="title"><strong>用 Image Writer 寫入映象檔</strong></p><p>雙擊 <span class="application">Win32DiskImager</span> 圖示啟動程式。 確認 <code class="computeroutput">Device</code> 顯示的磁碟機代號是隨身碟的磁碟機代號。 按下資料夾圖示選擇要寫入隨身碟的映像檔。 按下 <span class="guibutton">[ Save ]</span> 按鈕確定映像檔名。 確認所有東西都正確，隨身碟的資料夾並沒有在其他視窗開啟。 所有東西準備好後，按下 <span class="guibutton">[ Write ]</span> 將映像檔寫入隨身碟。</p></li></ol></div><p>您現在可以開始安裝 FreeBSD 。</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bsdinstall-start"></a>2.4. 開始安裝</h2></div></div></div><div xmlns="" class="important"><h3 class="admontitle">重要: </h3><p xmlns="http://www.w3.org/1999/xhtml">預設安裝程序在下列訊息顯示之前不會對磁碟做任何更動：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="programlisting" lang="en">Your changes will now be written to disk.  If you
have chosen to overwrite existing data, it will
be PERMANENTLY ERASED. Are you sure you want to
commit your changes?</pre><p xmlns="http://www.w3.org/1999/xhtml">在這個警告訊息之前可以隨時中止安裝，若有任何設定錯誤的疑慮，只需在此時關閉電腦，將不會對系統磁碟做任何更改。</p></div><p>本節將介紹如何使用根據 <a class="xref" href="#bsdinstall-installation-media" title="2.3.1. 準備安裝的媒體">節 2.3.1, “準備安裝的媒體”</a> 指示所準備的安裝媒體來開機。要使用可開機的 USB，請在開啟電腦前插入 <acronym class="acronym">USB</acronym> 隨身碟。要使用 <acronym class="acronym">CD</acronym> 或 <acronym class="acronym">DVD</acronym>，則可開啟電腦後在第一時間插入媒體。如何設定系統使用插入的媒體開機依不同的系統架構會有所不同。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-starting-i386"></a>2.4.1. 在 <span class="trademark">i386</span>™ 及 amd64 開機</h3></div></div></div><p>這兩種架構提供了 <acronym class="acronym">BIOS</acronym> 選單可選擇開機的裝置，依據要使用的安裝媒體類型，選擇 <acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym> 或 <acronym class="acronym">USB</acronym> 裝置做為第一個開機裝置。大多數的系統也會提供快速鍵可在啟動時選擇開機裝置，而不需要進入<acronym class="acronym">BIOS</acronym>，通常這個按鍵可能是 <span class="keycap"><strong>F10</strong></span>, <span class="keycap"><strong>F11</strong></span>, <span class="keycap"><strong>F12</strong></span> 或 <span class="keycap"><strong>Escape</strong></span> 其中之一。</p><p>若電腦仍載入了現有的作業系統，而不是 FreeBSD 安裝程式，原因可能為：</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>執行開機程序時安裝媒體插入主機的時間不夠早，請讓安裝媒體留在電腦中並重新啟動電腦。</p></li><li class="listitem"><p>未正確修改 <acronym class="acronym">BIOS</acronym> 或未儲檔，請再三檢查第一個開機裝置選擇了正確的裝置。</p></li><li class="listitem"><p>系統太舊，無法支援使用選擇的開機媒體開機，發生這個情況可以使用 <span class="application">Plop Boot Manager</span> (<a class="link" href="http://www.plop.at/en/bootmanagers.html" target="_top">http://www.plop.at/en/bootmanagers.html</a>) 來從選擇的開機媒體開機。</p></li></ol></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63641400"></a>2.4.2. 在 <span class="trademark">PowerPC</span>® 開機</h3></div></div></div><p>在大部份機型，可於開機時按住鍵盤上的 <span class="keycap"><strong>C</strong></span>，便可從 <acronym class="acronym">CD</acronym> 開機。若在非 <span class="trademark">Apple</span>® 的鍵盤則可按住 <span class="keycap"><strong>Command</strong></span>+<span class="keycap"><strong>Option</strong></span>+<span class="keycap"><strong>O</strong></span>+<span class="keycap"><strong>F</strong></span> 或 <span class="keycap"><strong>Windows</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>O</strong></span>+<span class="keycap"><strong>F</strong></span>，出現 <code class="prompt">0 &gt;</code> 提示時，輸入</p><pre xml:lang="en" class="screen" lang="en"><strong class="userinput"><code>boot cd:,\ppc\loader cd:0</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63661752"></a>2.4.3. 在 <span class="trademark">SPARC64</span>® 開機</h3></div></div></div><p>大多數 <span class="trademark">SPARC64</span>® 系統會自動從磁碟開機，要從 <acronym class="acronym">CD</acronym> 安裝 FreeBSD 需要進入 <acronym class="acronym">PROM</acronym>。</p><p>要進入 <acronym class="acronym">PROM</acronym>，需重新開機系統然後等候開機訊息出現。訊息會依機型而有所不同，但大致結果會如：</p><pre xml:lang="en" class="screen" lang="en">Sun Blade 100 (UltraSPARC-IIe), Keyboard Present
Copyright 1998-2001 Sun Microsystems, Inc.  All rights reserved.
OpenBoot 4.2, 128 MB memory installed, Serial #51090132.
Ethernet address 0:3:ba:b:92:d4, Host ID: 830b92d4.</pre><p>若系統繼續從磁碟開機，此時按下鍵盤上的 <span class="keycap"><strong>L1</strong></span>+<span class="keycap"><strong>A</strong></span> 或 <span class="keycap"><strong>Stop</strong></span>+<span class="keycap"><strong>A</strong></span> 或透過序列 Console 送出 <code class="command">BREAK</code>。當使用 <span class="application">tip</span> 或 <span class="application">cu</span>, <code class="command">~#</code> 發出一個 BREAK 後，<acronym class="acronym">PROM</acronym> 的提示會在單 <acronym class="acronym">CPU</acronym> 的系統出現 <code class="prompt">ok</code>，<acronym class="acronym">SMP</acronym> 的系統出現 <code class="prompt">ok {0} </code>，其中的數字代表啟動的 <acronym class="acronym">CPU</acronym> 數。</p><p>此時，放入 <acronym class="acronym">CD</acronym> 到磁碟機然後在 <acronym class="acronym">PROM</acronym> 提示畫面輸入 <code class="command">boot cdrom</code>。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-view-probe"></a>2.4.4. FreeBSD 開機選單</h3></div></div></div><p>從安裝媒體開機之後，會顯示如下的選單：</p><div class="figure"><a id="bsdinstall-newboot-loader-menu"></a><div class="figure-title">圖形 2.1. FreeBSD 開機載入程式選單</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-newboot-loader-menu.png" alt="FreeBSD 開機載入程式選單" /></div></div></div><br class="figure-break" /><p>預設在開機進入 FreeBSD 安裝程式前選單會等候使用者輸入 10 秒鐘，若已經安裝 FreeBSD，則會在開機進入 FreeBSD 前等候。要暫停開機計時器來仔細查看選項，請按 <span class="keycap"><strong>Space</strong></span> 鍵。要選擇選項，按下明顯標示的數字、字元或按鍵。選單有以下選項可選。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>啟動多使用者模式 (<code class="literal">Boot Multi User</code>)：這個選項會繼續 FreeBSD 開機程序，若開機計時器已經暫停，可按 <span class="keycap"><strong>1</strong></span>、大寫或小寫 <span class="keycap"><strong>B</strong></span> 或 <span class="keycap"><strong>Enter</strong></span> 鍵。</p></li><li class="listitem"><p>啟動單使用者模式 (<code class="literal">Boot Single User</code>)：這個模式用來修正已安裝的 FreeBSD，如 <a class="xref" href="#boot-singleuser" title="12.2.4.1. 單使用者模式">節 12.2.4.1, “單使用者模式”</a> 所述。可按 <span class="keycap"><strong>2</strong></span>、大寫或小寫 <span class="keycap"><strong>S</strong></span> 進入這個模式。</p></li><li class="listitem"><p>離開到載入程式提示 (<code class="literal">Escape to loader prompt</code>)：這個選項會開機進入修復提示，這個模式含有有限數量的低階指令，這個模式詳細說明於 <a class="xref" href="#boot-loader" title="12.2.3. 階段三">節 12.2.3, “階段三”</a>。可按 <span class="keycap"><strong>3</strong></span> 或 <span class="keycap"><strong>Esc</strong></span> 進入這個提示。</p></li><li class="listitem"><p>重新開機 (<code class="literal">Reboot</code>)：重新開啟系統。</p></li><li class="listitem"><p>設定開機選項 (<code class="literal">Configure Boot Options</code>)：開啟內部選單，詳細說明於 <a class="xref" href="#bsdinstall-boot-options-menu" title="圖形 2.2. FreeBSD 開機選項選單">圖形 2.2, “FreeBSD 開機選項選單”</a>。</p></li></ul></div><div class="figure"><a id="bsdinstall-boot-options-menu"></a><div class="figure-title">圖形 2.2. FreeBSD 開機選項選單</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-boot-options-menu.png" alt="FreeBSD 開機選項選單" /></div></div></div><br class="figure-break" /><p>開機選項選單分成兩個部份。第一個部份用來返回主開機選單或重設任何已切換的選項回預設值。</p><p>第二個部份用來切換可用的選項為開 (<code class="literal">On</code>) 或關 (<code class="literal">Off</code>)，透過按下選項明顯標示的編號或字元。系統將會一直使用這些選項開機，直到選項被修改。有數個選項可以在這個選單做切換：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ACPI 支援 (<code class="literal">ACPI Support</code>)：若系統在開機時卡住，可嘗試切換這個選項為關 (<code class="literal">Off</code>)。</p></li><li class="listitem"><p>安全模式 (<code class="literal">Safe Mode</code>)：若系統在 ACPI 支援 (<code class="literal">ACPI Support</code>) 設為關 (<code class="literal">Off</code>) 時開機時仍然會卡住，可嘗試將此選項設為開 (<code class="literal">On</code>)。</p></li><li class="listitem"><p>單使用者 (<code class="literal">Single User</code>)：切換這個選項為開 (<code class="literal">On</code>) 來修正已存在的 FreeBSD 如 <a class="xref" href="#boot-singleuser" title="12.2.4.1. 單使用者模式">節 12.2.4.1, “單使用者模式”</a> 所述，問題修正後，將其設回關 (<code class="literal">Off</code>)。</p></li><li class="listitem"><p>詳細資訊 (<code class="literal">Verbose</code>)：切換這個選項為開 (<code class="literal">On</code>) 來查看開機程序中更詳細的訊息，這在診斷硬體問題時非常有用。</p></li></ul></div><p>在做完所需的選擇後，按下 <span class="keycap"><strong>1</strong></span> 或 <span class="keycap"><strong>Backspace</strong></span> 返回主開機選單，然後按下 <span class="keycap"><strong>Enter</strong></span> 繼續開機進入 FreeBSD。FreeBSD 執行裝置偵測及載入安裝程式時會顯示一系列的開機訊息，開機完成之後，會顯示歡迎選單如 <a class="xref" href="#bsdinstall-choose-mode" title="圖形 2.3. 歡迎選單">圖形 2.3, “歡迎選單”</a>。</p><div class="figure"><a id="bsdinstall-choose-mode"></a><div class="figure-title">圖形 2.3. 歡迎選單</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-choose-mode.png" alt="歡迎選單" /></div></div></div><br class="figure-break" /><p>按下 <span class="keycap"><strong>Enter</strong></span> 選擇預設的 <span class="guibutton">[ Install ]</span> 進入安裝程式，接下來本章將介紹如何使用這個安裝程式。 若要選擇其他項目，可使用右或左方向鍵或顏色標示的字母選擇想要的選單項目。<span class="guibutton">[ Shell ]</span> 可用來進入 FreeBSD 的 Shell 使用指令列工具在安裝之前準備磁碟。<span class="guibutton">[ Live CD ]</span> 選項可用來在安裝之前試用 FreeBSD，Live 版本的詳細說明於 <a class="xref" href="#using-live-cd" title="2.10. 使用 Live CD">節 2.10, “使用 Live <acronym class="acronym">CD</acronym>”</a>。</p><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml">要重新檢視開機訊息，包含硬體裝置偵測，請按大寫或小寫 <span class="keycap"><strong>S</strong></span> 然後再按 <span class="keycap"><strong>Enter</strong></span> 進入 Shell。在 Shell 提示之後輸入 <code class="command">more /var/run/dmesg.boot</code> 然後使用空白鍵來捲動訊息。當查看完畢後輸入 <code class="command">exit</code> 返回歡迎選單。</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="using-bsdinstall"></a>2.5. 使用 <span class="application">bsdinstall</span></h2></div></div></div><p>本節將告訴您在系統安裝之前 <span class="application">bsdinstall</span> 選單的順序以及會詢問的資訊類型，可使用方向鍵來選擇選單的選項，然後按下 <span class="keycap"><strong>Space</strong></span> 選擇或取消選擇選單項目。當完成之後，按下 <span class="keycap"><strong>Enter</strong></span> 儲存選項然後進入下一個畫面。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-keymap"></a>2.5.1. 選擇鍵盤對應表選單</h3></div></div></div><p>依據使用的系統 Console，<span class="application">bsdinstall</span> 可能一開始顯示的選單會如 <a class="xref" href="#bsdinstall-keymap-select-default" title="圖形 2.4. 鍵盤對應表選擇">圖形 2.4, “鍵盤對應表選擇”</a>。</p><div class="figure"><a id="bsdinstall-keymap-select-default"></a><div class="figure-title">圖形 2.4. 鍵盤對應表選擇</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-keymap-select-default.png" alt="鍵盤對應表選擇" /></div></div></div><br class="figure-break" /><p>要設定鍵盤配置，請選擇 <span class="guibutton">[ YES ]</span> 按下 <span class="keycap"><strong>Enter</strong></span>，接著會顯示選單如 <a class="xref" href="#bsdinstall-config-keymap" title="圖形 2.5. 選擇鍵盤選單">圖形 2.5, “選擇鍵盤選單”</a>。若要使用預設的配置，則可使用方向鍵選擇 <span class="guibutton">[ NO ]</span> 然後按下 <span class="keycap"><strong>Enter</strong></span> 跳過這個選單畫面。</p><div class="figure"><a id="bsdinstall-config-keymap"></a><div class="figure-title">圖形 2.5. 選擇鍵盤選單</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-config-keymap.png" alt="選擇鍵盤選單" /></div></div></div><br class="figure-break" /><p>設定鍵盤配置時，可使用上與下方向鍵來選擇最接近已連接到系統的鍵盤的鍵盤對應表 (Keymap)，然後按下 <span class="keycap"><strong>Enter</strong></span> 儲存選項。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">按 <span class="keycap"><strong>Esc</strong></span> 會離開這個選單然後使用預設的鍵盤對應表，若不清楚要使用那種鍵盤對應表，<span class="guimenuitem">United States of America ISO-8859-1</span> 是也是保險的選項。</p></div><p>在 FreeBSD 10.0-RELEASE 以及之後的版本，已經加強了這個選單，會顯示完整的鍵盤對應表選項，並預先選擇預設值。另外，當選擇其他鍵盤對應用時，在繼續之前會顯示對話框讓使用者測試鍵盤對應表來確認。</p><div class="figure"><a id="bsdinstall-keymap-10"></a><div class="figure-title">圖形 2.6. 改進後的鍵盤對應表選單</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-keymap-10.png" alt="改進後的鍵盤對應表選單" /></div></div></div><br class="figure-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-hostname"></a>2.5.2. 設定主機名稱</h3></div></div></div><p>下一個 <span class="application">bsdinstall</span> 選單用來為新安裝的系統設定主機名稱。</p><div class="figure"><a id="bsdinstall-config-hostname"></a><div class="figure-title">圖形 2.7. 設定主機名稱</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-config-hostname.png" alt="設定主機名稱" /></div></div></div><br class="figure-break" /><p>輸入在網路上獨一無二的主機名稱，主機名稱要是完整的主機名稱，如 <code class="systemitem">machine3.example.com</code>。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-components"></a>2.5.3. 選擇要安裝的元件</h3></div></div></div><p>接下來 <span class="application">bsdinstall</span> 會提示選擇要安裝的選用元件。</p><div class="figure"><a id="bsdinstall-config-components"></a><div class="figure-title">圖形 2.8. 選擇要安裝的元件</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-config-components.png" alt="選擇要安裝的元件" /></div></div></div><br class="figure-break" /><p>決定要安裝的元件主要會根據系統的用途以及可用的磁碟空間容量。FreeBSD 核心 (Kernel) 及 Userland 統稱為 <em class="firstterm">基礎系統 (Base system)</em>，是必須安裝的部份。依據系統的架構，部份元件可能不會顯示：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">doc</code> - 額外的說明文件，大部份是經年累月的產物，會安裝到 <code class="filename">/usr/share/doc</code>。由 FreeBSD 文件計劃所提供的說明文件可在之後安裝，依照 <a class="xref" href="#updating-upgrading-documentation" title="23.3. 更新文件集">節 23.3, “更新文件集”</a> 中的指示操作。</p></li><li class="listitem"><p><code class="literal">games</code> - 數個傳統 <acronym class="acronym">BSD</acronym> 遊戲，包含 <span class="application">fortune</span>, <span class="application">rot13</span> 以及其他。</p></li><li class="listitem"><p><code class="literal">lib32</code> - 在 64-bit 版本的 FreeBSD 供執行 32-bit 應用程式使用的相容性程式庫。</p></li><li class="listitem"><p><code class="literal">ports</code> - FreeBSD Port 套件集是一套可自動下載、編譯安裝第三方軟體套件的集合，<a class="xref" href="#ports" title="章 4. 安裝應用程式：套件與 Port">章 4, <em>安裝應用程式：套件與 Port</em></a> 中會討論到如何使用 Port 套件集。</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">安裝程式並不會檢查是否有充足的磁碟空間，FreeBSD Port 套件集會使用約 500 MB 的磁碟空間，只有在有足夠的磁碟空間時才選擇這個選項。</p></div></li><li class="listitem"><p><code class="literal">src</code> - 完整的 FreeBSD 原始碼，包含核心 (Kernel) 與 Userland。雖然大多數的應用程式並不需要，但它可以編譯裝置驅動程式、核心模組或部份來自 Port 套件集的應用程式，它同時也用來做為開發 FreeBSD 本身所使用。完整的原始碼樹需要 1 GB 的磁碟空間，重新編譯整個 FreeBSD 系統需要額外再 5 GB 的空間。</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-netinstall"></a>2.5.4. 從網路安裝</h3></div></div></div><p>於 <a class="xref" href="#bsdinstall-netinstall-notify" title="圖形 2.9. 從網路安裝">圖形 2.9, “從網路安裝”</a> 所示的選單只會在使用 <code class="filename">-bootonly.iso</code> <acronym class="acronym">CD</acronym> 安裝時顯示，因這個安裝媒體中並未含安裝檔的複本。由於安裝檔必須透過網路下載，此選單會告知要先設定網路介面。</p><div class="figure"><a id="bsdinstall-netinstall-notify"></a><div class="figure-title">圖形 2.9. 從網路安裝</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-netinstall-files.png" alt="從網路安裝" /></div></div></div><br class="figure-break" /><p>要設定網路連線，按下 <span class="keycap"><strong>Enter</strong></span> 然後依照 <a class="xref" href="#bsdinstall-config-network-dev" title="2.8.2. 設定網路介面卡">節 2.8.2, “設定網路介面卡”</a> 中的指示操作，完成網路介面的設定之後，選擇與要安裝 FreeBSD 的電腦相同所在地區的鏡像站，當鏡像站越接近目標電腦，檔案下載的速度會比較快，這會減少安裝的時間。</p><div class="figure"><a id="bsdinstall-netinstall-mirror"></a><div class="figure-title">圖形 2.10. 選擇鏡像站</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-netinstall-mirrorselect.png" alt="選擇鏡像站" /></div></div></div><br class="figure-break" /><p>若在本機的安裝媒體中找到安裝檔案，安裝程序便會繼續。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bsdinstall-partitioning"></a>2.6. 配置磁碟空間</h2></div></div></div><p>接下來的選單用來決定配置磁碟空間的方式。</p><div class="figure"><a id="bsdinstall-zfs-partmenu"></a><div class="figure-title">圖形 2.11. FreeBSD 10.x 或更新版本的磁碟分割選項</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-partmenu.png" alt="FreeBSD 10.x 或更新版本的磁碟分割選項" /></div></div></div><br class="figure-break" /><p>引導式 (<code class="literal">Guided</code>) 磁碟分割會自動設定磁碟的分割區 (Partition)，手動 (<code class="literal">Manual</code>) 磁碟分割可讓進階的使用者使用選單項目建立自訂的分割區，而 <code class="literal">Shell</code> 會開啟 Shell 提示讓進階的使用者可以使用指示列工具如 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gpart</span>(8)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fdisk&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fdisk</span>(8)</span></a> 以及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a> 來建立自訂的分割區。<code class="literal">ZFS</code> 磁碟分割只在 FreeBSD 10 及之後的版本可以使用，可建立選擇性加密的 root-on-ZFS 系統並支援 <em class="firstterm">開機環境 (Boot environment)</em>。</p><p>本節會介紹在配置磁碟分割時需要考量那些事情，並且會示範各種磁碟分割的方式。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="configtuning-initial"></a>2.6.1. 規劃分割區配置</h3></div></div></div><a id="idp63779256" class="indexterm"></a><a id="idp63779768" class="indexterm"></a><a id="idp63780792" class="indexterm"></a><a id="idp63781816" class="indexterm"></a><p>配置檔案系統時要記得硬碟的資料傳輸的速度外軌較內軌快，因此較小且大量存取的檔案系統應要較接近磁碟的外軌，而較大的分割區如 <code class="filename">/usr</code> 應放置在磁碟較內部，建議建立分割區的順序如下：<code class="filename">/</code>, swap, <code class="filename">/var</code> 然後 <code class="filename">/usr</code>。</p><p>機器預期的用途會反映到 <code class="filename">/var</code> 分割區的大小，這個分割區用來保存郵件 (Mailbox)、日誌檔 (Log file) 及印表機緩衝 (Spool)。依使用者數及保存的期間，郵件及日誌檔可能成長到無法預期的大小，一般來說大部份的使用很少會在 <code class="filename">/var</code> 需要超過 1 GB 的可用磁碟空間。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">有時在 <code class="filename">/var/tmp</code> 會需要較多的空間，當新軟體安裝，套件工具會從套件中取出暫存的複本置於 <code class="filename">/var/tmp</code>。若在 <code class="filename">/var/tmp</code> 沒有足夠的空間，要安裝大型軟體套件，例如 <span class="application">Firefox</span>, <span class="application">Apache OpenOffice</span> 或 <span class="application">LibreOffice</span> 會很困難。</p></div><p><code class="filename">/usr</code> 分割區保存了許多支持系統運作的檔案，包含 FreeBSD Port 套件集以及系統原始碼，這個分割區建議至少要有 2 GB 的空間。</p><p>在規劃分割區大小時，請牢記空間需求，當因某個分割區空間不足時要改使用其他分割區時會很麻煩。</p><a id="idp63802424" class="indexterm"></a><a id="idp63803320" class="indexterm"></a><p>根據經驗，交換分割區應為是實體記憶體 (<acronym class="acronym">RAM</acronym>) 的兩倍。使用最低需求的 <acronym class="acronym">RAM</acronym> 來運作的系統會需要更多的交換空間來取得更好的表現。配置太小的交換交間可能導致 <acronym class="acronym">VM</acronym> 分頁掃描碼效率不佳，且往後增加更多記憶體時可能會產生問題。</p><p>在有數個 <acronym class="acronym">SCSI</acronym> 磁碟或數個 <acronym class="acronym">IDE</acronym> 磁碟在不同控制器的大型系統建議在每個磁碟機上都設定交換空間，最多可至四個磁碟機。每個交換分割區的大小應接近相同。核心雖可以處以任意大小的交換空間，但內部資料結構擴充到 4 倍的最大交換分割區大小時，讓交換分割區擁有相同的大小可以讓核心可以最佳的方式串連各個磁碟的交換空間。規劃較大交換空間是可以的，即使沒有使用到多少交換空間，這也會讓要從失控的程式恢復運作更容易，而不需強制重新啟動系統。</p><p>正確的做磁碟分割，可以區隔頻繁寫入所產生的資料碎片與經常讀取的分割區，將寫入頻繁的分割區放在磁碟的邊緣可以增加 <acronym class="acronym">I/O</acronym> 效率。雖然較大的分割區可能也需要增加 <acronym class="acronym">I/O</acronym> 效率，但將這些分割區往磁碟邊緣移動所增加的效率並不會比將 <code class="filename">/var</code> 移到磁碟邊緣所增加的效率來的顯著。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-part-guided"></a>2.6.2. 引導式磁碟分割</h3></div></div></div><p>當選擇這個方法，選單上會顯示可用的磁碟，若電腦有安裝多個磁碟，則需選擇其中一個來安裝 FreeBSD。</p><div class="figure"><a id="bsdinstall-part-guided-disk"></a><div class="figure-title">圖形 2.12. 自多個磁碟選擇</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-part-guided-disk.png" alt="自多個磁碟選擇" /></div></div></div><br class="figure-break" /><p>選擇磁碟之後，接下來選單會提示是否要安裝到整個磁碟或是使用剩餘的空間建立新的分割區。若選擇 <span class="guibutton">[ Entire Disk ]</span>，會自動建立通用的分割區配置來填滿整個磁碟。選擇 <span class="guibutton">[ Partition ]</span> 則會使用磁碟上未使用的空間來建立分割區配置。</p><div class="figure"><a id="bsdinstall-part-entire-part"></a><div class="figure-title">圖形 2.13. 選擇完整磁碟或分割區</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-part-entire-part.png" alt="選擇完整磁碟或分割區" /></div></div></div><br class="figure-break" /><p>分割區配置建立完成之後，再檢查一次確定是否符合安裝的需求。選擇 <span class="guibutton">[ Revert ]</span> 會重設分割區回復為原來的設定值，選擇 <span class="guibutton">[ Auto ]</span> 會重新建立自動配置的 FreeBSD 分割區。分割區也可以手動建立、修改或刪除。當確認磁碟分割正確之後，選擇 <span class="guibutton">[ Finish ]</span> 繼續安裝。</p><div class="figure"><a id="bsdinstall-part-review"></a><div class="figure-title">圖形 2.14. 確認已建立的分割區</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-part-review.png" alt="確認已建立的分割區" /></div></div></div><br class="figure-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-part-manual"></a>2.6.3. 手動磁碟分割</h3></div></div></div><p>選擇這個方法會開啟分割區編輯程式：</p><div class="figure"><a id="bsdinstall-part-manual-create"></a><div class="figure-title">圖形 2.15. 手動建立分割區</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-part-manual-create.png" alt="手動建立分割區" /></div></div></div><br class="figure-break" /><p>選擇要安裝的磁碟機 (在這個例子為 <code class="filename">ada0</code>) 然後選擇 <span class="guibutton">[ Create ]</span> 會以選單顯示可用的分割表格式 (Partition scheme)：</p><div class="figure"><a id="bsdinstall-part-manual-partscheme"></a><div class="figure-title">圖形 2.16. 手動建立分割區</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-part-manual-partscheme.png" alt="手動建立分割區" /></div></div></div><br class="figure-break" /><p>amd64 電腦最適合的選擇通常是 <acronym class="acronym">GPT</acronym>，無法相容 <acronym class="acronym">GPT</acronym> 的舊電腦則應使用 <acronym class="acronym">MBR</acronym>。而其他分割表格式一般會用在那些較罕見或較舊的電腦上。</p><div class="table"><a id="idp63843256"></a><div class="table-title">表格 2.1. 磁碟分割表格式</div><div class="table-contents"><table summary="磁碟分割表格式" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th align="left">縮寫</th><th align="left">說明</th></tr></thead><tbody><tr><td xml:lang="en" align="left" lang="en">APM</td><td align="left">Apple Partition Map，用於 <span class="trademark">PowerPC</span>®。</td></tr><tr><td xml:lang="en" align="left" lang="en">BSD</td><td align="left">無 <acronym class="acronym">MBR</acronym> 的 <acronym class="acronym">BSD</acronym> 標籤，因非 <acronym class="acronym">BSD</acronym> 的磁碟工具可能無法辨識該標籤，有時被稱做 <em class="firstterm">危險專用模式 (Dangerously dedicated mode)</em>。</td></tr><tr><td xml:lang="en" align="left" lang="en">GPT</td><td align="left">GUID 分割區表 (<a class="link" href="http://en.wikipedia.org/wiki/GUID_Partition_Table" target="_top">http://en.wikipedia.org/wiki/GUID_Partition_Table</a>)。</td></tr><tr><td xml:lang="en" align="left" lang="en">MBR</td><td align="left">主開機記錄 (<a class="link" href="http://en.wikipedia.org/wiki/Master_boot_record" target="_top">http://en.wikipedia.org/wiki/Master_boot_record</a>)。</td></tr><tr><td xml:lang="en" align="left" lang="en">PC98</td><td align="left">使用 <acronym class="acronym">MBR</acronym> 改編，用於 NEC PC-98 電腦 (<a class="link" href="http://en.wikipedia.org/wiki/Pc9801" target="_top">http://en.wikipedia.org/wiki/Pc9801</a>)。</td></tr><tr><td xml:lang="en" align="left" lang="en">VTOC8</td><td align="left">Volume Table Of Contents，用於 Sun SPARC64 及 UltraSPARC  電腦。</td></tr></tbody></table></div></div><br class="table-break" /><p>選擇完分割區表格式並建立之後，再選擇 <span class="guibutton">[ Create ]</span> 一次來建立分割區。<span class="keycap"><strong>Tab</strong></span> 鍵可用來在欄位間移動游標。</p><div class="figure"><a id="bsdinstall-part-manual-addpart"></a><div class="figure-title">圖形 2.17. 手動建立分割區</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-part-manual-addpart.png" alt="手動建立分割區" /></div></div></div><br class="figure-break" /><p>標準的 FreeBSD <acronym class="acronym">GPT</acronym> 安裝會使用至少三種分割區：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">freebsd-boot</code> - 儲存 FreeBSD 開機程式 (Boot code)。</p></li><li class="listitem"><p><code class="literal">freebsd-ufs</code> - FreeBSD 的 <acronym class="acronym">UFS</acronym> 檔案系統。</p></li><li class="listitem"><p><code class="literal">freebsd-swap</code> - FreeBSD 交換空間。</p></li></ul></div><p>另一個值得注意的分割區類型是 <code class="literal">freebsd-zfs</code>，這個分割區用來放置 FreeBSD <acronym class="acronym">ZFS</acronym> 檔案系統 (<a class="xref" href="#zfs" title="章 19. Z 檔案系統 (ZFS)">章 19, <em>Z 檔案系統 (<acronym class="acronym">ZFS</acronym>)</em></a>)。請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gpart</span>(8)</span></a> 取得可用的 <acronym class="acronym">GPT</acronym> 分割區類型說明。</p><p>檔案系統分割區可建立多個，且有部份人會偏好使用傳統的配置方式將 <code class="filename">/</code>, <code class="filename">/var</code>, <code class="filename">/tmp</code> 以及 <code class="filename">/usr</code> 分開存放在不同的分割區。請參考 <a class="xref" href="#bsdinstall-part-manual-splitfs" title="範例 2.1. 建立傳統分割的檔案系統分割區">範例 2.1, “建立傳統分割的檔案系統分割區”</a> 的範例。</p><p>大小 (<code class="literal">Size</code>) 欄位可以使用常用的縮寫來輸入：<span class="emphasis"><em>K</em></span> 代表 KB, <span class="emphasis"><em>M</em></span> 代表 MB, <span class="emphasis"><em>G</em></span> 代表 GB。</p><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml">適當的對齊磁碟扇區 (Sector) 會提供最佳的效能，而且讓分割區大小為 4 KB 的偶數倍數可協助確保對齊在磁碟機上的 512-byte 或 4K-byte 扇區。一般來說，使用分割區大小為 1M 或 1G 的偶數倍數是最簡單的方式確保每個分割區以 4K 的偶數倍數做為開始。唯一一個例外是：<span class="emphasis"><em>freebsd-boot</em></span> 分割區因目前開機程式 (Boot code) 的限制，不可大於 512K。</p></div><p>若分割區內含檔案系統便會需要一個掛載點 (<code class="literal">Mountpoint</code>)，若只要建立一個 <acronym class="acronym">UFS</acronym> 分割區，那麼掛載點應設為 <code class="filename">/</code>。</p><p>標籤 (<code class="literal">Label</code>) 是分割區的名稱，磁碟機名稱或編號可能因為磁碟機連接到不同的控制器或連結埠而有所不同，但分割區標籤並不會改變。因此在檔案如 <code class="filename">/etc/fstab</code> 中參照時，使用標籤來替代磁碟機名稱與分割區編號會讓系統對硬體變更有更多的容錯空間。<acronym class="acronym">GPT</acronym> 標籤會於磁碟連結之後出現在 <code class="filename">/dev/gpt/</code>。其他分割表格式的標籤格有不同功能，且標籤會在 <code class="filename">/dev/</code> 中有各自的目錄。</p><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml">每個分割區請使用獨一無二的標籤來避免相同名稱的衝突，標籤可以加入與電腦名稱、用途、地點有關的文字。例如，使用 <code class="literal">labroot</code> 或 <code class="literal">rootfslab</code> 來做為電腦名稱為 <code class="literal">lab</code> 的 <acronym class="acronym">UFS</acronym> 根目錄分割區。</p></div><div class="example"><a id="bsdinstall-part-manual-splitfs"></a><div class="example-title">範例 2.1. 建立傳統分割的檔案系統分割區</div><div class="example-contents"><p>傳統的分割區配置會將 <code class="filename">/</code>, <code class="filename">/var</code>, <code class="filename">/tmp</code> 以及 <code class="filename">/usr</code> 分別使用不同的檔案系統與分割區。先建立 <acronym class="acronym">GPT</acronym> 分割表格式，然後依照下表所示建立分割區。下表是針對 20G 目標磁碟的分割區大小，若在目標磁碟有更多可用的空間，則可增加交換空間 (Swap) 或 <code class="filename">/var</code> 會比較有用。以下所示的標籤皆以 <code class="literal">ex</code> 為字首，代表 <span class="quote">“<span class="quote">example</span>”</span>，讀者應照前面的說明使用其他獨一無二的標籤。</p><p>預設 FreeBSD 的 <code class="filename">gptboot</code> 會預期第一個 <acronym class="acronym">UFS</acronym> 分割區為 <code class="filename">/</code> 分割區。</p><div class="informaltable"><table border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>分割區類型</th><th>大小</th><th>掛載點</th><th>標籤</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><code class="literal">freebsd-boot</code></td><td xml:lang="en" lang="en"><code class="literal">512K</code></td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr><tr><td xml:lang="en" lang="en"><code class="literal">freebsd-ufs</code></td><td xml:lang="en" lang="en"><code class="literal">2G</code></td><td xml:lang="en" lang="en"><code class="filename">/</code></td><td xml:lang="en" lang="en"><code class="literal">exrootfs</code></td></tr><tr><td xml:lang="en" lang="en"><code class="literal">freebsd-swap</code></td><td xml:lang="en" lang="en"><code class="literal">4G</code></td><td> </td><td xml:lang="en" lang="en"><code class="literal">exswap</code></td></tr><tr><td xml:lang="en" lang="en"><code class="literal">freebsd-ufs</code></td><td xml:lang="en" lang="en"><code class="literal">2G</code></td><td xml:lang="en" lang="en"><code class="filename">/var</code></td><td xml:lang="en" lang="en"><code class="literal">exvarfs</code></td></tr><tr><td xml:lang="en" lang="en"><code class="literal">freebsd-ufs</code></td><td xml:lang="en" lang="en"><code class="literal">1G</code></td><td xml:lang="en" lang="en"><code class="filename">/tmp</code></td><td xml:lang="en" lang="en"><code class="literal">extmpfs</code></td></tr><tr><td xml:lang="en" lang="en"><code class="literal">freebsd-ufs</code></td><td>接受預設值 (依磁碟提示)</td><td xml:lang="en" lang="en"><code class="filename">/usr</code></td><td xml:lang="en" lang="en"><code class="literal">exusrfs</code></td></tr></tbody></table></div></div></div><br class="example-break" /><p>自訂的分割區建立完後，選擇 <span class="guibutton">[ Finish ]</span> 繼續安裝。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-part-zfs"></a>2.6.4. Root-on-ZFS 自動磁碟分割</h3></div></div></div><p>在 FreeBSD 10.0-RELEASE 之後支援了自動建立 root-on-ZFS 的安裝程序。這種磁碟分割模式只能使用整個磁碟，並會清除整個磁碟內的內容。安裝程式會自動建立對齊 4k 邊界的分割區然後強制 <acronym class="acronym">ZFS</acronym> 使用 4k 扇區 (Sector)。即使在 512 位元扇區的磁碟使用也很安全，並增加了確保在 512 位元的磁碟上建立儲存池 (Pool) 也可在未來加入 4k 扇區磁碟的好處，無論是作為額外的存儲空間或作為故障磁碟的替代品。安裝程式也可選擇性採用 <acronym class="acronym">GELI</acronym> 磁碟加密，如 <a class="xref" href="#disks-encrypting-geli" title="17.12.2. 使用 geli 做磁碟加密">節 17.12.2, “使用 <code class="command">geli</code> 做磁碟加密”</a> 所介紹，若開啟磁碟加密，會建立一個內含 <code class="filename">/boot</code> 目錄的 2 GB 未加密的開機儲存池，這個儲存池中會儲存核心及其他開機必要的檔案。然後剩餘的空用會給 <acronym class="acronym">ZFS</acronym> 儲存池使用。</p><p>主要 <acronym class="acronym">ZFS</acronym> 設定選單提供了數個設定選項來控制儲存池的建立。</p><div class="figure"><a id="bsdinstall-zfs-menu"></a><div class="figure-title">圖形 2.18. <acronym class="acronym">ZFS</acronym> 磁碟分割選單</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-menu.png" alt="ZFS 磁碟分割選單" /></div></div></div><br class="figure-break" /><p>選擇 <span class="keycap"><strong>T</strong></span> 來設定儲存池類型 (<code class="literal">Pool Type</code>) 以及要組成儲存池的磁碟。自動 <acronym class="acronym">ZFS</acronym> 安裝程式目前僅支援建立單一頂層 vdev，除了在串連 (Stripe) 模式。要建立更複雜的儲存池，需使用 <a class="xref" href="#bsdinstall-part-shell" title="2.6.5. Shell 模式磁碟分割">節 2.6.5, “Shell 模式磁碟分割”</a> 的操作來建立儲存池。安裝程式支援建立各種儲存池類型，包含串連 Stripe (不建議，沒有備援功能)、鏡像 Mirror (效能較佳，但可用空間較少) 以及 RAID-Z 1, 2, 與 3 (分別有能力承受同時 1, 2 與 3 個磁碟的損壞)。在選擇儲存池類型時會在螢幕的下方提示所需的磁碟數量，以及在使用 RAID-Z 時，每種配置最佳的磁碟數。</p><div class="figure"><a id="bsdinstall-zfs-vdev_type"></a><div class="figure-title">圖形 2.19. <acronym class="acronym">ZFS</acronym> 儲存池類型</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-vdev_type.png" alt="ZFS 儲存池類型" /></div></div></div><br class="figure-break" /><p>選擇儲存池 (<code class="literal">Pool Type</code>) 之後，會顯示可用的磁碟清單，然後會提示使用者選擇一個或多個磁碟來建立儲存池。接著會檢驗設定來確定選擇的磁碟足夠，若不足，選擇更改選項 (<span class="guibutton">&lt;Change Selection&gt;</span>) 來返回磁碟清單或取消 (<span class="guibutton">&lt;Cancel&gt;</span>) 來更改儲存池類型。</p><div class="figure"><a id="bsdinstall-zfs-disk_select"></a><div class="figure-title">圖形 2.20. 磁碟選擇</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-disk_select.png" alt="磁碟選擇" /></div></div></div><br class="figure-break" /><div class="figure"><a id="bsdinstall-zfs-vdev_invalid"></a><div class="figure-title">圖形 2.21. 無效的選擇</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-vdev_invalid.png" alt="無效的選擇" /></div></div></div><br class="figure-break" /><p>若有一個或多磁碟未出現在清單上，或在安裝程式啟動後才連接的磁碟，可選擇重新掃描裝置 (<span class="guibutton">- Rescan Devices</span>) 來更新可用磁碟的清單。要避免清除掉錯的磁碟，可用磁碟資訊 (<span class="guibutton">- Disk Info</span>) 來檢查每個磁碟，包含磁碟中的分割表以及各種其他資訊如裝置型號與序號 (若有的話)。</p><div class="figure"><a id="bsdinstall-zfs-disk_info"></a><div class="figure-title">圖形 2.22. 分析磁碟</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-disk_info.png" alt="分析磁碟" /></div></div></div><br class="figure-break" /><p>主 <acronym class="acronym">ZFS</acronym> 設定選單也允許使用者輸入儲存池名稱、關閉強制 4k 扇區對齊、開啟或關閉加密、切換 <acronym class="acronym">GPT</acronym> (建議) 與 <acronym class="acronym">MBR</acronym> 分割表類型以及選擇交換空間容量。設定所有選項為想要的值之後，請選擇選單上方的安裝 (<span class="guibutton">&gt;&gt;&gt; Install</span>) 選項。</p><p>若開啟了 <acronym class="acronym">GELI</acronym> 磁碟加密，安裝程式會提示輸入兩次用來加密磁碟的密碼。</p><div class="figure"><a id="bsdinstall-zfs-geli_password"></a><div class="figure-title">圖形 2.23. 磁碟加密密碼</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-geli_password.png" alt="磁碟加密密碼" /></div></div></div><br class="figure-break" /><p>安裝程式接著會提供最後一次修改的機會可取消先前所選擇摧毀用來建立 <acronym class="acronym">ZFS</acronym> 儲存池的磁碟機。</p><div class="figure"><a id="bsdinstall-zfs-warning"></a><div class="figure-title">圖形 2.24. 最後修改</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-warning.png" alt="最後修改" /></div></div></div><br class="figure-break" /><p>然後安裝程序會正常繼續。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-part-shell"></a>2.6.5. Shell 模式磁碟分割</h3></div></div></div><p>當要做進階的安裝時，<span class="application">bsdinstall</span> 的磁碟分割選單可能無法提供需要的彈性。進階的使用者可以在磁碟分割選單選擇 <span class="guibutton">Shell</span> 選項來手動分割磁碟機、建立檔案系統、填寫 <code class="filename">/tmp/bsdinstall_etc/fstab</code> 以及掛載檔案系統到 <code class="filename">/mnt</code> 下。這些動作完成之後，輸入 <code class="command">exit</code> 可返回 <span class="application">bsdinstall</span> 繼續安裝程序。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bsdinstall-final-warning"></a>2.7. 確認安裝</h2></div></div></div><p>磁碟設定完之後，接下來的選單會讓您在格式化所選的硬碟之前有最後一次機會做變更，若需要做變更，可選 <span class="guibutton">[ Back ]</span> 返回到主磁碟分割選單。<span class="guibutton">[ Revert &amp; Exit ]</span> 則會離開安裝程式，不會對硬碟做任何變更。</p><div class="figure"><a id="bsdinstall-final-confirmation"></a><div class="figure-title">圖形 2.25. 最後確認</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-final-confirmation.png" alt="最後確認" /></div></div></div><br class="figure-break" /><p>要開始實際的安裝，請選擇 <span class="guibutton">[ Commit ]</span> 然後按下 <span class="keycap"><strong>Enter</strong></span>。</p><p>安裝時間會依據選擇的發行版、安裝媒體、電腦的速度而有所不同，接下來會有一系列訊息會告知目前的進度。</p><p>首先，安裝程式會格式化選擇的磁碟，然後初始化分割區。然後，若使用僅可開機 (Boot only) 的媒體則會開始下載選擇的元件：</p><div class="figure"><a id="bsdinstall-distfile-fetching"></a><div class="figure-title">圖形 2.26. 取得發行版檔案</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-distfile-fetching.png" alt="取得發行版檔案" /></div></div></div><br class="figure-break" /><p>接著，會檢驗發行版的檔案完整性來確保沒有因下載過程中或安裝媒體的讀取過程中讀取錯誤造成的損壞：</p><div class="figure"><a id="bsdinstall-distfile-verify"></a><div class="figure-title">圖形 2.27. 檢驗發行版檔案</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-distfile-verifying.png" alt="檢驗發行版檔案" /></div></div></div><br class="figure-break" /><p>最後，檢驗過的發行版檔案會被取出儲存至磁碟：</p><div class="figure"><a id="bsdinstall-distfile-extract"></a><div class="figure-title">圖形 2.28. 解開發行版檔案</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-distfile-extracting.png" alt="解開發行版檔案" /></div></div></div><br class="figure-break" /><p>所有選擇的發行版檔案取出後，<span class="application">bsdinstall</span> 會顯示第一次安裝後設定畫面，可用的安裝後設定選項會在下一節說明。</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bsdinstall-post"></a>2.8. 安裝後注意事項</h2></div></div></div><p>FreeBSD 安裝完之後，<span class="application">bsdinstall</span> 會在開機進入新安裝的系統之前提示設定數個選項，本節將介紹這些設定選項。</p><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml">系統開機之後，<code class="command">bsdconfig</code> 提供了一個選單導向的方式可用來設定系統使用這些以及其他的選項。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-post-root"></a>2.8.1. 設定 <code class="systemitem">root</code> 密碼</h3></div></div></div><p>首先，必需設定 <code class="systemitem">root</code> 的密碼，輸入密碼時，並不會直接在畫面上顯示輸入的字元。輸入完密碼之後，必須再輸入一次來確認沒有輸入錯誤。</p><div class="figure"><a id="bsdinstall-post-set-root-passwd"></a><div class="figure-title">圖形 2.29. 設定 <code class="systemitem">root</code> 密碼</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-post-root-passwd.png" alt="設定 root 密碼" /></div></div></div><br class="figure-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-config-network-dev"></a>2.8.2. 設定網路介面卡</h3></div></div></div><p>接著，會顯示在電腦上找到的網路介面卡清單。請選擇要設定的介面卡。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">若使用 <span class="emphasis"><em>bootonly</em></span> 的方式安裝在先前已有設定過網路，將會跳過網路設定選單。</p></div><div class="figure"><a id="bsdinstall-configure-net-interface"></a><div class="figure-title">圖形 2.30. 選擇網路介面卡</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-network-interface.png" alt="選擇網路介面卡" /></div></div></div><br class="figure-break" /><p>若選擇的是乙太網路介面卡，安裝程式會跳過這部份直接到 <a class="xref" href="#bsdinstall-configure-net-ipv4" title="圖形 2.34. 選擇 IPv4 網路">圖形 2.34, “選擇 <acronym class="acronym">IPv4</acronym> 網路”</a>，若選擇的是無線網路介面卡，系統則會開始掃描無線存取點 (Wireless Access Point)：</p><div class="figure"><a id="bsdinstall-wireless-scan"></a><div class="figure-title">圖形 2.31. 掃描無線網路存取點</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-wireless-scan.png" alt="掃描無線網路存取點" /></div></div></div><br class="figure-break" /><p>網線網路會使用 Service Set Identifier (<acronym class="acronym">SSID</acronym>) 來辦識，SSID 是一段簡短、獨一無二的名稱，用來命名每個網路。 掃描時找到的 <acronym class="acronym">SSID</acronym> 會列到清單，並會說明該網路可用的加密類型。 若想要連線的 <acronym class="acronym">SSID</acronym> 並未出現在清單上，可選擇 <span class="guibutton">[ Rescan ]</span> 再掃描一次，若想要連線的網路仍然沒有出現，請檢查天線的連線是否有問題，或者嘗試將電腦移至更靠近存取點的位置，然後再掃描一次。</p><div class="figure"><a id="bsdinstall-wireless-accesspoints"></a><div class="figure-title">圖形 2.32. 選擇無線網路</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-wireless-accesspoints.png" alt="選擇無線網路" /></div></div></div><br class="figure-break" /><p>然後，輸入加密資訊來連線到選擇的無線網路。強列建議使用 <acronym class="acronym">WPA2</acronym> 加密，因較舊的加密類型，如 <acronym class="acronym">WEP</acronym> 僅提供微弱的安全性。若網路使用 <acronym class="acronym">WPA2</acronym> 則需輸入密碼，也稱作 Pre-Shared Key (<acronym class="acronym">PSK</acronym>)。考量安全性，輸入到輸入框的字元會以星號顯示。</p><div class="figure"><a id="bsdinstall-wireless-wpa2"></a><div class="figure-title">圖形 2.33. WPA2 設定</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-wireless-wpa2setup.png" alt="WPA2 設定" /></div></div></div><br class="figure-break" /><p>接下來，選擇是否要設定乙太網路或無線網路介面卡的 <acronym class="acronym">IPv4</acronym> 位址：</p><div class="figure"><a id="bsdinstall-configure-net-ipv4"></a><div class="figure-title">圖形 2.34. 選擇 <acronym class="acronym">IPv4</acronym> 網路</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-network-interface-ipv4.png" alt="選擇 IPv4 網路" /></div></div></div><br class="figure-break" /><p>有兩種方式可以設定 <acronym class="acronym">IPv4</acronym>。 <acronym class="acronym">DHCP</acronym> 會自動設定網路介面卡且該網路上需有 <acronym class="acronym">DHCP</acronym> 伺服器才可使用。否則，必須手動輸入位址的資訊來做靜態設定。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">請不要隨便輸入網路資訊，因為這不管用。如果沒有可用的 <acronym class="acronym">DHCP</acronym> 伺服器，可向網路管理者或網路服務供應商 (Internet Service Provider, ISP) 索取列於 <a class="xref" href="#bsdinstall-collect-network-information" title="需要的網路資訊">需要的網路資訊</a> 的資訊。</p></div><p>若有可用的 <acronym class="acronym">DHCP</acronym> 伺服器，請在接下來的選單中選擇 <span class="guibutton">[ Yes ]</span> 則會自動設定網路介面卡。當找到 <acronym class="acronym">DHCP</acronym> 伺服器並且取得系統的位址資訊時，安裝程式會出現一分鐘左右的停頓。</p><div class="figure"><a id="bsdinstall-net-ipv4-dhcp"></a><div class="figure-title">圖形 2.35. 選擇 <acronym class="acronym">IPv4</acronym> <acronym class="acronym">DHCP</acronym> 設定</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-network-interface-ipv4-dhcp.png" alt="選擇 IPv4 DHCP 設定" /></div></div></div><br class="figure-break" /><p>若沒有可用的 <acronym class="acronym">DHCP</acronym> 伺服器，則選擇 <span class="guibutton">[ No ]</span> 然後在這個選單中輸入以下位址資訊：</p><div class="figure"><a id="bsdinstall-net-ipv4-static"></a><div class="figure-title">圖形 2.36. <acronym class="acronym">IPv4</acronym> 靜態位置設定</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-network-interface-ipv4-static.png" alt="IPv4 靜態位置設定" /></div></div></div><br class="figure-break" /><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>IP 位址 (<code class="literal">IP Address</code>) - 要分配給這台電腦的 <acronym class="acronym">IPv4</acronym> 位址。位址必須獨一無二且不可已被其他在區域網路上的設備使用。</p></li><li class="listitem"><p>子網路遮罩 (<code class="literal">Subnet Mask</code>) - 網路的子網路遮罩。</p></li><li class="listitem"><p>預設路由器 (<code class="literal">Default Router</code>) - <acronym class="acronym">IP</acronym> 位址所在網段的預設通訊閘。</p></li></ul></div><p>接下來的畫面會詢問是否要設定介面卡的 <acronym class="acronym">IPv6</acronym> 位址，若可以且想要使用 <acronym class="acronym">IPv6</acronym>，請選擇 <span class="guibutton">[ Yes ]</span>。</p><div class="figure"><a id="bsdinstall-net-ipv6"></a><div class="figure-title">圖形 2.37. 選擇 IPv6 網路</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-network-interface-ipv6.png" alt="選擇 IPv6 網路" /></div></div></div><br class="figure-break" /><p>同樣有兩種方式可以設定 <acronym class="acronym">IPv6</acronym>。StateLess Address AutoConfiguration (<acronym class="acronym">SLAAC</acronym>) 會自動向區域路由器請求取得正確的設定資訊，請參考 <a class="link" href="http://tools.ietf.org/html/rfc4862" target="_top">http://tools.ietf.org/html/rfc4862</a> 取得進一步資訊。靜態設定則需要手動輸入網路資訊。</p><p>若有可用的 <acronym class="acronym">IPv6</acronym> 路由器，請在接下來的選單選擇 <span class="guibutton">[ Yes ]</span> 來自動設定網路介面卡。當找到路由器並且取得系統的位址資訊時，安裝程式會出現一分鐘左右的停頓。</p><div class="figure"><a id="bsdinstall-net-ipv6-slaac"></a><div class="figure-title">圖形 2.38. 選擇 IPv6 SLAAC 設定</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-network-interface-slaac.png" alt="選擇 IPv6 SLAAC 設定" /></div></div></div><br class="figure-break" /><p>若沒有可用的 <acronym class="acronym">IPv6</acronym> 路由器，請選擇 <span class="guibutton">[ No ]</span> 然後在這個選單中輸入以下位址資訊：</p><div class="figure"><a id="bsdinstall-net-ipv6-static"></a><div class="figure-title">圖形 2.39. IPv6 靜態位置設定</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-network-interface-ipv6-static.png" alt="IPv6 靜態位置設定" /></div></div></div><br class="figure-break" /><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>IPv6 位址 (<code class="literal">IPv6 Address</code>) - 要分配給這台電腦的 <acronym class="acronym">IPv6</acronym> 位址。位址必須獨一無二且不可已被其他在區域網路上的設備使用。</p></li><li class="listitem"><p>預設路由器 (<code class="literal">Default Router</code>) - <acronym class="acronym">IPv6</acronym> 位址所在網段的預設通訊閘。</p></li></ul></div><p>最後的網路設定選單是用來設定網域名稱系統 (Domain Name System, <acronym class="acronym">DNS</acronym>) 的解析器，解析器會轉換主機名稱為網路位址。若已使用 <acronym class="acronym">DHCP</acronym> 或 <acronym class="acronym">SLAAC</acronym> 來自動設定網路介面卡，解析器設定 (<code class="literal">Resolver Configuration</code>) 的值可能會事先已填入，否則需輸入區域網路的網域名稱到搜尋 (<code class="literal">Search</code>) 欄位。 <code class="literal">DNS #1</code> 與 <code class="literal">DNS #2</code> 要填寫 <acronym class="acronym">DNS</acronym> 伺服器的 <acronym class="acronym">IPv4</acronym> 及/或 <acronym class="acronym">IPv6</acronym> 位址，至少需填寫一個 <acronym class="acronym">DNS</acronym> 伺服器。</p><div class="figure"><a id="bsdinstall-net-dns-config"></a><div class="figure-title">圖形 2.40. DNS 設定</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-network-ipv4-dns.png" alt="DNS 設定" /></div></div></div><br class="figure-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-timezone"></a>2.8.3. 設定時區</h3></div></div></div><p>接下來的選單會詢問系統時鐘要使用 <acronym class="acronym">UTC</acronym> 或者當地時間。 若有疑問時可選擇 <span class="guibutton">[ No ]</span>使用更常用的當地時間。</p><div class="figure"><a id="bsdinstall-local-utc"></a><div class="figure-title">圖形 2.41. 選擇本地或 UTC 時鐘</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-set-clock-local-utc.png" alt="選擇本地或 UTC 時鐘" /></div></div></div><br class="figure-break" /><p>接下來一系列的選單會透過選擇地理區域、城市及時區來判斷正確的當地時間。設定時區可讓系統自動更正區域時間的更改，如日光節約時間以及正確執行其他時區相關的功能。</p><p>此處以位於美國東部時區的機器為例，選擇會依據地理位置不同改變。</p><div class="figure"><a id="bsdinstall-timezone-region"></a><div class="figure-title">圖形 2.42. 選擇區域</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-timezone-region.png" alt="選擇區域" /></div></div></div><br class="figure-break" /><p>使用方向鍵選擇適當的區域然後按下 <span class="keycap"><strong>Enter</strong></span>。</p><div class="figure"><a id="bsdinstall-timezone-country"></a><div class="figure-title">圖形 2.43. 選擇城市</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-timezone-country.png" alt="選擇城市" /></div></div></div><br class="figure-break" /><p>使用方向鍵選擇適當的城市然後按下 <span class="keycap"><strong>Enter</strong></span>。</p><div class="figure"><a id="bsdinstall-timezone-zone"></a><div class="figure-title">圖形 2.44. 選擇時區</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-timezone-zone.png" alt="選擇時區" /></div></div></div><br class="figure-break" /><p>使用方向鍵選擇適當的時區然後按下 <span class="keycap"><strong>Enter</strong></span>。</p><div class="figure"><a id="bsdinstall-timezone-confirmation"></a><div class="figure-title">圖形 2.45. 確認時區</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-timezone-confirm.png" alt="確認時區" /></div></div></div><br class="figure-break" /><p>確認時區的縮寫是否正確，若正確，按下 <span class="keycap"><strong>Enter</strong></span> 繼續安裝後設定。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-sysconf"></a>2.8.4. 開啟服務</h3></div></div></div><p>接下來的選單用來設定有那些系統服務要在系統啟動時執行。所有的服務為選用，只需開啟系統運作真正需要的服務。</p><div class="figure"><a id="bsdinstall-config-serv"></a><div class="figure-title">圖形 2.46. 選擇要開啟的其他服務</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-config-services.png" alt="選擇要開啟的其他服務" /></div></div></div><br class="figure-break" /><p>這是可以在這個選單開啟的服務摘要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">sshd</code> - Secure Shell (<acronym class="acronym">SSH</acronym>) Daemon 可從遠端透過加密的連線存取系統，只有在系統允許遠端登入時開啟這個服務。</p></li><li class="listitem"><p><code class="literal">moused</code> - 若在指令列系統 Console 會使用到滑鼠時，可開啟此服務。</p></li><li class="listitem"><p><code class="literal">ntpd</code> - 網路時間通訊協定 (Network Time Protoco, <acronym class="acronym">NTP</acronym>) Daemon 用來自動同步時間。若在網路上有使用 <span class="trademark">Windows</span>®, Kerberos 或 <acronym class="acronym">LDAP</acronym> 伺服器時，可開啟此服務。</p></li><li class="listitem"><p><code class="literal">powerd</code> - 系統電源控制工具用來做電源控制與節能。</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-crashdump"></a>2.8.5. 開啟當機資訊 (Crash Dump)</h3></div></div></div><p>接下來的選單用來設定是否開啟當機資訊 (Crash dump)，開啟當機資訊對系統除錯非常有用，因此建議使用者開啟當機資訊。</p><div class="figure"><a id="bsdinstall-config-crashdump"></a><div class="figure-title">圖形 2.47. 開啟當機資訊 (Crash Dump)</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-config-crashdump.png" alt="開啟當機資訊 (Crash Dump)" /></div></div></div><br class="figure-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-addusers"></a>2.8.6. 新增使用者</h3></div></div></div><p>下個選單會提示建立至少一個使用者帳號。建議使用 <code class="systemitem">root</code> 以外的使用者帳號登入系統，當使用 <code class="systemitem">root</code> 登入時，基本上沒有任何的限制或保護。
使用一般使用者登入較保險且安全。</p><p>選擇 <span class="guibutton">[ Yes ]</span> 來新增新使用者。</p><div class="figure"><a id="bsdinstall-add-user1"></a><div class="figure-title">圖形 2.48. 新增使用者帳號</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-adduser1.png" alt="新增使用者帳號" /></div></div></div><br class="figure-break" /><p>請依照提示輸入請求的使用者帳號資訊，<a class="xref" href="#bsdinstall-add-user2" title="圖形 2.49. 輸入使用者資訊">圖形 2.49, “輸入使用者資訊”</a> 的範例示範建立 <code class="systemitem">asample</code> 使用者帳號。</p><div class="figure"><a id="bsdinstall-add-user2"></a><div class="figure-title">圖形 2.49. 輸入使用者資訊</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-adduser2.png" alt="輸入使用者資訊" /></div></div></div><br class="figure-break" /><p>這裡是要輸入的資訊摘要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>使用者名稱 (<code class="literal">Username</code>) - 登入時使用者要輸入的名稱，常見的慣例是用姓的前一個字母與名結合，只要每個使用者名稱在系統唯一的皆可。使用者名稱區分大小寫且不應含有任何空白字元。</p></li><li class="listitem"><p>全名 (<code class="literal">Full name</code>) - 使用者的全名，這個欄位可使用空白並且會用來描述該使用者帳號。</p></li><li class="listitem"><p><code class="literal">Uid</code> - 使用者 <acronym class="acronym">ID</acronym>，通常這個欄位會留空，系統會自動分配一個值。</p></li><li class="listitem"><p>登入群組 (<code class="literal">Login group</code>) - 使用者的群組，通常這個欄位會留空來使用預設值。</p></li><li class="listitem"><p>邀請使用者進入其他群組? (<code class="literal">Invite <em class="replaceable"><code>user</code></em> into other groups?</code>) - 使用者要加入成為其成員的其他群組，若該使用者需要管理權限，則在此輸入 <code class="literal">wheel</code>。</p></li><li class="listitem"><p>登入類別 (<code class="literal">Login class</code>) - 通常會留空來使用預設值。</p></li><li class="listitem"><p><code class="literal">Shell</code> - 輸入清單中的其中一項來設定使用者所互動的 Shell，請參考 <a class="xref" href="#shells" title="3.9. Shell">節 3.9, “Shell”</a> 取得更多有關  Shell 的資訊。</p></li><li class="listitem"><p>家目錄 (<code class="literal">Home directory</code>) - 使用者的家目錄，預設值通常是沒有問題的。</p></li><li class="listitem"><p>家目錄權限 (<code class="literal">Home directory permissions</code>) - 使用者家目錄的權限，預設值通常是沒有問題的。</p></li><li class="listitem"><p>使用密碼為基礎的認証方式? (<code class="literal">Use password-based authentication?</code>) - 通常為是 (<code class="literal">yes</code>)，使用者才可於登入時輸入密碼。</p></li><li class="listitem"><p>使用空白密碼? (<code class="literal">Use an empty password?</code>) - 通常為否 (<code class="literal">no</code>)，因為使用空白密碼並不安全。</p></li><li class="listitem"><p>使用隨機密碼? (<code class="literal">Use a random password?</code>) - 通常為否 (<code class="literal">no</code>)，這樣使用者接下來才可設定自己的密碼。</p></li><li class="listitem"><p>輸入密碼 (<code class="literal">Enter password</code>) - 這個使用者的密碼，輸入的字元不會顯示在畫面上。</p></li><li class="listitem"><p>再輸入密碼一次 (<code class="literal">Enter password again</code>) - 再輸入一次密碼來確認無誤。</p></li><li class="listitem"><p>建立後鎖定使用者帳號? (<code class="literal">Lock out the account after creation?</code>) - 通常為否 (<code class="literal">no</code>)，這樣使用者才可以登入。</p></li></ul></div><p>在輸入完全部的資料後，會顯示摘要供檢查，若發現錯誤，可輸入否 (<code class="literal">no</code>) 然後再輸入一次，若輸入的所有資訊皆正確，輸入是 (<code class="literal">yes</code>) 以後便會建立新使用者。</p><div class="figure"><a id="bsdinstall-add-user3"></a><div class="figure-title">圖形 2.50. 離開使用者與群組管理</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-adduser3.png" alt="離開使用者與群組管理" /></div></div></div><br class="figure-break" /><p>若還有其他要新增的使用者，則在詢問新增其他使用者? (<code class="literal">Add another user?</code>) 時回答是 (<code class="literal">yes</code>)。輸入否 (<code class="literal">no</code>) 來完成加入使用者然後繼續安裝。</p><p>要取得新增使用者與使用者管理的更多資訊，請參考 <a class="xref" href="#users-synopsis" title="3.3. 使用者與基礎帳號管理">節 3.3, “使用者與基礎帳號管理”</a>。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-final-conf"></a>2.8.7. 最後設定</h3></div></div></div><p>在所有東西安裝並設定完之後，會提供最後一次修改設定的機會。</p><div class="figure"><a id="bsdinstall-final-config"></a><div class="figure-title">圖形 2.51. 最後設定</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-finalconfiguration.png" alt="最後設定" /></div></div></div><br class="figure-break" /><p>使用這個選單在完成安裝前做任何更改或做任何額外的設定。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>新增使用者 (<code class="literal">Add User</code>) - 詳述於 <a class="xref" href="#bsdinstall-addusers" title="2.8.6. 新增使用者">節 2.8.6, “新增使用者”</a>。</p></li><li class="listitem"><p>Root 密碼 (<code class="literal">Root Password</code>) - 詳述於 <a class="xref" href="#bsdinstall-post-root" title="2.8.1. 設定 root 密碼">節 2.8.1, “設定 <code class="systemitem">root</code> 密碼”</a>。</p></li><li class="listitem"><p>主機名稱 (<code class="literal">Hostname</code>) - 詳述於 <a class="xref" href="#bsdinstall-hostname" title="2.5.2. 設定主機名稱">節 2.5.2, “設定主機名稱”</a>。</p></li><li class="listitem"><p>網路 (<code class="literal">Network</code>) - 詳述於 <a class="xref" href="#bsdinstall-config-network-dev" title="2.8.2. 設定網路介面卡">節 2.8.2, “設定網路介面卡”</a>。</p></li><li class="listitem"><p>服務 (<code class="literal">Services</code>) - 詳述於 <a class="xref" href="#bsdinstall-sysconf" title="2.8.4. 開啟服務">節 2.8.4, “開啟服務”</a>。</p></li><li class="listitem"><p>時區 (<code class="literal">Time Zone</code>) - 詳述於 <a class="xref" href="#bsdinstall-timezone" title="2.8.3. 設定時區">節 2.8.3, “設定時區”</a>。</p></li><li class="listitem"><p>使用手冊 (<code class="literal">Handbook</code>) - 下載並安裝 FreeBSD 使用手冊。</p></li></ul></div><p>完成最後的設定之後，選擇 <span class="guibutton">Exit</span>。</p><div class="figure"><a id="bsdinstall-final-modification-shell"></a><div class="figure-title">圖形 2.52. 手動設定</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-final-modification-shell.png" alt="手動設定" /></div></div></div><br class="figure-break" /><p><span class="application">bsdinstall</span> 會提示是否有任何額外的設定需要在重新開機進入新系統之前完成。選擇 <span class="guibutton">[ Yes ]</span> 會離開進入到新系統的 Shell 或 <span class="guibutton">[ No ]</span> 繼續最後的安裝步驟。</p><div class="figure"><a id="bsdinstall-final-main"></a><div class="figure-title">圖形 2.53. 完成安裝</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-mainexit.png" alt="完成安裝" /></div></div></div><br class="figure-break" /><p>若有需要做進一步或特殊的設定，選擇 <span class="guibutton">[ Live CD ]</span> 會開機進入安裝媒體的 Live <acronym class="acronym">CD</acronym> 模式。</p><p>若安裝已完成，選擇 <span class="guibutton">[ Reboot ]</span> 重新開啟電腦然後啟動新的 FreeBSD 電腦。不要忘了移除 FreeBSD 安裝媒體，否則電腦會再次開機進入安裝程式。</p><p>FreeBSD 開機的過程會顯示許多可以參考的訊息，系統開機完成後，會顯示登入提示，在 <code class="prompt">login:</code> 提示，輸入安裝時新增的使用者名稱。登入時避免直接使用 <code class="systemitem">root</code>，請參考 <a class="xref" href="#users-superuser" title="3.3.1.3. 超級使用者帳號">節 3.3.1.3, “超級使用者帳號”</a> 來取得當需要管理權限時如何成為超級使用者的說明。</p><p>要查看開機過程顯示的訊息可按 <span class="keycap"><strong>Scroll-Lock</strong></span> 鍵來開啟卷軸暫存，然後可使用 <span class="keycap"><strong>PgUp</strong></span>, <span class="keycap"><strong>PgDn</strong></span> 以及方向鍵來捲動訊息。查看完成之後再按 <span class="keycap"><strong>Scroll-Lock</strong></span> 鍵一次來解除畫面鎖定並返回 Console。系統開機一段時間之後要查看這些訊息可在指令提示後輸入 <code class="command">less /var/run/dmesg.boot</code>，查看後按下 <span class="keycap"><strong>q</strong></span> 鍵便可返回指令列。</p><p>若在 <a class="xref" href="#bsdinstall-config-serv" title="圖形 2.46. 選擇要開啟的其他服務">圖形 2.46, “選擇要開啟的其他服務”</a> 有開啟 <span class="application">sshd</span>，因系統會產生 <acronym class="acronym">RSA</acronym> 及 <acronym class="acronym">DSA</acronym> 金鑰第一次開機可能會有點慢，之後的開機便會恢復正常速度。接著會顯示金鑰的指紋 (Fingerprint)，如這個範例：</p><pre xml:lang="en" class="screen" lang="en">Generating public/private rsa1 key pair.
Your identification has been saved in /etc/ssh/ssh_host_key.
Your public key has been saved in /etc/ssh/ssh_host_key.pub.
The key fingerprint is:
10:a0:f5:af:93:ae:a3:1a:b2:bb:3c:35:d9:5a:b3:f3 root@machine3.example.com
The key's randomart image is:
+--[RSA1 1024]----+
|    o..          |
|   o . .         |
|  .   o          |
|       o         |
|    o   S        |
|   + + o         |
|o . + *          |
|o+ ..+ .         |
|==o..o+E         |
+-----------------+
Generating public/private dsa key pair.
Your identification has been saved in /etc/ssh/ssh_host_dsa_key.
Your public key has been saved in /etc/ssh/ssh_host_dsa_key.pub.
The key fingerprint is:
7e:1c:ce:dc:8a:3a:18:13:5b:34:b5:cf:d9:d1:47:b2 root@machine3.example.com
The key's randomart image is:
+--[ DSA 1024]----+
|       ..     . .|
|      o  .   . + |
|     . ..   . E .|
|    . .  o o . . |
|     +  S = .    |
|    +  . = o     |
|     +  . * .    |
|    . .  o .     |
|      .o. .      |
+-----------------+
Starting sshd.</pre><p>請參考 <a class="xref" href="#openssh" title="13.8. OpenSSH">節 13.8, “OpenSSH”</a> 來取得更多有關指紋與 <acronym class="acronym">SSH</acronym> 的資訊。</p><p>FreeBSD 預設並不會安裝圖型化介面，請參考 <a class="xref" href="#x11" title="章 5. X Window 系統">章 5, <em>X Window 系統</em></a> 取得有關安裝與設定圖型化視窗管理程式的資訊。</p><p>正確的將 FreeBSD 電腦關機對保護資料及避免硬體損壞有幫助。<span class="emphasis"><em>在系統尚未正常關機之前請不要關閉電源！</em></span> 若使用者為 <code class="systemitem">wheel</code> 群組的成員之一，可在指令列輸入 <code class="command">su</code> 然後輸入 <code class="systemitem">root</code> 密碼來成為超級使用者。接著輸入 <code class="command">shutdown -p now</code> 系統便會關機，若硬體支援的話，電腦會自行關閉電源。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bsdinstall-install-trouble"></a>2.9. 疑難排解</h2></div></div></div><a id="idp64311992" class="indexterm"></a><p>本節涵蓋基礎的安裝疑難排解，例如一些已有人回報的常見問題。</p><p>查看該 FreeBSD 版本的 Hardware Notes (<a class="link" href="../../../../releases/index.html" target="_top">https://www.freebsd.org/releases/index.html</a>) 文件來確認是否支援該硬體。若確定有支援該硬體但仍然卡住或發生其他問題，請依照 <a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a> 的指示編譯自訂核心來加入未在 <code class="filename">GENERIC</code> 核心的裝置。預設的核心會假設大部份的硬體裝置會使用原廠預設的 <acronym class="acronym">IRQ</acronym>s, <acronym class="acronym">I/O</acronym> 位址，及 <acronym class="acronym">DMA</acronym> 通道，若硬體已經被重新設定過，自訂的核心設定檔可以告訴 FreeBSD 到那找到這些裝置。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">部份安裝問題可以透過更各種硬體元件的韌體來避免或緩解，特別是主機板。主機板的韌體通常稱為 <acronym class="acronym">BIOS</acronym>，大部份主機板與電腦製造商會有網站可以取得升級程式與升級資訊。</p><p xmlns="http://www.w3.org/1999/xhtml">製造商通常會建議若沒有特殊原因盡量避免升級主機板 <acronym class="acronym">BIOS</acronym>，例如：重大更新，升級的程多<span class="emphasis"><em>可能會</em></span>出錯，導致未更新完成的 <acronym class="acronym">BIOS</acronym> 並讓電腦無法運作。</p></div><p>若系統在開機偵測硬體時卡住或安裝時運作異常，可能主因為 <acronym class="acronym">ACPI</acronym>，FreeBSD 在 i386, amd64 及 ia64 平台廣泛的使用了系統 <acronym class="acronym">ACPI</acronym> 服務來協助設定系統組態，若在開機時有偵測到該功能。不幸的是，<acronym class="acronym">ACPI</acronym> 驅動程式與系統主機板及 <acronym class="acronym">BIOS</acronym> 韌體之間仍存在部份問題。可於開機載入程式的第三階段設定 <code class="literal">hint.acpi.0.disabled</code> Hint 來關閉 <acronym class="acronym">ACPI</acronym>：</p><pre xml:lang="en" class="screen" lang="en"><strong class="userinput"><code>set hint.acpi.0.disabled="1"</code></strong></pre><p>每一次系統重開之後便會重設，因此需要在 <code class="filename">/boot/loader.conf</code> 檔案加入 <code class="literal">hint.acpi.0.disabled="1"</code>。更多有關開機載入程式的資訊可於 <a class="xref" href="#boot-synopsis" title="12.1. 概述">節 12.1, “概述”</a> 取得。</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="using-live-cd"></a>2.10. 使用 Live <acronym class="acronym">CD</acronym></h2></div></div></div><p>如 <a class="xref" href="#bsdinstall-choose-mode" title="圖形 2.3. 歡迎選單">圖形 2.3, “歡迎選單”</a> 所示 <span class="application">bsdinstall</span> 的歡迎選單提供了 <span class="guibutton">[ Live CD ]</span> 選項，這對那些對 FreeBSD 是否為正確的作業系統尚存疑慮的人非常有幫助，這可讓這些人在安裝前測試一部份功能。</p><p>在使用 <span class="guibutton">[ Live CD ]</span> 之前必須注意以下幾點事項：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>若要增加存取權限，必須透過認証。使用者名稱為 <code class="systemitem">root</code> 而密碼則是空白。</p></li><li class="listitem"><p>系統是直接從安裝媒體上執行，比起安裝到硬碟的系統，效能可能較差。</p></li><li class="listitem"><p>這個選項只提供指令提示，不會有圖型化介面。</p></li></ul></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="basics"></a>章 3. FreeBSD 基礎</h2></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#basics-synopsis">3.1. 概述</a></span></dt><dt><span class="sect1"><a href="#consoles">3.2. 虛擬 Console 與終端機</a></span></dt><dd><dl><dt><span class="sect2"><a href="#consoles-virtual">3.2.1. 虛擬 Console</a></span></dt><dt><span class="sect2"><a href="#consoles-singleuser">3.2.2. 單使用者模式</a></span></dt><dt><span class="sect2"><a href="#consoles-vidcontrol">3.2.3. 更改 Console 影像模式</a></span></dt></dl></dd><dt><span class="sect1"><a href="#users-synopsis">3.3. 使用者與基礎帳號管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#users-introduction">3.3.1. 帳號類型</a></span></dt><dd><dl><dt><span class="sect3"><a href="#users-system">3.3.1.1. 系統帳號</a></span></dt><dt><span class="sect3"><a href="#users-user">3.3.1.2. 使用者帳號</a></span></dt><dt><span class="sect3"><a href="#users-superuser">3.3.1.3. 超級使用者帳號</a></span></dt></dl></dd><dt><span class="sect2"><a href="#users-modifying">3.3.2. 管理帳號</a></span></dt><dd><dl><dt><span class="sect3"><a href="#users-adduser">3.3.2.1. <code class="command">adduser</code></a></span></dt><dt><span class="sect3"><a href="#users-rmuser">3.3.2.2. <code class="command">rmuser</code></a></span></dt><dt><span class="sect3"><a href="#users-chpass">3.3.2.3. <code class="command">chpass</code></a></span></dt><dt><span class="sect3"><a href="#users-passwd">3.3.2.4. <code class="command">passwd</code></a></span></dt><dt><span class="sect3"><a href="#users-pw">3.3.2.5. <code class="command">pw</code></a></span></dt></dl></dd><dt><span class="sect2"><a href="#users-groups">3.3.3. 管理群組</a></span></dt></dl></dd><dt><span class="sect1"><a href="#permissions">3.4. 權限</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp64837048">3.4.1. 權限符號</a></span></dt><dt><span class="sect2"><a href="#idp64892088">3.4.2. FreeBSD 檔案旗標</a></span></dt><dt><span class="sect2"><a href="#idp64911544">3.4.3. <code class="literal">setuid</code> 、<code class="literal">setgid</code> 與 <code class="literal">sticky</code> 權限</a></span></dt></dl></dd><dt><span class="sect1"><a href="#dirstructure">3.5. 目錄結構</a></span></dt><dt><span class="sect1"><a href="#disk-organization">3.6. 磁碟組織</a></span></dt><dt><span class="sect1"><a href="#mount-unmount">3.7. 掛載與卸載檔案系統</a></span></dt><dd><dl><dt><span class="sect2"><a href="#disks-fstab">3.7.1. <code class="filename">fstab</code> 檔</a></span></dt><dt><span class="sect2"><a href="#disks-mount">3.7.2. 使用 mount(8)</a></span></dt><dt><span class="sect2"><a href="#disks-umount">3.7.3. 使用 umount(8)</a></span></dt></dl></dd><dt><span class="sect1"><a href="#basics-processes">3.8. 程序與 Daemon</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp65473336">3.8.1. 檢視程序</a></span></dt><dt><span class="sect2"><a href="#basics-daemons">3.8.2. 終止程序</a></span></dt></dl></dd><dt><span class="sect1"><a href="#shells">3.9. Shell</a></span></dt><dd><dl><dt><span class="sect2"><a href="#changing-shells">3.9.1. 變更 Shell</a></span></dt><dt><span class="sect2"><a href="#idp65690680">3.9.2. 進階 Shell 技巧</a></span></dt></dl></dd><dt><span class="sect1"><a href="#editors">3.10. 文字編輯器</a></span></dt><dt><span class="sect1"><a href="#basics-devices">3.11. 裝置及裝置節點</a></span></dt><dt><span class="sect1"><a href="#basics-more-information">3.12. 操作手冊</a></span></dt><dd><dl><dt><span class="sect2"><a href="#basics-info">3.12.1. GNU Info 檔</a></span></dt></dl></dd></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="basics-synopsis"></a>3.1. 概述</h2></div></div></div><p>接下來的這一章將涵蓋 FreeBSD 作業系統的基本指令及功能。 大部份的內容在 <span class="trademark">UNIX</span>®-like 作業系統中都是相通的。 如果您對這些內容熟悉的話，可以放心的跳過。 如果您剛接觸 FreeBSD，那您一定要仔細的讀完這章。</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>如何使用 FreeBSD 的虛擬 Console。</p></li><li class="listitem"><p>如何在 FreeBSD 建立與管理使用者與群組。</p></li><li class="listitem"><p><span class="trademark">UNIX</span>® 檔案權限以及 FreeBSD 檔案標記的運作方式。</p></li><li class="listitem"><p>預設的 FreeBSD 檔案系統配置。</p></li><li class="listitem"><p>FreeBSD 的磁碟組織。</p></li><li class="listitem"><p>如何掛載 (Mount)、卸載 (Umount) 檔案系統。</p></li><li class="listitem"><p>什麼是程序、Daemon 以及信號 (Signal)。</p></li><li class="listitem"><p>什麼是 Shell，以及如何變更您預設的登入環境。</p></li><li class="listitem"><p>如何使用基本的文字編輯器。</p></li><li class="listitem"><p>什麼是裝置 (Device) 和裝置節點 (Device node)。</p></li><li class="listitem"><p>如何閱讀操作手冊以獲得更多的資訊。</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="consoles"></a>3.2. 虛擬 Console 與終端機</h2></div></div></div><a id="idp64332344" class="indexterm"></a><a id="idp64333240" class="indexterm"></a><a id="idp64334136" class="indexterm"></a><p>如果您沒有將 FreeBSD 設定成開機時自動進入圖形化模式，系統會進入指令登入提示像是這樣的東西：</p><pre xml:lang="en" class="screen" lang="en">FreeBSD/amd64 (pc3.example.org) (ttyv0)

login:</pre><p>第一行包含了剛開機完系統的資訊，<code class="literal">amd64</code> 代表此範例所使用的系統是執行 64-位元版本的 FreeBSD，這台主機的名稱是 <code class="systemitem">pc3.example.org</code>，<code class="filename">ttyv0</code> 代表這是個 <span class="quote">“<span class="quote">系統 Console</span>”</span>。第二行則是登人的提示訊息。</p><p>FreeBSD 是一個多使用者的系統，需要一套可以分辨不同使用者的方法。因此所有的使用者在執行程式之前必須先“登入”系統以取得系統內程式的存取權限。每個使用者都有一組獨一無二的使用者名稱 (<span class="quote">“<span class="quote">username</span>”</span>) 及個人密碼 (<span class="quote">“<span class="quote">password</span>”</span>)。</p><p>要登入系統 Console 需輸入在系統安裝時設定的使用者名稱，請參考 <a class="xref" href="#bsdinstall-addusers" title="2.8.6. 新增使用者">節 2.8.6, “新增使用者”</a>，並按下 <span class="keycap"><strong>Enter</strong></span>。 接著輸入該使用者名稱的密碼按下 <span class="keycap"><strong>Enter</strong></span>。 輸入的密碼為了安全起見<span class="emphasis"><em>不會顯示</em></span>在畫面上。</p><p>如果您輸入了正確的密碼，您應該會看到今日訊息 (Message of the day, <acronym class="acronym">MOTD</acronym>)，後面接著顯示指令提示字元，依使用者建立時所選擇的 Shell 會有不同的提示字元可能為 <code class="literal">#</code>, <code class="literal">$</code> 或者 <code class="literal">%</code>。 看到指令提示代表使用者現在已經登入 FreeBSD 系統 Console 且已經準備好可以下指令。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="consoles-virtual"></a>3.2.1. 虛擬 Console</h3></div></div></div><p>雖然系統 Console 已經可以用來與系統互動，但使用鍵盤來下指令使用 FreeBSD 系統的使用者通常會使用虛擬 Console 登入。 因為系統訊息預設會顯示在系統 Console，這些訊些會在使用者作業的過程中不斷出現，讓使用者難以專心作業。</p><p>FreeBSD 預設提供多個虛擬 Console 可輸入指令，每個虛擬 Console 都有自己的登入提示及 Shell 並且可以輕易的在虛擬 Console 間切換。 這實際上讓指令輸入有了類似於圖型化環境中可以同時開啟多個視窗的功能。</p><p>組合鍵 <span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F1</strong></span> 至  <span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F8</strong></span> 被 FreeBSD 保留用來切換虛擬 Console，使用 <span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F1</strong></span> 可切換至系統 Console (<code class="filename">ttyv0</code>)，<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F2</strong></span> 可存取第一個虛擬 Console (<code class="filename">ttyv1</code>)，<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F3</strong></span> 可存取第二個虛擬 Console (<code class="filename">ttyv2</code>)，以此類推。當使用 <span class="application">Xorg</span> 作為圖型化 Console 時，組合鍵則改使用 <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F1</strong></span> 來切換回文字介面的虛擬 Console。</p><p>當您從一個 Console 切換到下一個的時候，FreeBSD 會切換畫面顯示的內容， 這就好像有很多虛擬的螢幕和鍵盤可以讓您輸入指令到 FreeBSD 執行。 在某一個虛擬 Console 上執行的程式並不會因為使用者切到別的 Console 而停止執行。</p><p>請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kbdcontrol&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kbdcontrol</span>(1)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vidcontrol&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vidcontrol</span>(1)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=atkbd&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">atkbd</span>(4)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syscons&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syscons</span>(4)</span></a> 以及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vt&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vt</span>(4)</span></a> 來取得更多有關 FreeBSD Console 及鍵盤驅動程式的技術說明。</p><p>FreeBSD 中虛擬 Console 的數量設定在 <code class="filename">/etc/ttys</code> 檔案中的下列章節：</p><pre xml:lang="en" class="programlisting" lang="en"># name    getty                         type  status comments
#
ttyv0   "/usr/libexec/getty Pc"         xterm   on  secure
# Virtual terminals
ttyv1   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv2   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv3   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv4   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv5   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv6   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv7   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv8   "/usr/X11R6/bin/xdm -nodaemon"  xterm   off secure</pre><p>要關閉虛擬 Console 只要在指定的虛擬 Console 該行設定的一開始加上註解符號 (<code class="literal">#</code>)。 例如要將虛擬 Console 的數量由 8 個改為 4 個，則可將 <code class="literal">#</code> 加在代表虛擬 Console 的 <code class="filename">ttyv5</code> 到 <code class="filename">ttyv8</code> 的最後四行一開始。 <span class="emphasis"><em>請勿</em></span>將系統 Console <code class="filename">ttyv0</code> 加上註解符號。 注意，若有依照 <a class="xref" href="#x11" title="章 5. X Window 系統">章 5, <em>X Window 系統</em></a> 安裝並設定 <span class="application">Xorg</span> 時，會用到最後一個虛擬 Console (<code class="filename">ttyv8</code>)。</p><p>有關各欄位的設定以及其他選項，請參閱 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ttys&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ttys</span>(5)</span></a> 說明。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="consoles-singleuser"></a>3.2.2. 單使用者模式</h3></div></div></div><p>FreeBSD 開機選單會提供一個選項為 <span class="quote">“<span class="quote">Boot Single User</span>”</span>，若選擇該項目，系統將會進入所謂 <span class="quote">“<span class="quote">單使用者模式</span>”</span> 的特殊模式。 此模式通常用在修復系統無法開機或重設已忘掉的 <code class="systemitem">root</code> 密碼。 在當使用者模式中無法使用網路及其他虛擬 Console，但有完整 <code class="systemitem">root</code> 對系統的存取權限，而且預設是不須要輸入 <code class="systemitem">root</code> 密碼。 也因此，要能透過實體鍵盤操作才能進入此模式，在考量 FreeBSD 系統安全時須要限制可操作實體鍵盤的人員。</p><p>有關單使用者模式的設定可在 <code class="filename">/etc/ttys</code> 中的以下章節中找到：</p><pre xml:lang="en" class="programlisting" lang="en"># name  getty                           type  status  comments
#
# If console is marked "insecure", then init will ask for the root password
# when going to single-user mode.
console none                            unknown  off  secure</pre><p>預設狀態為安全 (<code class="literal">secure</code>)，這代表誰能夠操作實體鍵盤不是不重要就是已受到實體安全規範管制。 若設定更該為不安全 (<code class="literal">insecure</code>) 則代表主機所在的環境不安全，因為任何人皆可接觸鍵盤。 當此行設定更改為不安全 (<code class="literal">insecure</code>) 時，當使用擇選擇單使用者模式時，FreeBSD 將會要求輸入 <code class="systemitem">root</code> 的密碼。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml"><span class="emphasis"><em>請審慎考慮是否要改為 <code class="literal">insecure</code></em></span>！ 因為萬一忘記 <code class="systemitem">root</code> 密碼的話，雖然還是有其他辦法可以登入單使用者模式，只是對不熟 FreeBSD 開機程序的人可就麻煩了。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="consoles-vidcontrol"></a>3.2.3. 更改 Console 影像模式</h3></div></div></div><p>FreeBSD Console 預設顯示大小可以調整為 1024x768、1280x1024 或其他顯示卡與螢幕有支援的解析度大小。 要使用不同的影像模式需載入 <code class="literal">VESA</code> 模組：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload vesa</code></strong></pre><p>要偵測硬體支援的影像模式，可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vidcontrol&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vidcontrol</span>(1)</span></a>。 要取得支援的影像模式清單可輸入以下指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>vidcontrol -i mode</code></strong></pre><p>該指令會顯示硬體所支援的影像模式清單，要採用新的影像模式需以 <code class="systemitem">root</code> 使用者執行 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vidcontrol&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vidcontrol</span>(1)</span></a> 指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>vidcontrol MODE_279</code></strong></pre><p>若可接受新的影像模式，可以在 <code class="filename">/etc/rc.conf</code> 加入設定，讓每次重開機後會自動生效：</p><pre xml:lang="en" class="programlisting" lang="en">allscreens_flags="MODE_279"</pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="users-synopsis"></a>3.3. 使用者與基礎帳號管理</h2></div></div></div><p>FreeBSD 允許多使用者同時使用電腦，在一次只能有一位使用者坐在電腦螢幕前使用鍵盤操作的同時，可讓任何數量的使用者透過網路登入到系統。每一位要使用該系統的使用者應有自己的帳號。</p><p>本章介紹：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FreeBSD 系統中各種類型的使用者帳號。</p></li><li class="listitem"><p>如何加入、移除與修改使用者帳號。</p></li><li class="listitem"><p>如何設定用來控制使用者與群組允許存取的資源的限制。</p></li><li class="listitem"><p>如何建立群組與加入使用者作為群組成員。</p></li></ul></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-introduction"></a>3.3.1. 帳號類型</h3></div></div></div><p>由於所有對 FreeBSD 系統的存取是透過使用者帳號來達成，且所有的程序需要經由使用者來執行，因此使用者帳號管理非常重要。</p><p>有三種主要類型的帳號：系統帳號、使用者帳號以及超級使用者帳號。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-system"></a>3.3.1.1. 系統帳號</h4></div></div></div><a id="idp64473912" class="indexterm"></a><p>系統帳號用來執行服務，例如 DNS、郵件及網頁伺服器，要這麼作是因為安全性考量，若所有的服務均以超級使用者來執行，那麼這些服務的運作將不會受到限制。</p><a id="idp64475576" class="indexterm"></a><a id="idp64477112" class="indexterm"></a><p>系統帳號的例子有 <code class="systemitem">daemon</code>, <code class="systemitem">operator</code>, <code class="systemitem">bind</code>, <code class="systemitem">news</code>, and <code class="systemitem">www</code>。</p><a id="idp64481592" class="indexterm"></a><p><code class="systemitem">nobody</code> 是通用的無權限系統帳號。雖然如此，只有要越多的服務使用 <code class="systemitem">nobody</code>，就會有更多的檔案與程式與該使用者相關聯，會讓該使用者擁有更多的權限。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-user"></a>3.3.1.2. 使用者帳號</h4></div></div></div><a id="idp64485304" class="indexterm"></a><p>使用者帳號會分配給實際人員，用來登入及使用系統。每位要存取系統的人員需要擁有一組唯一的使用者帳號，這可讓管理者辨識誰在做什麼以及避免使用者覆蓋其他使用者的設定。</p><p>每位使用者可以設定自己的環境來配合自己使用系統的習慣，透過設定預設的 Shell、編輯器、組合鍵 (Key Binding) 及語言設定。</p><p>每個在 FreeBSD 系統的使用者帳號都會有一些相關的資訊：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">使用者名稱 (User name)</span></dt><dd><p>在 <code class="prompt">login:</code> 提示出現時便要輸入使用者名稱，每位使用者必須要有一個唯一的使用者名稱。要建立有效的使用者名稱要遵守數條規則，在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(5)</span></a> 中有說明。建議使用者名稱由 8 個或更少的字母組成，全部採用小寫字元以向下相容應用程式。</p></dd><dt><span class="term">密碼 (Password)</span></dt><dd><p>每個帳號都會有密碼。</p></dd><dt><span class="term">使用者 ID (<acronym class="acronym">UID</acronym>)</span></dt><dd><p>使用者 ID (User ID, <acronym class="acronym">UID</acronym>) 是一組數字用來獨一無二的辨識 FreeBSD 系統的使用者，用到使用者名稱的指令會先將使用者名稱轉換為 <acronym class="acronym">UID</acronym>。建議使用小於 65535 的 UID，超過這個值可能會造成部份軟體的相容性問題。</p></dd><dt><span class="term">群組 ID (<acronym class="acronym">GID</acronym>)</span></dt><dd><p>群組 ID (Group ID, <acronym class="acronym">GID</acronym>) 是一組數字用來獨一無二的辨識使用者所屬的主要群組。群組是一個除了使用 <acronym class="acronym">UID</acronym> 之外根據使用者的 <acronym class="acronym">GID</acronym> 來控制資源存取權的機制。這可以顯著的降低某些設定檔的大小且可讓使用者成為一個以上群組的成員。建議使用 65535 或以下的 GID，因超過此值的 GID 可能會讓部份軟體無法運作。</p></dd><dt><span class="term">登入類別 (Login class)</span></dt><dd><p>登入類別 (Login class) 擴充了群組機制，當在對不同使用者客製化系統時可提供額外的彈性。在 <a class="xref" href="#users-limiting" title="13.13.1. 設定登入類別">節 13.13.1, “設定登入類別”</a> 有對登入類別更進一步的討論。</p></dd><dt><span class="term">密碼更改時間 (Password change time)</span></dt><dd><p>預設情況下密碼並不會過期，雖然如此，密碼期限可在各別使用者上開啟，可強制部份或所有使用者在某段期間過後更改他們的密碼。</p></dd><dt><span class="term">帳號到期時間 (Account expiration time)</span></dt><dd><p>預設情況下 FreeBSD 的帳號不會有期限。當建立需要有限壽命的帳號時，例如，學校的學生帳號，可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a> 指定帳號的到期日期。到期日期過後，便無法使用該帳號登入到系統，儘管該帳號的目錄及檔案仍存在。</p></dd><dt><span class="term">使用者的全名 (User's full name)</span></dt><dd><p>使用者名稱用來獨一無二的辦識 FreeBSD 的帳號，但並不一定反映了使用者的真實姓名。類似註解，這個資訊可以含有空白、大寫字元並可超過 8 個字母的長度。</p></dd><dt><span class="term">家目錄 (Home directory)</span></dt><dd><p>家目錄是系統中某個目錄的完整路徑，這個目錄是使用者登入後的起點目錄。習慣上會將所有使用者目錄放置在 <code class="filename"><em class="replaceable"><code>/home/username</code></em></code> 或 <code class="filename"><em class="replaceable"><code>/usr/home/username</code></em></code>。每位使用者可以儲存他們的個人檔案及子目錄於他們自己的家目錄。</p></dd><dt><span class="term">使用者 Shell (User shell)</span></dt><dd><p>Shell 提供了使用者預設的環境來與系統互動。有數種不同類型的 Shell，有經驗的使用者會有自己偏好的選擇，可儲存在自己的帳號設定。</p></dd></dl></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-superuser"></a>3.3.1.3. 超級使用者帳號</h4></div></div></div><a id="idp64526904" class="indexterm"></a><p>超級使用者帳號，通常稱作 <code class="systemitem">root</code>，用來管理系統，沒有權限的限制，也因這個原因，該帳號不應該用來做每日的例行作業，如：寄信與收信、系統的一般探索或程式設計。</p><p>超級使用者並不像其他使用者帳號，可以沒有限制的操作，不正確的使用超級使用者帳號可能會造成可觀的災害。一般使用者帳號不會因為失誤而法摧毀作業系統，所以建議登入一般使用者帳號，只有在指令需要額外權限時切換為超級使用者。</p><p>使用超級使用者下指令時永遠要再三檢查，由於一個多餘的空白或缺少的字元可能意味著無法挽回的資料遺失。</p><p>有數種方法可以提升為超級使用者權限，雖然可以直接登入為 <code class="systemitem">root</code>，但強烈不建議這樣做。</p><p>改使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> 切換為超級使用者。執行此指令時若指定 <code class="literal">-</code> 參數，該使用者會繼承 root 的使用者環境。執行此指令的使用者必須在 <code class="systemitem">wheel</code> 群組中，否則指令會失敗。使用者也必須要知道 <code class="systemitem">root</code> 使用者帳號的密碼。</p><p>在此例當中，該使用者只在要執行 <code class="command">make install</code> 時切換為超級使用者，因為這個步驟需要超級使用者權限。指令完成之後，該使用者輸入 <code class="command">exit</code> 離開超級使用者帳號並返回他的使用者帳號權限。</p><div class="example"><a id="idp64538680"></a><div class="example-title">範例 3.1. 以超級使用者的身份安裝程式</div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>configure</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>su -</code></strong>
Password:
<code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>exit</code></strong>
<code class="prompt">%</code></pre></div></div><br class="example-break" /><p>內建的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> 框架在單人系統或只有一位系統管理者的小型網路可以運作的很好。另一種方式是安裝 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/sudo/pkg-descr">security/sudo</a> 套件或 Port。此軟體提供了活動記錄且允許管理者設定那個使用者可以用超級使用者執行那個指令。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-modifying"></a>3.3.2. 管理帳號</h3></div></div></div><a id="idp64546488" class="indexterm"></a><p>FreeBSD 提供了各種不同指令來管理使用者帳號，最常用的指令已摘要於 <a class="xref" href="#users-modifying-utilities" title="表格 3.1. 管理使用者帳號的工具">表格 3.1, “管理使用者帳號的工具”</a>，接著有一些用法的範例。請參考每個工具的操作手冊來取得更多詳細的資訊與用法範例。</p><div class="table"><a id="users-modifying-utilities"></a><div class="table-title">表格 3.1. 管理使用者帳號的工具</div><div class="table-contents"><table summary="管理使用者帳號的工具" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>指令</th><th>摘要</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=adduser&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">adduser</span>(8)</span></a></td><td>建議用來新增新使用者的指令列應用程式。</td></tr><tr><td xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rmuser&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rmuser</span>(8)</span></a></td><td>建議用來移除使用者的指令列應用程式。</td></tr><tr><td xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chpass&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chpass</span>(1)</span></a></td><td>用來更改使用者資料庫資訊的工具。</td></tr><tr><td xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(1)</span></a></td><td>用來更改使用者密碼的指令列工具。</td></tr><tr><td xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a></td><td>用來修改使用者帳號各方面資訊強大且靈活的工具。</td></tr></tbody></table></div></div><br class="table-break" /><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-adduser"></a>3.3.2.1. <code class="command">adduser</code></h4></div></div></div><a id="idp64583480" class="indexterm"></a><a id="idp64584760" class="indexterm"></a><a id="idp64585784" class="indexterm"></a><a id="idp64586808" class="indexterm"></a><p>建議用來新增新使用者的程式為 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=adduser&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">adduser</span>(8)</span></a>。當新使用者新增之後，此程式會自動更新 <code class="filename">/etc/passwd</code> 以及 <code class="filename">/etc/group</code>，這同時也會建立新使用者的家目錄 (複製 <code class="filename">/usr/share/skel</code> 中的預設設定檔)，並且可以選擇是否要寄送歡迎訊息通知新使用者。這個工具必須使用超級使用者執行。</p><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=adduser&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">adduser</span>(8)</span></a> 工具採用互動的方式，只需幾個步驟便可建立新使用者帳號。如 <a class="xref" href="#users-modifying-adduser" title="範例 3.2. 在 FreeBSD 新增使用者">範例 3.2, “在 FreeBSD 新增使用者”</a> 所示，可輸入必填的資訊或按 <span class="keycap"><strong>Return</strong></span> 鍵採用方括中的預設值。在此例當中，使用者被邀請加入 <code class="systemitem">wheel</code> 群組，這讓使用者可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> 變成超級使用者。完成之後，此工具會詢問是否要建立其他的使用者或離開。</p><div class="example"><a id="users-modifying-adduser"></a><div class="example-title">範例 3.2. 在 FreeBSD 新增使用者</div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>adduser</code></strong>
Username: <strong class="userinput"><code>jru</code></strong>
Full name: <strong class="userinput"><code>J. Random User</code></strong>
Uid (Leave empty for default):
Login group [jru]:
Login group is jru. Invite jru into other groups? []: <strong class="userinput"><code>wheel</code></strong>
Login class [default]:
Shell (sh csh tcsh zsh nologin) [sh]: <strong class="userinput"><code>zsh</code></strong>
Home directory [/home/jru]:
Home directory permissions (Leave empty for default):
Use password-based authentication? [yes]:
Use an empty password? (yes/no) [no]:
Use a random password? (yes/no) [no]:
Enter password:
Enter password again:
Lock out the account after creation? [no]:
Username   : jru
Password   : ****
Full Name  : J. Random User
Uid        : 1001
Class      :
Groups     : jru wheel
Home       : /home/jru
Shell      : /usr/local/bin/zsh
Locked     : no
OK? (yes/no): <strong class="userinput"><code>yes</code></strong>
adduser: INFO: Successfully added (jru) to the user database.
Add another user? (yes/no): <strong class="userinput"><code>no</code></strong>
Goodbye!
<code class="prompt">#</code></pre></div></div><br class="example-break" /><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">由於密碼在輸入時並不會顯示，在建立使用者帳號時要小心密碼不要輸入錯誤。</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-rmuser"></a>3.3.2.2. <code class="command">rmuser</code></h4></div></div></div><a id="idp64599608" class="indexterm"></a><a id="idp64657976" class="indexterm"></a><p>要自系統完全移除一個使用者可使用超級使用者執行 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rmuser&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rmuser</span>(8)</span></a>。這個指令會執行以下步驟：</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>移除使用者的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=crontab&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">crontab</span>(1)</span></a> 項目，若項目存在。</p></li><li class="step"><p>移除任何屬於該使用者的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=at&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">at</span>(1)</span></a> 工作。</p></li><li class="step"><p>中止所有該使用者擁有的程序。</p></li><li class="step"><p>自系統本地密碼檔移除該使用者。</p></li><li class="step"><p>選擇性移除該使用者的家目錄，若使用者擁有該目錄。</p></li><li class="step"><p>自 <code class="filename">/var/mail</code> 移除屬於該使用者的收件郵件檔。</p></li><li class="step"><p>自暫存檔儲存區域 (如 <code class="filename">/tmp</code>) 移除所有使用者擁有的檔案。</p></li><li class="step"><p>最後，自 <code class="filename">/etc/group</code> 中該使用者所屬的所有群組移除該使用者。若群組無任何成員且群組名稱與該使用者名稱相同，則該群組也會一併移除。這是為了輔助 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=adduser&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">adduser</span>(8)</span></a> 替每位使用者建立獨一無二的群組。</p></li></ol></div><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rmuser&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rmuser</span>(8)</span></a> 無法用來移除超級使用者帳號，因為這幾乎代表著大規模破壞。</p><p>預設會使用互動式模式，如下範例所示。</p><div class="example"><a id="idp64675896"></a><div class="example-title">範例 3.3. <code class="command">rmuser</code> 互動式帳號移除</div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>rmuser jru</code></strong>
Matching password entry:
jru:*:1001:1001::0:0:J. Random User:/home/jru:/usr/local/bin/zsh
Is this the entry you wish to remove? <strong class="userinput"><code>y</code></strong>
Remove user's home directory (/home/jru)? <strong class="userinput"><code>y</code></strong>
Removing user (jru): mailspool home passwd.
<code class="prompt">#</code></pre></div></div><br class="example-break" /></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-chpass"></a>3.3.2.3. <code class="command">chpass</code></h4></div></div></div><a id="idp64680248" class="indexterm"></a><p>任何使用者都可以使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chpass&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chpass</span>(1)</span></a> 來變更自己的預設 Shell 以及與自己的使用者帳號關聯的個人資訊。超級使用者可以使用這個工具更改任何使用者的其他帳號資訊。</p><p>除了選填的使用者名稱外，未傳入任何選項時，<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chpass&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chpass</span>(1)</span></a> 會開啟含有使用者資訊的編輯器。當使用者自編輯器離開，便會更新新的資訊到使用者資料庫。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">離開編輯器時，此工具會提示使用者輸入密碼，除非使用超級使用者執行此工具。</p></div><p>在 <a class="xref" href="#users-modifying-chpass-su" title="範例 3.4. 以超級使用者的身份使用 chpass">範例 3.4, “以超級使用者的身份使用 <code class="command">chpass</code>”</a> 中，超級使用者輸入了 <code class="command">chpass jru</code> 並正在檢視這個使用者可以更改的欄位。若改以 <code class="systemitem">jru</code> 執行這個指令，只會顯示最後六個欄位供編輯，如 <a class="xref" href="#users-modifying-chpass-ru" title="範例 3.5. 以一般使用者的身份使用 chpass">範例 3.5, “以一般使用者的身份使用 <code class="command">chpass</code>”</a> 所示。</p><div class="example"><a id="users-modifying-chpass-su"></a><div class="example-title">範例 3.4. 以超級使用者的身份使用 <code class="command">chpass</code></div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en">#Changing user database information for jru.
Login: jru
Password: *
Uid [#]: 1001
Gid [# or name]: 1001
Change [month day year]:
Expire [month day year]:
Class:
Home directory: /home/jru
Shell: /usr/local/bin/zsh
Full Name: J. Random User
Office Location:
Office Phone:
Home Phone:
Other information:</pre></div></div><br class="example-break" /><div class="example"><a id="users-modifying-chpass-ru"></a><div class="example-title">範例 3.5. 以一般使用者的身份使用 <code class="command">chpass</code></div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en">#Changing user database information for jru.
Shell: /usr/local/bin/zsh
Full Name: J. Random User
Office Location:
Office Phone:
Home Phone:
Other information:</pre></div></div><br class="example-break" /><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">指令 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chfn&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chfn</span>(1)</span></a> 以及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chsh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chsh</span>(1)</span></a> 皆連結至 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chpass&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chpass</span>(1)</span></a>，就如同 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypchpass&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypchpass</span>(1)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypchfn&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypchfn</span>(1)</span></a> 以及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypchsh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypchsh</span>(1)</span></a> 的關係。自從 NIS 支援自動化以後，便不再需要特別加上 <code class="literal">yp</code>，如何設定 NIS 在<a class="xref" href="#network-servers" title="章 29. 網路伺服器">章 29, <em>網路伺服器</em></a> 中有說明。</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-passwd"></a>3.3.2.4. <code class="command">passwd</code></h4></div></div></div><a id="idp64713400" class="indexterm"></a><a id="idp64714424" class="indexterm"></a><p>任何使用者皆可簡單的使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(1)</span></a> 更改自己的密碼。要避免意外或未授權的變更，這個指令在設定新密碼之前會提示使用者輸入原來的密碼：</p><div class="example"><a id="idp64720952"></a><div class="example-title">範例 3.6. 更改您的密碼</div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>passwd</code></strong>
Changing local password for jru.
Old password:
New password:
Retype new password:
passwd: updating the database...
passwd: done</pre></div></div><br class="example-break" /><p>超級使用者可以更改任何使用者的密碼透過在執行 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(1)</span></a> 時指定使用者名稱。當此工具以超級使用者執行時，將不會提示輸入使用者目前的密碼，這可在使用者忘記原來的密碼時更改密碼。</p><div class="example"><a id="idp64724024"></a><div class="example-title">範例 3.7. 以超級使用者的身份更改其他使用者的密碼</div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>passwd jru</code></strong>
Changing local password for jru.
New password:
Retype new password:
passwd: updating the database...
passwd: done</pre></div></div><br class="example-break" /><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">如同 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chpass&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chpass</span>(1)</span></a>，<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=yppasswd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">yppasswd</span>(1)</span></a> 連結到 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(1)</span></a>，因此 <acronym class="acronym">NIS</acronym> 在兩個指令上皆可運作。</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-pw"></a>3.3.2.5. <code class="command">pw</code></h4></div></div></div><a id="idp64730680" class="indexterm"></a><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a> 工具可以建立、移除、修改以及顯示使用者與群組，它的功能是做為系統使用者與群組檔的前端。<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a> 有非常強大的的指令列選項集，這讓該指令非常適合用於 Shell scripts，但新的使用者可能會發現它比其他在本節的指令要複雜許多。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-groups"></a>3.3.3. 管理群組</h3></div></div></div><a id="idp64734520" class="indexterm"></a><a id="idp64739512" class="indexterm"></a><a id="idp64740536" class="indexterm"></a><p>群組代表一群使用者，群組可以由其群組名稱及 <acronym class="acronym">GID</acronym> 來辨識。在 FreeBSD，核心會使用程序的 <acronym class="acronym">UID</acronym> 以及其所屬的群組清單來決定程序可以做那些事。大多數情況使用者或程序的 <acronym class="acronym">GID</acronym> 通常指的是清單中的第一個群組。</p><p>群組名稱與 <acronym class="acronym">GID</acronym> 的對應表列在 <code class="filename">/etc/group</code>。這個純文字檔案使用了四個以冒號分隔的欄位，第一個欄位為群組名稱，第二個欄位為加密後的密碼，第二個欄位為 <acronym class="acronym">GID</acronym> 以及第四個欄位為以逗號分隔的成員清單。要取得更完整的語法說明，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=group&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">group</span>(5)</span></a>。</p><p>超級使用者可以使用文字編輯器修改 <code class="filename">/etc/group</code>，或者可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a> 加入與編輯群組。例如，要加入一個叫做 <code class="systemitem">teamtwo</code> 的群組然後確認該群組已新增：</p><div class="example"><a id="idp64432440"></a><div class="example-title">範例 3.8. 使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a> 新增群組</div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pw groupadd teamtwo</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>pw groupshow teamtwo</code></strong>
teamtwo:*:1100:</pre></div></div><br class="example-break" /><p>在本例中，<code class="literal">1100</code> 是 <code class="systemitem">teamtwo</code> 的 <acronym class="acronym">GID</acronym>。目前 <code class="systemitem">teamtwo</code> 沒有任何成員，這個指令會加入 <code class="systemitem">jru</code> 作為 <code class="systemitem">teamtwo</code> 的成員。</p><div class="example"><a id="idp64439096"></a><div class="example-title">範例 3.9. 使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a> 加入使用者帳號到新的群組</div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pw groupmod teamtwo -M jru</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>pw groupshow teamtwo</code></strong>
teamtwo:*:1100:jru</pre></div></div><br class="example-break" /><p>給 <code class="option">-M</code> 的參數是以逗號分隔的使用者清單，用來加入成員到新的 (空的) 群組或取代既有群組中的成員。對使用者來說這裡的群組成員與使用者列於密碼檔的主要群組不同 (額外的)，這代表在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a> 使用 <code class="option">groupshow</code> 時不會顯示做為使用者主要群組的成員，但會顯示在使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=id&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">id</span>(1)</span></a> 或同類工具所查詢的資訊當中。當使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a> 來加入使用者到某個群組，該指令只會處理 <code class="filename">/etc/group</code> 且不會嘗試自 <code class="filename">/etc/passwd</code> 讀取其他的資料。</p><div class="example"><a id="idp64446904"></a><div class="example-title">範例 3.10. 使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a> 加入新成員到群組</div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pw groupmod teamtwo -m db</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>pw groupshow teamtwo</code></strong>
teamtwo:*:1100:jru,db</pre></div></div><br class="example-break" /><p>在本例當中，給 <code class="option">-m</code> 的參數是以逗號分隔的使用者清單，用來加入使用者到群組。不像前面的例子，這些使用者會加入到群組，而非取代既有群組中的使用者。</p><div class="example"><a id="idp64451128"></a><div class="example-title">範例 3.11. 使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=id&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">id</span>(1)</span></a> 來查看所屬群組</div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>id jru</code></strong>
uid=1001(jru) gid=1001(jru) groups=1001(jru), 1100(teamtwo)</pre></div></div><br class="example-break" /><p>在本例中，<code class="systemitem">jru</code> 是群組 <code class="systemitem">jru</code> 以及 <code class="systemitem">teamtwo</code> 的成員。</p><p>要取得更多有關此指令的資訊及 <code class="filename">/etc/group</code> 的格式，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a> 以及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=group&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">group</span>(5)</span></a>。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="permissions"></a>3.4. 權限</h2></div></div></div><a id="idp64774456" class="indexterm"></a><p>在 FreeBSD 中，每個檔案與目都有相關聯的數個權限，且有許多工具可以檢視與修改這些權限。了解權限如何運作是必須的，這可確保使用者能夠存存取它們所需的檔案以及無法不正確的存取供作業系統或其他使用者擁有的檔案。</p><p>本節會探討在 FreeBSD 中所用到的傳統 <span class="trademark">UNIX</span>® 權限。要做檔案系統存取控制的微調，請參考 <a class="xref" href="#fs-acl" title="13.9. 存取控制清單">節 13.9, “存取控制清單”</a>。</p><p>在 <span class="trademark">UNIX</span>®，基礎權限透過三種類型的存取來分配：讀取、寫入與執行。這些存取類型用來決定檔案擁有者、群組以及其他人 (其他任何人) 的檔案存取權。讀取、寫入及執行權限可使用 <code class="literal">r</code>, <code class="literal">w</code>, and <code class="literal">x</code> 字母來表示。這些權限也可以使用二進位數字來表示每種權限的開或關 (<code class="literal">0</code>)。當以二進位數字來表示時，閱讀的順序為 <code class="literal">rwx</code>，其中 <code class="literal">r</code> 開啟的值為 <code class="literal">4</code>，<code class="literal">w</code> 開啟的值為 <code class="literal">2</code> 以及 <code class="literal">x</code> 開啟的值為 <code class="literal">1</code>。</p><p>表格 4.1 摘要了可用的數字及可用的字母。當閱讀 <span class="quote">“<span class="quote">目錄清單標示</span>”</span> 欄位時，<code class="literal">-</code> 用來代表該權限設為關閉。</p><a id="idp64783544" class="indexterm"></a><a id="idp64784440" class="indexterm"></a><div class="table"><a id="idp64785336"></a><div class="table-title">表格 3.2. <span class="trademark">UNIX</span>® 權限</div><div class="table-contents"><table summary="UNIX 權限" width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>數值</th><th>權限</th><th>目錄清單標示</th></tr></thead><tbody><tr><td xml:lang="en" lang="en">0</td><td>不可讀取, 不可寫入, 不可執行</td><td xml:lang="en" lang="en"><code class="literal">---</code></td></tr><tr><td xml:lang="en" lang="en">1</td><td>不可讀取, 不可寫入, 可執行</td><td xml:lang="en" lang="en"><code class="literal">--x</code></td></tr><tr><td xml:lang="en" lang="en">2</td><td>不可讀取, 可寫入, 不可執行</td><td xml:lang="en" lang="en"><code class="literal">-w-</code></td></tr><tr><td xml:lang="en" lang="en">3</td><td>不可讀取, 可寫入, 可執行</td><td xml:lang="en" lang="en"><code class="literal">-wx</code></td></tr><tr><td xml:lang="en" lang="en">4</td><td>可讀取, 不可寫入, 不可執行</td><td xml:lang="en" lang="en"><code class="literal">r--</code></td></tr><tr><td xml:lang="en" lang="en">5</td><td>可讀取, 不可寫入, 可執行</td><td xml:lang="en" lang="en"><code class="literal">r-x</code></td></tr><tr><td xml:lang="en" lang="en">6</td><td>可讀取, 可寫入, 不可執行</td><td xml:lang="en" lang="en"><code class="literal">rw-</code></td></tr><tr><td xml:lang="en" lang="en">7</td><td>可讀取, 可寫入, 可執行</td><td xml:lang="en" lang="en"><code class="literal">rwx</code></td></tr></tbody></table></div></div><br class="table-break" /><a id="idp64821304" class="indexterm"></a><a id="idp64822712" class="indexterm"></a><p>使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a> 指令時，可以加上 <code class="option">-l</code> 參數， 來檢視詳細的目錄清單。 清單中欄位的資訊包含檔案對所有者、群組及其他人的權限。 在任一個目錄底下執行 <code class="command">ls -l</code>，會顯示如下的結果：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>ls -l</code></strong>
total 530
-rw-r--r--  1 root  wheel     512 Sep  5 12:31 myfile
-rw-r--r--  1 root  wheel     512 Sep  5 12:31 otherfile
-rw-r--r--  1 root  wheel    7680 Sep  5 12:31 email.txt</pre><p>第一個 (最左邊) 的字元用來表示這個檔案的類型為何，除標準檔案以外，尚有目錄、特殊字元裝置、Socket 及其他特殊虛擬檔案裝置， 在此例當中，<code class="literal">-</code> 表示該檔案為一個標準的檔案。 範例中接下來的三個字元中，<code class="literal">rw-</code> 代表所有者對檔案擁有的權限。 再接下來的三個字元， <code class="literal">r--</code> 則代表群組對檔案擁有的權限， 最後三個字元，<code class="literal">r--</code> 則代表其他人對檔案擁有的權限。 破折號 (-) 表示沒有權限，範例中的這個檔案的權限， 只允許所有者讀取、寫入檔案，群組以及其他人僅能讀取檔案。 根據以上的表格，此種權限的檔案可以使用 <code class="literal">644</code> 來表示， 每組數字分別代表檔案的三種權限。</p><p>那系統如何控制裝置的權限？ 實際上 FreeBSD 對大多的硬碟裝置就如同檔案，程式可以開啟、讀取以及寫入資料如一般檔案。 這些特殊裝置檔案都儲存於 <code class="filename">/dev/</code> 目錄中。</p><p>目錄也同如檔案，擁有讀取、寫入及執行的權限， 但在執行權限上與檔案有明顯的差異。 當目錄被標示為可執行時，代表可以使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cd</span>(1)</span></a> 指令切換進入該目錄。 也代表能夠存取在此目錄之中的已知檔名的檔案，但仍會受限於檔案本身所設定的權限。</p><p>要能夠列出目錄內容，必須擁有目錄的讀取權限。 要刪除已知檔名的檔案，必須擁有檔案所在目錄的寫入 <span class="emphasis"><em>以及</em></span> 執行的權限。</p><p>還有一些權限位元，但這些權限主要在特殊情況使用，如 setuid 執行檔及 sticky 目錄。 如果您還想知道更多檔案權限的資訊及使用方法，請務必參閱 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chmod&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chmod</span>(1)</span></a>。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64837048"></a>3.4.1. 權限符號</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp64840504" class="indexterm"></a><p>權限符號可稱做符號表示，使用字元的方式來取代使用數值來設定檔案或目錄的權限。 符號表示的格式依序為 (某人)(動作)(權限)，可使用的符號如下：</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>項目</th><th>字母</th><th>代表意義</th></tr></thead><tbody><tr><td>(某人)</td><td xml:lang="en" lang="en">u</td><td>使用者</td></tr><tr><td>(某人)</td><td xml:lang="en" lang="en">g</td><td>群組所有者</td></tr><tr><td>(某人)</td><td xml:lang="en" lang="en">o</td><td>其他</td></tr><tr><td>(某人)</td><td xml:lang="en" lang="en">a</td><td>全部 (<span class="quote">“<span class="quote">world</span>”</span>)</td></tr><tr><td>(動作)</td><td xml:lang="en" lang="en">+</td><td>增加權限</td></tr><tr><td>(動作)</td><td xml:lang="en" lang="en">-</td><td>移除權限</td></tr><tr><td>(動作)</td><td xml:lang="en" lang="en">=</td><td>指定權限</td></tr><tr><td>(權限)</td><td xml:lang="en" lang="en">r</td><td>讀取</td></tr><tr><td>(權限)</td><td xml:lang="en" lang="en">w</td><td>寫入</td></tr><tr><td>(權限)</td><td xml:lang="en" lang="en">x</td><td>執行</td></tr><tr><td>(權限)</td><td xml:lang="en" lang="en">t</td><td>Sticky 位元</td></tr><tr><td>(權限)</td><td xml:lang="en" lang="en">s</td><td>設定 UID 或 GID</td></tr></tbody></table></div><p>如先前同樣使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chmod&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chmod</span>(1)</span></a> 指令來設定，但使用的參數為這些字元。 例如，您可以使用下列指令禁止其他使用者存取檔案 <em class="replaceable"><code>FILE</code></em>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>chmod go= FILE</code></strong></pre><p>若有兩個以上的權限更改可以使用逗號 (,) 區隔。 例如，下列指令將會移除群組及全部人 (<span class="quote">“<span class="quote">world</span>”</span>) 對檔案 <em class="replaceable"><code>FILE</code></em> 的寫入權限， 並使全部人對該檔有執行權限：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>chmod go-w,a+x <em class="replaceable"><code>FILE</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64892088"></a>3.4.2. FreeBSD 檔案旗標</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p>除了前面提到的檔案權限外，FreeBSD 支援使用 <span class="quote">“<span class="quote">檔案旗標</span>”</span>。 這些旗標增加了檔案的安全性及管理性，但不包含目錄。有了檔案旗標可確保在某些時候 <code class="systemitem">root</code> 不會意外將檔案修改或移除。</p><p>修改的檔案 flag 僅需要使用擁有簡易的介面的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chflags</span>(1)</span></a> 工具。 例如，標示系統禁止刪除的旗標於檔案 <code class="filename">file1</code>，使用下列指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>chflags sunlink file1</code></strong></pre><p>若要移除系統禁止刪除的旗標，只需要簡單在 <code class="option">sunlink</code> 前加上 <span class="quote">“<span class="quote">no</span>”</span>，例如：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>chflags nosunlink file1</code></strong></pre><p>使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a> 及參數 <code class="option">-lo</code> 可檢視檔案目前的旗標：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ls -lo file1</code></strong></pre><pre xml:lang="en" class="programlisting" lang="en">-rw-r--r--  1 trhodes  trhodes  sunlnk 0 Mar  1 05:54 file1</pre><p>多數的旗標僅能由 <code class="systemitem">root</code> 使用者來標示或移除，而部份旗標可由檔案所有者設定。 我們建議系統管理者可閱讀 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chflags</span>(1)</span></a> 及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chflags</span>(2)</span></a> 說明以瞭解相關細節。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64911544"></a>3.4.3. <code class="literal">setuid</code> 、<code class="literal">setgid</code> 與 <code class="literal">sticky</code> 權限</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p>除了已經探討過的權限外，這裡尚有另外三種特別的設定所有管理者都應該知道，這些設定為 <code class="literal">setuid</code>, <code class="literal">setgid</code> 以及 <code class="literal">sticky</code> 權限。</p><p>這些設定對某些一般不會授權給一般使用者的 <span class="trademark">UNIX</span>® 操作非常重要，它讓這些功能可運作。要了解這些權限，就必須說明真實使用者 ID (Real user ID) 與有效使用者 ID (Effective user ID) 的差異。</p><p>真實使用者 ID 即是擁有者或啟動程序者的 <acronym class="acronym">UID</acronym>，而有效 <acronym class="acronym">UID</acronym> 是執行程序所使用的使用者 ID。例如，<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(1)</span></a> 在使用者更改自己的密碼時會以真實使用者 ID 執行，然而，為了要更新密碼資料庫，該指令必須以 <code class="systemitem">root</code> 使用者做為有效 ID 來執行，這讓使用者可以更改自己的密碼而不會遇到權限不足 (<span class="errorname">Permission Denied</span>) 的錯誤。</p><p>setuid 權限可以透過在權限集前加上數字 (4) 來設定，如下範例所示：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>chmod 4755 suidexample.sh</code></strong></pre><p>現在 <code class="filename"><em class="replaceable"><code>suidexample.sh</code></em></code> 的權限會如下所示：</p><pre xml:lang="en" class="programlisting" lang="en">-rwsr-xr-x   1 trhodes  trhodes    63 Aug 29 06:36 suidexample.sh</pre><p>注意，<code class="literal">s</code> 現在取代了原來的執行位元成為指定檔案擁有者權限集的一部份，這會允許須要提升權限的工具，如 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(1)</span></a> 可正常使用。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> 的 <code class="literal">nosuid</code> 選項會造成這類 Binary 執行失敗，但不會警告使用者。由於 <code class="literal">nosuid</code> Wrapper 可能可繞過該選項，因此該選項並非完全可靠。</p></div><p>實際來看這個範例，先開啟兩個終端機，其中一個用一般使用者輸入 <code class="command">passwd</code>。在等待輸入新密碼的同時，檢查程序表並查看 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(1)</span></a> 程序的使用者資訊：</p><p>於終端機 A：</p><pre xml:lang="en" class="screen" lang="en">Changing local password for trhodes
Old Password:</pre><p>於終端機 B：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ps aux | grep passwd</code></strong></pre><pre xml:lang="en" class="screen" lang="en">trhodes  5232  0.0  0.2  3420  1608   0  R+    2:10AM   0:00.00 grep passwd
root     5211  0.0  0.2  3620  1724   2  I+    2:09AM   0:00.01 passwd</pre><p>雖然使用一般使用者來執行 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(1)</span></a>，但該程序使用了 <code class="systemitem">root</code> 的有效 <acronym class="acronym">UID</acronym>。</p><p><code class="literal">setgid</code> 權限的功能與 <code class="literal">setuid</code> 相似，當應用程式或工具使用此設定執行時，將會以擁有該檔案的群組來執行，而非執行行該程序的使用者。</p><p>要在檔案設定 <code class="literal">setgid</code> 權限，需在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chmod&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chmod</span>(1)</span></a> 的參數前加上 (2)：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>chmod 2755 sgidexample.sh</code></strong></pre><p>注意以下清單中，<code class="literal">s</code> 現在位於指定群組權限設定的欄位：</p><pre xml:lang="en" class="screen" lang="en">-rwxr-sr-x   1 trhodes  trhodes    44 Aug 31 01:49 sgidexample.sh</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">在以上這些範例中，雖然在例子中的 Shell script 是可執行的檔案，但並不會以其他的 <acronym class="acronym">EUID</acronym> 或有效使用者 ID 執行，這是因為 Shell script 並不會存取 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=setuid&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">setuid</span>(2)</span></a> 系統呼叫 (System call)。</p></div><p><code class="literal">setuid</code> 及 <code class="literal">setgid</code> 權限位元可能會因允許提升權限而降低系統的安全性，因此有了第三個特殊的權限：<code class="literal">sticky bit</code>，可以加強系統的安全性。</p><p>當在目錄上設定 <code class="literal">sticky bit</code>，將只允許由檔案擁有者刪除檔案。這對避免公開目錄，如 <code class="filename">/tmp</code> 中的檔案被不擁有該檔案的人刪除非常有用。要使用這個權限，可在權限集前加上 (1)：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>chmod 1777 /tmp</code></strong></pre><p><code class="literal">sticky bit</code> 權限會以 <code class="literal">t</code> 顯示於權限集的最後：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ls -al / | grep tmp</code></strong></pre><pre xml:lang="en" class="screen" lang="en">drwxrwxrwt  10 root  wheel         512 Aug 31 01:49 tmp</pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dirstructure"></a>3.5. 目錄結構</h2></div></div></div><a id="idp64989240" class="indexterm"></a><p>認識 FreeBSD 的目錄架構，就可對系統有概略的基礎理解。 最重要的莫過於整個目錄的根目錄，就是 <span class="quote">“<span class="quote">/</span>”</span> 目錄， 該目錄會在開機時最先掛載 (mount)，裡面會有開機所會用到必備檔案。 此外，根目錄還有紀錄其他檔案系統的掛載點相關設定。</p><p>「掛載點」就是讓新增的檔案系統，能接到上層的檔案系統 (通常就是「根目錄」檔案系統) 的目錄。 在 <a class="xref" href="#disk-organization" title="3.6. 磁碟組織">節 3.6, “磁碟組織”</a> 這邊對此有更詳細介紹。 標準的掛載點包括了 <code class="filename">/usr/</code>, <code class="filename">/var/</code>, <code class="filename">/tmp/</code>, <code class="filename">/mnt/</code> 以及 <code class="filename">/cdrom/</code>。 這些目錄通常會記錄在 <code class="filename">/etc/fstab</code> 設定檔內。 <code class="filename">/etc/fstab</code> 是記錄各檔案系統及相關掛載點的表格。 大部分在 <code class="filename">/etc/fstab</code> 有記錄的檔案系統，會在開機時由 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> Script 來自動掛載，除非它們有設定 <code class="option">noauto</code> 選項。 其中細節說明可參閱 <a class="xref" href="#disks-fstab" title="3.7.1. fstab 檔">節 3.7.1, “<code class="filename">fstab</code> 檔”</a>。</p><p>有關檔案系統架構的完整說明可參閱 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hier&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hier</span>(7)</span></a>。 現在呢，讓我們大致先一窺常見的目錄有哪些吧。</p><p>
      </p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>目錄</th><th>說明</th></tr></thead><tbody valign="top"><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/</code></td><td valign="top">檔案系統的根目錄。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/bin/</code></td><td valign="top">單使用者 (Single-user)、多使用者 (Multi-user) 兩種模式皆可使用的基本工具 。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/boot/</code></td><td valign="top">作業系統開機過程會用到的程式、設定檔。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/boot/defaults/</code></td><td valign="top">預設的開機啟動設定檔，詳情請參閱 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader.conf</span>(5)</span></a>。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/dev/</code></td><td valign="top">裝置節點 (Device node)，詳情請參閱 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=intro&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">intro</span>(4)</span></a>。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/etc/</code></td><td valign="top">系統設定檔及一些 Script 檔。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/etc/defaults/</code></td><td valign="top">預設的系統設定檔，詳情請參閱 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a>。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/etc/mail/</code></td><td valign="top">郵件傳輸代理程式，像是 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sendmail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sendmail</span>(8)</span></a> 的相關設定檔。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/etc/periodic/</code></td><td valign="top">每日、每週、每月透過 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>，執行的定期排程 Script，詳情請參閱 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">periodic</span>(8)</span></a>。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/etc/ppp/</code></td><td valign="top"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> 設定檔。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/mnt/</code></td><td valign="top">系統管理者慣用充當臨時掛載點的空目錄。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/proc/</code></td><td valign="top">程序 (Process) 檔案系統，詳情請參閱 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=procfs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">procfs</span>(5)</span></a> 及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount_procfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount_procfs</span>(8)</span></a>。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/rescue/</code></td><td valign="top">緊急救援用途的一些靜態連結 (Statically linked) 的程式，詳情請參閱 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rescue&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rescue</span>(8)</span></a>。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/root/</code></td><td valign="top"><code class="systemitem">root</code> 帳號的家目錄。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/sbin/</code></td><td valign="top">供單使用者 (Single-user) 及多使用者 (Multi-user) 環境使用的系統程式及管理工具 。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/tmp/</code></td><td valign="top">臨時檔案。 一般而言，重開機之後 /tmp 內的東西會被<span class="emphasis"><em>清除</em></span>掉。 而通常會將以記憶體為基礎 (Memory-based) 的檔案系統掛載在 <code class="filename">/tmp</code> 上。 這些瑣事可透過 tmpmfs 相關的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> 環境變數來自動完成 。(或是在 <code class="filename">/etc/fstab</code> 內做設定， 詳情請參閱 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mdmfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mdmfs</span>(8)</span></a>)。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/usr/</code></td><td valign="top">主要是使用者所安裝的工具程式、應用程式存放處。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/usr/bin/</code></td><td valign="top">常用工具、開發工具、應用軟體。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/usr/include/</code></td><td valign="top">標準 C include 檔案。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/usr/lib/</code></td><td valign="top">程式庫存放處。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/usr/libdata/</code></td><td valign="top">其他各式工具的資料檔。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/usr/libexec/</code></td><td valign="top">系統 Daemon 及系統工具程式 (透過其他程式來執行)。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/usr/local/</code></td><td valign="top">存放一些自行安裝的執行檔、程式庫等等。 同時，也是 FreeBSD Port 架構的預設安裝目錄。 <code class="filename">/usr/local</code> 內的目錄架構大致與 <code class="filename">/usr</code> 相同，詳情請參閱 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hier&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hier</span>(7)</span></a> 說明。 但 man 目錄例外，它們是直接放在 <code class="filename">/usr/local</code> 底下，而非 <code class="filename">/usr/local/share</code>，而 Port 所安裝的說明文件則在 <code class="filename">share/doc/<em class="replaceable"><code>port</code></em></code>。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/usr/obj/</code></td><td valign="top">在編譯 <code class="filename">/usr/src</code> 目錄時所產生的相關架構目地檔。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/usr/ports/</code></td><td valign="top">FreeBSD Port 套件集 (選用)。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/usr/sbin/</code></td><td valign="top">由使用者執行的系統 Daemon 及系統工具。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/usr/share/</code></td><td valign="top">各架構皆共通的檔案。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/usr/src/</code></td><td valign="top">BSD 原始碼 (或自行新增的)。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/var/</code></td><td valign="top">存放各種用途的日誌 (Log) 檔、臨時或暫時存放、列印或郵件的緩衝 (Spool) 檔案。有時候，以記憶體為基礎 (Memory-based) 的檔案系統也會掛載在 <code class="filename">/var</code>。 這些瑣事可透過 varmfs 相關的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> 環境變數來自動完成。(或是在 <code class="filename">/etc/fstab</code> 內做設定，相關細節請參閱 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mdmfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mdmfs</span>(8)</span></a>)。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/var/log/</code></td><td valign="top">各項系統記錄的日誌 (Log) 檔。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/var/mail/</code></td><td valign="top">各使用者的郵件 (Mailbox) 檔案。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/var/spool/</code></td><td valign="top">各種印表機、郵件系統的緩衝 (Spool) 目錄。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/var/tmp/</code></td><td valign="top">臨時檔案。 這些檔案在重開機後通常仍會保留，除非 <code class="filename">/var</code> 是屬於以記憶體為基礎 (Memory-based) 的檔案系統。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="filename">/var/yp/</code></td><td valign="top">NIS 對應表。</td></tr></tbody></table></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disk-organization"></a>3.6. 磁碟組織</h2></div></div></div><p>FreeBSD 用來尋找檔案的最小單位就是檔案的名稱了。 檔案的名稱有大小寫之分，所以說 <code class="filename">readme.txt</code> 和 <code class="filename">README.TXT</code> 是兩個不同的檔案。 FreeBSD 並不使用副檔名 (.txt) 來判別這是一個程式檔、文件檔或是其他類型的檔案。</p><p>檔案存在目錄裡面。 一個目錄中可能沒有任何檔案，也可能有好幾百個檔案。 目錄之中也可以包含其他的目錄； 您可以建立階層式的目錄以便資料的管理。</p><p>檔案或目錄的對應是藉由給定的檔案或目錄名稱，然後加上正斜線符號 (<code class="literal">/</code>)；之後再視需要加上其他的目錄名稱。 如果您有一個目錄 <code class="filename">foo</code> ，裡面有一個目錄叫作 <code class="filename">bar</code>，這個目錄中又包含了一個叫 <code class="filename">readme.txt</code> 的檔案，那麼這個檔案的全名，或者說檔案的<em class="firstterm">路徑 (Path)</em>就是 <code class="filename">foo/bar/readme.txt</code>。注意這與 <span class="trademark">Windows</span>® 用來分隔檔案與目錄名稱所使用的 <code class="literal">\</code> 不同，且 FreeBSD 在路徑上並不使用磁碟機代號或其他磁碟機名稱，意思是，在 FreeBSD 上不會有人輸入 <code class="filename">c:\foo\bar\readme.txt</code> 這種路徑。</p><p>目錄及檔案儲存在檔案系統 (File system) 之中。 每個檔案系統都有唯一一個最上層的目錄，叫做<em class="firstterm">根目錄 (Root directory)</em>。 然後在這個根目錄下面才能有其他的目錄。其中一個檔案系統會被指定成為<em class="firstterm">根檔案系統 (Root file system)</em> 或 <code class="literal">/</code>，其他的檔案系統均會<em class="firstterm">掛載 (Mount)</em> 在該根檔案系統之下，不論在 FreeBSD 有多少個磁碟，所有目錄都會成為該磁碟的一部份。</p><p>假設您有三個檔案系統，分別叫作 <code class="literal">A</code>, <code class="literal">B</code> 及 <code class="literal">C</code>。 每個檔案系統都包含兩個目錄，叫做 <code class="literal">A1</code>, <code class="literal">A2</code> (以此類推得 <code class="literal">B1</code>, <code class="literal">B2</code> 及 <code class="literal">C1</code>, <code class="literal">C2</code>)。</p><p>稱 <code class="literal">A</code> 為主要的檔案系統；如果您用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a> 指令查看此目錄的內容，您會看到兩個子目錄： <code class="literal">A1</code> 及 <code class="literal">A2</code>，如下所示：</p><div class="mediaobject"><img src="basics/example-dir1.png" /></div><p>一個檔案系統必須以目錄形式掛載於另一個檔案系統上。 因此，假設您將 <code class="literal">B</code> 掛載於 <code class="literal">A1</code> 之上，則 <code class="literal">B</code> 的根目錄就變成了 <code class="literal">A1</code>，而在 <code class="literal">B</code> 之下的任何目錄的路徑也隨之改變：</p><div class="mediaobject"><img src="basics/example-dir2.png" /></div><p>在 <code class="literal">B1</code> 或 <code class="literal">B2</code> 目錄中的任何檔案必須經由路徑 <code class="filename">/A1/B1</code> 或 <code class="filename">/A1/B2</code> 才能達到。 所有原來在 <code class="filename">/A1</code> 中的檔案會暫時被隱藏起來，直到 <code class="literal">B</code> 被<em class="firstterm">卸載 (Unmount)</em> 後才會再顯現出來。</p><p>如果 <code class="literal">B</code> 掛載在 <code class="literal">A2</code> 之上，則會變成：</p><div class="mediaobject"><img src="basics/example-dir3.png" /></div><p>上面的路徑分別為 <code class="filename">/A2/B1</code> 及 <code class="filename">/A2/B2</code>。</p><p>檔案系統可以掛在其他檔案系統的目錄之上。 延續之前的例子，<code class="literal">C</code> 檔案系統可以掛在檔案系統 <code class="literal">B</code> 的 <code class="literal">B1</code> 目錄之上，如圖所示：</p><div class="mediaobject"><img src="basics/example-dir4.png" /></div><p>或者 <code class="literal">C</code> 直接掛載於 <code class="literal">A</code> 的 <code class="literal">A1</code> 目錄之上：</p><div class="mediaobject"><img src="basics/example-dir5.png" /></div><p>您可以使用單一的一個大的根檔案系統而不建立其他的檔案系統。 這樣有好處也有有壞處。</p><div class="itemizedlist"><div class="itemizedlist-title">使用多個檔案系統的好處</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>不同的檔案系統在掛上的時候可以有不同的 <em class="firstterm">掛載參數 (Mount option)</em>。 舉例來說，為求謹慎您可以將根檔案系統設成唯讀， 以避免不小心刪除或修改掉重要的檔案。 將使用者可寫入的檔案系統 (例如 <code class="filename">/home</code>) 獨立出來也可以讓他們用 <em class="firstterm">nosuid</em> 的參數掛載，此選項可以讓在這個檔案系統中執行檔的 <em class="firstterm">suid</em>/<em class="firstterm">guid</em> 位元失效，可讓系統更安全。</p></li><li class="listitem"><p>FreeBSD 會自動根據您檔案系統的使用方式來做最佳的檔案配置方式。 因此，一個有很多小檔案、 常常寫入的檔案系統跟只有幾個較大的檔案的檔案系統配置是不一樣的。 如果您只有單一個大的檔案系統，這部分就沒用了。</p></li><li class="listitem"><p>FreeBSD 的檔案系統在停電的時候很穩固。 然而，在某些重要的時候停電仍然會對檔案系統結構造成損害。 分割成許多個檔案系統的話在系統在停電後比較能夠正常啟動， 以便您在需要的時候將備份資料回存回來。</p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">使用單一檔案系統的好處</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>檔案系統的大小是固定的。 若您在當初安裝 FreeBSD 的時指定了一個大小，可是後來您想把空間加大，在沒有備份的情況下很難達成，您必須將檔案系統重新建立為您需要的大小，然後將備份回存回來。</p><div xmlns="" class="important"><h3 class="admontitle">重要: </h3><p xmlns="http://www.w3.org/1999/xhtml">FreeBSD 的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growfs</span>(8)</span></a> 指令可以突破此限制直接變更檔案系統的大小。</p></div></li></ul></div><p>檔案系統放在分區 (Partition) 中。 因為 FreeBSD 承襲 <span class="trademark">UNIX</span>® 架構，這邊講的分區和一般提到的分割區 (例如 <span class="trademark">MS-DOS</span>® 分割區) 不同。每一個分區由一個代號 (字母) 表示，從 <code class="literal">a</code> 到 <code class="literal">h</code>。 每個分區只能含有一個檔案系統，因此在表示檔案系統時，除了用該檔案系統的常用的掛載點表示外，也可以使用該檔案系統所在的分區來表示。</p><p>FreeBSD 也會使用磁碟空間作為<em class="firstterm">交換空間 (Swap space)</em> 來提供<em class="firstterm">虛擬記憶體 (Virtual memory)</em>。 這讓您的電腦好像擁有比實際更多的記憶體。 當 FreeBSD 的記憶體用完的時候，它會把一些目前沒用到的資料移到交換空間，然後在用到的時候移回去 (同時移出部份沒用到的)。</p><p>有些分割區有特定的使用慣例。</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>分區</th><th>慣例</th></tr></thead><tbody valign="top"><tr><td xml:lang="en" valign="top" lang="en"><code class="literal">a</code></td><td valign="top">通常含有根檔案系統。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="literal">b</code></td><td valign="top">通常含有交換空間。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="literal">c</code></td><td valign="top">通常用來代表整個切割區 (Slice)，因此大小會與其所在的切割區一樣。這可讓需要對整個切割區處理的工具 (例如硬碟壞軌檢查工具) 可在 <code class="literal">c</code> 分區上執行。一般來說不會把檔案系統建立在這個分區。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><code class="literal">d</code></td><td valign="top">分區 <code class="literal">d</code> 曾經有代表特殊意義，但是已經不再使用。所以現在 <code class="literal">d</code> 和一般的分區相同。</td></tr></tbody></table></div><p>在 FreeBSD 的磁碟會分割成數個切割區 (Slice)，如同 <span class="trademark">Windows</span>® 中由編號 1 到 4 表示的分割區。這些切割區會再分成數個分區，每個分區內含檔案系統，且會使用字母來標示。</p><a id="idp65244984" class="indexterm"></a><a id="idp65245880" class="indexterm"></a><a id="idp65246776" class="indexterm"></a><p>切割區的編號在裝置名稱後面，會先以 <code class="literal">s</code> 為字首，然後從 1 開始編號。 因此 <span class="quote">“<span class="quote">da0<span class="emphasis"><em>s1</em></span></span>”</span> 是指第一個 SCSI 硬碟的第一個切割區。 一個磁碟上只能有四個實體切割區，但是在實體切割區中放進適當類型的邏輯切割區。這些延伸的切割區編號會從 5 開始，所以 <span class="quote">“<span class="quote">ada0<span class="emphasis"><em>s5</em></span></span>”</span> 是第一個 SATA 硬碟上的第一個延伸切割區。因此可以預期這些由檔案系統使用的裝置 (Device) 上均會各別佔據一個切割區。</p><p>切割區、<span class="quote">“<span class="quote">危險專用 (Dangerously dedicated)</span>”</span> 的實體磁碟機以及其他內含<em class="firstterm">分割區 (Partition)</em> 的磁碟都是以字母 <code class="literal">a</code> 到 <code class="literal">h</code> 來表示。 字母會接在裝置名稱的後面，因此 <span class="quote">“<span class="quote">da0<span class="emphasis"><em>a</em></span></span>”</span> 是第一顆 <span class="quote">“<span class="quote">dangerously dedicated</span>”</span> 磁碟機 <code class="literal">da</code> 上的 <code class="literal">a</code> 分割區。 而 <span class="quote">“<span class="quote">ada1s3<span class="emphasis"><em>e</em></span></span>”</span> 則是第二顆 SATA 硬碟上第三個切割區的第五個分區。</p><p>終於，我們可以辨識系統上的每個磁碟了，一個磁碟的名稱會有一個代碼來表示這個磁碟的類型，接著是一個表示這是那一個磁碟的編號。不像切割區，磁碟的編號從 0 開始。常見的代碼可以參考 <a class="xref" href="#disks-naming" title="表格 3.3. 磁碟裝置名稱">表格 3.3, “磁碟裝置名稱”</a>。</p><p>當要參照一個分區的時候，需包含磁碟機名稱、<code class="literal">s</code>、切割區編號以及分區字母。範例可以參考 <a class="xref" href="#basics-disk-slice-part" title="範例 3.12. 磁碟、切割區及分區命名範例">範例 3.12, “磁碟、切割區及分區命名範例”</a>。</p><p><a class="xref" href="#basics-concept-disk-model" title="範例 3.13. 磁碟的概念模型">範例 3.13, “磁碟的概念模型”</a> 示範了一個基本的磁碟配置，相信對您有些幫助。</p><p>要安裝 FreeBSD，您必須先建置磁碟的切割區，接著於切割區中建立要給 FreeBSD 用的分區。 最後在這些分區中建立檔案系統 (或交換空間) 並決定要將這些檔案系統掛載於哪裡。</p><div class="table"><a id="disks-naming"></a><div class="table-title">表格 3.3. 磁碟裝置名稱</div><div class="table-contents"><table summary="磁碟裝置名稱" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>磁碟機類型</th><th>磁碟機裝置稱</th></tr></thead><tbody><tr><td><acronym class="acronym">SATA</acronym> 及 <acronym class="acronym">IDE</acronym> 硬碟</td><td><code class="literal">ada</code> 或 <code class="literal">ad</code></td></tr><tr><td><acronym class="acronym">SCSI</acronym> 硬碟與 <acronym class="acronym">USB</acronym> 儲存裝置</td><td xml:lang="en" lang="en"><code class="literal">da</code></td></tr><tr><td><acronym class="acronym">SATA</acronym> 與 <acronym class="acronym">IDE</acronym> <acronym class="acronym">CD-ROM</acronym> 光碟機</td><td><code class="literal">cd</code> 或 <code class="literal">acd</code></td></tr><tr><td><acronym class="acronym">SCSI</acronym> <acronym class="acronym">CD-ROM</acronym> 光碟機</td><td xml:lang="en" lang="en"><code class="literal">cd</code></td></tr><tr><td>軟碟機</td><td xml:lang="en" lang="en"><code class="literal">fd</code></td></tr><tr><td>各種非標準 <acronym class="acronym">CD-ROM</acronym> 光碟機</td><td><code class="literal">mcd</code> 代表 Mitsumi <acronym class="acronym">CD-ROM</acronym> 以及 <code class="literal">scd</code> 代表 Sony <acronym class="acronym">CD-ROM</acronym> 光碟機</td></tr><tr><td><acronym class="acronym">SCSI</acronym> 磁帶機</td><td xml:lang="en" lang="en"><code class="literal">sa</code></td></tr><tr><td><acronym class="acronym">IDE</acronym> 磁帶機</td><td xml:lang="en" lang="en"><code class="literal">ast</code></td></tr><tr><td>RAID 磁碟機</td><td>範例包含 <code class="literal">aacd</code> 代表 <span class="trademark">Adaptec</span>® AdvancedRAID，<code class="literal">mlxd</code> 及 <code class="literal">mlyd</code> 代表 <span class="trademark">Mylex</span>®，<code class="literal">amrd</code> 代表 AMI <span class="trademark">MegaRAID</span>®，<code class="literal">idad</code> 代表 Compaq Smart RAID，<code class="literal">twed</code> 代表 <span class="trademark">3ware</span>® RAID.</td></tr></tbody></table></div></div><br class="table-break" /><div class="example"><a id="basics-disk-slice-part"></a><div class="example-title">範例 3.12. 磁碟、切割區及分區命名範例</div><div class="example-contents"><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>名稱</th><th>意義</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><code class="literal">ada0s1a</code></td><td>第一個 SATA 硬碟 (<code class="literal">ada0</code>) 上第一個切割區 (<code class="literal">s1</code>)的第一個分區(<code class="literal">a</code>) 。</td></tr><tr><td xml:lang="en" lang="en"><code class="literal">da1s2e</code></td><td>第二個 SCSI 硬碟 (<code class="literal">da1</code>) 上第二個切割區 (<code class="literal">s2</code>) 的第五個分區 (<code class="literal">e</code>) 。</td></tr></tbody></table></div></div></div><br class="example-break" /><div class="example"><a id="basics-concept-disk-model"></a><div class="example-title">範例 3.13. 磁碟的概念模型</div><div class="example-contents"><p>此圖顯示 FreeBSD 中連接到系統的第一個 <acronym class="acronym">SATA</acronym> 磁碟機內部配置圖。 假設這個磁碟的容量是 250 GB，並且包含了一個 80 GB 的切割區及一個 170 GB 的切割區 (<span class="trademark">MS-DOS</span>® 的分割區)。 第一個切割區是 <span class="trademark">Windows</span>® <acronym class="acronym">NTFS</acronym> 檔案系統的 <code class="filename">C:</code> 磁碟機，第二個則安裝了 FreeBSD。 本範例中安裝的 FreeBSD 有四個資料分區及一個交換分區。</p><p>這四個分區中各有一個檔案系統。 分區 <code class="literal">a</code> 是根檔案系統、分區 <code class="literal">d</code> 是 <code class="filename">/var/</code>、分區 <code class="literal">e</code> 是 <code class="filename">/tmp/</code>，而分區 <code class="literal">f</code> 是 <code class="filename">/usr/</code>。分區字母 <code class="literal">c</code> 用來代表整個切割區，因此並不作為一般分區使用。</p><div class="mediaobject"><img src="basics/disk-layout.png" /></div></div></div><br class="example-break" /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mount-unmount"></a>3.7. 掛載與卸載檔案系統</h2></div></div></div><p>檔案系統就像一顆樹。<code class="filename">/</code> 就像是樹根，而 <code class="filename">/dev</code>，<code class="filename">/usr</code> 以及其他在根目錄下的目錄就像是樹枝，而這些樹枝上面又還有分支，像是 <code class="filename">/usr/local</code> 等。</p><a id="idp65345464" class="indexterm"></a><p>因為某些原因，我們會將一些目錄分別放在不同的檔案系統上。 如 <code class="filename">/var</code> 包含了可能會滿出來的 <code class="filename">log/</code>，<code class="filename">spool/</code> 等目錄以及各式各樣的暫存檔。 把根檔案系統塞到滿出來顯然不是個好主意，所以我們往往會比較傾向把 <code class="filename">/var</code> 從 <code class="filename">/</code> 中拉出來。</p><p>另一個常見到把某些目錄放在不同檔案系統上的理由是： 這些檔案在不同的實體或虛擬磁碟機上。 像是網路檔案系統 (Network File System) 詳情可參考 <a class="xref" href="#network-nfs" title="29.3. 網路檔案系統 (NFS)">節 29.3, “網路檔案系統 (NFS)”</a> 或是光碟機。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks-fstab"></a>3.7.1. <code class="filename">fstab</code> 檔</h3></div></div></div><a id="idp65350456" class="indexterm"></a><p>在 <code class="filename">/etc/fstab</code> 裡面有設定的檔案系統會在開機 (<a class="xref" href="#boot" title="章 12. FreeBSD 開機程序">章 12, <em>FreeBSD 開機程序</em></a>) 的過程中自動地被掛載 (除非該檔案系統有被加上 <code class="option">noauto</code> 參數)。檔案內容的格式如下：</p><pre xml:lang="en" class="programlisting" lang="en"><em class="replaceable"><code>device</code></em>       <em class="replaceable"><code>/mount-point</code></em> <em class="replaceable"><code>fstype</code></em>     <em class="replaceable"><code>options</code></em>      <em class="replaceable"><code>dumpfreq</code></em>     <em class="replaceable"><code>passno</code></em></pre><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en"><code class="literal">device</code></span></dt><dd><p>已存在的裝置名稱，詳情請參閱 <a class="xref" href="#disks-naming" title="表格 3.3. 磁碟裝置名稱">表格 3.3, “磁碟裝置名稱”</a>。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="literal">mount-point</code></span></dt><dd><p>檔案系統要掛載到的目錄 (該目錄必須存在)。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="literal">fstype</code></span></dt><dd><p>檔案系統類型，這是要傳給 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> 的參數。 FreeBSD 預設的檔案系統是 <code class="literal">ufs</code>。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="literal">options</code></span></dt><dd><p>可讀可寫 (Read-Write) 的檔案系統用 <code class="option">rw</code>，而唯讀 (Read-Only) 的檔案系統則是用 <code class="option">ro</code>，後面視需要還可以加其他選項。 常見的選項如 <code class="option">noauto</code> 是用在不要於開機過程中自動的掛載的檔案系統。 其他選項可參閱 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> 說明。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="literal">dumpfreq</code></span></dt><dd><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> 由此項目決定那些檔案系統需要傾印。 如果這格空白則以零為預設值。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="literal">passno</code></span></dt><dd><p>這個項目決定檔案系統檢查的順序。 對於要跳過檢查的檔案系統，它們的 <code class="literal">passno</code> 值要設為零。 根檔案系統的 <code class="literal">passno</code> 值應設為一 (因為需要比所有其他的還要先檢查)，而其他的檔案系統的 <code class="literal">passno</code> 值應該要設得比一大。 若有多個檔案系統具有相同的 <code class="literal">passno</code> 值，則 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a> 會試著平行地 (如果可能的話) 檢查這些檔案系統。</p></dd></dl></div><p>更多關於 <code class="filename">/etc/fstab</code> 檔案格式及選項的資訊請參閱 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a> 說明文件。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks-mount"></a>3.7.2. 使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a></h3></div></div></div><a id="idp65392824" class="indexterm"></a><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> 指令是拿來掛載檔案系統用的。基本的操作指令格式如下：</p><div class="informalexample"><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount <em class="replaceable"><code>device</code></em> <em class="replaceable"><code>mountpoint</code></em></code></strong></pre></div><p>在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> 裡面有提到一大堆的選項，不過最常用的就是這些：</p><div class="variablelist"><div class="variablelist-title">掛載選項</div><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en"><code class="option">-a</code></span></dt><dd><p>把 /etc/fstab 裡面所有還沒有被掛載、沒有被標記成 <code class="filename">/etc/fstab</code> 而且沒有用 <code class="option">-t</code> 排除的檔案系統掛載起來。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="option">-d</code></span></dt><dd><p>執行所有的動作，但是不真的去呼叫掛載的系統呼叫 (System call)。 這個選項和 <code class="option">-v</code> 搭配拿來推測 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> 將要做什麼動作時很好用。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="option">-f</code></span></dt><dd><p>強迫掛載不乾淨的檔案系統 (危險)，或是用來強制取消寫入權限 (把檔案系統的掛載狀態從可存取變成唯讀)。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="option">-r</code></span></dt><dd><p>用唯讀的方式掛載檔案系統。 這個選項和在 -o 選項中指定 ro 參數是一樣的。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="option">-t</code>
	    <em class="replaceable"><code>fstype</code></em></span></dt><dd><p>用指定的檔案系統型態來掛載指定的檔案系統，或是在有 <code class="option">-a</code> 選項時只掛載指定型態的檔案系統。預設的檔案系統類型為 <span class="quote">“<span class="quote">ufs</span>”</span>。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="option">-u</code></span></dt><dd><p>更新檔案系統的掛載選項。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="option">-v</code></span></dt><dd><p>顯示詳細資訊。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="option">-w</code></span></dt><dd><p>以可讀寫的模式掛載檔案系統。</p></dd></dl></div><p><code class="option">-o</code> 選項後面會接著以逗號分隔的參數：</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en">nosuid</span></dt><dd><p>不解析檔案系統上的 setuid 或 setgid 旗標， 這也是一個蠻有用的安全選項。</p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks-umount"></a>3.7.3. 使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=umount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">umount</span>(8)</span></a></h3></div></div></div><a id="idp65158584" class="indexterm"></a><p>要卸載檔案系統可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=umount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">umount</span>(8)</span></a> 指令。該指令需要一個參數可以是掛載點 (mountpoint)，裝置名稱，以及 <code class="option">-a</code> 或是 <code class="option">-A</code> 等選項。</p><p>加上 <code class="option">-f</code> 可以強制卸載，加上 <code class="option">-v</code> 則是會顯示詳細資訊。 要注意的是一般來說用 <code class="option">-f</code> 並不是個好主意，強制卸載檔案系統有可能會造成電腦當機， 或者損壞檔案系統內的資料。</p><p><code class="option">-a</code> 和 <code class="option">-A</code> 是用來卸載所有已掛載的檔案系統，另外還可以用 <code class="option">-t</code> 來指定要卸載的是哪些種類的檔案系統。 要注意的是 <code class="option">-A</code> 並不會試圖卸載根檔案系統。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="basics-processes"></a>3.8. 程序與 Daemon</h2></div></div></div><p>FreeBSD 是一個多工的作業系統，也就是說在同一時間內可以跑超過一個程式。 每一個正在花時間跑的程式就叫做<em class="firstterm">程序 (Process)</em>。 您下的每個指令都至少會開啟一個新的程序， 而有些系統程序是一直在跑以維持系統正常運作的。</p><p>每一個程序都有一個獨一無二的數字叫做 <em class="firstterm">程序代號 (Process ID, <acronym class="acronym">PID</acronym>)</em>，而且就像檔案一樣，每一個程序也有擁有者及群組。 擁有者及群組的資訊是用來決定什麼檔案或裝置是這個程序可以開啟的 (前面有提到過檔案權限)。 大部份的程序都有父程序。 父程序是開啟這個程序的程序，例如：您對 Shell 輸入指令，Shell 本身就是一個程序，而您執行的指令也是程序。 每一個您用這種方式跑的程序的父程序都是 Shell。 有一個特別的程序叫做 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a> 是個例外，在 FreeBSD 開機的時候 init 會自動地被開啟，init 永遠是第一個程序，所以他的 <acronym class="acronym">PID</acronym> 一直都會是 <code class="literal">1</code>。</p><p>有些程式並不是設計成一直在接收使用者的輸入的， 而是在開始執行的時候就從中斷與終端機的連線。 例如說， 網頁伺服器整天都在回應網頁方面的要求，它通常不需要您輸入任何東西。 另外，像是把信從一個站傳送到另一個站的程式，也是這種類型的應用程式。我們把這種程式稱作 <em class="firstterm">Daemon</em>。 Daemon 一詞是來自是希臘神話中的角色：祂們既不屬於善良陣營或邪惡陣營，祂們在背地裡做一些有用的事情。這也就是為何 BSD 的吉祥物，是一隻穿著帆布鞋拿著三叉耙的快樂小惡魔的原因。</p><p>通常來說做為 Deamon 執行的程式名字後面都會加一個字母 <span class="quote">“<span class="quote">d</span>”</span>。 <span class="application">BIND</span> 是 Berkeley Internet Name Domain 的縮寫，但實際上執行的程式名稱是 <code class="command">named</code>、<span class="application">Apache</span> 網頁伺服器的程式名稱是 <code class="command">httpd</code>、行列式印表機緩衝服務 (Line Printer Spooling) Daemon 是 <code class="command">lpd</code>，依此類推。 但這是習慣用法，並沒有硬性規定，例如 <span class="application">Sendmail</span> 主要的寄信 Daemon 是叫做 <code class="command">sendmail</code> 而不是 <code class="literal">maild</code>。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65473336"></a>3.8.1. 檢視程序</h3></div></div></div><p>要看系統執行中的程序，有兩個相當有用的指令可用： <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> 以及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a>。<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> 指令是用來列出正在執行之程序，而且可以顯示它們的 <acronym class="acronym">PID</acronym>、用了多少記憶體、執行的指令名稱及其後之參數是什麼等等。 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a> 指令則是顯示所有正在執行的程序， 並且數秒鐘更新一次。因此您可以互動式的觀看您的電腦正在做什麼。</p><p>在預設的情況下，<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> 指令只會顯示使用者所擁有的的程序。 例如：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>ps</code></strong>
 PID TT  STAT    TIME COMMAND
8203  0  Ss   0:00.59 /bin/csh
8895  0  R+   0:00.00 ps</pre><p>在這個範例裡可以看到 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> 的輸出分成好幾個欄位。 <code class="literal">PID</code> 就是前面有提到的程序代號。 <code class="literal">PID</code> 的分配是從 1 開始一直到 99999，如果用完的話又會繞回來重頭開始分配 (若該 <acronym class="acronym">PID</acronym> 已經在用了，則 PID 不會重新分配)。 <code class="literal">TT</code> 欄位是指這個程式在哪個 Console (tty) 上執行，在這裡可以先忽略不管。<code class="literal">STAT</code> 是程式的狀態，也可以先不要管。<code class="literal">TIME</code> 是這個程式在 CPU 上執行的時間—這通常不是程式總共花的時間， 因為當您開始執行程式後，大部份的程式在 CPU 上執行前會先花上不少時間等待 。 最後，<code class="literal">COMMAND</code> 是執行這個程式的指令。</p><p>有幾個不同的選項組合可以用來變更顯示出來的資訊，其中一個最有用的組合是 <code class="literal">auxww</code>。 <code class="option">a</code> 可以顯示所有正在跑的程序的指令，不只是您自已的。 <code class="option">u</code> 則是顯示程序的擁有者名稱以及記憶體使用情況。 <code class="option">x</code> 可以把 daemon 程序顯示出來， 而 <code class="option">ww</code> 可讓 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> 顯示出每個程序完整的內容， 而不致因過長而被螢幕截掉了。</p><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a> 也有類似的輸出。 一般的情況看像是這樣：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>top</code></strong>
last pid:  9609;  load averages:  0.56,  0.45,  0.36              up 0+00:20:03  10:21:46
107 processes: 2 running, 104 sleeping, 1 zombie
CPU:  6.2% user,  0.1% nice,  8.2% system,  0.4% interrupt, 85.1% idle
Mem: 541M Active, 450M Inact, 1333M Wired, 4064K Cache, 1498M Free
ARC: 992M Total, 377M MFU, 589M MRU, 250K Anon, 5280K Header, 21M Other
Swap: 2048M Total, 2048M Free

  PID USERNAME    THR PRI NICE   SIZE    RES STATE   C   TIME   WCPU COMMAND
  557 root          1 -21  r31   136M 42296K select  0   2:20  9.96% Xorg
 8198 dru           2  52    0   449M 82736K select  3   0:08  5.96% kdeinit4
 8311 dru          27  30    0  1150M   187M uwait   1   1:37  0.98% firefox
  431 root          1  20    0 14268K  1728K select  0   0:06  0.98% moused
 9551 dru           1  21    0 16600K  2660K CPU3    3   0:01  0.98% top
 2357 dru           4  37    0   718M   141M select  0   0:21  0.00% kdeinit4
 8705 dru           4  35    0   480M    98M select  2   0:20  0.00% kdeinit4
 8076 dru           6  20    0   552M   113M uwait   0   0:12  0.00% soffice.bin
 2623 root          1  30   10 12088K  1636K select  3   0:09  0.00% powerd
 2338 dru           1  20    0   440M 84532K select  1   0:06  0.00% kwin
 1427 dru           5  22    0   605M 86412K select  1   0:05  0.00% kdeinit4</pre><p>輸出的資訊分成兩個部份。開頭 (前五行或六行) 顯示出最近一個程序的 <acronym class="acronym">PID</acronym>、系統平均負載 (系統忙磁程度評估方式)、系統的開機時間 (自上次重新開機) 以及現在的時間等。 在開頭裡面的其他數字分別是在講有多少程序正在執行、有多少記憶體及交換空間被占用了，還有就是系統分別花了多少時間在不同的 CPU 狀態上。若有載入 <acronym class="acronym">ZFS</acronym> 檔案系統模組，會有一行 <code class="literal">ARC</code> 標示有多少資料從磁碟改由記憶體快取中取得。</p><p>接下來的部份是由好幾個欄位所構成，和 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> 輸出的資訊類似。 就如同前例，您可以看到 <acronym class="acronym">PID</acronym>、使用者名稱、CPU 花費的時間以及正在執行的指令。 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a> 在預設的情況下還會告訴您程序用掉了多少的記憶體空間。 在這邊會分成兩欄，一個是總用量 (Total size)，另一個是實際用量 (Resident size)——總用量是指這個應用程式需要的記憶體空間，而實際用量則是指目前實際上該程式的記憶體使用量。</p><p>top(1) 每隔 2 秒鐘會自動更新顯示內容，可用 <code class="option">-s</code> 選項來改變間隔的時間。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="basics-daemons"></a>3.8.2. 終止程序</h3></div></div></div><p>要與執行中的程序或 Daemon 溝通唯一的方法是透過 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> 指令傳送<em class="firstterm">信號 (Signal)</em>。 信號有很多種，有些有特定的意義，有些則是會由應用程式來解讀，應用程式的說明文件會告訴您該程式是如何解讀信號。 使用者只能送信號給自己所擁有的程序，送信號給其他人的程序會出現權限不足的錯誤。 唯一的例外是 <code class="systemitem">root</code>使用者，他可以送信號給任何人的程序。</p><p>作業系統在某些情況也會送信號給應用程式。 假設有個應用程式寫得不好，企圖要存取它不該碰的記憶體的時候，FreeBSD 會送一個 <span class="quote">“<span class="quote">Segmentation Violation</span>”</span> 信號 (<code class="literal">SIGSEGV</code>) 給這個程序。 如果有一個應用程式用了 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=alarm&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">alarm</span>(3)</span></a> 的系統呼叫 (System call) 要求系統在過一段時間之後發出通知，時間到了的時候系統就會發出<span class="quote">“<span class="quote">通知</span>”</span>信號 (<code class="literal">SIGALRM</code>) 給該程式。</p><p><code class="literal">SIGTERM</code> 與 <code class="literal">SIGKILL</code> 這兩個信號可以拿來終止程序。 用 <code class="literal">SIGTERM</code> 結束程序是比較有禮貌的方式，該程序收到信號後可以把自已所使用的日誌檔關閉及其他要在結束前要做的事完成， 然後在關掉程序之前結束掉手邊的工作。 在某些情況下程序有可能會忽略 <code class="literal">SIGTERM</code>，如它正在做一些不能中斷的工作的話。</p><p><code class="literal">SIGKILL</code> 就沒有辦法被程序忽略。 傳送 <code class="literal">SIGKILL</code> 信號給程序通常會將程序直接中止<a href="#ftn.idp65539512" class="footnote" id="idp65539512"><sup class="footnote">[1]</sup></a>。</p><p>其他常用的信號有：<code class="literal">SIGHUP</code>, <code class="literal">SIGUSR1</code> 及 <code class="literal">SIGUSR2</code>。 這些是通用的信號，對不同的應用程式會有不同的反應。</p><p>舉例來說，當您更動了網頁伺服器的設定檔，您想要叫網頁伺服器去重新讀取設定。 重新啟動 <code class="command">httpd</code> 會造成網頁伺服器暫停服務一段時間，我們可以傳送 <code class="literal">SIGHUP</code> 信號來取代關掉重開。 不同的 Daemon 會有不同的行為，所以使用前請先參考 Deamon 的說明文件查看是否可以達到想要的結果。</p><div class="procedure"><a id="idp65559736"></a><div class="procedure-title">過程 3.1. 送信號給程序</div><p>這個範例將會示範如何送一個信號給 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a>。<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> 的設定檔是 <code class="filename">/etc/inetd.conf</code>，而 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> 會在收到 <code class="literal">SIGHUP</code> 的時候重新讀取這個設定檔。</p><ol class="procedure" type="1"><li class="step"><p>使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pgrep&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pgrep</span>(1)</span></a> 來查詢要傳送信號的目標程序。 在這個例子中 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> 的 <acronym class="acronym">PID</acronym> 為 198：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>pgrep -l inetd</code></strong>
198  inetd -wW</pre></li><li class="step"><p>使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> 來發送信號。因為 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> 是 <code class="systemitem">root</code> 所有，因此必須先用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> 切換成 <code class="systemitem">root</code> 先。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>su</code></strong>
<code class="prompt">Password:</code>
<code class="prompt">#</code> <strong class="userinput"><code>/bin/kill -s HUP 198</code></strong></pre><p>對大多數 <span class="trademark">UNIX</span>® 指令來講，<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> 執行成功時並不會輸出任何訊息。 假設您送一個信號給某個不是使用者所擁有的程序， 那麼就會顯示這個錯誤訊息： <span class="errorname">kill: <em class="replaceable"><code>PID</code></em>: Operation not permitted</span>。 若打錯 <acronym class="acronym">PID</acronym> 的話，那就會把信號送給錯誤的程序，並把該程序關閉，或者是把信號送給一個非使用中的 <acronym class="acronym">PID</acronym>，那您就會看到錯誤：<span class="errorname">kill: <em class="replaceable"><code>PID</code></em>: No such process</span>。</p><div xmlns="" class="note"><h3 class="admontitle">為何要使用 <code xmlns="http://www.w3.org/1999/xhtml" class="command">/bin/kill</code>？: </h3><p xmlns="http://www.w3.org/1999/xhtml">多數 Shell 都有提供內建的 <code class="command">kill</code> 指令。 也就是說這種 shell 會直接發送信號，而不是執行 <code class="filename">/bin/kill</code>。 但要小心不同的 shell 會有不同的語法來指定信號的名稱等。 與其嘗試去把它們通通學會，不如就單純的直接用 <code class="command">/bin/kill</code>。</p></div></li></ol></div><p>要送其他的信號的話也是非常類似，就視需要把指令中的 <code class="literal">TERM</code> 或 <code class="literal">KILL</code> 替換成其他信號的名稱即可。</p><div xmlns="" class="important"><h3 class="admontitle">重要: </h3><p xmlns="http://www.w3.org/1999/xhtml">隨便抓一個系統中的程序然後把他砍掉並不是個好主意。 特別是 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a>， <acronym class="acronym">PID</acronym> 1 是一個非常特別的程序。 執行 <code class="command">/bin/kill -s KILL 1</code> 的結果就是系統立刻關機。 因此在您按下 <span class="keycap"><strong>Return</strong></span> 要執行 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> 之前， 請<span class="emphasis"><em>一定要</em></span>記得再次確認您下的參數。</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="shells"></a>3.9. Shell</h2></div></div></div><a id="idp65591096" class="indexterm"></a><a id="idp65591992" class="indexterm"></a><p><em class="firstterm">Shell</em> 提供了指令列介面可用來與作業系統互動，Shell 負責從輸入的頻道接收指令並執行它們。 多數 Shell 也內建一些有助於日常工作的功能，像是檔案管理、檔案搜尋、指令列編輯、指令巨集以及環境變數等。 FreeBSD 有內附了幾個 Shell，包含 Bourne Shell (<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a>)，與改良版的 C-shell (<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tcsh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tcsh</span>(1)</span></a>)。 還有許多其他的 Shell 可以從 FreeBSD Port 套件集中取得，像是 <code class="command">zsh</code> 以及 <code class="command">bash</code> 等。</p><p>要用哪個 Shell 牽涉到每個人的喜好。 如果您是一個 C 程式設計師，那對於使用像是 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tcsh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tcsh</span>(1)</span></a> 這種 C-like 的 shell 可能會感到較容易上手。 如果是 <span class="trademark">Linux</span>® 的使用者，那您也許會想要用 <code class="command">bash</code>。 每一個 Shell 都有自已獨特之處，至於這些特點能不能符合使用者的喜好，就是您選擇 shell 的重點了。</p><p>常見的 Shell 功能之一就是檔名自動補齊。 首先輸入指令或檔案的前幾個字母，然後按下 <span class="keycap"><strong>Tab</strong></span> 鍵，Shell 就會自動把指令或是檔案名稱剩餘的部份補齊。 假設您有兩個檔案分別叫作 <code class="filename">foobar</code> 及 <code class="filename">football</code>。 要刪掉 <code class="filename">foobar</code>，那麼可以輸入 <code class="command">rm foo</code> 然後按下 <span class="keycap"><strong>Tab</strong></span> 來補齊檔名。</p><p>但 Shell 只顯示了 <code class="command">rm foo</code>，這代表它沒有辦法完全自動補齊檔名，因為有不只一個檔名符合條件。 <code class="filename">foobar</code> 和 <code class="filename">football</code> 都是 <code class="literal">foo</code> 開頭的檔名。 有一些 Shell 會有嗶的音效或者顯示所有符符條件的檔名。 使用者只需要多打幾個字元來分辦想要的檔名。 輸入 <code class="literal">t</code> 然後再按 <span class="keycap"><strong>Tab</strong></span> 一次，那 Shell 就能夠替您把剩下的檔名填滿了。</p><a id="idp65623864" class="indexterm"></a><p>Shell 的另一項特點是使用了環境變數。 環境變數是以變數與鍵值 (Variable/Key) 的對應關係儲存於 Shell 的環境，任何由該 Shell 所產生的程序都可以讀取此環境變數， 因此環境變數儲存了許多程序的設定。 <a class="xref" href="#shell-env-vars" title="表格 3.4. 常用環境變數">表格 3.4, “常用環境變數”</a> 提供了常見的環境變數與其涵義的清單。 請注意環境變數的名稱永遠以大寫表示。</p><div class="table"><a id="shell-env-vars"></a><div class="table-title">表格 3.4. 常用環境變數</div><div class="table-contents"><table summary="常用環境變數" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>變數</th><th>說明</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><code class="envar">USER</code></td><td>目前登入的使用者名稱。</td></tr><tr><td xml:lang="en" lang="en"><code class="envar">PATH</code></td><td>以冒號 (:) 隔開的目錄列表，用以搜尋執行檔的路徑。</td></tr><tr><td xml:lang="en" lang="en"><code class="envar">DISPLAY</code></td><td>若存在這個環境變數，則代表 <span class="application">Xorg</span> 顯示器的網路名稱。</td></tr><tr><td xml:lang="en" lang="en"><code class="envar">SHELL</code></td><td>目前使用的 Shell。</td></tr><tr><td xml:lang="en" lang="en"><code class="envar">TERM</code></td><td>使用者終端機類型的名稱，用來判斷終端機有那些功能。</td></tr><tr><td xml:lang="en" lang="en"><code class="envar">TERMCAP</code></td><td>用來執行各種終端機功能的終端機跳脫碼 (Terminal escape code) 的資料庫項目。</td></tr><tr><td xml:lang="en" lang="en"><code class="envar">OSTYPE</code></td><td>作業系統的類型。</td></tr><tr><td xml:lang="en" lang="en"><code class="envar">MACHTYPE</code></td><td>系統的 CPU 架構。</td></tr><tr><td xml:lang="en" lang="en"><code class="envar">EDITOR</code></td><td>使用者偏好的文字編輯器。</td></tr><tr><td xml:lang="en" lang="en"><code class="envar">PAGER</code></td><td>使用者偏好的文字分頁檢視工具。</td></tr><tr><td xml:lang="en" lang="en"><code class="envar">MANPATH</code></td><td>以冒號 (:) 隔開的目錄列表，用以搜尋使用手冊的路徑。</td></tr></tbody></table></div></div><br class="table-break" /><a id="idp65649080" class="indexterm"></a><p>在不同的 Shell 底下設定環境變數的方式也有所不同。 在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tcsh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tcsh</span>(1)</span></a> 和 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=csh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">csh</span>(1)</span></a>，使用 <code class="command">setenv</code> 來設定環境變數。 在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> 和 <code class="command">bash</code> 則使用 <code class="command">export</code> 來設定目前環境的變數。 以下範例將 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tcsh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tcsh</span>(1)</span></a> Shell 下的 <code class="envar">EDITOR</code> 環境變數從預設值更改為 <code class="filename">/usr/local/bin/emacs</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>setenv EDITOR /usr/local/bin/emacs</code></strong></pre><p>相同功能的指令在 <code class="command">bash</code> 下則是：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>export EDITOR="/usr/local/bin/emacs"</code></strong></pre><p>要展開以顯示目前環境變數中的值，只要在指令列輸入環境變數之前加上 <code class="literal">$</code> 字元。 舉例來說，<code class="command">echo $TERM</code> 會顯示出目前 <code class="envar">$TERM</code> 的設定值。</p><p>Shell 中有特殊字元用來表示特殊資料，我們將其稱作 Meta-character。 其中最常見的 Meta-character 是 <code class="literal">*</code> 字元，它代表了檔名中的任意字元。 Meta-character 可以用在搜尋檔名，舉例來說，輸入 <code class="command">echo *</code> 會和輸入 <code class="command">ls</code> 得到幾乎相同的結果，這是因為 shell 會將所有符合 <code class="literal">*</code> 字元的檔案由 <code class="command">echo</code> 顯示出來。</p><p>為了避免 Shell 轉譯這些特殊字元，我們可以在這些特殊字元前放一個反斜線 (<code class="literal">\</code>) 字元使他們跳脫 (Escape) Shell 的轉譯。舉例來說，<code class="command">echo $TERM</code> 會印出你目前終端機的設定， <code class="command">echo \$TERM</code> 則會直接印出 <code class="literal">$TERM</code> 這幾個字。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="changing-shells"></a>3.9.1. 變更 Shell</h3></div></div></div><p>永久變更 Shell 最簡單的方法就是透過 <code class="command">chsh</code> 指令。 執行 <code class="command">chsh</code> 將會使用環境變數中 <code class="envar">EDITOR</code> 指定的文字編輯器，如果沒有設定，則預設是 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vi&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vi</span>(1)</span></a>。 請修改 <code class="literal">Shell:</code> 為新的 Shell 的完整路徑。</p><p>或者，使用 <code class="command">chsh -s</code>， 來直接設定 Shell 而不開啟文字編輯器。 例如， 假設想把 Shell 更改為 <code class="command">bash</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>chsh -s /usr/local/bin/bash</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">新的 Shell <span class="emphasis"><em>必須</em></span>已列於 <code class="filename">/etc/shells</code> 裡頭。 若是依 <a class="xref" href="#ports" title="章 4. 安裝應用程式：套件與 Port">章 4, <em>安裝應用程式：套件與 Port</em></a> 說明由 Port 套件集來裝的 Shell， 那就會自動列入至該檔案裡。 若仍缺少，請使用以下指令加入檔案 (請將路徑替換為新的 Shell 的路徑)：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>echo <em class="replaceable"><code>/usr/local/bin/bash</code></em> &gt;&gt; /etc/shells</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">然後重新執行 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chsh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chsh</span>(1)</span></a>。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65690680"></a>3.9.2. 進階 Shell 技巧</h3></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p><span class="trademark">UNIX</span>® Shell 不只是指令的直譯器，它是一個強大的工具可讓使用者執行指令、重新導向指令的輸出、重新導向指令的輸入並將指令串連在一起來改進最終指令的輸出結果。當這個功能與內建的指令混合使用時，可提供一個可以最佳化效率的環境給使用者。</p><p>Shell 重新導向是將一個指令的輸出或輸入傳送給另一個指令或檔案。例如，要擷取 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a> 指令的輸出到一個檔案，可以重新導向輸出：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>ls &gt; directory_listing.txt</code></strong></pre><p>目錄的內容現在會列到 <code class="filename">directory_listing.txt</code> 中，部份指令可以讀取輸入，例如 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sort&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sort</span>(1)</span></a>。要排序這個清單，可重新導向輸入：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>sort &lt; directory_listing.txt</code></strong></pre><p>輸入的內容會被排序後呈現在畫面上，要重新導向該輸入到另一個檔案，可以重新導向 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sort&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sort</span>(1)</span></a> 的出輸：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>sort &lt; directory_listing.txt &gt; sorted.txt</code></strong></pre><p>於上述所有的範例中，指令會透過檔案描述符 (File descriptor) 來執行重新導向。每個 <span class="trademark">UNIX</span>® 系統都有檔案描述符，其中包含了標準輸入 (stdin)、標準輸出 (stdout) 以及標準錯誤 (stderr)。每一種檔案描述符都有特定的用途，輸入可能來自鍵盤或滑鼠、任何可能提供輸入的來源，輸出則可能是螢幕或印表機中的紙張，而錯誤則為任何可能用來診斷的資訊或錯誤訊息。這三種皆被認為是以 I/O 為基礎的檔案描述符，有些也會被當做串流。</p><p>透過使用這些檔案描述符，Shell 能夠讓輸出與輸入在各種指令間傳遞與重新導向到或自檔案。另一種重新導向的方式是使用管線運算子 (Pipe operator)。</p><p><span class="trademark">UNIX</span>® 的管線運算子，即 <span class="quote">“<span class="quote">|</span>”</span>，可允許指令的輸出可直接傳遞或導向到另一個程式。基本上，管線運算子允許指令的標準輸出以標準輸入傳遞給另一個指令，例如：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>cat directory_listing.txt | sort | less</code></strong></pre><p>在這個例子中，<code class="filename">directory_listing.txt</code> 的內容會被排序然後輸出傳遞給 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=less&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">less</span>(1)</span></a>，這可讓使用者依自己的閱讀步調捲動輸出的結果，避免結果直接捲動出畫面。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="editors"></a>3.10. 文字編輯器</h2></div></div></div><a id="idp65708088" class="indexterm"></a><a id="idp65708984" class="indexterm"></a><p>在 FreeBSD 中有許多設定必須透過編輯文字檔完成。 因此，若能熟悉文字編輯器是再好不過的。 FreeBSD 本身就內建幾種文字編輯器， 您也可以透過 Port 套件集來安裝其他的文字編輯器。</p><a id="idp65714360" class="indexterm"></a><a id="idp65715384" class="indexterm"></a><p>最簡單易學的文字編輯器叫做 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ee&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ee</span>(1)</span></a>，意為簡易的編輯器 (Easy Editor)。 要開始使用這個編輯器， 只需輸入 <code class="command">ee <em class="replaceable"><code>filename</code></em></code>，其中 <em class="replaceable"><code>filename</code></em> 代表你想要編輯的檔案名稱。 在編輯器中， 所有編輯器的功能與操作都顯示在螢幕的上方。 其中的插入符號 (<code class="literal">^</code>) 代表鍵盤上的 <span class="keycap"><strong>Ctrl</strong></span> 鍵，所以 <code class="literal">^e</code> 代表的是  <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>e</strong></span>。 若要結束 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ee&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ee</span>(1)</span></a>，請按下 <span class="keycap"><strong>Esc</strong></span> 鍵，接著選擇 <span class="quote">“<span class="quote">leave editor</span>”</span> 即可。 此時如果該檔案有修改過，編輯器會提醒你是否要存檔。</p><a id="idp65723320" class="indexterm"></a><a id="idp65724344" class="indexterm"></a><a id="idp65725240" class="indexterm"></a><p>FreeBSD 同時也內建功能強大的文字編輯器，像是<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vi&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vi</span>(1)</span></a>。 其他編輯器如 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/editors/emacs/pkg-descr">editors/emacs</a> 及 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/editors/vim/pkg-descr">editors/vim</a> 則由 FreeBSD Port 套件集提供。 這些編輯器提供更強的功能，但是也比較難學習。 長期來看學習 <span class="application">vim</span> 或 <span class="application">Emacs</span> 會在日後為您省下更多的時間。</p><p>有許多應用程式在修改檔案或需要輸入時會自動開啟文字編輯器，要更改預設的編輯器可設定 <code class="envar">EDITOR</code> 環境變數如 <a class="xref" href="#shells" title="3.9. Shell">節 3.9, “Shell”</a> 所說明。</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="basics-devices"></a>3.11. 裝置及裝置節點</h2></div></div></div><p>裝置 (Device) 一詞大多是跟硬體比較有關的術語，包括磁碟、印表機、顯示卡和鍵盤。 FreeBSD 開機過程當中，開機訊息 (Boot Message) 中主要是會列出偵測到的硬體裝置，開機訊息的複本也會存放在 <code class="filename">/var/run/dmesg.boot</code>。</p><p>每一個裝置都有一個裝置名稱及編號，舉例來說 <code class="filename">ada0</code> 是第一台 SATA 硬碟，而 <code class="filename">kbd0</code> 則代表鍵盤。</p><p>在 FreeBSD 中大多數的裝置必須透過裝置節點 (Device Node) 的特殊檔案來存取，這些檔案會放置在 <code class="filename">/dev</code>。</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="basics-more-information"></a>3.12. 操作手冊</h2></div></div></div><a id="idp65747256" class="indexterm"></a><p>在 FreeBSD 中，最詳細的文件莫過於操作手冊。 幾乎在系統上所有程式都會有簡短的操作手冊來介紹該程式的基本操作以及可用的參數。 這些操作手冊可以使用 <code class="command">man</code> 指令來檢視：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>man <em class="replaceable"><code>command</code></em></code></strong></pre><p>其中 <em class="replaceable"><code>command</code></em> 想要瞭解指令的名稱。 舉例，要知道 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a> 的詳細用法，就可以打：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>man ls</code></strong></pre><p>操作手冊被分成很多個章節，每個章節有不同的主題。 在 FreeBSD 中操作手冊有以下章節：</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>使用者指令。</p></li><li class="listitem"><p>系統呼叫 (System call) 與錯誤編號。</p></li><li class="listitem"><p>C 程式庫函數。</p></li><li class="listitem"><p>裝置驅動程式。</p></li><li class="listitem"><p>檔案格式。</p></li><li class="listitem"><p>遊戲及其他程式。</p></li><li class="listitem"><p>其他資訊。</p></li><li class="listitem"><p>系統維護與操作指令。</p></li><li class="listitem"><p>系統核心介面。</p></li></ol></div><p>有些情況會有同樣主題會同時出現在不同章節。 舉個例子，系統內會有 <code class="command">chmod</code> 使用者指令，但同時也有 <code class="function">chmod()</code> 系統呼叫。 在這種情況，要告訴 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=man&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">man</span>(1)</span></a> 要查詢的章節編號：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>man 1 chmod</code></strong></pre><p>如此一來就會查詢使用者指令 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chmod&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chmod</span>(1)</span></a>。 通常在寫文件時會把有參考到特定章節的號碼寫在括號內。 所以 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chmod&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chmod</span>(1)</span></a> 就是指使用者指令，而 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chmod&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chmod</span>(2)</span></a> 則是指系統呼叫。</p><p>若不曉得操作手冊的名稱，可以使用 <code class="command">man -k</code> 來以關鍵字查詢所有操作手冊的描述：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>man -k <em class="replaceable"><code>mail</code></em></code></strong></pre><p>這個指令會顯示所有描述中有使用到關鍵字 <span class="quote">“<span class="quote">mail</span>”</span> 的指令。 這等同使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=apropos&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">apropos</span>(1)</span></a>。</p><p>想要閱讀所有在 <code class="filename">/usr/bin</code> 底下的指令說明則可輸入：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>cd /usr/bin</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>man -f * | more</code></strong></pre><p>或</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>cd /usr/bin</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>whatis * |more</code></strong></pre><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="basics-info"></a>3.12.1. GNU Info 檔</h3></div></div></div><a id="idp65791672" class="indexterm"></a><p>FreeBSD 有許多應用程式與工具來自自由軟體基金會 (Free Software Foundation, FSF)。 除了操作手冊之外，這些程式提供了另外一種更具有彈性的超文字文件叫做 <code class="literal">info</code> 檔。 這些檔案可以使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=info&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">info</span>(1)</span></a> 指令來閱讀，或者若有裝 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/editors/emacs/pkg-descr">editors/emacs</a> 亦可透過 <span class="application">emacs</span> 的 info 模式閱讀。</p><p>要使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=info&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">info</span>(1)</span></a> 指令，只需輸入：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>info</code></strong></pre><p>要查詢簡單說明請按 <code class="literal">h</code> 鍵，若要查訊快速指令參考請按 <code class="literal">?</code> 鍵。</p></div></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp65539512" class="footnote"><p><a href="#idp65539512" class="para"><sup class="para">[1] </sup></a>還是有少數東西不能被中斷。 例如有個程序正在從網路上的別的電腦讀一個檔案， 而那部電腦因為某些理由連不到，那這個程序就是一個 <span class="quote">“<span class="quote">不能中斷的</span>”</span> 程序。 通常在經過 2 分鐘左右之後這個程序會逾時。 當發生逾時的時候這個程序就會被結束掉了。</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ports"></a>章 4. 安裝應用程式：套件與 Port</h2></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#ports-synopsis">4.1. 概述</a></span></dt><dt><span class="sect1"><a href="#ports-overview">4.2. 安裝軟體的概要</a></span></dt><dt><span class="sect1"><a href="#ports-finding-applications">4.3. 搜尋軟體</a></span></dt><dt><span class="sect1"><a href="#pkgng-intro">4.4. 使用 <span class="application">pkg</span> 管理 Binary 套件</a></span></dt><dd><dl><dt><span class="sect2"><a href="#pkgng-initial-setup">4.4.1. 開始使用 <span class="application">pkg</span></a></span></dt><dt><span class="sect2"><a href="#pkgng-pkg-info">4.4.2. 取得有關已安裝套件的資訊</a></span></dt><dt><span class="sect2"><a href="#pkgng-installing-deinstalling">4.4.3. 安裝與移除套件</a></span></dt><dt><span class="sect2"><a href="#pkgng-upgrading">4.4.4. 升級已安裝套件</a></span></dt><dt><span class="sect2"><a href="#pkgng-auditing">4.4.5. 稽查已安裝套件</a></span></dt><dt><span class="sect2"><a href="#pkgng-autoremove">4.4.6. 自動移除未使用的套件</a></span></dt><dt><span class="sect2"><a href="#pkgng-backup">4.4.7. 還原套件資料庫</a></span></dt><dt><span class="sect2"><a href="#pkgng-clean">4.4.8. 移除過時的套件</a></span></dt><dt><span class="sect2"><a href="#pkgng-set">4.4.9. 修改套件 Metadata</a></span></dt></dl></dd><dt><span class="sect1"><a href="#ports-using">4.5. 使用 Port 套件集</a></span></dt><dd><dl><dt><span class="sect2"><a href="#ports-skeleton">4.5.1. 安裝 Port</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp66154680">4.5.1.1. 自訂 Port 安裝</a></span></dt></dl></dd><dt><span class="sect2"><a href="#ports-removing">4.5.2. 移除已安裝的 Port</a></span></dt><dt><span class="sect2"><a href="#ports-upgrading">4.5.3. 升級 Port</a></span></dt><dd><dl><dt><span class="sect3"><a href="#ports-upgrading-tools">4.5.3.1. 升級與管理 Port 的工具</a></span></dt><dt><span class="sect3"><a href="#portmaster">4.5.3.2. 使用 <span class="application">Portmaster</span> 升級 Port</a></span></dt><dt><span class="sect3"><a href="#portupgrade">4.5.3.3. 使用 Portupgrade 升級 Port</a></span></dt></dl></dd><dt><span class="sect2"><a href="#ports-disk-space">4.5.4. Port 與磁碟空間</a></span></dt></dl></dd><dt><span class="sect1"><a href="#ports-poudriere">4.6. 使用 <span class="application">Poudriere</span> 編譯套件</a></span></dt><dd><dl><dt><span class="sect2"><a href="#poudriere-initialization">4.6.1. 初始化 Jail 與 Port 樹</a></span></dt><dt><span class="sect2"><a href="#idp66422200">4.6.2. 設定 pkg 客戶端使用 Poudriere 檔案庫</a></span></dt></dl></dd><dt><span class="sect1"><a href="#ports-nextsteps">4.7. 安裝後的注意事項</a></span></dt><dt><span class="sect1"><a href="#ports-broken">4.8. 處理損壞的 Port</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ports-synopsis"></a>4.1. 概述</h2></div></div></div><a id="idp65833272" class="indexterm"></a><a id="idp65833912" class="indexterm"></a><p>FreeBSD 內建豐富的系統工具集，此外 FreeBSD 提供了兩種安裝第三方軟體的套件管理技術︰由原始碼安裝的 FreeBSD Port 套件集，以及由預先編譯好的 Binary 安裝的 Binary  套件集。兩種方法都可使用本地的媒體或網路來安裝軟體。</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Binary 套件集與 Port 的差別。</p></li><li class="listitem"><p>如何找到已移植到 FreeBSD 的第三方軟體。</p></li><li class="listitem"><p>如何使用 <span class="application">pkg</span> 管理 Binary 套件。</p></li><li class="listitem"><p>如何編譯來自 Port 套件集的第三方軟體原始碼。</p></li><li class="listitem"><p>如何找到應用程式已安裝的檔案來完成安裝後的設定。</p></li><li class="listitem"><p>若軟體安裝失敗要如何處理。</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ports-overview"></a>4.2. 安裝軟體的概要</h2></div></div></div><p>通常要在 <span class="trademark">UNIX</span>® 系統上安裝第三方軟體時，有幾個步驟要作：</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>找到並且下載軟體，該軟體有可能以原始碼或 Binary 格式發佈。</p></li><li class="step"><p>自發佈的格式解壓縮軟體。 發佈的格式通常為 tarball 並以程式壓縮，如 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=compress&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">compress</span>(1)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gzip&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gzip</span>(1)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bzip2&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bzip2</span>(1)</span></a> 或 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xz&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xz</span>(1)</span></a>。</p></li><li class="step"><p>找到位於 <code class="filename">INSTALL</code>, <code class="filename">README</code> 或者 <code class="filename">doc/</code> 子目錄底下的檔案閱讀如何安裝該軟體。</p></li><li class="step"><p>若軟體是以原始碼的格式發佈則需要編譯該軟體。 這可能會需要修改 <code class="filename">Makefile</code> 或執行 <code class="command">configure</code> Script。</p></li><li class="step"><p>測試並安裝該軟體。</p></li></ol></div><p>FreeBSD <span class="emphasis"><em>Port</em></span> 是指設計用來自動化從原始碼編譯應用程式整個程序的一系列檔案，組成 Port 的檔案包含了自動下載、解壓縮、修補、編譯與安裝應用程式的必要資訊。</p><p>若軟體尚未被 FreeBSD 採用並測試，可能會需要經過一些修正才能正常安裝並執行。</p><p>雖然如此，目前已有超過 <a class="link" href="../../../../ports/index.html" target="_top">24,000</a> 個第三方應用程式已經被移植到 FreeBSD。當可行時，這些應用程式也會做成預先編譯好的 <span class="emphasis"><em>套件 (Package)</em></span> 供下載。</p><p>這些 Binary 套件可使用 FreeBSD 套件管理指令來管理。</p><p>不論是 Binary 套件或者 Port 都有相依性，若用 Binary 套件或 Port 來安裝應用程式，且該應用程式若有相依的程式庫尚未被安裝，則會自動先安裝該程式庫。</p><p>FreeBSD  Binary 套件中含有一個應用程式中所有預先編譯好的指令、設定檔以及文件，Binary 套件可以使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg</span>(8)</span></a> 指令來管理，如 <code class="command">pkg install</code>。</p><p>雖然兩種技術非常相似，但 Binary 套件及 Port 有各自的優點。 要視您要安裝的應用程式需求來選擇。</p><div class="itemizedlist"><div class="itemizedlist-title">Binary 套件優點</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>應用程式壓縮 Binary 套件的 tarball 會比壓縮原始碼的 tarball 還要小。</p></li><li class="listitem"><p>安裝 Binary 套件不需要編譯的時間，對於較慢的電腦要安裝大型的應用程式如 <span class="application">Mozilla</span>, <span class="application">KDE</span> 或 <span class="application">GNOME</span> 這點顯的相當重要。</p></li><li class="listitem"><p>Binary 套件不需要了解在 FreeBSD 上編譯軟體的流程。</p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Port 套件優點</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>由於 Binary 套件必須盡可能在大多數系統上執行，通常會採用較通用的編譯選項來編譯，由 Port 來編輯可更改編譯選項。</p></li><li class="listitem"><p>部份應用程式編譯期選項會與要安裝的功能有關，舉例來說 <span class="application">Apache</span> 便有大量不同的內建選項可以設定。</p><p>在某些情況，同樣的應用程式會存在多個不同的 Binary 套件，如 <span class="application">Ghostscript</span> 有 <code class="filename">ghostscript</code> 及 <code class="filename">ghostscript-nox11</code> 兩種 Binary 套件，用來區別是否有安裝 <span class="application">Xorg</span>。 若應用程式有一個以上的編譯期選項便無法用這個方式來區別 Binary 套件。</p></li><li class="listitem"><p>部份軟體的授權條款中禁止以 Binary 格式發佈。 這種軟體必須以原始碼發佈並由終端使用者編譯。</p></li><li class="listitem"><p>部份人並不相信 Binary 發佈版本，寧願閱讀原始碼來查看是否潛藏的問題。</p></li><li class="listitem"><p>原始碼可套用自訂的修補。</p></li></ul></div><p>要持續追蹤 Port 的更新可以訂閱 <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports" target="_top">FreeBSD Port 郵遞論壇</a> 與 <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports-bugs" target="_top">FreeBSD Port 問題郵遞論壇</a>。</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">在安裝任何應用程式之前，請先查看 <a class="link" href="https://vuxml.freebsd.org/" target="_top">https://vuxml.freebsd.org/</a> 是否有與該應用程式相關的安全性問題或輸入 <code class="command">pkg audit -F</code> 來檢查所有已安裝的應用程式是否有已知的漏洞。</p></div><p>本章接下來的部份將說明如何在 FreeBSD 使用 Binary 套件及 Port 套件安裝與管理第三方軟體。</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ports-finding-applications"></a>4.3. 搜尋軟體</h2></div></div></div><p>FreeBSD 上可安裝的軟體清單不斷在增加， 有幾種方式可以來找你想安裝的軟體：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FreeBSD 網站有維護一份可搜尋的最新應用程式清單，在 <a class="link" href="../../../../ports/index.html" target="_top">https://www.FreeBSD.org/ports/</a>。 可以依應用程式名稱或軟體分類來搜尋 Port。</p></li><li class="listitem"><a id="idp65448632" class="indexterm"></a><p>由 Dan Langille 維護的 <a class="link" href="http://www.FreshPorts.org/" target="_top">FreshPorts.org</a>，提供完整的搜尋工具並且可追蹤在 Port 套件集中的應用程式變更。註冊的使用者可以建立自訂的監視清單會自動寄發電子郵件通知 Port 的更新資訊。</p></li><li class="listitem"><a id="idp65450552" class="indexterm"></a><p>若找不到指定的應用程式，可以先到網站 <a class="link" href="http://www.sourceforge.net/" target="_top">SourceForge.net</a> 或 <a class="link" href="http://www.github.com/" target="_top">GitHub.com</a> 搜尋，後然再回到 <a class="link" href="../../../../ports/index.html" target="_top">FreeBSD 網站</a> 檢查該應用程式是否已被移植。</p></li><li class="listitem"><a id="idp65457592" class="indexterm"></a><p><a id="pkg-search"></a>要搜尋 Binary 套件檔案庫中的應用程式可：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg search <em class="replaceable"><code>subversion</code></em></code></strong>
git-subversion-<em class="replaceable"><code>1.9.2</code></em>
java-subversion-<em class="replaceable"><code>1.8.8_2</code></em>
p5-subversion-<em class="replaceable"><code>1.8.8_2</code></em>
py27-hgsubversion-<em class="replaceable"><code>1.6</code></em>
py27-subversion-<em class="replaceable"><code>1.8.8_2</code></em>
ruby-subversion-<em class="replaceable"><code>1.8.8_2</code></em>
subversion-<em class="replaceable"><code>1.8.8_2</code></em>
subversion-book-<em class="replaceable"><code>4515</code></em>
subversion-static-<em class="replaceable"><code>1.8.8_2</code></em>
subversion16-<em class="replaceable"><code>1.6.23_4</code></em>
subversion17-<em class="replaceable"><code>1.7.16_2</code></em></pre><p>套件名稱包含版本編號，且若 Port 使用 Python 為基礎，也會包含用來編譯該套件的 Python 版本。有些 Port 會有多個版本可使用，如 <span class="application">Subversion</span> ，因編譯選項不同，有多個版本可用，這個例子中即指靜態連結版本的 <span class="application">Subversion</span>。在指定要安裝的套件時，最好使用 Port 來源來指定該應用程式，Port 來源是指應用程式在 Port 樹中的路徑。再輸入一次 <code class="command">pkg search</code> 並加上 <code class="option">-o</code> 來列出每個套件來源：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg search -o <em class="replaceable"><code>subversion</code></em></code></strong>
devel/git-subversion
java/java-subversion
devel/p5-subversion
devel/py-hgsubversion
devel/py-subversion
devel/ruby-subversion
devel/subversion16
devel/subversion17
devel/subversion
devel/subversion-book
devel/subversion-static</pre><p><code class="command">pkg search</code> 支援使用 Shell 萬手字元 (globs)、正規表示法、描述或檔案庫中的其他其他內容。在安裝 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/pkg/pkg-descr">ports-mgmt/pkg</a> 或 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/pkg-devel/pkg-descr">ports-mgmt/pkg-devel</a> 之後，可參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg-search&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg-search</span>(8)</span></a> 以取得更多詳細資訊。</p></li><li class="listitem"><p>若 Port 套件集已安裝，有數個方法可以查詢 Port 樹中的本地版本。要找到 Port 所在的分類，可輸入 <code class="command">whereis <em class="replaceable"><code>file</code></em></code>，其中 <em class="replaceable"><code>file</code></em> 是要安裝的程式：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>whereis lsof</code></strong>
lsof: /usr/ports/sysutils/lsof</pre><p>或者，也可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=echo&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">echo</span>(1)</span></a>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>echo /usr/ports/*/*lsof*</code></strong>
/usr/ports/sysutils/lsof</pre><p>請注意，這也會顯示已下載至 <code class="filename">/usr/ports/distfiles</code> 目錄中任何已符合條件的檔案。</p></li><li class="listitem"><p>另一個方法是使用 Port 套件集內建的搜尋機制來找軟體。要使用搜尋的功能需先 <span class="application">cd</span> 到 <code class="filename">/usr/ports</code> 然後執行 <code class="command">make search name=program-name</code>，其中 <em class="replaceable"><code>program-name</code></em> 代表軟體的名稱。舉例搜尋 <code class="command">lsof</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make search name=lsof</code></strong>
Port:   lsof-4.88.d,8
Path:   /usr/ports/sysutils/lsof
Info:   Lists information about open files (similar to fstat(1))
Maint:  ler@lerctr.org
Index:  sysutils
B-deps:
R-deps: </pre><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml">內建的搜尋機制會使用索引檔內的資訊。若出現訊息指出需要 <code class="filename">INDEX</code> 檔，可執行 <code class="command">make fetchindex</code> 來下載最新的索引檔。當 <code class="filename">INDEX</code> 檔存在時，<code class="command">make search</code> 方可執行請求的搜尋動作。</p></div><p><span class="quote">“<span class="quote">Path:</span>”</span> 此行代表 Port 的所在位置。</p><p>若不要接受這麼多資訊，可使用 <code class="command">quicksearch</code> 功能：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make quicksearch name=lsof</code></strong>
Port:   lsof-4.88.d,8
Path:   /usr/ports/sysutils/lsof
Info:   Lists information about open files (similar to fstat(1))</pre><p>若要進行更有深度的搜尋，使用 <code class="command">make search key=<em class="replaceable"><code>string</code></em></code> 或 <code class="command">make quicksearch key=<em class="replaceable"><code>string</code></em></code> 其中 <em class="replaceable"><code>string</code></em> 是要搜尋的文字。該文字可以是一部份的註解、描述或相依套件，當不清楚程式的名稱時可以找到與特定主題相關的 Port。</p><p>當使用 <code class="buildtarget">search</code> 或 <code class="buildtarget">quicksearch</code> 時，搜尋的字串不分大小寫。 搜尋 <span class="quote">“<span class="quote">LSOF</span>”</span> 會與搜尋 <span class="quote">“<span class="quote">lsof</span>”</span> 產生相同的結果。</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="pkgng-intro"></a>4.4. 使用 <span class="application">pkg</span> 管理 Binary 套件</h2></div></div></div><p><span class="application">pkg</span> 是新一代套件管理工具用來取代舊版工具，提供許多功能讓處理 Binary 套件更快更簡單。</p><p>對於只想要使用在 FreeBSD 鏡像站上預先編譯 Binary 套件的站台，使用 <span class="application">pkg</span> 管理套件便已足夠。</p><p>但是，對於那些想要從原始碼或使用自己的檔案庫編譯的站台，則會需要 <a class="link" href="#ports-upgrading-tools" title="4.5.3.1. 升級與管理 Port 的工具">Port 管理工具</a>。</p><p>因為 <span class="application">pkg</span> 僅能管理 Binary 套件，所以不能當做為替代 Port 管理工具，這些工具可用來安裝來自 Binary 與 Port 套件集的軟體，而 <span class="application">pkg</span> 僅能安裝 Binary 套件。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-initial-setup"></a>4.4.1. 開始使用 <span class="application">pkg</span></h3></div></div></div><p>FreeBSD 內建啟動 (Bootstrap) 工具可用來下載並安裝 <span class="application">pkg</span> 及其操作手冊。這個工具是設計在 FreeBSD 版本 10.<em class="replaceable"><code>X</code></em> 之後使用。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">不是所有 FreeBSD 版本及架構支援此啟動程序，目前支援的清單列於 <a class="link" href="https://pkg.freebsd.org/" target="_top">https://pkg.freebsd.org/</a>，對不支援的版本，必須改透過 Port 套件集或者 Binary 套件來安裝 <span class="application">pkg</span>。</p></div><p>要啟動 (Bootstrap) 系統請執行：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>/usr/sbin/pkg</code></strong></pre><p>您必須有可用的網際網路連線供啟動程式使用方可成功。</p><p>否則，要安裝 Port 套件，則須執行：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/ports-mgmt/pkg</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>當升級原使用舊版 pkg_* 工具的既有系統時，必須將資料庫轉換成新的格式，如此新的工具才會知道有那些已安裝過的套件。<span class="application">pkg</span> 安裝完後，必須執行以下指令將套件資料庫從舊版格式轉換到新版格式：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg2ng</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">新安裝的版本因尚未安裝任何第三方軟體因此不須做這個步驟。</p></div><div xmlns="" class="important"><h3 class="admontitle">重要: </h3><p xmlns="http://www.w3.org/1999/xhtml">這個步驟無法還原。一旦套件資料庫轉為成 <span class="application">pkg</span> 的格式，舊版 <code class="literal">pkg_*</code> 工具就不該再繼續使用。</p></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">套件資料庫轉換的過程可能會因內容轉換為新版本產生錯誤。通常，這些錯誤皆可安全忽略，即使如此，仍然有在執行 <code class="command">pkg2ng</code> 後無法成功轉換的軟體清單，這些應用程式則必須手動重新安裝。</p></div><p>為了確保 FreeBSD Port 套件集會將新軟體的資訊註冊到 <span class="application">pkg</span> 而非舊版套件資料庫，FreeBSD 版本 10.<em class="replaceable"><code>X</code></em> 之前需要在 <code class="filename">/etc/make.conf</code> 加入此行：</p><pre xml:lang="en" class="programlisting" lang="en">WITH_PKGNG=	yes</pre><p>預設 <span class="application">pkg</span> 會使用 FreeBSD 套件鏡像站 (<span class="emphasis"><em>Repository</em></span>) 的 Binary 套件。若要取得有關編譯自訂套件檔案庫的資訊，請參考 <a class="xref" href="#ports-poudriere" title="4.6. 使用 Poudriere 編譯套件">節 4.6, “使用 <span class="application">Poudriere</span> 編譯套件”</a>。</p><p>其他 <span class="application">pkg</span> 設定選項說明請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg.conf</span>(5)</span></a>。</p><p><span class="application">pkg</span> 的用法資訊可在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg</span>(8)</span></a> 操作手冊或不加任何參數執行 <code class="command">pkg</code> 來取得。</p><p>每個 <span class="application">pkg</span> 指令參數皆記庫在指令操件手冊。要閱讀 <code class="command">pkg install</code> 的操作手冊，可執行以下指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg help install</code></strong></pre><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>man pkg-install</code></strong></pre><p>本章節剩餘的部份將會示範使用 <span class="application">pkg</span> 執行常用的 Binary 套件管理工作。每個示範的指令皆會提供多個參數可使用，請參考指令的說明或操作手冊以取得詳細資訊或更多範例。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-pkg-info"></a>4.4.2. 取得有關已安裝套件的資訊</h3></div></div></div><p>有關已安裝在系統的套件資訊可透過執行 <code class="command">pkg info</code> 來檢視，若執行時未指定任何參數，將會列出所有已安裝或指定的套件版本。</p><p>例如，要查看已安裝的 <span class="application">pkg</span> 版本可執行：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg info pkg</code></strong>
pkg-1.1.4_1</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-installing-deinstalling"></a>4.4.3. 安裝與移除套件</h3></div></div></div><p>要安裝 Binary 套件可使用以下指令，其中 <em class="replaceable"><code>packagename</code></em> 為要安裝的套件名稱：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install <em class="replaceable"><code>packagename</code></em></code></strong></pre><p>這個指令會使用檔案庫的資料來決定要安裝的軟體版本以及是否有任何未安裝的相依。例如，要安裝 <span class="application">curl</span>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install curl</code></strong>
Updating repository catalogue
/usr/local/tmp/All/curl-7.31.0_1.txz          100% of 1181 kB 1380 kBps 00m01s

/usr/local/tmp/All/ca_root_nss-3.15.1_1.txz   100% of  288 kB 1700 kBps 00m00s

Updating repository catalogue
The following 2 packages will be installed:

        Installing ca_root_nss: 3.15.1_1
        Installing curl: 7.31.0_1

The installation will require 3 MB more space

0 B to be downloaded

Proceed with installing packages [y/N]: <strong class="userinput"><code>y</code></strong>
Checking integrity... done
[1/2] Installing ca_root_nss-3.15.1_1... done
[2/2] Installing curl-7.31.0_1... done
Cleaning up cache files...Done</pre><p>新的套件以及任何做為相依安裝的額外套件可在已安裝的套件清單中看到：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg info</code></strong>
ca_root_nss-3.15.1_1	The root certificate bundle from the Mozilla Project
curl-7.31.0_1	Non-interactive tool to get files from FTP, GOPHER, HTTP(S) servers
pkg-1.1.4_6	New generation package manager</pre><p>不再需要的套件可以使用 <code class="command">pkg delete</code> 來移除，例如：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg delete curl</code></strong>
The following packages will be deleted:

	curl-7.31.0_1

The deletion will free 3 MB

Proceed with deleting packages [y/N]: <strong class="userinput"><code>y</code></strong>
[1/1] Deleting curl-7.31.0_1... done</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-upgrading"></a>4.4.4. 升級已安裝套件</h3></div></div></div><p>執行以下指令，可將已安裝的套件升級到最新版本：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg upgrade</code></strong></pre><p>這個指令將會比對已安裝的版本與在檔案庫分類中的版本，並從檔案庫升級這些套件。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-auditing"></a>4.4.5. 稽查已安裝套件</h3></div></div></div><p>在第三方的應用程式中偶爾可能會發現軟體漏洞，要找出這些程式，可使用 <span class="application">pkg</span> 內建的稽查機制。要查詢已安裝在系統上的軟體是否有任何已知的漏洞可執行：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg audit -F</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-autoremove"></a>4.4.6. 自動移除未使用的套件</h3></div></div></div><p>移除一個套件可能會留下不再需要使用的相依套件。不再需要的相依套件是當初隨著其套件所安裝的套件 (枝葉套件)，可以使用以下指令自動偵測並移除：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg autoremove</code></strong>
Packages to be autoremoved:
	ca_root_nss-3.15.1_1

The autoremoval will free 723 kB

Proceed with autoremoval of packages [y/N]: <strong class="userinput"><code>y</code></strong>
Deinstalling ca_root_nss-3.15.1_1... done</pre><p xml:lang="en" lang="en">Packages installed as dependencies are
	called <span class="emphasis"><em>automatic</em></span> packages.  Non-automatic
	packages, i.e the packages that were explicity installed not
	as a dependency to another package, can be listed
	using:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg prime-list</code></strong>
nginx
openvpn
sudo</pre><p xml:lang="en" lang="en"><code class="command">pkg prime-list</code> is an alias command
	declared in <code class="filename">/usr/local/etc/pkg.conf</code>.
	There are many others that can be used to query the package
	database of the system.  For instance, command
	<code class="command">pkg prime-origins</code> can be used to get the
	origin port directory of the list mentioned above:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg prime-origins</code></strong>
www/nginx
security/openvpn
security/sudo</pre><p xml:lang="en" lang="en">This list can be used to rebuild all packages
	installed on a system using build tools such as <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/&#10;&#9;ports-mgmt/poudriere/pkg-descr">
	ports-mgmt/poudriere</a> or <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/&#10;&#9;ports-mgmt/synth/pkg-descr">
	ports-mgmt/synth</a>.</p><p xml:lang="en" lang="en">Marking an installed package as automatic can be
      done using:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg set -A 1 devel/cmake</code></strong></pre><p xml:lang="en" lang="en">Once a package is a leaf package and is marked
	as automatic, it gets selected by
	<code class="command">pkg autoremove</code>.</p><p xml:lang="en" lang="en">Marking an installed package as <span class="emphasis"><em>not</em></span>
	automatic can be done using:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg set -A 0 devel/cmake</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-backup"></a>4.4.7. 還原套件資料庫</h3></div></div></div><p>不如傳統的套件管理系統，<span class="application">pkg</span> 有自己的套件資料庫備份機制，此功能預設是開啟的。</p><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml">要停止週期的 Script 備份套件資料庫可在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=periodic.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">periodic.conf</span>(5)</span></a> 設定 <code class="literal">daily_backup_pkgdb_enable="NO"</code>。</p></div><p>要還原先前套件資料庫的備份，可執行以下指令並將 <em class="replaceable"><code>/path/to/pkg.sql</code></em> 替換為備份的位置：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg backup -r <em class="replaceable"><code>/path/to/pkg.sql</code></em></code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">若要還原有週期 Script 所產生的備份必須在還原前先解壓縮。</p></div><p>要手動備份 <span class="application">pkg</span> 資料庫，可執行以下指令，並替換 <em class="replaceable"><code>/path/to/pkg.sql</code></em> 為適當的檔案名稱與位置：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg backup -d <em class="replaceable"><code>/path/to/pkg.sql</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-clean"></a>4.4.8. 移除過時的套件</h3></div></div></div><p>預設 <span class="application">pkg</span> 會儲存 Binary 套件在快取目錄定義在  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg.conf</span>(5)</span></a> 中的 <code class="envar">PKG_CACHEDIR</code>，只會保留最後安裝的套件複本。較舊版的 <span class="application">pkg</span>  會保留所有先前的套件，若要移除這些過時的  Binary 套件，可執行：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg clean</code></strong></pre><p>使用以下指令可清空全部的快取：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg clean -a</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-set"></a>4.4.9. 修改套件 Metadata</h3></div></div></div><p>在 FreeBSD Port 套件集中的軟體可能會經歷主要版號的修改，要解決這個問題可使用 <span class="application">pkg</span> 內建的指令來更新套件來源。這非常有用，例如 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/lang/php5/pkg-descr">lang/php5</a> 重新命名為 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/lang/php53/pkg-descr">lang/php53</a> 因此 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/lang/php5/pkg-descr">lang/php5</a> 從此之後代表版本 <code class="literal">5.4</code>。</p><p>要更改上述例子中的套件來源，可執行：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg set -o lang/php5:lang/php53</code></strong></pre><p>再一個例子，要更新 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/lang/ruby18/pkg-descr">lang/ruby18</a> 為 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/lang/ruby19/pkg-descr">lang/ruby19</a>，可執行：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg set -o lang/ruby18:lang/ruby19</code></strong></pre><p>最後一個例子，要更改 <code class="filename">libglut</code> 共用程式庫的來源從 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/graphics/libglut/pkg-descr">graphics/libglut</a> 改成 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/graphics/freeglut/pkg-descr">graphics/freeglut</a> 可執行：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg set -o graphics/libglut:graphics/freeglut</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">在更改套件來源之後，很重要的一件事是要重新安裝套件，來讓相依的套件也同時使用修改後的來源。要強制重新安裝相依套件，可執行：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install -Rf <em class="replaceable"><code>graphics/freeglut</code></em></code></strong></pre></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ports-using"></a>4.5. 使用 Port 套件集</h2></div></div></div><p>Port 套件集是指一數個 <code class="filename">Makefiles</code>、修補及描述檔案，每一組這些檔案可用來編譯與安裝在 FreeBSD 上的一個應用程式，即稱為一個 <span class="emphasis"><em>Port</em></span>。</p><p>預設，Port 套件集儲存在 <code class="filename">/usr/ports</code> 的子目錄下。</p><p>在應用程式可以使用 Port 編譯之前，必須先安裝 Port 套件集。若在安裝 FreeBSD 時沒有安裝，可以使用以下其中一種方式安裝：</p><div class="procedure"><a id="ports-using-portsnap-method"></a><div class="procedure-title">過程 4.1. Portsnap 方法</div><p>FreeBSD 的基礎系統內含 <span class="application">Portsnap</span>，這是一個可用來取得 Port 套件集簡單又快速的工具，較建議多數使用者使用這個方式。此工具會連線到 FreeBSD 的網站，驗証密鑰，然後下載 Port 套件集的新複本。該金鑰是要用來檢驗所有已下載檔案的完整性。</p><ol class="procedure" type="1"><li class="step"><p>要下載壓縮後的 Port 套件集快照 (Snapshot) 到 <code class="filename">/var/db/portsnap</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>portsnap fetch</code></strong></pre></li><li class="step"><p>當第一次執行 <span class="application">Portsnap</span> 時，要先解壓縮快照到 <code class="filename">/usr/ports</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>portsnap extract</code></strong></pre></li><li class="step"><p>在完成上述第一次使用 <span class="application">Portsnap</span> 的動作之後，往後可隨需要執行以下指令來更新 <code class="filename">/usr/ports</code> ：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>portsnap fetch</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>portsnap update</code></strong></pre><p>當使用 <code class="literal">fetch</code> 時也可同時執行 <code class="literal">extract</code> 或 <code class="literal">update</code> 如：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>portsnap fetch update</code></strong></pre></li></ol></div><div class="procedure"><a id="ports-using-subversion-method"></a><div class="procedure-title">過程 4.2. Subversion 方法</div><p>若要取得更多對 Port 樹的控制，或若有本地的變更需要維護，可以使用 <span class="application">Subversion</span> 來取得 Port 套件集。請參考 <a class="link" href="../../../../doc/en_US.ISO8859-1/articles/committers-guide/subversion-primer.html" target="_top">Subversion Primer</a> 來取得 <span class="application">Subversion</span> 的詳細說明。</p><ol class="procedure" type="1"><li class="step"><p>必須安裝 <span class="application">Subversion</span> 才可用來取出 (Check out) Port 樹。若已存在 Port 樹的複本，可使用此方式安裝 <span class="application">Subversion</span>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/devel/subversion</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>若尚無法使用 Port 樹，或已經使用 <span class="application">pkg</span> 來管理套件，可使用套件來安裝 <span class="application">Subversion</span>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install subversion</code></strong></pre></li><li class="step"><p>取出 Port 樹的複本：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>svn checkout https://svn.FreeBSD.org/ports/head /usr/ports</code></strong></pre></li><li class="step"><p>若需要，在第一次 <span class="application">Subversion</span> 取出後可使用以下指令更新 <code class="filename">/usr/ports</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>svn update /usr/ports</code></strong></pre></li></ol></div><p>Port 套件集中含有代表不同軟體分類的目錄，每個分類底下的子目錄代表每個應用程式，每個內含數個用來告訴 FreeBSD 如何編譯與安裝該程式檔案的應用程式子目錄即稱作 <span class="emphasis"><em>Port Skeleton</em></span>，每個 Port Skeleton 會含有以下檔案及目錄：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">Makefile</code>：內含用來說明應用程式要如何編譯、要安裝該程式到那的敘述句。</p></li><li class="listitem"><p><code class="filename">distinfo</code>：內含編譯 Port 必須下載的檔案名稱以及校驗碼 (Checksum)。</p></li><li class="listitem"><p><code class="filename">files/</code>：此目錄含有編譯與安裝程式到 FreeBSD 時所需的修補檔。此目錄也可能含有其他用來編譯 Port 的檔案。</p></li><li class="listitem"><p><code class="filename">pkg-descr</code>：提供程式更詳細的說明。</p></li><li class="listitem"><p><code class="filename">pkg-plist</code>：Port 安裝的所有檔案清單，也同時會告訴 Port 系統解除安裝時要移除那一些檔案。</p></li></ul></div><p>部份 Port 含有 <code class="filename">pkg-message</code> 或其他檔案用來處理特殊情況。要取得有關這些檔案的詳細資訊，以及 Port 的概要可參考 <a class="link" href="../../../../doc/en_US.ISO8859-1/books/porters-handbook/index.html" target="_top">FreeBSD Porter's Handbook</a>。</p><p>Port 中並不含實際的原始碼，即為 <code class="filename">distfile</code>，在編譯 Port 解壓縮時會自動下載的原始碼到 <code class="filename">/usr/ports/distfiles</code>。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ports-skeleton"></a>4.5.1. 安裝 Port</h3></div></div></div><a id="idp65820088" class="indexterm"></a><p>下面我們會介紹如何使用 Port 套件集來安裝、移除軟體的基本用法。 <code class="command">make</code> 可用的目標及環境變數詳細說明可參閱 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ports&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ports</span>(7)</span></a>。</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">在編譯任何 Port 套件前，請先確認已經如前章節所敘述之方法更新 Port 套件集。安裝任何第三方軟體皆可能會導致安全性漏洞，建議在安裝前先閱讀 <a class="link" href="https://vuxml.freebsd.org/" target="_top">https://vuxml.freebsd.org/</a> 了解 Port 已知的安全性問題。或者在每次安裝新 Port 前執行 <code class="command">pkg audit -F</code>。此指令可以設定在每日系統安全性檢查時自動完成安全性稽查以及更新漏洞資料庫。要取得更多資訊，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg-audit&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg-audit</span>(8)</span></a> 及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">periodic</span>(8)</span></a>。</p></div><p>使用 Port 套件集會假設您擁有可正常連線的網路，同時也會需要超級使用者的權限。</p><p>要編譯並安裝 Port，需切換目錄到要安裝的 Port 底下，然後輸入 <code class="command">make install</code>，訊息中會顯示安裝的進度：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/sysutils/lsof</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong>
&gt;&gt; lsof_4.88D.freebsd.tar.gz doesn't seem to exist in /usr/ports/distfiles/.
&gt;&gt; Attempting to fetch from ftp://lsof.itap.purdue.edu/pub/tools/unix/lsof/.
===&gt;  Extracting for lsof-4.88
...
[extraction output snipped]
...
&gt;&gt; Checksum OK for lsof_4.88D.freebsd.tar.gz.
===&gt;  Patching for lsof-4.88.d,8
===&gt;  Applying FreeBSD patches for lsof-4.88.d,8
===&gt;  Configuring for lsof-4.88.d,8
...
[configure output snipped]
...
===&gt;  Building for lsof-4.88.d,8
...
[compilation output snipped]
...

===&gt;  Installing for lsof-4.88.d,8
...
[installation output snipped]
...
===&gt;   Generating temporary packing list
===&gt;   Compressing manual pages for lsof-4.88.d,8
===&gt;   Registering installation for lsof-4.88.d,8
===&gt;  SECURITY NOTE:
      This port has installed the following binaries which execute with
      increased privileges.
/usr/local/sbin/lsof
<code class="prompt">#</code></pre><p><code class="command">lsof</code> 是需要進階權限才有辦法執行的程式，因此當該程式安裝完成時會顯示安全性警告。一旦安裝完成便會顯示指令提示。</p><p>有些 Shell 會將 <code class="envar">PATH</code> 環境變數中所列目錄中可用的指令做快取，來增加在執行指這些指令時的查詢速度。<code class="command">tcsh</code> Shell 的使用者應輸入 <code class="command">rehash</code> 來讓新安裝的指令不須指定完整路徑便可使用。若在 <code class="command">sh</code> Shell 則使用 <code class="command">hash -r</code>。請參考 Shell 的說明文件以取得更多資訊。</p><p>安裝過程中會建立工作用的子目錄用來儲存編譯時暫存的檔案。可移除此目錄來節省磁碟空間並漸少往後升級新版 Port 時造成問題：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>make clean</code></strong>
===&gt;  Cleaning for lsof-88.d,8
<code class="prompt">#</code></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">若想要少做這個額外的步驟，可以編譯 Port 時使用 <code class="command">make install clean</code>。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp66154680"></a>4.5.1.1. 自訂 Port 安裝</h4></div></div></div><p>部份 Port 提供編譯選項，可用來開啟或關閉應用程式中的元件、安全選項、或其他允許自訂的項目。這類的應用程式例子包括 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/firefox/pkg-descr">www/firefox</a>, <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/gpgme/pkg-descr">security/gpgme</a> 以及 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/sylpheed-claws/pkg-descr">mail/sylpheed-claws</a>。若 Port 相依的其他 Port 有可設定的選項時，預設的模式會提示使用者選擇選單中的選項，這可能會讓安裝的過程暫停讓使用者操作數次。要避免這個情況，可一次設定所有選項，只要在 Port skeleton 中執行 <code class="command">make config-recursive</code>，然後再執行 <code class="command">make install [clean]</code> 編譯與安裝該 Port。</p><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml">使用 <code class="buildtarget">config-recursive</code> 時，會使用 <code class="buildtarget">all-depends-list</code> Target 來收集所有要設定 Port 清單。建議執行 <code class="command">make config-recursive</code> 直到所有相依的 Port 選項都已定義，直到 Port 的選項畫面不會再出現，來確定所有相依的選項都已經設定。</p></div><p>有許多方式可以重新進入 Port 的編譯選項清單，以便在編譯 Port 之後加入、移除或更改這些選項。方法之一是 <code class="command">cd</code> 進入含有 Port 的目錄並輸入 <code class="command">make config</code>。還有另一個方法是使用 <code class="command">make showconfig</code>。最後一個方法是執行 <code class="command">make rmconfig</code> 來移除所有曾選擇過的選項，讓您能夠重新設定。這些方法在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ports&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ports</span>(7)</span></a> 中都有詳細的說明。</p><p>Port 系統使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fetch&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fetch</span>(1)</span></a> 來下載檔案，它支援許多的環境變數可設定。若 FreeBSD 系統在防火牆或 FTP/HTTP 代理伺服器後面，可以設定 <code class="envar">FTP_PASSIVE_MODE</code>, <code class="envar">FTP_PROXY</code> 以及 <code class="envar">FTP_PASSWORD</code> 變數。請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fetch&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fetch</span>(3)</span></a> 取得完整支援的變數清單。</p><p>對於那些無法一直連線到網際網路的使用者，可在 <code class="filename">/usr/ports</code> 下執行 <code class="command">make fetch</code> 來下載所有的 distfiles，或是可在某個分類的目錄中，例如 <code class="filename">/usr/ports/net</code>，或指定的 Port Skeleton 中執行。要注意的是，若 Port 有任何的相依，在分類或 Port Skeleton 中執行此指令並 <span class="emphasis"><em>不會</em></span> 下載相依在其他分類的 Port distfiles。可使用 <code class="command">make fetch-recursive</code> 來下載所有相依 Port 的 distfiles。</p><p>在部份少數情況，例如當公司或組織有自己的本地 distfiles 檔案庫，可使用 <code class="varname">MASTER_SITES</code> 變數來覆蓋在 <code class="filename">Makefile</code> 中指定的下載位址。當要指定替代的位址時可：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/<em class="replaceable"><code>directory</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make MASTER_SITE_OVERRIDE= \
<em class="replaceable"><code>ftp://ftp.organization.org/pub/FreeBSD/ports/distfiles/</code></em> fetch</code></strong></pre><p>也可使用 <code class="varname">WRKDIRPREFIX</code> 及 <code class="varname">PREFIX</code> 變數來覆蓋預設的工作及目標目錄。例如：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>make WRKDIRPREFIX=/usr/home/example/ports install</code></strong></pre><p>會編譯在 <code class="filename">/usr/home/example/ports</code> 的 Port 並安裝所有東西到 <code class="filename">/usr/local</code> 下。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>make PREFIX=/usr/home/example/local install</code></strong></pre><p>會編譯在 <code class="filename">/usr/ports</code> Port 並安裝到 <code class="filename">/usr/home/example/local</code>。然後：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>make WRKDIRPREFIX=../ports PREFIX=../local install</code></strong></pre><p>來同時設定工作及目標目錄。</p><p>這些變數也可做為環境變數設定，請參考您使用的 Shell 操作手冊來取得如何設定環境變數的說明。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ports-removing"></a>4.5.2. 移除已安裝的 Port</h3></div></div></div><a id="idp66192184" class="indexterm"></a><p>安裝的 Port 可以使用 <code class="command">pkg delete</code> 解除安裝。 使用這個指令的範例可以在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg-delete&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg-delete</span>(8)</span></a> 操作手冊找到。</p><p>或者，可在 Port 的目錄下執行 <code class="command">make deinstall</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/sysutils/lsof</code></strong>
<strong class="userinput"><code>make deinstall</code></strong>
===&gt;  Deinstalling for sysutils/lsof
===&gt;   Deinstalling
Deinstallation has been requested for the following 1 packages:

	lsof-4.88.d,8

The deinstallation will free 229 kB
[1/1] Deleting lsof-4.88.d,8... done</pre><p>建議閱讀 Port 解除安裝後的訊息，若有任何相依該 Port 的應用程式，這些資訊會被顯示出來，但解除安裝的程序仍會繼續。在這種情況下最好重新安裝應用程式來避免破壞相依性。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ports-upgrading"></a>4.5.3. 升級 Port</h3></div></div></div><a id="idp66202680" class="indexterm"></a><p>隨著時間推移，Port 套件集中會有新版的軟體可用。本節將說明如何檢查是否有可以升級的軟體及如何升級。</p><p>要檢查已安裝 Port 是否有新版可用，請先確定已安裝最新版本的 Port 樹，使用 <a class="xref" href="#ports-using-portsnap-method" title="過程 4.1. Portsnap 方法">過程 4.1, “Portsnap 方法”</a> 或 <a class="xref" href="#ports-using-subversion-method" title="過程 4.2. Subversion 方法">過程 4.2, “Subversion 方法”</a> 中說明的指令來更新。在 FreeBSD 10 與更新的版本，或若套件系統已轉換為 <span class="application">pkg</span>，可以使用下列指令列出已經安裝的 Port 中有那些已過時：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg version -l "&lt;"</code></strong></pre><p>在 FreeBSD 9.<em class="replaceable"><code>X</code></em> 與較舊的版本，可以使用下列指令列出已經安裝的 Port 中有那些已過時：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg_version -l "&lt;"</code></strong></pre><div xmlns="" class="important"><h3 class="admontitle">重要: </h3><p xmlns="http://www.w3.org/1999/xhtml">在嘗試升級之前，請先從檔首閱讀 <code class="filename">/usr/ports/UPDATING</code> 來取得最近有那些 Port 已升級或系統已安裝。這個檔案中會說明各種問題及在升級 Port 時可能會需要使用者執行的額外步驟，例如檔案格式更改、設定檔位置更改、或任何與先前版本不相容的問題。留意那些與您要升級 Port 相關的指示，並依照這些指示執行升級。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ports-upgrading-tools"></a>4.5.3.1. 升級與管理 Port 的工具</h4></div></div></div><a id="idp66214712" class="indexterm"></a><p>Port 套件集含有數個工具可以進行升級，每一種工具都有其優點及缺點。</p><p>以往大多 Port 安裝會使用 <span class="application">Portmaster</span> 或 <span class="application">Portupgrade</span>，現在有較新的 <span class="application">Synth</span> 可使用。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">那一種工具對特定系統是最佳的選擇取決於系統管理員。建議在使用任何這些工具之前先備份資料。</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="portmaster"></a>4.5.3.2. 使用 <span class="application">Portmaster</span> 升級 Port</h4></div></div></div><a id="idp66223672" class="indexterm"></a><p><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portmaster/pkg-descr">ports-mgmt/portmaster</a> 是可用來升級已安裝 Port 的小巧工具，它只使用了隨 FreeBSD 基礎系統安裝的工具，不需要相依其他 Port 或資料庫便可在 FreeBSD 使用，要使用 Port 安裝此工具可：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/ports-mgmt/portmaster</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p><span class="application">Portmaster</span> 將 Port 定義成四種類型：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>根 Port：沒有相依且也不被任何其他 Port 相依。</p></li><li class="listitem"><p>主幹 Port：沒有相依，但被其他 Port 相依。</p></li><li class="listitem"><p>分支 Port：有相依，且其被其他 Port 相依。</p></li><li class="listitem"><p>枝 Port：有相依，但沒有被其他 Port 相依。</p></li></ul></div><p>要列出這幾個分類並搜尋是否有新版：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>portmaster -L</code></strong>
===&gt;&gt;&gt; Root ports (No dependencies, not depended on)
===&gt;&gt;&gt; ispell-3.2.06_18
===&gt;&gt;&gt; screen-4.0.3
        ===&gt;&gt;&gt; New version available: screen-4.0.3_1
===&gt;&gt;&gt; tcpflow-0.21_1
===&gt;&gt;&gt; 7 root ports
...
===&gt;&gt;&gt; Branch ports (Have dependencies, are depended on)
===&gt;&gt;&gt; apache22-2.2.3
        ===&gt;&gt;&gt; New version available: apache22-2.2.8
...
===&gt;&gt;&gt; Leaf ports (Have dependencies, not depended on)
===&gt;&gt;&gt; automake-1.9.6_2
===&gt;&gt;&gt; bash-3.1.17
        ===&gt;&gt;&gt; New version available: bash-3.2.33
...
===&gt;&gt;&gt; 32 leaf ports

===&gt;&gt;&gt; 137 total installed ports
        ===&gt;&gt;&gt; 83 have new versions available</pre><p>此指令用來升級所有過時的 Port：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>portmaster -a</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">預設 <span class="application">Portmaster</span> 會在刪除已存在的 Port 前備份套件，若成功安裝新版 <span class="application">Portmaster</span> 會刪除該備份。使用 <code class="option">-b</code> 來讓 <span class="application">Portmaster</span> 不會自動刪除備份。加入 <code class="option">-i</code> 可啟動 <span class="application">Portmaster</span> 的互動模式，會在升級每個 Port 前提示訊息。尚有許多可用的其他選項，請閱讀 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=portmaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">portmaster</span>(8)</span></a> 的操作手冊來取得詳細的用法。</p></div><p>若升級的過程發生錯誤，可加入 <code class="option">-f</code> 來升級並重新編譯所有 Port：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>portmaster -af</code></strong></pre><p><span class="application">Portmaster</span> 也可用來安裝新的 Port 到系統，在編譯及安裝新 Port 前升級所有相依模組。要使用這個功能，要指定 Port 位於 Port 套件集中的位置：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>portmaster <em class="replaceable"><code>shells/bash</code></em></code></strong></pre><p>更多有關 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portmaster/pkg-descr">ports-mgmt/portmaster</a> 的資訊可至其 <code class="filename">pkg-descr</code> 取得。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="portupgrade"></a>4.5.3.3. 使用 Portupgrade 升級 Port</h4></div></div></div><a id="idp66276536" class="indexterm"></a><p><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portupgrade/pkg-descr">ports-mgmt/portupgrade</a> 是另一個可以用來升級 Port 的工具，此工具會安裝一套可以用來管理 Port 的應用程式，它需要相依 Ruby。要安裝該 Port：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/ports-mgmt/portupgrade</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>在執行升級之前使用此工具，建議使用 <code class="command">pkgdb -F</code> 掃描已安裝的 Port 並修正該指令回報的所有資訊不一致的套件。</p><p>要升級所有安裝在系統上過時的 Port，可使用 <code class="command">portupgrade -a</code>，或者加上 <code class="option">-i</code> 會在每個套件升級時詢問確認：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>portupgrade -ai</code></strong></pre><p>要升級指定的應用程式而非所有可用 Port 可使用 <code class="command">portupgrade <em class="replaceable"><code>pkgname</code></em></code>，非常重要的是，要加上 <code class="option">-R</code> 來先升級指定應用程式所有相依的 Port：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>portupgrade -R firefox</code></strong></pre><p>若使用 <code class="option">-P</code>，<span class="application">Portupgrade</span> 會先在 <code class="envar">PKG_PATH</code> 清單中的本地目錄中搜尋可用的套件。若本地沒有可用的套件，則會從遠端下載。若套件無法在本地或遠端找到，<span class="application">Portupgrade</span> 則會使用 Port 來安裝。要避免完全使用 Port 安裝，可使用 <code class="option">-PP</code>，這個選項會告訴 <span class="application">Portupgrade</span> 若沒有套件可用時放棄安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>portupgrade -PP gnome3</code></strong></pre><p>若只想要下載 Port distfiles 或套件，使用 <code class="option">-P</code> 參數。若不要編譯或安裝任何東西，使用 <code class="option">-F</code>。請參考 <code class="command">portupgrade</code> 的操作手冊來取得所有可用選項的更多資訊。</p><p>更多有關 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portupgrade/pkg-descr">ports-mgmt/portupgrade</a> 的資訊可至其 <code class="filename">pkg-descr</code> 取得。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ports-disk-space"></a>4.5.4. Port 與磁碟空間</h3></div></div></div><a id="idp66321592" class="indexterm"></a><p>使用 Port 套件集會隨著時間消耗磁碟空間。在編譯與安裝 Port 完之後，在 Port Skeleton 中執行 <code class="command">make clean</code> 可清除暫存的 <code class="filename">work</code> 目錄。若使用 <span class="application">Portmaster</span> 來安裝 Port，則會自動移除該目錄，除非使用 <code class="option">-K</code>。若有安裝 <span class="application">Portupgrade</span>，此指令將會移除所有在 Port 套件集的本地複本中找到的 <code class="filename">work</code> 目錄：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>portsclean -C</code></strong></pre><p>除此之外，許多過時的原始碼發行檔案會儲存在 <code class="filename">/usr/ports/distfiles</code>。使用 <span class="application">Portupgrade</span> 刪除所有不再被任何 Port 所引用的 distfiles：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>portsclean -D</code></strong></pre><p><span class="application">Portupgrade</span> 可以移除所有未被任何安裝在系統上的 Port 所引用的 distfiles：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>portsclean -DD</code></strong></pre><p>若有安裝 <span class="application">Portmaster</span>，則可使用：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>portmaster --clean-distfiles</code></strong></pre><p>預設，若 distfile 應要被刪除，這個指令會以互動的方式向使用者確認。</p><p>除了以上指令外，<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/pkg_cutleaves/pkg-descr">ports-mgmt/pkg_cutleaves</a> 可自動移除不再需要使用的 Port。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ports-poudriere"></a>4.6. 使用 <span class="application">Poudriere</span> 編譯套件</h2></div></div></div><p><span class="application">Poudriere</span> 是一個使用 <acronym class="acronym">BSD</acronym> 授權條款用來建立與測試 FreeBSD 套件的工具。它使用 FreeBSD Jail 來建置獨立的編譯環境，這些 Jail 可以用來編譯與目前所在系統不同 FreeBSD 版本的套件，也同樣可以在主機為 amd64 的系統上編譯供 i386 使用的套件。套件編譯完成後的目錄配置會與官方鏡像站完全相同。這些套件可由 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg</span>(8)</span></a> 及其他套件管理工具使用。</p><p><span class="application">Poudriere</span> 可使用 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/poudriere/pkg-descr">ports-mgmt/poudriere</a> 套件或 Port 安裝。安裝完成後會有一個範例的設定檔 <code class="filename">/usr/local/etc/poudriere.conf.sample</code>。複製此檔案到 <code class="filename">/usr/local/etc/poudriere.conf</code>，編輯複製的檔案來配合本地的設定。</p><p>雖然在系統上執行 <span class="application">poudriere</span> 並不一定要使用 <acronym class="acronym">ZFS</acronym>，但使用了是有幫助的。當使用了 <acronym class="acronym">ZFS</acronym>，則必須在 <code class="filename">/usr/local/etc/poudriere.conf</code> 指定 <code class="varname">ZPOOL</code> 以及 <code class="varname">FREEBSD_HOST</code> 應設定到一個最近的鏡像站。定義 <code class="varname">CCACHE_DIR</code> 可開啟使用 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/devel/ccache/pkg-descr">devel/ccache</a> 快取的功能來快取編譯結果並減少那些需時常編譯的程式碼的編譯次數。將 <span class="application">poudriere</span> 資料集放到一個獨立的目錄並掛載到 <code class="filename">/poudriere</code> 可能會比較方便，其他設定項目採用預設值便足夠。</p><p>偵測到的處理器數量可用來定義要同時執行多少個編譯。並給予足夠的虛擬記憶體，不論是 <acronym class="acronym">RAM</acronym> 或交換空間，若虛擬記憶體不足，編譯 Jail 的動作將會停止並被清除，會造成奇怪的錯誤訊息。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="poudriere-initialization"></a>4.6.1. 初始化 Jail 與 Port 樹</h3></div></div></div><p>在設定之後，初始化 <span class="application">poudriere</span> 來安裝 Jail 及其所需的 FreeBSD 樹與 Port 樹。使用 <code class="option">-j</code> 來指定 Jail 的名稱以及 <code class="option">-v</code> 來指定 FreeBSD 的版本。在執行 FreeBSD/amd64 的系統上可使用 <code class="option">-a</code> 來設定要使用的架構為 <code class="literal">i386</code> 或 <code class="literal">amd64</code>，預設會採用使用 <code class="command">uname</code> 所顯示的架構。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>poudriere jail -c -j <em class="replaceable"><code>10amd64</code></em> -v <em class="replaceable"><code>10.0-RELEASE</code></em></code></strong>
====&gt;&gt; Creating 10amd64 fs... done
====&gt;&gt; Fetching base.txz for FreeBSD 10.0-RELEASE amd64
/poudriere/jails/10amd64/fromftp/base.txz      100% of   59 MB 1470 kBps 00m42s
====&gt;&gt; Extracting base.txz... done
====&gt;&gt; Fetching src.txz for FreeBSD 10.0-RELEASE amd64
/poudriere/jails/10amd64/fromftp/src.txz       100% of  107 MB 1476 kBps 01m14s
====&gt;&gt; Extracting src.txz... done
====&gt;&gt; Fetching games.txz for FreeBSD 10.0-RELEASE amd64
/poudriere/jails/10amd64/fromftp/games.txz     100% of  865 kB  734 kBps 00m01s
====&gt;&gt; Extracting games.txz... done
====&gt;&gt; Fetching lib32.txz for FreeBSD 10.0-RELEASE amd64
/poudriere/jails/10amd64/fromftp/lib32.txz     100% of   14 MB 1316 kBps 00m12s
====&gt;&gt; Extracting lib32.txz... done
====&gt;&gt; Cleaning up... done
====&gt;&gt; Jail 10amd64 10.0-RELEASE amd64 is ready to be used</pre><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>poudriere ports -c -p <em class="replaceable"><code>local</code></em></code></strong>
====&gt;&gt; Creating local fs... done
====&gt;&gt; Extracting portstree "local"...
Looking up portsnap.FreeBSD.org mirrors... 7 mirrors found.
Fetching public key from ec2-eu-west-1.portsnap.freebsd.org... done.
Fetching snapshot tag from ec2-eu-west-1.portsnap.freebsd.org... done.
Fetching snapshot metadata... done.
Fetching snapshot generated at Tue Feb 11 01:07:15 CET 2014:
94a3431f0ce567f6452ffde4fd3d7d3c6e1da143efec76100% of   69 MB 1246 kBps 00m57s
Extracting snapshot... done.
Verifying snapshot integrity... done.
Fetching snapshot tag from ec2-eu-west-1.portsnap.freebsd.org... done.
Fetching snapshot metadata... done.
Updating from Tue Feb 11 01:07:15 CET 2014 to Tue Feb 11 16:05:20 CET 2014.
Fetching 4 metadata patches... done.
Applying metadata patches... done.
Fetching 0 metadata files... done.
Fetching 48 patches.
(48/48) 100.00%  done.
done.
Applying patches...
done.
Fetching 1 new ports or files... done.
/poudriere/ports/tester/CHANGES
/poudriere/ports/tester/COPYRIGHT

[...]

Building new INDEX files... done.</pre><p>在一台電腦，<span class="application">poudriere</span> 可使用多組設定在多個 Jail 編譯來自不同 Port 樹的 Port。用來定義這些組合的自訂設定稱作 <span class="emphasis"><em>sets</em></span>，可在安裝 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/poudriere/pkg-descr">ports-mgmt/poudriere</a> 或 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/poudriere-devel/pkg-descr">ports-mgmt/poudriere-devel</a> 後參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=poudriere&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">poudriere</span>(8)</span></a> 中的 CUSTOMIZATION 章節來取得詳細的資訊。</p><p>在此處示範的基本設定放了單一個 jail-, port- 以及 set- 特定的 <code class="filename">make.conf</code> 在 <code class="filename">/usr/local/etc/poudriere.d</code>。在此範例使用的檔案名稱由 Jail 名稱、Port 名稱以及 set 名稱所組成：<code class="filename"><em class="replaceable"><code>10amd64-local-workstation</code></em>-make.conf</code>。系統 <code class="filename">make.conf</code> 與這個新的檔案在編譯時期會被合併為編譯 Jail 要使用的 <code class="filename">make.conf</code>。</p><p>要編譯的套件會輸入到 <code class="filename"><em class="replaceable"><code>10amd64-local-workstation</code></em>-pkglist</code>：</p><pre xml:lang="en" class="programlisting" lang="en">editors/emacs
devel/git
ports-mgmt/pkg
...</pre><p>可使用以下方式設定選項及相依：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>poudriere options -j <em class="replaceable"><code>10amd64</code></em> -p <em class="replaceable"><code>local</code></em> -z <em class="replaceable"><code>workstation</code></em> -f <em class="replaceable"><code>10amd64-local-workstation-pkglist</code></em></code></strong></pre><p>最後，編譯套件並建立套件檔案庫：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>poudriere bulk -j <em class="replaceable"><code>10amd64</code></em> -p <em class="replaceable"><code>local</code></em> -z <em class="replaceable"><code>workstation</code></em> -f <em class="replaceable"><code>10amd64-local-workstation-pkglist</code></em></code></strong></pre><p>在執行時，按下 <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>t</strong></span> 可以顯示目前編譯的狀態，<span class="application">Poudriere</span> 也會編譯在 <code class="filename">/poudriere/logs/bulk/<em class="replaceable"><code>jailname</code></em></code> 中的檔案，可用在網頁伺服器來顯示編譯資訊。</p><p>完成之後，新套件現在可以從 <span class="application">poudriere</span> 檔案庫來安裝。</p><p>要取得更多使用 <span class="application">poudriere</span> 的資訊，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=poudriere&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">poudriere</span>(8)</span></a> 及主網站 <a class="link" href="https://github.com/freebsd/poudriere/wiki" target="_top">https://github.com/freebsd/poudriere/wiki</a>。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp66422200"></a>4.6.2. 設定 pkg 客戶端使用 Poudriere 檔案庫</h3></div></div></div><p>雖然可以同時使用自訂的檔案庫與官方檔案庫，但有時關閉官方檔案庫會有幫助。這可以透過建立一個設定檔覆蓋並關閉官方的設定檔來完成。建立 <code class="filename">/usr/local/etc/pkg/repos/FreeBSD.conf</code> 包含以下內容：</p><pre xml:lang="en" class="programlisting" lang="en">FreeBSD: {
	enabled: no
}</pre><p>通常最簡單要提供 poudriere 檔案庫給客戶端的方式是透過 HTTP。安裝一個網頁伺服器來提供套件目錄，通常會像：<code class="filename">/usr/local/poudriere/data/packages/<em class="replaceable"><code>10amd64</code></em></code>，其中 <code class="filename">10amd64</code> 是編譯的名稱。</p><p>若要連往套件檔案庫的 URL 是：<code class="literal">http://pkg.example.com/10amd64</code>，則在 <code class="filename">/usr/local/etc/pkg/repos/custom.conf</code> 的檔案庫設定檔為：</p><pre xml:lang="en" class="programlisting" lang="en">custom: {
	url: "<em class="replaceable"><code>http://pkg.example.com/10amd64</code></em>",
	enabled: yes,
}</pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ports-nextsteps"></a>4.7. 安裝後的注意事項</h2></div></div></div><p>不論軟體是從套件或 Port 安裝，大部份的第三方應用程式安裝完後需要做某種程度的設定，下列指令與位置可以用來協助找到應用程式安裝了什麼。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>大部份應用程式安裝會在 <code class="filename">/usr/local/etc</code> 安裝至少一個預設的設定檔，若應用程式有大量設定檔的時則會建立一個子目錄來存放這些設定檔。範例的設定檔案名稱通常使用 <code class="filename">.sample</code> 結尾，設定檔應要仔細查看並可能要做一些編輯讓設定檔符合系統的需求，要編輯設定檔範本前需先複製該檔案並去除 <code class="filename">.sample</code> 副檔名。</p></li><li class="listitem"><p>應用程式提供的文件會安裝到 <code class="filename">/usr/local/share/doc</code>，且許多應用程式也同時會安裝操作手冊，在繼續使用應用程式前應先查看這些文件。</p></li><li class="listitem"><p>部份應用程式會以服務的方式執行，在啟動應用程式前前需要加入設定到 <code class="filename">/etc/rc.conf</code>。這些應用程式通常會安裝啟動 Script 到 <code class="filename">/usr/local/etc/rc.d</code>，請參考 <a class="link" href="#configtuning-starting-services" title="11.2. 啟動服務">啟動服務</a> 來取得更多資訊。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">依設計，應用程式不會在安裝時執行其啟動 Script，也不會在解除安裝或升級時執行其中止 Script，這留給各系統的管理者去做決定。</p></div></li><li class="listitem"><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=csh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">csh</span>(1)</span></a> 的使用者應要執行 <code class="command">rehash</code> 來更新已知 Binary 清單到 Shell 的 <code class="envar">PATH</code>。</p></li><li class="listitem"><p>使用 <code class="command">pkg info</code> 來了解應用程式安裝了那些檔案、操作手冊以及 Binary。</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ports-broken"></a>4.8. 處理損壞的 Port</h2></div></div></div><p>當發現某個 Port 無法順利編譯或安裝，可以嘗試以下幾種方法解決：</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>搜尋 <a class="link" href="../../../../support.html" target="_top">問題回報資料庫</a> 看該 Port 有沒有待審核的修正，若有的話可以使用該修正來修正問題。</p></li><li class="listitem"><p>尋求維護人員的協助，在 Port Skeleton 目錄中輸入 <code class="command">make maintainer</code> 或閱讀 Port 的 <code class="filename">Makefile</code> 來取得維護人員的電子郵件位址。寄給維護人員的郵件內容請記得要包含 Port 的 <code class="filename">Makefile</code> 中的 <code class="literal">$FreeBSD:</code> 一整行及輸出的錯誤訊息。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">有一些 Port 並非由個人維護，而是由 <a class="link" href="../../../../doc/en_US.ISO8859-1/articles/mailing-list-faq/article.html" target="_top">郵遞論壇</a> 維護，有許多，但並非全部，只要郵件地址長的像 <code class="email">&lt;freebsd-listname@FreeBSD.org&gt;</code> 都是，寄信時記得代入實際的論壇名稱。</p><p xmlns="http://www.w3.org/1999/xhtml">尤其是由 <code class="email">&lt;ports@FreeBSD.org&gt;</code> 所維護的  Port  都不是由特定個人維護，而該 Port 的修正與支援都是來自訂閱該郵遞論壇的一般社群所提供，我們隨時歡迎志工參與!</p></div><p>若寄信後沒有取得任何回應，可以依照 <a class="link" href="../../../../doc/en_US.ISO8859-1/articles/problem-reports/article.html" target="_top">撰寫 FreeBSD 問題回報</a> 的說明使用 Bugzilla 提出問題回報。</p></li><li class="listitem"><p>自行修正看看！<a class="link" href="../../../../doc/en_US.ISO8859-1/books/porters-handbook/index.html" target="_top">Porter's Handbook</a> 中含有 Port 基礎架構的詳細資訊，可提供資訊讓您可修正偶然損壞的 Port 或甚至您可以提交之自己的 Port！</p></li><li class="listitem"><p>依照 <a class="xref" href="#pkgng-intro" title="4.4. 使用 pkg 管理 Binary 套件">節 4.4, “使用 <span class="application">pkg</span> 管理 Binary 套件”</a> 中的說明安裝 Binary 套件，替代使用 Port 安裝。</p></li></ol></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x11"></a>章 5. X Window 系統</h2></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#x11-synopsis">5.1. 概述</a></span></dt><dt><span class="sect1"><a href="#x-understanding">5.2. 術語</a></span></dt><dt><span class="sect1"><a href="#x-install">5.3. 安裝 <span class="application">Xorg</span></a></span></dt><dt><span class="sect1"><a href="#x-config">5.4. <span class="application">Xorg</span> 設定</a></span></dt><dd><dl><dt><span class="sect2"><a href="#x-config-quick-start">5.4.1. 快速開始</a></span></dt><dt><span class="sect2"><a href="#x-config-user-group">5.4.2. 可加速影像處理的使用者群組</a></span></dt><dt><span class="sect2"><a href="#x-config-kms">5.4.3. 核心模式設定 (Kernel Mode Setting, <acronym class="acronym">KMS</acronym>)</a></span></dt><dt><span class="sect2"><a href="#x-config-files">5.4.4. 設定檔</a></span></dt><dd><dl><dt><span class="sect3"><a href="#x-config-files-directory">5.4.4.1. 目錄</a></span></dt><dt><span class="sect3"><a href="#x-config-files-single-or-multi">5.4.4.2. 單檔或多檔</a></span></dt></dl></dd><dt><span class="sect2"><a href="#x-config-video-cards">5.4.5. 顯示卡</a></span></dt><dt><span class="sect2"><a href="#x-config-monitors">5.4.6. 顯示器</a></span></dt><dt><span class="sect2"><a href="#x-config-input">5.4.7. 輸入裝置</a></span></dt><dd><dl><dt><span class="sect3"><a href="#x-config-input-keyboard">5.4.7.1. 鍵盤</a></span></dt><dt><span class="sect3"><a href="#x11-input-mice">5.4.7.2. 滑鼠與指標裝置</a></span></dt></dl></dd><dt><span class="sect2"><a href="#x-config-manual-configuration">5.4.8. 手動設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#x-fonts">5.5. 在 <span class="application">Xorg</span> 使用字型</a></span></dt><dd><dl><dt><span class="sect2"><a href="#type1">5.5.1. Type1 字型</a></span></dt><dt><span class="sect2"><a href="#truetype">5.5.2. <span class="trademark">TrueType</span>® 字型</a></span></dt><dt><span class="sect2"><a href="#antialias">5.5.3. 反鋸齒字型</a></span></dt></dl></dd><dt><span class="sect1"><a href="#x-xdm">5.6. X 顯示管理程式</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67045048">5.6.1. 設定 <span class="application">XDM</span></a></span></dt><dt><span class="sect2"><a href="#idp67086904">5.6.2. 設定遠端存取</a></span></dt></dl></dd><dt><span class="sect1"><a href="#x11-wm">5.7. 桌面環境</a></span></dt><dd><dl><dt><span class="sect2"><a href="#x11-wm-gnome">5.7.1. GNOME</a></span></dt><dt><span class="sect2"><a href="#x11-wm-kde">5.7.2. KDE</a></span></dt><dt><span class="sect2"><a href="#x11-wm-xfce">5.7.3. Xfce</a></span></dt></dl></dd><dt><span class="sect1"><a href="#x-compiz-fusion">5.8. 安裝 Compiz Fusion</a></span></dt><dd><dl><dt><span class="sect2"><a href="#x-compiz-video-card">5.8.1. 設定 FreeBSD nVidia 驅動程式</a></span></dt><dt><span class="sect2"><a href="#xorg-configuration">5.8.2. 設定 xorg.conf 來啟動桌面特效</a></span></dt><dt><span class="sect2"><a href="#compiz-fusion">5.8.3. 安裝與設定 Compiz Fusion</a></span></dt></dl></dd><dt><span class="sect1"><a href="#x11-understanding">5.9. 疑難排解</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67319352">5.9.1. 設定 <span class="trademark">Intel</span>® <code class="literal">i810</code> 繪圖晶片組</a></span></dt><dt><span class="sect2"><a href="#idp67330744">5.9.2. 加入寬螢幕平板顯示器到設定檔</a></span></dt><dt><span class="sect2"><a href="#compiz-troubleshooting">5.9.3. Compiz Fusion 疑難排解</a></span></dt></dl></dd></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="x11-synopsis"></a>5.1. 概述</h2></div></div></div><p>使用 <span class="application">bsdinstall</span> 安裝 FreeBSD 並不會自動安裝圖型化使用者介面。本章將說明如何安裝並設定 <span class="application">Xorg</span>，該應用程式提供開放源碼的 X Window 系統來提供圖型化環境。接著會說明如何找到並安裝桌面環境或視窗管理程式。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">偏好安裝時會自動設定 <span class="application">Xorg</span> 並且在安裝過程提供視窗管理程式選項的使用者請參考 <a class="link" href="http://www.trueos.org/" target="_top">http://www.trueos.org/</a> 網站。</p></div><p>更多有關 <span class="application">Xorg</span> 支援影像硬體資訊，請參考 <a class="link" href="http://www.x.org/" target="_top">x.org</a> 網站。</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>組成 X Window 系統的各種元件以及它們是如何相互運作。</p></li><li class="listitem"><p>如何安裝並設定 <span class="application">Xorg</span>。</p></li><li class="listitem"><p>如何安裝並設定各種視窗管理程式與桌面環境。</p></li><li class="listitem"><p>如何在 <span class="application">Xorg</span> 上使用 <span class="trademark">TrueType</span>® 字型。</p></li><li class="listitem"><p>如何設定系統以使用圖形化登入 (<span class="application">XDM</span>)。</p></li></ul></div><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>了解如何依照 <a class="xref" href="#ports" title="章 4. 安裝應用程式：套件與 Port">章 4, <em>安裝應用程式：套件與 Port</em></a> 說明安裝其他第三方軟體。</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="x-understanding"></a>5.2. 術語</h2></div></div></div><p>雖然 X 各元件的所有細節及運作方式，並不是必須要知道的。 但對它們有些基本概念會更容易上手。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">X 伺服器 (X Server)</span></dt><dd><p>X 最初設計是以網路為中心，採用 <span class="quote">“<span class="quote">client-server</span>”</span> 架構。在此架構下 <span class="quote">“<span class="quote">X 伺服器</span>”</span> 在有鍵盤、螢幕、滑鼠的電腦上運作。該伺服器負責的工作包含管理顯示、處理來自鍵盤、滑鼠的輸入及來自其他設備 (如平板或或影像投影機) 的輸入或輸出。這點可能會讓人感到困惑，因為 X 使用的術語與一般的認知剛好相反。 一般認知會以為 <span class="quote">“<span class="quote">X 伺服器</span>”</span> 是要在最強悍的主機上執行，而 <span class="quote">“<span class="quote">X 客戶端</span>”</span> 才是在桌機上面執行，實際上卻是相反。</p></dd><dt><span class="term">X 客戶端 (X Client)</span></dt><dd><p>每個 X 應用程式，如 <span class="application">XTerm</span>、<span class="application">Firefox</span> 都是 <span class="quote">“<span class="quote">客戶端</span>”</span>。 客戶端會傳訊息到伺服器，例如：<span class="quote">“<span class="quote">請在這些座標畫一個視窗</span>”</span>，接著伺服器會傳回訊息，如：<span class="quote">“<span class="quote">使用者剛點選了確定按鈕</span>”</span>。</p><p>在家庭或小型辦公室環境，通常 X 伺服器跟 X 客戶端都是在同一台電腦上執行。也可以在比較慢的電腦上執行 X 伺服器， 並在比較強、比較貴的系統上執行 X 應用程式。 在這種情景，X 客戶端與伺服器之間的溝通就需透過網路來進行。</p></dd><dt><span class="term">視窗管理程式 (Window Manager)</span></dt><dd><p>X 並不規定螢幕上的視窗該長什麼樣、要如何移動滑鼠指標、 要用什麼鍵來在視窗切換、每個視窗的標題列長相，及是否該有關閉按鈕，等等。事實上，X 把這部分交給所謂的視窗管理程式來管理。可用的<a class="link" href="http://www.xwinman.org/" target="_top">視窗管理程式有很多種</a>，每一種視窗管理程式都提供不同的使用介面風格：有些支援虛擬桌面，有些允許自訂組合鍵來管理桌面，有些有 <span class="quote">“<span class="quote">開始</span>”</span> 鈕，有些則是可更換佈景主題，可自行安裝新的佈景主題以更換外觀。 視窗管理程式可在 Port 套件集的 <code class="filename">x11-wm</code> 分類找到。</p><p>每個視窗管理程式也各有其不同的設定機制，有些需要手動修改設定檔， 而有的則可透過圖型化工具來完成大部分的設定工作。</p></dd><dt><span class="term">桌面環境 (Desktop Environment)</span></dt><dd><p><span class="application">KDE</span> 與 <span class="application">GNOME</span> 會被稱作桌面環境是因為包含了完整常用桌面作業的應用程式，這些應用程式可能包含文書軟體、網頁瀏覽器及遊戲。</p></dd><dt><span class="term">聚焦政策 (Focus Policy)</span></dt><dd><p>視窗管理程式負責滑鼠指標的聚焦政策。 聚焦政策指的是如何決定使用中及接收鍵盤輸入的視窗。</p><p>通常較為人熟悉的聚焦政策叫做 <span class="quote">“<span class="quote">click-to-focus</span>”</span>，這個模式中，滑鼠點選到的視窗便會處於作用中 (Active) 的狀態。在 <span class="quote">“<span class="quote">focus-follows-mouse</span>”</span> 模式滑鼠指標所在的視窗便是作用中的視窗，只要把滑鼠移到其他視窗就可以改變作用中的視窗，若滑鼠移到根視窗 (Root Window)，則會聚焦在根視窗。在 <span class="quote">“<span class="quote">sloppy-focus</span>”</span> 模式，既使滑鼠移到根視窗，仍然會聚焦在最後聚焦的視窗上，此模式只有當滑鼠進入新的視窗時才會聚焦於該視窗，而非離開目前視窗時。<span class="quote">“<span class="quote">click-to-focus</span>”</span> 模式用滑鼠點擊來決定作用中的視窗，且該視窗會被置頂到所有其他視窗之前，即使滑鼠移到其他視窗，所有的鍵盤輸入仍會由該視窗所接收。</p><p>不同的視窗管理程式支援不同的聚焦模式，全部都支援 click-to-focus 且其中大部份支援其他模式，請查看視窗管理程式的說明文件來了解可用的聚焦模式。</p></dd><dt><span class="term">視窗元件 (Widget)</span></dt><dd><p>視窗元件指的是在所有在使用者介面上可被點選或操作的項目，這包括按鈕、核選方塊、單選按鈕、圖示及清單。 視窗元件工具包 (Widget toolkit) 是指用來建立圖型化應用程式的一系列的視窗元件。目前有數個有名的視窗元件工具包，包含 <span class="application">KDE</span> 所使用的 Qt、<span class="application">GNOME</span> 所使用的 GTK+。 因此應用程式會依其開發時所選用的視窗元件工具包而有不同的外觀。</p></dd></dl></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="x-install"></a>5.3. 安裝 <span class="application">Xorg</span></h2></div></div></div><p>在 FreeBSD，<span class="application">Xorg</span> 可透過套件或 Port 來安裝。</p><p>使用 Binary 套件的安裝速度較快，但可用的自訂選項較少：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install xorg</code></strong></pre><p>要從 Port 套件集編譯與安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/x11/xorg</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>兩種安裝方式皆可完整安裝 <span class="application">Xorg</span> 系統，對大多數使用者較建議使用 Binary 套件安裝。</p><p>較精簡版本的 X 系統適合給有經驗的使用者使用，可至 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11/xorg-minimal/pkg-descr">x11/xorg-minimal</a> 取得。這個版本就不會安裝大多數的文件、函數庫以及應用程式，而部份應用程式會需要這些額外的元件才能運作。</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="x-config"></a>5.4. <span class="application">Xorg</span> 設定</h2></div><div><span xmlns="http://www.w3.org/1999/xhtml" class="personname"><span class="firstname">Warren</span> <span class="surname">Block</span></span></div></div></div><a id="idp66540472" class="indexterm"></a><a id="idp66541112" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-quick-start"></a>5.4.1. 快速開始</h3></div></div></div><p><span class="application">Xorg</span> 支援大多數常見的顯示卡、鍵盤以及指標裝置。</p><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml">顯示卡、顯示器以及輸入裝置會自動偵測，無須任何手動設置。除非自動設置失敗，否則請勿建立 <code class="filename">xorg.conf</code> 或執行 <code class="option">-configure</code> 步驟。</p></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>若 <span class="application">Xorg</span> 曾經在電腦使用過，可先將現有的設定檔重新命名或移除：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mv /etc/X11/xorg.conf ~/xorg.conf.etc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv /usr/local/etc/X11/xorg.conf ~/xorg.conf.localetc</code></strong></pre></li><li class="step"><p>加入要執行 <span class="application">Xorg</span> 的使用者到 <code class="literal">video</code> 或 <code class="literal">wheel</code> 群組，以便在可用時能開啟 3D 加速。要加入使用者 <em class="replaceable"><code>jru</code></em> 到任一個可用的群組：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pw groupmod video -m <em class="replaceable"><code>jru</code></em> || pw groupmod wheel -m <em class="replaceable"><code>jru</code></em></code></strong></pre></li><li class="step"><p>預設內含 <acronym class="acronym">TWM</acronym> 視窗管理程式，啟動 <span class="application">Xorg</span> 時便會啟動該視窗管理程式：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>startx</code></strong></pre></li><li class="step"><p>在部份較舊版的 FreeBSD，在切換回文字 Console 前系統 Console 必須設為 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vt&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vt</span>(4)</span></a> 才可正常運作，請參考 <a class="xref" href="#x-config-kms" title="5.4.3. 核心模式設定 (Kernel Mode Setting, KMS)">節 5.4.3, “核心模式設定 (Kernel Mode Setting, <acronym class="acronym">KMS</acronym>)”</a>。</p></li></ol></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-user-group"></a>5.4.2. 可加速影像處理的使用者群組</h3></div></div></div><p>要存取 <code class="filename">/dev/dri</code> 需要允許顯示卡的 3D 加速功能，這通常只需要將要執行 X 的使用者加入 <code class="literal">video</code> 或 <code class="literal">wheel</code> 群組。此處使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a> 來將使用者 <em class="replaceable"><code>slurms</code></em> 加入 <code class="literal">video</code> 群組，若沒有 <code class="literal">video</code> 則會加入 <code class="literal">wheel</code> 群組：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pw groupmod video -m <em class="replaceable"><code>slurms</code></em> || pw groupmod wheel -m <em class="replaceable"><code>slurms</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-kms"></a>5.4.3. 核心模式設定 (Kernel Mode Setting, <acronym class="acronym">KMS</acronym>)</h3></div></div></div><p>當電腦顯示從 Console 切換到高螢幕解析度供 X 使用時，必須設定影像輸出<span class="emphasis"><em>模式</em></span>。最近版本的 <acronym class="acronym">Xorg</acronym> 使用了核心內部的系統來讓切換模式更有效率。較舊版的 FreeBSD 使用的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sc&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sc</span>(4)</span></a> 並不知到 <acronym class="acronym">KMS</acronym> 系統的存在，這會導致關閉 X 之後即始仍在運作但系統 Console 卻呈現空白。較新版的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vt&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vt</span>(4)</span></a> Console 可避免這個問題。</p><p>加入此行到 <code class="filename">/boot/loader.conf</code> 來開啟 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vt&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vt</span>(4)</span></a>：</p><pre xml:lang="en" class="programlisting" lang="en">kern.vty=vt</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-files"></a>5.4.4. 設定檔</h3></div></div></div><p>通常不需要做手動設置，除非自動設置無法運作，否則請不要手動建立設定檔。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-files-directory"></a>5.4.4.1. 目錄</h4></div></div></div><p><span class="application">Xorg</span> 會查看數個目錄來尋找設定檔，在 FreeBSD 較建議使用 <code class="filename">/usr/local/etc/X11/</code> 來存放這些設定檔，使用這個目錄可以幫助將應用程式檔案與作業系統檔案分離。</p><p>儲存設定檔在傳統的 <code class="filename">/etc/X11/</code> 仍可運作，但並不建議將應用程式檔案與基礎 FreeBSD 檔案混合在一起存放。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-files-single-or-multi"></a>5.4.4.2. 單檔或多檔</h4></div></div></div><p>使用多檔，每一個檔案只設定一個指定項目會較傳統使用單一 <code class="filename">xorg.conf</code> 設定來的簡單。這些檔案會存放在主設定檔目錄下的 <code class="filename">xorg.conf.d/</code> 子目錄，完整路徑通常為 <code class="filename">/usr/local/etc/X11/xorg.conf.d/</code>。</p><p>於本節稍後會有這些檔案的範例。</p><p>傳統單一 <code class="filename">xorg.conf</code> 的方式仍可運作，但比起在 <code class="filename">xorg.conf.d/</code> 子目錄中的多檔設定方式較不明瞭且沒有彈性。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-video-cards"></a>5.4.5. 顯示卡</h3></div></div></div><p>由於最近 FreeBSD 版本所做的變更，現在可以使用由 Port 或套件所提供的繪圖驅動程式，所以使用者可以使用下列來自 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/graphics/drm-kmod/pkg-descr">graphics/drm-kmod</a> 的驅動程式。</p><div class="variablelist"><dl class="variablelist"><dt><a id="x-config-video-cards-ports"></a><span class="term">Intel KMS 驅動程式, </span><span class="term">Radeon KMS 驅動程式, </span><span class="term">AMD KMS 驅動程式</span></dt><dd><p>大多數使用 Intel KMS 驅動程式的 Intel 顯示卡支援 2D 與 3D 加速。</p><p>驅動程式名稱：<code class="literal">i915kms</code></p><p>大多數使用 Radeon KMS 驅動程式的舊 AMD 顯示卡支援 2D 與 3D 加速。</p><p>驅動程式名稱：<code class="literal">radeonkms</code></p><p>大多數使用 AMD KMS 驅動程式的新 AMD 顯示卡支援 2D 與 3D 加速。</p><p>驅動程式名稱：<code class="literal">amdgpu</code></p><p>參考文獻請至 <a class="link" href="https://en.wikipedia.org/wiki/List_of_Intel_graphics_processing_units" target="_top">https://en.wikipedia.org/wiki/List_of_Intel_graphics_processing_units</a> 或至 <a class="link" href="https://en.wikipedia.org/wiki/List_of_AMD_graphics_processing_units" target="_top">https://en.wikipedia.org/wiki/List_of_AMD_graphics_processing_units</a> 取得支援的 GPU 清單。</p></dd><dt><a id="x-config-video-cards-intel"></a><span xml:lang="en" class="term" lang="en"><span class="trademark">Intel</span>®</span></dt><dd><p>3D 加速在大多數 <span class="trademark">Intel</span>® 顯示晶片都有支援，最新到 Ivy Bridge (HD Graphics 2500, 4000, 及 P4000) 包含 Iron Lake (HD Graphics) 與 Sandy Bridge (HD Graphics 2000)。</p><p>驅動程式名稱：<code class="literal">intel</code></p><p>參考文獻請至 <a class="link" href="https://en.wikipedia.org/wiki/List_of_Intel_graphics_processing_units" target="_top">https://en.wikipedia.org/wiki/List_of_Intel_graphics_processing_units</a>。</p></dd><dt><a id="x-config-video-cards-radeon"></a><span xml:lang="en" class="term" lang="en"><span class="trademark">AMD</span>® Radeon</span></dt><dd><p>Radeon 顯示卡支援 2D 及 3D 加速，最新到 HD6000 系列。</p><p>驅動程式名稱：<code class="literal">radeon</code></p><p>參考文獻請至 <a class="link" href="https://en.wikipedia.org/wiki/List_of_AMD_graphics_processing_units" target="_top">https://en.wikipedia.org/wiki/List_of_AMD_graphics_processing_units</a>。</p></dd><dt><a id="x-config-video-cards-nvidia"></a><span xml:lang="en" class="term" lang="en">NVIDIA</span></dt><dd><p>有數個 NVIDIA 驅動程式可於 Port 套件集中的 <code class="filename">x11</code> 分類取得，請安裝其中與顯示卡相符的驅動程式。</p><p>參考文獻請至 <a class="link" href="https://en.wikipedia.org/wiki/List_of_Nvidia_graphics_processing_units" target="_top">https://en.wikipedia.org/wiki/List_of_Nvidia_graphics_processing_units</a>。</p></dd><dt><a id="x-config-video-cards-hybrid"></a><span class="term">混合組合繪圖晶片</span></dt><dd><p>部份筆記型電腦加入了額外繪圖處理單元到那些內建晶片組或處理。<span class="emphasis"><em>Optimus</em></span> 結合了 <span class="trademark">Intel</span>® 及 NVIDIA 的硬體，<span class="emphasis"><em>Switchable Graphics</em></span> 或 <span class="emphasis"><em>Hybrid Graphics</em></span> 則是結合了 <span class="trademark">Intel</span>® 或 <span class="trademark">AMD</span>® 處理器與 <span class="trademark">AMD</span>® Radeon <acronym class="acronym">GPU</acronym>。</p><p>這些混合繪圖系統的實作方式均不同，FreeBSD 的 <span class="application">Xorg</span> 尚無法驅動所有的混合繪圖系統版本。</p><p>部份電腦提供了 <acronym class="acronym">BIOS</acronym> 的選項可以關閉其中一個繪圖介面卡或選擇 <span class="emphasis"><em>discrete</em></span> 模式，可用使用其中一種標準顯示卡驅動程式來驅動。例如，有時關閉 Optimus 系統中的 NVIDIA <acronym class="acronym">GPU</acronym> 是可能讓 <span class="trademark">Intel</span>® 顯示晶片可用 <span class="trademark">Intel</span>® 驅動程式驅動。</p><p><acronym class="acronym">BIOS</acronym> 設定會依電腦的型號有所不同，在某些情況下，可以同時開啟兩個 <acronym class="acronym">GPU</acronym>，而在建立的設定檔中的 <code class="literal">Device</code> 節只使用主要的 <acronym class="acronym">GPU</acronym> 便能讓系統運作。</p></dd><dt><a id="x-config-video-cards-other"></a><span class="term">其他顯示卡</span></dt><dd><p>較不常見的顯示卡驅動程式可在 Port 套件集的 <code class="filename">x11-drivers</code> 目錄找到。</p><p>若沒有特定的驅動程式可以支援顯示卡，仍可能可用 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11-drivers/xf86-video-vesa/pkg-descr">x11-drivers/xf86-video-vesa</a> 驅動程式來驅動。該驅動程式可使用 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11/xorg/pkg-descr">x11/xorg</a> 安裝，也可使用 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11-drivers/xf86-video-vesa/pkg-descr">x11-drivers/xf86-video-vesa</a> 手動安裝。當沒有指定驅動程式時 <span class="application">Xorg</span> 會嘗試使用這個驅動程式來驅動顯示卡。</p><p><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11-drivers/xf86-video-scfb/pkg-descr">x11-drivers/xf86-video-scfb</a> 也是不特定顯示卡的驅動程式，可在許多 <acronym class="acronym">UEFI</acronym> 及 <span class="trademark">ARM</span>® 的電腦上運作。</p></dd><dt><a id="x-config-video-cards-file"></a><span class="term">在檔案中設定影像驅動程式</span></dt><dd><p>要在設定檔設定使用 <span class="trademark">Intel</span>® 驅動程式：</p><div class="example"><a id="x-config-video-cards-file-intel"></a><div class="example-title">範例 5.1. 在單檔中選擇 <span class="trademark">Intel</span>® 影像驅動程式</div><div class="example-contents"><p xml:lang="en" lang="en"><code class="filename">/usr/local/etc/X11/xorg.conf.d/driver-intel.conf</code></p><pre xml:lang="en" class="programlisting" lang="en">Section "Device"
	Identifier "Card0"
	Driver     "intel"
	# BusID    "PCI:1:0:0"
EndSection</pre><p>若有多張顯示卡，可取消註解 <code class="literal">BusID</code> identifier 然後設定為想要的顯示卡，顯示卡的 Bus <acronym class="acronym">ID</acronym> 清單可以使用 <code class="command">pciconf -lv | grep -B3 display</code> 取得。</p></div></div><br class="example-break" /><p>要在設定檔設定使用 Radeon 驅動程式：</p><div class="example"><a id="x-config-video-cards-file-radeon"></a><div class="example-title">範例 5.2. 在單檔中選擇 Radeon 影像驅動程式</div><div class="example-contents"><p xml:lang="en" lang="en"><code class="filename">/usr/local/etc/X11/xorg.conf.d/driver-radeon.conf</code></p><pre xml:lang="en" class="programlisting" lang="en">Section "Device"
	Identifier "Card0"
	Driver     "radeon"
EndSection</pre></div></div><br class="example-break" /><p>要在設定檔設定使用 <acronym class="acronym">VESA</acronym> 驅動程式：</p><div class="example"><a id="x-config-video-cards-file-vesa"></a><div class="example-title">範例 5.3. 在單檔中選擇 <acronym class="acronym">VESA</acronym> 影像驅動程式</div><div class="example-contents"><p xml:lang="en" lang="en"><code class="filename">/usr/local/etc/X11/xorg.conf.d/driver-vesa.conf</code></p><pre xml:lang="en" class="programlisting" lang="en">Section "Device"
	Identifier "Card0"
	Driver     "vesa"
EndSection</pre></div></div><br class="example-break" /><p>要設定 <acronym class="acronym">UEFI</acronym> 或 <span class="trademark">ARM</span>® 電腦使用 <code class="literal">scfb</code> 驅動程式：</p><div class="example"><a id="x-config-video-cards-file-scfb"></a><div class="example-title">範例 5.4. 在單檔中選擇 <code class="literal">scfb</code> 影像驅動程式</div><div class="example-contents"><p xml:lang="en" lang="en"><code class="filename">/usr/local/etc/X11/xorg.conf.d/driver-scfb.conf</code></p><pre xml:lang="en" class="programlisting" lang="en">Section "Device"
	Identifier "Card0"
	Driver     "scfb"
EndSection</pre></div></div><br class="example-break" /></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-monitors"></a>5.4.6. 顯示器</h3></div></div></div><p>幾乎所有顯示器都支援延伸顯示辨識資料標準 (Extended Display Identification Data, <acronym class="acronym">EDID</acronym>)，<span class="application">Xorg</span> 會使用 <acronym class="acronym">EDID</acronym> 與顯示器通訊並偵測支援的解析度與更新頻率，然後選擇最適合的設定組合使用該顯示器。</p><p>其他顯示器支援的解析度可透過在設定檔中設定想要的解析度來選擇，或者在 X 伺服器啟動之後使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xrandr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xrandr</span>(1)</span></a>。</p><div class="variablelist"><dl class="variablelist"><dt><a id="x-config-monitors-xrandr"></a><span class="term">使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xrandr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xrandr</span>(1)</span></a></span></dt><dd><p>執行 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xrandr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xrandr</span>(1)</span></a> 不加任何參數可檢查影像輸出及已偵測到的顯示器模式清單：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>xrandr</code></strong>
Screen 0: minimum 320 x 200, current 3000 x 1920, maximum 8192 x 8192
DVI-0 connected primary 1920x1200+1080+0 (normal left inverted right x axis y axis) 495mm x 310mm
   1920x1200     59.95*+
   1600x1200     60.00
   1280x1024     85.02    75.02    60.02
   1280x960      60.00
   1152x864      75.00
   1024x768      85.00    75.08    70.07    60.00
   832x624       74.55
   800x600       75.00    60.32
   640x480       75.00    60.00
   720x400       70.08
DisplayPort-0 disconnected (normal left inverted right x axis y axis)
HDMI-0 disconnected (normal left inverted right x axis y axis)</pre><p>這個結果顯示 <code class="literal">DVI-0</code> 輸出被用來顯示解析度為 1920x1200 像素於更新頻率約 60 Hz 的畫面，未有顯示器連接到 <code class="literal">DisplayPort-0</code> 與 <code class="literal">HDMI-0</code> 接頭。</p><p>可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xrandr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xrandr</span>(1)</span></a> 來選擇任何其他的顯示模式。例如要切換為 1280x1024 於 60 Hz：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>xrandr --mode 1280x1024 --rate 60</code></strong></pre><p>在筆記型電腦使用外部顯示輸出到投影機是常見的作業。</p><p>不同裝置間輸出接頭的類型與數量也不同，給每個輸出的名稱在不同驅動程式間也不同。在某些驅動程式稱為 <code class="literal">HDMI-1</code> 的輸出在其他驅動程式則可能稱為 <code class="literal">HDMI1</code>。因此第一個步驟是執行 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xrandr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xrandr</span>(1)</span></a> 列出所有可用的輸出：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>xrandr</code></strong>
Screen 0: minimum 320 x 200, current 1366 x 768, maximum 8192 x 8192
LVDS1 connected 1366x768+0+0 (normal left inverted right x axis y axis) 344mm x 193mm
   1366x768      60.04*+
   1024x768      60.00
   800x600       60.32    56.25
   640x480       59.94
VGA1 connected (normal left inverted right x axis y axis)
   1280x1024     60.02 +  75.02
   1280x960      60.00
   1152x864      75.00
   1024x768      75.08    70.07    60.00
   832x624       74.55
   800x600       72.19    75.00    60.32    56.25
   640x480       75.00    72.81    66.67    60.00
   720x400       70.08
HDMI1 disconnected (normal left inverted right x axis y axis)
DP1 disconnected (normal left inverted right x axis y axis)</pre><p>已找到四個輸出：內建面板的 <code class="literal">LVDS1</code>，外接的 <code class="literal">VGA1</code>, <code class="literal">HDMI1</code> 以及 <code class="literal">DP1</code> 接頭。</p><p>投影機已連接至 <code class="literal">VGA1</code> 輸出，現在使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xrandr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xrandr</span>(1)</span></a> 來設定該輸出到投影機 (原始解析度) 並加入額外的空間到桌面的右側：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>xrandr --output VGA1 --auto --right-of LVDS1</code></strong></pre><p><code class="literal">--auto</code> 會選擇使用 <acronym class="acronym">EDID</acronym> 偵測到的解析度與更新頻率。若未正確偵測解析度，可替換 <code class="literal">--auto</code> 為 <code class="literal">--mode</code> 然後給予固定值。例如大部份的投影機可使用 1024x768 解析度為，則可設定 <code class="literal">--mode 1024x768</code>。</p><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xrandr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xrandr</span>(1)</span></a> 通常會在 <code class="filename">.xinitrc</code> 執行以在 X 啟動時設定適合的模式。</p></dd><dt><a id="x-config-monitors-files"></a><span class="term">在檔案中設定螢幕解析度</span></dt><dd><p>在設定檔設定螢幕解析度為 1024x768：</p><div class="example"><a id="idp66784952"></a><div class="example-title">範例 5.5. 在單檔中設定螢幕解析度</div><div class="example-contents"><p xml:lang="en" lang="en"><code class="filename">/usr/local/etc/X11/xorg.conf.d/screen-resolution.conf</code></p><pre xml:lang="en" class="programlisting" lang="en">Section "Screen"
	Identifier "Screen0"
	Device     "Card0"
	SubSection "Display"
	Modes      "1024x768"
	EndSubSection
EndSection</pre></div></div><br class="example-break" /><p>少數顯示器沒有 <acronym class="acronym">EDID</acronym>，可設定 <code class="literal">HorizSync</code> 及 <code class="literal">VertRefresh</code> 為顯示器支援的頻率範圍。</p><div class="example"><a id="idp66788408"></a><div class="example-title">範例 5.6. 手動設定顯示器頻率</div><div class="example-contents"><p xml:lang="en" lang="en"><code class="filename">/usr/local/etc/X11/xorg.conf.d/monitor0-freq.conf</code></p><pre xml:lang="en" class="programlisting" lang="en">Section "Monitor"
	Identifier   "Monitor0"
	HorizSync    30-83   # kHz
	VertRefresh  50-76   # Hz
EndSection</pre></div></div><br class="example-break" /></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-input"></a>5.4.7. 輸入裝置</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-input-keyboard"></a>5.4.7.1. 鍵盤</h4></div></div></div><div class="variablelist"><dl class="variablelist"><dt><a id="x-config-input-keyboard-layout"></a><span class="term">鍵盤配置</span></dt><dd><p>鍵盤上標準按鍵的位置稱做 <span class="emphasis"><em>配置 (Layout)</em></span>。配置與其他可調整的參數列於 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xkeyboard-config&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xkeyboard-config</span>(7)</span></a>。</p><p>預設為 United States 配置，要選擇其他的配置可在 <code class="literal">InputClass</code> 設定 <code class="literal">XkbLayout</code> 與 <code class="literal">XkbVariant</code> 選項。這會套用所有符合該類別的輸入裝置。</p><p>這個例子選擇 French 鍵盤配置使用 <code class="literal">oss</code> 變體。</p><div class="example"><a id="idp66810040"></a><div class="example-title">範例 5.7. 設定鍵盤配置</div><div class="example-contents"><p xml:lang="en" lang="en"><code class="filename">/usr/local/etc/X11/xorg.conf.d/keyboard-fr-oss.conf</code></p><pre xml:lang="en" class="programlisting" lang="en">Section	"InputClass"
	Identifier	"KeyboardDefaults"
	Driver		"keyboard"
	MatchIsKeyboard	"on"
	Option		"XkbLayout" "fr"
	Option		"XkbVariant" "oss"
EndSection</pre></div></div><br class="example-break" /><div class="example"><a id="idp66811960"></a><div class="example-title">範例 5.8. 設定多個鍵盤配置</div><div class="example-contents"><p>設定 United States, Spanish 與 Ukrainian 鍵盤配置，並可按 <span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>Shift</strong></span> 來切換這些配置。可使用 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11/xxkb/pkg-descr">x11/xxkb</a> 或 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11/sbxkb/pkg-descr">x11/sbxkb</a> 來加強配置切換控制與目前配置的指示。</p><p xml:lang="en" lang="en"><code class="filename">/usr/local/etc/X11/xorg.conf.d/kbd-layout-multi.conf</code></p><pre xml:lang="en" class="programlisting" lang="en">Section	"InputClass"
	Identifier	"All Keyboards"
	MatchIsKeyboard	"yes"
	Option		"XkbLayout" "us, es, ua"
EndSection</pre></div></div><br class="example-break" /></dd><dt><a id="x-config-input-keyboard-zap"></a><span class="term">從鍵盤關閉 <span class="application">Xorg</span></span></dt><dd><p>X 可以使用組合鍵來關閉，預設並未設定組合鍵，因為該組合鍵與部份應用程式的鍵盤指令衝突。要開啟這個選項需要更改鍵盤 <code class="literal">InputDevice</code> 節：</p><div class="example"><a id="idp66818744"></a><div class="example-title">範例 5.9. 開啟鍵盤離開 X 功能</div><div class="example-contents"><p xml:lang="en" lang="en"><code class="filename">/usr/local/etc/X11/xorg.conf.d/keyboard-zap.conf</code></p><pre xml:lang="en" class="programlisting" lang="en">Section	"InputClass"
	Identifier	"KeyboardDefaults"
	Driver		"keyboard"
	MatchIsKeyboard	"on"
	Option		"XkbOptions" "terminate:ctrl_alt_bksp"
EndSection</pre></div></div><br class="example-break" /></dd></dl></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x11-input-mice"></a>5.4.7.2. 滑鼠與指標裝置</h4></div></div></div><p>有許多滑鼠參數可使用設定選項來調整，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mousedrv&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mousedrv</span>(4)</span></a> 來取得完整清單。</p><div class="variablelist"><dl class="variablelist"><dt><a id="x11-input-mice-buttons"></a><span class="term">滑鼠按鍵</span></dt><dd><p>滑鼠的按鍵數可在 <code class="filename">xorg.conf</code> 的滑鼠 <code class="literal">InputDevice</code> 節設定，例如要設定按鍵數為 7：</p><div class="example"><a id="idp66846136"></a><div class="example-title">範例 5.10. 設定滑鼠按鍵數</div><div class="example-contents"><p xml:lang="en" lang="en"><code class="filename">/usr/local/etc/X11/xorg.conf.d/mouse0-buttons.conf</code></p><pre xml:lang="en" class="programlisting" lang="en">Section "InputDevice"
	Identifier  "Mouse0"
	Option      "Buttons" "7"
EndSection</pre></div></div><br class="example-break" /></dd></dl></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-manual-configuration"></a>5.4.8. 手動設定</h3></div></div></div><p>在某些情況 <span class="application">Xorg</span> 的自動設定無法在特定硬體上運作，或需要使用不同的設定。針對這些情況會建立自訂的設定檔。</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">非必要請勿手動建立設定檔，非必要的手動設置會造成運作不正常。</p></div><p>設定檔可由 <span class="application">Xorg</span> 根據偵測到的硬體產生，這個檔案對一開始自訂設定很有幫助。</p><p>產生 <code class="filename">xorg.conf</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>Xorg -configure</code></strong></pre><p>設定檔會儲存至 <code class="filename">/root/xorg.conf.new</code>，做任何需要的更改，然後使用以下指令測試該檔案：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>Xorg -config /root/xorg.conf.new</code></strong></pre><p>在新設定檔調整與測試過後，便可分開成較小的檔案放置到正常的位置 <code class="filename">/usr/local/etc/X11/xorg.conf.d/</code>。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="x-fonts"></a>5.5. 在 <span class="application">Xorg</span> 使用字型</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="type1"></a>5.5.1. Type1 字型</h3></div></div></div><p>由於 <span class="application">Xorg</span> 內建的預設字型用在典型的桌面出版應用程式並不是很理想，大字型會呈現鋸齒狀邊緣，看起來很不專業，小字型幾乎完全看不清楚。不過，這裡有幾個免費高品質的 Type1 (<span class="trademark">PostScript</span>®) 字型可用，且能容易的在 <span class="application">Xorg</span> 使用。例如，URW 字型集 (<span class="trademark">Times Roman</span>®, <span class="trademark">Helvetica</span>®, <span class="trademark">Palatino</span>® 及其他)。 Freefont 字型集 (<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11-fonts/freefonts/pkg-descr">x11-fonts/freefonts</a>) 包含了更多的字型，但其中大部分是給圖形軟體如 GIMP 所使用的字型，並不能完全作為螢幕字型使用。此外，<span class="application">Xorg</span> 可以簡單的設定使用 <span class="trademark">TrueType</span>® 字型。更多有關本主題的詳細資訊，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=X&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">X</span>(7)</span></a> 操作手冊或 <a class="xref" href="#truetype" title="5.5.2. TrueType® 字型">節 5.5.2, “<span class="trademark">TrueType</span>® 字型”</a>。</p><p>要由 Binary 套件安裝上述的 Type1 字型集可執行以下指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install urwfonts</code></strong></pre><p>或由 Port 套件集編譯，可執行以下指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/x11-fonts/urwfonts</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>同樣的安裝方式也適用 Freefont 或其他字型集。要讓 X 伺服器偵測到這些新安裝的字型，可加入適當的設定到 X 伺服器設定檔 (<code class="filename">/etc/X11/xorg.conf</code>)，內容為：</p><pre xml:lang="en" class="programlisting" lang="en">FontPath "/usr/local/share/fonts/urwfonts/"</pre><p>或者在 X session 的指令列執行：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>xset fp+ /usr/local/share/fonts/urwfonts</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>xset fp rehash</code></strong></pre><p>這樣便可，但在 X session 關閉時將會失效，除非將該設定加入啟動檔 (一般的 <code class="command">startx</code> session 可在 <code class="filename">~/.xinitrc</code> 設定，若透過圖型化登入管理程式如 <span class="application">XDM</span> 登入時則在 <code class="filename">~/.xsession</code> 設定)。第三種方式是使用新 <code class="filename">/usr/local/etc/fonts/local.conf</code>，如 <a class="xref" href="#antialias" title="5.5.3. 反鋸齒字型">節 5.5.3, “反鋸齒字型”</a> 的示範。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="truetype"></a>5.5.2. <span class="trademark">TrueType</span>® 字型</h3></div></div></div><a id="idp66908216" class="indexterm"></a><a id="idp66909112" class="indexterm"></a><p><span class="application">Xorg</span> 內建支援繪製 <span class="trademark">TrueType</span>® 字型，目前有兩個模組可以支援這項功能。在本例中使用 freetype 模組，由於此模組與其他字型繪製後端較為一致。要開啟 freetype 模組只需要將下行加入到 <code class="filename">/etc/X11/xorg.conf</code> 中的 <code class="literal">"Module"</code> section。</p><pre xml:lang="en" class="programlisting" lang="en">Load  "freetype"</pre><p>現在要建立一個儲存 <span class="trademark">TrueType</span>® 字型的目錄 (例如，<code class="filename">/usr/local/share/fonts/TrueType</code>) 然後複製所有 <span class="trademark">TrueType</span>® 字型到這個目錄。要注意 <span class="trademark">TrueType</span>® 字型並無法直接取自 <span class="trademark">Apple</span>® <span class="trademark">Mac</span>®，<span class="application">Xorg</span> 使用的字型必須為 <span class="trademark">UNIX</span>®/<span class="trademark">MS-DOS</span>®/<span class="trademark">Windows</span>® 的格式。檔案複製到讓目錄之後，使用 <span class="application">mkfontscale</span> 來建立 <code class="filename">fonts.dir</code> 來讓 X 字型繪製程式知道安裝了新的檔案。<code class="command">mkfontscale</code> 可用套件的方式安裝：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install mkfontscale</code></strong></pre><p>然後在目錄中建立 X 字型檔的索引：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/local/share/fonts/TrueType</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkfontscale</code></strong></pre><p>接著加入 <span class="trademark">TrueType</span>® 目錄到字型路徑。這個動作與 <a class="xref" href="#type1" title="5.5.1. Type1 字型">節 5.5.1, “Type1 字型”</a> 中所介紹的方式相同：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>xset fp+ /usr/local/share/fonts/TrueType</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>xset fp rehash</code></strong></pre><p>或直接加入 <code class="literal">FontPath</code> 一行到 <code class="filename">xorg.conf</code>。</p><p>現在 <span class="application">Gimp</span>, <span class="application">Apache OpenOffice</span> 以及其他 X 應用程式應可以辨識到已安裝的 <span class="trademark">TrueType</span>® 字型。極小的字型 (以高解析度在網頁中顯示的文字) 與極大的字型 (在 <span class="application"><span class="trademark">StarOffice</span>™</span> 中) 現在會看起來比較像樣了。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="antialias"></a>5.5.3. 反鋸齒字型</h3></div></div></div><a id="idp66934200" class="indexterm"></a><a id="idp66947384" class="indexterm"></a><p>所有可在 <code class="filename">/usr/local/share/fonts/</code> 及 <code class="filename">~/.fonts/</code> 找到的 <span class="application">Xorg</span> 字型均可在  Xft-aware 的應用程式使用反鋸齒的效果。大多最近的應用程式均為 Xft-aware 的，包括 <span class="application">KDE</span>, <span class="application">GNOME</span> 以及 <span class="application">Firefox</span>。</p><p>要控制那一些字型要做反鋸齒或設定反鋸齒的屬性，需建立 <code class="filename">/usr/local/etc/fonts/local.conf</code> 檔案 (若檔案存在則編輯)。在這個檔案中可以調整 Xft 字型系統的數項進階功能，本章節僅介紹部份簡單的項目，要取得進一步資訊，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fonts-conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fonts-conf</span>(5)</span></a>。</p><a id="idp66953016" class="indexterm"></a><p>這個檔案必須使用 XML 格式，小心文字大小寫，且要確定所有標籤均有正常結尾。檔案的開頭使用常見的 XML 檔首，接著為 DOCTYPE 定義，然後是 <code class="literal">&lt;fontconfig&gt;</code> 標籤：</p><pre xml:lang="en" class="programlisting" lang="en">&lt;?xml version="1.0"?&gt;
      &lt;!DOCTYPE fontconfig SYSTEM "fonts.dtd"&gt;
      &lt;fontconfig&gt;</pre><p>如同前面所提到的，所有在 <code class="filename">/usr/local/share/fonts/</code> 與 <code class="filename">~/.fonts/</code> 的字型均可在 Xft-aware 的應用程式做反鋸齒效果，若您想要加入除了上兩者以外的目錄，可加入如下行設定到 <code class="filename">/usr/local/etc/fonts/local.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">&lt;dir&gt;/path/to/my/fonts&lt;/dir&gt;</pre><p>加入新字型及額外的新字型目錄之後，需重新建立字型快取：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>fc-cache -f</code></strong></pre><p>反鋸齒效果會讓文字的邊緣變模糊，這會讓非常小的文字更能閱讀且去除大型文字的 <span class="quote">“<span class="quote">鋸齒</span>”</span>，但套用在一般的文字可能會造成眼睛的疲勞。要排除小於 14 點的字型大小使用反鋸齒效果，可加入這些行：</p><pre xml:lang="en" class="programlisting" lang="en">        &lt;match target="font"&gt;
	    &lt;test name="size" compare="less"&gt;
		&lt;double&gt;14&lt;/double&gt;
	    &lt;/test&gt;
	    &lt;edit name="antialias" mode="assign"&gt;
		&lt;bool&gt;false&lt;/bool&gt;
	    &lt;/edit&gt;
	&lt;/match&gt;
	&lt;match target="font"&gt;
	    &lt;test name="pixelsize" compare="less" qual="any"&gt;
		&lt;double&gt;14&lt;/double&gt;
	    &lt;/test&gt;
	    &lt;edit mode="assign" name="antialias"&gt;
		&lt;bool&gt;false&lt;/bool&gt;
	    &lt;/edit&gt;
	&lt;/match&gt;</pre><a id="idp66963896" class="indexterm"></a><p>反鋸齒所產生的間距對於部份等寬字型並不合適，尤其是在使用 <span class="application">KDE</span> 時會成為一個問題。可能的修正方式是強制這類字型的間距為 100，可加入以下行：</p><pre xml:lang="en" class="programlisting" lang="en">	&lt;match target="pattern" name="family"&gt;
	   &lt;test qual="any" name="family"&gt;
	       &lt;string&gt;fixed&lt;/string&gt;
	   &lt;/test&gt;
	   &lt;edit name="family" mode="assign"&gt;
	       &lt;string&gt;mono&lt;/string&gt;
	   &lt;/edit&gt;
	&lt;/match&gt;
	&lt;match target="pattern" name="family"&gt;
	    &lt;test qual="any" name="family"&gt;
		&lt;string&gt;console&lt;/string&gt;
	    &lt;/test&gt;
	    &lt;edit name="family" mode="assign"&gt;
		&lt;string&gt;mono&lt;/string&gt;
	    &lt;/edit&gt;
	&lt;/match&gt;</pre><p>(這會設定等寬字型的其他常用名稱為 <code class="literal">"mono"</code>)，然後加入：</p><pre xml:lang="en" class="programlisting" lang="en">         &lt;match target="pattern" name="family"&gt;
	     &lt;test qual="any" name="family"&gt;
		 &lt;string&gt;mono&lt;/string&gt;
	     &lt;/test&gt;
	     &lt;edit name="spacing" mode="assign"&gt;
		 &lt;int&gt;100&lt;/int&gt;
	     &lt;/edit&gt;
	 &lt;/match&gt;      </pre><p>部份字型，如 Helvetica，在使用反鋸齒時可能會發生問題，通常會呈現像垂直切成兩半的字型，最差還可能會導致應用程式當掉。要避免這個問題，可考慮加入以下設定到 <code class="filename">local.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">         &lt;match target="pattern" name="family"&gt;
	     &lt;test qual="any" name="family"&gt;
		 &lt;string&gt;Helvetica&lt;/string&gt;
	     &lt;/test&gt;
	     &lt;edit name="family" mode="assign"&gt;
		 &lt;string&gt;sans-serif&lt;/string&gt;
	     &lt;/edit&gt;
	 &lt;/match&gt;        </pre><p>編輯 <code class="filename">local.conf</code> 完之後，請確認有使用 <code class="literal">&lt;/fontconfig&gt;</code> 標籤結尾，若沒有使用會讓所做的更改被忽略。</p><p>使用者可透過建立自己的 <code class="filename">~/.config/fontconfig/fonts.conf</code> 來加入個人化的設定，此檔案使用與上述說明相同的 <acronym class="acronym">XML</acronym> 格式。</p><a id="idp66999992" class="indexterm"></a><a id="idp67000632" class="indexterm"></a><p>最後一點：若有使用 LCD 螢幕，可能會想要使用子像素取樣 (Sub-pixel sampling)，這基本上會分開處理 (水平分隔)  紅、綠、藍色彩組成來提高垂直解析度，結果可能是無法預料的。要開啟這個功能，加入下行到 <code class="filename">local.conf</code> 的任一處：</p><pre xml:lang="en" class="programlisting" lang="en">	 &lt;match target="font"&gt;
	     &lt;test qual="all" name="rgba"&gt;
		 &lt;const&gt;unknown&lt;/const&gt;
	     &lt;/test&gt;
	     &lt;edit name="rgba" mode="assign"&gt;
		 &lt;const&gt;rgb&lt;/const&gt;
	     &lt;/edit&gt;
	 &lt;/match&gt;</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">依據不同的顯示器類型可能會需要將 <code class="literal">rgb</code> 更改為 <code class="literal">bgr</code>, <code class="literal">vrgb</code> 或 <code class="literal">vbgr</code>：可實驗看看然後看那一個效果最好。</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="x-xdm"></a>5.6. X 顯示管理程式</h2></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Seth</span> <span class="surname">Kingsley</span></span>. </span></div></div></div><a id="idp67041848" class="indexterm"></a><p><span class="application">Xorg</span> 提供了 X 顯示管理程式 (X Display Manager, <span class="application">XDM</span>)，可用來做登入階段的管理。<span class="application">XDM</span> 提供了一個圖型化的介面來選擇要連結的顯示伺服器以及輸入認証資訊 (登入與密碼)。</p><p>本節將示範如何設定 FreeBSD 的 X 顯示管理程式。部份桌面環境會提供自己的圖型化登入管理程式，請參考 <a class="xref" href="#x11-wm-gnome" title="5.7.1. GNOME">節 5.7.1, “GNOME”</a> 取得如何設定 GNOME 顯示管理程式 (GNOME Display Manager) 的操作方式以及 <a class="xref" href="#x11-wm-kde" title="5.7.2. KDE">節 5.7.2, “KDE”</a> 取得如何設定 KDE 顯示管理程式 (KDE Display Manager) 的操作方式。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67045048"></a>5.6.1. 設定 <span class="application">XDM</span></h3></div></div></div><p>要安裝 <span class="application">XDM</span> 可使用 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11/xdm/pkg-descr">x11/xdm</a> 套件或 Port。安裝完成之後，可設定 <span class="application">XDM</span> 在開機時執行，只需編輯 <code class="filename">/etc/ttys</code> 中的此項目：</p><pre xml:lang="en" class="screen" lang="en">ttyv8   "/usr/local/bin/xdm -nodaemon"  xterm   off secure</pre><p>更改關 (<code class="literal">off</code>) 為開 (<code class="literal">on</code>) 然後儲存編輯。在此項目中的 <code class="literal">ttyv8</code> 代表 <span class="application">XDM</span> 會在第 9 個虛擬終端機執行。</p><p><span class="application">XDM</span> 的設定目錄位於 <code class="filename">/usr/local/etc/X11/xdm</code>。此目錄中包含數個可用來更改 <span class="application">XDM</span> 行為與外觀的檔案以及在 <span class="application">XDM</span> 執行時用來設定桌面的一些 Script 及程式，<a class="xref" href="#xdm-config-files" title="表格 5.1. XDM 設定檔">表格 5.1, “XDM 設定檔”</a> 摘要了每個檔案的功能。這些檔案正確的語法與用法在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xdm&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xdm</span>(1)</span></a> 有說明。</p><div class="table"><a id="xdm-config-files"></a><div class="table-title">表格 5.1. XDM 設定檔</div><div class="table-contents"><table summary="XDM 設定檔" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>檔案</th><th>說明</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><code class="filename">Xaccess</code></td><td>連線到 <span class="application">XDM</span> 所需的通訊協定稱做 X 顯示管理程式連線通訊協定  (X Display Manager Connection Protocol, <acronym class="acronym">XDMCP</acronym>)，此檔案為客戶端認証規則，用來控制來自遠端機器的 <acronym class="acronym">XDMCP</acronym> 連線。預設此檔案並不允許任何遠端的客戶端連線。</td></tr><tr><td xml:lang="en" lang="en"><code class="filename">Xresources</code></td><td>此檔案控制 <span class="application">XDM</span> 顯示選擇器及登入畫面的外觀。預設的設定簡單的矩形登入視窗，上方用較大的字型顯示機器的主機名稱，並在下方顯示 <span class="quote">“<span class="quote">Login:</span>”</span> 與 <span class="quote">“<span class="quote">Password:</span>”</span> 提示。此檔案的格式與 <span class="application">Xorg</span> 說明文件中說明的 app-defaults 檔相同。</td></tr><tr><td xml:lang="en" lang="en"><code class="filename">Xservers</code></td><td>登入選擇時在選擇器上要提供的本地及遠端顯示清單。</td></tr><tr><td xml:lang="en" lang="en"><code class="filename">Xsession</code></td><td>預設的登入階段 Script，使用者登入之後由 <span class="application">XDM</span> 執行。這會指向使用者自訂的登入階段 Script 於 <code class="filename">~/.xsession</code>。</td></tr><tr><td xml:lang="en" lang="en"><code class="filename">Xsetup_</code>*</td><td>用來在顯示選擇器與登入介面之前自動執行應用程式的 Script。每一個顯示各有一個 Script，名稱為 <code class="filename">Xsetup_*</code>，其中 <code class="literal">*</code> 為本地顯示編號。正常情況這些 Script 會在背景執行一兩個程式，例如 <code class="command">xconsole</code>。</td></tr><tr><td xml:lang="en" lang="en"><code class="filename">xdm-config</code></td><td>用來設定所有在此機器上執行的顯示的全域設定檔。</td></tr><tr><td xml:lang="en" lang="en"><code class="filename">xdm-errors</code></td><td>內含由伺服器程式產生的錯誤訊息，若 <span class="application">XDM</span> 嘗試啟動的顯示沒有回應，可查看此檔案來取得錯誤訊息。以登入階段為基礎，這些訊息也同樣會寫入至使用者的 <code class="filename">~/.xsession-errors</code>。</td></tr><tr><td xml:lang="en" lang="en"><code class="filename">xdm-pid</code></td><td><span class="application">XDM</span> 的執行程序 <acronym class="acronym">ID</acronym>。</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67086904"></a>5.6.2. 設定遠端存取</h3></div></div></div><p>預設只有同系統的使用者可以使用 <span class="application">XDM</span> 登入。要開啟讓其他系統的使用者可連線到顯示伺服器，需編輯存取控制規則及開啟連線傾聽程式。</p><p>要設定 <span class="application">XDM</span> 傾聽任何遠端的連線，在 <code class="filename">/usr/local/etc/X11/xdm/xdm-config</code> 中的 <code class="literal">DisplayManager.requestPort</code> 行前加上 <code class="literal">!</code> 來註解該行：</p><pre xml:lang="en" class="screen" lang="en">! SECURITY: do not listen for XDMCP or Chooser requests
! Comment out this line if you want to manage X terminals with xdm
DisplayManager.requestPort:     0</pre><p>儲存編輯並重新啟動 <span class="application">XDM</span>，要限制遠端存取，請看 <code class="filename">/usr/local/etc/X11/xdm/Xaccess</code> 中的範例項目，並參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xdm&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xdm</span>(1)</span></a> 取得進一步資訊。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="x11-wm"></a>5.7. 桌面環境</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Valentino</span> <span class="surname">Vaschetto</span></span>. </span></div></div></div><p>本節將介紹如何在 FreeBSD 系統安裝三種熱門的桌面環境。一套桌面環境的範圍可從簡單的視窗管理程式到完整的桌面應用程式集。有上百套的桌面環境可在 Port 套件集的 <code class="filename">x11-wm</code> 分類取得。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x11-wm-gnome"></a>5.7.1. GNOME</h3></div></div></div><a id="idp67102648" class="indexterm"></a><p><span class="application">GNOME</span> 是一個擁有友善使用者介面的的桌面環境，它包括用於啟動應用程式和顯示狀態的面板、一系列工具與應用程序及一套可讓應用程式更容易進行合作、相互一致的協定。更多有關 FreeBSD <span class="application">GNOME</span> 的訊息可在 <a class="link" href="https://www.FreeBSD.org/gnome" target="_top">https://www.FreeBSD.org/gnome</a> 取得，該網站包含了有關在 FreeBSD 安裝、設定和管理 <span class="application">GNOME</span> 的額外文件。</p><p>這套桌面環境可以從套件安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install gnome3</code></strong></pre><p>也可使用以下指令從 Port 編譯 <span class="application">GNOME</span>，<span class="application">GNOME</span> 是一套大型的應用程式，即使在速度較快的電腦上，也會需要花費一些時間編譯。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/x11/gnome3</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p><span class="application">GNOME</span> 需要掛載 <code class="filename">/proc</code>。加入下行到 <code class="filename">/etc/fstab</code> 讓系統啟動時會自動掛載這個檔案系統：</p><pre xml:lang="en" class="programlisting" lang="en">proc           /proc       procfs  rw  0   0</pre><p><span class="application">GNOME</span> 使用了 <span class="application">D-Bus</span> 以及 <span class="application">HAL</span> 的 Message bus 與 Hardware abstraction。這兩個應用程式會隨著 <span class="application">GNOME</span> 的相依一併自動安裝，但需要在 <code class="filename">/etc/rc.conf</code> 開啟，這樣在系統開機時才會啟動：</p><pre xml:lang="en" class="programlisting" lang="en">dbus_enable="YES"
hald_enable="YES"</pre><p>安裝完之後，需設定讓 <span class="application">Xorg</span> 啟動 <span class="application">GNOME</span>。最簡單的方法是開啟 GNOME Display Manager, <span class="application">GDM</span>，該程式已做為 <span class="application">GNOME</span> 套件或 Port 的一部份安裝了，可加入下行到 <code class="filename">/etc/rc.conf</code> 來開啟：</p><pre xml:lang="en" class="programlisting" lang="en">gdm_enable="YES"</pre><p>通常也會需要啟動所有的 <span class="application">GNOME</span> 服務，可加入下行到 <code class="filename">/etc/rc.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">gnome_enable="YES"</pre><p><span class="application">GDM</span> 則會在系統開機時自動啟動。</p><p>第二種啟動 <span class="application">GNOME</span> 的方法是在設定完 <code class="filename">~/.xinitrc</code> 後在指令列輸入 <code class="command">startx</code>。若這個檔案已經存在，替換啟動目前視窗管理程式的那一行，改為啟動 <code class="filename">/usr/local/bin/gnome-session</code>。若檔案不存在，則使用以下指令建立一個：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>echo "exec /usr/local/bin/gnome-session" &gt; ~/.xinitrc</code></strong></pre><p>第三種方法是使用 <span class="application">XDM</span> 做為顯示管理程式，在這個方法需要建立一個可執行的 <code class="filename">~/.xsession</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>echo "exec /usr/local/bin/gnome-session" &gt; ~/.xsession</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x11-wm-kde"></a>5.7.2. KDE</h3></div></div></div><a id="idp67137848" class="indexterm"></a><p><span class="application">KDE</span> 是另一套易於使用的桌面環境。這個桌面環境提供了一致外觀的應用程式、標準化的選單和工具列、組合鍵、配色方案、國際化與集中、對話框導向的桌面設定。更多有關 <span class="application">KDE</span> 可在 <a class="link" href="http://www.kde.org/" target="_top">http://www.kde.org/</a> 取得。要取得 FreeBSD 特定的資訊，則可參考 <a class="link" href="http://freebsd.kde.org/" target="_top">http://freebsd.kde.org</a>。</p><p>要安裝 <span class="application">KDE</span> 套件，請輸入：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install x11/kde5</code></strong></pre><p>或者要使用 <span class="application">KDE</span> Port 編譯，可使用以下指令，採用 Port 方式安裝會有選單可以選擇要安裝的元件。<span class="application">KDE</span> 是一個大型的應用程式，即使在較快的電腦上仍需要花費一段時間來編譯。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/x11/kde5</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><a id="idp67149240" class="indexterm"></a><p><span class="application">KDE</span> 需要掛載 <code class="filename">/proc</code>。加入下行到 <code class="filename">/etc/fstab</code> 讓系統啟動時會自動掛載這個檔案系統：</p><pre xml:lang="en" class="programlisting" lang="en">proc           /proc       procfs  rw  0   0</pre><p><span class="application">KDE</span> 使用了 <span class="application">D-Bus</span> 以及 <span class="application">HAL</span> 的 Message bus 與 Hardware abstraction。這兩個應用程式會隨著 <span class="application">KDE</span> 的相依一併自動安裝，但需要在 <code class="filename">/etc/rc.conf</code> 開啟，這樣在系統開機時才會啟動：</p><pre xml:lang="en" class="programlisting" lang="en">dbus_enable="YES"
hald_enable="YES"</pre><p>自 KDE Plasma 5 開始，KDE Display Manager, <span class="application">KDM</span> 便停止開發，可能的替代方案為 <span class="application">SDDM</span>，要安裝該套件可輸入：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install x11/sddm</code></strong></pre><p>加入下行到 <code class="filename">/etc/rc.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">sddm_enable="YES"</pre><p>第二種執行 <span class="application">KDE</span> 的方法是在在指令列輸入 <code class="command">startx</code>。要採用這個方式，需要加入下行到 <code class="filename">~/.xinitrc</code>：</p><pre xml:lang="en" class="programlisting" lang="en">exec ck-launch-session startkde</pre><p>第三種啟動 <span class="application">KDE</span> 的方式是透過 <span class="application">XDM</span>，要使用這個方法需要建立一個可執行的 <code class="filename">~/.xsession</code> 如下：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>echo "exec ck-launch-session startkde" &gt; ~/.xsession</code></strong></pre><p>啟動 <span class="application">KDE</span> 之後，請參考內建的說明系統來取得更多有關如何使用各種選單及應用程式的資訊。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x11-wm-xfce"></a>5.7.3. Xfce</h3></div></div></div><p><span class="application">Xfce</span> 是以 <span class="application">GNOME</span> 使用的 GTK +工具包做為基礎所開發的桌面環境，但是它更輕巧且提供了一種簡單、高效、易於使用的桌面。它可完全自訂設定、附有選單、Applet 及應用程式啟動器的主面板、提供檔案管理程式和音效管理程式並且可設定主題。由於它是快速、輕巧、高效的桌面環境，因此它非常適合有記憶體限制的較舊或較慢機器。更多有關 <span class="application">Xfce</span> 的資訊可至 <a class="link" href="http://www.xfce.org/" target="_top">http://www.xfce.org</a> 取得。</p><p>要安裝 <span class="application">Xfce</span> 套件：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install xfce</code></strong></pre><p>或者使用 Port 編譯：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/x11-wm/xfce4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p><span class="application">Xfce</span> 使用了 <span class="application">D-Bus</span> 作為 Message bus，由於是 <span class="application">Xfce</span> 的相依，因此會自動安裝，但仍要在 <code class="filename">/etc/rc.conf</code> 中開啟該程式才會在系統開機時啟動：</p><pre xml:lang="en" class="programlisting" lang="en">dbus_enable="YES"</pre><p>不像 <span class="application">GNOME</span> 或 <span class="application">KDE</span>，<span class="application">Xfce</span> 並沒有自己的登入管理程式，要能用 <code class="command">startx</code> 指令列啟動 <span class="application">Xfce</span> 之前需先加入其項目到 <code class="filename">~/.xinitrc</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>echo ". /usr/local/etc/xdg/xfce4/xinitrc" &gt; ~/.xinitrc</code></strong></pre><p>另一種方式是使用 <span class="application">XDM</span>，要設定這個方式需建立一個可執行的 <code class="filename">~/.xsession</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>echo ". /usr/local/etc/xdg/xfce4/xinitrc" &gt; ~/.xsession</code></strong></pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="x-compiz-fusion"></a>5.8. 安裝 Compiz Fusion</h2></div></div></div><p>要令使用桌面電腦更令人愉快的方法是用炫麗的 3D 效果。</p><p>安裝 <span class="application">Compiz Fusion</span> 套件非常簡單，但設定該套件需要一些未在 Port 說明文件中說明的步驟。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-compiz-video-card"></a>5.8.1. 設定 FreeBSD nVidia 驅動程式</h3></div></div></div><p>桌面特效需要使用相當程度的顯示卡，對於以 nVidia 為基礎的顯示卡，需要使用專用的驅動程序來取得較佳的性能。其他顯示卡的使用可以跳過這一節，並繼續 <code class="filename">xorg.conf</code> 設定。</p><p>要知道需要那一種 nVidia 驅動程式可以查看 <a class="link" href="../../../../doc/en_US.ISO8859-1/books/faq/x.html#idp59950544" target="_top">FAQ 中與此主題相關的問題</a>。</p><p>知道您的顯示卡要使用那種驅動程式才是正確的之後，接下來的安裝程序跟安裝其他套件一樣簡單。</p><p>例如，要安裝最新的驅動程式：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install x11/nvidia-driver</code></strong></pre><p>驅動程式會建立一個需要在系統啟動時載入的核心模組，加入下行到 <code class="filename">/boot/loader.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">nvidia_load="YES"</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">要立即載入核心模組到執行中的核心可以下 <code class="command">kldload nvidia</code> 指令，但是需要注意，若不是在開機時載入，某些 <span class="application">Xorg</span> 版本會無法正常運作。因此編輯完 <code class="filename">/boot/loader.conf</code> 之後建議要重新開機。</p></div><p>核心模組載入之後，您只需要更改 <code class="filename">xorg.conf</code> 的其中一行來開啟專用的驅動程式：</p><p>找到 <code class="filename">/etc/X11/xorg.conf</code> 中的下行：</p><pre xml:lang="en" class="programlisting" lang="en">Driver      "nv"</pre><p>然後更改該行為：</p><pre xml:lang="en" class="programlisting" lang="en">Driver      "nvidia"</pre><p>如往常般啟動 GUI，您應該會看到 nVidia 的啟動畫面，其他東西應如往常般運作。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="xorg-configuration"></a>5.8.2. 設定 xorg.conf 來啟動桌面特效</h3></div></div></div><p>要開啟 <span class="application">Compiz Fusion</span> 需要修改 <code class="filename">/etc/X11/xorg.conf</code>：</p><p>加入以下 Section 來開啟合成特效：</p><pre xml:lang="en" class="programlisting" lang="en">Section "Extensions"
    Option         "Composite" "Enable"
EndSection</pre><p>找到 <span class="quote">“<span class="quote">Screen</span>”</span> section，長的應該如下所示：</p><pre xml:lang="en" class="programlisting" lang="en">Section "Screen"
    Identifier     "Screen0"
    Device         "Card0"
    Monitor        "Monitor0"
    ...</pre><p>然後加入以下兩行 (在<span class="quote">“<span class="quote">Monitor</span>”</span> 之後)：</p><pre xml:lang="en" class="programlisting" lang="en">DefaultDepth    24
Option         "AddARGBGLXVisuals" "True"</pre><p>找到您欲使用的螢幕解析度所在的 <span class="quote">“<span class="quote">Subsection</span>”</span>，例如，您想要使用 1280x1024，則找到如下所示的 Section。若想要使用的解析度不在任何 Subsection 之中，您可以手動加入對應的項目：</p><pre xml:lang="en" class="programlisting" lang="en">SubSection     "Display"
    Viewport    0 0
    Modes      "1280x1024"
EndSubSection</pre><p>桌面合成需要 24 bit 的色彩深度，更改上述 Subsection 為：</p><pre xml:lang="en" class="programlisting" lang="en">SubSection     "Display"
    Viewport    0 0
    Depth       24
    Modes      "1280x1024"
EndSubSection</pre><p>最後確認在 <span class="quote">“<span class="quote">Module</span>”</span> section 中已經載入 <span class="quote">“<span class="quote">glx</span>”</span> 與 <span class="quote">“<span class="quote">extmod</span>”</span> 模組：</p><pre xml:lang="en" class="programlisting" lang="en">Section "Module"
    Load           "extmod"
    Load           "glx"
    ...</pre><p>前面所述的動作可以執行 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11/nvidia-xconfig/pkg-descr">x11/nvidia-xconfig</a> 來自動完成 (使用 root)：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>nvidia-xconfig --add-argb-glx-visuals</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>nvidia-xconfig --composite</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>nvidia-xconfig --depth=24</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="compiz-fusion"></a>5.8.3. 安裝與設定 Compiz Fusion</h3></div></div></div><p>安裝 <span class="application">Compiz Fusion</span> 如同安裝其他套件一樣簡單：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install x11-wm/compiz-fusion</code></strong></pre><p>安裝完成之後，開啟您的圖型化桌面，然後在終端機的畫面輸入以下指令 (使用一般使用者)：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>compiz --replace --sm-disable --ignore-desktop-hints ccp &amp;</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>emerald --replace &amp;</code></strong></pre><p>由於您的視窗管理程式 (例如：<span class="application">Metacity</span>，若您使用 <span class="application">GNOME</span>) 會被替換成 <span class="application">Compiz Fusion</span>，您的螢幕會閃爍幾秒。而 <span class="application">Emerald</span> 會處理視窗的裝飾  (例如：關閉、最小化、最大化按鈕、標題列及其他相關)。</p><p>您或許可以將這些指令改寫成較小的 Script 然後在啟動時自動執行 (加到 <span class="application">GNOME</span> 桌面的 <span class="quote">“<span class="quote">Sessions</span>”</span> 中)：</p><pre xml:lang="en" class="programlisting" lang="en">#! /bin/sh
compiz --replace --sm-disable --ignore-desktop-hints ccp &amp;
emerald --replace &amp;</pre><p>儲存這個 Script 到您的家目錄所在位置，例如 <code class="filename">start-compiz</code>，然後讓該檔案可以執行：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>chmod +x ~/start-compiz</code></strong></pre><p>接著使用 GUI  將該檔案加入啟動程式 <span class="guimenuitem">Startup Programs</span> (位於 <span class="application">GNOME</span> 桌面的系統 <span class="guimenuitem">System</span>, 偏好設定 <span class="guimenuitem">Preferences</span>, 工作階段 <span class="guimenuitem">Sessions</span>)。</p><p>要選擇所想使用的特效與相關設定，可執行 (一樣使用一般使用者) Compiz Config 設定管理程式 <span class="application">Compiz Config Settings Manager</span>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>ccsm</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">在 <span class="application">GNOME</span> 中，也可在系統 <span class="guimenuitem">System</span>, 偏好設定 <span class="guimenuitem">Preferences</span> 選單中找到。</p></div><p>若您在編譯時選擇了 <span class="quote">“<span class="quote">gconf support</span>”</span>，您便可使用 <code class="command">gconf-editor</code> 在 <code class="literal">apps/compiz</code> 下查看設定。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="x11-understanding"></a>5.9. 疑難排解</h2></div></div></div><p>若滑鼠無法使用，您將需要做第一次設定方可繼續。在最近的 <span class="application">Xorg</span> 版本，使用自動偵測裝置會忽略在 <code class="filename">xorg.conf</code> 中的 <code class="literal">InputDevice</code> section。要採用舊的方式，需在此檔案加入下行到 <code class="literal">ServerLayout</code> 或 <code class="literal">ServerFlags</code> section：</p><pre xml:lang="en" class="programlisting" lang="en">Option "AutoAddDevices" "false"</pre><p>輸入裝置便可如先前版本一樣設定，連同其他所需的選項 (如：切換鍵盤配置)。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">如同前面有說明過，<span class="application">hald</span> Daemon 預設會自動偵測您的鍵盤，因此您的鍵盤配置或型號可能不正確，桌面環境如 <span class="application">GNOME</span>, <span class="application">KDE</span> 或 <span class="application">Xfce</span> 會提供設定鍵盤的工具。即使如此，還是有可能透過 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=setxkbmap&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">setxkbmap</span>(1)</span></a> 工具或 <span class="application">hald</span> 的設定規則的協助來直接設定鍵盤屬性。</p><p xmlns="http://www.w3.org/1999/xhtml">舉例來說，若有人想要使用 PC 102 鍵的鍵盤，採用法語 (French) 配置，我們便需要建立一個給 <span class="application">hald</span> 的鍵盤設定檔，名稱為 <code class="filename">x11-input.fdi</code>，然後儲存到 <code class="filename">/usr/local/etc/hal/fdi/policy</code> 目錄。這個檔案中應要有以下幾行：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="programlisting" lang="en">&lt;?xml version="1.0" encoding="iso-8859-1"?&gt;
&lt;deviceinfo version="0.2"&gt;
  &lt;device&gt;
    &lt;match key="info.capabilities" contains="input.keyboard"&gt;
	  &lt;merge key="input.x11_options.XkbModel" type="string"&gt;pc102&lt;/merge&gt;
	  &lt;merge key="input.x11_options.XkbLayout" type="string"&gt;fr&lt;/merge&gt;
    &lt;/match&gt;
  &lt;/device&gt;
&lt;/deviceinfo&gt;</pre><p xmlns="http://www.w3.org/1999/xhtml">若這個檔案已經存在，只需要複製並貼上您的檔案中有關鍵盤設定的那幾行。</p><p xmlns="http://www.w3.org/1999/xhtml">您會需要重新啟動您的機器來讓 <span class="application">hald</span> 讀取這個檔案。</p><p xmlns="http://www.w3.org/1999/xhtml">也是可以從 X 終端機或 Script 下指令來做同樣的設定：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>setxkbmap -model pc102 -layout fr</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml"><code class="filename">/usr/local/share/X11/xkb/rules/base.lst</code> 中列出了各種可用的鍵盤、配置與設定。</p></div><a id="idp67281336" class="indexterm"></a><p>現在可以開始調整 <code class="filename">xorg.conf.new</code> 設定檔，在文字編輯器如 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=emacs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">emacs</span>(1)</span></a> 或 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ee&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ee</span>(1)</span></a> 開啟該設定檔。若顯示器是不支援自動偵測同步頻率 (Sync frequency) 的舊或特殊的型號，同步頻率的設定可以手動加到 <code class="filename">xorg.conf.new</code> 的 <code class="literal">"Monitor"</code> section：</p><pre xml:lang="en" class="programlisting" lang="en">Section "Monitor"
	Identifier   "Monitor0"
	VendorName   "Monitor Vendor"
	ModelName    "Monitor Model"
	HorizSync    30-107
	VertRefresh  48-120
EndSection</pre><p>多數顯示器都支援自動偵測同步頻率，並不需要手動設定這些數值。對於那些不支援自動偵測的顯示器，請輸入由製造商提供的數值來避免損壞顯示器。</p><p>X 允許在支援的顯示器使用 DPMS (Energy Star) 功能，<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xset&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xset</span>(1)</span></a> 程式可以控制逾時並可強制待機 (Standby)、暫停 (Suspend) 或關閉 (Off) 模式。若您想要為您的顯示器開啟 DPMS 功能，您需要加入下行到顯示器 (Monitor) 的 Section：</p><pre xml:lang="en" class="programlisting" lang="en">Option       "DPMS"</pre><a id="idp67288120" class="indexterm"></a><p>在編輯器還未關閉 <code class="filename">xorg.conf.new</code> 設定檔前，選擇想要使用的預設解析度及色彩深度。這些項目可在 <code class="literal">"Screen"</code> section 定義：</p><pre xml:lang="en" class="programlisting" lang="en">Section "Screen"
	Identifier "Screen0"
	Device     "Card0"
	Monitor    "Monitor0"
	DefaultDepth 24
	SubSection "Display"
		Viewport  0 0
		Depth     24
		Modes     "1024x768"
	EndSubSection
EndSection</pre><p><code class="literal">DefaultDepth</code> 關鍵字代表預設執行要使用的色彩深度，這個設定可以被 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=Xorg&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">Xorg</span>(1)</span></a> 的指令列參數 <code class="option">-depth</code> 覆蓋。<code class="literal">Modes</code> 關鍵字代表執行要使用的解析度，注意，只有 VESA 標準模式才支援目標系統的繪圖硬體來定義解析度。在上述的例子中，預設使用的色彩深度為每像素 24 bit，這個色彩深度可用的解析度為 1024 x 768 像素。</p><p>最後，儲存設定檔並使用測試模式來測試上述的設定。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">有一個工具可以協助您診斷問題，那就是 <span class="application">Xorg</span> 日誌檔。該日誌檔中記錄了 <span class="application">Xorg</span> 連接的每個裝置的資訊。<span class="application">Xorg</span> 記錄檔名稱的格式為 <code class="filename">/var/log/Xorg.0.log</code>，確切的記錄檔名會可能從 <code class="filename">Xorg.0.log</code> 到 <code class="filename">Xorg.8.log</code> 以此類推。</p></div><p>若一且運作正常，設定檔需要安裝到 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=Xorg&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">Xorg</span>(1)</span></a> 會尋找的常用設定檔位置，通常是 <code class="filename">/etc/X11/xorg.conf</code> 或 <code class="filename">/usr/local/etc/X11/xorg.conf</code>。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cp xorg.conf.new /etc/X11/xorg.conf</code></strong></pre><p>現在已經完成了 <span class="application">Xorg</span> 的設定程序。<span class="application">Xorg</span> 現在可以使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=startx&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">startx</span>(1)</span></a> 工具啟動。<span class="application">Xorg</span> 伺服器也可以使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xdm&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xdm</span>(1)</span></a> 來啟動。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67319352"></a>5.9.1. 設定 <span class="trademark">Intel</span>® <code class="literal">i810</code> 繪圖晶片組</h3></div></div></div><a id="idp67320888" class="indexterm"></a><p>要設定 <span class="trademark">Intel</span>® i810 整合晶片組需要使用 <code class="filename">agpgart</code> AGP 程式介面來控制 <span class="application">Xorg</span> 驅動該顯示卡。請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=agp&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">agp</span>(4)</span></a> 驅動程式操作手冊來取得更多詳細資訊。</p><p>這也可讓您可以設定任何其他繪圖卡的硬體。注意，在未編譯 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=agp&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">agp</span>(4)</span></a> 到核心的系統，並無法使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a> 來載入該模組，因此驅動程式必須在開機時便在核心啟動，所以需要透過編譯或使用 <code class="filename">/boot/loader.conf</code> 來載入。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67330744"></a>5.9.2. 加入寬螢幕平板顯示器到設定檔</h3></div></div></div><a id="idp67331384" class="indexterm"></a><p>此章節會需要有一些進階的設定知識，若嘗試使用上述的標準設定工具仍無法產生可運作的設定，在日誌檔中應有足夠的資訊可運用來讓顯示卡運作。在此會需要使用文字編輯器。</p><p>目前使用寬螢幕 (WSXGA, WSXGA+, WUXGA, WXGA, WXGA+, et.al.) 格式支援的 16:10 及 10:9 格式或其他的寬高比可會有問題。例如一些 16:10 寬高比常見的螢幕解析度：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">2560x1600</p></li><li class="listitem"><p xml:lang="en" lang="en">1920x1200</p></li><li class="listitem"><p xml:lang="en" lang="en">1680x1050</p></li><li class="listitem"><p xml:lang="en" lang="en">1440x900</p></li><li class="listitem"><p xml:lang="en" lang="en">1280x800</p></li></ul></div><p>在某些時候，可以簡單的將這些要使用的解析度以 <code class="literal">Mode</code>  加入到  Section "Screen"：</p><pre xml:lang="en" class="programlisting" lang="en">Section "Screen"
Identifier "Screen0"
Device     "Card0"
Monitor    "Monitor0"
DefaultDepth 24
SubSection "Display"
	Viewport  0 0
	Depth     24
	Modes     "1680x1050"
EndSubSection
EndSection</pre><p><span class="application">Xorg</span> 能夠從寬螢幕設定取得解析度資訊 (透過 I2C/DDC)，因此能夠知道螢幕能處理的頻率及解析度。</p><p>若驅動程式中不存在那些螢幕能處理的 <code class="literal">ModeLines</code>，則需要給 <span class="application">Xorg</span> 一點提示。透過 <code class="filename">/var/log/Xorg.0.log</code> 可以取得足夠的資訊來手動建立可運作的 <code class="literal">ModeLine</code>。只需要在日誌檔中找到類似以下的訊息：</p><pre xml:lang="en" class="programlisting" lang="en">(II) MGA(0): Supported additional Video Mode:
(II) MGA(0): clock: 146.2 MHz   Image Size:  433 x 271 mm
(II) MGA(0): h_active: 1680  h_sync: 1784  h_sync_end 1960 h_blank_end 2240 h_border: 0
(II) MGA(0): v_active: 1050  v_sync: 1053  v_sync_end 1059 v_blanking: 1089 v_border: 0
(II) MGA(0): Ranges: V min: 48  V max: 85 Hz, H min: 30  H max: 94 kHz, PixClock max 170 MHz</pre><p>這些資訊稱作 EDID 資訊，使用 EDIT 資訊建立 <code class="literal">ModeLine</code> 只需要將數據使用正確的順序放入：</p><pre xml:lang="en" class="programlisting" lang="en">ModeLine &lt;name&gt; &lt;clock&gt; &lt;4 horiz. timings&gt; &lt;4 vert. timings&gt;</pre><p>將資訊放入之後，本例中 <code class="literal">Section "Monitor"</code> 中的 <code class="literal">ModeLine</code> 會看起來像這樣：</p><pre xml:lang="en" class="programlisting" lang="en">Section "Monitor"
Identifier      "Monitor1"
VendorName      "Bigname"
ModelName       "BestModel"
ModeLine        "1680x1050" 146.2 1680 1784 1960 2240 1050 1053 1059 1089
Option          "DPMS"
EndSection</pre><p>便完成編輯的步驟，接著需要在您的寬螢幕顯示器啟動 X。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="compiz-troubleshooting"></a>5.9.3. Compiz Fusion 疑難排解</h3></div></div></div><div class="qandaset"><a id="idp67023032"></a><dl><dt>5.9.3.1. <a href="#idp67023288">我已經安裝了 Compiz Fusion，但在執行了您所提到的指令後，我的視窗的標題列與按鈕便消失了。是那裡有問題?</a></dt><dt>5.9.3.2. <a href="#idp67027128">當我執行指令來啟動 Compiz Fusion，X 伺服器便當掉了，然後我又返回 Console。是那裡有問題?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%" /><col /></colgroup><tbody><tr class="question"><td align="left" valign="top"><a id="idp67023288"></a><a id="no-decorations"></a><p><strong>5.9.3.1.</strong></p></td><td align="left" valign="top"><p>我已經安裝了 <span class="application">Compiz Fusion</span>，但在執行了您所提到的指令後，我的視窗的標題列與按鈕便消失了。是那裡有問題?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>您可能忘記在 <code class="filename">/etc/X11/xorg.conf</code> 中的設定。請重新檢查這個檔案，特別是 <code class="literal">DefaultDepth</code> 及 <code class="literal">AddARGBGLXVisuals</code> 指令項。</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp67027128"></a><a id="xorg-crash"></a><p><strong>5.9.3.2.</strong></p></td><td align="left" valign="top"><p>當我執行指令來啟動 <span class="application">Compiz Fusion</span>，X 伺服器便當掉了，然後我又返回 Console。是那裡有問題?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>若您檢查 <code class="filename">/var/log/Xorg.0.log</code>，您可能可以找到當 X 啟動時所發生的錯誤訊息。最常發生的錯誤會是：</p><pre xml:lang="en" class="screen" lang="en">(EE) NVIDIA(0):     Failed to initialize the GLX module; please check in your X
(EE) NVIDIA(0):     log file that the GLX module has been loaded in your X
(EE) NVIDIA(0):     server, and that the module is the NVIDIA GLX module.  If
(EE) NVIDIA(0):     you continue to encounter problems, Please try
(EE) NVIDIA(0):     reinstalling the NVIDIA driver.</pre><p>會發生這個情形通常是因為您升級了 <span class="application">Xorg</span>，您需要重新安裝 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11/nvidia-driver/pkg-descr">x11/nvidia-driver</a> 套件來重新編譯 glx。</p></td></tr></tbody></table></div></div></div></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="common-tasks"></a>部 II. 一般作業</h1></div></div></div><div class="partintro"><div xmlns=""></div><p>既然基礎的部分已經提過了，接下來的這個部分將會討論一些常會用到的 FreeBSD 的特色，這些章節包括：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>介紹給您常見且實用的桌面應用軟體：瀏覽器、辦工工具、文件閱覽程式等。</p></li><li class="listitem"><p>介紹給您眾多 FreeBSD 上可用的多媒體工具。</p></li><li class="listitem"><p>解釋如何編譯量身訂做的 FreeBSD 核心以增加額外系統功能的流程。</p></li><li class="listitem"><p>詳細描述列印系統，包含桌上型印表機及網路印表機的設定。</p></li><li class="listitem"><p>展示給您看如何在您的 FreeBSD 系統中執行 Linux 應用軟體。</p></li></ul></div><p>這些章節中有些需要您預先閱讀些相關文件，在各章節開頭的概要內會提及。</p><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="chapter"><a href="#desktop">6. 桌面應用程式</a></span></dt><dd><dl><dt><span class="sect1"><a href="#desktop-synopsis">6.1. 概述</a></span></dt><dt><span class="sect1"><a href="#desktop-browsers">6.2. 瀏覽器</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67394744">6.2.1. Firefox</a></span></dt><dt><span class="sect2"><a href="#idp67410232">6.2.2. Opera</a></span></dt><dt><span class="sect2"><a href="#idp67448760">6.2.3. Konqueror</a></span></dt><dt><span class="sect2"><a href="#idp67462712">6.2.4. Chromium</a></span></dt></dl></dd><dt><span class="sect1"><a href="#desktop-productivity">6.3. 辦工工具</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67520824">6.3.1. Calligra</a></span></dt><dt><span class="sect2"><a href="#idp67534904">6.3.2. AbiWord</a></span></dt><dt><span class="sect2"><a href="#idp67543736">6.3.3. The GIMP</a></span></dt><dt><span class="sect2"><a href="#idp67555640">6.3.4. Apache OpenOffice</a></span></dt><dt><span class="sect2"><a href="#idp67592760">6.3.5. LibreOffice</a></span></dt></dl></dd><dt><span class="sect1"><a href="#desktop-viewers">6.4. 文件閱覽程式</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67637304">6.4.1. Xpdf</a></span></dt><dt><span class="sect2"><a href="#idp67662392">6.4.2. <span class="application">gv</span></a></span></dt><dt><span class="sect2"><a href="#idp67677496">6.4.3. Geeqie</a></span></dt><dt><span class="sect2"><a href="#idp67688888">6.4.4. ePDFView</a></span></dt><dt><span class="sect2"><a href="#idp67698616">6.4.5. Okular</a></span></dt></dl></dd><dt><span class="sect1"><a href="#desktop-finance">6.5. 財務</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67182008">6.5.1. GnuCash</a></span></dt><dt><span class="sect2"><a href="#idp67760440">6.5.2. Gnumeric</a></span></dt><dt><span class="sect2"><a href="#idp67769528">6.5.3. KMyMoney</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#multimedia">7. 多媒體</a></span></dt><dd><dl><dt><span class="sect1"><a href="#multimedia-synopsis">7.1. 概述</a></span></dt><dt><span class="sect1"><a href="#sound-setup">7.2. 設定音效卡</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67835832">7.2.1. 設定自訂核心支援音效</a></span></dt><dt><span class="sect2"><a href="#sound-testing">7.2.2. 測試音效</a></span></dt><dt><span class="sect2"><a href="#bluetooth-headset">7.2.3. 設定藍芽音效裝置</a></span></dt><dt><span class="sect2"><a href="#troubleshooting">7.2.4. 疑難排解音效</a></span></dt><dt><span class="sect2"><a href="#sound-multiple-sources">7.2.5. 使用多個音效來源</a></span></dt><dt><span class="sect2"><a href="#idp67973816">7.2.6. 設定混音器頻道的預設值</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sound-mp3">7.3. MP3 音樂</a></span></dt><dd><dl><dt><span class="sect2"><a href="#mp3-players">7.3.1. MP3 播放器</a></span></dt><dt><span class="sect2"><a href="#rip-cd">7.3.2. 擷取 <acronym class="acronym">CD</acronym> 音軌</a></span></dt><dt><span class="sect2"><a href="#mp3-encoding">7.3.3. MP3 編碼與解碼</a></span></dt></dl></dd><dt><span class="sect1"><a href="#video-playback">7.4. 影片播放</a></span></dt><dd><dl><dt><span class="sect2"><a href="#video-interface">7.4.1. 偵測影像處理能力</a></span></dt><dd><dl><dt><span class="sect3"><a href="#video-interface-xvideo">7.4.1.1. XVideo</a></span></dt></dl></dd><dt><span class="sect2"><a href="#video-ports">7.4.2. 可處理影像的 Port 與套件</a></span></dt><dd><dl><dt><span class="sect3"><a href="#video-mplayer">7.4.2.1. <span class="application">MPlayer</span> 與 <span class="application">MEncoder</span></a></span></dt><dt><span class="sect3"><a href="#video-xine">7.4.2.2. <span class="application">xine</span> 影像播放器</a></span></dt><dt><span class="sect3"><a href="#video-ports-transcode">7.4.2.3. <span class="application">Transcode</span> 工具</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#tvcard">7.5. 電視卡</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp68325176">7.5.1. 載入驅動程式</a></span></dt><dt><span class="sect2"><a href="#idp68340024">7.5.2. 好用的應用程式</a></span></dt><dt><span class="sect2"><a href="#idp68357944">7.5.3. 疑難排解</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mythtv">7.6. MythTV</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp68379576">7.6.1. 硬體</a></span></dt><dt><span class="sect2"><a href="#idp68389944">7.6.2. 設定 MythTV 後端</a></span></dt></dl></dd><dt><span class="sect1"><a href="#scanners">7.7. 影像掃描器</a></span></dt><dd><dl><dt><span class="sect2"><a href="#scanners-kernel-usb">7.7.1. 檢查掃描器</a></span></dt><dt><span class="sect2"><a href="#idp68455608">7.7.2. <span class="application">SANE</span> 設定</a></span></dt><dt><span class="sect2"><a href="#idp68507704">7.7.3. 掃描器權限</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#kernelconfig">8. 設定 FreeBSD 核心</a></span></dt><dd><dl><dt><span class="sect1"><a href="#kernelconfig-synopsis">8.1. 概述</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-custom-kernel">8.2. 為何要編譯自訂的核心?</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-devices">8.3. 偵測系統硬體</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-config">8.4. 設定檔</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-building">8.5. 編譯與安裝自訂核心</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-trouble">8.6. 如果發生錯誤</a></span></dt></dl></dd><dt><span class="chapter"><a href="#printing">9. 列印</a></span></dt><dd><dl><dt><span class="sect1"><a href="#printing-quick-start">9.1. 快速開始</a></span></dt><dt><span class="sect1"><a href="#printing-connections">9.2. 印表機連線</a></span></dt><dd><dl><dt><span class="sect2"><a href="#printing-connections-summary">9.2.1. 摘要</a></span></dt></dl></dd><dt><span class="sect1"><a href="#printing-pdls">9.3. 常見的頁面描述語言</a></span></dt><dd><dl><dt><span class="sect2"><a href="#print-pdls-table">9.3.1. 轉換 <span class="trademark">PostScript</span>® 至其他 <acronym class="acronym">PDL</acronym></a></span></dt><dt><span class="sect2"><a href="#print-pdls-summary">9.3.2. 摘要</a></span></dt></dl></dd><dt><span class="sect1"><a href="#printing-direct">9.4. 直接列印</a></span></dt><dt><span class="sect1"><a href="#printing-lpd">9.5. <acronym class="acronym">LPD</acronym> (行列式印表機 Daemon)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#printing-lpd-setup">9.5.1. 初始設定</a></span></dt><dt><span class="sect2"><a href="#printing-lpd-lpr">9.5.2. 使用 lpr(1) 列印</a></span></dt><dt><span class="sect2"><a href="#printing-lpd-filters">9.5.3. 過濾器</a></span></dt><dd><dl><dt><span class="sect3"><a href="#printing-lpd-filters-stairstep">9.5.3.1. 避免在純文字印表機階梯狀列印</a></span></dt><dt><span class="sect3"><a href="#printing-lpd-filters-enscript">9.5.3.2. 使用 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/enscript/pkg-descr">print/enscript</a> 在 <span class="trademark">PostScript</span>® 印表機美化純文字內容</a></span></dt><dt><span class="sect3"><a href="#printing-lpd-filters-ps2pcl">9.5.3.3. 列印 <span class="trademark">PostScript</span>® 到 <acronym class="acronym">PCL</acronym> 印表機</a></span></dt><dt><span class="sect3"><a href="#printing-lpd-filters-smart">9.5.3.4. 智慧過濾器</a></span></dt><dt><span class="sect3"><a href="#printing-lpd-filters-othersmart">9.5.3.5. 其他智慧過濾器</a></span></dt></dl></dd><dt><span class="sect2"><a href="#printing-lpd-queues">9.5.4. 多序列</a></span></dt><dt><span class="sect2"><a href="#printing-lpd-monitor">9.5.5. 監視與控制列印</a></span></dt><dd><dl><dt><span class="sect3"><a href="#printing-lpd-monitor-lpq">9.5.5.1. lpq(1)</a></span></dt><dt><span class="sect3"><a href="#printing-lpd-monitor-lprm">9.5.5.2. lprm(1)</a></span></dt><dt><span class="sect3"><a href="#printing-lpd-monitor-lpc">9.5.5.3. lpc(8)</a></span></dt></dl></dd><dt><span class="sect2"><a href="#printing-lpd-shared">9.5.6. 分享印表機</a></span></dt><dd><dl><dt><span class="sect3"><a href="#printing-shared-aliases">9.5.6.1. 別名</a></span></dt><dt><span class="sect3"><a href="#printing-shared-headers">9.5.6.2. 頁首</a></span></dt></dl></dd><dt><span class="sect2"><a href="#printing-lpd-references">9.5.7. 參考文獻</a></span></dt></dl></dd><dt><span class="sect1"><a href="#printing-other">9.6. 其他列印系統</a></span></dt><dd><dl><dt><span class="sect2"><a href="#printing-other-cups">9.6.1. <acronym class="acronym">CUPS</acronym> (Common <span class="trademark">UNIX</span>® Printing
	System)</a></span></dt><dt><span class="sect2"><a href="#printing-other-hplip">9.6.2. HPLIP</a></span></dt><dt><span class="sect2"><a href="#printing-other-lprng">9.6.3. LPRng</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#linuxemu">10. <span class="trademark">Linux</span>® Binary 相容性</a></span></dt><dd><dl><dt><span class="sect1"><a href="#linuxemu-synopsis">10.1. 概述</a></span></dt><dt><span class="sect1"><a href="#linuxemu-lbc-install">10.2. 設定 <span class="trademark">Linux</span>® Binary 相容性</a></span></dt><dd><dl><dt><span class="sect2"><a href="#linuxemu-libs-manually">10.2.1. 手動安裝其他程式庫</a></span></dt><dt><span class="sect2"><a href="#idp69370168">10.2.2. 安裝 <span class="trademark">Linux</span>® <acronym class="acronym">ELF</acronym> Binary</a></span></dt><dt><span class="sect2"><a href="#idp69396408">10.2.3. 安裝以 <span class="trademark">Linux</span>® <acronym class="acronym">RPM</acronym> 為基礎的應用程式</a></span></dt><dt><span class="sect2"><a href="#idp69403832">10.2.4. 設定主機名稱解析器</a></span></dt></dl></dd><dt><span class="sect1"><a href="#linuxemu-advanced">10.3. 進階主題</a></span></dt></dl></dd></dl></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="desktop"></a>章 6. 桌面應用程式</h2></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#desktop-synopsis">6.1. 概述</a></span></dt><dt><span class="sect1"><a href="#desktop-browsers">6.2. 瀏覽器</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67394744">6.2.1. Firefox</a></span></dt><dt><span class="sect2"><a href="#idp67410232">6.2.2. Opera</a></span></dt><dt><span class="sect2"><a href="#idp67448760">6.2.3. Konqueror</a></span></dt><dt><span class="sect2"><a href="#idp67462712">6.2.4. Chromium</a></span></dt></dl></dd><dt><span class="sect1"><a href="#desktop-productivity">6.3. 辦工工具</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67520824">6.3.1. Calligra</a></span></dt><dt><span class="sect2"><a href="#idp67534904">6.3.2. AbiWord</a></span></dt><dt><span class="sect2"><a href="#idp67543736">6.3.3. The GIMP</a></span></dt><dt><span class="sect2"><a href="#idp67555640">6.3.4. Apache OpenOffice</a></span></dt><dt><span class="sect2"><a href="#idp67592760">6.3.5. LibreOffice</a></span></dt></dl></dd><dt><span class="sect1"><a href="#desktop-viewers">6.4. 文件閱覽程式</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67637304">6.4.1. Xpdf</a></span></dt><dt><span class="sect2"><a href="#idp67662392">6.4.2. <span class="application">gv</span></a></span></dt><dt><span class="sect2"><a href="#idp67677496">6.4.3. Geeqie</a></span></dt><dt><span class="sect2"><a href="#idp67688888">6.4.4. ePDFView</a></span></dt><dt><span class="sect2"><a href="#idp67698616">6.4.5. Okular</a></span></dt></dl></dd><dt><span class="sect1"><a href="#desktop-finance">6.5. 財務</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67182008">6.5.1. GnuCash</a></span></dt><dt><span class="sect2"><a href="#idp67760440">6.5.2. Gnumeric</a></span></dt><dt><span class="sect2"><a href="#idp67769528">6.5.3. KMyMoney</a></span></dt></dl></dd></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="desktop-synopsis"></a>6.1. 概述</h2></div></div></div><p>隨著 FreeBSD 優越的效能及穩定性越來越熱門，它同時適合作為每日使用的桌面系統。FreeBSD 套件或 Port 有超過 24,000 個可用的應用程式，可以簡單的建立一個自訂的桌面環境來執行各種不同的桌面應用程式。本章將示範如何安裝數個桌面應用程式，包含網頁瀏覽器、辦工軟體、文件閱覽程式以及財務軟體。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">比起重頭設定與編譯，較偏好使用 FreeBSD 桌面環境已預先編譯好版本的使用者可參考 <a class="link" href="http://www.trueos.org/" target="_top">trueos.org 網站</a>。</p></div><p>在閱讀這章之前，你必須了解如何：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>使用套件或 Port 安裝其他軟體如 <a class="xref" href="#ports" title="章 4. 安裝應用程式：套件與 Port">章 4, <em>安裝應用程式：套件與 Port</em></a> 所敘述。</p></li><li class="listitem"><p>安狀 X 與視窗管理程式如 <a class="xref" href="#x11" title="章 5. X Window 系統">章 5, <em>X Window 系統</em></a> 所敘述。</p></li></ul></div><p>要取得有關如何設定多媒體環境的資訊，請參考 <a class="xref" href="#multimedia" title="章 7. 多媒體">章 7, <em>多媒體</em></a>。</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="desktop-browsers"></a>6.2. 瀏覽器</h2></div></div></div><a id="idp67370680" class="indexterm"></a><p>在 FreeBSD 中並未預先安裝好網頁瀏覽器。 但在 Port 套件集中的 <a class="link" href="https://www.FreeBSD.org/ports/www.html" target="_top">www</a> 分類中有許多瀏覽器可以採 Binary 套件安裝或自 Port 套件集編譯的方式安裝。</p><p><span class="application">KDE</span> 和 <span class="application">GNOME</span> 桌面環境都有提供自有的 HTML 瀏覽器。請參考 <a class="xref" href="#x11-wm" title="5.7. 桌面環境">節 5.7, “桌面環境”</a> 來了解更多有關如何設定完整桌面環境的資訊。</p><p>有一些輕量化的瀏覽器可使用，包含 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/dillo2/pkg-descr">www/dillo2</a>, <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/links/pkg-descr">www/links</a> 以及 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/w3m/pkg-descr">www/w3m</a>。</p><p>本章節將示範如何安裝下列常見的網頁瀏覽器並說明該應用程式是否需要用到大量資源、花費大量時間自 Port 編譯或何主要的相依套件。</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>應用程式名稱</th><th>所需資源</th><th>自 Port 安裝時間</th><th>說明</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><span class="application">Firefox</span></td><td>中</td><td>多</td><td>有 FreeBSD 、 <span class="trademark">Linux</span>® 及在地化版本</td></tr><tr><td xml:lang="en" lang="en"><span class="application">Opera</span></td><td>少</td><td>少</td><td>有 FreeBSD 、 <span class="trademark">Linux</span>® 版本</td></tr><tr><td xml:lang="en" lang="en"><span class="application">Konqueror</span></td><td>中</td><td>多</td><td>需要 <span class="application">KDE</span> 程式庫</td></tr><tr><td xml:lang="en" lang="en"><span class="application">Chromium</span></td><td>中</td><td>多</td><td>需要 <span class="application">Gtk+</span> 程式庫</td></tr></tbody></table></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67394744"></a>6.2.1. Firefox</h3></div></div></div><a id="idp67395512" class="indexterm"></a><p><span class="application">Firefox</span> 是一套開放源始碼的瀏覽器，它具備符合 HTML 標準的顯示引擎、頁籤瀏覽、彈出視窗封鎖、擴充套件、強化安全性及其他更多功能。<span class="application">Firefox</span> 的基礎使用了 <span class="application">Mozilla</span> 的程式庫。</p><p>要安裝最新釋出版本的 <span class="application">Firefox</span> 套件可輸入：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install firefox</code></strong></pre><p>要安裝延長支援發佈 (Extended Support Release, ESR) 版本的 <span class="application">Firefox</span>，可使用：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install firefox-esr</code></strong></pre><p>在地化的版本可在 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/firefox-i18n/pkg-descr">www/firefox-i18n</a> 及 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/firefox-esr-i18n/pkg-descr">www/firefox-esr-i18n</a> 取得。</p><p>使用 Port 套件地可以用原始碼編譯成您想要的 <span class="application">Firefox</span> 版本。此範例編譯 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/firefox/pkg-descr">www/firefox</a>，其中 <code class="literal">firefox</code> 可替換為 ESR 或在地化版本來安裝。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/www/firefox</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67410232"></a>6.2.2. Opera</h3></div></div></div><a id="idp67411000" class="indexterm"></a><p><span class="application">Opera</span> 是個具備完整功能、符合標準且輕量、執行速度快的瀏覽器。 它同時也具備了內建的郵件、新聞閱讀器、IRC 客戶端、RSS/Atom 來源閱讀器等。 可用的版本有兩種原生的 FreeBSD 版本及 <span class="trademark">Linux</span>® 模擬模式下執行的版本。</p><p>以下指令可安裝 FreeBSD Binary 套件版本的 Opera，替換 <code class="literal">opera</code> 為 <code class="literal">linux-opera</code> 則可改安裝 <span class="trademark">Linux</span>® 版本。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install opera</code></strong></pre><p>或者，可安裝 Port 套件集中的版本，以下範例會編譯原生的版本：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/www/opera</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>要安裝 <span class="trademark">Linux</span>® 則替換 <code class="literal">opera</code> 為 <code class="literal">linux-opera</code>。</p><p>要安裝 <span class="trademark">Adobe</span>® <span class="trademark">Flash</span>® 附加元件，需先編譯 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/linux-flashplayer/pkg-descr">www/linux-flashplayer</a> Port，因受到授權條款限制無法事先編譯為 Binary 套件。然後再安裝 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/opera-linuxplugins/pkg-descr">www/opera-linuxplugins</a>。以下範例示範如何編譯 Port 中的這兩個應用程式：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/www/linux-flashplayer</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/www/opera-linuxplugins</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>安裝完成後，開啟瀏覽器檢查附加元件是否存在，在網址列輸入 <code class="literal">opera:plugins</code> 並按下 <span class="keycap"><strong>Enter</strong></span> 鍵，便會有清單顯示目前可用的附加元件。</p><p>若要安裝 <span class="application"><span class="trademark">Java</span>™</span> 附加元件請接著安裝 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/java/icedtea-web/pkg-descr">java/icedtea-web</a>。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67448760"></a>6.2.3. Konqueror</h3></div></div></div><a id="idp67449528" class="indexterm"></a><p><span class="application">Konqueror</span> 不只是個網頁瀏覽器， 它同時也是檔案管理器和多媒體瀏覽器。它包含在 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11/kde4-baseapps/pkg-descr">x11/kde4-baseapps</a> 套件或 Port 中。</p><p><span class="application">Konqueror</span> 使用支援 WebKit 以及它自有的 KTHML。WebKit  是一套被許多現代瀏覽器所使用的繪圖引擎，包含 Chromium。要在 FreeBSD 的 <span class="application">Konqueror</span> 使用 WebKit 需安裝 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/kwebkitpart/pkg-descr">www/kwebkitpart</a> 套件或 Port。此範例示範使用 Binary 套件安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install kwebkitpart</code></strong></pre><p>從 Port 套件集安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/www/kwebkitpart</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>要啟動 <span class="application">Konqueror</span> 中的 WebKit 點選 <span class="quote">“<span class="quote">Settings</span>”</span>、<span class="quote">“<span class="quote">Configure Konqueror</span>”</span>。在 <span class="quote">“<span class="quote">General</span>”</span> 設定頁面內點選 <span class="quote">“<span class="quote">Default web browser engine</span>”</span> 旁的下拉示選單並變更 <span class="quote">“<span class="quote">KHTML</span>”</span> 為 <span class="quote">“<span class="quote">WebKit</span>”</span>。</p><p><span class="application">Konqueror</span> 也支援 <span class="application"><span class="trademark">Flash</span>®</span>，<span class="quote">“<span class="quote">如何</span>”</span>在 <span class="application">Konqueror</span> 上安裝 <span class="application"><span class="trademark">Flash</span>®</span> 的說明可參考 <code class="uri"><a class="uri" href="http://freebsd.kde.org/howtos/konqueror-flash.php" target="_top">http://freebsd.kde.org/howtos/konqueror-flash.php</a></code>。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67462712"></a>6.2.4. Chromium</h3></div></div></div><a id="idp67467576" class="indexterm"></a><p><span class="application">Chromium</span> 是一個開放源始碼的瀏覽器計劃，該計劃的目標是要建立一個安全、快速且更穩定的網頁瀏覽體驗。<span class="application">Chromium</span> 的功能有頁籤式瀏覽、彈出視窗封鎖、擴充套件等等。</p><p><span class="application">Chromium</span> 可以使用套件來安裝，只要輸入：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install chromium</code></strong></pre><p>或者可從 Port 套件集的原始碼編譯 <span class="application">Chromium</span>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/www/chromium</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml"><span class="application">Chromium</span> 的執行檔為 <code class="filename">/usr/local/bin/chrome</code>，並非 <code class="filename">/usr/local/bin/chromium</code>。</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="desktop-productivity"></a>6.3. 辦工工具</h2></div></div></div><p>當開始進行辦公，使用者通常會找好用的辦公軟體或是好上手的文書處理程式。 雖然有些 <a class="link" href="#x11-wm" title="5.7. 桌面環境">桌面環境</a> 像是 <span class="application">KDE</span> 已經提供了辦公軟體，但並沒有預設的辦公軟體，FreeBSD 提供多套辦公軟體以及圖型化文書處理程式，不論您用那種的視窗管理程式都能使用。</p><p>本章節元範如何安裝以下熱門的辦公軟體以及說明該應用程式所需的資源、自 Port 編譯的時間或者是否有其他主要相依套件。</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>應用程式名稱</th><th>所需資源</th><th>自 Port 安裝時間</th><th>主要相依套件</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><span class="application">Calligra</span></td><td>少</td><td>多</td><td xml:lang="en" lang="en"><span class="application">KDE</span></td></tr><tr><td xml:lang="en" lang="en"><span class="application">AbiWord</span></td><td>少</td><td>少</td><td><span class="application">Gtk+</span> 或 <span class="application">GNOME</span></td></tr><tr><td xml:lang="en" lang="en"><span class="application">The Gimp</span></td><td>少</td><td>多</td><td xml:lang="en" lang="en"><span class="application">Gtk+</span></td></tr><tr><td xml:lang="en" lang="en"><span class="application">Apache
		OpenOffice</span></td><td>多</td><td>非常多</td><td><span class="application"><span class="trademark">JDK</span>™</span> 及 <span class="application">Mozilla</span></td></tr><tr><td xml:lang="en" lang="en"><span class="application">LibreOffice</span></td><td>有點多</td><td>非常多</td><td><span class="application">Gtk+</span> 或 <span class="application">KDE</span>/ <span class="application">GNOME</span> 或 <span class="application"><span class="trademark">JDK</span>™</span></td></tr></tbody></table></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67520824"></a>6.3.1. Calligra</h3></div></div></div><a id="idp67521592" class="indexterm"></a><a id="idp67522616" class="indexterm"></a><p>KDE 桌面環境中內含辦公軟體可以與 <span class="application">KDE</span> 分開安裝。<span class="application">Calligra</span> 中也有可在其他辦公軟體中找到的標準元件，如 <span class="application">Words</span> 是文件處理程式、<span class="application">Sheets</span> 是試算表程式、<span class="application">Stage</span> 可管理投影片以及 <span class="application">Karbon</span> 用來繪製圖型文件。</p><p>在 FreeBSD 中 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/editors/calligra/pkg-descr">editors/calligra</a> 可以使用套件或 Port 的方式安裝，要使用套件安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install calligra</code></strong></pre><p>若沒有可用的套件，可改使用 Port 套件集安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/editors/calligra</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67534904"></a>6.3.2. AbiWord</h3></div></div></div><a id="idp67535672" class="indexterm"></a><p><span class="application">AbiWord</span> 是一個免費的文件處理軟體，外觀和感覺都近似於 <span class="application"><span class="trademark">Microsoft</span>® Word</span>。 它非常快速，包含了許多功能而且非常容易上手。</p><p><span class="application">AbiWord</span> 可以輸入或輸出許多檔案格式， 包括一些有專用的格式，例如 <span class="trademark">Microsoft</span>® <code class="filename">.rtf</code> 格式。</p><p>要安裝 <span class="application">AbiWord</span> Binary 套件，可使用下列指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install abiword</code></strong></pre><p>若沒有 Binary 套件版本，也可以從 Port 套件集中編譯安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/editors/abiword</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67543736"></a>6.3.3. The GIMP</h3></div></div></div><a id="idp67544376" class="indexterm"></a><p>對於影像的編輯及修改來說，<span class="application">The GIMP</span> 是非常精緻的影像處理軟體。 它可以當作簡單的繪圖軟體或是高品質的相片處理軟體。 它支援為數眾多的外掛程式及指令稿 (script-fu) 介面。 <span class="application">The GIMP</span> 可以讀寫許多檔案格式。 它也支援掃描器和手寫板。</p><p>要安裝套件可：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install gimp</code></strong></pre><p>或使用 Port 套件集安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/graphics/gimp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>在 Port 套件集的 graphics 分類 (<a class="link" href="https://www.FreeBSD.org/ports/graphics.html" target="_top">freebsd.org/ports/graphics.html</a>) 下也包含了許多 <span class="application">GIMP</span> 相關的附加元件，說明檔及使用手冊。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67555640"></a>6.3.4. Apache OpenOffice</h3></div></div></div><a id="idp67556408" class="indexterm"></a><a id="idp67557688" class="indexterm"></a><p><span class="application">Apache OpenOffice</span> 是開放原始碼的辦工室軟體，由 Apache Software Foundation's Incubator 底下的團隊所開發。 它包含了所有完整的辦公軟體組合： 文字處理器、試算表、簡報軟體還有繪圖軟體。 除了它的使用者介面非常類似其他的辦公軟體， 他還能夠輸入和輸出許多熱門的檔案格式。 它也包含了不同語言的使用者介面、拼字檢查和字典。</p><p><span class="application">Apache OpenOffice</span> 的文字處理器使用原生的 XML 檔案格式來增加移植性及彈性。 試算表程式支援巨集 (Macro) 功能而且能夠使用外來的資料庫介面。 <span class="application">Apache OpenOffice</span> 已經十分穩定， 並且能夠在 <span class="trademark">Windows</span>®, <span class="trademark">Solaris</span>™, <span class="trademark">Linux</span>®, FreeBSD 及 <span class="trademark">Mac OS</span>® X 等作業系統上面執行。 想知道更多關於 <span class="application">Apache OpenOffice</span> 的資訊可以在 <a class="link" href="http://openoffice.org/" target="_top">openoffice.org</a> 網頁上查詢。在 FreeBSD 特定的資訊可參考 <a class="link" href="http://porting.openoffice.org/freebsd/" target="_top">porting.openoffice.org/freebsd/</a>。</p><p>要安裝 <span class="application">Apache OpenOffice</span> 套件：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install apache-openoffice</code></strong></pre><p>當套件安裝完成之後，只要輸入下面的指令就能執行 <span class="application">Apache OpenOffice</span>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>openoffice-<em class="replaceable"><code>X.Y.Z</code></em></code></strong></pre><p>其中 <em class="replaceable"><code>X.Y.Z</code></em> 是已安裝的 <span class="application">Apache OpenOffice</span> 的版本編號。第一次執行 <span class="application">Apache OpenOffice</span> 會詢問一些問題且會在使用者的家目錄建立一個 <code class="filename">.openoffice.org</code> 資料夾。</p><p>若無法由套件取得想要的 <span class="application">Apache OpenOffice</span>，仍可選擇從 Port 編譯。 不過必須注意：編譯的過程會需要大量的磁碟空間與時間：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/editors/openoffice-4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">如果想要編譯在地化的版本，將前面的指令替換成為：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>make LOCALIZED_LANG=<em class="replaceable"><code>your_language</code></em> install clean</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">替換 <em class="replaceable"><code>your_language</code></em> 為正確的語言 ISO 編碼。支援的語言編碼清單在 <code class="filename">files/Makefile.localized</code>，位於該 Port 的目錄。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67592760"></a>6.3.5. LibreOffice</h3></div></div></div><a id="idp67593528" class="indexterm"></a><a id="idp67594552" class="indexterm"></a><p><span class="application">LibreOffice</span> 是一套自由的辦公軟體由 <a class="link" href="http://www.documentfoundation.org/" target="_top">documentfoundation.org</a> 所開發。它可相容其他主流的辦公軟體以及可在各種平台上使用。它是 <span class="application">Apache OpenOffice</span> 品牌重塑後的分支，含有可在完整辦公生產力軟體中找到的應用程式：文件處理程式、試算表、簡報管理程式、繪圖程式、資料庫管理程式以及建立與編輯數學公式的工具。它也支援數種語言與國際化一直延伸到介面、拼字檢查程式與字典。</p><p><span class="application">LibreOffice</span> 的文件處理程式使用了原生的 XML 檔案格式來增加可攜性與彈性，試算表程式支援可與外部資料庫連接的巨集語言。<span class="application">LibreOffice</span> 非常穩定且可直接在 <span class="trademark">Windows</span>®, <span class="trademark">Linux</span>®, FreeBSD 以及 <span class="trademark">Mac OS</span>® X 上執行。更多有關 <span class="application">LibreOffice</span> 的資訊可在 <a class="link" href="http://www.libreoffice.org/" target="_top">libreoffice.org</a> 找到。</p><p>要安裝英文版本的 <span class="application">LibreOffice</span> 套件：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install libreoffice</code></strong></pre><p>Port 套件集的編輯器分類 (<a class="link" href="https://www.FreeBSD.org/ports/editors.html" target="_top">freebsd.org/ports/editors.html</a>) 中含有數個 <span class="application">LibreOffice</span> 的語系。安裝在地化套件時，請替換 <code class="literal">libreoffice</code> 為在地化套件的名稱。</p><p>套件安裝之後，輸入以下指令來執行 <span class="application">LibreOffice</span>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>libreoffice</code></strong></pre><p>第一次啟動的過程中會詢問一些問題並在使用者的家目錄建立 <code class="filename">.libreoffice</code> 資料夾。</p><p>若找不到想使用的 <span class="application">LibreOffice</span> 套件，也可從 Port 編譯，但這會要大量的磁碟空間及漫長的時間編譯。以下例子示範編譯英文版本：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/editors/libreoffice</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">要編譯在地化版本，則需 <code class="command">cd</code> 進入想要的語言 Port 目錄。支援的語言可在 Port 套件集的編輯器分類 (<a class="link" href="https://www.FreeBSD.org/ports/editors.html" target="_top">freebsd.org/ports/editors.html</a>) 中找到。</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="desktop-viewers"></a>6.4. 文件閱覽程式</h2></div></div></div><p><span class="trademark">UNIX</span>® 出現之後，有一些新的文件格式才越來越熱門，這些文件所需的檢視程式可能並不在基礎系統中。本節將示範如何安裝以下文件檢視程式：</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>應用程式名稱</th><th>所需資源</th><th>自 Port 安裝時間</th><th>主要相依套件</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><span class="application">Xpdf</span></td><td>少</td><td>少</td><td xml:lang="en" lang="en"><span class="application">FreeType</span></td></tr><tr><td xml:lang="en" lang="en"><span class="application">gv</span></td><td>少</td><td>少</td><td xml:lang="en" lang="en"><span class="application">Xaw3d</span></td></tr><tr><td><span class="application">Geeqie</span></td><td>少</td><td>少</td><td><span class="application">Gtk+</span> 或 <span class="application">GNOME</span></td></tr><tr><td xml:lang="en" lang="en"><span class="application">ePDFView</span></td><td>少</td><td>少</td><td xml:lang="en" lang="en"><span class="application">Gtk+</span></td></tr><tr><td xml:lang="en" lang="en"><span class="application">Okular</span></td><td>少</td><td>多</td><td xml:lang="en" lang="en"><span class="application">KDE</span></td></tr></tbody></table></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67637304"></a>6.4.1. Xpdf</h3></div></div></div><a id="idp67638072" class="indexterm"></a><a id="idp67655480" class="indexterm"></a><p>如果你想要一個小型的 FreeBSD PDF 閱覽軟體， <span class="application">Xpdf</span> 是個輕量級而且有效率的閱覽器。 它只需要非常少的資源而且十分穩定。 它只使用標準的 X 字型且不需要額外的工具包(Toolkit)。</p><p>安裝 <span class="application">Xpdf</span> 套件：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install xpdf</code></strong></pre><p>若沒有可用的套件版本，可使用 Port 套件集安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/graphics/xpdf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>完成安裝後，執行 <code class="command">xpdf</code> 並使用滑鼠右鍵開啟選單。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67662392"></a>6.4.2. <span class="application">gv</span></h3></div></div></div><a id="idp67663288" class="indexterm"></a><a id="idp67664312" class="indexterm"></a><a id="idp67665592" class="indexterm"></a><p><span class="application">gv</span> 是 <span class="trademark">PostScript</span>® 和 PDF 的閱覽器。 它建構於 <span class="application">ghostview</span> 的基礎上，不過因為使用 <span class="application">Xaw3d</span> 視窗元件工具包，所以外觀看起來比較漂亮。 <span class="application">gv</span> 有許多可設定的功能，比如說紙張方向、紙張大小、縮放比例、和反鋸齒(Anti-aliasing)等。 而且幾乎所有的使用都可以從鍵盤或滑鼠來完成。</p><p>安裝 <span class="application">gv</span> 套件：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install gv</code></strong></pre><p>若沒有可用的套件版本，可使用 Port 套件集安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/print/gv</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67677496"></a>6.4.3. Geeqie</h3></div></div></div><a id="idp67678264" class="indexterm"></a><p><span class="application">Geeqie</span> 是由已經停止維護的 <span class="application">GQView</span> 專案所衍伸出來的分支，並致力開發新功能並整合已有的修補。<span class="application">Geeqie</span> 是一套影像管理軟體，支援單鍵閱覽檔案、啟動外部編輯器、縮圖預覽等功能。 它也有幻燈片模式及一些基本的檔案操作的功能，能輕鬆的管理大量影像並找出重複的檔案。 <span class="application">Geeqie</span> 也支援使用全螢幕閱覽以及國際化。</p><p>安裝 <span class="application">Geeqie</span> 套件：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install geeqie</code></strong></pre><p>若沒有可用的套件版本，可使用 Port 套件集安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/graphics/geeqie</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67688888"></a>6.4.4. ePDFView</h3></div></div></div><a id="idp67689656" class="indexterm"></a><a id="idp67690680" class="indexterm"></a><p><span class="application">ePDFView</span> 是一套小巧的 <acronym class="acronym">PDF</acronym> 文件檢視程式，只使用了 <span class="application">Gtk+</span> 與 <span class="application">Poppler</span> 程式庫。它目前還在開發當中，但已經可以開啟大部份 <acronym class="acronym">PDF</acronym> 檔案 (甚至是加密過的)、儲存文件複本以及支援使用 <span class="application">CUPS</span> 來列印。</p><p>要以套件安裝 <span class="application">ePDFView</span>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install epdfview</code></strong></pre><p>若沒有可用的套件版本，可使用 Port 套件集安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/graphics/epdfview</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67698616"></a>6.4.5. Okular</h3></div></div></div><a id="idp67699384" class="indexterm"></a><a id="idp67700408" class="indexterm"></a><p><span class="application">Okular</span> 是一套通用的文件檢視程式，以 <span class="application">KDE</span> 的 <span class="application">KPDF</span> 為基礎。它可以開啟許多種文件格式，包含了 <acronym class="acronym">PDF</acronym>, <span class="trademark">PostScript</span>®, DjVu, <acronym class="acronym">CHM</acronym>, <acronym class="acronym">XPS</acronym> 以及 ePub。</p><p>要以套件安裝 <span class="application">Okular</span>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install okular</code></strong></pre><p>若沒有可用的套件版本，可使用 Port 套件集安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/graphics/okular</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="desktop-finance"></a>6.5. 財務</h2></div></div></div><p>如果有任何理由你想要在你的 FreeBSD 桌面環境上管理你的個人財務， 這裡有一些功能強大、使用簡單的應用程式可供安裝。 這些財務管理軟體之中有些是相容於流行的 <span class="application">Quicken</span> 或 <span class="application">Excel</span> 文件。</p><p>這節涵蓋了下面這些軟體：</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>應用程式名稱</th><th>所需資源</th><th>自 Port 安裝時間</th><th>主要相依套件</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><span class="application">GnuCash</span></td><td>少</td><td>多</td><td xml:lang="en" lang="en"><span class="application">GNOME</span></td></tr><tr><td xml:lang="en" lang="en"><span class="application">Gnumeric</span></td><td>少</td><td>多</td><td xml:lang="en" lang="en"><span class="application">GNOME</span></td></tr><tr><td xml:lang="en" lang="en"><span class="application">KMyMoney</span></td><td>少</td><td>多</td><td xml:lang="en" lang="en"><span class="application">KDE</span></td></tr></tbody></table></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67182008"></a>6.5.1. GnuCash</h3></div></div></div><a id="idp67182776" class="indexterm"></a><p><span class="application">GnuCash</span> 是 <span class="application">GNOME</span> 團隊努力成果中的一部分， <span class="application">GNOME</span> 團隊主要提供親切而強大的桌面應用程式給終端使用者。使用 <span class="application">GnuCash</span> 可以持續追蹤收入與花費、銀行帳戶以及股票證券等。 它的特性是介面直覺但功能仍非常專業。</p><p><span class="application">GnuCash</span> 提供了智慧的計數器、多階層帳戶系統以及快速鍵及自動完成功能。 它也能分開單一的報表至數個詳細的部份。 <span class="application">GnuCash</span> 也能夠匯入及合併 <span class="application">Quicken</span> QIF 檔案。 它也能處理大部分國際的日期及通用貨幣之格式。</p><p>安裝 <span class="application">GnuCash</span> 套件：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install gnucash</code></strong></pre><p>若沒有可用的套件版本，可使用 Port 套件集安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/finance/gnucash</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67760440"></a>6.5.2. Gnumeric</h3></div></div></div><a id="idp67761208" class="indexterm"></a><a id="idp67426360" class="indexterm"></a><p><span class="application">Gnumeric</span> 是 <span class="application">GNOME</span> 社群所開發的試算表程式。 它的特點是擁有能夠根據儲存格格式 「猜出」使用者的輸入來自動補齊的系統。 它也能夠匯入許多熱門的檔案格式，像是 <span class="application">Excel</span>, <span class="application">Lotus 1-2-3</span> 以及 <span class="application">Quattro Pro</span>。 它有大量內建的函數而且能夠使用常用的儲存格格式，像是：數字、貨幣、日期、時間及其他格式等。</p><p>安裝 <span class="application">Gnumeric</span> 套件：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install gnumeric</code></strong></pre><p>若沒有可用的套件版本，可使用 Port 套件集安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/math/gnumeric</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67769528"></a>6.5.3. KMyMoney</h3></div></div></div><a id="idp67770296" class="indexterm"></a><a id="idp67771064" class="indexterm"></a><p><span class="application">KMyMoney</span> 是一套個人財務應用程式，由 <span class="application">KDE</span> 社群所開發。<span class="application">KMyMoney</span> 的目標是提供可在商業個人財務管理應用程式中找到的重要功能，它也強調簡單易用及其功能間採用合適的複式記帳。<span class="application">KMyMoney</span> 可從標準 <span class="application">Quicken</span> QIF 檔案匯入資料、追蹤投資、處理多種貨幣並提供財務報表。</p><p>要以套件安裝 <span class="application">KMyMoney</span>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install kmymoney-kde4</code></strong></pre><p>若沒有可用的套件版本，可使用 Port 套件集安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/finance/kmymoney-kde4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="multimedia"></a>章 7. 多媒體</h2></div><div><span class="authorgroup">Edited by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Ross</span> <span class="surname">Lippert</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#multimedia-synopsis">7.1. 概述</a></span></dt><dt><span class="sect1"><a href="#sound-setup">7.2. 設定音效卡</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67835832">7.2.1. 設定自訂核心支援音效</a></span></dt><dt><span class="sect2"><a href="#sound-testing">7.2.2. 測試音效</a></span></dt><dt><span class="sect2"><a href="#bluetooth-headset">7.2.3. 設定藍芽音效裝置</a></span></dt><dt><span class="sect2"><a href="#troubleshooting">7.2.4. 疑難排解音效</a></span></dt><dt><span class="sect2"><a href="#sound-multiple-sources">7.2.5. 使用多個音效來源</a></span></dt><dt><span class="sect2"><a href="#idp67973816">7.2.6. 設定混音器頻道的預設值</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sound-mp3">7.3. MP3 音樂</a></span></dt><dd><dl><dt><span class="sect2"><a href="#mp3-players">7.3.1. MP3 播放器</a></span></dt><dt><span class="sect2"><a href="#rip-cd">7.3.2. 擷取 <acronym class="acronym">CD</acronym> 音軌</a></span></dt><dt><span class="sect2"><a href="#mp3-encoding">7.3.3. MP3 編碼與解碼</a></span></dt></dl></dd><dt><span class="sect1"><a href="#video-playback">7.4. 影片播放</a></span></dt><dd><dl><dt><span class="sect2"><a href="#video-interface">7.4.1. 偵測影像處理能力</a></span></dt><dd><dl><dt><span class="sect3"><a href="#video-interface-xvideo">7.4.1.1. XVideo</a></span></dt></dl></dd><dt><span class="sect2"><a href="#video-ports">7.4.2. 可處理影像的 Port 與套件</a></span></dt><dd><dl><dt><span class="sect3"><a href="#video-mplayer">7.4.2.1. <span class="application">MPlayer</span> 與 <span class="application">MEncoder</span></a></span></dt><dt><span class="sect3"><a href="#video-xine">7.4.2.2. <span class="application">xine</span> 影像播放器</a></span></dt><dt><span class="sect3"><a href="#video-ports-transcode">7.4.2.3. <span class="application">Transcode</span> 工具</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#tvcard">7.5. 電視卡</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp68325176">7.5.1. 載入驅動程式</a></span></dt><dt><span class="sect2"><a href="#idp68340024">7.5.2. 好用的應用程式</a></span></dt><dt><span class="sect2"><a href="#idp68357944">7.5.3. 疑難排解</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mythtv">7.6. MythTV</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp68379576">7.6.1. 硬體</a></span></dt><dt><span class="sect2"><a href="#idp68389944">7.6.2. 設定 MythTV 後端</a></span></dt></dl></dd><dt><span class="sect1"><a href="#scanners">7.7. 影像掃描器</a></span></dt><dd><dl><dt><span class="sect2"><a href="#scanners-kernel-usb">7.7.1. 檢查掃描器</a></span></dt><dt><span class="sect2"><a href="#idp68455608">7.7.2. <span class="application">SANE</span> 設定</a></span></dt><dt><span class="sect2"><a href="#idp68507704">7.7.3. 掃描器權限</a></span></dt></dl></dd></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="multimedia-synopsis"></a>7.1. 概述</h2></div></div></div><p>FreeBSD 廣泛地支援各種音效卡， 讓使用者可以享受來自電腦上的高傳真音質(Hi-Fi)， 此外還包括了錄製和播放 MPEG Audio Layer 3 (<acronym class="acronym">MP3</acronym>)、 Waveform Audio File (<acronym class="acronym">WAV</acronym>)、Ogg Vorbis 以及其他許多種格式聲音的能力。同時 FreeBSD Port 套件集也包含了許多可讓您可以錄音、編修音效以及控制 MIDI 配備的應用程式。</p><p>FreeBSD 也能播放一般的視訊檔和 <acronym class="acronym">DVD</acronym>。 FreeBSD Port 套件集中含有可編碼、轉換以及播放格種影像媒體的應用程式。</p><p>本章會說明如何設定 FreeBSD 上的音效卡、影像播放器、電視卡及掃描器。同時會說明有那些應用程式可以使用這些裝置。</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>設定 FreeBSD 上的音效卡。</p></li><li class="listitem"><p>音效設定疑難排解。</p></li><li class="listitem"><p>播放、錄製 MP3 及其他聲音檔案格式。</p></li><li class="listitem"><p>FreeBSD 系統播放影像的準備工具。</p></li><li class="listitem"><p>播放 <acronym class="acronym">DVD</acronym> 的 <code class="filename">.mpg</code> 及 <code class="filename">.avi</code> 檔。</p></li><li class="listitem"><p>擷取(Rip) <acronym class="acronym">CD</acronym> 和 <acronym class="acronym">DVD</acronym>的內容至檔案。</p></li><li class="listitem"><p>設定電視卡。</p></li><li class="listitem"><p>在 FreeBSD 安裝 MythTV</p></li><li class="listitem"><p>設定影像掃描機。</p></li><li class="listitem"><p>設定藍芽耳機。</p></li></ul></div><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>知道如何安裝應用程式如 <a class="xref" href="#ports" title="章 4. 安裝應用程式：套件與 Port">章 4, <em>安裝應用程式：套件與 Port</em></a> 所敘述。</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="sound-setup"></a>7.2. 設定音效卡</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Moses</span> <span class="surname">Moore</span></span>. </span></div><div><span class="authorgroup">Enhanced by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><a id="idp67820728" class="indexterm"></a><a id="idp67821368" class="indexterm"></a><p>開始設定之前，必須先知道你的音效卡型號、晶片為何。 FreeBSD 支援許多種音效卡，請檢查支援的音效硬體表 <a class="link" href="https://www.FreeBSD.org/releases/12.0R/hardware.html" target="_top">Hardware Notes</a>，以確認你的音效卡是否支援以及如何在 FreeBSD 上驅動。</p><a id="idp67822904" class="indexterm"></a><p>要使用音效裝置，必須要載入正確的驅動程式才行。最簡單方式就是以 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a> 來載入核心模組。以下範例示範載入 Intel 規格內建的音效晶片驅動程式：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload snd_hda</code></strong></pre><p>要開機時自動載入驅動程式，需將驅動程式加到 <code class="filename">/boot/loader.conf</code> 檔，以此驅動程式為例：</p><pre xml:lang="en" class="programlisting" lang="en">snd_hda_load="YES"</pre><p>其他可用的音效卡模組清單列於 <code class="filename">/boot/defaults/loader.conf</code>。當不確認要使用何種驅動程式時，可載入 <code class="filename">snd_driver</code> 模組：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload snd_driver</code></strong></pre><p>它是 metadriver 會載入所有最通用的音效驅動程式並且用來加速尋找正確的驅動程式。也可以把 metadriver 加入 <code class="filename">/boot/loader.conf</code> 檔來載入所有音效驅動程式。</p><p>要知道載入 <code class="filename">snd_driver</code> metadriver 後使用了那個音效卡驅動程式，請輸入 <code class="command">cat /dev/sndstat</code>。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67835832"></a>7.2.1. 設定自訂核心支援音效</h3></div></div></div><p xml:lang="en" lang="en">This section is for users who prefer to statically compile
	in support for the sound card in a custom kernel.  For more
	information about recompiling a kernel, refer to <a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a>.</p><p xml:lang="en" lang="en">When using a custom kernel to provide sound support, make
	sure that the audio framework driver exists in the custom
	kernel configuration file:</p><pre xml:lang="en" class="programlisting" lang="en">device sound</pre><p xml:lang="en" lang="en">Next, add support for the sound card.  To continue the
	example of the built-in audio chipset based on the Intel
	specification from the previous section, use the following
	line in the custom kernel configuration file:</p><pre xml:lang="en" class="programlisting" lang="en">device snd_hda</pre><p xml:lang="en" lang="en">Be sure to read the manual page of the driver for the
	device name to use for the driver.</p><p xml:lang="en" lang="en">Non-PnP ISA sound cards may require the IRQ and I/O port
	settings of the card to be added to
	<code class="filename">/boot/device.hints</code>.  During the boot
	process, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a> reads this file and passes the
	settings to the kernel.  For example, an old Creative
	<span class="trademark">SoundBlaster</span>® 16 ISA non-PnP card will use the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=snd_sbc&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">snd_sbc</span>(4)</span></a> driver in conjunction with
	<code class="literal">snd_sb16</code>.  For this card, the following
	lines must be added to the kernel configuration file:</p><pre xml:lang="en" class="programlisting" lang="en">device snd_sbc
device snd_sb16</pre><p xml:lang="en" lang="en">If the card uses the <code class="literal">0x220</code> I/O port and
	IRQ <code class="literal">5</code>, these lines must also be added to
	<code class="filename">/boot/device.hints</code>:</p><pre xml:lang="en" class="programlisting" lang="en">hint.sbc.0.at="isa"
hint.sbc.0.port="0x220"
hint.sbc.0.irq="5"
hint.sbc.0.drq="1"
hint.sbc.0.flags="0x15"</pre><p xml:lang="en" lang="en">The syntax used in <code class="filename">/boot/device.hints</code>
	is described in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sound&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sound</span>(4)</span></a> and the manual page for the
	driver of the sound card.</p><p xml:lang="en" lang="en">The settings shown above are the defaults.  In some
	cases, the IRQ or other settings may need to be changed to
	match the card.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=snd_sbc&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">snd_sbc</span>(4)</span></a> for more information
	about this card.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sound-testing"></a>7.2.2. 測試音效</h3></div></div></div><p xml:lang="en" lang="en">After loading the required module or rebooting into the
	custom kernel, the sound card should be detected.  To confirm,
	run <code class="command">dmesg | grep pcm</code>.  This example is
	from a system with a built-in Conexant CX20590 chipset:</p><pre xml:lang="en" class="screen" lang="en">pcm0: &lt;NVIDIA (0x001c) (HDMI/DP 8ch)&gt; at nid 5 on hdaa0
pcm1: &lt;NVIDIA (0x001c) (HDMI/DP 8ch)&gt; at nid 6 on hdaa0
pcm2: &lt;Conexant CX20590 (Analog 2.0+HP/2.0)&gt; at nid 31,25 and 35,27 on hdaa1</pre><p xml:lang="en" lang="en">The status of the sound card may also be checked using
	this command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cat /dev/sndstat</code></strong>
FreeBSD Audio Driver (newpcm: 64bit 2009061500/amd64)
Installed devices:
pcm0: &lt;NVIDIA (0x001c) (HDMI/DP 8ch)&gt; (play)
pcm1: &lt;NVIDIA (0x001c) (HDMI/DP 8ch)&gt; (play)
pcm2: &lt;Conexant CX20590 (Analog 2.0+HP/2.0)&gt; (play/rec) default</pre><p xml:lang="en" lang="en">The output will vary depending upon the sound card.  If no
	<code class="filename">pcm</code> devices are listed, double-check
	that the correct device driver was loaded or compiled into the
	kernel.  The next section lists some common problems and their
	solutions.</p><p xml:lang="en" lang="en">If all goes well, the sound card should now work in FreeBSD.
	If the <acronym class="acronym">CD</acronym> or <acronym class="acronym">DVD</acronym> drive
	is properly connected to the sound card, one can insert an
	audio <acronym class="acronym">CD</acronym> in the drive and play it with
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cdcontrol&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cdcontrol</span>(1)</span></a>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>cdcontrol -f /dev/acd0 play 1</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Audio <acronym class="acronym">CD</acronym>s have specialized encodings
	  which means that they should not be mounted using
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a>.</p></div><p xml:lang="en" lang="en">Various applications, such as
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/workman/pkg-descr">audio/workman</a>, provide a friendlier
	interface.  The <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/mpg123/pkg-descr">audio/mpg123</a> port can be
	installed to listen to MP3 audio files.</p><p xml:lang="en" lang="en">Another quick way to test the card is to send data to
	<code class="filename">/dev/dsp</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>cat <em class="replaceable"><code>filename</code></em> &gt; /dev/dsp</code></strong></pre><p xml:lang="en" lang="en">where
	<code class="filename"><em class="replaceable"><code>filename</code></em></code> can
	be any type of file.  This command should produce some noise,
	confirming that the sound card is working.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The <code class="filename">/dev/dsp*</code> device nodes will
	  be created automatically as needed.  When not in use, they
	  do not exist and will not appear in the output of
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bluetooth-headset"></a>7.2.3. 設定藍芽音效裝置</h3></div></div></div><a id="idp67891512" class="indexterm"></a><p xml:lang="en" lang="en">Connecting to a Bluetooth device is out of scope for this
	chapter.  Refer to <a class="xref" href="#network-bluetooth" title="31.5. 藍牙">節 31.5, “藍牙”</a> for more information.</p><p xml:lang="en" lang="en">To get Bluetooth sound sink working with FreeBSD's sound
	system, users have to install
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/virtual_oss/pkg-descr">audio/virtual_oss</a> first:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install virtual_oss</code></strong></pre><p xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/virtual_oss/pkg-descr">audio/virtual_oss</a> requires
	<code class="literal">cuse</code> to be loaded into the kernel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload cuse</code></strong></pre><p xml:lang="en" lang="en">To load <code class="literal">cuse</code> during system startup, run
	this command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /boot/loader.conf cuse_load=yes</code></strong></pre><p xml:lang="en" lang="en">To use headphones as a sound sink with
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/virtual_oss/pkg-descr">audio/virtual_oss</a>, users need to create a
	virtual device after connecting to a Bluetooth audio
	device:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>virtual_oss -C 2 -c 2 -r 48000 -b 16 -s 768 -R /dev/null -P /dev/bluetooth/<em class="replaceable"><code>headphones</code></em> -d dsp</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><em class="replaceable"><code>headphones</code></em> in this example is
	  a hostname from <code class="filename">/etc/bluetooth/hosts</code>.
	  <code class="literal">BT_ADDR</code> could be used instead.</p></div><p>請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=virtual_oss&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">virtual_oss</span>(8)</span></a> 取得更多資訊。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="troubleshooting"></a>7.2.4. 疑難排解音效</h3></div></div></div><a id="idp67683640" class="indexterm"></a><a id="idp67905464" class="indexterm"></a><a id="idp67906104" class="indexterm"></a><a id="idp67906744" class="indexterm"></a><p xml:lang="en" lang="en"><a class="xref" href="#multimedia-sound-common-error-messages" title="表格 7.1. 常見錯誤訊息">表格 7.1, “常見錯誤訊息”</a>
	lists some common error messages and their solutions:</p><div class="table"><a id="multimedia-sound-common-error-messages"></a><div class="table-title">表格 7.1. 常見錯誤訊息</div><div class="table-contents"><table summary="常見錯誤訊息" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>錯誤</th><th>解決方式</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><span class="errorname">sb_dspwr(XX) timed
		  out</span></td><td><p xml:lang="en" lang="en">The I/O port is not set
		correctly.</p></td></tr><tr><td xml:lang="en" lang="en"><span class="errorname">bad irq XX</span></td><td><p xml:lang="en" lang="en">The IRQ is set incorrectly.  Make sure
		that the set IRQ and the sound IRQ are the
		same.</p></td></tr><tr><td xml:lang="en" lang="en"><span class="errorname">xxx: gus pcm not attached, out of
		  memory</span></td><td><p xml:lang="en" lang="en">There is not enough available memory to
		use the device.</p></td></tr><tr><td xml:lang="en" lang="en"><span class="errorname">xxx: can't open
		  /dev/dsp!</span></td><td><p xml:lang="en" lang="en">Type <code class="command">fstat | grep
		  dsp</code> to check if another application is
		holding the device open.  Noteworthy troublemakers are
		<span class="application">esound</span> and
		<span class="application">KDE</span>'s sound
		support.</p></td></tr></tbody></table></div></div><br class="table-break" /><p xml:lang="en" lang="en">Modern graphics cards often come with their own sound
	driver for use with <acronym class="acronym">HDMI</acronym>.  This sound
	device is sometimes enumerated before the sound card meaning
	that the sound card will not be used as the default playback
	device.  To check if this is the case, run
	<span class="application">dmesg</span> and look for
	<code class="literal">pcm</code>.  The output looks something like
	this:</p><pre xml:lang="en" class="programlisting" lang="en">...
hdac0: HDA Driver Revision: 20100226_0142
hdac1: HDA Driver Revision: 20100226_0142
hdac0: HDA Codec #0: NVidia (Unknown)
hdac0: HDA Codec #1: NVidia (Unknown)
hdac0: HDA Codec #2: NVidia (Unknown)
hdac0: HDA Codec #3: NVidia (Unknown)
pcm0: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 0 nid 1 on hdac0
pcm1: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 1 nid 1 on hdac0
pcm2: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 2 nid 1 on hdac0
pcm3: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 3 nid 1 on hdac0
hdac1: HDA Codec #2: Realtek ALC889
pcm4: &lt;HDA Realtek ALC889 PCM #0 Analog&gt; at cad 2 nid 1 on hdac1
pcm5: &lt;HDA Realtek ALC889 PCM #1 Analog&gt; at cad 2 nid 1 on hdac1
pcm6: &lt;HDA Realtek ALC889 PCM #2 Digital&gt; at cad 2 nid 1 on hdac1
pcm7: &lt;HDA Realtek ALC889 PCM #3 Digital&gt; at cad 2 nid 1 on hdac1
...</pre><p xml:lang="en" lang="en">In this example, the graphics card
	(<code class="literal">NVidia</code>) has been enumerated before the
	sound card (<code class="literal">Realtek ALC889</code>).  To use the
	sound card as the default playback device, change
	<code class="varname">hw.snd.default_unit</code> to the unit that should
	be used for playback:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.snd.default_unit=<em class="replaceable"><code>n</code></em></code></strong></pre><p xml:lang="en" lang="en">where <code class="literal">n</code> is the number of the sound
	device to use.  In this example, it should be
	<code class="literal">4</code>.  Make this change permanent by adding
	the following line to
	<code class="filename">/etc/sysctl.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">hw.snd.default_unit=<em class="replaceable"><code>4</code></em></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sound-multiple-sources"></a>7.2.5. 使用多個音效來源</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Munish</span> <span class="surname">Chopra</span></span>. </span></div></div></div><p xml:lang="en" lang="en">It is often desirable to have multiple sources of sound
	that are able to play simultaneously.  FreeBSD uses
	<span class="quote">“<span class="quote">Virtual Sound Channels</span>”</span> to multiplex the sound
	card's playback by mixing sound in the kernel.</p><p xml:lang="en" lang="en">Three <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> knobs are available for configuring
	virtual channels:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysctl dev.pcm.0.play.vchans=4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl dev.pcm.0.rec.vchans=4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.snd.maxautovchans=4</code></strong></pre><p xml:lang="en" lang="en">This example allocates four virtual channels, which is a
	practical number for everyday use.  Both
	<code class="varname">dev.pcm.0.play.vchans=4</code> and
	<code class="varname">dev.pcm.0.rec.vchans=4</code> are configurable
	after a device has been attached and represent the number of
	virtual channels <code class="filename">pcm0</code> has for playback
	and recording.  Since the <code class="filename">pcm</code> module can
	be loaded independently of the hardware drivers,
	<code class="varname">hw.snd.maxautovchans</code> indicates how many
	virtual channels will be given to an audio device when it is
	attached.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pcm&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pcm</span>(4)</span></a> for more information.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The number of virtual channels for a device cannot be
	  changed while it is in use.  First, close any programs using
	  the device, such as music players or sound daemons.</p></div><p xml:lang="en" lang="en">The correct <code class="filename">pcm</code> device will
	automatically be allocated transparently to a program that
	requests <code class="filename">/dev/dsp0</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67973816"></a>7.2.6. 設定混音器頻道的預設值</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Josef</span> <span class="surname">El-Rayes</span></span>. </span></div></div></div><p xml:lang="en" lang="en">The default values for the different mixer channels are
	hardcoded in the source code of the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pcm&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pcm</span>(4)</span></a> driver.  While
	sound card mixer levels can be changed using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mixer&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mixer</span>(8)</span></a> or
	third-party applications and daemons, this is not a permanent
	solution.  To instead set default mixer values at the driver
	level, define the appropriate values in
	<code class="filename">/boot/device.hints</code>, as seen in this
	example:</p><pre xml:lang="en" class="programlisting" lang="en">hint.pcm.0.vol="50"</pre><p xml:lang="en" lang="en">This will set the volume channel to a default value of
	<code class="literal">50</code> when the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pcm&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pcm</span>(4)</span></a> module is
	loaded.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="sound-mp3"></a>7.3. MP3 音樂</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Chern</span> <span class="surname">Lee</span></span>. </span></div></div></div><p xml:lang="en" lang="en">This section describes some <acronym class="acronym">MP3</acronym>
      players available for FreeBSD, how to rip audio
      <acronym class="acronym">CD</acronym> tracks, and how to encode and decode
      <acronym class="acronym">MP3</acronym>s.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mp3-players"></a>7.3.1. MP3 播放器</h3></div></div></div><p xml:lang="en" lang="en">A popular graphical <acronym class="acronym">MP3</acronym> player is
	<span class="application">Audacious</span>.  It supports
	<span class="application">Winamp</span> skins and additional
	plugins.  The interface is intuitive, with a playlist, graphic
	equalizer, and more.  Those familiar with
	<span class="application">Winamp</span> will find
	<span class="application">Audacious</span> simple to use.  On FreeBSD,
	<span class="application">Audacious</span> can be installed from the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/audacious/pkg-descr">multimedia/audacious</a> port or package.
	Audacious is a descendant of XMMS.</p><p xml:lang="en" lang="en">The <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/mpg123/pkg-descr">audio/mpg123</a> package or port
	provides an alternative, command-line <acronym class="acronym">MP3</acronym>
	player.  Once installed, specify the <acronym class="acronym">MP3</acronym>
	file to play on the command line.  If the system has multiple
	audio devices, the sound device can also be specified:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mpg123 <em class="replaceable"><code>-a /dev/dsp1.0 Foobar-GreatestHits.mp3</code></em></code></strong>
High Performance MPEG 1.0/2.0/2.5 Audio Player for Layers 1, 2 and 3
        version 1.18.1; written and copyright by Michael Hipp and others
        free software (LGPL) without any warranty but with best wishes

Playing MPEG stream from Foobar-GreatestHits.mp3 ...
MPEG 1.0 layer III, 128 kbit/s, 44100 Hz joint-stereo</pre><p xml:lang="en" lang="en">Additional <acronym class="acronym">MP3</acronym> players are available in
	the FreeBSD Ports Collection.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="rip-cd"></a>7.3.2. 擷取 <acronym class="acronym">CD</acronym> 音軌</h3></div></div></div><p xml:lang="en" lang="en">Before encoding a <acronym class="acronym">CD</acronym> or
	<acronym class="acronym">CD</acronym> track to <acronym class="acronym">MP3</acronym>, the
	audio data on the <acronym class="acronym">CD</acronym> must be ripped to the
	hard drive.  This is done by copying the raw
	<acronym class="acronym">CD</acronym> Digital Audio (<acronym class="acronym">CDDA</acronym>)
	data to <acronym class="acronym">WAV</acronym> files.</p><p xml:lang="en" lang="en">The <code class="command">cdda2wav</code> tool, which is installed
	with the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/cdrtools/pkg-descr">sysutils/cdrtools</a> suite, can be
	used to rip audio information from
	<acronym class="acronym">CD</acronym>s.</p><p xml:lang="en" lang="en">With the audio <acronym class="acronym">CD</acronym> in the drive, the
	following command can be issued as
	<code class="systemitem">root</code> to rip an
	entire <acronym class="acronym">CD</acronym> into individual, per track,
	<acronym class="acronym">WAV</acronym> files:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cdda2wav -D <em class="replaceable"><code>0,1,0</code></em> -B</code></strong></pre><p xml:lang="en" lang="en">In this example, the
	<code class="option">-D <em class="replaceable"><code>0,1,0</code></em></code> indicates
	the <acronym class="acronym">SCSI</acronym> device <code class="filename">0,1,0</code>
	containing the <acronym class="acronym">CD</acronym> to rip.  Use
	<code class="command">cdrecord -scanbus</code> to determine the correct
	device parameters for the system.</p><p xml:lang="en" lang="en">To rip individual tracks, use <code class="option">-t</code> to
	specify the track:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cdda2wav -D <em class="replaceable"><code>0,1,0</code></em> -t 7</code></strong></pre><p xml:lang="en" lang="en">To rip a range of tracks, such as track one to seven,
	specify a range:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cdda2wav -D <em class="replaceable"><code>0,1,0</code></em> -t 1+7</code></strong></pre><p xml:lang="en" lang="en">To rip from an <acronym class="acronym">ATAPI</acronym>
	(<acronym class="acronym">IDE</acronym>) <acronym class="acronym">CDROM</acronym> drive,
	specify the device name in place of the
	<acronym class="acronym">SCSI</acronym> unit numbers.  For example, to rip
	track 7 from an IDE drive:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cdda2wav -D <em class="replaceable"><code>/dev/acd0 -t 7</code></em></code></strong></pre><p xml:lang="en" lang="en">Alternately, <code class="command">dd</code> can be used to extract
	audio tracks on <acronym class="acronym">ATAPI</acronym> drives, as described
	in <a class="xref" href="#duplicating-audiocds" title="17.5.5. 複製音樂 CD">節 17.5.5, “複製音樂 <acronym class="acronym">CD</acronym>”</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mp3-encoding"></a>7.3.3. MP3 編碼與解碼</h3></div></div></div><p xml:lang="en" lang="en"><span class="application">Lame</span> is a popular
	<acronym class="acronym">MP3</acronym> encoder which can be installed from the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/lame/pkg-descr">audio/lame</a> port.  Due to patent issues, a
	package is not available.</p><p xml:lang="en" lang="en">The following command will convert the ripped
	<acronym class="acronym">WAV</acronym> file
	<code class="filename"><em class="replaceable"><code>audio01.wav</code></em></code> to
	<code class="filename"><em class="replaceable"><code>audio01.mp3</code></em></code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>lame -h -b <em class="replaceable"><code>128</code></em> --tt "<em class="replaceable"><code>Foo Song Title</code></em>" --ta "<em class="replaceable"><code>FooBar Artist</code></em>" --tl "<em class="replaceable"><code>FooBar Album</code></em>" \
--ty "<em class="replaceable"><code>2014</code></em>" --tc "<em class="replaceable"><code>Ripped and encoded by Foo</code></em>" --tg "<em class="replaceable"><code>Genre</code></em>" <em class="replaceable"><code>audio01.wav audio01.mp3</code></em></code></strong></pre><p xml:lang="en" lang="en">The specified 128 kbits is a standard
	<acronym class="acronym">MP3</acronym> bitrate while the 160 and 192 bitrates
	provide higher quality.  The higher the bitrate, the larger
	the size of the resulting <acronym class="acronym">MP3</acronym>.  The
	<code class="option">-h</code> turns on the
	<span class="quote">“<span class="quote">higher quality but a little slower</span>”</span>
	mode.  The options beginning with <code class="option">--t</code>
	indicate <acronym class="acronym">ID3</acronym> tags, which usually contain
	song information, to be embedded within the
	<acronym class="acronym">MP3</acronym> file.  Additional encoding options can
	be found in the <span class="application">lame</span> manual
	page.</p><p xml:lang="en" lang="en">In order to burn an audio <acronym class="acronym">CD</acronym> from
	<acronym class="acronym">MP3</acronym>s, they must first be converted to a
	non-compressed file format.  <span class="application">XMMS</span>
	can be used to convert to the <acronym class="acronym">WAV</acronym> format,
	while <span class="application">mpg123</span> can be used to convert
	to the raw Pulse-Code Modulation (<acronym class="acronym">PCM</acronym>)
	audio data format.</p><p xml:lang="en" lang="en">To convert <code class="filename">audio01.mp3</code> using
	<span class="application">mpg123</span>, specify the name of the
	<acronym class="acronym">PCM</acronym> file:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mpg123 -s <em class="replaceable"><code>audio01.mp3</code></em> &gt; <em class="replaceable"><code>audio01.pcm</code></em></code></strong></pre><p xml:lang="en" lang="en">To use <span class="application">XMMS</span> to convert a
	<acronym class="acronym">MP3</acronym> to <acronym class="acronym">WAV</acronym> format, use
	these steps:</p><div class="procedure"><a id="idp68073912"></a><div class="procedure-title">過程 7.1. Converting to <acronym class="acronym">WAV</acronym> Format in
	  <span class="application">XMMS</span></div><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">Launch <span class="application">XMMS</span>.</p></li><li class="step"><p xml:lang="en" lang="en">Right-click the window to bring up the
	    <span class="application">XMMS</span> menu.</p></li><li class="step"><p xml:lang="en" lang="en">Select <code class="literal">Preferences</code> under
	    <code class="literal">Options</code>.</p></li><li class="step"><p xml:lang="en" lang="en">Change the Output Plugin to <span class="quote">“<span class="quote">Disk Writer
	      Plugin</span>”</span>.</p></li><li class="step"><p xml:lang="en" lang="en">Press <code class="literal">Configure</code>.</p></li><li class="step"><p xml:lang="en" lang="en">Enter or browse to a directory to write the
	    uncompressed files to.</p></li><li class="step"><p xml:lang="en" lang="en">Load the <acronym class="acronym">MP3</acronym> file into
	    <span class="application">XMMS</span> as usual, with volume at
	    100% and EQ settings turned off.</p></li><li class="step"><p xml:lang="en" lang="en">Press <code class="literal">Play</code>.  The
	    <span class="application">XMMS</span> will appear as if it is
	    playing the <acronym class="acronym">MP3</acronym>, but no music will be
	    heard.  It is actually playing the <acronym class="acronym">MP3</acronym>
	    to a file.</p></li><li class="step"><p xml:lang="en" lang="en">When finished, be sure to set the default Output
	    Plugin back to what it was before in order to listen to
	    <acronym class="acronym">MP3</acronym>s again.</p></li></ol></div><p xml:lang="en" lang="en">Both the <acronym class="acronym">WAV</acronym> and <acronym class="acronym">PCM</acronym>
	formats can be used with <span class="application">cdrecord</span>.
	When using <acronym class="acronym">WAV</acronym> files, there will be a small
	tick sound at the beginning of each track.  This sound is the
	header of the <acronym class="acronym">WAV</acronym> file.  The
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/sox/pkg-descr">audio/sox</a> port or package can be used to
	remove the header:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>sox -t wav -r 44100 -s -w -c 2 <em class="replaceable"><code>track.wav track.raw</code></em></code></strong></pre><p xml:lang="en" lang="en">Refer to <a class="xref" href="#creating-cds" title="17.5. 建立與使用 CD 媒體">節 17.5, “建立與使用 <acronym class="acronym">CD</acronym> 媒體”</a> for more
	information on using a <acronym class="acronym">CD</acronym> burner in
	FreeBSD.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="video-playback"></a>7.4. 影片播放</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Ross</span> <span class="surname">Lippert</span></span>. </span></div></div></div><p xml:lang="en" lang="en">Before configuring video playback, determine the model and
      chipset of the video card.  While
      <span class="application">Xorg</span> supports a wide variety of
      video cards, not all provide good playback performance.  To
      obtain a list of extensions supported by the
      <span class="application">Xorg</span> server using the card, run
      <code class="command">xdpyinfo</code> while
      <span class="application">Xorg</span> is running.</p><p xml:lang="en" lang="en">It is a good idea to have a short MPEG test file for
      evaluating various players and options.  Since some
      <acronym class="acronym">DVD</acronym> applications look for
      <acronym class="acronym">DVD</acronym> media in <code class="filename">/dev/dvd</code> by
      default, or have this device name hardcoded in them, it might be
      useful to make a symbolic link to the proper device:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ln -sf /dev/cd0 /dev/dvd</code></strong></pre><p xml:lang="en" lang="en">Due to the nature of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs</span>(5)</span></a>, manually created links
      will not persist after a system reboot.  In order to recreate
      the symbolic link automatically when the system boots, add the
      following line to <code class="filename">/etc/devfs.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">link cd0 dvd</pre><p xml:lang="en" lang="en"><acronym class="acronym">DVD</acronym> decryption invokes certain functions
      that require write permission to the <acronym class="acronym">DVD</acronym>
      device.</p><p xml:lang="en" lang="en">To enhance the shared memory
      <span class="application">Xorg</span> interface, it is recommended
      to increase the values of these <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
      variables:</p><pre xml:lang="en" class="programlisting" lang="en">kern.ipc.shmmax=67108864
kern.ipc.shmall=32768</pre><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="video-interface"></a>7.4.1. 偵測影像處理能力</h3></div></div></div><a id="idp68129848" class="indexterm"></a><a id="idp68130488" class="indexterm"></a><a id="idp68131128" class="indexterm"></a><p xml:lang="en" lang="en">There are several possible ways to display video under
	<span class="application">Xorg</span> and what works is largely
	hardware dependent.  Each method described below will have
	varying quality across different hardware.</p><p xml:lang="en" lang="en">Common video interfaces include:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p xml:lang="en" lang="en"><span class="application">Xorg</span>: normal output using
	    shared memory.</p></li><li class="listitem"><p xml:lang="en" lang="en">XVideo: an extension to the
	    <span class="application">Xorg</span> interface which
	    allows video to be directly displayed in drawable objects
	    through a special acceleration.  This extension provides
	    good quality playback even on low-end machines.  The next
	    section describes how to determine if this extension is
	    running.</p></li><li class="listitem"><p xml:lang="en" lang="en"><acronym class="acronym">SDL</acronym>: the Simple Directmedia Layer
	    is a porting layer for many operating systems, allowing
	    cross-platform applications to be developed which make
	    efficient use of sound and graphics.
	    <acronym class="acronym">SDL</acronym> provides a low-level abstraction to
	    the hardware which can sometimes be more efficient than
	    the <span class="application">Xorg</span> interface.  On FreeBSD,
	    <acronym class="acronym">SDL</acronym> can be installed using the
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/devel/sdl20/pkg-descr">devel/sdl20</a> package or port.</p></li><li class="listitem"><p xml:lang="en" lang="en"><acronym class="acronym">DGA</acronym>: the Direct Graphics Access is
	    an <span class="application">Xorg</span> extension which
	    allows a program to bypass the
	    <span class="application">Xorg</span> server and directly
	    alter the framebuffer.  Because it relies on a low level
	    memory mapping, programs using it must be run as
	    <code class="systemitem">root</code>.  The
	    <acronym class="acronym">DGA</acronym> extension can be tested and
	    benchmarked using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dga&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dga</span>(1)</span></a>.  When
	    <code class="command">dga</code> is running, it changes the colors
	    of the display whenever a key is pressed.  To quit, press
	    <span class="keycap"><strong>q</strong></span>.</p></li><li class="listitem"><p xml:lang="en" lang="en">SVGAlib: a low level console graphics layer.</p></li></ol></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="video-interface-xvideo"></a>7.4.1.1. XVideo</h4></div></div></div><p xml:lang="en" lang="en">To check whether this extension is running, use
	  <code class="command">xvinfo</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>xvinfo</code></strong></pre><p xml:lang="en" lang="en">XVideo is supported for the card if the result is
	  similar to:</p><pre xml:lang="en" class="screen" lang="en">X-Video Extension version 2.2
  screen #0
  Adaptor #0: "Savage Streams Engine"
    number of ports: 1
    port base: 43
    operations supported: PutImage
    supported visuals:
      depth 16, visualID 0x22
      depth 16, visualID 0x23
    number of attributes: 5
      "XV_COLORKEY" (range 0 to 16777215)
              client settable attribute
              client gettable attribute (current value is 2110)
      "XV_BRIGHTNESS" (range -128 to 127)
              client settable attribute
              client gettable attribute (current value is 0)
      "XV_CONTRAST" (range 0 to 255)
              client settable attribute
              client gettable attribute (current value is 128)
      "XV_SATURATION" (range 0 to 255)
              client settable attribute
              client gettable attribute (current value is 128)
      "XV_HUE" (range -180 to 180)
              client settable attribute
              client gettable attribute (current value is 0)
    maximum XvImage size: 1024 x 1024
    Number of image formats: 7
      id: 0x32595559 (YUY2)
        guid: 59555932-0000-0010-8000-00aa00389b71
        bits per pixel: 16
        number of planes: 1
        type: YUV (packed)
      id: 0x32315659 (YV12)
        guid: 59563132-0000-0010-8000-00aa00389b71
        bits per pixel: 12
        number of planes: 3
        type: YUV (planar)
      id: 0x30323449 (I420)
        guid: 49343230-0000-0010-8000-00aa00389b71
        bits per pixel: 12
        number of planes: 3
        type: YUV (planar)
      id: 0x36315652 (RV16)
        guid: 52563135-0000-0000-0000-000000000000
        bits per pixel: 16
        number of planes: 1
        type: RGB (packed)
        depth: 0
        red, green, blue masks: 0x1f, 0x3e0, 0x7c00
      id: 0x35315652 (RV15)
        guid: 52563136-0000-0000-0000-000000000000
        bits per pixel: 16
        number of planes: 1
        type: RGB (packed)
        depth: 0
        red, green, blue masks: 0x1f, 0x7e0, 0xf800
      id: 0x31313259 (Y211)
        guid: 59323131-0000-0010-8000-00aa00389b71
        bits per pixel: 6
        number of planes: 3
        type: YUV (packed)
      id: 0x0
        guid: 00000000-0000-0000-0000-000000000000
        bits per pixel: 0
        number of planes: 0
        type: RGB (packed)
        depth: 1
        red, green, blue masks: 0x0, 0x0, 0x0</pre><p xml:lang="en" lang="en">The formats listed, such as YUV2 and YUV12, are not
	  present with every implementation of XVideo and their
	  absence may hinder some players.</p><p xml:lang="en" lang="en">If the result instead looks like:</p><pre xml:lang="en" class="screen" lang="en">X-Video Extension version 2.2
screen #0
no adaptors present</pre><p xml:lang="en" lang="en">XVideo is probably not supported for the card.  This
	  means that it will be more difficult for the display to meet
	  the computational demands of rendering video, depending on
	  the video card and processor.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="video-ports"></a>7.4.2. 可處理影像的 Port 與套件</h3></div></div></div><a id="idp68179640" class="indexterm"></a><a id="idp68200760" class="indexterm"></a><p xml:lang="en" lang="en">This section introduces some of the software available
	from the FreeBSD Ports Collection which can be used for video
	playback.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="video-mplayer"></a>7.4.2.1. <span class="application">MPlayer</span> 與 <span class="application">MEncoder</span></h4></div></div></div><p xml:lang="en" lang="en"><span class="application">MPlayer</span> is a command-line
	  video player with an optional graphical interface which aims
	  to provide speed and flexibility.  Other graphical
	  front-ends to <span class="application">MPlayer</span> are
	  available from the FreeBSD Ports Collection.</p><a id="idp68204344" class="indexterm"></a><p xml:lang="en" lang="en"><span class="application">MPlayer</span> can be installed
	  using the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/mplayer/pkg-descr">multimedia/mplayer</a> package or
	  port.  Several compile options are available and a variety
	  of hardware checks occur during the build process.  For
	  these reasons, some users prefer to build the port rather
	  than install the package.</p><p xml:lang="en" lang="en">When compiling the port, the menu options should be
	  reviewed to determine the type of support to compile into
	  the port.  If an option is not selected,
	  <span class="application">MPlayer</span> will not be able to
	  display that type of video format.  Use the arrow keys and
	  spacebar to select the required formats.  When finished,
	  press <span class="keycap"><strong>Enter</strong></span> to continue the port compile
	  and installation.</p><p xml:lang="en" lang="en">By default, the package or port will build the
	  <code class="command">mplayer</code> command line utility and the
	  <code class="command">gmplayer</code> graphical utility.  To encode
	  videos, compile the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/mencoder/pkg-descr">multimedia/mencoder</a>
	  port.  Due to licensing restrictions, a package is not
	  available for <span class="application">MEncoder</span>.</p><p xml:lang="en" lang="en">The first time <span class="application">MPlayer</span> is
	  run, it will create <code class="filename">~/.mplayer</code> in the
	  user's home directory.  This subdirectory contains default
	  versions of the user-specific configuration files.</p><p xml:lang="en" lang="en">This section describes only a few common uses.  Refer to
	  mplayer(1) for a complete description of its numerous
	  options.</p><p xml:lang="en" lang="en">To play the file
	  <code class="filename"><em class="replaceable"><code>testfile.avi</code></em></code>,
	  specify the video interfaces with <code class="option">-vo</code>, as
	  seen in the following examples:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>mplayer -vo xv <em class="replaceable"><code>testfile.avi</code></em></code></strong></pre><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>mplayer -vo sdl <em class="replaceable"><code>testfile.avi</code></em></code></strong></pre><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>mplayer -vo x11 <em class="replaceable"><code>testfile.avi</code></em></code></strong></pre><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mplayer -vo dga <em class="replaceable"><code>testfile.avi</code></em></code></strong></pre><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mplayer -vo 'sdl:dga' <em class="replaceable"><code>testfile.avi</code></em></code></strong></pre><p xml:lang="en" lang="en">It is worth trying all of these options, as their
	  relative performance depends on many factors and will vary
	  significantly with hardware.</p><p xml:lang="en" lang="en">To play a <acronym class="acronym">DVD</acronym>, replace
	  <code class="filename"><em class="replaceable"><code>testfile.avi</code></em></code>
	  with <code class="option">dvd://<em class="replaceable"><code>N</code></em> -dvd-device
	   <em class="replaceable"><code>DEVICE</code></em></code>, where
	  <em class="replaceable"><code>N</code></em> is the title number to play and
	  <em class="replaceable"><code>DEVICE</code></em> is the device node for the
	  <acronym class="acronym">DVD</acronym>.  For example, to play title 3 from
	  <code class="filename">/dev/dvd</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mplayer -vo xv dvd://3 -dvd-device /dev/dvd</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The default <acronym class="acronym">DVD</acronym> device can be
	    defined during the build of the
	    <span class="application">MPlayer</span> port by including the
	    <code class="varname">WITH_DVD_DEVICE=/path/to/desired/device</code>
	    option.  By default, the device is
	    <code class="filename">/dev/cd0</code>.  More details can be found
	    in the port's
	    <code class="filename">Makefile.options</code>.</p></div><p xml:lang="en" lang="en">To stop, pause, advance, and so on, use a keybinding.
	  To see the list of keybindings, run <code class="command">mplayer
	    -h</code> or read mplayer(1).</p><p xml:lang="en" lang="en">Additional playback options include <code class="option">-fs
	    -zoom</code>, which engages fullscreen mode, and
	  <code class="option">-framedrop</code>, which helps performance.</p><p xml:lang="en" lang="en">Each user can add commonly used options to their
	  <code class="filename">~/.mplayer/config</code> like so:</p><pre xml:lang="en" class="programlisting" lang="en">vo=xv
fs=yes
zoom=yes</pre><p xml:lang="en" lang="en"><code class="command">mplayer</code> can be used to rip a
	  <acronym class="acronym">DVD</acronym> title to a <code class="filename">.vob</code>.
	  To dump the second title from a
	  <acronym class="acronym">DVD</acronym>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mplayer -dumpstream -dumpfile out.vob dvd://2 -dvd-device /dev/dvd</code></strong></pre><p xml:lang="en" lang="en">The output file, <code class="filename">out.vob</code>, will be
	  in <acronym class="acronym">MPEG</acronym> format.</p><p xml:lang="en" lang="en">Anyone wishing to obtain a high level of expertise with
	  <span class="trademark">UNIX</span>® video should consult <a class="link" href="http://www.mplayerhq.hu/DOCS/" target="_top">mplayerhq.hu/DOCS</a>
	  as it is technically informative.  This documentation should
	  be considered as required reading before submitting any bug
	  reports.</p><a id="idp68253368" class="indexterm"></a><p xml:lang="en" lang="en">Before using <code class="command">mencoder</code>, it is a good
	  idea to become familiar with the options described at <a class="link" href="http://www.mplayerhq.hu/DOCS/HTML/en/mencoder.html" target="_top">mplayerhq.hu/DOCS/HTML/en/mencoder.html</a>.
	  There are innumerable ways to improve quality, lower
	  bitrate, and change formats, and some of these options may
	  make the difference between good or bad performance.
	  Improper combinations of command line options can yield
	  output files that are unplayable even by
	  <code class="command">mplayer</code>.</p><p xml:lang="en" lang="en">Here is an example of a simple copy:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>mencoder <em class="replaceable"><code>input.avi</code></em> -oac copy -ovc copy -o <em class="replaceable"><code>output.avi</code></em></code></strong></pre><p xml:lang="en" lang="en">To rip to a file, use <code class="option">-dumpfile</code> with
	  <code class="command">mplayer</code>.</p><p xml:lang="en" lang="en">To convert
	  <code class="filename"><em class="replaceable"><code>input.avi</code></em></code> to
	  the MPEG4 codec with MPEG3 audio encoding, first install the
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/lame/pkg-descr">audio/lame</a> port.  Due to licensing
	  restrictions, a package is not available.  Once installed,
	  type:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>mencoder <em class="replaceable"><code>input.avi</code></em> -oac mp3lame -lameopts br=192 \
	 -ovc lavc -lavcopts vcodec=mpeg4:vhq -o <em class="replaceable"><code>output.avi</code></em></code></strong></pre><p xml:lang="en" lang="en">This will produce output playable by applications such
	  as <code class="command">mplayer</code> and
	  <code class="command">xine</code>.</p><p xml:lang="en" lang="en"><code class="filename"><em class="replaceable"><code>input.avi</code></em></code>
	  can be replaced with <code class="option">dvd://1 -dvd-device
	    /dev/dvd</code> and run as <code class="systemitem">root</code> to re-encode a
	  <acronym class="acronym">DVD</acronym> title directly.  Since it may take a
	  few tries to get the desired result, it is recommended to
	  instead dump the title to a file and to work on the
	  file.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="video-xine"></a>7.4.2.2. <span class="application">xine</span> 影像播放器</h4></div></div></div><p xml:lang="en" lang="en"><span class="application">xine</span> is a video player with a
	  reusable base library and a modular executable which can be
	  extended with plugins.  It can be installed using the
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/xine/pkg-descr">multimedia/xine</a> package or port.</p><p xml:lang="en" lang="en">In practice, <span class="application">xine</span> requires
	  either a fast CPU with a fast video card, or support for the
	  XVideo extension.  The <span class="application">xine</span> video
	  player performs best on XVideo interfaces.</p><p xml:lang="en" lang="en">By default, the <span class="application">xine</span> player
	  starts a graphical user interface.  The menus can then be
	  used to open a specific file.</p><p xml:lang="en" lang="en">Alternatively, <span class="application">xine</span> may be
	  invoked from the command line by specifying the name of the
	  file to play:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>xine -g -p <em class="replaceable"><code>mymovie.avi</code></em></code></strong></pre><p xml:lang="en" lang="en">Refer to <a class="link" href="http://www.xine-project.org/faq" target="_top">
	    xine-project.org/faq</a> for more information and
	  troubleshooting tips.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="video-ports-transcode"></a>7.4.2.3. <span class="application">Transcode</span> 工具</h4></div></div></div><p xml:lang="en" lang="en"><span class="application">Transcode</span> provides a suite of
	  tools for re-encoding video and audio files.
	  <span class="application">Transcode</span> can be used to merge
	  video files or repair broken files using command line tools
	  with stdin/stdout stream interfaces.</p><p xml:lang="en" lang="en">In FreeBSD, <span class="application">Transcode</span> can be
	  installed using the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/transcode/pkg-descr">multimedia/transcode</a>
	  package or port.  Many users prefer to compile the port as
	  it provides a menu of compile options for specifying the
	  support and codecs to compile in.  If an option is not
	  selected, <span class="application">Transcode</span> will not be
	  able to encode that format.  Use the arrow keys and spacebar
	  to select the required formats.  When finished, press
	  <span class="keycap"><strong>Enter</strong></span> to continue the port compile and
	  installation.</p><p xml:lang="en" lang="en">This example demonstrates how to convert a DivX file
	  into a PAL MPEG-1 file (PAL VCD):</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>transcode -i <em class="replaceable"><code>input.avi</code></em> -V --export_prof vcd-pal -o output_vcd</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>mplex -f 1 -o <em class="replaceable"><code>output_vcd.mpg output_vcd.m1v output_vcd.mpa</code></em></code></strong></pre><p xml:lang="en" lang="en">The resulting <acronym class="acronym">MPEG</acronym> file,
	  <code class="filename"><em class="replaceable"><code>output_vcd.mpg</code></em></code>,
	  is ready to be played with
	  <span class="application">MPlayer</span>.  The file can be burned
	  on a <acronym class="acronym">CD</acronym> media to create a video
	  <acronym class="acronym">CD</acronym> using a utility such as
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/vcdimager/pkg-descr">multimedia/vcdimager</a> or
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/cdrdao/pkg-descr">sysutils/cdrdao</a>.</p><p xml:lang="en" lang="en">In addition to the manual page for
	  <code class="command">transcode</code>, refer to  <a class="link" href="http://www.transcoding.org/cgi-bin/transcode" target="_top">transcoding.org/cgi-bin/transcode</a>
	  for further information and examples.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="tvcard"></a>7.5. 電視卡</h2></div><div><span class="authorgroup">Original contribution by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Josef</span> <span class="surname">El-Rayes</span></span>. </span></div><div><span class="authorgroup">Enhanced and adapted by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><a id="idp68317112" class="indexterm"></a><p>電視卡 (TV card) 可以讓您用電腦來看無線、有線電視節目。許多卡都是透過 <acronym class="acronym">RCA</acronym> 或 S-video 輸入端子來接收視訊，而且有些卡還可接收 <acronym class="acronym">FM</acronym> 廣播的功能。</p><p>FreeBSD 可透過 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bktr&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bktr</span>(4)</span></a> 驅動程式，來支援 PCI 介面的電視卡，只要這些卡使用的是 Brooktree Bt848/849/878/879 或 Conexant CN-878/Fusion 878a 視訊擷取晶片。此外，要再確認哪些卡上所附的選台功能是否有支援，可以參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bktr&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bktr</span>(4)</span></a> 說明，以查看所支援的硬體清單。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68325176"></a>7.5.1. 載入驅動程式</h3></div></div></div><p>要用電視卡的話，就要載入 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bktr&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bktr</span>(4)</span></a> 驅動程式，這個可以透過在 <code class="filename">/boot/loader.conf</code> 檔加上下面這一行就可以了：</p><pre xml:lang="en" class="programlisting" lang="en">bktr_load="YES"</pre><p>或者可以將電視卡支援靜態編譯到自訂的核心當中，若要這麼做則可在自訂核心設定檔加入以下行：</p><pre xml:lang="en" class="programlisting" lang="en">device	 bktr
device	iicbus
device	iicbb
device	smbus</pre><p>之所以要加上這些額外的驅動程式，是因為卡的各組成部分都是透過 I2C 匯流排而相互連接的。接下來，請編譯、安裝新的核心 。</p><p>要測試調諧器 (Tuner) 是否被正確的偵測，請先重新啟動系統。電視卡應該會出現在開機訊息檔中，如同此範例：</p><pre xml:lang="en" class="programlisting" lang="en">bktr0: &lt;BrookTree 848A&gt; mem 0xd7000000-0xd7000fff irq 10 at device 10.0 on pci0
iicbb0: &lt;I2C bit-banging driver&gt; on bti2c0
iicbus0: &lt;Philips I2C bus&gt; on iicbb0 master-only
iicbus1: &lt;Philips I2C bus&gt; on iicbb0 master-only
smbus0: &lt;System Management Bus&gt; on bti2c0
bktr0: Pinnacle/Miro TV, Philips SECAM tuner.</pre><p>該訊息會依硬體不同而有所不同。若必要，可以使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> 系統偵測的參數或者自訂核心設定選項。例如要強制使用 Philips SECAM 調諧器則可加入下列行至自訂核心設定檔：</p><pre xml:lang="en" class="programlisting" lang="en">options OVERRIDE_TUNER=6</pre><p>或使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.bt848.tuner=6</code></strong></pre><p>請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bktr&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bktr</span>(4)</span></a> 查看 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> 可用的參數說明及核心選項。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68340024"></a>7.5.2. 好用的應用程式</h3></div></div></div><p xml:lang="en" lang="en">To use the TV card, install one of the following
	applications:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/fxtv/pkg-descr">multimedia/fxtv</a>
	    provides TV-in-a-window and image/audio/video capture
	    capabilities.</p></li><li class="listitem"><p xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/xawtv/pkg-descr">multimedia/xawtv</a>
	    is another TV application with similar features.</p></li><li class="listitem"><p xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/xmradio/pkg-descr">audio/xmradio</a>
	    provides an application for using the FM radio tuner of a
	    TV card.</p></li></ul></div><p xml:lang="en" lang="en">More applications are available in the FreeBSD Ports
	Collection.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68357944"></a>7.5.3. 疑難排解</h3></div></div></div><p xml:lang="en" lang="en">If any problems are encountered with the TV card, check
	that the video capture chip and the tuner are supported by
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bktr&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bktr</span>(4)</span></a> and that the right configuration options were
	used.  For more support or to ask questions about supported TV
	cards, refer to the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-multimedia" target="_top">freebsd-multimedia</a> mailing list.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mythtv"></a>7.6. MythTV</h2></div></div></div><p xml:lang="en" lang="en">MythTV is a popular, open source Personal Video Recorder
      (<acronym class="acronym">PVR</acronym>) application.  This section demonstrates
      how to install and setup MythTV on FreeBSD.  Refer to <a class="link" href="http://www.mythtv.org/wiki/" target="_top">mythtv.org/wiki</a>
      for more information on how to use MythTV.</p><p xml:lang="en" lang="en">MythTV requires a frontend and a backend.  These components
      can either be installed on the same system or on different
      machines.</p><p xml:lang="en" lang="en">The frontend can be installed on FreeBSD using the
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/mythtv-frontend/pkg-descr">multimedia/mythtv-frontend</a> package or port.
      <span class="application">Xorg</span> must also be installed and
      configured as described in <a class="xref" href="#x11" title="章 5. X Window 系統">章 5, <em>X Window 系統</em></a>.  Ideally, this
      system has a video card that supports X-Video Motion
      Compensation (<acronym class="acronym">XvMC</acronym>) and, optionally, a Linux
      Infrared Remote Control (<acronym class="acronym">LIRC</acronym>)-compatible
      remote.</p><p xml:lang="en" lang="en">To install both the backend and the frontend on FreeBSD, use
      the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/mythtv/pkg-descr">multimedia/mythtv</a> package or port.  A
      <span class="trademark">MySQL</span>™ database server is also required and should
      automatically be installed as a dependency.  Optionally, this
      system should have a tuner card and sufficient storage to hold
      recorded data.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68379576"></a>7.6.1. 硬體</h3></div></div></div><p xml:lang="en" lang="en">MythTV uses Video for Linux (<acronym class="acronym">V4L</acronym>) to
	access video input devices such as encoders and tuners.  In
	FreeBSD, MythTV works best with <acronym class="acronym">USB</acronym> DVB-S/C/T
	cards as they are well supported by the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/webcamd/pkg-descr">multimedia/webcamd</a> package or port which
	provides a <acronym class="acronym">V4L</acronym> userland application.  Any
	Digital Video Broadcasting (<acronym class="acronym">DVB</acronym>) card
	supported by <span class="application">webcamd</span> should work
	with MythTV.  A list of known working cards can be found at
	<a class="link" href="https://wiki.freebsd.org/WebcamCompat" target="_top">wiki.freebsd.org/WebcamCompat</a>.
	Drivers are also available for Hauppauge cards in the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/pvr250/pkg-descr">multimedia/pvr250</a> and
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/pvrxxx/pkg-descr">multimedia/pvrxxx</a> ports, but they provide a
	non-standard driver interface that does not work with versions
	of MythTV greater than 0.23.  Due to licensing restrictions,
	no packages are available and these two ports must be
	compiled.</p><p xml:lang="en" lang="en">The <a class="link" href="https://wiki.freebsd.org/HTPC" target="_top">wiki.freebsd.org/HTPC</a>
	page contains a list of all available <acronym class="acronym">DVB</acronym>
	drivers.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68389944"></a>7.6.2. 設定 MythTV 後端</h3></div></div></div><p>要使用 Binary 套件安裝 MythTV 可：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install mythtv</code></strong></pre><p>或從 Port 套件集安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/multimedia/mythtv</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong></pre><p xml:lang="en" lang="en">Once installed, set up the MythTV database:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mysql -uroot -p &lt; /usr/local/share/mythtv/database/mc.sql</code></strong></pre><p xml:lang="en" lang="en">Then, configure the backend:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mythtv-setup</code></strong></pre><p xml:lang="en" lang="en">Finally, start the backend:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysrc mythbackend_enable=yes</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service mythbackend start</code></strong></pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="scanners"></a>7.7. 影像掃描器</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><a id="idp68403640" class="indexterm"></a><p xml:lang="en" lang="en">In FreeBSD, access to image scanners is provided by
      <span class="application">SANE</span> (Scanner Access Now Easy), which
      is available in the FreeBSD Ports Collection.
      <span class="application">SANE</span> will also use some FreeBSD device
      drivers to provide access to the scanner hardware.</p><p xml:lang="en" lang="en">FreeBSD supports both <acronym class="acronym">SCSI</acronym> and
      <acronym class="acronym">USB</acronym> scanners.  Depending upon the scanner
      interface, different device drivers are required.  Be sure the
      scanner is supported by <span class="application">SANE</span> prior
      to performing any configuration.  Refer to <a class="link" href="http://www.sane-project.org/sane-supported-devices.html" target="_top">
      http://www.sane-project.org/sane-supported-devices.html</a>
      for more information about supported scanners.</p><p xml:lang="en" lang="en">This chapter describes how to determine if the scanner has
      been detected by FreeBSD.  It then provides an overview of how to
      configure and use <span class="application">SANE</span> on a FreeBSD
      system.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="scanners-kernel-usb"></a>7.7.1. 檢查掃描器</h3></div></div></div><p xml:lang="en" lang="en">The <code class="filename">GENERIC</code> kernel includes the
	device drivers needed to support <acronym class="acronym">USB</acronym>
	scanners.  Users with a custom kernel should ensure that the
	following lines are present in the custom kernel configuration
	file:</p><pre xml:lang="en" class="programlisting" lang="en">device usb
device uhci
device ohci
device ehci</pre><p xml:lang="en" lang="en">To determine if the <acronym class="acronym">USB</acronym> scanner is
	detected, plug it in and use <code class="command">dmesg</code> to
	determine whether the scanner appears in the system message
	buffer.  If it does, it should display a message similar to
	this:</p><pre xml:lang="en" class="screen" lang="en">ugen0.2: &lt;EPSON&gt; at usbus0</pre><p xml:lang="en" lang="en">In this example, an <span class="trademark">EPSON
  Perfection</span>® 1650
	<acronym class="acronym">USB</acronym> scanner was detected on
	<code class="filename">/dev/ugen0.2</code>.</p><p xml:lang="en" lang="en">If the scanner uses a <acronym class="acronym">SCSI</acronym> interface,
	it is important to know which <acronym class="acronym">SCSI</acronym>
	controller board it will use.  Depending upon the
	<acronym class="acronym">SCSI</acronym> chipset, a custom kernel configuration
	file may be needed.  The <code class="filename">GENERIC</code> kernel
	supports the most common <acronym class="acronym">SCSI</acronym> controllers.
	Refer to <code class="filename">/usr/src/sys/conf/NOTES</code> to
	determine the correct line to add to a custom kernel
	configuration file.  In addition to the
	<acronym class="acronym">SCSI</acronym> adapter driver, the following lines
	are needed in a custom kernel configuration file:</p><pre xml:lang="en" class="programlisting" lang="en">device scbus
device pass</pre><p xml:lang="en" lang="en">Verify that the device is displayed in the system message
	buffer:</p><pre xml:lang="en" class="screen" lang="en">pass2 at aic0 bus 0 target 2 lun 0
pass2: &lt;AGFA SNAPSCAN 600 1.10&gt; Fixed Scanner SCSI-2 device
pass2: 3.300MB/s transfers</pre><p xml:lang="en" lang="en">If the scanner was not powered-on at system boot, it is
	still possible to manually force detection by performing a
	<acronym class="acronym">SCSI</acronym> bus scan with
	<code class="command">camcontrol</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>camcontrol rescan all</code></strong>
Re-scan of bus 0 was successful
Re-scan of bus 1 was successful
Re-scan of bus 2 was successful
Re-scan of bus 3 was successful</pre><p xml:lang="en" lang="en">The scanner should now appear in the
	<acronym class="acronym">SCSI</acronym> devices list:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>camcontrol devlist</code></strong>
&lt;IBM DDRS-34560 S97B&gt;              at scbus0 target 5 lun 0 (pass0,da0)
&lt;IBM DDRS-34560 S97B&gt;              at scbus0 target 6 lun 0 (pass1,da1)
&lt;AGFA SNAPSCAN 600 1.10&gt;           at scbus1 target 2 lun 0 (pass3)
&lt;PHILIPS CDD3610 CD-R/RW 1.00&gt;     at scbus2 target 0 lun 0 (pass2,cd0)</pre><p xml:lang="en" lang="en">Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=scsi&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">scsi</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=camcontrol&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">camcontrol</span>(8)</span></a> for more
	details about <acronym class="acronym">SCSI</acronym> devices on FreeBSD.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68455608"></a>7.7.2. <span class="application">SANE</span> 設定</h3></div></div></div><p xml:lang="en" lang="en">The <span class="application">SANE</span> system is split in two
	parts: the backends
	(<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/graphics/sane-backends/pkg-descr">graphics/sane-backends</a>) and the frontends
	(<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/graphics/sane-frontends/pkg-descr">graphics/sane-frontends</a> or
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/graphics/xsane/pkg-descr">graphics/xsane</a>).  The backends provide
	access to the scanner.  Refer to <a class="link" href="http://www.sane-project.org/sane-supported-devices.html" target="_top">http://www.sane-project.org/sane-supported-devices.html</a>
	to determine which backend supports the scanner.  The
	frontends provide the graphical scanning interface.
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/graphics/sane-frontends/pkg-descr">graphics/sane-frontends</a> installs
	<span class="application">xscanimage</span> while
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/graphics/xsane/pkg-descr">graphics/xsane</a> installs
	<span class="application">xsane</span>.</p><p>要由 Binary 套件安裝這兩個部份可：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install xsane sane-frontends</code></strong></pre><p>或由 Port 套件集安裝</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/graphics/sane-frontends</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/graphics/xsane</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p xml:lang="en" lang="en">After installing the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/graphics/sane-backends/pkg-descr">graphics/sane-backends</a> port or package, use
	<code class="command">sane-find-scanner</code> to check the scanner
	detection by the <span class="application">SANE</span>
	system:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sane-find-scanner -q</code></strong>
found SCSI scanner "AGFA SNAPSCAN 600 1.10" at /dev/pass3</pre><p xml:lang="en" lang="en">The output should show the interface type of the scanner
	and the device node used to attach the scanner to the system.
	The vendor and the product model may or may not appear.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Some <acronym class="acronym">USB</acronym> scanners require firmware to
	  be loaded.  Refer to sane-find-scanner(1) and sane(7) for
	  details.</p></div><p xml:lang="en" lang="en">Next, check if the scanner will be identified by a
	scanning frontend.  The <span class="application">SANE</span>
	backends include <code class="command">scanimage</code> which can be
	used to list the devices and perform an image acquisition.
	Use <code class="option">-L</code> to list the scanner devices.  The
	first example is for a <acronym class="acronym">SCSI</acronym> scanner and the
	second is for a <acronym class="acronym">USB</acronym> scanner:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>scanimage -L</code></strong>
device `snapscan:/dev/pass3' is a AGFA SNAPSCAN 600 flatbed scanner
<code class="prompt">#</code> <strong class="userinput"><code>scanimage -L</code></strong>
device 'epson2:libusb:/dev/usb:/dev/ugen0.2' is a Epson GT-8200 flatbed scanner</pre><p xml:lang="en" lang="en">In this second example,
	<code class="literal">'epson2:libusb:/dev/usb:/dev/ugen0.2'</code> is
	the backend name (<code class="literal">epson2</code>) and
	<code class="literal">/dev/ugen0.2</code> is the device node used by the
	scanner.</p><p xml:lang="en" lang="en">If <code class="command">scanimage</code> is unable to identify the
	scanner, this message will appear:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>scanimage -L</code></strong>

No scanners were identified. If you were expecting something different,
check that the scanner is plugged in, turned on and detected by the
sane-find-scanner tool (if appropriate). Please read the documentation
which came with this software (README, FAQ, manpages).</pre><p xml:lang="en" lang="en">If this happens, edit the backend configuration file in
	<code class="filename">/usr/local/etc/sane.d/</code> and define the
	scanner device used.  For example, if the undetected scanner
	model is an <span class="trademark">EPSON
  Perfection</span>® 1650 and it uses the
	<code class="literal">epson2</code> backend, edit
	<code class="filename">/usr/local/etc/sane.d/epson2.conf</code>.  When
	editing, add a line specifying the interface and the device
	node used.  In this case, add the following line:</p><pre xml:lang="en" class="programlisting" lang="en">usb /dev/ugen0.2</pre><p xml:lang="en" lang="en">Save the edits and verify that the scanner is identified
	with the right backend name and the device node:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>scanimage -L</code></strong>
device 'epson2:libusb:/dev/usb:/dev/ugen0.2' is a Epson GT-8200 flatbed scanner</pre><p xml:lang="en" lang="en">Once <code class="command">scanimage -L</code> sees the scanner, the
	configuration is complete and the scanner is now ready to
	use.</p><p xml:lang="en" lang="en">While <code class="command">scanimage</code> can be used to perform
	an image acquisition from the command line, it is often
	preferable to use a graphical interface to perform image
	scanning.  The <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/graphics/sane-frontends/pkg-descr">graphics/sane-frontends</a>
	package or port installs a simple but efficient graphical
	interface, <span class="application">xscanimage</span>.</p><p xml:lang="en" lang="en">Alternately, <span class="application">xsane</span>, which is
	installed with the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/graphics/xsane/pkg-descr">graphics/xsane</a> package
	or port, is another popular graphical scanning frontend.  It
	offers advanced features such as various scanning modes, color
	correction, and batch scans.  Both of these applications are
	usable as a <span class="application">GIMP</span> plugin.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68507704"></a>7.7.3. 掃描器權限</h3></div></div></div><p xml:lang="en" lang="en">In order to have access to the scanner, a user needs read
	and write permissions to the device node used by the scanner.
	In the previous example, the <acronym class="acronym">USB</acronym> scanner
	uses the device node <code class="filename">/dev/ugen0.2</code> which
	is really a symlink to the real device node
	<code class="filename">/dev/usb/0.2.0</code>.  The symlink and the
	device node are owned, respectively, by the <code class="systemitem">wheel</code> and <code class="systemitem">operator</code> groups.  While
	adding the user to these groups will allow access to the
	scanner, it is considered insecure to add a user to
	<code class="systemitem">wheel</code>.  A better
	solution is to create a group and make the scanner device
	accessible to members of this group.</p><p xml:lang="en" lang="en">This example creates a group called <code class="systemitem"><em class="replaceable"><code>usb</code></em></code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pw groupadd usb</code></strong></pre><p xml:lang="en" lang="en">Then, make the <code class="filename">/dev/ugen0.2</code> symlink
	and the <code class="filename">/dev/usb/0.2.0</code> device node
	accessible to the <code class="systemitem">usb</code> group with write
	permissions of <code class="literal">0660</code> or
	<code class="literal">0664</code> by adding the following lines to
	<code class="filename">/etc/devfs.rules</code>:</p><pre xml:lang="en" class="programlisting" lang="en">[system=5]
add path ugen0.2 mode 0660 group usb
add path usb/0.2.0 mode 0666 group usb</pre><p xml:lang="en" lang="en">Finally, add the users to <code class="systemitem"><em class="replaceable"><code>usb</code></em></code>
	in order to allow access to the scanner:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pw groupmod usb -m <em class="replaceable"><code>joe</code></em></code></strong></pre><p xml:lang="en" lang="en">For more details refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a>.</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="kernelconfig"></a>章 8. 設定 FreeBSD 核心</h2></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#kernelconfig-synopsis">8.1. 概述</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-custom-kernel">8.2. 為何要編譯自訂的核心?</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-devices">8.3. 偵測系統硬體</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-config">8.4. 設定檔</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-building">8.5. 編譯與安裝自訂核心</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-trouble">8.6. 如果發生錯誤</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-synopsis"></a>8.1. 概述</h2></div></div></div><a id="idp68535736" class="indexterm"></a><p>核心 (Kernel) 是 FreeBSD 作業系統最重要的部份之一。它負責記憶體管理、安全控管、網路、硬碟存取等等。 儘管目前 FreeBSD 大多可以用動態設定， 但有時仍需要設定並編譯自訂的核心。</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>何時需要編譯自訂核心。</p></li><li class="listitem"><p>如何取得硬體資訊。</p></li><li class="listitem"><p>如何量身訂做核心設定檔。</p></li><li class="listitem"><p>如何使用核心設定檔來建立並編譯新的核心。</p></li><li class="listitem"><p>如何安裝新的核心。</p></li><li class="listitem"><p>發生錯誤時如何排除問題。</p></li></ul></div><p>所有在本章所列出的指令均應以 <code class="systemitem">root</code> 來執行。</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-custom-kernel"></a>8.2. 為何要編譯自訂的核心?</h2></div></div></div><p>早期的 FreeBSD 的核心 (Kernel) 被戲稱為 “巨石”。因為當時的核心是一個非常大的程式，且只支援固定的硬體裝置，如果您想改變核心的設定，就必須編譯一個新核心並重新開機，才能使用。</p><p>現今，大多數在 FreeBSD 核心的功能已採用模組 (Module) 的方式包裝，並可依需求動態從核心載入或卸載。 這使得執行中的核心能夠快速適應新硬體環境並在核心開啟新的功能，這就是所謂模組化核心 (Modular Kernel)。</p><p>儘管如此，還是有一些功能因使用到靜態的核心設定須要編譯，因為這些功能與核心緊密結合，無法將做成可動態載入的模組。且部份強調安全性的環境會盡量避免載入與卸載核心模組，且只要將需要的功能靜態的編譯到核心當中。</p><p>編譯自訂的核心幾乎是每位進階的 BSD 使用者所必須經歷的過程。儘管這項工作可能比較耗時，但在 FreeBSD 的使用上會有許多好處。 跟必須支援大多數各式硬體的 <code class="filename">GENERIC</code> 核心相比的話， 自訂的核心可以更『體貼』，只支援『自己硬體』的部分就好。 自訂核心有許多項優點，如：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>加速開機，因為自訂的核心只需要偵測您系統上存在的硬體，所以讓啟動所花的過程更流暢快速。</p></li><li class="listitem"><p>減少記憶體使用，自訂的核心通常會比 <code class="filename">GENERIC</code> 核心使用更少的記憶體，這很重要，因為核心必須一直存放在實體記憶體內，會讓其他應用程式無法使用。因此，自訂核心對於記憶體較小的系統來說，發揮很大的作用。</p></li><li class="listitem"><p>支援額外的硬體，自訂的核心可以增加一些 <code class="filename">GENERIC</code> 核心沒有提供的硬體支援。</p></li></ul></div><p>在編譯自訂核心之前，請思考要這麼做的原因，若是因為需要特定硬體的支援，很可能已有既有的模組可以使用。</p><p>核心模組會放在 <code class="filename">/boot/kernel</code> 並且可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a> 動態載入到執行中的核心。大部份的核心驅動程式都有可載入的模組與操作手冊。例如 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ath&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ath</span>(4)</span></a> 無線乙太網路驅動程式在其操作手冊有以下資訊：</p><pre xml:lang="en" class="screen" lang="en">Alternatively, to load the driver as a module at boot time, place the
following line in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader.conf</span>(5)</span></a>:

    if_ath_load="YES"</pre><p>加入 <code class="literal">if_ath_load="YES"</code> 到 <code class="filename">/boot/loader.conf</code> 會於開機期間自動載入這個模組。</p><p>部份情況在 <code class="filename">/boot/kernel</code> 會沒有相關的模組，這對於某些子系統大多是真的。</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-devices"></a>8.3. 偵測系統硬體</h2></div></div></div><p>在編輯核心設定檔之前，建議先調查清楚機器各項硬體資訊。在雙作業系統的環境，也可透過其他作業系統來了解目前機器上的硬體資訊。 舉例來說，<span class="trademark">Microsoft</span>® 的 <span class="application">裝置管理員</span> (Device Manager) 內會有目前已安裝的硬體資訊。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">某些版本的 <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 會有<span class="application">系統</span> (System) 圖示可用來進入 <span class="application">裝置管理員</span>。</p></div><p>若 FreeBSD 是唯一安裝的作業系統，則可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a> 來查看開時時系統偵測到的硬體資訊 。FreeBSD 上大多硬體驅動程式都有操作手冊會列出支援的硬體。例如，以下幾行是說 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=psm&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">psm</span>(4)</span></a> 驅動程式偵測到了一隻滑鼠：</p><pre xml:lang="en" class="screen" lang="en">psm0: &lt;PS/2 Mouse&gt; irq 12 on atkbdc0
psm0: [GIANT-LOCKED]
psm0: [ITHREAD]
psm0: model Generic PS/2 mouse, device ID 0</pre><p>因為該硬體存在，此驅動程式便不應該從自訂核心設定檔中移除。</p><p>若 <code class="command">dmesg</code> 輸出的結果未顯示開機偵測硬體的部份，則可改閱讀 <code class="filename">/var/run/dmesg.boot</code> 檔案的內容。</p><p>另外，也可以透過 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pciconf&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pciconf</span>(8)</span></a> 工具可用來查詢硬體資訊，該工具會列出更詳細的硬體資訊如：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>pciconf -lv</code></strong>
ath0@pci0:3:0:0:        class=0x020000 card=0x058a1014 chip=0x1014168c rev=0x01 hdr=0x00
    vendor     = 'Atheros Communications Inc.'
    device     = 'AR5212 Atheros AR5212 802.11abg wireless'
    class      = network
    subclass   = ethernet</pre><p>以上輸出資訊說明 <code class="filename">ath</code> 驅動程式已經找到一個無線乙太網路裝置。</p><p>在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=man&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">man</span>(1)</span></a> 指令加上 <code class="option">-k</code> 旗標可提供有用的資訊，例如，這可列出有包含指定裝置品牌或名稱的手冊頁面清單：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>man -k <em class="replaceable"><code>Atheros</code></em></code></strong>
ath(4)                   - Atheros IEEE 802.11 wireless network driver
ath_hal(4)               - Atheros Hardware Access Layer (HAL)</pre><p>準備好硬體清單之後，參考該清單來確認已安裝的硬體驅動程式在編輯自訂核心設定時沒有被移除。</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-config"></a>8.4. 設定檔</h2></div></div></div><p>為了要建立自訂核心設定檔並編譯自訂核心，必須先安裝完整的 FreeBSD 原始碼樹。</p><p>若 <code class="filename">/usr/src/</code> 目錄不存在或者是空的，代表尚未安裝。原始碼可以使用 <span class="application">Subversion</span> 並依據 <a class="xref" href="#svn" title="A.3. 使用 Subversion">節 A.3, “使用 <span class="application">Subversion</span>”</a> 中的操作說明來安裝。</p><p>完成原始碼安裝完成後，需檢查 <code class="filename">/usr/src/sys</code> 內的檔案。該目錄內包含數個子目錄，這些子目錄代表著支援的硬體架構 (Architecture) 如下：<code class="filename">amd64</code>, <code class="filename">i386</code>, <code class="filename">ia64</code>, <code class="filename">powerpc</code> 以及 <code class="filename">sparc64</code>。在指定架構目錄中的內容只對該架構有效，其餘部份的程式碼與硬體架構無關，可通用所有平台。每個支援的硬體架構中會有 <code class="filename">conf</code> 子目錄，裡面含有供該架構使用的 <code class="filename">GENERIC</code> 核心設定檔。</p><p>請不要直接對 <code class="filename">GENERIC</code> 檔案做編輯。複製該檔案為另一個名稱，並對複製出來的檔案做編輯，習慣上檔名會全部使用大寫字元。當維護多台安裝不同的硬體的 FreeBSD 機器時，將檔名後方加上機器的主機名稱 (Host name) 是個不錯的方法。以下範例使用 <code class="literal">amd64</code> 架構的 <code class="filename">GENERIC</code> 設定檔建立了一個複本名稱為 <code class="filename">MYKERNEL</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/<em class="replaceable"><code>amd64</code></em>/conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cp GENERIC <em class="replaceable"><code>MYKERNEL</code></em></code></strong></pre><p>現在可以使用任何 <acronym class="acronym">ASCII</acronym> 文字編輯器來自訂 <code class="filename"><em class="replaceable"><code>MYKERNEL</code></em></code>。預設的編輯器為 <span class="application">vi</span>，在 FreeBSD 也內建一個易於初學者使用的編輯器叫做 <span class="application">ee</span>。</p><a id="idp68629432" class="indexterm"></a><a id="idp68647096" class="indexterm"></a><a id="idp68647736" class="indexterm"></a><p>核心設定檔的格式很簡單，每一行會含有代表裝置 (Device) 或子系統 (Subsystem) 的關鍵字、參數以及簡短的說明。任何在 <code class="literal">#</code> 符號之後的文字會被當做註解並且略過。要移除核心對某個裝置或子系統的支援，僅需要在代表該裝置或子系統的行前加上 <code class="literal">#</code> 符號。請不要在您還不了解用途的行前加上或移除 <code class="literal">#</code> 符號。</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">移除對裝置或選項的支援很容易會造成核心損壞。例如，若從核心設定檔 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ata&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ata</span>(4)</span></a> 驅動程式，那麼使用 <acronym class="acronym">ATA</acronym> 磁碟驅動程式的系統便會無法開機。因此當您不確定時，請在核心保留該項目的支援。</p></div><p>除了在設定檔中提供的簡短說明之外，尚有其他的說明在 <code class="filename">NOTES</code> 檔案中，可在與該架構 <code class="filename">GENERIC</code> 相同的目錄底下找到。要查看所有架構通用的選項，請參考 <code class="filename">/usr/src/sys/conf/NOTES</code>。</p><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml">當完成自訂的核心設定檔，請備份到 <code class="filename">/usr/src</code> 位置之外。</p><p xmlns="http://www.w3.org/1999/xhtml">或者，將核心設定檔放在其他地方，然後建立一個符號連結 (Symbolic link) 至該檔案：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/amd64/conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir /root/kernels</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cp GENERIC /root/kernels/MYKERNEL</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /root/kernels/MYKERNEL</code></strong></pre></div><p>設定檔中可以使用 <code class="literal">include</code> 指令 (Directive)。該指令可以引用其他設定檔到目前的設定檔，這讓只需根據現有檔案設定做些微調整時更簡單。若只有少量的額外選項或驅動程式需要設定，該指令可引用 <code class="filename">GENERIC</code> 並設定額外增加的選項，如範例所示：</p><pre xml:lang="en" class="programlisting" lang="en">include GENERIC
ident MYKERNEL

options         IPFIREWALL
options         DUMMYNET
options         IPFIREWALL_DEFAULT_TO_ACCEPT
options         IPDIVERT</pre><p>使用此方法，設定檔只含有與 <code class="filename">GENERIC</code> 核心不同的部份。當升級有新功能加入 <code class="filename">GENERIC</code> 時，也可一併引用，除非特別使用 <code class="literal">nooptions</code> 或 <code class="literal">nodevice</code> 選項來排除設定。更詳細的設定檔指令及其說明可在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=config&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">config</span>(5)</span></a> 找到。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">要產生含有所有可用選項的設定檔，可以 <code class="systemitem">root</code> 執行以下指令：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/<em class="replaceable"><code>arch</code></em>/conf &amp;&amp; make LINT</code></strong></pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-building"></a>8.5. 編譯與安裝自訂核心</h2></div></div></div><p>完成自訂設定檔的編輯並儲存之後，便可依據以下步驟編譯核心的原始碼：</p><div class="procedure"><a id="idp68761912"></a><div class="procedure-title">過程 8.1. 編譯核心</div><a id="idp68762552" class="indexterm"></a><ol class="procedure" type="1"><li class="step"><p>切換至此目錄：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong></pre></li><li class="step"><p>指定自訂核心設定檔的名稱來編譯新的核心：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>make buildkernel KERNCONF=<em class="replaceable"><code>MYKERNEL</code></em></code></strong></pre></li><li class="step"><p>安裝使用指定核心設定檔所編譯的新核心。此指令將會複製新核心到 <code class="filename">/boot/kernel/kernel</code> 並將舊核心備份到 <code class="filename">/boot/kernel.old/kernel</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>make installkernel KERNCONF=<em class="replaceable"><code>MYKERNEL</code></em></code></strong></pre></li><li class="step"><p>關機並重新開機載入新的核心，若發生錯誤請參考 <a class="xref" href="#kernelconfig-noboot">無法使用核心開機</a>。</p></li></ol></div><p>預設在自訂核心編譯完成後，所有核心模組也同被重新編譯。要快速更新核心或只編譯自訂的模組，需在開始編譯之前先編輯 <code class="filename">/etc/make.conf</code>。</p><p>例如，使用以下變數可指定要編譯的模組清單來替代預設編譯所有模組的設定：</p><pre xml:lang="en" class="programlisting" lang="en">MODULES_OVERRIDE = linux acpi</pre><p>或者，可使用以下變數來從編譯程序中排除要編譯的模組：</p><pre xml:lang="en" class="programlisting" lang="en">WITHOUT_MODULES = linux acpi sound</pre><p>尚有其他可用的變數，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=make.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">make.conf</span>(5)</span></a> 取得詳細資訊。</p><a id="idp68775480" class="indexterm"></a></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-trouble"></a>8.6. 如果發生錯誤</h2></div></div></div><p>當編譯自訂核心時可能發生以下四種類型的問題：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="command">config</code> 失敗</span></dt><dd><p>若 <code class="command">config</code> 失敗，會列出不正確的行號。使用以下訊息為例子，需要與 <code class="filename">GENERIC</code> 或 <code class="filename">NOTES</code> 比對來確認第 17 行輸入的內容正確：</p><pre xml:lang="en" class="screen" lang="en">config: line 17: syntax error</pre></dd><dt><span class="term"><code class="command">make</code> 失敗</span></dt><dd><p>若 <code class="command">make</code> 失敗，通常是因為核心設定檔未提供足夠的資訊讓 <code class="command">config</code> 找到問題。請仔細檢查設定檔，若仍不清楚問題，請寄發電子郵件給 <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions" target="_top">FreeBSD general questions mailing list</a> 並附上核心設定檔。</p></dd><dt><a id="kernelconfig-noboot"></a><span class="term">無法使用核心開機</span></dt><dd><p>若新核心無法開機或無法辨識裝置並不要恐慌！幸好，FreeBSD 有良好的機制可以從不相容的核心復原。只需要在 FreeBSD 開機載入程式 (Boot loader) 選擇要用來開機的核心便可，當系統開機選單出現時選擇 <span class="quote">“<span class="quote">Escape to a loader prompt</span>”</span> 選項，並在指令提示後輸入 <code class="command">boot <em class="replaceable"><code>kernel.old</code></em></code> 或替換為任何其他已經知道可以正常開機的核心名稱。</p><p>使用好的核心開機之後，檢查設定檔並嘗試再編譯一次。<code class="filename">/var/log/messages</code> 是有用的資源，它在每次成功開機時會記錄核心訊息。同樣的，<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a> 也會印出自本次開機後的核心訊息。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">在排除核心問題時，請確定留有 <code class="filename">GENERIC</code> 的複本，或者其他已知可以運作的核心，並使用不同的名稱來確保下次編譯時不會被刪除，這很重要，因此每當新的核心被安裝之後，<code class="filename">kernel.old</code> 都會被最後安裝的核心覆寫，有可能會無法開機。盡快，透過重新命名將可運作的核心目錄移動到目前運作的核心目錄：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mv /boot/kernel <em class="replaceable"><code>/boot/kernel.bad</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv /boot/<em class="replaceable"><code>kernel.good</code></em> /boot/kernel</code></strong></pre></div></dd><dt><span class="term">核心可運作，但 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> 無法運作</span></dt><dd><p>若核心版本與系統工具所編譯的版本不同，例如，有一個核心使用 -CURRENT 的原始碼編譯並安裝在 -RELEASE 的系統上，許多系統狀態指令如 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> 及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vmstat&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vmstat</span>(8)</span></a> 將會無法運作。要修正此問題，請使用與核心相同版本的原始碼樹 (Source tree) <a class="link" href="#makeworld" title="23.5. 從原始碼更新 FreeBSD">重新編譯並安裝 World</a>。使用與作業系統其他部份版本不同的核心永遠不會是個好主意。</p></dd></dl></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing"></a>章 9. 列印</h2></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Warren</span> <span class="surname">Block</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#printing-quick-start">9.1. 快速開始</a></span></dt><dt><span class="sect1"><a href="#printing-connections">9.2. 印表機連線</a></span></dt><dd><dl><dt><span class="sect2"><a href="#printing-connections-summary">9.2.1. 摘要</a></span></dt></dl></dd><dt><span class="sect1"><a href="#printing-pdls">9.3. 常見的頁面描述語言</a></span></dt><dd><dl><dt><span class="sect2"><a href="#print-pdls-table">9.3.1. 轉換 <span class="trademark">PostScript</span>® 至其他 <acronym class="acronym">PDL</acronym></a></span></dt><dt><span class="sect2"><a href="#print-pdls-summary">9.3.2. 摘要</a></span></dt></dl></dd><dt><span class="sect1"><a href="#printing-direct">9.4. 直接列印</a></span></dt><dt><span class="sect1"><a href="#printing-lpd">9.5. <acronym class="acronym">LPD</acronym> (行列式印表機 Daemon)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#printing-lpd-setup">9.5.1. 初始設定</a></span></dt><dt><span class="sect2"><a href="#printing-lpd-lpr">9.5.2. 使用 lpr(1) 列印</a></span></dt><dt><span class="sect2"><a href="#printing-lpd-filters">9.5.3. 過濾器</a></span></dt><dd><dl><dt><span class="sect3"><a href="#printing-lpd-filters-stairstep">9.5.3.1. 避免在純文字印表機階梯狀列印</a></span></dt><dt><span class="sect3"><a href="#printing-lpd-filters-enscript">9.5.3.2. 使用 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/enscript/pkg-descr">print/enscript</a> 在 <span class="trademark">PostScript</span>® 印表機美化純文字內容</a></span></dt><dt><span class="sect3"><a href="#printing-lpd-filters-ps2pcl">9.5.3.3. 列印 <span class="trademark">PostScript</span>® 到 <acronym class="acronym">PCL</acronym> 印表機</a></span></dt><dt><span class="sect3"><a href="#printing-lpd-filters-smart">9.5.3.4. 智慧過濾器</a></span></dt><dt><span class="sect3"><a href="#printing-lpd-filters-othersmart">9.5.3.5. 其他智慧過濾器</a></span></dt></dl></dd><dt><span class="sect2"><a href="#printing-lpd-queues">9.5.4. 多序列</a></span></dt><dt><span class="sect2"><a href="#printing-lpd-monitor">9.5.5. 監視與控制列印</a></span></dt><dd><dl><dt><span class="sect3"><a href="#printing-lpd-monitor-lpq">9.5.5.1. lpq(1)</a></span></dt><dt><span class="sect3"><a href="#printing-lpd-monitor-lprm">9.5.5.2. lprm(1)</a></span></dt><dt><span class="sect3"><a href="#printing-lpd-monitor-lpc">9.5.5.3. lpc(8)</a></span></dt></dl></dd><dt><span class="sect2"><a href="#printing-lpd-shared">9.5.6. 分享印表機</a></span></dt><dd><dl><dt><span class="sect3"><a href="#printing-shared-aliases">9.5.6.1. 別名</a></span></dt><dt><span class="sect3"><a href="#printing-shared-headers">9.5.6.2. 頁首</a></span></dt></dl></dd><dt><span class="sect2"><a href="#printing-lpd-references">9.5.7. 參考文獻</a></span></dt></dl></dd><dt><span class="sect1"><a href="#printing-other">9.6. 其他列印系統</a></span></dt><dd><dl><dt><span class="sect2"><a href="#printing-other-cups">9.6.1. <acronym class="acronym">CUPS</acronym> (Common <span class="trademark">UNIX</span>® Printing
	System)</a></span></dt><dt><span class="sect2"><a href="#printing-other-hplip">9.6.2. HPLIP</a></span></dt><dt><span class="sect2"><a href="#printing-other-lprng">9.6.3. LPRng</a></span></dt></dl></dd></dl></div><p>儘管很多人試圖淘汰列印功能，但列印資訊到紙上仍是一個重要的功能。列印由兩個基本元件組成，包含了資料傳送到印表機的方式以及印表機可以理解的資料形式。</p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-quick-start"></a>9.1. 快速開始</h2></div></div></div><p>基本的列印功能可以快速設定完成，列印機必須能夠列印純 <acronym class="acronym">ASCII</acronym> 文字。若要列印其他類型的檔案，請參考 <a class="xref" href="#printing-lpd-filters" title="9.5.3. 過濾器">節 9.5.3, “過濾器”</a>。</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>建立一個目錄來儲存要被列印的檔案：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /var/spool/lpd/lp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chown daemon:daemon /var/spool/lpd/lp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chmod 770 /var/spool/lpd/lp</code></strong></pre></li><li class="step"><p>以 <code class="systemitem">root</code> 建立 <code class="filename">/etc/printcap</code> 內容如下：</p><pre xml:lang="en" class="programlisting" lang="en">lp:\
	<em class="replaceable"><code>:lp=/dev/unlpt0:\</code></em>  <a id="printing-qs-co-printcap"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
	:sh:\
	:mx#0:\
	:sd=/var/spool/lpd/lp:\
	:lf=/var/log/lpd-errs:</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#printing-qs-co-printcap"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>此行是針對連接到 <acronym class="acronym">USB</acronym> 埠的印表機。</p><p>連接到並列或 <span class="quote">“<span class="quote">印表器 (Printer)</span>”</span> 埠的印表機要使用：</p><pre xml:lang="en" class="programlisting" lang="en">:lp=/dev/lpt0:\</pre><p>直接連接到網路的印表機要使用：</p><pre xml:lang="en" class="programlisting" lang="en">:lp=:rm=<em class="replaceable"><code>network-printer-name</code></em>:rp=raw:\</pre><p>替換 <em class="replaceable"><code>network-printer-name</code></em> 為網路印表機的 <acronym class="acronym">DNS</acronym> 主機名稱。</p></td></tr></table></div></li><li class="step"><p>編輯 <code class="filename">/etc/rc.conf</code> 加入下行來開啟 <code class="command">lpd</code>：</p><pre xml:lang="en" class="programlisting" lang="en">lpd_enable="YES"</pre><p>啟動服務：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service lpd start</code></strong>
Starting lpd.</pre></li><li class="step"><p>測試列印：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>printf "1. This printer can print.\n2. This is the second line.\n" | lpr</code></strong></pre><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml">若列印的兩行未從左邊界開始，而是呈現 <span class="quote">“<span class="quote">階梯狀 (Stairstep)</span>”</span>，請參考 <a class="xref" href="#printing-lpd-filters-stairstep" title="9.5.3.1. 避免在純文字印表機階梯狀列印">節 9.5.3.1, “避免在純文字印表機階梯狀列印”</a>。</p></div><p>現在可以使用 <code class="command">lpr</code> 來列印文字檔，只要在指令列給序檔案名稱，或者將輸出使用管線符號 (Pipe) 傳送給 <code class="command">lpr</code>。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>lpr textfile.txt</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>ls -lh | lpr</code></strong></pre></li></ol></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-connections"></a>9.2. 印表機連線</h2></div></div></div><p>印表機有許多方式可以連接到電腦，小型的桌面印表機會直接連接到電腦的 <acronym class="acronym">USB</acronym> 埠，舊式的印表機會連接到並列 (Parallel) 或 <span class="quote">“<span class="quote">印表機 (Printer)</span>”</span> 埠，而有一部份印表機則是直接連接網路，讓印表機能夠給多台電腦共享使用，還有少部分印表機則是連接到較罕見的序列 (Serial) 埠。</p><p>FreeBSD 可以與這些類型的印表機溝通。</p><div class="variablelist"><dl class="variablelist"><dt><a id="printing-connections-usb"></a><span xml:lang="en" class="term" lang="en"><acronym class="acronym">USB</acronym></span></dt><dd><p><acronym class="acronym">USB</acronym> 印表機可以連接到電腦上任何可用的 <acronym class="acronym">USB</acronym> 埠。</p><p>當 FreeBSD 偵測到 <acronym class="acronym">USB</acronym> 印表機，會建立兩個裝置項目：<code class="filename">/dev/ulpt0</code> 以及 <code class="filename">/dev/unlpt0</code>，傳送到兩者任一裝置的資料都會被轉發到印表機。在每個列印工作完成後 <code class="filename">ulpt0</code> 便會重設 <acronym class="acronym">USB</acronym> 埠，重設 <acronym class="acronym">USB</acronym> 埠可能會在部份印表機造成問題，因此通常可以改使用 <code class="filename">unlpt0</code>  裝置。<code class="filename">unlpt0</code> 不會重設 USB 埠。</p></dd><dt><a id="printing-connections-parallel"></a><span class="term">並列 (<acronym class="acronym">IEEE</acronym>-1284)</span></dt><dd><p>並列埠裝置使用 <code class="filename">/dev/lpt0</code>，此裝置不論印表機是否連接上都會存在，它並不會自動偵測。</p><p>供應商已不再採用這種 <span class="quote">“<span class="quote">舊式</span>”</span> 連接埠，且有許多電腦甚至已沒有這種連接埠。可以用轉接器來連接並列印表機到 <acronym class="acronym">USB</acronym> 埠，有了轉接器，並列印表機可以被當作 <acronym class="acronym">USB</acronym> 印表機使用。有另一種稱作 <span class="emphasis"><em>列印伺服器 (Print server)</em></span> 的裝置也可用來連接並列印表機到網路。</p></dd><dt><a id="printing-connections-serial"></a><span class="term">序列 (RS-232)</span></dt><dd><p>序列埠也是另一種舊式連接埠，已很少用在印表機上，除了某些特殊的應用外，纜線、接頭與需要的佈線方式依需求變化性很大。</p><p>內建在主機板的序列埠的序列裝置名稱為 <code class="filename">/dev/cuau0</code> 或 <code class="filename">/dev/cuau1</code>。也有序列 <acronym class="acronym">USB</acronym> 轉接器可使用，而裝置的的名稱則會是 <code class="filename">/dev/cuaU<em class="replaceable"><code>0</code></em></code>。</p><p>要與序列印表機通訊必須知道數個通訊參數，其中最重要的是 <span class="emphasis"><em>傳輸速率 (Baud rate)</em></span> 或 <acronym class="acronym">BPS</acronym> (Bits Per Second) 以及 <span class="emphasis"><em>同位檢查 (Parity)</em></span>。數值有數種，但一般序列印表機會使用 的傳輸速率是 9600 且無同位檢查。</p></dd><dt><a id="printing-connections-network"></a><span class="term">網路</span></dt><dd><p>網路印表機可直接連接到區域網路。</p><p>若印表機透過 <acronym class="acronym">DHCP</acronym> 分配動態位址，則必須要知道 <acronym class="acronym">DNS</acronym> 主機名稱，<acronym class="acronym">DNS</acronym> 應動態更新來讓主機名稱能夠對應到正確的 <acronym class="acronym">IP</acronym> 位址。指定網路印表機一個靜態的 <acronym class="acronym">IP</acronym> 位址可避免這個問題。</p><p>大多數網路印表機可以認得使用 <acronym class="acronym">LPD</acronym> 通訊協定所送出的列印工作，列印佇列 (Print queue) 的名稱也會在這時指定。部份印表機會依據使用的佇列來決定處理資料的方式，例如 <code class="literal">raw</code> 佇列會列印原始資料，而 <code class="literal">text</code> 佇列則會在純文字上增加換行符號 (Carriage return)。</p><p>大部份網路印表機也可列印直接傳送到埠號 9100 的資料。</p></dd></dl></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-connections-summary"></a>9.2.1. 摘要</h3></div></div></div><p>有線網路連線通常是安裝最簡單的方式，且可以提供快速的列印。若要直接連接到電腦，較建議使用 <acronym class="acronym">USB</acronym>，由於較快速、簡單。並列連線仍然可以使用，但有纜線長度與速度上的限制。而序列連線則比較難設定，不同型號的纜線佈線方式不同，且通訊參數如傳輸速率及同位檢查增加了複雜性，所幸序列印表機並不多。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-pdls"></a>9.3. 常見的頁面描述語言</h2></div></div></div><p>傳送給印表機的資料必須使用印表機能夠理解的語言，這些語言稱為頁面描述語言 (Page Description Languages) 或 <acronym class="acronym">PDL</acronym>。</p><div class="variablelist"><dl class="variablelist"><dt><a id="print-pdls-ascii"></a><span xml:lang="en" class="term" lang="en"><acronym class="acronym">ASCII</acronym></span></dt><dd><p>純 <acronym class="acronym">ASCII</acronym> 文字是傳送資料到印表機最簡單的方式，一個字元對應一個要列印的文字：資料中的 <code class="literal">A</code> 會列印一個 <code class="literal">A</code> 在頁面。可以使用的格式非常少，沒有辦法選擇字型或者比例間距。強迫使用簡單的純 <acronym class="acronym">ASCII</acronym> 為的是讓文字可以直接從電腦列印只需一點或甚至不需要編碼或轉譯，列印的結果可直接對應傳送的內容。</p><p>部份便宜印表機無法列印純 <acronym class="acronym">ASCII</acronym> 文字，這讓這些印表機較難設定。</p></dd><dt><a id="print-pdls-postscript"></a><span xml:lang="en" class="term" lang="en"><span class="trademark">PostScript</span>®</span></dt><dd><p><span class="trademark">PostScript</span>® 與 <acronym class="acronym">ASCII</acronym> 幾乎相反，與簡單的文字不同，<span class="trademark">PostScript</span>® 程式語言有一套指令可以繪出最終所要的文件，可以使用不同的字型與圖形，但是，這樣強大的功能是有代價的，繪製頁面需要搛寫程式語言，通常這個程式語言會由應用程式產生，所以使用者是看不到的。</p><p>便宜的印表機有時會移除 <span class="trademark">PostScript</span>®  的相容性來節省成本。</p></dd><dt><a id="print-pdls-pcl"></a><span xml:lang="en" class="term" lang="en"><acronym class="acronym">PCL</acronym> (Printer Command Language)</span></dt><dd><p><acronym class="acronym">PCL</acronym> 由 <acronym class="acronym">ASCII</acronym> 延伸而來，加入了跳脫序列 (Escape sequence) 來標示格式、選擇字型以及列印圖型。大部份印表機都支援 <acronym class="acronym">PCL5</acronym>，少數支援較新的 <acronym class="acronym">PCL6</acronym> 或 <acronym class="acronym">PCLXL</acronym>，這些後來的版本是 <acronym class="acronym">PCL5</acronym> 的超集合 (Superset)，並可以提供更快的列印速度。</p></dd><dt><a id="print-pdls-host-based"></a><span class="term">以主機為基礎 (Host-Based)</span></dt><dd><p>製造商可能會使用簡單的處理器和較小的記憶體來降低印表機的成本，這些印表機無法列印純文字，相反的，文字與圖形會先在機器上的驅動程式畫完後傳送到印表機。這些稱為<span class="emphasis"><em>以主機為基礎 (Host-based)</em></span> 的印表機。</p><p>驅動程式與以主機為基礎的印表機通訊通常會透過專用或無文件的通訊協定，這讓這些印表機只能在最常用的作業系統上運作。</p></dd></dl></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="print-pdls-table"></a>9.3.1. 轉換 <span class="trademark">PostScript</span>® 至其他 <acronym class="acronym">PDL</acronym></h3></div></div></div><p>Port 套件集與 FreeBSD 工具集有許多可以處理 <span class="trademark">PostScript</span>® 輸出的應用程式，此表整理出了可轉換 <span class="trademark">PostScript</span>® 成其他常用 <acronym class="acronym">PDL</acronym> 的工具：</p><div class="table"><a id="print-pdls-ps-to-other-tbl"></a><div class="table-title">表格 9.1. 輸出 <acronym class="acronym">PDL</acronym> 格式</div><div class="table-contents"><table summary="輸出 PDL 格式" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="left">輸出 <acronym class="acronym">PDL</acronym></th><th align="left">產生由</th><th align="left">說明</th></tr></thead><tbody><tr><td align="left"><acronym class="acronym">PCL</acronym> 或 <acronym class="acronym">PCL5</acronym></td><td xml:lang="en" align="left" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/ghostscript9-base/pkg-descr">print/ghostscript9-base</a></td><td align="left">單色使用 <code class="literal">-sDEVICE=ljet4</code>、彩色使用 <code class="literal">-sDEVICE=cljet5</code></td></tr><tr><td align="left"><acronym class="acronym">PCLXL</acronym> 或 <acronym class="acronym">PCL6</acronym></td><td xml:lang="en" align="left" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/ghostscript9-base/pkg-descr">print/ghostscript9-base</a></td><td align="left">單色使用 <code class="literal">-sDEVICE=pxlmono</code>、彩色使用 <code class="literal">-sDEVICE=pxlcolor</code></td></tr><tr><td xml:lang="en" align="left" lang="en"><acronym class="acronym">ESC/P2</acronym></td><td xml:lang="en" align="left" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/ghostscript9-base/pkg-descr">print/ghostscript9-base</a></td><td xml:lang="en" align="left" lang="en"><code class="literal">-sDEVICE=uniprint</code></td></tr><tr><td xml:lang="en" align="left" lang="en"><acronym class="acronym">XQX</acronym></td><td xml:lang="en" align="left" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/foo2zjs/pkg-descr">print/foo2zjs</a></td><td align="left"> </td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="print-pdls-summary"></a>9.3.2. 摘要</h3></div></div></div><p>要可以列印最簡單的方式就是選擇支援 <span class="trademark">PostScript</span>® 的印表機，再來是支援 <acronym class="acronym">PCL</acronym> 的印表機，有了 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/ghostscript9-base/pkg-descr">print/ghostscript9-base</a> 這些印表機也可像原生支援 <span class="trademark">PostScript</span>® 的印表機一般使用。有直接支援 <span class="trademark">PostScript</span>® 或 <acronym class="acronym">PCL</acronym> 的印表機通常也會直接支援純 <acronym class="acronym">ASCII</acronym> 文字檔案。</p><p>行列式印表機如同典型的噴墨式印表機通常不支援 <span class="trademark">PostScript</span>® 或 <acronym class="acronym">PCL</acronym>，這種印表機通常可以列印純 <acronym class="acronym">ASCII</acronym> 文字檔案。<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/ghostscript9-base/pkg-descr">print/ghostscript9-base</a> 支援部份這種印表機使用的 <acronym class="acronym">PDL</acronym>，不過要在這種印表機上列印完全以圖型為基礎的頁面通常會非常緩慢，由於需要傳送大量的資料並列印。</p><p>以主機為基礎的印表機通常較難設定，有些會因為用了專用的 <acronym class="acronym">PDL</acronym> 而無法使用，盡可能避免使用這類的印表機。</p><p>有關各種 <acronym class="acronym">PDL</acronym> 的介紹可至 <a class="link" href="http://www.undocprint.org/formats/page_description_languages" target="_top">http://www.undocprint.org/formats/page_description_languages</a>。各種型號印表機所使用的特定 <acronym class="acronym">PDL</acronym> 可至 <a class="link" href="http://www.openprinting.org/printers" target="_top">http://www.openprinting.org/printers</a> 查詢。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-direct"></a>9.4. 直接列印</h2></div></div></div><p>對於偶爾列印，檔案可以直接傳送到印表機裝置，無需做任何設定。例如，要傳送一個名稱為 <code class="filename">sample.txt</code> 的檔案到 <acronym class="acronym">USB</acronym> 印表機：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cp sample.txt /dev/unlpt0</code></strong></pre><p>要直接使用網路印表機列印需看該印表機支援的功能，但大多數會接受埠號 9100 的列印作業，可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=nc&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">nc</span>(1)</span></a> 來完成。要使用 <acronym class="acronym">DNS</acronym> 主機名稱為 <em class="replaceable"><code>netlaser</code></em> 的印表機列印與上述相同的檔案可：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>nc <em class="replaceable"><code>netlaser</code></em> 9100 &lt; sample.txt</code></strong></pre></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-lpd"></a>9.5. <acronym class="acronym">LPD</acronym> (行列式印表機 Daemon)</h2></div></div></div><p>在背景列印一個檔案稱作 <span class="emphasis"><em>Spooling</em></span>，緩衝程式 (Spooler) 讓使用者能夠繼續執行電腦的其他程式而不需要等候印表機緩慢的完成列印工作。</p><p>FreeBSD 內含的緩衝程式 (Spooler) 稱作 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpd</span>(8)</span></a>，而列印工作會使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a> 來提交。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-setup"></a>9.5.1. 初始設定</h3></div></div></div><p>建立要用來儲存列印工作的目錄、設定擁有關係以及權限來避免其他使用者可以檢視這些檔案的內容：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /var/spool/lpd/lp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chown daemon:daemon /var/spool/lpd/lp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chmod 770 /var/spool/lpd/lp</code></strong></pre><p>印表機會定義在 <code class="filename">/etc/printcap</code>，每台印表機項目所包含的詳細資料有名稱、連接的接頭以及各種其他設定。建立 <code class="filename">/etc/printcap</code> 使用以下內容：</p><pre xml:lang="en" class="programlisting" lang="en">lp:\				<a id="printing-lpd-co-name"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
	:lp=/dev/unlpt0:\	<a id="printing-lpd-co-device"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
	:sh:\			<a id="printing-lpd-co-header"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
	:mx#0:\			<a id="printing-lpd-co-mx"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
	:sd=/var/spool/lpd/lp:\	<a id="printing-lpd-co-sd"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
	:lf=/var/log/lpd-errs:	<a id="printing-lpd-co-lf"></a><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#printing-lpd-co-name"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>印表機的名稱。 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a> 會傳送列印工作到 <code class="literal">lp</code> 印表機，除非有使用 <code class="option">-P</code> 來指定其他印表機，所以預的印表機名稱應使用 <code class="literal">lp</code>。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#printing-lpd-co-device"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>印表機所連接到裝置。替換此行為正確的連線類型，如此處所示。</p><div class="informaltable"><a id="printing-lpd-co-device-tbl"></a><table border="1"><colgroup><col /><col /></colgroup><thead><tr><th>連線類型</th><th>在 <code class="filename">/etc/printcap</code> 的裝置項目</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><acronym class="acronym">USB</acronym></td><td><pre xml:lang="en" class="programlisting" lang="en">:lp=/dev/unlpt0:\</pre>

		    <p>此為<span class="emphasis"><em>不會重設</em></span> <acronym class="acronym">USB</acronym> 印表機的裝置，若使用上發生問題，請改使用 <code class="filename">ulpt0</code>，這個裝置會在每次使用後重設 <acronym class="acronym">USB</acronym> 埠。</p></td></tr><tr><td>並列</td><td><pre xml:lang="en" class="programlisting" lang="en">:lp=/dev/lpt0:\</pre></td></tr><tr><td>網路</td><td><p>針對支援 <acronym class="acronym">LPD</acronym> 通訊協定的印表機：</p>

		    <pre xml:lang="en" class="programlisting" lang="en">:lp=:rm=<em class="replaceable"><code>network-printer-name</code></em>:rp=raw:\</pre>

		    <p>針對支援使用埠號 9100 列印的印表機：</p>

		    <pre xml:lang="en" class="programlisting" lang="en">:lp=9100@<em class="replaceable"><code>network-printer-name</code></em>:\</pre>

		    <p>針對兩者皆支援的印表機，請替換 <em class="replaceable"><code>network-printer-name</code></em> 為網路印表機的 <acronym class="acronym">DNS</acronym> 主機名稱。</p></td></tr><tr><td>序列</td><td><pre xml:lang="en" class="programlisting" lang="en">:lp=/dev/cuau0:br=9600:pa=none:\</pre>

		    <p>這些是一般序列印表機連接到主機板序列埠會採用的數值，傳輸速率 (Baud rate) 是 9600 且無同位檢查 (No Parity)。</p></td></tr></tbody></table></div></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#printing-lpd-co-header"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>在列印工作開始時不列印首頁。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#printing-lpd-co-mx"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>不限制列印工作的最大尺寸。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#printing-lpd-co-sd"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>此印表機的緩衝 (Spooling) 目錄路徑，每台印表機會自己使用一個獨立的緩衝 (Spooling) 目錄。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#printing-lpd-co-lf"><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>回報此印表機的錯誤的日誌檔。</p></td></tr></table></div><p>在建立 <code class="filename">/etc/printcap</code> 之後，使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chkprintcap&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chkprintcap</span>(8)</span></a> 測試印表機是否有錯誤：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>chkprintcap</code></strong></pre><p>在繼續之前修正任何回報的問題。</p><p>開啟 <code class="filename">/etc/rc.conf</code> 中的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpd</span>(8)</span></a>：</p><pre xml:lang="en" class="programlisting" lang="en">lpd_enable="YES"</pre><p>啟動服務：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service lpd start</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-lpr"></a>9.5.2. 使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a> 列印</h3></div></div></div><p xml:lang="en" lang="en">Documents are sent to the printer with
	<code class="command">lpr</code>.  A file to be printed can be named on
	the command line or piped into <code class="command">lpr</code>.  These
	two commands are equivalent, sending the contents of
	<code class="filename">doc.txt</code> to the default printer:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>lpr doc.txt</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>cat doc.txt | lpr</code></strong></pre><p xml:lang="en" lang="en">Printers can be selected with <code class="option">-P</code>.  To
	print to a printer called
	<em class="replaceable"><code>laser</code></em>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>lpr -Plaser doc.txt</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-filters"></a>9.5.3. 過濾器</h3></div></div></div><p xml:lang="en" lang="en">The examples shown so far have sent the contents of a text
	file directly to the printer.  As long as the printer
	understands the content of those files, output will be printed
	correctly.</p><p xml:lang="en" lang="en">Some printers are not capable of printing plain text, and
	the input file might not even be plain text.</p><p xml:lang="en" lang="en"><span class="emphasis"><em>Filters</em></span> allow files to be
	translated or processed.  The typical use is to translate one
	type of input, like plain text, into a form that the printer
	can understand, like <span class="trademark">PostScript</span>® or <acronym class="acronym">PCL</acronym>.
	Filters can also be used to provide additional features, like
	adding page numbers or highlighting source code to make it
	easier to read.</p><p xml:lang="en" lang="en">The filters discussed here are
	<span class="emphasis"><em>input filters</em></span> or
	<span class="emphasis"><em>text filters</em></span>.  These filters convert the
	incoming file into different forms.  Use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> to become
	<code class="systemitem">root</code> before
	creating the files.</p><p xml:lang="en" lang="en">Filters are specified in
	<code class="filename">/etc/printcap</code> with the
	<code class="literal">if=</code> identifier.  To use
	<code class="filename">/usr/local/libexec/lf2crlf</code> as a filter,
	modify <code class="filename">/etc/printcap</code> like this:</p><pre xml:lang="en" class="programlisting" lang="en">lp:\
	:lp=/dev/unlpt0:\
	:sh:\
	:mx#0:\
	:sd=/var/spool/lpd/lp:\
	:if=/usr/local/libexec/lf2crlf:\   <a id="printing-lpd-filters-co-if"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
	:lf=/var/log/lpd-errs:</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#printing-lpd-filters-co-if"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en"><code class="literal">if=</code> identifies the
	    <span class="emphasis"><em>input filter</em></span> that will be used on
	    incoming text.</p></td></tr></table></div><div xmlns="" class="tip"><h3 class="admontitle"><a xmlns="http://www.w3.org/1999/xhtml" id="printing-lpd-filters-oneline"></a>提示: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The backslash <span class="emphasis"><em>line continuation</em></span>
	  characters at the end of the lines in
	  <code class="filename">printcap</code> entries reveal that an entry
	  for a printer is really just one long line with entries
	  delimited by colon characters.  An earlier example can be
	  rewritten as a single less-readable line:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="programlisting" lang="en">lp:lp=/dev/unlpt0:sh:mx#0:sd=/var/spool/lpd/lp:if=/usr/local/libexec/lf2crlf:lf=/var/log/lpd-errs:</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-filters-stairstep"></a>9.5.3.1. 避免在純文字印表機階梯狀列印</h4></div></div></div><p xml:lang="en" lang="en">Typical FreeBSD text files contain only a single line feed
	  character at the end of each line.  These lines will
	  <span class="quote">“<span class="quote">stairstep</span>”</span> on a standard printer:</p><pre xml:lang="en" class="programlisting" lang="en">A printed file looks
                    like the steps of a staircase
                                                 scattered by the wind</pre><p xml:lang="en" lang="en">A filter can convert the newline characters into
	  carriage returns and newlines.  The carriage returns make
	  the printer return to the left after each line.  Create
	  <code class="filename">/usr/local/libexec/lf2crlf</code> with these
	  contents:</p><pre xml:lang="en" class="programlisting" lang="en">#!/bin/sh
CR=$'\r'
/usr/bin/sed -e "s/$/${CR}/g"</pre><p xml:lang="en" lang="en">Set the permissions and make it executable:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>chmod 555 /usr/local/libexec/lf2crlf</code></strong></pre><p xml:lang="en" lang="en">Modify <code class="filename">/etc/printcap</code> to use the
	  new filter:</p><pre xml:lang="en" class="programlisting" lang="en">:if=/usr/local/libexec/lf2crlf:\</pre><p xml:lang="en" lang="en">Test the filter by printing the same plain text file.
	  The carriage returns will cause each line to start at the
	  left side of the page.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-filters-enscript"></a>9.5.3.2. 使用 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/enscript/pkg-descr">print/enscript</a> 在 <span class="trademark">PostScript</span>® 印表機美化純文字內容</h4></div></div></div><p xml:lang="en" lang="en"><acronym class="acronym">GNU</acronym>
	  <span class="application">Enscript</span> converts plain text
	  files into nicely-formatted <span class="trademark">PostScript</span>® for printing on
	  <span class="trademark">PostScript</span>® printers.  It adds page numbers, wraps long
	  lines, and provides numerous other features to make printed
	  text files easier to read.  Depending on the local paper
	  size, install either
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/enscript-letter/pkg-descr">print/enscript-letter</a> or
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/enscript-a4/pkg-descr">print/enscript-a4</a> from the
	  Ports Collection.</p><p xml:lang="en" lang="en">Create <code class="filename">/usr/local/libexec/enscript</code>
	  with these contents:</p><pre xml:lang="en" class="programlisting" lang="en">#!/bin/sh
/usr/local/bin/enscript -o -</pre><p xml:lang="en" lang="en">Set the permissions and make it executable:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>chmod 555 /usr/local/libexec/enscript</code></strong></pre><p xml:lang="en" lang="en">Modify <code class="filename">/etc/printcap</code> to use the
	  new filter:</p><pre xml:lang="en" class="programlisting" lang="en">:if=/usr/local/libexec/enscript:\</pre><p xml:lang="en" lang="en">Test the filter by printing a plain text file.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-filters-ps2pcl"></a>9.5.3.3. 列印 <span class="trademark">PostScript</span>® 到 <acronym class="acronym">PCL</acronym> 印表機</h4></div></div></div><p xml:lang="en" lang="en">Many programs produce <span class="trademark">PostScript</span>® documents.
	  However, inexpensive printers often only understand plain
	  text or <acronym class="acronym">PCL</acronym>.  This filter converts
	  <span class="trademark">PostScript</span>® files to <acronym class="acronym">PCL</acronym> before sending
	  them to the printer.</p><p>由 Port 套件集安裝 Ghostscript <span class="trademark">PostScript</span>® 直譯器，<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/ghostscript9-base/pkg-descr">print/ghostscript9-base</a>。</p><p xml:lang="en" lang="en">Create <code class="filename">/usr/local/libexec/ps2pcl</code>
	  with these contents:</p><pre xml:lang="en" class="programlisting" lang="en">#!/bin/sh
/usr/local/bin/gs -dSAFER -dNOPAUSE -dBATCH -q -sDEVICE=ljet4 -sOutputFile=- -</pre><p xml:lang="en" lang="en">Set the permissions and make it executable:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>chmod 555 /usr/local/libexec/ps2pcl</code></strong></pre><p xml:lang="en" lang="en"><span class="trademark">PostScript</span>® input sent to this script will be rendered
	  and converted to <acronym class="acronym">PCL</acronym> before being sent on
	  to the printer.</p><p xml:lang="en" lang="en">Modify <code class="filename">/etc/printcap</code> to use this
	  new input filter:</p><pre xml:lang="en" class="programlisting" lang="en">:if=/usr/local/libexec/ps2pcl:\</pre><p xml:lang="en" lang="en">Test the filter by sending a small <span class="trademark">PostScript</span>® program
	  to it:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>printf "%%\!PS \n /Helvetica findfont 18 scalefont setfont \
72 432 moveto (PostScript printing successful.) show showpage \004" | lpr</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-filters-smart"></a>9.5.3.4. 智慧過濾器</h4></div></div></div><p xml:lang="en" lang="en">A filter that detects the type of input and
	  automatically converts it to the correct format for the
	  printer can be very convenient.  The first two characters of
	  a <span class="trademark">PostScript</span>® file are usually <code class="literal">%!</code>.  A
	  filter can detect those two characters.  <span class="trademark">PostScript</span>® files
	  can be sent on to a <span class="trademark">PostScript</span>® printer unchanged.  Text
	  files can be converted to <span class="trademark">PostScript</span>® with
	  <span class="application">Enscript</span> as shown earlier.
	  Create <code class="filename">/usr/local/libexec/psif</code> with
	  these contents:</p><pre xml:lang="en" class="programlisting" lang="en">#!/bin/sh
#
#  psif - Print PostScript or plain text on a PostScript printer
#
IFS="" read -r first_line
first_two_chars=`expr "$first_line" : '\(..\)'`

case "$first_two_chars" in
%!)
    # %! : PostScript job, print it.
    echo "$first_line" &amp;&amp; cat &amp;&amp; exit 0
    exit 2
    ;;
*)
    # otherwise, format with enscript
    ( echo "$first_line"; cat ) | /usr/local/bin/enscript -o - &amp;&amp; exit 0
    exit 2
    ;;
esac</pre><p xml:lang="en" lang="en">Set the permissions and make it executable:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>chmod 555 /usr/local/libexec/psif</code></strong></pre><p xml:lang="en" lang="en">Modify <code class="filename">/etc/printcap</code> to use this
	  new input filter:</p><pre xml:lang="en" class="programlisting" lang="en">:if=/usr/local/libexec/psif:\</pre><p xml:lang="en" lang="en">Test the filter by printing <span class="trademark">PostScript</span>® and plain text
	  files.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-filters-othersmart"></a>9.5.3.5. 其他智慧過濾器</h4></div></div></div><p xml:lang="en" lang="en">Writing a filter that detects many different types of
	  input and formats them correctly is challenging.
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/apsfilter/pkg-descr">print/apsfilter</a> from the
	  Ports Collection is a smart <span class="quote">“<span class="quote">magic</span>”</span> filter that
	  detects dozens of file types and automatically converts them
	  to the <acronym class="acronym">PDL</acronym> understood by the printer.
	  See <a class="link" href="http://www.apsfilter.org" target="_top">http://www.apsfilter.org</a> for
	  more details.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-queues"></a>9.5.4. 多序列</h3></div></div></div><p xml:lang="en" lang="en">The entries in <code class="filename">/etc/printcap</code> are
	really definitions of <span class="emphasis"><em>queues</em></span>.  There can
	be more than one queue for a single printer.  When combined
	with filters, multiple queues provide users more control over
	how their jobs are printed.</p><p xml:lang="en" lang="en">As an example, consider a networked <span class="trademark">PostScript</span>® laser
	printer in an office.  Most users want to print plain text,
	but a few advanced users want to be able to print <span class="trademark">PostScript</span>®
	files directly.  Two entries can be created for the same
	printer in <code class="filename">/etc/printcap</code>:</p><pre xml:lang="en" class="programlisting" lang="en">textprinter:\
	:lp=9100@officelaser:\
	:sh:\
	:mx#0:\
	:sd=/var/spool/lpd/textprinter:\
	:if=/usr/local/libexec/enscript:\
	:lf=/var/log/lpd-errs:

psprinter:\
	:lp=9100@officelaser:\
	:sh:\
	:mx#0:\
	:sd=/var/spool/lpd/psprinter:\
	:lf=/var/log/lpd-errs:</pre><p xml:lang="en" lang="en">Documents sent to <code class="literal">textprinter</code> will be
	formatted by the
	<code class="filename">/usr/local/libexec/enscript</code> filter shown
	in an earlier example.  Advanced users can print <span class="trademark">PostScript</span>®
	files on <code class="literal">psprinter</code>, where no filtering is
	done.</p><p xml:lang="en" lang="en">This multiple queue technique can be used to provide
	direct access to all kinds of printer features.  A printer
	with a duplexer could use two queues, one for ordinary
	single-sided printing, and one with a filter that sends the
	command sequence to enable double-sided printing and then
	sends the incoming file.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-monitor"></a>9.5.5. 監視與控制列印</h3></div></div></div><p xml:lang="en" lang="en">Several utilities are available to monitor print jobs and
	check and control printer operation.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-monitor-lpq"></a>9.5.5.1. <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpq</span>(1)</span></a></h4></div></div></div><p xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpq</span>(1)</span></a> shows the status of a user's print
	  jobs.  Print jobs from other users are not shown.</p><p xml:lang="en" lang="en">Show the current user's pending jobs on a single
	  printer:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>lpq -P<em class="replaceable"><code>lp</code></em></code></strong>
Rank   Owner      Job  Files                                 Total Size
1st    jsmith     0    (standard input)                      12792 bytes</pre><p xml:lang="en" lang="en">Show the current user's pending jobs on all
	  printers:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>lpq -a</code></strong>
lp:
Rank   Owner      Job  Files                                 Total Size
1st    jsmith     1    (standard input)                      27320 bytes

laser:
Rank   Owner      Job  Files                                 Total Size
1st    jsmith     287  (standard input)                      22443 bytes</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-monitor-lprm"></a>9.5.5.2. <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lprm</span>(1)</span></a></h4></div></div></div><p xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lprm</span>(1)</span></a> is used to remove print jobs.  Normal users
	  are only allowed to remove their own jobs.
	  <code class="systemitem">root</code> can remove
	  any or all jobs.</p><p xml:lang="en" lang="en">Remove all pending jobs from a printer:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>lprm -P<em class="replaceable"><code>lp</code></em> -</code></strong>
dfA002smithy dequeued
cfA002smithy dequeued
dfA003smithy dequeued
cfA003smithy dequeued
dfA004smithy dequeued
cfA004smithy dequeued</pre><p xml:lang="en" lang="en">Remove a single job from a
	  printer.  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpq</span>(1)</span></a> is used to find the job number.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>lpq</code></strong>
Rank   Owner      Job  Files                                 Total Size
1st    jsmith     5    (standard input)                      12188 bytes
<code class="prompt">%</code> <strong class="userinput"><code>lprm -P<em class="replaceable"><code>lp</code></em> <em class="replaceable"><code>5</code></em></code></strong>
dfA005smithy dequeued
cfA005smithy dequeued</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-monitor-lpc"></a>9.5.5.3. <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpc</span>(8)</span></a></h4></div></div></div><p xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpc</span>(8)</span></a> is used to check and modify printer status.
	  <code class="literal">lpc</code> is followed by a command and an
	  optional printer name.  <code class="literal">all</code> can be used
	  instead of a specific printer name, and the command will be
	  applied to all printers.  Normal users can view status with
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpc</span>(8)</span></a>.  Only
	  <code class="systemitem">root</code> can use
	  commands which modify printer status.</p><p xml:lang="en" lang="en">Show the status of all printers:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>lpc status all</code></strong>
lp:
	queuing is enabled
	printing is enabled
	1 entry in spool area
	printer idle
laser:
	queuing is enabled
	printing is enabled
	1 entry in spool area
	waiting for laser to come up</pre><p xml:lang="en" lang="en">Prevent a printer from accepting new jobs, then begin
	  accepting new jobs again:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>lpc disable <em class="replaceable"><code>lp</code></em></code></strong>
lp:
	queuing disabled
<code class="prompt">#</code> <strong class="userinput"><code>lpc enable <em class="replaceable"><code>lp</code></em></code></strong>
lp:
	queuing enabled</pre><p xml:lang="en" lang="en">Stop printing, but continue to accept new jobs.  Then
	  begin printing again:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>lpc stop <em class="replaceable"><code>lp</code></em></code></strong>
lp:
	printing disabled
<code class="prompt">#</code> <strong class="userinput"><code>lpc start <em class="replaceable"><code>lp</code></em></code></strong>
lp:
	printing enabled
	daemon started</pre><p xml:lang="en" lang="en">Restart a printer after some error condition:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>lpc restart <em class="replaceable"><code>lp</code></em></code></strong>
lp:
	no daemon to abort
	printing enabled
	daemon restarted</pre><p xml:lang="en" lang="en">Turn the print queue off and disable printing, with a
	  message to explain the problem to users:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>lpc down <em class="replaceable"><code>lp</code></em> Repair parts will arrive on Monday</code></strong>
lp:
	printer and queuing disabled
	status message is now: Repair parts will arrive on Monday</pre><p xml:lang="en" lang="en">Re-enable a printer that is down:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>lpc up <em class="replaceable"><code>lp</code></em></code></strong>
lp:
	printing enabled
	daemon started</pre><p xml:lang="en" lang="en">See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpc</span>(8)</span></a> for more commands and options.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-shared"></a>9.5.6. 分享印表機</h3></div></div></div><p xml:lang="en" lang="en">Printers are often shared by multiple users in businesses
	and schools.  Additional features are provided to make sharing
	printers more convenient.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-shared-aliases"></a>9.5.6.1. 別名</h4></div></div></div><p xml:lang="en" lang="en">The printer name is set in the first line of the
	  entry in <code class="filename">/etc/printcap</code>.  Additional
	  names, or <span class="emphasis"><em>aliases</em></span>, can be added after
	  that name.  Aliases are separated from the name and each
	  other by vertical bars:</p><pre xml:lang="en" class="programlisting" lang="en">lp|<em class="replaceable"><code>repairsprinter</code></em>|<em class="replaceable"><code>salesprinter</code></em>:\</pre><p xml:lang="en" lang="en">Aliases can be used in place of the printer name.  For
	  example, users in the Sales department print to their
	  printer with</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>lpr -P<em class="replaceable"><code>salesprinter</code></em> <em class="replaceable"><code>sales-report.txt</code></em></code></strong></pre><p xml:lang="en" lang="en">Users in the Repairs department print to
	  <span class="emphasis"><em>their</em></span> printer with</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>lpr -P<em class="replaceable"><code>repairsprinter</code></em> <em class="replaceable"><code>repairs-report.txt</code></em></code></strong></pre><p xml:lang="en" lang="en">All of the documents print on that single printer.  When
	  the Sales department grows enough to need their own printer,
	  the alias can be removed from the shared printer entry and
	  used as the name of a new printer.  Users in both
	  departments continue to use the same commands, but the Sales
	  documents are sent to the new printer.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-shared-headers"></a>9.5.6.2. 頁首</h4></div></div></div><p xml:lang="en" lang="en">It can be difficult for users to locate their documents
	  in the stack of pages produced by a busy shared printer.
	  <span class="emphasis"><em>Header pages</em></span> were created to solve this
	  problem.  A header page with the user name and document name
	  is printed before each print job.  These pages are also
	  sometimes called <span class="emphasis"><em>banner</em></span> or
	  <span class="emphasis"><em>separator</em></span> pages.</p><p xml:lang="en" lang="en">Enabling header pages differs depending on whether the
	  printer is connected directly to the computer with a
	  <acronym class="acronym">USB</acronym>, parallel, or serial cable, or
	  is connected remotely over a network.</p><p xml:lang="en" lang="en">Header pages on directly-connected printers are enabled
	  by removing the <code class="literal">:sh:\</code> (Suppress Header)
	  line from the entry in <code class="filename">/etc/printcap</code>.
	  These header pages only use line feed characters for new
	  lines.  Some printers will need the
	  <code class="filename">/usr/share/examples/printing/hpif</code>
	  filter to prevent stairstepped text.  The filter configures
	  <acronym class="acronym">PCL</acronym> printers to print both carriage
	  returns and line feeds when a line feed is received.</p><p xml:lang="en" lang="en">Header pages for network printers must be configured on
	  the printer itself.  Header page entries in
	  <code class="filename">/etc/printcap</code> are ignored.  Settings
	  are usually available from the printer front panel or a
	  configuration web page accessible with a web browser.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-references"></a>9.5.7. 參考文獻</h3></div></div></div><p xml:lang="en" lang="en">Example files: <code class="filename">/usr/share/examples/printing/</code>.</p><p xml:lang="en" lang="en">The <span class="emphasis"><em>4.3BSD Line Printer Spooler
	  Manual</em></span>,
	<code class="filename">/usr/share/doc/smm/07.lpd/paper.ascii.gz</code>.</p><p xml:lang="en" lang="en">Manual pages: <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=printcap&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">printcap</span>(5)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpd</span>(8)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a>,
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpc</span>(8)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lprm</span>(1)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpq</span>(1)</span></a>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-other"></a>9.6. 其他列印系統</h2></div></div></div><p xml:lang="en" lang="en">Several other printing systems are available in
      addition to the built-in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpd</span>(8)</span></a>.  These systems
      offer support for other protocols or additional features.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-other-cups"></a>9.6.1. <acronym class="acronym">CUPS</acronym> (Common <span class="trademark">UNIX</span>® Printing
	System)</h3></div></div></div><p xml:lang="en" lang="en"><acronym class="acronym">CUPS</acronym> is a popular printing system
	available on many operating systems.  Using
	<acronym class="acronym">CUPS</acronym> on FreeBSD is documented in a separate
	article:<a class="link" href="../../../../doc/en_US.ISO8859-1/articles/cups" target="_top">../../../../doc/en_US.ISO8859-1/articles/cups</a></p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-other-hplip"></a>9.6.2. HPLIP</h3></div></div></div><p xml:lang="en" lang="en">Hewlett Packard provides a printing system that supports
	many of their inkjet and laser printers.  The port is
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/hplip/pkg-descr">print/hplip</a>.  The main web page
	is at <a class="link" href="http://hplipopensource.com/hplip-web/index.html" target="_top">http://hplipopensource.com/hplip-web/index.html</a>.
	The port handles all the installation details on FreeBSD.
	Configuration information is shown at <a class="link" href="http://hplipopensource.com/hplip-web/install/manual/hp_setup.html" target="_top">http://hplipopensource.com/hplip-web/install/manual/hp_setup.html</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-other-lprng"></a>9.6.3. LPRng</h3></div></div></div><p xml:lang="en" lang="en"><span class="application">LPRng</span> was developed as an
	enhanced alternative to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpd</span>(8)</span></a>.  The port is
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/LPRng/pkg-descr">sysutils/LPRng</a>.  For details
	and documentation, see
	<a class="link" href="http://www.lprng.com/" target="_top">http://www.lprng.com/</a>.</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="linuxemu"></a>章 10. <span class="trademark">Linux</span>® Binary 相容性</h2></div><div><span class="authorgroup">Restructured and parts updated by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Jim</span> <span class="surname">Mock</span></span>. </span></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Brian N.</span> <span class="surname">Handy</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Rich</span> <span class="surname">Murphey</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#linuxemu-synopsis">10.1. 概述</a></span></dt><dt><span class="sect1"><a href="#linuxemu-lbc-install">10.2. 設定 <span class="trademark">Linux</span>® Binary 相容性</a></span></dt><dd><dl><dt><span class="sect2"><a href="#linuxemu-libs-manually">10.2.1. 手動安裝其他程式庫</a></span></dt><dt><span class="sect2"><a href="#idp69370168">10.2.2. 安裝 <span class="trademark">Linux</span>® <acronym class="acronym">ELF</acronym> Binary</a></span></dt><dt><span class="sect2"><a href="#idp69396408">10.2.3. 安裝以 <span class="trademark">Linux</span>® <acronym class="acronym">RPM</acronym> 為基礎的應用程式</a></span></dt><dt><span class="sect2"><a href="#idp69403832">10.2.4. 設定主機名稱解析器</a></span></dt></dl></dd><dt><span class="sect1"><a href="#linuxemu-advanced">10.3. 進階主題</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="linuxemu-synopsis"></a>10.1. 概述</h2></div></div></div><a id="idp69275960" class="indexterm"></a><a id="idp69276856" class="indexterm"></a><p>FreeBSD 提供 <span class="trademark">Linux</span>® Binary 的相容性，允許使用者在 FreeBSD 系統上不需要修改就可以安裝和執行大部份的 <span class="trademark">Linux</span>® Binary。 曾經有報告指出，在某些情況下，<span class="trademark">Linux</span>® Binary 在 FreeBSD 的表現比在 <span class="trademark">Linux</span>® 好。</p><p>然而，部份特定在 <span class="trademark">Linux</span>® 作業系統上的功能在 FreeBSD 並沒有支援。例如，若 <span class="trademark">Linux</span>® Binary 過度的使用 <span class="trademark">i386</span>™ 特定的呼叫，如啟動虛擬 8086 模式，會無法在 FreeBSD 執行。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">FreeBSD 10.3 後支援 64 位元的 <span class="trademark">Linux</span>® Binary 相容性。</p></div><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>如何在 FreeBSD 系統啟用 <span class="trademark">Linux</span>® Binary 相容模式。</p></li><li class="listitem"><p>如何安裝其他的 <span class="trademark">Linux</span>® 共用程式庫。</p></li><li class="listitem"><p>如何在 FreeBSD 系統安裝 <span class="trademark">Linux</span>® 應用程式。</p></li><li class="listitem"><p>在 FreeBSD 中 <span class="trademark">Linux</span>® 相容性的實作細節。</p></li></ul></div><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>知道如何安裝 <a class="link" href="#ports" title="章 4. 安裝應用程式：套件與 Port">其他的第三方軟體</a>。</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="linuxemu-lbc-install"></a>10.2. 設定 <span class="trademark">Linux</span>® Binary 相容性</h2></div></div></div><a id="idp69305016" class="indexterm"></a><p><span class="trademark">Linux</span>® 程式庫預設並不會安裝，且並不會開啟 <span class="trademark">Linux</span>® Binary 相容性。 <span class="trademark">Linux</span>® 程式庫可以手動安裝或是從 FreeBSD Port 套件集安裝。</p><p>在嘗試編譯 Port 前，要載入 <span class="trademark">Linux</span>® 核心模組，否則編譯會失敗：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload linux</code></strong></pre><p>對 64-位元的相容性：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload linux64</code></strong></pre><p>確認模組已載入：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>kldstat</code></strong>
      Id Refs Address    Size     Name
      1    2 0xc0100000 16bdb8   kernel
      7    1 0xc24db000 d000     linux.ko</pre><p>在 FreeBSD 安裝基本的 <span class="trademark">Linux</span>®  程式庫和 Binary 最簡單的方式是安裝 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/emulators/linux_base-c6/pkg-descr">emulators/linux_base-c6</a> 套件或是 Port 。要安裝 Port：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install emulators/linux_base-c6</code></strong></pre><p>要在開機時開啟 <span class="trademark">Linux</span>® 相容性，可以加入這行到 <code class="filename">/etc/rc.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">linux_enable="YES"</pre><p>在 64-位元的機器上，<code class="filename">/etc/rc.d/abi</code> 會自動載入用來做 64-位元模擬的模組。</p><a id="idp69321400" class="indexterm"></a><p xml:lang="en" lang="en">Since the <span class="trademark">Linux</span>® binary compatibility layer has gained
      support for running both 32- and 64-bit <span class="trademark">Linux</span>® binaries (on
      64-bit x86 hosts), it is no longer possible to link the
      emulation functionality statically into a custom kernel.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="linuxemu-libs-manually"></a>10.2.1. 手動安裝其他程式庫</h3></div></div></div><a id="idp69328696" class="indexterm"></a><p>若有 <span class="trademark">Linux</span>® 應用程式在設定 <span class="trademark">Linux</span>® Binary 相容性後出現缺少共用程式庫的情況，確認這個 <span class="trademark">Linux</span>® Binary 需要哪個共用程式庫並手動安裝。</p><p>在 <span class="trademark">Linux</span>® 系統，可使用 <code class="command">ldd</code> 來找出應用程式需要哪個共用程式庫。 例如，檢查 <code class="command">linuxdoom</code> 需要哪個共用程式庫，在有安裝 <span class="application">Doom</span> 的 <span class="trademark">Linux</span>® 系統執行這個指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>ldd linuxdoom</code></strong>
libXt.so.3 (DLL Jump 3.1) =&gt; /usr/X11/lib/libXt.so.3.1.0
libX11.so.3 (DLL Jump 3.1) =&gt; /usr/X11/lib/libX11.so.3.1.0
libc.so.4 (DLL Jump 4.5pl26) =&gt; /lib/libc.so.4.6.29</pre><a id="idp69339320" class="indexterm"></a><p>然後，複製所有 <span class="trademark">Linux</span>® 系統輸出結果中最後一欄的檔案到 FreeBSD 系統的 <code class="filename">/compat/linux</code>。 複製完後，建立符號連結 (Symbolic link) 至輸出結果第一欄的名稱。以這個例子會在 FreeBSD 系統產生以下檔案：</p><pre xml:lang="en" class="screen" lang="en">/compat/linux/usr/X11/lib/libXt.so.3.1.0
/compat/linux/usr/X11/lib/libXt.so.3 -&gt; libXt.so.3.1.0
/compat/linux/usr/X11/lib/libX11.so.3.1.0
/compat/linux/usr/X11/lib/libX11.so.3 -&gt; libX11.so.3.1.0
/compat/linux/lib/libc.so.4.6.29
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.29</pre><p>若 <span class="trademark">Linux</span>® 共用程式庫已經存在，並符合 <code class="command">ldd</code> 輸出結果第一欄的主要修訂版號，則不需要複製該行最後一欄的檔案，使用既有的程式庫應可運作。若有較新的版本建議仍要複製共用程式庫，只要符號連結指向新版的程式庫，舊版便可移除。</p><p>例如，以下程式庫已存在 FreeBSD 系統：</p><pre xml:lang="en" class="screen" lang="en">/compat/linux/lib/libc.so.4.6.27
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.27</pre><p>且 <code class="command">ldd</code> 顯示 Binary 需要使用較新的版本：</p><pre xml:lang="en" class="screen" lang="en">libc.so.4 (DLL Jump 4.5pl26) -&gt; libc.so.4.6.29</pre><p>雖然既有的程式庫只有在最後一碼過時一或兩個版本，程式應該仍可使用稍微舊的版本執行，雖然如此，保險起見還替換既有的 <code class="filename">libc.so</code> 為較新的版本：</p><pre xml:lang="en" class="screen" lang="en">/compat/linux/lib/libc.so.4.6.29
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.29</pre><p>一般來說，只有在安裝 <span class="trademark">Linux</span>® 程式到 FreeBSD 完的前幾次會需要查看 <span class="trademark">Linux</span>® Binary 相依的共用程式庫。之後系統便有足夠的 <span class="trademark">Linux</span>® 共用程式庫能夠執行新安裝的 <span class="trademark">Linux</span>® Binary，便不再需要額外的動作。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69370168"></a>10.2.2. 安裝 <span class="trademark">Linux</span>® <acronym class="acronym">ELF</acronym> Binary</h3></div></div></div><a id="idp69371704" class="indexterm"></a><p><acronym class="acronym">ELF</acronym> Binary 有時候需要額外的步驟。當執行無商標 (Unbranded) 的 <acronym class="acronym">ELF</acronym> Binary，會產生錯誤訊息：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>./my-linux-elf-binary</code></strong>
ELF binary type not known
Abort</pre><p>要協助 FreeBSD 核心區別是 FreeBSD <acronym class="acronym">ELF</acronym> Binary 還是 <span class="trademark">Linux</span>® Binary，可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=brandelf&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">brandelf</span>(1)</span></a>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>brandelf -t Linux my-linux-elf-binary</code></strong></pre><a id="idp69382328" class="indexterm"></a><p>由於 GNU 工具鏈會自動放置適當的商標資訊到 <acronym class="acronym">ELF</acronym> Binary，通常不需要這個步驟。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69396408"></a>10.2.3. 安裝以 <span class="trademark">Linux</span>® <acronym class="acronym">RPM</acronym> 為基礎的應用程式</h3></div></div></div><p>要安裝 <span class="trademark">Linux</span>® <acronym class="acronym">RPM</acronym> 為基礎的應用程式，需先安裝 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/archivers/rpm4/pkg-descr">archivers/rpm4</a> 套件或 Port。安裝完成之後，<code class="systemitem">root</code> 可以使用這個指令安裝 <code class="filename">.rpm</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /compat/linux</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rpm2cpio &lt; /path/to/linux.archive.rpm | cpio -id</code></strong></pre><p>如果需要， <code class="command">brandelf</code> 已安裝的 <acronym class="acronym">ELF</acronym> Binary。注意，這將會無法乾淨地解除安裝。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69403832"></a>10.2.4. 設定主機名稱解析器</h3></div></div></div><p>如果 <acronym class="acronym">DNS</acronym> 無法運作或出現這個錯誤：</p><pre xml:lang="en" class="screen" lang="en">resolv+: "bind" is an invalid keyword resolv+:
"hosts" is an invalid keyword</pre><p>將 <code class="filename">/compat/linux/etc/host.conf</code> 設定如下：</p><pre xml:lang="en" class="programlisting" lang="en">order hosts, bind
multi on</pre><p>這指定先搜尋 <code class="filename">/etc/hosts</code>，其次為 <acronym class="acronym">DNS</acronym>。 當 <code class="filename">/compat/linux/etc/host.conf</code> 不存在， <span class="trademark">Linux</span>® 應用程式會使用 <code class="filename">/etc/host.conf</code> 並會警告不相容的 FreeBSD 語法。如果名稱伺服器未設定使用 <code class="filename">/etc/resolv.conf</code> 的話，則可移除 <code class="literal">bind</code>。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="linuxemu-advanced"></a>10.3. 進階主題</h2></div></div></div><p xml:lang="en" lang="en">This section describes how <span class="trademark">Linux</span>® binary compatibility
      works and is based on an email written to <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chat" target="_top">FreeBSD chat mailing list</a> by
      Terry Lambert <code class="email">&lt;<a xmlns="" class="email" href="mailto:tlambert@primenet.com">tlambert@primenet.com</a>&gt;</code> (Message ID:
      <code class="literal">&lt;199906020108.SAA07001@usr09.primenet.com&gt;</code>).</p><a id="idp69606328" class="indexterm"></a><p xml:lang="en" lang="en">FreeBSD has an abstraction called an
      <span class="quote">“<span class="quote">execution class loader</span>”</span>.  This is a wedge into the
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=execve&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a> system call.</p><p xml:lang="en" lang="en">Historically, the <span class="trademark">UNIX</span>® loader examined the magic number
      (generally the first 4 or 8 bytes of the file) to see if it was
      a binary known to the system, and if so, invoked the binary
      loader.</p><p xml:lang="en" lang="en">If it was not the binary type for the system, the
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=execve&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a> call returned a failure, and the shell
      attempted to start executing it as shell commands.  The
      assumption was a default of
      <span class="quote">“<span class="quote">whatever the current shell is</span>”</span>.</p><p xml:lang="en" lang="en">Later, a hack was made for <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> to examine the first
      two characters, and if they were <code class="literal">:\n</code>, it
      invoked the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=csh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">csh</span>(1)</span></a> shell instead.</p><p xml:lang="en" lang="en">FreeBSD has a list of loaders, instead of a single loader, with
      a fallback to the <code class="literal">#!</code> loader for running shell
      interpreters or shell scripts.</p><a id="idp69626936" class="indexterm"></a><a id="idp69627832" class="indexterm"></a><p xml:lang="en" lang="en">For the <span class="trademark">Linux</span>® <acronym class="acronym">ABI</acronym> support, FreeBSD sees
      the magic number as an ELF binary.  The ELF loader looks for a
      specialized <span class="emphasis"><em>brand</em></span>, which is a comment
      section in the ELF image, and which is not present on
      SVR4/<span class="trademark">Solaris</span>™ ELF binaries.</p><p xml:lang="en" lang="en">For <span class="trademark">Linux</span>® binaries to function, they must be
      <span class="emphasis"><em>branded</em></span> as type <code class="literal">Linux</code>
      using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=brandelf&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">brandelf</span>(1)</span></a>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>brandelf -t Linux file</code></strong></pre><a id="idp69638584" class="indexterm"></a><p xml:lang="en" lang="en">When the ELF loader sees the <code class="literal">Linux</code>
      brand, the loader replaces a pointer in the
      <code class="literal">proc</code> structure.  All system calls are indexed
      through this pointer.  In addition, the process is flagged for
      special handling of the trap vector for the signal trampoline
      code, and several other (minor) fix-ups that are handled by the
      <span class="trademark">Linux</span>® kernel module.</p><p xml:lang="en" lang="en">The <span class="trademark">Linux</span>® system call vector contains, among other things,
      a list of <code class="literal">sysent[]</code> entries whose addresses
      reside in the kernel module.</p><p xml:lang="en" lang="en">When a system call is called by the <span class="trademark">Linux</span>® binary, the trap
      code dereferences the system call function pointer off the
      <code class="literal">proc</code> structure, and gets the <span class="trademark">Linux</span>®, not the
      FreeBSD, system call entry points.</p><p xml:lang="en" lang="en"><span class="trademark">Linux</span>® mode dynamically <span class="emphasis"><em>reroots</em></span>
      lookups.  This is, in effect, equivalent to
      <code class="option">union</code> to file system mounts.  First, an
      attempt is made to lookup the file in
      <code class="filename">/compat/linux/<em class="replaceable"><code>original-path</code></em></code>.
      If that fails, the lookup is done in
      <code class="filename">/<em class="replaceable"><code>original-path</code></em></code>.
      This makes sure that binaries that require other binaries can
      run.  For example, the <span class="trademark">Linux</span>® toolchain can all run under
      <span class="trademark">Linux</span>® <acronym class="acronym">ABI</acronym> support.  It also means that the
      <span class="trademark">Linux</span>® binaries can load and execute FreeBSD binaries, if there
      are no corresponding <span class="trademark">Linux</span>® binaries present, and that a
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=uname&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">uname</span>(1)</span></a> command can be placed in the
      <code class="filename">/compat/linux</code> directory tree to ensure that
      the <span class="trademark">Linux</span>® binaries cannot tell they are not running on
      <span class="trademark">Linux</span>®.</p><p xml:lang="en" lang="en">In effect, there is a <span class="trademark">Linux</span>® kernel in the FreeBSD kernel.
      The various underlying functions that implement all of the
      services provided by the kernel are identical to both the FreeBSD
      system call table entries, and the <span class="trademark">Linux</span>® system call table
      entries: file system operations, virtual memory operations,
      signal delivery, and System V IPC.  The only difference is that
      FreeBSD binaries get the FreeBSD <span class="emphasis"><em>glue</em></span> functions,
      and <span class="trademark">Linux</span>® binaries get the <span class="trademark">Linux</span>® <span class="emphasis"><em>glue</em></span>
      functions.  The FreeBSD <span class="emphasis"><em>glue</em></span> functions are
      statically linked into the kernel, and the <span class="trademark">Linux</span>®
      <span class="emphasis"><em>glue</em></span> functions can be statically linked, or
      they can be accessed via a kernel module.</p><p xml:lang="en" lang="en">Technically, this is not really emulation, it is an
      <acronym class="acronym">ABI</acronym> implementation.  It is sometimes called
      <span class="quote">“<span class="quote"><span class="trademark">Linux</span>® emulation</span>”</span> because the implementation was
      done at a time when there was no other word to describe what was
      going on.  Saying that FreeBSD ran <span class="trademark">Linux</span>® binaries was not true,
      since the code was not compiled in.</p></div></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="system-administration"></a>部 III. 系統管理</h1></div></div></div><div class="partintro"><div xmlns=""></div><p>FreeBSD 使用手冊剩下的這些章節涵蓋了全方位的 FreeBSD 系統管理。 每個章節的開頭會先描述在該您讀完該章節後您會學到什麼，也會詳述在您在看這些資料時應該要有的一些背景知識。</p><p>這些章節是讓您在需要查資料的時候翻閱用的。 您不需要依照特定的順序來讀，也不需要將這些章節全部過讀之後才開始用 FreeBSD。</p><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="chapter"><a href="#config-tuning">11. 設定與調校</a></span></dt><dd><dl><dt><span class="sect1"><a href="#config-synopsis">11.1. 概述</a></span></dt><dt><span class="sect1"><a href="#configtuning-starting-services">11.2. 啟動服務</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp69744312">11.2.1. 延伸應用程式設定</a></span></dt><dt><span class="sect2"><a href="#idp69755960">11.2.2. 使用服務來啟動其他服務</a></span></dt></dl></dd><dt><span class="sect1"><a href="#configtuning-cron">11.3. 設定 cron(8)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#configtuning-installcrontab">11.3.1. 建立使用者的 Crontab</a></span></dt></dl></dd><dt><span class="sect1"><a href="#configtuning-rcd">11.4. 管理 FreeBSD 中的服務</a></span></dt><dd><dl><dt><span class="sect2"><a href="#configtuning-core-configuration">11.4.1. 管理系統特定的設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#config-network-setup">11.5. 設定網路介面卡</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp69940536">11.5.1. 找到正確的驅動程式</a></span></dt><dd><dl><dt><span class="sect3"><a href="#config-network-ndis">11.5.1.1. 使用 <span class="trademark">Windows</span>® <acronym class="acronym">NDIS</acronym> 驅動程式</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp69475128">11.5.2. 設定網路卡</a></span></dt><dt><span class="sect2"><a href="#config-network-testing">11.5.3. 測試與疑難排解</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp69555768">11.5.3.1. 測試乙太網路卡</a></span></dt><dt><span class="sect3"><a href="#idp70017208">11.5.3.2. 疑難排解</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#configtuning-virtual-hosts">11.6. 虛擬主機</a></span></dt><dt><span class="sect1"><a href="#configtuning-syslog">11.7. 設定系統日誌</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp69424312">11.7.1. 設定本地日誌</a></span></dt><dt><span class="sect2"><a href="#idp70118968">11.7.2. 日誌管理與翻轉</a></span></dt><dt><span class="sect2"><a href="#network-syslogd">11.7.3. 設定遠端日誌</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70203320">11.7.3.1. 日誌伺服器設定</a></span></dt><dt><span class="sect3"><a href="#idp70239160">11.7.3.2. 日誌客戶端設定</a></span></dt><dt><span class="sect3"><a href="#idp70251192">11.7.3.3. 日誌伺服器除錯</a></span></dt><dt><span class="sect3"><a href="#idp70266168">11.7.3.4. 安全注意事項</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#configtuning-configfiles">11.8. 設定檔</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp70279096">11.8.1. <code class="filename">/etc</code> 配置</a></span></dt><dt><span class="sect2"><a href="#idp70303416">11.8.2. 主機名稱</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70305336">11.8.2.1. <code class="filename">/etc/resolv.conf</code></a></span></dt><dt><span class="sect3"><a href="#idp70337848">11.8.2.2. <code class="filename">/etc/hosts</code></a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#configtuning-sysctl">11.9. 使用 sysctl(8) 調校</a></span></dt><dd><dl><dt><span class="sect2"><a href="#configtuning-sysctlconf">11.9.1. <code class="filename">sysctl.conf</code></a></span></dt><dt><span class="sect2"><a href="#sysctl-readonly">11.9.2. 唯讀 sysctl(8)</a></span></dt></dl></dd><dt><span class="sect1"><a href="#configtuning-disk">11.10. 調校磁碟</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp70401976">11.10.1. Sysctl 變數</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70402616">11.10.1.1. <code class="varname">vfs.vmiodirenable</code></a></span></dt><dt><span class="sect3"><a href="#idp70408632">11.10.1.2. <code class="varname">vfs.write_behind</code></a></span></dt><dt><span class="sect3"><a href="#idp70416824">11.10.1.3. <code class="varname">vfs.hirunningspace</code></a></span></dt><dt><span class="sect3"><a href="#idp70427064">11.10.1.4. <code class="varname">vm.swap_idle_enabled</code></a></span></dt><dt><span class="sect3"><a href="#idp70431928">11.10.1.5. <code class="varname">hw.ata.wc</code></a></span></dt><dt><span class="sect3"><a href="#idp70456376">11.10.1.6. <code class="literal">SCSI_DELAY</code>
	  (<code class="varname">kern.cam.scsi_delay</code>)</a></span></dt></dl></dd><dt><span class="sect2"><a href="#soft-updates">11.10.2. 軟更新</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70459448">11.10.2.1. 有關軟更新的更多詳細資訊</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#configtuning-kernel-limits">11.11. 調校核心限制</a></span></dt><dd><dl><dt><span class="sect2"><a href="#file-process-limits">11.11.1. 檔案/程序限制</a></span></dt><dd><dl><dt><span class="sect3"><a href="#kern-maxfiles">11.11.1.1. <code class="varname">kern.maxfiles</code></a></span></dt><dt><span class="sect3"><a href="#idp70551992">11.11.1.2. <code class="varname">kern.ipc.soacceptqueue</code></a></span></dt></dl></dd><dt><span class="sect2"><a href="#nmbclusters">11.11.2. 網路限制</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70591032">11.11.2.1. <code class="varname">net.inet.ip.portrange.*</code></a></span></dt><dt><span class="sect3"><a href="#idp70598840">11.11.2.2. <code class="literal">TCP</code> 頻寬延遲乘積</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp70611128">11.11.3. 虛擬記憶體</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70611768">11.11.3.1. <code class="varname">kern.maxvnodes</code></a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#adding-swap-space">11.12. 增加交換空間</a></span></dt><dd><dl><dt><span class="sect2"><a href="#new-drive-swap">11.12.1. 使用新硬碟或既有分割區增加交換空間</a></span></dt><dt><span class="sect2"><a href="#create-swapfile">11.12.2. 建立交換檔</a></span></dt></dl></dd><dt><span class="sect1"><a href="#acpi-overview">11.13. 電源與資源管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#acpi-config">11.13.1. 設定 <acronym class="acronym">ACPI</acronym></a></span></dt><dt><span class="sect2"><a href="#ACPI-comprob">11.13.2. 常見問題</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70770360">11.13.2.1. 滑鼠問題</a></span></dt><dt><span class="sect3"><a href="#idp70772536">11.13.2.2. 待機/喚醒</a></span></dt><dt><span class="sect3"><a href="#idp70811064">11.13.2.3. 系統無回應</a></span></dt><dt><span class="sect3"><a href="#idp70821432">11.13.2.4. 當機</a></span></dt><dt><span class="sect3"><a href="#idp70827064">11.13.2.5. 系統在待機或關機後仍開機</a></span></dt><dt><span class="sect3"><a href="#ACPI-aslanddump">11.13.2.6. BIOS 含有有問題的 Bytecode</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp70851256">11.13.3. 覆蓋預設的 <acronym class="acronym">AML</acronym></a></span></dt><dt><span class="sect2"><a href="#ACPI-submitdebug">11.13.4. 取得與回報除錯資訊</a></span></dt><dt><span class="sect2"><a href="#ACPI-References">11.13.5. 參考文獻</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#boot">12. FreeBSD 開機程序</a></span></dt><dd><dl><dt><span class="sect1"><a href="#boot-synopsis">12.1. 概述</a></span></dt><dt><span class="sect1"><a href="#boot-introduction">12.2. FreeBSD 開機程序</a></span></dt><dd><dl><dt><span class="sect2"><a href="#boot-boot0">12.2.1. 開機管理程式</a></span></dt><dt><span class="sect2"><a href="#boot-boot1">12.2.2. 階段一與階段二</a></span></dt><dt><span class="sect2"><a href="#boot-loader">12.2.3. 階段三</a></span></dt><dt><span class="sect2"><a href="#boot-init">12.2.4. 最終階段</a></span></dt><dd><dl><dt><span class="sect3"><a href="#boot-singleuser">12.2.4.1. 單使用者模式</a></span></dt><dt><span class="sect3"><a href="#boot-multiuser">12.2.4.2. 多使用者模式</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#boot-splash">12.3. 設定開機啟動畫面</a></span></dt><dt><span class="sect1"><a href="#device-hints">12.4. 裝置提示</a></span></dt><dt><span class="sect1"><a href="#boot-shutdown">12.5. 關機程序</a></span></dt></dl></dd><dt><span class="chapter"><a href="#security">13. 安全性</a></span></dt><dd><dl><dt><span class="sect1"><a href="#security-synopsis">13.1. 概述</a></span></dt><dt><span class="sect1"><a href="#security-intro">13.2. 簡介</a></span></dt><dd><dl><dt><span class="sect2"><a href="#security-accounts">13.2.1. 防止登入</a></span></dt><dt><span class="sect2"><a href="#security-accountmgmt">13.2.2. 帳號升級授權</a></span></dt><dt><span class="sect2"><a href="#security-passwords">13.2.3. 密碼編碼方式</a></span></dt><dt><span class="sect2"><a href="#security-pwpolicy">13.2.4. 強制密碼政策</a></span></dt><dt><span class="sect2"><a href="#security-rkhunter">13.2.5. 偵測 Root 工具 (Rootkit)</a></span></dt><dt><span class="sect2"><a href="#security-ids">13.2.6. Binary 檢驗</a></span></dt><dt><span class="sect2"><a href="#security-tuning">13.2.7. 系統安全性調校</a></span></dt></dl></dd><dt><span class="sect1"><a href="#one-time-passwords">13.3. 一次性密碼</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp71807928">13.3.1. 初始化 <acronym class="acronym">OPIE</acronym></a></span></dt><dt><span class="sect2"><a href="#idp71814072">13.3.2. 在不安全連線下做初始化</a></span></dt><dt><span class="sect2"><a href="#idp71832248">13.3.3. 產生單組一次性密碼</a></span></dt><dt><span class="sect2"><a href="#idp71842616">13.3.4. 產生多組一次性密碼</a></span></dt><dt><span class="sect2"><a href="#idp71851576">13.3.5. 限制使用 <span class="trademark">UNIX</span>® 密碼</a></span></dt></dl></dd><dt><span class="sect1"><a href="#tcpwrappers">13.4. TCP Wrapper</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp71894840">13.4.1. 初始設定</a></span></dt><dt><span class="sect2"><a href="#idp71914040">13.4.2. 進階設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#kerberos5">13.5. <span class="application">Kerberos</span></a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp71986104">13.5.1. 設定 Heimdal <acronym class="acronym">KDC</acronym></a></span></dt><dt><span class="sect2"><a href="#idp63142200">13.5.2. 設定伺服器使用 <span class="application">Kerberos</span></a></span></dt><dt><span class="sect2"><a href="#idp72064568">13.5.3. 設定客戶端使用 <span class="application">Kerberos</span></a></span></dt><dt><span class="sect2"><a href="#idp72113080">13.5.4. 與 <acronym class="acronym">MIT</acronym> 的差異</a></span></dt><dt><span class="sect2"><a href="#idp72125496">13.5.5. <span class="application">Kerberos</span> 提示、技巧與疑難排解</a></span></dt><dt><span class="sect2"><a href="#idp72161976">13.5.6. 減輕 <span class="application">Kerberos</span> 的限制</a></span></dt><dt><span class="sect2"><a href="#idp72186296">13.5.7. 相關資源與延伸資訊</a></span></dt></dl></dd><dt><span class="sect1"><a href="#openssl">13.6. OpenSSL</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp72220088">13.6.1. 產生憑証</a></span></dt><dt><span class="sect2"><a href="#idp72274872">13.6.2. 使用憑證</a></span></dt></dl></dd><dt><span class="sect1"><a href="#ipsec">13.7. <acronym class="acronym">VPN</acronym> over
	<acronym class="acronym">IPsec</acronym></a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp72350776">13.7.1. 在 FreeBSD 上設定 <acronym class="acronym">VPN</acronym></a></span></dt></dl></dd><dt><span class="sect1"><a href="#openssh">13.8. OpenSSH</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp72454328">13.8.1. 使用 SSH 客戶端工具</a></span></dt><dd><dl><dt><span class="sect3"><a href="#security-ssh-keygen">13.8.1.1. 以金鑰為基礎的認證</a></span></dt><dt><span class="sect3"><a href="#security-ssh-tunneling">13.8.1.2. <acronym class="acronym">SSH</acronym> 通道</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp72610104">13.8.2. 開啟 SSH 伺服器</a></span></dt><dt><span class="sect2"><a href="#idp72627000">13.8.3. SSH 伺服器安全性</a></span></dt></dl></dd><dt><span class="sect1"><a href="#fs-acl">13.9. 存取控制清單</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp72666552">13.9.1. 開啟 <acronym class="acronym">ACL</acronym> 支援</a></span></dt><dt><span class="sect2"><a href="#idp72691128">13.9.2. 使用 <acronym class="acronym">ACL</acronym></a></span></dt></dl></dd><dt><span class="sect1"><a href="#security-pkg">13.10. 監視第三方安全性問題</a></span></dt><dt><span class="sect1"><a href="#security-advisories">13.11. FreeBSD 安全報告</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp72762424">13.11.1. 安全報告的格式</a></span></dt></dl></dd><dt><span class="sect1"><a href="#security-accounting">13.12. 程序追蹤</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp72836280">13.12.1. 開啟並使用程序追蹤</a></span></dt></dl></dd><dt><span class="sect1"><a href="#security-resourcelimits">13.13. 限制資源</a></span></dt><dd><dl><dt><span class="sect2"><a href="#users-limiting">13.13.1. 設定登入類別</a></span></dt><dt><span class="sect2"><a href="#idp73055928">13.13.2. 開啟並設定資源限制</a></span></dt></dl></dd><dt><span class="sect1"><a href="#security-sudo">13.14. 使用 Sudo 分享管理權限</a></span></dt><dd><dl><dt><span class="sect2"><a href="#security-sudo-loggin">13.14.1. 記錄輸出</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#jails">14. Jail</a></span></dt><dd><dl><dt><span class="sect1"><a href="#jails-synopsis">14.1. 概述</a></span></dt><dt><span class="sect1"><a href="#jails-terms">14.2. Jail 相關術語</a></span></dt><dt><span class="sect1"><a href="#jails-build">14.3. 建立和控制 Jail</a></span></dt><dt><span class="sect1"><a href="#jails-tuning">14.4. 調校與管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#jails-tuning-utilities">14.4.1. 在 FreeBSD 中調校 Jail 的系統工具</a></span></dt><dt><span class="sect2"><a href="#jails-tuning-admintools">14.4.2. 在 FreeBSD Port 套件集中的高層級管理工具</a></span></dt><dt><span class="sect2"><a href="#jails-updating">14.4.3. 持續 Jail 的修補與更新</a></span></dt></dl></dd><dt><span class="sect1"><a href="#jails-application">14.5. 更新多個 Jail</a></span></dt><dd><dl><dt><span class="sect2"><a href="#jails-service-jails-template">14.5.1. 建立範本</a></span></dt><dt><span class="sect2"><a href="#jails-service-jails-creating">14.5.2. 建立 Jail</a></span></dt><dt><span class="sect2"><a href="#jails-service-jails-upgrading">14.5.3. 升級</a></span></dt></dl></dd><dt><span class="sect1"><a href="#jails-ezjail">14.6. 使用 <span class="application">ezjail</span> 管理 Jail</a></span></dt><dd><dl><dt><span class="sect2"><a href="#jails-ezjail-install">14.6.1. 安裝 <span class="application">ezjail</span></a></span></dt><dt><span class="sect2"><a href="#jails-ezjail-initialsetup">14.6.2. 初始設定</a></span></dt><dt><span class="sect2"><a href="#jails-ezjail-create">14.6.3. 建立並啟動新的 Jail</a></span></dt><dt><span class="sect2"><a href="#jails-ezjail-update">14.6.4. 更新 Jail</a></span></dt><dd><dl><dt><span class="sect3"><a href="#jails-ezjail-update-os">14.6.4.1. 更新作業系統</a></span></dt><dt><span class="sect3"><a href="#jails-ezjail-update-ports">14.6.4.2. 更新 Port</a></span></dt></dl></dd><dt><span class="sect2"><a href="#jails-ezjail-control">14.6.5. 控制 Jail</a></span></dt><dd><dl><dt><span class="sect3"><a href="#jails-ezjail-control-stop-start">14.6.5.1. 停止與啟動 Jail</a></span></dt><dt><span class="sect3"><a href="#jails-ezjail-control-backup">14.6.5.2. 封存與還原 Jail</a></span></dt></dl></dd><dt><span class="sect2"><a href="#jails-ezjail-example-bind">14.6.6. 完整範例：在 Jail 中安裝 <span class="application">BIND</span></a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#mac">15. 強制存取控制 (MAC)</a></span></dt><dd><dl><dt><span class="sect1"><a href="#mac-synopsis">15.1. 概述</a></span></dt><dt><span class="sect1"><a href="#mac-inline-glossary">15.2. 關鍵詞</a></span></dt><dt><span class="sect1"><a href="#mac-understandlabel">15.3. 了解 MAC 標籤</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp74021560">15.3.1. 標籤設定</a></span></dt><dt><span class="sect2"><a href="#idp74050360">15.3.2. 預先定義的標籤</a></span></dt><dt><span class="sect2"><a href="#idp74084408">15.3.3. 數值標籤</a></span></dt><dt><span class="sect2"><a href="#idp74090552">15.3.4. 使用者標籤</a></span></dt><dt><span class="sect2"><a href="#idp74110904">15.3.5. 網路介面標籤</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mac-planning">15.4. 規劃安全架構</a></span></dt><dt><span class="sect1"><a href="#mac-policies">15.5. 可用的 MAC 管理政策</a></span></dt><dd><dl><dt><span class="sect2"><a href="#mac-seeotheruids">15.5.1. MAC See Other UIDs 政策</a></span></dt><dt><span class="sect2"><a href="#mac-bsdextended">15.5.2. MAC BSD Extended 政策</a></span></dt><dt><span class="sect2"><a href="#mac-ifoff">15.5.3. MAC Interface Silencing 政策</a></span></dt><dt><span class="sect2"><a href="#mac-portacl">15.5.4. MAC Port Access Control 政策</a></span></dt><dt><span class="sect2"><a href="#mac-partition">15.5.5. MAC Partition 政策</a></span></dt><dt><span class="sect2"><a href="#mac-mls">15.5.6. MAC Multi-Level Security 模組</a></span></dt><dt><span class="sect2"><a href="#mac-biba">15.5.7. MAC Biba 模組</a></span></dt><dt><span class="sect2"><a href="#mac-lomac">15.5.8. MAC Low-watermark 模組</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mac-userlocked">15.6. User Lock Down</a></span></dt><dt><span class="sect1"><a href="#mac-implementing">15.7. 在 MAC Jail 中使用 Nagios</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp74076216">15.7.1. 建立不安全的使用者類別</a></span></dt><dt><span class="sect2"><a href="#idp74080952">15.7.2. 設定使用者</a></span></dt><dt><span class="sect2"><a href="#idp74491320">15.7.3. 建立關聯檔 (Context File)</a></span></dt><dt><span class="sect2"><a href="#idp74498616">15.7.4. 載入程式設定</a></span></dt><dt><span class="sect2"><a href="#idp74502584">15.7.5. 測試設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mac-troubleshoot">15.8. MAC 架構疑難排解</a></span></dt></dl></dd><dt><span class="chapter"><a href="#audit">16. 安全事件稽查</a></span></dt><dd><dl><dt><span class="sect1"><a href="#audit-synopsis">16.1. 概述</a></span></dt><dt><span class="sect1"><a href="#audit-inline-glossary">16.2. 關鍵詞</a></span></dt><dt><span class="sect1"><a href="#audit-config">16.3. 稽查設定</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp74680632">16.3.1. 事件選擇表示法</a></span></dt><dt><span class="sect2"><a href="#idp74783416">16.3.2. 設定檔</a></span></dt><dd><dl><dt><span class="sect3"><a href="#audit-auditcontrol">16.3.2.1. The <code class="filename">audit_control</code> File</a></span></dt><dt><span class="sect3"><a href="#audit-audituser">16.3.2.2. The <code class="filename">audit_user</code> File</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#audit-administration">16.4. 查看稽查線索</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp74883128">16.4.1. 使用 Audit Pipes 即時監視</a></span></dt><dt><span class="sect2"><a href="#idp74908728">16.4.2. 翻轉與壓縮 Audit Trail 檔</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#disks">17. 儲存設備</a></span></dt><dd><dl><dt><span class="sect1"><a href="#disks-synopsis">17.1. 概述</a></span></dt><dt><span class="sect1"><a href="#disks-adding">17.2. 加入磁碟</a></span></dt><dt><span class="sect1"><a href="#disks-growing">17.3. 重設大小與擴增磁碟</a></span></dt><dt><span class="sect1"><a href="#usb-disks">17.4. <acronym class="acronym">USB</acronym> 儲存裝置</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp75067192">17.4.1. 裝置設定</a></span></dt><dt><span class="sect2"><a href="#idp75186232">17.4.2. 自動掛載可移除的媒體</a></span></dt></dl></dd><dt><span class="sect1"><a href="#creating-cds">17.5. 建立與使用 <acronym class="acronym">CD</acronym> 媒體</a></span></dt><dd><dl><dt><span class="sect2"><a href="#atapicam">17.5.1. 支援的裝置</a></span></dt><dt><span class="sect2"><a href="#cdrecord">17.5.2. 燒錄 <acronym class="acronym">CD</acronym></a></span></dt><dt><span class="sect2"><a href="#mkisofs">17.5.3. 寫入資料到一個 <acronym class="acronym">ISO</acronym> 檔案系統</a></span></dt><dt><span class="sect2"><a href="#mounting-cd">17.5.4. 使用資料 <acronym class="acronym">CD</acronym></a></span></dt><dt><span class="sect2"><a href="#duplicating-audiocds">17.5.5. 複製音樂 <acronym class="acronym">CD</acronym></a></span></dt></dl></dd><dt><span class="sect1"><a href="#creating-dvds">17.6. 建立與使用 <acronym class="acronym">DVD</acronym> 媒體</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp75436856">17.6.1. 設定</a></span></dt><dt><span class="sect2"><a href="#idp75468600">17.6.2. 燒錄資料 <acronym class="acronym">DVD</acronym></a></span></dt><dt><span class="sect2"><a href="#idp75514168">17.6.3. 燒錄 <acronym class="acronym">DVD</acronym>-Video</a></span></dt><dt><span class="sect2"><a href="#idp75524408">17.6.4. 使用 <acronym class="acronym">DVD+RW</acronym></a></span></dt><dt><span class="sect2"><a href="#idp75561784">17.6.5. 使用 <acronym class="acronym">DVD-RW</acronym></a></span></dt><dt><span class="sect2"><a href="#idp75611832">17.6.6. 多階段燒錄 (Multi-Session)</a></span></dt><dt><span class="sect2"><a href="#idp75619384">17.6.7. 取得更多資訊</a></span></dt><dt><span class="sect2"><a href="#creating-dvd-ram">17.6.8. 使用 <acronym class="acronym">DVD-RAM</acronym></a></span></dt></dl></dd><dt><span class="sect1"><a href="#floppies">17.7. 建立與使用軟碟</a></span></dt><dt><span class="sect1"><a href="#backup-basics">17.8. 備份基礎概念</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp75669816">17.8.1. 檔案系統備份</a></span></dt><dt><span class="sect2"><a href="#idp75722680">17.8.2. 目錄備份</a></span></dt><dt><span class="sect2"><a href="#backups-tapebackups">17.8.3. 使用資料磁帶備份</a></span></dt><dt><span class="sect2"><a href="#backups-programs-amanda">17.8.4. 第三方備份工具</a></span></dt><dt><span class="sect2"><a href="#idp75801912">17.8.5. 緊急還原</a></span></dt></dl></dd><dt><span class="sect1"><a href="#disks-virtual">17.9. 記憶體磁碟</a></span></dt><dd><dl><dt><span class="sect2"><a href="#disks-mdconfig">17.9.1. 連接與解除連接既有的映象檔</a></span></dt><dt><span class="sect2"><a href="#disks-md-freebsd5">17.9.2. 建立以檔案或記憶體為基底的磁碟</a></span></dt></dl></dd><dt><span class="sect1"><a href="#snapshots">17.10. 檔案系統快照</a></span></dt><dt><span class="sect1"><a href="#quotas">17.11. 磁碟配額</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp75990968">17.11.1. 開啟磁碟配額</a></span></dt><dt><span class="sect2"><a href="#idp76013240">17.11.2. 設定配額限制</a></span></dt><dt><span class="sect2"><a href="#idp76034488">17.11.3. 檢查配額限制與磁碟使用狀況</a></span></dt><dt><span class="sect2"><a href="#idp76050616">17.11.4. NFS 上的配額</a></span></dt></dl></dd><dt><span class="sect1"><a href="#disks-encrypting">17.12. 磁碟分割區加密</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp76085432">17.12.1. 使用 <span class="application">gbde</span> 做磁碟加密</a></span></dt><dt><span class="sect2"><a href="#disks-encrypting-geli">17.12.2. 使用 <code class="command">geli</code> 做磁碟加密</a></span></dt></dl></dd><dt><span class="sect1"><a href="#swap-encrypting">17.13. 交換空間加密</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp76252344">17.13.1. 設定已加密的交換空間</a></span></dt><dt><span class="sect2"><a href="#idp76289336">17.13.2. 加密的交換空間檢驗</a></span></dt></dl></dd><dt><span class="sect1"><a href="#disks-hast">17.14. 高可用存儲空間 (<acronym class="acronym">HAST</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp76339768">17.14.1. HAST 運作模式</a></span></dt><dt><span class="sect2"><a href="#idp76371256">17.14.2. HAST 設定</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp76439608">17.14.2.1. 容錯移轉設定</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp76492728">17.14.3. 疑難排解</a></span></dt><dd><dl><dt><span class="sect3"><a href="#disks-hast-sb">17.14.3.1. 自 Split-brain 情況復原</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="#geom">18. GEOM: 模組化磁碟轉換框架</a></span></dt><dd><dl><dt><span class="sect1"><a href="#geom-synopsis">18.1. 概述</a></span></dt><dt><span class="sect1"><a href="#geom-striping">18.2. RAID0 - 串連 (Striping)</a></span></dt><dt><span class="sect1"><a href="#geom-mirror">18.3. RAID1 - 鏡像 (Mirroring)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#geom-mirror-metadata">18.3.1. Metadata 問題</a></span></dt><dt><span class="sect2"><a href="#geom-mirror-two-new-disks">18.3.2. 使用兩個新磁碟建立鏡像</a></span></dt><dt><span class="sect2"><a href="#geom-mirror-existing-drive">18.3.3. 使用既有磁碟建立鏡像</a></span></dt><dt><span class="sect2"><a href="#gmirror-troubleshooting">18.3.4. 疑難排解</a></span></dt><dt><span class="sect2"><a href="#idp76872888">18.3.5. 自磁碟故障復原</a></span></dt></dl></dd><dt><span class="sect1"><a href="#geom-raid3">18.4. <acronym class="acronym">RAID</acronym>3 - 位元級串連與獨立奇偶校驗</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp76924600">18.4.1. 建立 Dedicated <acronym class="acronym">RAID</acronym>3 陣列</a></span></dt></dl></dd><dt><span class="sect1"><a href="#geom-graid">18.5. 軟體 <acronym class="acronym">RAID</acronym> 裝置</a></span></dt><dd><dl><dt><span class="sect2"><a href="#geom-graid-creating">18.5.1. 建立陣列</a></span></dt><dt><span class="sect2"><a href="#geom-graid-volumes">18.5.2. 多磁碟區</a></span></dt><dt><span class="sect2"><a href="#geom-graid-converting">18.5.3. 轉換單一磁碟為鏡像</a></span></dt><dt><span class="sect2"><a href="#geom-graid-inserting">18.5.4. 插入新磁碟到陣列</a></span></dt><dt><span class="sect2"><a href="#geom-graid-removing">18.5.5. 從陣列移除磁碟</a></span></dt><dt><span class="sect2"><a href="#geom-graid-stopping">18.5.6. 停止陣列</a></span></dt><dt><span class="sect2"><a href="#geom-graid-status">18.5.7. 檢查陣列狀態</a></span></dt><dt><span class="sect2"><a href="#geom-graid-deleting">18.5.8. 刪除陣列</a></span></dt><dt><span class="sect2"><a href="#geom-graid-unexpected">18.5.9. 刪除預期之外的陣列</a></span></dt></dl></dd><dt><span class="sect1"><a href="#geom-ggate">18.6. <acronym class="acronym">GEOM</acronym> Gate Network</a></span></dt><dt><span class="sect1"><a href="#geom-glabel">18.7. 磁碟裝置標籤</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp77152056">18.7.1. 標籤類型與範例</a></span></dt></dl></dd><dt><span class="sect1"><a href="#geom-gjournal">18.8. UFS Journaling 透過 <acronym class="acronym">GEOM</acronym></a></span></dt></dl></dd><dt><span class="chapter"><a href="#zfs">19. Z 檔案系統 (<acronym class="acronym">ZFS</acronym>)</a></span></dt><dd><dl><dt><span class="sect1"><a href="#zfs-differences">19.1. 什麼使 <acronym class="acronym">ZFS</acronym> 與眾不同</a></span></dt><dt><span class="sect1"><a href="#zfs-quickstart">19.2. 快速入門指南</a></span></dt><dd><dl><dt><span class="sect2"><a href="#zfs-quickstart-single-disk-pool">19.2.1. 單磁碟儲存池</a></span></dt><dt><span class="sect2"><a href="#zfs-quickstart-raid-z">19.2.2. RAID-Z</a></span></dt><dt><span class="sect2"><a href="#zfs-quickstart-recovering-raid-z">19.2.3. 復原 <acronym class="acronym">RAID-Z</acronym></a></span></dt><dt><span class="sect2"><a href="#zfs-quickstart-data-verification">19.2.4. 資料檢驗</a></span></dt></dl></dd><dt><span class="sect1"><a href="#zfs-zpool">19.3. <code class="command">zpool</code> 管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#zfs-zpool-create">19.3.1. 建立與摧毀儲存池</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-attach">19.3.2. 加入與移除裝置</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-status">19.3.3. 檢查儲存池狀態</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-clear">19.3.4. 清除錯誤</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-replace">19.3.5. 更換運作中的裝置</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-resilver">19.3.6. 處理故障裝置</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-scrub">19.3.7. 清潔儲存池</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-selfheal">19.3.8. 自我修復</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-online">19.3.9. 擴增儲存池</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-import">19.3.10. 匯入與匯出儲存池</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-upgrade">19.3.11. 升級儲存儲存池</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-history">19.3.12. 顯示已記錄的儲存池歷史日誌</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-iostat">19.3.13. 監視效能</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-split">19.3.14. 分割儲存儲存池</a></span></dt></dl></dd><dt><span class="sect1"><a href="#zfs-zfs">19.4. <code class="command">zfs</code> 管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#zfs-zfs-create">19.4.1. 建立與摧毀資料集</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-volume">19.4.2. 建立與摧毀磁碟區</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-rename">19.4.3. 重新命名資料集</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-set">19.4.4. 設定資料集屬性</a></span></dt><dd><dl><dt><span class="sect3"><a href="#zfs-zfs-set-share">19.4.4.1. 取得與設定共享屬性</a></span></dt></dl></dd><dt><span class="sect2"><a href="#zfs-zfs-snapshot">19.4.5. 管理快照 (Snapshot)</a></span></dt><dd><dl><dt><span class="sect3"><a href="#zfs-zfs-snapshot-creation">19.4.5.1. 建立快照</a></span></dt><dt><span class="sect3"><a href="#zfs-zfs-snapshot-diff">19.4.5.2. 比對快照</a></span></dt><dt><span class="sect3"><a href="#zfs-zfs-snapshot-rollback">19.4.5.3. 使用快照還原</a></span></dt><dt><span class="sect3"><a href="#zfs-zfs-snapshot-snapdir">19.4.5.4. 從快照還原個別檔案</a></span></dt></dl></dd><dt><span class="sect2"><a href="#zfs-zfs-clones">19.4.6. 管理複本 (Clone)</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-send">19.4.7. 備份 (Replication)</a></span></dt><dd><dl><dt><span class="sect3"><a href="#zfs-send-incremental">19.4.7.1. 漸進式備份</a></span></dt><dt><span class="sect3"><a href="#zfs-send-ssh">19.4.7.2. 透過 <span class="application">SSH</span> 傳送加密的備份</a></span></dt></dl></dd><dt><span class="sect2"><a href="#zfs-zfs-quota">19.4.8. 資料集、使用者以及群組配額</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-reservation">19.4.9. 保留空間</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-compression">19.4.10. 壓縮 (Compression)</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-deduplication">19.4.11. 去重複 (Deduplication)</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-jail">19.4.12. <acronym class="acronym">ZFS</acronym> 與 Jail</a></span></dt></dl></dd><dt><span class="sect1"><a href="#zfs-zfs-allow">19.5. 委託管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#zfs-zfs-allow-create">19.5.1. 委託資料集建立</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-allow-allow">19.5.2. 委託權限委託</a></span></dt></dl></dd><dt><span class="sect1"><a href="#zfs-advanced">19.6. 進階主題</a></span></dt><dd><dl><dt><span class="sect2"><a href="#zfs-advanced-tuning">19.6.1. 調校</a></span></dt><dt><span class="sect2"><a href="#zfs-advanced-i386">19.6.2. i386 上的 <acronym class="acronym">ZFS</acronym></a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp78541624">19.6.2.1. 記憶體</a></span></dt><dt><span class="sect3"><a href="#idp78544312">19.6.2.2. 核心設定</a></span></dt><dt><span class="sect3"><a href="#idp78548664">19.6.2.3. 載入程式可調參數</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#zfs-links">19.7. 其他資源</a></span></dt><dt><span class="sect1"><a href="#zfs-term">19.8. <acronym class="acronym">ZFS</acronym> 特色與術語</a></span></dt></dl></dd><dt><span class="chapter"><a href="#filesystems">20. 其他檔案系統</a></span></dt><dd><dl><dt><span class="sect1"><a href="#filesystems-synopsis">20.1. 概述</a></span></dt><dt><span class="sect1"><a href="#filesystems-linux">20.2. <span class="trademark">Linux</span>® 檔案系統</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp78880440">20.2.1. <acronym class="acronym">ext2</acronym></a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#virtualization">21. 虛擬化</a></span></dt><dd><dl><dt><span class="sect1"><a href="#virtualization-synopsis">21.1. 概述</a></span></dt><dt><span class="sect1"><a href="#virtualization-guest-parallels">21.2. 在 <span class="trademark">Mac OS</span>® X 的 <span class="application">Parallels</span> 安裝 FreeBSD 為客端</a></span></dt><dd><dl><dt><span class="sect2"><a href="#virtualization-guest-parallels-install">21.2.1. 在 Parallels/<span class="trademark">Mac OS</span>® X 安裝 FreeBSD</a></span></dt><dt><span class="sect2"><a href="#virtualization-guest-parallels-configure">21.2.2. 在 <span class="application">Parallels</span> 設定 FreeBSD</a></span></dt></dl></dd><dt><span class="sect1"><a href="#virtualization-guest-virtualpc">21.3. 在 <span class="trademark">Windows</span>® 的 <span class="application">Virtual PC</span> 安裝 FreeBSD 為客端</a></span></dt><dd><dl><dt><span class="sect2"><a href="#virtualization-guest-virtualpc-install">21.3.1. 在 <span class="application">Virtual PC</span> 安裝 FreeBSD</a></span></dt><dt><span class="sect2"><a href="#virtualization-guest-virtualpc-configure">21.3.2. 在 <span class="application">Virtual PC</span> 設定 FreeBSD</a></span></dt></dl></dd><dt><span class="sect1"><a href="#virtualization-guest-vmware">21.4. 在 <span class="trademark">Mac OS</span>® 的 <span class="application">VMware Fusion</span> 安裝 FreeBSD 為客端</a></span></dt><dd><dl><dt><span class="sect2"><a href="#virtualization-guest-vmware-install">21.4.1. 在 <span class="application">VMware Fusion</span> 安裝 FreeBSD</a></span></dt><dt><span class="sect2"><a href="#virtualization-guest-vmware-configure">21.4.2. 在 <span class="application">VMware Fusion</span> 設定 FreeBSD</a></span></dt></dl></dd><dt><span class="sect1"><a href="#virtualization-guest-virtualbox">21.5. 在 <span class="trademark">VirtualBox</span>™ 安裝 FreeBSD 作為客端</a></span></dt><dt><span class="sect1"><a href="#virtualization-host-virtualbox">21.6. 以 FreeBSD 作為主端使用 <span class="trademark">VirtualBox</span>™</a></span></dt><dd><dl><dt><span class="sect2"><a href="#virtualization-virtualbox-install">21.6.1. 安裝 <span class="trademark">VirtualBox</span>™</a></span></dt><dt><span class="sect2"><a href="#virtualization-virtualbox-usb-support">21.6.2. <span class="trademark">VirtualBox</span>™ USB 支援</a></span></dt><dt><span class="sect2"><a href="#virtualization-virtualbox-host-dvd-cd-access">21.6.3. <span class="trademark">VirtualBox</span>™ Host <acronym class="acronym">DVD</acronym>/<acronym class="acronym">CD</acronym> 存取</a></span></dt></dl></dd><dt><span class="sect1"><a href="#virtualization-host-bhyve">21.7. 以 FreeBSD 作為主端安裝 <span class="application">bhyve</span></a></span></dt><dd><dl><dt><span class="sect2"><a href="#virtualization-bhyve-prep">21.7.1. 準備主端</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-freebsd">21.7.2. 建立 FreeBSD 客端</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-linux">21.7.3. 建立 <span class="trademark">Linux</span>® 客端</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-uefi">21.7.4. 使用 <acronym class="acronym">UEFI</acronym> 韌體開機 <span class="application">bhyve</span> 虛擬機器</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-framebuffer">21.7.5. 供 <span class="application">bhyve</span> 客端用的圖型化 <acronym class="acronym">UEFI</acronym> Framebuffer</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-zfs">21.7.6. 在 <span class="application">bhyve</span> 客端使用 <acronym class="acronym">ZFS</acronym></a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-nmdm">21.7.7. 虛擬機器 Console</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-managing">21.7.8. 管理虛擬機器</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-onboot">21.7.9. Persistent 設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#virtualization-host-xen">21.8. 以 FreeBSD 作為主端安裝 <span class="trademark">Xen</span>™</a></span></dt><dd><dl><dt><span class="sect2"><a href="#virtualization-host-xen-requirements">21.8.1. <span class="trademark">Xen</span>™ Dom0 的硬體需求</a></span></dt><dt><span class="sect2"><a href="#virtualization-host-xen-dom0-setup">21.8.2. <span class="trademark">Xen</span>™ Dom0 控制領域安裝</a></span></dt><dt><span class="sect2"><a href="#virtualization-host-xen-domu-setup">21.8.3. <span class="trademark">Xen</span>™ DomU 客端 VM 設置</a></span></dt><dt><span class="sect2"><a href="#virtualization-host-xen-troubleshooting">21.8.4. 疑難排解</a></span></dt><dd><dl><dt><span class="sect3"><a href="#virtualization-host-xen-troubleshooting-host">21.8.4.1. 主端開機疑難排解</a></span></dt><dt><span class="sect3"><a href="#virtualization-host-xen-troubleshooting-guest">21.8.4.2. 客端建立疑難排解</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="#l10n">22. 在地化 - <acronym class="acronym">i18n</acronym>/<acronym class="acronym">L10n</acronym> 使用與安裝</a></span></dt><dd><dl><dt><span class="sect1"><a href="#l10n-synopsis">22.1. 概述</a></span></dt><dt><span class="sect1"><a href="#using-localization">22.2. 使用語系</a></span></dt><dd><dl><dt><span class="sect2"><a href="#setting-locale">22.2.1. 設定登入 Shell 的語系</a></span></dt><dd><dl><dt><span class="sect3"><a href="#login-class">22.2.1.1. 登入類別 (Login Class) 法</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idp79884344">22.2.1.1.1. 變更登入類別的工具</a></span></dt></dl></dd><dt><span class="sect3"><a href="#startup-file">22.2.1.2. Shell 啟動檔 (Startup File) 法</a></span></dt></dl></dd><dt><span class="sect2"><a href="#setting-console">22.2.2. Console 設定</a></span></dt><dt><span class="sect2"><a href="#idp80000184">22.2.3. Xorg 設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#l10n-compiling">22.3. 尋找 <acronym class="acronym">i18n</acronym> 應用程式</a></span></dt><dt><span class="sect1"><a href="#lang-setup">22.4. 特定語言的語系設定</a></span></dt><dd><dl><dt><span class="sect2"><a href="#ru-localize">22.4.1. 俄語 (KOI8-R 編碼)</a></span></dt><dt><span class="sect2"><a href="#idp80136632">22.4.2. 其他特定語言資源</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#updating-upgrading">23. 更新與升級 FreeBSD</a></span></dt><dd><dl><dt><span class="sect1"><a href="#updating-upgrading-synopsis">23.1. 概述</a></span></dt><dt><span class="sect1"><a href="#updating-upgrading-freebsdupdate">23.2. FreeBSD 更新</a></span></dt><dd><dl><dt><span class="sect2"><a href="#freebsdupdate-config-file">23.2.1. 設定檔</a></span></dt><dt><span class="sect2"><a href="#freebsdupdate-security-patches">23.2.2. 套用安全性修補</a></span></dt><dt><span class="sect2"><a href="#freebsdupdate-upgrade">23.2.3. 執行主要及次要版號升級</a></span></dt><dd><dl><dt><span class="sect3"><a href="#freebsd-update-custom-kernel-9x">23.2.3.1. 在 FreeBSD 9.X 及之後版本自訂核心</a></span></dt><dt><span class="sect3"><a href="#freebsdupdate-portsrebuild">23.2.3.2. 主要版號升級後的套件升級</a></span></dt></dl></dd><dt><span class="sect2"><a href="#freebsdupdate-system-comparison">23.2.4. 比對系統狀態</a></span></dt></dl></dd><dt><span class="sect1"><a href="#updating-upgrading-documentation">23.3. 更新文件集</a></span></dt><dd><dl><dt><span class="sect2"><a href="#updating-installed-documentation">23.3.1. 自原始碼更新說明文件</a></span></dt><dt><span class="sect2"><a href="#doc-ports-install-package">23.3.2. 自 Port 更新說明文件</a></span></dt></dl></dd><dt><span class="sect1"><a href="#current-stable">23.4. 追蹤開發分支</a></span></dt><dd><dl><dt><span class="sect2"><a href="#current">23.4.1. 使用 FreeBSD-CURRENT</a></span></dt><dt><span class="sect2"><a href="#stable">23.4.2. 使用 FreeBSD-STABLE</a></span></dt></dl></dd><dt><span class="sect1"><a href="#makeworld">23.5. 從原始碼更新 FreeBSD</a></span></dt><dd><dl><dt><span class="sect2"><a href="#updating-src-quick-start">23.5.1. 快速開始</a></span></dt><dt><span class="sect2"><a href="#updating-src-preparing">23.5.2. 準備原始碼更新</a></span></dt><dt><span class="sect2"><a href="#updating-src-obtaining-src">23.5.3. 更新原始碼</a></span></dt><dt><span class="sect2"><a href="#updating-src-building">23.5.4. 從原始碼編譯</a></span></dt><dd><dl><dt><span class="sect3"><a href="#updating-src-building-clean-build">23.5.4.1. 執行清除編譯</a></span></dt><dt><span class="sect3"><a href="#updating-src-building-jobs">23.5.4.2. 設定工作數量</a></span></dt><dt><span class="sect3"><a href="#updating-src-building-only-kernel">23.5.4.3. 只編譯核心</a></span></dt><dt><span class="sect3"><a href="#updating-src-building-custom-kernel">23.5.4.4. 編譯自訂核心</a></span></dt></dl></dd><dt><span class="sect2"><a href="#updating-src-installing">23.5.5. 安裝編譯好的程式</a></span></dt><dt><span class="sect2"><a href="#updating-src-completing">23.5.6. 完成更新</a></span></dt><dd><dl><dt><span class="sect3"><a href="#updating-src-completing-merge-mergemaster">23.5.6.1. 使用 mergemaster(8) 合併設定檔案</a></span></dt><dt><span class="sect3"><a href="#updating-src-completing-check-old">23.5.6.2. 檢查過時的檔案與程式庫</a></span></dt><dt><span class="sect3"><a href="#updating-src-completing-restart">23.5.6.3. 更新後重新啟動</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#small-lan">23.6. 多部機器追蹤</a></span></dt></dl></dd><dt><span class="chapter"><a href="#dtrace">24. DTrace</a></span></dt><dd><dl><dt><span class="sect1"><a href="#dtrace-synopsis">24.1. 概述</a></span></dt><dt><span class="sect1"><a href="#dtrace-implementation">24.2. 實作差異</a></span></dt><dt><span class="sect1"><a href="#dtrace-enable">24.3. 開啟 DTrace 支援</a></span></dt><dt><span class="sect1"><a href="#dtrace-using">24.4. 使用 DTrace</a></span></dt></dl></dd><dt><span class="chapter"><a href="#usb-device-mode">25. USB Device Mode / USB OTG</a></span></dt><dd><dl><dt><span class="sect1"><a href="#usb-device-mode-synopsis">25.1. 概述</a></span></dt><dt><span class="sect1"><a href="#usb-device-mode-terminals">25.2. <acronym class="acronym">USB</acronym> 虛擬序列埠</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp80971576">25.2.1. 設定 USB 裝置模式序列埠</a></span></dt><dt><span class="sect2"><a href="#idp80983224">25.2.2. 自 FreeBSD 連線到 USB 裝置模式序列埠</a></span></dt><dt><span class="sect2"><a href="#idp80986424">25.2.3. 自 macOS 連線到 USB 裝置模式序列埠</a></span></dt><dt><span class="sect2"><a href="#idp80992824">25.2.4. 自 Linux 連線到 USB 裝置模式序列埠</a></span></dt><dt><span class="sect2"><a href="#idp80995128">25.2.5. 自 Microsoft Windows 10 連線到 USB 裝置模式序列埠</a></span></dt></dl></dd><dt><span class="sect1"><a href="#usb-device-mode-network">25.3. <acronym class="acronym">USB</acronym> 裝置模式網路介面</a></span></dt><dt><span class="sect1"><a href="#usb-device-mode-storage">25.4. <acronym class="acronym">USB</acronym> 虛擬儲存裝置</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp81016120">25.4.1. 使用 cfumass 啟動 Script 設定 USB 大容量儲存目標</a></span></dt><dt><span class="sect2"><a href="#idp81037880">25.4.2. 使用其他方式設定 USB 大容量存儲目標</a></span></dt></dl></dd></dl></dd></dl></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="config-tuning"></a>章 11. 設定與調校</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Chern</span> <span class="surname">Lee</span></span>. </span></div><div><span class="authorgroup">Based on a tutorial written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Mike</span> <span class="surname">Smith</span></span>. </span></div><div><span class="authorgroup">Also based on tuning(7) written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Matt</span> <span class="surname">Dillon</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#config-synopsis">11.1. 概述</a></span></dt><dt><span class="sect1"><a href="#configtuning-starting-services">11.2. 啟動服務</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp69744312">11.2.1. 延伸應用程式設定</a></span></dt><dt><span class="sect2"><a href="#idp69755960">11.2.2. 使用服務來啟動其他服務</a></span></dt></dl></dd><dt><span class="sect1"><a href="#configtuning-cron">11.3. 設定 cron(8)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#configtuning-installcrontab">11.3.1. 建立使用者的 Crontab</a></span></dt></dl></dd><dt><span class="sect1"><a href="#configtuning-rcd">11.4. 管理 FreeBSD 中的服務</a></span></dt><dd><dl><dt><span class="sect2"><a href="#configtuning-core-configuration">11.4.1. 管理系統特定的設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#config-network-setup">11.5. 設定網路介面卡</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp69940536">11.5.1. 找到正確的驅動程式</a></span></dt><dd><dl><dt><span class="sect3"><a href="#config-network-ndis">11.5.1.1. 使用 <span class="trademark">Windows</span>® <acronym class="acronym">NDIS</acronym> 驅動程式</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp69475128">11.5.2. 設定網路卡</a></span></dt><dt><span class="sect2"><a href="#config-network-testing">11.5.3. 測試與疑難排解</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp69555768">11.5.3.1. 測試乙太網路卡</a></span></dt><dt><span class="sect3"><a href="#idp70017208">11.5.3.2. 疑難排解</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#configtuning-virtual-hosts">11.6. 虛擬主機</a></span></dt><dt><span class="sect1"><a href="#configtuning-syslog">11.7. 設定系統日誌</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp69424312">11.7.1. 設定本地日誌</a></span></dt><dt><span class="sect2"><a href="#idp70118968">11.7.2. 日誌管理與翻轉</a></span></dt><dt><span class="sect2"><a href="#network-syslogd">11.7.3. 設定遠端日誌</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70203320">11.7.3.1. 日誌伺服器設定</a></span></dt><dt><span class="sect3"><a href="#idp70239160">11.7.3.2. 日誌客戶端設定</a></span></dt><dt><span class="sect3"><a href="#idp70251192">11.7.3.3. 日誌伺服器除錯</a></span></dt><dt><span class="sect3"><a href="#idp70266168">11.7.3.4. 安全注意事項</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#configtuning-configfiles">11.8. 設定檔</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp70279096">11.8.1. <code class="filename">/etc</code> 配置</a></span></dt><dt><span class="sect2"><a href="#idp70303416">11.8.2. 主機名稱</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70305336">11.8.2.1. <code class="filename">/etc/resolv.conf</code></a></span></dt><dt><span class="sect3"><a href="#idp70337848">11.8.2.2. <code class="filename">/etc/hosts</code></a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#configtuning-sysctl">11.9. 使用 sysctl(8) 調校</a></span></dt><dd><dl><dt><span class="sect2"><a href="#configtuning-sysctlconf">11.9.1. <code class="filename">sysctl.conf</code></a></span></dt><dt><span class="sect2"><a href="#sysctl-readonly">11.9.2. 唯讀 sysctl(8)</a></span></dt></dl></dd><dt><span class="sect1"><a href="#configtuning-disk">11.10. 調校磁碟</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp70401976">11.10.1. Sysctl 變數</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70402616">11.10.1.1. <code class="varname">vfs.vmiodirenable</code></a></span></dt><dt><span class="sect3"><a href="#idp70408632">11.10.1.2. <code class="varname">vfs.write_behind</code></a></span></dt><dt><span class="sect3"><a href="#idp70416824">11.10.1.3. <code class="varname">vfs.hirunningspace</code></a></span></dt><dt><span class="sect3"><a href="#idp70427064">11.10.1.4. <code class="varname">vm.swap_idle_enabled</code></a></span></dt><dt><span class="sect3"><a href="#idp70431928">11.10.1.5. <code class="varname">hw.ata.wc</code></a></span></dt><dt><span class="sect3"><a href="#idp70456376">11.10.1.6. <code class="literal">SCSI_DELAY</code>
	  (<code class="varname">kern.cam.scsi_delay</code>)</a></span></dt></dl></dd><dt><span class="sect2"><a href="#soft-updates">11.10.2. 軟更新</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70459448">11.10.2.1. 有關軟更新的更多詳細資訊</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#configtuning-kernel-limits">11.11. 調校核心限制</a></span></dt><dd><dl><dt><span class="sect2"><a href="#file-process-limits">11.11.1. 檔案/程序限制</a></span></dt><dd><dl><dt><span class="sect3"><a href="#kern-maxfiles">11.11.1.1. <code class="varname">kern.maxfiles</code></a></span></dt><dt><span class="sect3"><a href="#idp70551992">11.11.1.2. <code class="varname">kern.ipc.soacceptqueue</code></a></span></dt></dl></dd><dt><span class="sect2"><a href="#nmbclusters">11.11.2. 網路限制</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70591032">11.11.2.1. <code class="varname">net.inet.ip.portrange.*</code></a></span></dt><dt><span class="sect3"><a href="#idp70598840">11.11.2.2. <code class="literal">TCP</code> 頻寬延遲乘積</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp70611128">11.11.3. 虛擬記憶體</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70611768">11.11.3.1. <code class="varname">kern.maxvnodes</code></a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#adding-swap-space">11.12. 增加交換空間</a></span></dt><dd><dl><dt><span class="sect2"><a href="#new-drive-swap">11.12.1. 使用新硬碟或既有分割區增加交換空間</a></span></dt><dt><span class="sect2"><a href="#create-swapfile">11.12.2. 建立交換檔</a></span></dt></dl></dd><dt><span class="sect1"><a href="#acpi-overview">11.13. 電源與資源管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#acpi-config">11.13.1. 設定 <acronym class="acronym">ACPI</acronym></a></span></dt><dt><span class="sect2"><a href="#ACPI-comprob">11.13.2. 常見問題</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp70770360">11.13.2.1. 滑鼠問題</a></span></dt><dt><span class="sect3"><a href="#idp70772536">11.13.2.2. 待機/喚醒</a></span></dt><dt><span class="sect3"><a href="#idp70811064">11.13.2.3. 系統無回應</a></span></dt><dt><span class="sect3"><a href="#idp70821432">11.13.2.4. 當機</a></span></dt><dt><span class="sect3"><a href="#idp70827064">11.13.2.5. 系統在待機或關機後仍開機</a></span></dt><dt><span class="sect3"><a href="#ACPI-aslanddump">11.13.2.6. BIOS 含有有問題的 Bytecode</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp70851256">11.13.3. 覆蓋預設的 <acronym class="acronym">AML</acronym></a></span></dt><dt><span class="sect2"><a href="#ACPI-submitdebug">11.13.4. 取得與回報除錯資訊</a></span></dt><dt><span class="sect2"><a href="#ACPI-References">11.13.5. 參考文獻</a></span></dt></dl></dd></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="config-synopsis"></a>11.1. 概述</h2></div></div></div><a id="idp69724472" class="indexterm"></a><a id="idp69725368" class="indexterm"></a><p>在 FreeBSD 使用過程中，相當重要的環節之一就是如何正確設定系統。 本章著重於介紹 FreeBSD 的設定流程，包括一些可以調整 FreeBSD 效能的參數設定。</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">rc.conf</code> 設定的基礎概念及 <code class="filename">/usr/local/etc/rc.d</code> 啟動 Script。</p></li><li class="listitem"><p>如何設定並測試網路卡。</p></li><li class="listitem"><p>如何在網路裝置上設定虛擬主機。</p></li><li class="listitem"><p>如何使用在 <code class="filename">/etc</code> 中的各種設定檔。</p></li><li class="listitem"><p>如何使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> 變數調校 FreeBSD。</p></li><li class="listitem"><p>如何調校磁碟效能及修改核心限制。</p></li></ul></div><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>了解 <span class="trademark">UNIX</span>® 及 FreeBSD 基礎 (<a class="xref" href="#basics" title="章 3. FreeBSD 基礎">章 3, <em>FreeBSD 基礎</em></a>)。</p></li><li class="listitem"><p>熟悉核心設定與編譯的基礎 (<a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a>)。</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-starting-services"></a>11.2. 啟動服務</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp69741112" class="indexterm"></a><p>許多使用者會使用 Port 套件集安裝第三方軟體到 FreeBSD 且需要安裝服務在系統初始化時可啟動該軟體。服務，例如 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/postfix/pkg-descr">mail/postfix</a> 或 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/apache22/pkg-descr">www/apache22</a> 僅只是在眾多需要在系統初始化時啟動的軟體之中的兩個。本章節將說明可用來啟動第三方軟體的程序。</p><p>在 FreeBSD 大多數內建的服務，例如 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> 也是透過系統啟動 Script 來執行。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69744312"></a>11.2.1. 延伸應用程式設定</h3></div></div></div><p>現在 FreeBSD 會引用 <code class="filename">rc.d</code>，設定應用程式啟動變的更簡單且提供更多的功能。使用於 <a class="xref" href="#configtuning-rcd" title="11.4. 管理 FreeBSD 中的服務">節 11.4, “管理 FreeBSD 中的服務”</a> 所提到的關鍵字，可以設定應用程式在其他特定服務之後啟動且可以透過 <code class="filename">/etc/rc.conf</code> 來傳遞額外的旗標來取代寫死在啟動 Script 中的旗標。一個基本的 Script 可能會如下例所示：</p><pre xml:lang="en" class="programlisting" lang="en">#!/bin/sh
#
# PROVIDE: utility
# REQUIRE: DAEMON
# KEYWORD: shutdown

. /etc/rc.subr

name=utility
rcvar=utility_enable

command="/usr/local/sbin/utility"

load_rc_config $name

#
# DO NOT CHANGE THESE DEFAULT VALUES HERE
# SET THEM IN THE /etc/rc.conf FILE
#
utility_enable=${utility_enable-"NO"}
pidfile=${utility_pidfile-"/var/run/utility.pid"}

run_rc_command "$1"</pre><p>這個 Script 會確保要執行的 <code class="literal">utility</code> 會在虛構的服務 <code class="literal">DAEMON</code> 之後啟動，也同時提供設定與追蹤程序 ID (Process ID, <acronym class="acronym">PID</acronym>) 的方法。</p><p>接著此應用程式便可將下行放到 <code class="filename">/etc/rc.conf</code> 中：</p><pre xml:lang="en" class="programlisting" lang="en">utility_enable="YES"</pre><p>使用這種方式可以簡單的處理指令列參數、引用 <code class="filename">/etc/rc.subr</code> 所提供的預設函數、與 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rcorder&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rcorder</span>(8)</span></a> 相容並可在 <code class="filename">rc.conf</code> 簡單的設定。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69755960"></a>11.2.2. 使用服務來啟動其他服務</h3></div></div></div><p>其他的服務可以使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> 來啟動，在 <a class="xref" href="#network-inetd" title="29.2. inetd 超級伺服器">節 29.2, “<span class="application">inetd</span> 超級伺服器”</a> 有如何使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> 以及其設定的深入說明。</p><p>在某些情況更適合使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> 來啟動系統服務，由於 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> 會使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=crontab&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">crontab</span>(5)</span></a> 的擁有者來執行這些程序，所以這個方法有不少優點，這讓一般的使用者也可以啟動與維護自己的應用程式。</p><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> 的 <code class="literal">@reboot</code> 功能，可用來替代指定詳細的時間，而該工作會在系統初始化時執行 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> 後執行。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-cron"></a>11.3. 設定 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a></h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp69784632" class="indexterm"></a><p>在 FreeBSD 其中最有用的其中一項工具便是 <span class="application">cron</span>，這個工具會在背景執行並且定期檢查 <code class="filename">/etc/crontab</code> 是否有要執行的工作然後搜尋 <code class="filename">/var/cron/tabs</code> 是否有自訂的 crontab 檔案，這些檔案用來安排要讓 <span class="application">cron</span> 在指定的時間執行的工作，crontab 中的每一個項目定義了一個要執行的工作，又稱作 <em class="firstterm">cron job</em>。</p><p>這裡使用了兩種類型的設定檔：其一是系統 crontab，系統 crontab 不應該被修改，其二為使用者 crontab，使用者 crontab 可以依需要建立與編輯。這兩種檔案的格式在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=crontab&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">crontab</span>(5)</span></a> 有說明。系統 crontab <code class="filename">/etc/crontab</code> 的格式含有在使用者 crontab 所沒有的 <code class="literal">who</code> 欄位，在系統 crontab，<span class="application">cron</span> 會依據該欄位所指定的使用者來執行指令，而在使用者 crontab，會以建立 crontab 的使用者來執行指令。</p><p>使用者 crontab 讓個別使用者可以安排自己的工作，<code class="systemitem">root</code> 使用者也可有自己的使用者 <code class="filename">crontab</code> 來安排不在系統 <code class="filename">crontab</code> 中的工作。</p><p>以下為系統 crontab <code class="filename">/etc/crontab</code> 的範例項目：</p><pre xml:lang="en" class="programlisting" lang="en"># /etc/crontab - root's crontab for FreeBSD
#
# <span class="phrase">$FreeBSD$</span>
# <a id="co-comments"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
SHELL=/bin/sh
PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin <a id="co-env"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
#
#minute	hour	mday	month	wday	who	command <a id="co-field-descr"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
#
*/5	*	*	*	*	root	/usr/libexec/atrun <a id="co-main"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-comments"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>以 <code class="literal">#</code> 字元為首的行代表註解。可在檔案中放置註解提醒要執行什麼動作及為何要執行。註解不可與指令同行，否則會被當做指令的一部份，註解必須在新的一行，空白行則會被忽略掉。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-env"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>等號 (<code class="literal">=</code>) 字元用來定義任何環境設定。在這個例子當中，使用了等號來定義 <code class="envar">SHELL</code> 及 <code class="envar">PATH</code>。若 <code class="envar">SHELL</code> 被省略，<span class="application">cron</span> 則會使用預設的 Bourne shell。若 <code class="envar">PATH</code> 被省略，則必須指定指令或 Script 的完整路徑才能執行。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-field-descr"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>此行定義了在系統 crontab 會使用到的七個欄位：<code class="literal">minute</code>, <code class="literal">hour</code>, <code class="literal">mday</code>, <code class="literal">month</code>, <code class="literal">wday</code>, <code class="literal">who</code> 以及 <code class="literal">command</code>。<code class="literal">minute</code> 欄位是指定指令要執行的時間中的分，<code class="literal">hour</code> 指定指令要執行的時，<code class="literal">mday</code> 是月裡面的日，<code class="literal">month</code> 是月，以及 <code class="literal">wday</code> 是週裡面的日。這些欄位必須數值代表 24 小時制的時間或 <code class="literal">*</code> 來代表所有可能的值。<code class="literal">who</code> 這個欄位只有系統 crontab 才有，用來指定要用那一個使用者來執行指令。最後一個欄位則是要執行的指令。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-main"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>這個項目定義了該工作所使用的數值，<code class="literal">*/5</code> 後接著數個 <code class="literal">*</code> 字元指的是每個月的每一週的每一日的每個小時的每 5 分鐘會使用 <code class="systemitem">root</code> 執行 <code class="command">/usr/libexec/atrun</code>。</p><p>指令可含任何數量的參數，但若指令要使用多行則需以反斜線 <span class="quote">“<span class="quote">\</span>”</span> 連線字元換行。</p></td></tr></table></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="configtuning-installcrontab"></a>11.3.1. 建立使用者的 Crontab</h3></div></div></div><p>要建立一個使用者 crontab 可使用編輯模式執行 <code class="command">crontab</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>crontab -e</code></strong></pre><p>這樣會使用預設的文字編輯器來開啟使用者的 crontab，使用者第一次執行這個指令會開啟一個空的檔案，使用者建立 crontab 之後這個指令則會開啟已建立的 crontab 供編輯。</p><p>加入這些行到 crontab 檔的最上方來設定環境變數以及備忘在 crontab 中欄位的意思非常有用：</p><pre xml:lang="en" class="programlisting" lang="en">SHELL=/bin/sh
PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin
# Order of crontab fields
# minute	hour	mday	month	wday	command</pre><p>然後每一個要執行的指令或 Script 加入一行，指定要執行指令的時間。這個例子會每天在下午 2 點執行指定的自訂 Bourne shell script，由於沒有在 <code class="literal">PATH</code> 指定 Script 的路徑，所以必須給予完整的 Script 路徑：</p><pre xml:lang="en" class="programlisting" lang="en">0	14	*	*	*	/usr/home/dru/bin/mycustomscript.sh</pre><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml">在使用自訂的 Script 之前，請先確定該 Script 可以執行並且使用 cron 在有限的環境變數下測試。要複製一個用來執行上述 cron 項目的環境可以使用：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="programlisting" lang="en">env -i SHELL=/bin/sh PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin HOME=/home/<em class="replaceable"><code>dru</code></em> LOGNAME=<em class="replaceable"><code>dru</code></em> <em class="replaceable"><code>/usr/home/dru/bin/mycustomscript.sh</code></em></pre><p xmlns="http://www.w3.org/1999/xhtml">在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=crontab&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">crontab</span>(5)</span></a> 有討論 cron 使用的環境變數，若 Script 中含有任何會使用萬用字元刪除檔案的指令，那麼檢查 Script 可正常在 cron 的環境運作非常重要。</p></div><p>編輯完成 crontab 之後儲存檔案，編輯完的 crontab 會被自動安裝且 <span class="application">cron</span> 會讀取該 crontab 並在其指定的時指執行其 cron job。要列出 crontab 中有那一些 cron job 可以使用此指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>crontab -l</code></strong>
0	14	*	*	*	/usr/home/dru/bin/mycustomscript.sh</pre><p>要移除使用在使用者 crontab 中的 cron job 可：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>crontab -r</code></strong>
remove crontab for dru? <strong class="userinput"><code>y</code></strong></pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-rcd"></a>11.4. 管理 FreeBSD 中的服務</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p>FreeBSD 在系統初始化時使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> 系統的啟動 Script。列於 <code class="filename">/etc/rc.d</code> 的 Script 提供了基本的服務可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=service&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">service</span>(8)</span></a> 加上 <code class="option">start</code>, <code class="option">stop</code> 以及 <code class="option">restart</code> 選項來控制。例如，使用以下指令可以重新啟動 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service sshd restart</code></strong></pre><p>這個程序可以用來在執行中的系統上啟動服務，而在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> 中有指定的服務則會在開機時自動啟動。例如，要在系統啟動時開啟 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a>，可入下行到 <code class="filename">/etc/rc.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">natd_enable="YES"</pre><p>若 <code class="option">natd_enable="NO"</code> 行已存在，則將 <code class="literal">NO</code> 更改為 <code class="literal">YES</code>，在下次開機時 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> script 便會自動載入任何相依的服務，詳細如下所述。</p><p>由於 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> 系統主要用於在系統開機與關機時啟動與停止服務，只有當有服務的變數設定在 <code class="filename">/etc/rc.conf</code> 時 <code class="option">start</code>, <code class="option">stop</code> 以及 <code class="option">restart</code> 才會有作用。例如 <code class="command">sshd restart</code> 只會在 <code class="filename">/etc/rc.conf</code> 中的 <code class="varname"> sshd_enable</code> 設為 <code class="option">YES</code> 時才會運作，若要不透過 <code class="filename">/etc/rc.conf</code> 的設定來 <code class="option">start</code>, <code class="option">stop</code> 或 <code class="option">restart</code> 一個服務則需要在指令前加上 <span class="quote">“<span class="quote">one</span>”</span>，例如要不透過目前在 <code class="filename">/etc/rc.conf</code> 的設定重新啟動 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> 可執行以下指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service sshd onerestart</code></strong></pre><p>要檢查一個服務是否有在 <code class="filename">/etc/rc.conf</code> 開啟，可執行服務的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> Script 加上 <code class="option">rcvar</code>。這個例子會檢查 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> 是否在 <code class="filename">/etc/rc.conf</code> 已經開啟：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service sshd rcvar</code></strong>
# sshd
#
sshd_enable="YES"
#   (default: "")</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">行 <code class="literal"># sshd</code> 的輸出來自上述指令，而非 <code class="systemitem">root</code> console。</p></div><p>要判斷是一個服務是否正在執行，可使用 <code class="option">status</code>，例如要確認 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> 是否正常在執行：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service sshd status</code></strong>
sshd is running as pid 433.</pre><p>在某些情況，也可以 <code class="option">reload</code> 一個服務。這個動作會嘗試發送一個信號給指定的服務，強制服務重新載入其設定檔，在大多數的情況下，發送給服務的信號是 <code class="literal">SIGHUP</code>。並不是每個服務都有支援此功能。</p><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> 系統會用在網路服務及也應用在大多數的系統初化 。例如執行 <code class="filename">/etc/rc.d/bgfsck</code> Script 會列印出以下訊息：</p><pre xml:lang="en" class="screen" lang="en">Starting background file system checks in 60 seconds.</pre><p>這個 Script 用來在背景做檔案系統檢查，只有在系統初始化時要執行。</p><p>許多系統服務會相依其他服務來運作，例如 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=yp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">yp</span>(8)</span></a> 及其他以 <acronym class="acronym">RPC</acronym> 為基礎的服務在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rpcbind&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rpcbind</span>(8)</span></a> 服務啟動前可能會啟動失敗。要解決這種問題，就必須在啟動 Script 上方的註解中加入相依及其他 meta-data。在系統初始化時會用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rcorder&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rcorder</span>(8)</span></a> 程式分析這些註解來決定要以什麼順序來執行系統服務以滿足相依。</p><p>因 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a> 的需要，以下的關鍵字必須加入到所有的啟動 Script 方可 <span class="quote">“<span class="quote">enable</span>”</span> 啟動 Script：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">PROVIDE</code>: 設定此檔案所提供的服務。</p></li></ul></div><p>以下關鍵字可能會在每個啟動 Script 的上方引用，雖然非必要，但是對於 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rcorder&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rcorder</span>(8)</span></a> 是非常有用的提示：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">REQUIRE</code>: 列出此服務需要引用的服務。有使用此關鍵字的 Script 會在指定服務啟動 <span class="emphasis"><em>之後</em></span> 才執行。</p></li><li class="listitem"><p><code class="literal">BEFORE</code>: 列出相依此服務的服務。有使用此關鍵字的 Script 會在指定的服務啟動 <span class="emphasis"><em>之前</em></span> 執行。</p></li></ul></div><p>透過仔細的設定每個啟動 Script 的這些關鍵字，管理者便可對 Script 的啟動順序進行微調，而不需使用到其他 <span class="trademark">UNIX</span>® 作業系統所使用的 <span class="quote">“<span class="quote">runlevels</span>”</span>。</p><p>額外的資訊可在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> 以及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a> 中找到。請參考 <a class="link" href="../../../../doc/en_US.ISO8859-1/articles/rc-scripting" target="_top">此文章</a> 來取得如何建立自訂 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> Script 的操作說明。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="configtuning-core-configuration"></a>11.4.1. 管理系統特定的設定</h3></div></div></div><a id="idp69360568" class="indexterm"></a><p>系統設定資訊的主要位於 <code class="filename">/etc/rc.conf</code>，這個檔案的設定資訊範圍非常廣且會在系統啟動時讀取來設定系統，它也提供設定資訊給 <code class="filename">rc*</code> 檔案使用。</p><p>在 <code class="filename">/etc/rc.conf</code> 中的設定項目會覆蓋在 <code class="filename">/etc/defaults/rc.conf</code> 的預設設定，不應直接編輯該檔案中的預設設定，所有系統特定的設定應到 <code class="filename">/etc/rc.conf</code> 所修改。</p><p>在叢集應用時要將系統特定的設定與各站特定的設定分開，藉此減少管理成本有好幾種方法，建議的方法是將系統特定的設定放置在 <code class="filename">/etc/rc.conf.local</code>，例如以下將要套用到所有系統的設定項目放在 <code class="filename">/etc/rc.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">sshd_enable="YES"
keyrate="fast"
defaultrouter="10.1.1.254"</pre><p>而只套用到此系統的設定放在 <code class="filename">/etc/rc.conf.local</code>：</p><pre xml:lang="en" class="programlisting" lang="en">hostname="node1.example.org"
ifconfig_fxp0="inet 10.1.1.1/8"</pre><p>使用應用程式如 <span class="application">rsync</span> 或 <span class="application">puppet</span> 將 <code class="filename">/etc/rc.conf</code> 散布到每個系統，而在各系統保留自己的 <code class="filename">/etc/rc.conf.local</code>。</p><p>升級系統並不會覆寫 <code class="filename">/etc/rc.conf</code>，所以系統設定資訊不會因此遺失。</p><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="filename">/etc/rc.conf</code> 以及 <code class="filename">/etc/rc.conf.local</code> 兩個檔案都會使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> 解析，這讓系統操作者能夠建立較複雜的設定方案。請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> 來取得更多有關此主題的資訊。</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="config-network-setup"></a>11.5. 設定網路介面卡</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><a id="idp69938488" class="indexterm"></a><p>對 FreeBSD 管理者來說加入與設定網路介面卡 (Network Interface Card, <acronym class="acronym">NIC</acronym>) 會是一件常見的工作。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69940536"></a>11.5.1. 找到正確的驅動程式</h3></div></div></div><a id="idp69941176" class="indexterm"></a><p>首先，要先確定 <acronym class="acronym">NIC</acronym> 的型號及其使用的晶片。FreeBSD 支援各種 <acronym class="acronym">NIC</acronym>，可檢查該 FreeBSD 發佈版本的硬體相容性清單來查看是否有支援該 <acronym class="acronym">NIC</acronym>。</p><p>若有支援該 <acronym class="acronym">NIC</acronym>，接著要確定該 <acronym class="acronym">NIC</acronym> 所要需要的 FreeBSD 驅動程式名稱。請參考 <code class="filename">/usr/src/sys/conf/NOTES</code> 及 <code class="filename">/usr/src/sys/<em class="replaceable"><code>arch</code></em>/conf/NOTES</code> 來取得 <acronym class="acronym">NIC</acronym> 驅動程式清單及其支援的晶片組相關資訊。當有疑問是，請閱讀該驅動程式的操作手冊，會有提供更多有關支援硬體及該驅動程式已知問題的資訊。</p><p><code class="filename">GENERIC</code> 核心已有內含常見 <acronym class="acronym">NIC</acronym> 的驅動程式 ，意思是在開機時應該會偵測到 <acronym class="acronym">NIC</acronym>。可以輸入 <code class="command">more /var/run/dmesg.boot</code> 來檢視系統的開機訊息並使用空白鍵捲動文字。在此例中，兩個乙太網路 <acronym class="acronym">NIC</acronym> 使用系統已有的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dc&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dc</span>(4)</span></a> 驅動程式：</p><pre xml:lang="en" class="screen" lang="en">dc0: &lt;82c169 PNIC 10/100BaseTX&gt; port 0xa000-0xa0ff mem 0xd3800000-0xd38
000ff irq 15 at device 11.0 on pci0
miibus0: &lt;MII bus&gt; on dc0
bmtphy0: &lt;BCM5201 10/100baseTX PHY&gt; PHY 1 on miibus0
bmtphy0:  10baseT, 10baseT-FDX, 100baseTX, 100baseTX-FDX, auto
dc0: Ethernet address: 00:a0:cc:da:da:da
dc0: [ITHREAD]
dc1: &lt;82c169 PNIC 10/100BaseTX&gt; port 0x9800-0x98ff mem 0xd3000000-0xd30
000ff irq 11 at device 12.0 on pci0
miibus1: &lt;MII bus&gt; on dc1
bmtphy1: &lt;BCM5201 10/100baseTX PHY&gt; PHY 1 on miibus1
bmtphy1:  10baseT, 10baseT-FDX, 100baseTX, 100baseTX-FDX, auto
dc1: Ethernet address: 00:a0:cc:da:da:db
dc1: [ITHREAD]</pre><p>若在 <code class="filename">GENERIC</code> 中沒有該 <acronym class="acronym">NIC</acronym> 的驅動程式，但有可用的驅動程式，那麼在設定及使用 <acronym class="acronym">NIC</acronym> 前要先載入該驅動程式，有兩種方式可以完成這件事：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>最簡單的方式是使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a> 載入 <acronym class="acronym">NIC</acronym> 要使用的核心模組。要在開機時自動載入，可加入適當的設定到 <code class="filename">/boot/loader.conf</code>。不是所有 <acronym class="acronym">NIC</acronym> 驅動程式皆可當做模組使用。</p></li><li class="listitem"><p>或者，靜態編譯對 <acronym class="acronym">NIC</acronym> 的支援到自訂核心，請參考  <code class="filename">/usr/src/sys/conf/NOTES</code>, <code class="filename">/usr/src/sys/<em class="replaceable"><code>arch</code></em>/conf/NOTES</code> 及驅動程式的操作手冊來了解要在自訂核心設定檔中要加入那些設定。要取得更多有關重新編譯核心的資訊可參考 <a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a>。若在開機時有偵測到 <acronym class="acronym">NIC</acronym>，就不需要再重新編譯核心。</p></li></ul></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="config-network-ndis"></a>11.5.1.1. 使用 <span class="trademark">Windows</span>® <acronym class="acronym">NDIS</acronym> 驅動程式</h4></div></div></div><a id="idp69976120" class="indexterm"></a><a id="idp69977144" class="indexterm"></a><a id="idp69982136" class="indexterm"></a><a id="idp69983416" class="indexterm"></a><a id="idp69985464" class="indexterm"></a><p>很不幸的，仍有很多供應商並沒有提供它們驅動程式的技術文件給開源社群，因為這些文件有涉及商業機密。因此，FreeBSD 及其他作業系統的開發人員只剩下兩種方案可以選擇：透過長期與艱苦的過程做逆向工程來開發驅動程式或是使用現有供 <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 平台用的驅動程式 Binary。</p><p>FreeBSD 對 Network Driver Interface Specification (<acronym class="acronym">NDIS</acronym>) 有提供 <span class="quote">“<span class="quote">原生</span>”</span> 的支援，這包含了 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ndisgen&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ndisgen</span>(8)</span></a> 可用來轉換 <span class="trademark">Windows</span>® XP 驅動程式成可在 FreeBSD 上使用的格式。由於 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ndis&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ndis</span>(4)</span></a> 驅動程式使用的是 <span class="trademark">Windows</span>® XP binary，所以只能在 <span class="trademark">i386</span>™ 及 amd64 系統上執行。<acronym class="acronym">PCI</acronym>, CardBus, <acronym class="acronym">PCMCIA</acronym> 以及 <acronym class="acronym">USB</acronym> 裝置也都有支援。</p><p>要使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ndisgen&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ndisgen</span>(8)</span></a> 需要三樣東西：</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>FreeBSD 核心原始碼。</p></li><li class="listitem"><p>一個 <code class="filename">.SYS</code> 附檔名的 <span class="trademark">Windows</span>® XP 驅動程式 Binary。</p></li><li class="listitem"><p>一個 <code class="filename">.INF</code> 附檔名的 <span class="trademark">Windows</span>® XP 驅動程式設定檔。</p></li></ol></div><p>下載供指定 <acronym class="acronym">NIC</acronym> 使用的 <code class="filename">.SYS</code> 及 <code class="filename">.INF</code> 檔。通常這些檔案可以在驅動程式 CD 或者供應商的網站上找到。以下範例會使用 <code class="filename">W32DRIVER.SYS</code> 及 <code class="filename">W32DRIVER.INF</code>。</p><p>驅動程式的位元寬度必須與 FreeBSD 的版本相符。例如 FreeBSD/i386 需要使用 <span class="trademark">Windows</span>® 32-bit 驅動程式，而 FreeBSD/amd64 則需要使用 <span class="trademark">Windows</span>® 64-bit 驅動程式。</p><p>下個步驟是編譯驅動程式 Binary 成可載入的核心模組。以 <code class="systemitem">root</code> 身份使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ndisgen&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ndisgen</span>(8)</span></a>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ndisgen <em class="replaceable"><code>/path/to/W32DRIVER.INF</code></em> <em class="replaceable"><code>/path/to/W32DRIVER.SYS</code></em></code></strong></pre><p>這個指令是互動式的，會提示輸入任何所需的額外資訊，新的核心模組會被產生在目前的目錄，使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a> 來載入新的模組：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload <em class="replaceable"><code>./W32DRIVER_SYS.ko</code></em></code></strong></pre><p>除了產生的核心模組之外，<code class="filename">ndis.ko</code> 以及 <code class="filename">if_ndis.ko</code> 也必須載入，會在任何有相依 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ndis&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ndis</span>(4)</span></a> 的模組被載入時一併自動載入。若沒有自動載入，則需使用以下指令手動載入：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload ndis</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>kldload if_ndis</code></strong></pre><p>第一個指令會載入 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ndis&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ndis</span>(4)</span></a> miniport 驅動程式包裝程式，而第二個指令會載入產生的 <acronym class="acronym">NIC</acronym> 驅動程式。</p><p>檢查 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a> 查看是否有任何載入錯誤，若一切正常，輸出結果應會如下所示：</p><pre xml:lang="en" class="screen" lang="en">ndis0: &lt;Wireless-G PCI Adapter&gt; mem 0xf4100000-0xf4101fff irq 3 at device 8.0 on pci1
ndis0: NDIS API version: 5.0
ndis0: Ethernet address: 0a:b1:2c:d3:4e:f5
ndis0: 11b rates: 1Mbps 2Mbps 5.5Mbps 11Mbps
ndis0: 11g rates: 6Mbps 9Mbps 12Mbps 18Mbps 36Mbps 48Mbps 54Mbps</pre><p>到此之後 <code class="filename">ndis0</code> 可以像任何其他 <acronym class="acronym">NIC</acronym> 設定使用。</p><p>要設定系統於開機時載入 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ndis&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ndis</span>(4)</span></a> 模組，可複製產生的模組 <code class="filename">W32DRIVER_SYS.ko</code> 到 <code class="filename">/boot/modules</code>。然後加入下行到 <code class="filename">/boot/loader.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">W32DRIVER_SYS_load="YES"</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69475128"></a>11.5.2. 設定網路卡</h3></div></div></div><a id="idp69475768" class="indexterm"></a><p>載入正確的 <acronym class="acronym">NIC</acronym> 驅動程式之後，接著需要設定介面卡，這個動作可能在安裝時已經使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bsdinstall&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bsdinstall</span>(8)</span></a> 設定過了。</p><p>要查看 <acronym class="acronym">NIC</acronym> 設定可輸入以下指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>ifconfig</code></strong>
dc0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=80008&lt;VLAN_MTU,LINKSTATE&gt;
        ether 00:a0:cc:da:da:da
        inet 192.168.1.3 netmask 0xffffff00 broadcast 192.168.1.255
        media: Ethernet autoselect (100baseTX &lt;full-duplex&gt;)
        status: active
dc1: flags=8802&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=80008&lt;VLAN_MTU,LINKSTATE&gt;
        ether 00:a0:cc:da:da:db
        inet 10.0.0.1 netmask 0xffffff00 broadcast 10.0.0.255
        media: Ethernet 10baseT/UTP
        status: no carrier
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; metric 0 mtu 16384
        options=3&lt;RXCSUM,TXCSUM&gt;
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x4
        inet6 ::1 prefixlen 128
        inet 127.0.0.1 netmask 0xff000000
        nd6 options=3&lt;PERFORMNUD,ACCEPT_RTADV&gt;</pre><p>在這個例子中列出了以下裝置：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">dc0</code>: 第一個乙太網路介面。</p></li><li class="listitem"><p><code class="filename">dc1</code>: 第二個乙太網路介面。</p></li><li class="listitem"><p><code class="filename">lo0</code>: Loopback 裝置。</p></li></ul></div><p>FreeBSD 會使用驅動程式名稱接著開機時所偵測到的介面卡順序來命名 <acronym class="acronym">NIC</acronym>。例如 <code class="filename">sis2</code> 是指在系統上使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sis&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sis</span>(4)</span></a> 驅動程式的第三個 <acronym class="acronym">NIC</acronym>。</p><p>在此例中，<code class="filename">dc0</code> 已經上線並且執行中。主要的依據有：</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="literal">UP</code> 代表介面卡已設定好並且準備就緒。</p></li><li class="listitem"><p>介面卡有網際網路 (<code class="literal">inet</code>) 位址，<code class="systemitem">192.168.1.3</code>。</p></li><li class="listitem"><p>介面卡有一個有效的子網路遮罩 (<code class="literal">netmask</code>)，其中 <code class="systemitem">0xffffff00</code> 等同於 <code class="systemitem">255.255.255.0</code>。</p></li><li class="listitem"><p>介面卡有一個有效的廣播位址，<code class="systemitem">192.168.1.255</code>。</p></li><li class="listitem"><p>介面卡 (<code class="literal">ether</code>) 的 <acronym class="acronym">MAC</acronym> 位址是 <code class="systemitem">00:a0:cc:da:da:da</code>。</p></li><li class="listitem"><p>實體媒介選擇為自動選擇模式 (<code class="literal">media: Ethernet autoselect (100baseTX &lt;full-duplex&gt;)</code>)。在本例中 <code class="filename">dc1</code> 被設定使用 <code class="literal">10baseT/UTP</code> 媒介。要取得更多有關可用的驅動程式媒介類型請參考操作手冊。</p></li><li class="listitem"><p>連結的狀態 (<code class="literal">status</code>) 為使用中 (<code class="literal">active</code>)，代表有偵測到載波信號 (Carrier Signal)。若 <code class="filename">dc1</code> 所代表的介面卡未插入乙太網路線則狀態為 <code class="literal">status: no carrier</code> 是正常的。</p></li></ol></div><p>若 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> 的輸出結果如下：</p><pre xml:lang="en" class="screen" lang="en">dc0: flags=8843&lt;BROADCAST,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	options=80008&lt;VLAN_MTU,LINKSTATE&gt;
	ether 00:a0:cc:da:da:da
	media: Ethernet autoselect (100baseTX &lt;full-duplex&gt;)
	status: active</pre><p>則代表尚未設定介面卡。</p><p>介面卡必須以 <code class="systemitem">root</code> 來設定。<acronym class="acronym">NIC</acronym> 的設定可在指令列執行 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> 來完成，但重新開機之後變會消失，除非將設定也加到 <code class="filename">/etc/rc.conf</code>。若在 LAN 中有 <acronym class="acronym">DHCP</acronym> 伺服器，則只需加入此行：</p><pre xml:lang="en" class="programlisting" lang="en">ifconfig_dc0="DHCP"</pre><p>替換 <em class="replaceable"><code>dc0</code></em> 為該系統的正確值。</p><p>加入這行之後，接著依據 <a class="xref" href="#config-network-testing" title="11.5.3. 測試與疑難排解">節 11.5.3, “測試與疑難排解”</a> 指示操作。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">若網路在安裝時已設定，可能會已經有 <acronym class="acronym">NIC</acronym> 的設定項目。在加入任何設定前請再次檢查 <code class="filename">/etc/rc.conf</code>。</p></div><p>在這個例中，沒有 <acronym class="acronym">DHCP</acronym> 伺服器，必須手動設定 <acronym class="acronym">NIC</acronym>。提每一個在系統上的 <acronym class="acronym">NIC</acronym> 加入一行設定，如此例：</p><pre xml:lang="en" class="programlisting" lang="en">ifconfig_dc0="inet 192.168.1.3 netmask 255.255.255.0"
ifconfig_dc1="inet 10.0.0.1 netmask 255.255.255.0 media 10baseT/UTP"</pre><p>替換 <code class="filename">dc0</code> 及 <code class="filename">dc1</code> 以及 <acronym class="acronym">IP</acronym> 位址資訊為系統的正確值。請參考驅動程式的操作手冊、<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> 以及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> 取得更多有關可用的選項及 <code class="filename">/etc/rc.conf</code> 的語法。</p><p>若網路沒有使用 <acronym class="acronym">DNS</acronym>，則編輯 <code class="filename">/etc/hosts</code> 加入 <acronym class="acronym">LAN</acronym> 上主機的名稱與 <acronym class="acronym">IP</acronym> 位址。要取得更多資訊請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hosts&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hosts</span>(5)</span></a> 及 <code class="filename">/usr/share/examples/etc/hosts</code>。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">若沒有 <acronym class="acronym">DHCP</acronym> 伺服器且需要存取網際網路，那麼需要手動設定預設閘道及名稱伺服器：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>echo 'defaultrouter="<em class="replaceable"><code>your_default_router</code></em>"' &gt;&gt; /etc/rc.conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>echo 'nameserver <em class="replaceable"><code>your_DNS_server</code></em>' &gt;&gt; /etc/resolv.conf</code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="config-network-testing"></a>11.5.3. 測試與疑難排解</h3></div></div></div><p>必要的變更儲存到 <code class="filename">/etc/rc.conf</code> 之後，需要重新啟動系統來測試網路設定並檢查系統重新啟動是否沒有任何設定錯誤。或者使用這個指令將設定套用到網路系統：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service netif restart</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">若預設的通訊閘已設定於 <code class="filename">/etc/rc.conf</code> 也同樣要下這個指令：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service routing restart</code></strong></pre></div><p>網路系統重新啟動後，便可接著測試 <acronym class="acronym">NIC</acronym>。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69555768"></a>11.5.3.1. 測試乙太網路卡</h4></div></div></div><a id="idp69998776" class="indexterm"></a><p>要檢查乙太網路卡是否已正確設定可 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a> 介面卡自己，然後 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a> 其他於 <acronym class="acronym">LAN</acronym> 上的主機：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>ping -c5 192.168.1.3</code></strong>
PING 192.168.1.3 (192.168.1.3): 56 data bytes
64 bytes from 192.168.1.3: icmp_seq=0 ttl=64 time=0.082 ms
64 bytes from 192.168.1.3: icmp_seq=1 ttl=64 time=0.074 ms
64 bytes from 192.168.1.3: icmp_seq=2 ttl=64 time=0.076 ms
64 bytes from 192.168.1.3: icmp_seq=3 ttl=64 time=0.108 ms
64 bytes from 192.168.1.3: icmp_seq=4 ttl=64 time=0.076 ms

--- 192.168.1.3 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 0.074/0.083/0.108/0.013 ms</pre><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>ping -c5 192.168.1.2</code></strong>
PING 192.168.1.2 (192.168.1.2): 56 data bytes
64 bytes from 192.168.1.2: icmp_seq=0 ttl=64 time=0.726 ms
64 bytes from 192.168.1.2: icmp_seq=1 ttl=64 time=0.766 ms
64 bytes from 192.168.1.2: icmp_seq=2 ttl=64 time=0.700 ms
64 bytes from 192.168.1.2: icmp_seq=3 ttl=64 time=0.747 ms
64 bytes from 192.168.1.2: icmp_seq=4 ttl=64 time=0.704 ms

--- 192.168.1.2 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 0.700/0.729/0.766/0.025 ms</pre><p>要測試網路解析，可使用主機名稱來替代 <acronym class="acronym">IP</acronym> 位址。若在網路上沒有 <acronym class="acronym">DNS</acronym> 伺服器則必須先設定 <code class="filename">/etc/hosts</code>，若主機尚未設定到 <code class="filename">/etc/hosts</code> 中，則需編輯 <code class="filename">/etc/hosts</code> 加入 <acronym class="acronym">LAN</acronym> 上主機的名稱及 <acronym class="acronym">IP</acronym> 位址，要取得更多資訊請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hosts&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hosts</span>(5)</span></a> 及 <code class="filename">/usr/share/examples/etc/hosts</code>。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70017208"></a>11.5.3.2. 疑難排解</h4></div></div></div><a id="idp70017848" class="indexterm"></a><p>在排除硬體及軟體設定問題時，要先檢查幾件簡單的事。網路線插上了沒？網路的服務都正確設定了嗎？防火牆設定是否正確？FreeBSD 是否支援該 <acronym class="acronym">NIC</acronym>？在回報問題之前，永遠要先檢查 Hardware Notes、更新 FreeBSD 到最新的 STABLE 版本、檢查郵遞論壇封存記錄以及上網查詢。</p><p>若介面卡可以運作，但是效能很差，請閱讀 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tuning&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tuning</span>(7)</span></a>，同時也要檢查網路設定，因為不正確的網路設定會造成連線速度緩慢。</p><p>部份使用者會遇到一次或兩次 <span class="errorname">device timeout</span> 的訊息，在對某些介面卡是正常的。若訊息持續發生或很煩的，請確認是否有與其他的裝置衝突，再次檢查網路線，或考慮使用其他介面卡。</p><p>要解決 <span class="errorname">watchdog timeout</span> 錯誤，先檢查網路線。許多介面卡需要使用支援 Bus Mastering 的 <acronym class="acronym">PCI</acronym> 插槽，在一些舊型的主機板，只會有一個 <acronym class="acronym">PCI</acronym> 插槽支援，通常是插槽 0。檢查 <acronym class="acronym">NIC</acronym> 以及主機板說明文件來確定是否為此問題。</p><p>若系統無法路由傳送封包到目標主機則會出現 <span class="errorname">No route to host</span> 訊息，這可能是因為沒有指定預設的路由或未插上網路線。請檢查 <code class="command">netstat -rn</code> 的輸出並確認有一個有效的路由可連線至主機，若沒有，請閱讀 <a class="xref" href="#network-routing" title="31.2. 通訊閘與路由">節 31.2, “通訊閘與路由”</a>。</p><p>造成 <span class="errorname">ping: sendto: Permission denied</span>  錯誤訊息的原因通常是防火牆設定錯誤。若在 FreeBSD 上有開啟防火牆，但卻未定義任何的規則，預設的原則是拒絕所有傳輸，即使是用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a>。請參考 <a class="xref" href="#firewalls" title="章 30. 防火牆">章 30, <em>防火牆</em></a> 取得更多資訊。</p><p>有時介面卡的效能很差或低於平均值，在這種情況可嘗試設定媒介選擇模式由 <code class="literal">autoselect</code> 更改為正確的媒介選項，雖然這在大部份硬體可運作，但可能無法解決問題，同樣的，檢查所有網路設定並參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tuning&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tuning</span>(7)</span></a>。</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-virtual-hosts"></a>11.6. 虛擬主機</h2></div></div></div><a id="idp70030136" class="indexterm"></a><a id="idp70030776" class="indexterm"></a><p>FreeBSD 最常見的用途之一就是虛擬網站代管，即以一台伺服器在網路上扮演多台伺服器，這可以透過指定多個網路位置到一個網路介面來做到。</p><p>一個網路介面會有一個 <span class="quote">“<span class="quote">真實 (Real)</span>”</span> 位址且可以有許多個 <span class="quote">“<span class="quote">別名 (Alias)</span>”</span> 位址。一般會在 <code class="filename">/etc/rc.conf</code> 中放置別名項目來增加別名，如下例：</p><pre xml:lang="en" class="programlisting" lang="en">ifconfig_fxp0_alias0="inet xxx.xxx.xxx.xxx netmask xxx.xxx.xxx.xxx"</pre><p>別名項目必須以 <code class="literal">alias<em class="replaceable"><code>0</code></em></code> 開頭，使用連續數字例如 <code class="literal">alias0</code>, <code class="literal">alias1</code> 以此類推，設定程序會在第一個遇到缺號的地方中止。</p><p>要注意別名網路遮罩 (Netmask) 的計算，使用的介面必須至少有一個正確的填寫網路遮罩的位址，而其他所有在此網路中的位址則必須使用全部 <code class="literal">1</code> 的網路遮罩，可用 <code class="systemitem">255.255.255.255</code> 或 <code class="systemitem">0xffffffff</code> 來表示。</p><p>舉例來說，有一個 <code class="filename">fxp0</code> 介面連結到兩個網路：<code class="systemitem">10.1.1.0</code> 使用網路遮罩 <code class="systemitem">255.255.255.0</code> 以及 <code class="systemitem">202.0.75.16</code> 使用網路遮罩 <code class="systemitem">255.255.255.240</code>。而系統將要設定使用範圍 <code class="systemitem">10.1.1.1</code> 到 <code class="systemitem">10.1.1.5</code> 以及 <code class="systemitem">202.0.75.17</code> 到 <code class="systemitem">202.0.75.20</code>。在指定的網路範圍中只有第一個位址應使用真實的網路遮罩，其餘 (<code class="systemitem">10.1.1.2</code> 到 <code class="systemitem">10.1.1.5</code> 及 <code class="systemitem">202.0.75.18</code> 到 <code class="systemitem">202.0.75.20</code>) 則必須設定使用 <code class="systemitem">255.255.255.255</code> 的遮罩。</p><p>在此情境下正確設定網路介面的方式如下 <code class="filename">/etc/rc.conf</code> 中的項目：</p><pre xml:lang="en" class="programlisting" lang="en">ifconfig_fxp0="inet 10.1.1.1 netmask 255.255.255.0"
ifconfig_fxp0_alias0="inet 10.1.1.2 netmask 255.255.255.255"
ifconfig_fxp0_alias1="inet 10.1.1.3 netmask 255.255.255.255"
ifconfig_fxp0_alias2="inet 10.1.1.4 netmask 255.255.255.255"
ifconfig_fxp0_alias3="inet 10.1.1.5 netmask 255.255.255.255"
ifconfig_fxp0_alias4="inet 202.0.75.17 netmask 255.255.255.240"
ifconfig_fxp0_alias5="inet 202.0.75.18 netmask 255.255.255.255"
ifconfig_fxp0_alias6="inet 202.0.75.19 netmask 255.255.255.255"
ifconfig_fxp0_alias7="inet 202.0.75.20 netmask 255.255.255.255"</pre><p>有一種更簡單的方式可以表達這些設定，便是使用以空白分隔的 <acronym class="acronym">IP</acronym> 位址清單。只有第一個位址會使用指定的子網路遮罩，其他的位址則會使用 <code class="literal">255.255.255.255</code> 的子網路遮罩。</p><pre xml:lang="en" class="programlisting" lang="en">ifconfig_fxp0_aliases="inet 10.1.1.1-5/24 inet 202.0.75.17-20/28"</pre></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-syslog"></a>11.7. 設定系統日誌</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Niclas</span> <span class="surname">Zeising</span></span>. </span></div></div></div><a id="idp69416888" class="indexterm"></a><a id="idp69417784" class="indexterm"></a><a id="idp69418680" class="indexterm"></a><p>產生與讀取系統日誌對系統管理來說是一件非常重要的事，在系統日誌中的資訊可以用來偵測硬體與軟體的問題，同樣也可以偵測應用程式與系統設定的錯誤。這些資訊在安全性稽查與事件回應也同樣扮演了重要的角色，大多數系統 Daemon 與應用程式都會產生日誌項目。</p><p>FreeBSD 提供了一個系統日誌程式 <span class="application">syslogd</span> 用來管理日誌。預設 <span class="application">syslogd</span> 會與系統開機時啟動。這可使用在 <code class="filename">/etc/rc.conf</code> 中的變數 <code class="literal">syslogd_enable</code> 來控制。而且有數個應用程式參數可在 <code class="filename">/etc/rc.conf</code> 使用 <code class="literal">syslogd_flags</code> 來設定。請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a> 來取得更多可用參數的資訊。</p><p>此章節會介紹如何設定 FreeBSD 系統日誌程式來做本地與遠端日誌並且介紹如何執行日誌翻轉 (Log rotation) 與日誌管理。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69424312"></a>11.7.1. 設定本地日誌</h3></div></div></div><a id="idp69424952" class="indexterm"></a><p>設定檔 <code class="filename">/etc/syslog.conf</code> 控制 <span class="application">syslogd</span> 收到日誌項目時要做的事情，有數個參數可以用來控制接收到事件時的處理方式。<em class="firstterm">設施 (facility)</em> 用來描述記錄產生訊息的子系統 (subsystem)，如核心或者 Daemon，而 <em class="firstterm">層級 (level)</em> 用來描述所發生的事件嚴重性。也可以依據應用程式所發出的訊息及產生日誌事件機器的主機名稱來決定後續處置的動作。</p><p>此設定檔中一行代表一個動作，每一行的格式皆為一個選擇器欄位 (Selector field) 接著一個動作欄位 (Action field)。選擇器欄位的格式為 <em class="replaceable"><code>facility.level</code></em> 可以用來比對來自 <em class="replaceable"><code>facility</code></em> 於層級 <em class="replaceable"><code>level</code></em> 或更高層的日誌訊息，也可以在層級前加入選擇性的比對旗標來更確切的指定記錄的內容。同樣一個動作可以使用多個選擇器欄位並使用分號 (<code class="literal">;</code>) 來分隔。用 <code class="literal">*</code> 可以比對任何東西。動作欄位可用來指定傳送日誌訊息的目標，如一個檔案或遠端日誌主機。範例為以下為 FreeBSD 預設的 <code class="filename">syslog.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en"># <span class="phrase">$FreeBSD$</span>
#
#       Spaces ARE valid field separators in this file. However,
#       other *nix-like systems still insist on using tabs as field
#       separators. If you are sharing this file between systems, you
#       may want to use only tabs as field separators here.
#       Consult the syslog.conf(5) manpage.
*.err;kern.warning;auth.notice;mail.crit                /dev/console
*.notice;authpriv.none;kern.debug;lpr.info;mail.crit;news.err   /var/log/messages
security.*                                      /var/log/security
auth.info;authpriv.info                         /var/log/auth.log
mail.info                                       /var/log/maillog
lpr.info                                        /var/log/lpd-errs
ftp.info                                        /var/log/xferlog
cron.*                                          /var/log/cron
!-devd
*.=debug                                        /var/log/debug.log
*.emerg                                         *
# uncomment this to log all writes to /dev/console to /var/log/console.log
#console.info                                   /var/log/console.log
# uncomment this to enable logging of all log messages to /var/log/all.log
# touch /var/log/all.log and chmod it to mode 600 before it will work
#*.*                                            /var/log/all.log
# uncomment this to enable logging to a remote loghost named loghost
#*.*                                            @loghost
# uncomment these if you're running inn
# news.crit                                     /var/log/news/news.crit
# news.err                                      /var/log/news/news.err
# news.notice                                   /var/log/news/news.notice
# Uncomment this if you wish to see messages produced by devd
# !devd
# *.&gt;=info
!ppp
*.*                                             /var/log/ppp.log
!*</pre><p>在這個範例中：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>第 8 行會找出所有符合 <code class="literal">err</code> 或以上層級的訊息，還有 <code class="literal">kern.warning</code>, <code class="literal">auth.notice</code> 與 <code class="literal">mail.crit</code> 的訊息，然後將這些日誌訊息傳送到 Console (<code class="filename">/dev/console</code>)。</p></li><li class="listitem"><p>第 12 行會找出所有符合 <code class="literal">mail</code> 設施中於 <code class="literal">info</code> 或以上層級的訊息，並記錄訊息至 <code class="filename">/var/log/maillog</code>。</p></li><li class="listitem"><p>第 17 行使用了比較旗標 (<code class="literal">=</code>) 來只找出符合 <code class="literal">debug</code> 層級的訊息，並將訊息記錄至 <code class="filename">/var/log/debug.log</code>。</p></li><li class="listitem"><p>第 33 行是指定程式的範例用法。這可以讓在該行以下的規則只對指定的程式生效。在此例中，只有由 <span class="application">ppp</span> 產生的訊息會被記錄到 <code class="filename">/var/log/ppp.log</code>。</p></li></ul></div><p>所以可用層級從最嚴重到最不嚴重的順序為 <code class="literal">emerg</code>, <code class="literal">alert</code>, <code class="literal">crit</code>, <code class="literal">err</code>, <code class="literal">warning</code>, <code class="literal">notice</code>, <code class="literal">info</code> 以及 <code class="literal">debug</code>。</p><p>設施 (facility) 則無特定順序，可用的有 <code class="literal">auth</code>, <code class="literal">authpriv</code>, <code class="literal">console</code>, <code class="literal">cron</code>, <code class="literal">daemon</code>, <code class="literal">ftp</code>, <code class="literal">kern</code>, <code class="literal">lpr</code>, <code class="literal">mail</code>, <code class="literal">mark</code>, <code class="literal">news</code>, <code class="literal">security</code>, <code class="literal">syslog</code>, <code class="literal">user</code>, <code class="literal">uucp</code> 及 <code class="literal">local0</code> 到 <code class="literal">local7</code>。要注意在其他作業系統的設施可能會不同。</p><p>要記錄所有所有 <code class="literal">notice</code> 與以上層級的訊息到 <code class="filename">/var/log/daemon.log</code> 可加入以下項目：</p><pre xml:lang="en" class="programlisting" lang="en">daemon.notice                                        /var/log/daemon.log</pre><p>要取得更多有關不同的層級與設施的資訊請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslog&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslog</span>(3)</span></a> 及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a>。要取得更多有關 <code class="filename">/etc/syslog.conf</code>、語法以及更多進階用法範例的資訊請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslog.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslog.conf</span>(5)</span></a>。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70118968"></a>11.7.2. 日誌管理與翻轉</h3></div></div></div><a id="idp70119608" class="indexterm"></a><a id="idp70120248" class="indexterm"></a><a id="idp70120888" class="indexterm"></a><a id="idp70133816" class="indexterm"></a><p>日誌檔案會成長的非常快速，這會消耗磁碟空間並且會更難在日誌中找到有用的資訊，日誌管理便是為了嘗試減緩這種問題。在 FreeBSD 可以使用 <span class="application">newsyslog</span> 來管理日誌檔案，這個內建的程式會定期翻轉 (Rotate) 與壓縮日誌檔案，並且可選擇性的建立遺失的日誌檔案並在日誌檔案被移動位置時通知程式。日誌檔案可能會由 <span class="application">syslogd</span> 產生或由其他任何會產生日誌檔案的程式。<span class="application">newsyslog</span> 正常會由 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> 來執行，它並非一個系統 Daemon，預設會每個小時執行一次。</p><p><span class="application">newsyslog</span> 會讀取其設定檔 <code class="filename">/etc/newsyslog.conf</code> 來決定其要採取的動作，每個要由 <span class="application">newsyslog</span> 所管理的日誌檔案會在此設定檔中設定一行，每一行要說明檔案的擁有者、權限、何時要翻轉該檔案、選用的日誌翻轉旗標，如：壓縮，以及日誌翻轉時要通知的程式。以下為 FreeBSD 的預設設定：</p><pre xml:lang="en" class="programlisting" lang="en"># configuration file for newsyslog
# <span class="phrase">$FreeBSD$</span>
#
# Entries which do not specify the '/pid_file' field will cause the
# syslogd process to be signalled when that log file is rotated.  This
# action is only appropriate for log files which are written to by the
# syslogd process (ie, files listed in /etc/syslog.conf).  If there
# is no process which needs to be signalled when a given log file is
# rotated, then the entry for that file should include the 'N' flag.
#
# The 'flags' field is one or more of the letters: BCDGJNUXZ or a '-'.
#
# Note: some sites will want to select more restrictive protections than the
# defaults.  In particular, it may be desirable to switch many of the 644
# entries to 640 or 600.  For example, some sites will consider the
# contents of maillog, messages, and lpd-errs to be confidential.  In the
# future, these defaults may change to more conservative ones.
#
# logfilename          [owner:group]    mode count size when  flags [/pid_file] [sig_num]
/var/log/all.log                        600  7     *    @T00  J
/var/log/amd.log                        644  7     100  *     J
/var/log/auth.log                       600  7     100  @0101T JC
/var/log/console.log                    600  5     100  *     J
/var/log/cron                           600  3     100  *     JC
/var/log/daily.log                      640  7     *    @T00  JN
/var/log/debug.log                      600  7     100  *     JC
/var/log/kerberos.log                   600  7     100  *     J
/var/log/lpd-errs                       644  7     100  *     JC
/var/log/maillog                        640  7     *    @T00  JC
/var/log/messages                       644  5     100  @0101T JC
/var/log/monthly.log                    640  12    *    $M1D0 JN
/var/log/pflog                          600  3     100  *     JB    /var/run/pflogd.pid
/var/log/ppp.log        root:network    640  3     100  *     JC
/var/log/devd.log                       644  3     100  *     JC
/var/log/security                       600  10    100  *     JC
/var/log/sendmail.st                    640  10    *    168   B
/var/log/utx.log                        644  3     *    @01T05 B
/var/log/weekly.log                     640  5     1    $W6D0 JN
/var/log/xferlog                        600  7     100  *     JC</pre><p>每一行的開始為要翻轉的日誌名稱、接著是供翻轉與新建檔案使用的擁有者及群組 (選填)。<code class="literal">mode</code> 欄位可設定日誌檔案的權限，<code class="literal">count</code> 代表要保留多少個翻轉過的日誌檔案，而 <code class="literal">size</code> 與 <code class="literal">when</code> 欄位會告訴 <span class="application">newsyslog</span> 何時要翻轉該檔案。日誌檔案會在當其檔案超過 <code class="literal">size</code> 欄位的大小或已超過 <code class="literal">when</code> 欄位指定的時間時翻轉，可使用星號 (<code class="literal">*</code>) 忽略該欄位。<em class="replaceable"><code>flags</code></em> 欄位可以給予進階的參數，例如：如何壓縮翻轉後檔案或建立遺失的日誌檔案。最後兩個欄位皆為選填，可指定程序的程序 ID (<acronym class="acronym">PID</acronym>) 檔名稱以及檔案翻轉後要傳送給該程序的信號 (Signal) 編號。</p><p>要取的更多有關所有欄位、可用的旗標及如何指定翻轉時間，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=newsyslog.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">newsyslog.conf</span>(5)</span></a>。由於 <span class="application">newsyslog</span> 是由 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> 執行，因此無法比其在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> 中所排定的時間間距內更頻繁的執行翻轉檔案。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-syslogd"></a>11.7.3. 設定遠端日誌</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p xml:lang="en" lang="en">Monitoring the log files of multiple hosts can become
	unwieldy as the number of systems increases.  Configuring
	centralized logging can reduce some of the administrative
	burden of log file administration.</p><p xml:lang="en" lang="en">In FreeBSD, centralized log file aggregation, merging, and
	rotation can be configured using
	<span class="application">syslogd</span> and
	<span class="application">newsyslog</span>.  This section
	demonstrates an example configuration, where host
	<code class="systemitem">A</code>, named <code class="systemitem">logserv.example.com</code>, will
	collect logging information for the local network.  Host
	<code class="systemitem">B</code>, named <code class="systemitem">logclient.example.com</code>,
	will be configured to pass logging information to the logging
	server.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70203320"></a>11.7.3.1. 日誌伺服器設定</h4></div></div></div><p xml:lang="en" lang="en">A log server is a system that has been configured to
	  accept logging information from other hosts.  Before
	  configuring a log server, check the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">If there is a firewall between the logging server
	      and any logging clients, ensure that the firewall
	      ruleset allows <acronym class="acronym">UDP</acronym> port 514 for both
	      the clients and the server.</p></li><li class="listitem"><p xml:lang="en" lang="en">The logging server and all client  machines must
	      have forward and reverse entries in the local
	      <acronym class="acronym">DNS</acronym>.  If the network does not have a
	      <acronym class="acronym">DNS</acronym> server, create entries in each
	      system's <code class="filename">/etc/hosts</code>.  Proper name
	      resolution is required so that log entries are not
	      rejected by the logging server.</p></li></ul></div><p xml:lang="en" lang="en">On the log server, edit
	  <code class="filename">/etc/syslog.conf</code> to specify the name of
	  the client to receive log entries from, the logging facility
	  to be used, and the name of the log to store the host's log
	  entries.  This example adds the hostname of
	  <code class="systemitem">B</code>, logs all facilities, and stores
	  the log entries in
	  <code class="filename">/var/log/logclient.log</code>.</p><div class="example"><a id="idp70213944"></a><div class="example-title">範例 11.1. 日誌伺服器設定範例</div><div class="example-contents"><pre xml:lang="en" class="programlisting" lang="en">+logclient.example.com
*.*     /var/log/logclient.log</pre></div></div><br class="example-break" /><p xml:lang="en" lang="en">When adding multiple log clients, add a similar two-line
	  entry for each client.  More information about the available
	  facilities may be found in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslog.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslog.conf</span>(5)</span></a>.</p><p xml:lang="en" lang="en">Next, configure
	  <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">syslogd_enable="YES"
syslogd_flags="-a logclient.example.com -v -v"</pre><p xml:lang="en" lang="en">The first entry starts
	  <span class="application">syslogd</span> at system boot.  The
	  second entry allows log entries from the specified client.
	  The <code class="option">-v -v</code> increases the verbosity of logged
	  messages.  This is useful for tweaking facilities as
	  administrators are able to see what type of messages are
	  being logged under each facility.</p><p xml:lang="en" lang="en">Multiple <code class="option">-a</code> options may be specified to
	  allow logging from multiple clients.  <acronym class="acronym">IP</acronym>
	  addresses and whole netblocks may also be specified.  Refer
	  to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a> for a full list of possible
	  options.</p><p xml:lang="en" lang="en">Finally, create the log file:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>touch /var/log/logclient.log</code></strong></pre><p xml:lang="en" lang="en">At this point, <span class="application">syslogd</span> should
	  be restarted and verified:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service syslogd restart</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>pgrep syslog</code></strong></pre><p xml:lang="en" lang="en">If a <acronym class="acronym">PID</acronym> is returned, the server
	  restarted successfully, and client configuration can begin.
	  If the server did not restart, consult
	  <code class="filename">/var/log/messages</code> for the error.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70239160"></a>11.7.3.2. 日誌客戶端設定</h4></div></div></div><p xml:lang="en" lang="en">A logging client sends log entries to a logging server
	  on the network.  The client also keeps a local copy of its
	  own logs.</p><p xml:lang="en" lang="en">Once a logging server has been configured, edit
	  <code class="filename">/etc/rc.conf</code> on the logging
	  client:</p><pre xml:lang="en" class="programlisting" lang="en">syslogd_enable="YES"
syslogd_flags="-s -v -v"</pre><p xml:lang="en" lang="en">The first entry enables
	  <span class="application">syslogd</span> on boot up.  The second
	  entry prevents logs from being accepted by this client from
	  other hosts (<code class="option">-s</code>) and increases the
	  verbosity of logged messages.</p><p xml:lang="en" lang="en">Next, define the logging server in the client's
	  <code class="filename">/etc/syslog.conf</code>.  In this example, all
	  logged facilities are sent to a remote system, denoted by
	  the <code class="literal">@</code> symbol, with the specified
	  hostname:</p><pre xml:lang="en" class="programlisting" lang="en">*.*		@logserv.example.com</pre><p xml:lang="en" lang="en">After saving the edit, restart
	  <span class="application">syslogd</span> for the changes to take
	  effect:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service syslogd restart</code></strong></pre><p xml:lang="en" lang="en">To test that log messages are being sent across the
	  network, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=logger&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">logger</span>(1)</span></a> on the client to send a message
	  to <span class="application">syslogd</span>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>logger "<em class="replaceable"><code>Test message from logclient</code></em>"</code></strong></pre><p xml:lang="en" lang="en">This message should now exist both in
	  <code class="filename">/var/log/messages</code> on the client and
	  <code class="filename">/var/log/logclient.log</code> on the log
	  server.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70251192"></a>11.7.3.3. 日誌伺服器除錯</h4></div></div></div><p xml:lang="en" lang="en">If no messages are being received on the log server, the
	  cause is most likely a network connectivity issue, a
	  hostname resolution issue, or a typo in a configuration
	  file.  To isolate the cause, ensure that both the logging
	  server and the logging client are able to
	  <code class="command">ping</code> each other using the hostname
	  specified in their <code class="filename">/etc/rc.conf</code>.  If
	  this fails, check the network cabling, the firewall ruleset,
	  and the hostname entries in the <acronym class="acronym">DNS</acronym>
	  server or <code class="filename">/etc/hosts</code> on both the
	  logging server and clients.  Repeat until the
	  <code class="command">ping</code> is successful from both
	  hosts.</p><p xml:lang="en" lang="en">If the <code class="command">ping</code> succeeds on both hosts
	  but log messages are still not being received, temporarily
	  increase logging verbosity to narrow down the configuration
	  issue.  In the following example,
	  <code class="filename">/var/log/logclient.log</code> on the logging
	  server is empty and <code class="filename">/var/log/messages</code>
	  on the logging client does not indicate a reason for the
	  failure.  To increase debugging output, edit the
	  <code class="literal">syslogd_flags</code> entry on the logging server
	  and issue a restart:</p><pre xml:lang="en" class="programlisting" lang="en">syslogd_flags="-d -a logclient.example.com -v -v"</pre><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service syslogd restart</code></strong></pre><p xml:lang="en" lang="en">Debugging data similar to the following will flash on
	  the console immediately after the restart:</p><pre xml:lang="en" class="screen" lang="en">logmsg: pri 56, flags 4, from logserv.example.com, msg syslogd: restart
syslogd: restarted
logmsg: pri 6, flags 4, from logserv.example.com, msg syslogd: kernel boot file is /boot/kernel/kernel
Logging to FILE /var/log/messages
syslogd: kernel boot file is /boot/kernel/kernel
cvthname(192.168.1.10)
validate: dgram from IP 192.168.1.10, port 514, name logclient.example.com;
rejected in rule 0 due to name mismatch.</pre><p xml:lang="en" lang="en">In this example, the log messages are being rejected due
	  to a typo which results in a hostname mismatch.  The
	  client's hostname should be <code class="literal">logclient</code>,
	  not <code class="literal">logclien</code>.  Fix the typo, issue a
	  restart, and verify the results:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service syslogd restart</code></strong>
logmsg: pri 56, flags 4, from logserv.example.com, msg syslogd: restart
syslogd: restarted
logmsg: pri 6, flags 4, from logserv.example.com, msg syslogd: kernel boot file is /boot/kernel/kernel
syslogd: kernel boot file is /boot/kernel/kernel
logmsg: pri 166, flags 17, from logserv.example.com,
msg Dec 10 20:55:02 &lt;syslog.err&gt; logserv.example.com syslogd: exiting on signal 2
cvthname(192.168.1.10)
validate: dgram from IP 192.168.1.10, port 514, name logclient.example.com;
accepted in rule 0.
logmsg: pri 15, flags 0, from logclient.example.com, msg Dec 11 02:01:28 trhodes: Test message 2
Logging to FILE /var/log/logclient.log
Logging to FILE /var/log/messages</pre><p xml:lang="en" lang="en">At this point, the messages are being properly received
	  and placed in the correct file.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70266168"></a>11.7.3.4. 安全注意事項</h4></div></div></div><p xml:lang="en" lang="en">As with any network service, security requirements
	  should be considered before implementing a logging server.
	  Log files may contain sensitive data about services enabled
	  on the local host, user accounts, and configuration data.
	  Network data sent from the client to the server will not be
	  encrypted or password protected.  If a need for encryption
	  exists, consider using <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/stunnel/pkg-descr">security/stunnel</a>,
	  which will transmit the logging data over an encrypted
	  tunnel.</p><p xml:lang="en" lang="en">Local security is also an issue.  Log files are not
	  encrypted during use or after log rotation.  Local users may
	  access log files to gain additional insight into system
	  configuration.  Setting proper permissions on log files is
	  critical.  The built-in log rotator,
	  <span class="application">newsyslog</span>, supports setting
	  permissions on newly created and rotated log files.  Setting
	  log files to mode <code class="literal">600</code> should prevent
	  unwanted access by local users.  Refer to
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=newsyslog.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">newsyslog.conf</span>(5)</span></a> for additional information.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-configfiles"></a>11.8. 設定檔</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70279096"></a>11.8.1. <code class="filename">/etc</code> 配置</h3></div></div></div><p>有數個目錄中儲存著設定資訊，這些目錄有：</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><tbody><tr><td xml:lang="en" lang="en"><code class="filename">/etc</code></td><td>通用系統特定的設定資訊。</td></tr><tr><td xml:lang="en" lang="en"><code class="filename">/etc/defaults</code></td><td>系統設定檔的預設版本。</td></tr><tr><td xml:lang="en" lang="en"><code class="filename">/etc/mail</code></td><td><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sendmail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sendmail</span>(8)</span></a> 額外的設定以及其他 <acronym class="acronym">MTA</acronym> 設定檔。</td></tr><tr><td xml:lang="en" lang="en"><code class="filename">/etc/ppp</code></td><td>user- 及 kernel-ppp 程式的設定。</td></tr><tr><td xml:lang="en" lang="en"><code class="filename">/usr/local/etc</code></td><td>已安裝應用程式的設定檔，可能會有以應用程式區分的子目錄。</td></tr><tr><td xml:lang="en" lang="en"><code class="filename">/usr/local/etc/rc.d</code></td><td>已安裝應用程式的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> Script。</td></tr><tr><td xml:lang="en" lang="en"><code class="filename">/var/db</code></td><td>自動產生的系統特定資料庫檔案，例如套件資料庫以及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=locate&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">locate</span>(1)</span></a> 資料庫。</td></tr></tbody></table></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70303416"></a>11.8.2. 主機名稱</h3></div></div></div><a id="idp70304056" class="indexterm"></a><a id="idp70304696" class="indexterm"></a><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70305336"></a>11.8.2.1. <code class="filename">/etc/resolv.conf</code></h4></div></div></div><a id="idp70306232" class="indexterm"></a><p>FreeBSD 要如何存取網際網路網域名稱系統 (Internet Domain Name System, <acronym class="acronym">DNS</acronym>) 是由 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=resolv.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">resolv.conf</span>(5)</span></a> 來控制。</p><p><code class="filename">/etc/resolv.conf</code> 中最常用的項目為：</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><tbody><tr><td xml:lang="en" lang="en"><code class="literal">nameserver</code></td><td>解析程式 (Resolver) 要查詢的名稱伺服器 <acronym class="acronym">IP</acronym> 位置，這些伺服器會依所列的順序來查詢，最多可以有三個。</td></tr><tr><td xml:lang="en" lang="en"><code class="literal">search</code></td><td>主機名稱查詢使用的搜尋清單。這通常會使用本機主機名稱所在的網域。</td></tr><tr><td xml:lang="en" lang="en"><code class="literal">domain</code></td><td>本地網域名稱。</td></tr></tbody></table></div><p>典型的 <code class="filename">/etc/resolv.conf</code> 會如下：</p><pre xml:lang="en" class="programlisting" lang="en">search example.com
nameserver 147.11.1.11
nameserver 147.11.100.30</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="literal">search</code> 與 <code class="literal">domain</code> 選項應擇一使用。</p></div><p>當使用 <acronym class="acronym">DHCP</acronym> 時，<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dhclient&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dhclient</span>(8)</span></a> 通常會使用從 <acronym class="acronym">DHCP</acronym> 伺服器所接收到的資訊覆寫 <code class="filename">/etc/resolv.conf</code>。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70337848"></a>11.8.2.2. <code class="filename">/etc/hosts</code></h4></div></div></div><a id="idp70338744" class="indexterm"></a><p><code class="filename">/etc/hosts</code> 是簡單的文字資料庫，會與 <acronym class="acronym">DNS</acronym> 及 <acronym class="acronym">NIS</acronym> 一併使用來提供主機名稱與 <acronym class="acronym">IP</acronym> 位址的對應。可將透過 <acronym class="acronym">LAN</acronym> 所連結的在地電腦項目加入到這個檔案做最簡單的命名，來替代設定一個 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=named&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">named</span>(8)</span></a> 伺服器。除此之外 <code class="filename">/etc/hosts</code> 可以用來提供本地的網際網路名稱記錄，來減少常用名稱向外部 <acronym class="acronym">DNS</acronym> 伺服器查詢的需求。</p><pre xml:lang="en" class="programlisting" lang="en"># <span class="phrase">$FreeBSD$</span>
#
#
# Host Database
#
# This file should contain the addresses and aliases for local hosts that
# share this file.  Replace 'my.domain' below with the domainname of your
# machine.
#
# In the presence of the domain name service or NIS, this file may
# not be consulted at all; see /etc/nsswitch.conf for the resolution order.
#
#
::1			localhost localhost.my.domain
127.0.0.1		localhost localhost.my.domain
#
# Imaginary network.
#10.0.0.2		myname.my.domain myname
#10.0.0.3		myfriend.my.domain myfriend
#
# According to RFC 1918, you can use the following IP networks for
# private nets which will never be connected to the Internet:
#
#	10.0.0.0	-   10.255.255.255
#	172.16.0.0	-   172.31.255.255
#	192.168.0.0	-   192.168.255.255
#
# In case you want to be able to connect to the Internet, you need
# real official assigned numbers.  Do not try to invent your own network
# numbers but instead get one from your network provider (if any) or
# from your regional registry (ARIN, APNIC, LACNIC, RIPE NCC, or AfriNIC.)
#</pre><p><code class="filename">/etc/hosts</code> 的格式如下：</p><pre xml:lang="en" class="programlisting" lang="en">[Internet address] [official hostname] [alias1] [alias2] ...</pre><p>例如：</p><pre xml:lang="en" class="programlisting" lang="en">10.0.0.1 myRealHostname.example.com myRealHostname foobar1 foobar2</pre><p>請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hosts&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hosts</span>(5)</span></a> 取得更多資訊。</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-sysctl"></a>11.9. 使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> 調校</h2></div></div></div><a id="idp70349240" class="indexterm"></a><a id="idp70349880" class="indexterm"></a><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> 可用來更改執行中的 FreeBSD 系統，這包含許多 <acronym class="acronym">TCP/IP</acronym> 堆疊及虛擬記憶體系統的進階選項，讓有經驗的系統管理者能夠簡單的提升效能。有超過五百個系統變數可以使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> 來讀取與設定。</p><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> 主要提供兩個功能：讀取與修改系統設定。</p><p>檢視所有可讀取的變數：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>sysctl -a</code></strong></pre><p>要讀取特定變數只要指定其名稱：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>sysctl kern.maxproc</code></strong>
kern.maxproc: 1044</pre><p>要設定特定變數可使用 <em class="replaceable"><code>variable</code></em>=<em class="replaceable"><code>value</code></em> 語法：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysctl kern.maxfiles=5000</code></strong>
kern.maxfiles: 2088 -&gt; 5000</pre><p>sysctl 的設定值通常為字串、數字或布林值，其中布林值的 <code class="literal">1</code> 代表是，<code class="literal">0</code> 代表否。</p><p>要在每次機器開機時自動設定一些變數可將其加入到 <code class="filename">/etc/sysctl.conf</code>。要取得更多的資訊請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl.conf</span>(5)</span></a> 及 <a class="xref" href="#configtuning-sysctlconf" title="11.9.1. sysctl.conf">節 11.9.1, “<code class="filename">sysctl.conf</code>”</a>。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="configtuning-sysctlconf"></a>11.9.1. <code class="filename">sysctl.conf</code></h3></div></div></div><a id="idp70368056" class="indexterm"></a><a id="idp70368696" class="indexterm"></a><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> 的設定檔於 <code class="filename">/etc/sysctl.conf</code>，內容很像 <code class="filename">/etc/rc.conf</code>，設定數值使用 <code class="literal">variable=value</code> 格式。指定的數值會在系統進入多使用者模式時設定，但並非所有變數皆可在此模式設定。</p><p>例如，要關閉嚴重信號 (Fatal signal) 中止的記錄並避免使用者看到其他使用者所執行的程序，可加入以下設定到 <code class="filename">/etc/sysctl.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en"># Do not log fatal signal exits (e.g., sig 11)
kern.logsigexit=0

# Prevent users from seeing information about processes that
# are being run under another UID.
security.bsd.see_other_uids=0</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sysctl-readonly"></a>11.9.2. 唯讀 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a></h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p>在有些情況可能會需要修改唯讀的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> 數值，而這會需要重新啟動系統。</p><p>例如，某些筆電型號的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cardbus&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cardbus</span>(4)</span></a> 裝置無法偵測到記憶體範圍而且會失效並有類似以下的錯誤：</p><pre xml:lang="en" class="screen" lang="en">cbb0: Could not map register memory
device_probe_and_attach: cbb0 attach returned 12</pre><p>這個修正需要修改唯讀的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> 設定。加入 <code class="option">hw.pci.allow_unsupported_io_range=1</code> 到 <code class="filename">/boot/loader.conf</code> 然後重新啟動。現在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cardbus&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cardbus</span>(4)</span></a> 應可正常運作。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-disk"></a>11.10. 調校磁碟</h2></div></div></div><p>接下來的章節會討論在磁碟裝置上各種可調校的機制與選項。在大多數案例中，有使用機械元件的硬碟，如 <acronym class="acronym">SCSI</acronym> 磁碟機，會成為導致整體系統效能低下的瓶頸。雖然已經有不使用機械元件的磁碟機解決方案，如，固態硬碟，但使用機械元件的磁碟機短期內並不會消失。在調校磁碟時，建議可以利用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=iostat&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">iostat</span>(8)</span></a> 指令的功能來測試各種對系統的變更，這個指令可讓使用者取得系統 <acronym class="acronym">IO</acronym> 相關的有用資訊。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70401976"></a>11.10.1. Sysctl 變數</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70402616"></a>11.10.1.1. <code class="varname">vfs.vmiodirenable</code></h4></div></div></div><a id="idp70403512" class="indexterm"></a><p xml:lang="en" lang="en">The <code class="varname">vfs.vmiodirenable</code> <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	  variable
	  may be set to either <code class="literal">0</code> (off) or
	  <code class="literal">1</code> (on).  It is set to
	  <code class="literal">1</code> by default.  This variable controls
	  how directories are cached by the system.  Most directories
	  are small, using just a single fragment (typically 1 K)
	  in the file system and typically 512 bytes in the
	  buffer cache.  With this variable turned off, the buffer
	  cache will only cache a fixed number of directories, even
	  if the system has a huge amount of memory.  When turned on,
	  this <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> allows the buffer cache to use the
	  <acronym class="acronym">VM</acronym> page cache to cache the directories,
	  making all the memory available for caching directories.
	  However, the minimum in-core memory used to cache a
	  directory is the physical page size (typically 4 K)
	  rather than 512  bytes.  Keeping this option enabled
	  is recommended if the system is running any services which
	  manipulate large numbers of files.  Such services can
	  include web caches, large mail systems, and news systems.
	  Keeping this option on will generally not reduce
	  performance, even with the wasted memory, but one should
	  experiment to find out.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70408632"></a>11.10.1.2. <code class="varname">vfs.write_behind</code></h4></div></div></div><a id="idp70409528" class="indexterm"></a><p xml:lang="en" lang="en">The <code class="varname">vfs.write_behind</code> <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	  variable
	  defaults to <code class="literal">1</code> (on).  This tells the file
	  system to issue media writes as full clusters are collected,
	  which typically occurs when writing large sequential files.
	  This avoids saturating the buffer cache with dirty buffers
	  when it would not benefit I/O performance.  However, this
	  may stall processes and under certain circumstances should
	  be turned off.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70416824"></a>11.10.1.3. <code class="varname">vfs.hirunningspace</code></h4></div></div></div><a id="idp70417720" class="indexterm"></a><p xml:lang="en" lang="en">The <code class="varname">vfs.hirunningspace</code> <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	  variable determines how much outstanding write I/O may be
	  queued to disk controllers system-wide at any given
	  instance.  The default is usually sufficient, but on
	  machines with many disks, try bumping it up to four or five
	  <span class="emphasis"><em>megabytes</em></span>.  Setting too high a value
	  which exceeds the buffer cache's write threshold can lead
	  to bad clustering performance.  Do not set this value
	  arbitrarily high as higher write values may add latency to
	  reads occurring at the same time.</p><p xml:lang="en" lang="en">There are various other buffer cache and
	  <acronym class="acronym">VM</acronym> page cache related <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	  values.  Modifying these values is not recommended as the
	  <acronym class="acronym">VM</acronym> system does a good job of
	  automatically tuning itself.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70427064"></a>11.10.1.4. <code class="varname">vm.swap_idle_enabled</code></h4></div></div></div><a id="idp70427960" class="indexterm"></a><p xml:lang="en" lang="en">The <code class="varname">vm.swap_idle_enabled</code>
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variable is useful in large multi-user
	  systems with many active login users and lots of idle
	  processes.  Such systems tend to generate continuous
	  pressure on free memory reserves.  Turning this feature on
	  and tweaking the swapout hysteresis (in idle seconds) via
	  <code class="varname">vm.swap_idle_threshold1</code> and
	  <code class="varname">vm.swap_idle_threshold2</code> depresses the
	  priority of memory pages associated with idle processes more
	  quickly then the normal pageout algorithm.  This gives a
	  helping hand to the pageout daemon.  Only turn this option
	  on if needed, because the tradeoff is essentially pre-page
	  memory sooner rather than later which eats more swap and
	  disk bandwidth.  In a small system this option will have a
	  determinable effect, but in a large system that is already
	  doing moderate paging, this option allows the
	  <acronym class="acronym">VM</acronym> system to stage whole processes into
	  and out of memory easily.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70431928"></a>11.10.1.5. <code class="varname">hw.ata.wc</code></h4></div></div></div><a id="idp70432824" class="indexterm"></a><p xml:lang="en" lang="en">Turning off <acronym class="acronym">IDE</acronym> write caching reduces
	  write bandwidth to <acronym class="acronym">IDE</acronym> disks, but may
	  sometimes be necessary due to data consistency issues
	  introduced by hard drive vendors.  The problem is that
	  some <acronym class="acronym">IDE</acronym> drives lie about when a write
	  completes.  With <acronym class="acronym">IDE</acronym> write caching
	  turned on, <acronym class="acronym">IDE</acronym> hard drives write data
	  to disk out of order and will sometimes delay writing some
	  blocks indefinitely when under heavy disk load.  A crash or
	  power failure may cause serious file system corruption.
	  Check the default on the system by observing the
	  <code class="varname">hw.ata.wc</code> <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variable.  If
	  <acronym class="acronym">IDE</acronym> write caching is turned off, one can
	  set this read-only variable to
	  <code class="literal">1</code> in
	  <code class="filename">/boot/loader.conf</code> in order to enable
	  it at boot time.</p><p xml:lang="en" lang="en">For more information, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ata&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ata</span>(4)</span></a>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70456376"></a>11.10.1.6. <code class="literal">SCSI_DELAY</code>
	  (<code class="varname">kern.cam.scsi_delay</code>)</h4></div></div></div><a id="idp70154680" class="indexterm"></a><a id="idp70155704" class="indexterm"></a><p xml:lang="en" lang="en">The <code class="literal">SCSI_DELAY</code> kernel configuration
	  option may be used to reduce system boot times.  The
	  defaults are fairly high and can be responsible for
	  <code class="literal">15</code> seconds of delay in the boot process.
	  Reducing it to <code class="literal">5</code> seconds usually works
	  with modern drives.  The
	  <code class="varname">kern.cam.scsi_delay</code> boot time tunable
	  should be used.  The tunable and kernel configuration
	  option accept values in terms of
	  <span class="emphasis"><em>milliseconds</em></span> and
	  <span class="emphasis"><em>not</em></span>
	  <span class="emphasis"><em>seconds</em></span>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="soft-updates"></a>11.10.2. 軟更新</h3></div></div></div><a id="idp70161080" class="indexterm"></a><a id="idp70161720" class="indexterm"></a><p xml:lang="en" lang="en">To fine-tune a file system, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a>.  This
	program has many different options.  To toggle Soft Updates
	on and off, use:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>tunefs -n enable /filesystem</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>tunefs -n disable /filesystem</code></strong></pre><p xml:lang="en" lang="en">A file system cannot be modified with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a> while
	it is mounted.  A good time to enable Soft Updates is before
	any partitions have been mounted, in single-user mode.</p><p xml:lang="en" lang="en">Soft Updates is recommended for <acronym class="acronym">UFS</acronym>
	file systems as it drastically improves meta-data performance,
	mainly file creation and deletion, through the use of a memory
	cache.  There are two downsides to Soft Updates to be aware
	of.  First, Soft Updates guarantee file system consistency
	in the case of a crash, but could easily be several seconds
	or even a minute behind updating the physical disk.  If the
	system crashes, unwritten data may be lost.  Secondly, Soft
	Updates delay the freeing of file system blocks.  If the
	root file system is almost full, performing a major update,
	such as <code class="command">make installworld</code>, can cause the
	file system to run out of space and the update to fail.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70459448"></a>11.10.2.1. 有關軟更新的更多詳細資訊</h4></div></div></div><a id="idp70460088" class="indexterm"></a><p xml:lang="en" lang="en">Meta-data updates are updates to non-content data like
	  inodes or directories.  There are two traditional approaches
	  to writing a file system's meta-data back to disk.</p><p xml:lang="en" lang="en">Historically, the default behavior was to write out
	  meta-data updates synchronously.  If a directory changed,
	  the system waited until the change was actually written to
	  disk.  The file data buffers (file contents) were passed
	  through the buffer cache and backed up to disk later on
	  asynchronously.  The advantage of this implementation is
	  that it operates safely.  If there is a failure during an
	  update, meta-data is always in a consistent state.  A
	  file is either created completely or not at all.  If the
	  data blocks of a file did not find their way out of the
	  buffer cache onto the disk by the time of the crash,
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a> recognizes this and repairs the file system
	  by setting the file length to <code class="literal">0</code>.
	  Additionally, the implementation is clear and simple.  The
	  disadvantage is that meta-data changes are slow.  For
	  example, <code class="command">rm -r</code> touches all the files in a
	  directory sequentially, but each directory change will be
	  written synchronously to the disk.  This includes updates to
	  the directory itself, to the inode table, and possibly to
	  indirect blocks allocated by the file.  Similar
	  considerations apply for unrolling large hierarchies using
	  <code class="command">tar -x</code>.</p><p xml:lang="en" lang="en">The second approach is to use asynchronous meta-data
	  updates.  This is the default for a <acronym class="acronym">UFS</acronym>
	  file system mounted with <code class="command">mount -o async</code>.
	  Since all meta-data updates are also passed through the
	  buffer cache, they will be intermixed with the updates of
	  the file content data.  The advantage of this
	  implementation is there is no need to wait until each
	  meta-data update has been written to disk, so all operations
	  which cause huge amounts of meta-data updates work much
	  faster than in the synchronous case.  This implementation
	  is still clear and simple, so there is a low risk for bugs
	  creeping into the code.  The disadvantage is that there is
	  no guarantee for a consistent state of the file system.
	  If there is a failure during an operation that updated
	  large amounts of meta-data, like a power failure or someone
	  pressing the reset button, the file system will be left
	  in an unpredictable state.  There is no opportunity to
	  examine the state of the file system when the system comes
	  up again as the data blocks of a file could already have
	  been written to the disk while the updates of the inode
	  table or the associated directory were not.  It is
	  impossible to implement a <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a> which is able to
	  clean up the resulting chaos because the necessary
	  information is not available on the disk.  If the file
	  system has been damaged beyond repair, the only choice
	  is to reformat it and restore from backup.</p><p xml:lang="en" lang="en">The usual solution for this problem is to implement
	  <span class="emphasis"><em>dirty region logging</em></span>, which is also
	  referred to as <span class="emphasis"><em>journaling</em></span>.
	  Meta-data updates are still written synchronously, but only
	  into a small region of the disk.  Later on, they are moved
	  to their proper location.  Because the logging area is a
	  small, contiguous region on the disk, there are no long
	  distances for the disk heads to move, even during heavy
	  operations, so these operations are quicker than synchronous
	  updates.  Additionally, the complexity of the implementation
	  is limited, so the risk of bugs being present is low.  A
	  disadvantage is that all meta-data is written twice, once
	  into the logging region and once to the proper location, so
	  performance <span class="quote">“<span class="quote">pessimization</span>”</span> might result.  On
	  the other hand, in case of a crash, all pending meta-data
	  operations can be either quickly rolled back or completed
	  from the logging area after the system comes up again,
	  resulting in a fast file system startup.</p><p xml:lang="en" lang="en">Kirk McKusick, the developer of Berkeley
	  <acronym class="acronym">FFS</acronym>, solved this problem with Soft
	  Updates.  All pending meta-data updates are kept in memory
	  and written out to disk in a sorted sequence
	  (<span class="quote">“<span class="quote">ordered meta-data updates</span>”</span>).  This has the
	  effect that, in case of heavy meta-data operations, later
	  updates to an item <span class="quote">“<span class="quote">catch</span>”</span> the earlier ones
	  which are still in memory and have not already been written
	  to disk.  All operations are generally performed in memory
	  before the update is written to disk and the data blocks are
	  sorted according to their position so that they will not be
	  on the disk ahead of their meta-data.  If the system
	  crashes, an implicit <span class="quote">“<span class="quote">log rewind</span>”</span> causes all
	  operations which were not written to the disk appear as if
	  they never happened.  A consistent file system state is
	  maintained that appears to be the one of 30 to 60 seconds
	  earlier.  The algorithm used guarantees that all resources
	  in use are marked as such in their blocks and inodes.
	  After a crash, the only resource allocation error that
	  occurs is that resources are marked as <span class="quote">“<span class="quote">used</span>”</span>
	  which are actually <span class="quote">“<span class="quote">free</span>”</span>.  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a>
	  recognizes this situation, and frees the resources that
	  are no longer used.  It is safe to ignore the dirty state
	  of the file system after a crash by forcibly mounting it
	  with <code class="command">mount -f</code>.  In order to free
	  resources that may be unused, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a> needs to be run
	  at a later time.  This is the idea behind the
	  <span class="emphasis"><em>background <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a></em></span>: at system
	  startup time, only a <span class="emphasis"><em>snapshot</em></span> of the
	  file system is recorded and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a> is run afterwards.
	  All file systems can then be mounted
	  <span class="quote">“<span class="quote">dirty</span>”</span>, so the system startup proceeds in
	  multi-user mode.  Then, background <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a> is
	  scheduled for all file systems where this is required, to
	  free resources that may be unused.  File systems that do
	  not use Soft Updates still need the usual foreground
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a>.</p><p xml:lang="en" lang="en">The advantage is that meta-data operations are nearly
	  as fast as asynchronous updates and are faster than
	  <span class="emphasis"><em>logging</em></span>, which has to write the
	  meta-data twice.  The disadvantages are the complexity of
	  the code, a higher memory consumption, and some
	  idiosyncrasies.  After a crash, the state of the file
	  system appears to be somewhat <span class="quote">“<span class="quote">older</span>”</span>.  In
	  situations where the standard synchronous approach would
	  have caused some zero-length files to remain after the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a>, these files do not exist at all with Soft
	  Updates because neither the meta-data nor the file contents
	  have been written to disk.  Disk space is not released until
	  the updates have been written to disk, which may take place
	  some time after running <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rm&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rm</span>(1)</span></a>.  This may cause problems
	  when installing large amounts of data on a file system
	  that does not have enough free space to hold all the files
	  twice.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-kernel-limits"></a>11.11. 調校核心限制</h2></div></div></div><a id="idp70485176" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="file-process-limits"></a>11.11.1. 檔案/程序限制</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="kern-maxfiles"></a>11.11.1.1. <code class="varname">kern.maxfiles</code></h4></div></div></div><a id="idp70488248" class="indexterm"></a><p xml:lang="en" lang="en">The <code class="varname">kern.maxfiles</code> <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	  variable can be raised or lowered based upon system
	  requirements.  This variable indicates the maximum number
	  of file descriptors on the system.  When the file descriptor
	  table is full, <span class="errorname">file: table is full</span>
	  will show up repeatedly in the system message buffer, which
	  can be viewed using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a>.</p><p xml:lang="en" lang="en">Each open file, socket, or fifo uses one file
	  descriptor.  A large-scale production server may easily
	  require many thousands of file descriptors, depending on the
	  kind and number of services running concurrently.</p><p xml:lang="en" lang="en">In older FreeBSD releases, the default value of
	  <code class="varname">kern.maxfiles</code> is derived from
	  <code class="option">maxusers</code> in the kernel configuration file.
	  <code class="varname">kern.maxfiles</code> grows proportionally to the
	  value of <code class="option">maxusers</code>.  When compiling a custom
	  kernel, consider setting this kernel configuration option
	  according to the use of the system.  From this number, the
	  kernel is given most of its pre-defined limits.  Even though
	  a production machine may not have 256 concurrent users, the
	  resources needed may be similar to a high-scale web
	  server.</p><p xml:lang="en" lang="en">The read-only <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variable
	  <code class="varname">kern.maxusers</code> is automatically sized at
	  boot based on the amount of memory available in the system,
	  and may be determined at run-time by inspecting the value
	  of <code class="varname">kern.maxusers</code>.  Some systems require
	  larger or smaller values of
	  <code class="varname">kern.maxusers</code> and values of
	  <code class="literal">64</code>, <code class="literal">128</code>, and
	  <code class="literal">256</code> are not uncommon.  Going above
	  <code class="literal">256</code> is not recommended  unless a huge
	  number of file descriptors is needed.  Many of the tunable
	  values set to their defaults by
	  <code class="varname">kern.maxusers</code> may be individually
	  overridden at boot-time or run-time in
	  <code class="filename">/boot/loader.conf</code>.  Refer to
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader.conf</span>(5)</span></a> and
	  <code class="filename">/boot/defaults/loader.conf</code> for more
	  details and some hints.</p><p xml:lang="en" lang="en">In older releases, the system will auto-tune
	  <code class="literal">maxusers</code> if it is set to
	  <code class="literal">0</code>.
	  <a href="#ftn.idp70518072" class="footnote" id="idp70518072"><sup class="footnote">[2]</sup></a>.  When
	  setting this option, set <code class="literal">maxusers</code> to
	  at least <code class="literal">4</code>, especially if the system
	  runs <span class="application">Xorg</span> or is used to
	  compile software.  The most important table set by
	  <code class="literal">maxusers</code> is the maximum number of
	  processes, which is set to
	  <code class="literal">20 + 16 * maxusers</code>.  If
	  <code class="literal">maxusers</code> is set to <code class="literal">1</code>,
	  there can only be
	  <code class="literal">36</code> simultaneous processes, including
	  the <code class="literal">18</code> or so that the system starts up
	  at boot time and the <code class="literal">15</code> or so used by
	  <span class="application">Xorg</span>.  Even a simple task like
	  reading a manual page will start up nine processes to
	  filter, decompress, and view it.  Setting
	  <code class="literal">maxusers</code> to <code class="literal">64</code> allows
	  up to <code class="literal">1044</code> simultaneous processes, which
	  should be enough for nearly all uses.  If, however, the
	  <span class="errortype">proc table full</span> error is displayed
	  when trying to start another program, or a server is
	  running with a large number of simultaneous users, increase
	  the number and rebuild.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><code class="literal">maxusers</code> does
	    <span class="emphasis"><em>not</em></span> limit the number of users which
	    can log into the machine.  It instead sets various table
	    sizes to reasonable values considering the maximum number
	    of users on the system and how many processes each user
	    will be running.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70551992"></a>11.11.1.2. <code class="varname">kern.ipc.soacceptqueue</code></h4></div></div></div><a id="idp70552888" class="indexterm"></a><p xml:lang="en" lang="en">The <code class="varname">kern.ipc.soacceptqueue</code>
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variable limits the size of the listen queue
	  for accepting new <code class="literal">TCP</code> connections.  The
	  default value of <code class="literal">128</code> is typically too low
	  for robust handling of new connections on a heavily loaded
	  web server.  For such environments, it is recommended to
	  increase this value to <code class="literal">1024</code> or higher.  A
	  service such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sendmail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sendmail</span>(8)</span></a>, or
	  <span class="application">Apache</span> may itself limit the
	  listen queue size, but will often have a directive in its
	  configuration file to adjust the queue size.  Large listen
	  queues do a better job of avoiding Denial of Service
	  (<acronym class="acronym">DoS</acronym>) attacks.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="nmbclusters"></a>11.11.2. 網路限制</h3></div></div></div><p xml:lang="en" lang="en">The <code class="literal">NMBCLUSTERS</code> kernel configuration
	option dictates the amount of network Mbufs available to the
	system.  A heavily-trafficked server with a low number of
	Mbufs will hinder performance.  Each cluster represents
	approximately 2 K of memory, so a value of
	<code class="literal">1024</code> represents <code class="literal">2</code>
	megabytes of kernel memory reserved for network buffers.  A
	simple calculation can be done to figure out how many are
	needed.  A web server which maxes out at
	<code class="literal">1000</code> simultaneous connections where each
	connection uses a 6 K receive and 16 K send buffer,
	requires approximately 32 MB worth of network buffers
	to cover the web server.  A good rule of thumb is to multiply
	by <code class="literal">2</code>, so
	2x32 MB / 2 KB =
	64 MB / 2 kB =
	<code class="literal">32768</code>.  Values between
	<code class="literal">4096</code> and <code class="literal">32768</code> are
	recommended for machines with greater amounts of memory.
	Never specify an arbitrarily high value for this parameter
	as it could lead to a boot time crash.  To observe network
	cluster usage, use <code class="option">-m</code> with
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=netstat&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">netstat</span>(1)</span></a>.</p><p xml:lang="en" lang="en">The <code class="varname">kern.ipc.nmbclusters</code> loader tunable
	should be used to tune this at boot time.  Only older versions
	of FreeBSD will require the use of the
	<code class="literal">NMBCLUSTERS</code> kernel <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=config&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">config</span>(8)</span></a>
	option.</p><p xml:lang="en" lang="en">For busy servers that make extensive use of the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sendfile&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sendfile</span>(2)</span></a> system call, it may be necessary to increase
	the number of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sendfile&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sendfile</span>(2)</span></a> buffers via the
	<code class="literal">NSFBUFS</code> kernel configuration option or by
	setting its value in <code class="filename">/boot/loader.conf</code>
	(see <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a> for details).  A common indicator that
	this parameter needs to be adjusted is when processes are seen
	in the <code class="literal">sfbufa</code> state.  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	variable <code class="varname">kern.ipc.nsfbufs</code> is read-only.
	This parameter nominally scales with
	<code class="varname">kern.maxusers</code>, however it may be necessary
	to tune accordingly.</p><div xmlns="" class="important"><h3 class="admontitle">重要: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Even though a socket has been marked as non-blocking,
	  calling <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sendfile&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sendfile</span>(2)</span></a> on the non-blocking socket may
	  result in the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sendfile&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sendfile</span>(2)</span></a> call blocking until enough
	  <code class="literal">struct sf_buf</code>'s are made
	  available.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70591032"></a>11.11.2.1. <code class="varname">net.inet.ip.portrange.*</code></h4></div></div></div><a id="idp70591928" class="indexterm"></a><p xml:lang="en" lang="en">The <code class="varname">net.inet.ip.portrange.*</code>
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variables control the port number ranges
	  automatically bound to <code class="literal">TCP</code> and
	  <code class="literal">UDP</code> sockets.  There are three ranges: a
	  low range, a default range, and a high range.  Most network
	  programs use the default range which is controlled by
	  <code class="varname">net.inet.ip.portrange.first</code> and
	  <code class="varname">net.inet.ip.portrange.last</code>, which default
	  to <code class="literal">1024</code> and <code class="literal">5000</code>,
	  respectively.  Bound port ranges are used for outgoing
	  connections and it is possible to run the system out of
	  ports under certain circumstances.  This most commonly
	  occurs when running a heavily loaded web proxy.  The port
	  range is not an issue when running a server which handles
	  mainly incoming connections, such as a web server, or has
	  a limited number of outgoing connections, such as a mail
	  relay.  For situations where there is a shortage of ports,
	  it is recommended to increase
	  <code class="varname">net.inet.ip.portrange.last</code> modestly.  A
	  value of <code class="literal">10000</code>, <code class="literal">20000</code>
	  or <code class="literal">30000</code> may be reasonable.  Consider
	  firewall effects when changing the port range.  Some
	  firewalls may block large ranges of ports, usually
	  low-numbered ports, and expect systems to use higher ranges
	  of ports for outgoing connections.  For this reason, it
	  is not recommended that the value of
	  <code class="varname">net.inet.ip.portrange.first</code> be
	  lowered.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70598840"></a>11.11.2.2. <code class="literal">TCP</code> 頻寬延遲乘積</h4></div></div></div><a id="idp70599736" class="indexterm"></a><p xml:lang="en" lang="en"><code class="literal">TCP</code> bandwidth delay product limiting
	  can be enabled by setting the
	  <code class="varname">net.inet.tcp.inflight.enable</code>
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variable to <code class="literal">1</code>.  This
	  instructs the system to attempt to calculate the bandwidth
	  delay product for each connection and limit the amount of
	  data queued to the network to just the amount required to
	  maintain optimum throughput.</p><p xml:lang="en" lang="en">This feature is useful when serving data over modems,
	  Gigabit Ethernet, high speed <code class="literal">WAN</code> links,
	  or any other link with a high bandwidth delay product,
	  especially when also using window scaling or when a large
	  send window has been configured.  When enabling this option,
	  also set <code class="varname">net.inet.tcp.inflight.debug</code> to
	  <code class="literal">0</code> to disable debugging.  For production
	  use, setting <code class="varname">net.inet.tcp.inflight.min</code>
	  to at least <code class="literal">6144</code> may be beneficial.
	  Setting high minimums may effectively disable bandwidth
	  limiting, depending on the link.  The limiting feature
	  reduces the amount of data built up in intermediate route
	  and switch packet queues and reduces the amount of data
	  built up in the local host's interface queue.  With fewer
	  queued packets, interactive connections, especially over
	  slow modems, will operate with lower
	  <span class="emphasis"><em>Round Trip Times</em></span>.  This feature only
	  effects server side data transmission such as uploading.
	  It has no effect on data reception or downloading.</p><p xml:lang="en" lang="en">Adjusting <code class="varname">net.inet.tcp.inflight.stab</code>
	  is <span class="emphasis"><em>not</em></span> recommended.  This parameter
	  defaults to <code class="literal">20</code>, representing 2 maximal
	  packets added to the bandwidth delay product window
	  calculation.  The additional window is required to stabilize
	  the algorithm and improve responsiveness to changing
	  conditions, but it can also result in higher <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a>
	  times over slow links, though still much lower than without
	  the inflight algorithm.  In such cases, try reducing this
	  parameter to <code class="literal">15</code>, <code class="literal">10</code>,
	  or <code class="literal">5</code> and reducing
	  <code class="varname">net.inet.tcp.inflight.min</code> to a value such
	  as <code class="literal">3500</code> to get the desired effect.
	  Reducing these parameters should be done as a last resort
	  only.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70611128"></a>11.11.3. 虛擬記憶體</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70611768"></a>11.11.3.1. <code class="varname">kern.maxvnodes</code></h4></div></div></div><p xml:lang="en" lang="en">A vnode is the internal representation of a file or
	  directory.  Increasing the number of vnodes available to
	  the operating system reduces disk I/O.  Normally, this is
	  handled by the operating system and does not need to be
	  changed.  In some cases where disk I/O is a bottleneck and
	  the system is running out of vnodes, this setting needs
	  to be increased.  The amount of inactive and free
	  <acronym class="acronym">RAM</acronym> will need to be taken into
	  account.</p><p xml:lang="en" lang="en">To see the current number of vnodes in use:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysctl vfs.numvnodes</code></strong>
vfs.numvnodes: 91349</pre><p xml:lang="en" lang="en">To see the maximum vnodes:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysctl kern.maxvnodes</code></strong>
kern.maxvnodes: 100000</pre><p xml:lang="en" lang="en">If the current vnode usage is near the maximum, try
	  increasing <code class="varname">kern.maxvnodes</code> by a value of
	  <code class="literal">1000</code>.  Keep an eye on the number of
	  <code class="varname">vfs.numvnodes</code>.  If it climbs up to the
	  maximum again, <code class="varname">kern.maxvnodes</code> will need
	  to be increased further.  Otherwise, a shift in memory
	  usage as reported by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a> should be visible and
	  more memory should be active.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="adding-swap-space"></a>11.12. 增加交換空間</h2></div></div></div><p>有時系統會需要更多的交換 (Swap) 空間，本章節會介紹兩種增加交換空間的方式：一種是在既有的分割區或新的硬碟增加交換空間，另一種則是在既有的分割區中建立一個交換檔。</p><p>要取得更多有關如何加密交換空間的資訊、有那些可用的選項以及為何要做加密，可參考 <a class="xref" href="#swap-encrypting" title="17.13. 交換空間加密">節 17.13, “交換空間加密”</a>。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="new-drive-swap"></a>11.12.1. 使用新硬碟或既有分割區增加交換空間</h3></div></div></div><p>在新的磁碟上增加交換空間比起使用既有硬碟上的分割區會有較佳的效率。設定分割區與硬碟在 <a class="xref" href="#disks-adding" title="17.2. 加入磁碟">節 17.2, “加入磁碟”</a> 中有說明，另外 <a class="xref" href="#configtuning-initial" title="2.6.1. 規劃分割區配置">節 2.6.1, “規劃分割區配置”</a> 會討論到分割區的配置與交換分割區大小需考量的事項。</p><p>使用 <code class="command">swapon</code> 來增加交換分割區到系統，例：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>swapon <em class="replaceable"><code>/dev/ada1s1b</code></em></code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">可以使用任何尚未掛載過、甚至已經有內含資料的分割區做為交換空間，但在含有資料的分割區上使用 <code class="command">swapon</code> 會覆寫並清除該分割區上所有的資料，請在執行 <code class="command">swapon</code> 之前確認真的要使用該分割區增加交換空間。</p></div><p>要在開機時自動加入此交換分割區，可加入以下項目到 <code class="filename">/etc/fstab</code>：</p><pre xml:lang="en" class="programlisting" lang="en"><em class="replaceable"><code>/dev/ada1s1b</code></em>	none	swap	sw	0	0</pre><p>請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a> 來取得在 <code class="filename">/etc/fstab</code> 中項目的說明。更多有關 <code class="command">swapon</code> 的資訊 可以在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=swapon&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">swapon</span>(8)</span></a> 找到。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="create-swapfile"></a>11.12.2. 建立交換檔</h3></div></div></div><p>以下例子會建立一個 64M 的交換檔於 <code class="filename">/usr/swap0</code> 來替代使用分割區建立交換空間。</p><p>使用交換檔開啟交換空間前需要在核心編譯或載入 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a> 所需的模組，請參考 <a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a> 了解有關編譯自訂核心的資訊。</p><div class="example"><a id="swapfile-10-and-later"></a><div class="example-title">範例 11.2. 建立交換檔於 FreeBSD 10.<em class="replaceable"><code>X</code></em> 及以後版本</div><div class="example-contents"><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>建立交換檔：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=<em class="replaceable"><code>/usr/swap0</code></em> bs=1m count=<em class="replaceable"><code>64</code></em></code></strong></pre></li><li class="step"><p>在新檔案設定適當的權限：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>chmod 0600 <em class="replaceable"><code>/usr/swap0</code></em></code></strong></pre></li><li class="step"><p>加入行到 <code class="filename">/etc/fstab</code> 以讓系統知道交換檔的資訊：</p><pre xml:lang="en" class="programlisting" lang="en">md99	none	swap	sw,file=/usr/swap0,late	0	0</pre><p>已使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a> 裝置的 <code class="filename">md99</code>，保留較低的裝置編號供互動操作時使用。</p></li><li class="step"><p>交換空間會於系統啟動時增加。若要立即增加交換空間，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=swapon&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">swapon</span>(8)</span></a>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>swapon -aL</code></strong></pre></li></ol></div></div></div><br class="example-break" /><div class="example"><a id="swapfile-9-and-earlier"></a><div class="example-title">範例 11.3. 建立交換檔於 FreeBSD 9.<em class="replaceable"><code>X</code></em> 及先前版本</div><div class="example-contents"><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>建立交換檔 <code class="filename">/usr/swap0</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=<em class="replaceable"><code>/usr/swap0</code></em> bs=1m count=<em class="replaceable"><code>64</code></em></code></strong></pre></li><li class="step"><p>設定適當的權限於 <code class="filename">/usr/swap0</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>chmod 0600 <em class="replaceable"><code>/usr/swap0</code></em></code></strong></pre></li><li class="step"><p>在 <code class="filename">/etc/rc.conf</code> 開啟交換檔：</p><pre xml:lang="en" class="programlisting" lang="en">swapfile="<em class="replaceable"><code>/usr/swap0</code></em>"   # Set to name of swap file</pre></li><li class="step"><p>交換空間會於系統啟動時增加。若要立即增加交換空間，可指定一個未使用的記憶體裝置。請參考 <a class="xref" href="#disks-virtual" title="17.9. 記憶體磁碟">節 17.9, “記憶體磁碟”</a> 取得更多有關記憶體裝置的資訊。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mdconfig -a -t vnode -f <em class="replaceable"><code>/usr/swap0</code></em> -u <em class="replaceable"><code>0</code></em> &amp;&amp; swapon /dev/md<em class="replaceable"><code>0</code></em></code></strong></pre></li></ol></div></div></div><br class="example-break" /></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="acpi-overview"></a>11.13. 電源與資源管理</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Hiten</span> <span class="surname">Pandya</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p>以有效率的方式運用硬體資源是很重要的，電源與資源管理讓作業系統可以監控系統的限制，並且在系統溫度意外升高時能夠發出警報。早期提供電源管理的規範是進階電源管理 (Advanced Power Management, <acronym class="acronym">APM</acronym>)，<acronym class="acronym">APM</acronym> 可根據系統的使用狀況來來控制電源用量。然而，使用 <acronym class="acronym">APM</acronym> 要作業系統來管理系統的電源用量和溫度屬性是困難且沒有彈性的，因為硬體是由 <acronym class="acronym">BIOS</acronym> 所管理，使用者對電源管理設定只有有限的設定性與可見性，且 <acronym class="acronym">APM</acronym> <acronym class="acronym">BIOS</acronym> 是由供應商提供且特定於某些硬體平台，而作業系統中必透過 <acronym class="acronym">APM</acronym> 驅動程式做為中介存取 <acronym class="acronym">APM</acronym> 軟體介面才能夠管理電源等級。</p><p>在 <acronym class="acronym">APM</acronym> 有四個主要的問題。第一，電源管理是由供應商特定的 <acronym class="acronym">BIOS</acronym> 來完成，與作業系統是分開的。例如，使用者可在 <acronym class="acronym">APM</acronym> <acronym class="acronym">BIOS</acronym> 設定硬碟的閒置時間值，在超過時間時 <acronym class="acronym">BIOS</acronym> 可在未徵得作業系統的同意下降低硬碟的轉速。第二，<acronym class="acronym">APM</acronym> 的邏輯是內嵌在 <acronym class="acronym">BIOS</acronym> 當中的，並且在作業系統範圍之外運作，這代表使用者只能夠透過燒錄新的韌體到 <acronym class="acronym">ROM</acronym> 來修正 <acronym class="acronym">APM</acronym> <acronym class="acronym">BIOS</acronym> 中的問題，而這樣的程序是危險的，若失敗，可能會讓系統進入無法復原的狀態。第三，<acronym class="acronym">APM</acronym> 是供應商特定的技術，這代表有許多重複的工作，在一個供應商的 <acronym class="acronym">BIOS</acronym> 找到的問題在其他的供應商卻沒有解決。最後一點，<acronym class="acronym">APM</acronym> <acronym class="acronym">BIOS</acronym> 並沒有足夠的空間來實作複雜的電源管理政策或可良好適應主機用途的程式。</p><p>Plug and Play <acronym class="acronym">BIOS</acronym> (<acronym class="acronym">PNPBIOS</acronym>) 在很多情況下並不可靠，<acronym class="acronym">PNPBIOS</acronym> 是 16 位元的技術，所以作業系統必須模擬 16 位元才能存取 <acronym class="acronym">PNPBIOS</acronym>。FreeBSD 提供了一個 <acronym class="acronym">APM</acronym> 驅動程式來做 <acronym class="acronym">APM</acronym>，應可用在 2000 年之前所製造的系統，該驅動程式的說明於 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=apm&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">apm</span>(4)</span></a>。</p><a id="idp70730808" class="indexterm"></a><a id="idp70731704" class="indexterm"></a><p><acronym class="acronym">APM</acronym> 的後繼者是進階設置與電源介面 (Advanced Configuration and Power Interface, <acronym class="acronym">ACPI</acronym>)。<acronym class="acronym">ACPI</acronym> 是一套由供應商聯盟所搛寫出的標準，提供了硬體資源與電源管理的介面，它是 <span class="emphasis"><em>作業系統直接設置與電源管理 (Operating System-directed configuration and Power Management)</em></span> 關鍵的要素，提供了作業系統更多的控制方式與彈性。</p><p>本章節將示範如何在 FreeBSD 設定 <acronym class="acronym">ACPI</acronym>，然後提供一些如何對 <acronym class="acronym">ACPI</acronym> 除錯的提示以及如何提交包含除錯資訊的問題回報，讓開發人員能夠診斷並修正 <acronym class="acronym">ACPI</acronym> 的問題。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="acpi-config"></a>11.13.1. 設定 <acronym class="acronym">ACPI</acronym></h3></div></div></div><p>在 FreeBSD <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a> 驅動程式預設會在系統開始時載入，且<span class="emphasis"><em>不</em></span>應被編譯到核心當中。這個驅動程式在開機之後無法被卸載，因為系統匯流排會使用它做各種硬體互動。雖然如此，若系統遇到問題，<acronym class="acronym">ACPI</acronym> 還是可以被關閉，在 <code class="filename">/boot/loader.conf</code> 中設定 <code class="literal">hint.acpi.0.disabled="1"</code> 之後重新開機或在載入程式提示時設定這個變數，如 <a class="xref" href="#boot-loader" title="12.2.3. 階段三">節 12.2.3, “階段三”</a> 中的說明。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml"><acronym class="acronym">ACPI</acronym> 與 <acronym class="acronym">APM</acronym> 不能同時存在且應分開使用，若有偵測到有另一個正在執行，要載入的後者將會中斷。</p></div><p><acronym class="acronym">ACPI</acronym> 可以用來讓系統進入睡眠模式，使用 <code class="command">acpiconf</code> 與 <code class="option">-s</code> 旗標再加上由 <code class="literal">1</code> 到 <code class="literal">5</code> 的數字。大多數使用者只需使用 <code class="literal">1</code> (快速待命到 <acronym class="acronym">RAM</acronym>) 或 <code class="literal">3</code> (待命到 <acronym class="acronym">RAM</acronym>)，選項 <code class="literal">5</code> 會執行軟關機 (Soft-off)，如同執行 <code class="command">halt -p</code> 一樣。</p><p>其他的選項可使用 <code class="command">sysctl</code> 來設定，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a> 以及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpiconf&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpiconf</span>(8)</span></a> 以取得更多資訊。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-comprob"></a>11.13.2. 常見問題</h3></div></div></div><a id="idp70757432" class="indexterm"></a><p xml:lang="en" lang="en"><acronym class="acronym">ACPI</acronym> is present in all modern computers
	that conform to the ia32 (x86), ia64 (Itanium), and amd64
	(<acronym class="acronym">AMD</acronym>) architectures.  The full standard has
	many features including <acronym class="acronym">CPU</acronym> performance
	management, power planes control, thermal zones, various
	battery systems, embedded controllers, and bus enumeration.
	Most systems implement less than the full standard.  For
	instance, a desktop system usually only implements bus
	enumeration while a laptop might have cooling and battery
	management support as well.  Laptops also have suspend and
	resume, with their own associated complexity.</p><p xml:lang="en" lang="en">An <acronym class="acronym">ACPI</acronym>-compliant system has various
	components.  The <acronym class="acronym">BIOS</acronym> and chipset vendors
	provide various fixed tables, such as <acronym class="acronym">FADT</acronym>,
	in memory that specify things like the <acronym class="acronym">APIC</acronym>
	map (used for <acronym class="acronym">SMP</acronym>), config registers, and
	simple configuration values.  Additionally, a bytecode table,
	the Differentiated System Description Table
	<acronym class="acronym">DSDT</acronym>, specifies a tree-like name space of
	devices and methods.</p><p xml:lang="en" lang="en">The <acronym class="acronym">ACPI</acronym> driver must parse the fixed
	tables, implement an interpreter for the bytecode, and modify
	device drivers and the kernel to accept information from the
	<acronym class="acronym">ACPI</acronym> subsystem.  For FreeBSD, <span class="trademark">Intel</span>® has
	provided an interpreter (<acronym class="acronym">ACPI-CA</acronym>) that is
	shared with <span class="trademark">Linux</span>® and NetBSD.  The path to the
	<acronym class="acronym">ACPI-CA</acronym> source code is
	<code class="filename">src/sys/contrib/dev/acpica</code>.  The glue
	code that allows <acronym class="acronym">ACPI-CA</acronym> to work on FreeBSD is
	in <code class="filename">src/sys/dev/acpica/Osd</code>.  Finally,
	drivers that implement various <acronym class="acronym">ACPI</acronym> devices
	are found in <code class="filename">src/sys/dev/acpica</code>.</p><a id="idp70767800" class="indexterm"></a><p xml:lang="en" lang="en">For <acronym class="acronym">ACPI</acronym> to work correctly, all the
	parts have to work correctly.  Here are some common problems,
	in order of frequency of appearance, and some possible
	workarounds or fixes.  If a fix does not resolve the issue,
	refer to <a class="xref" href="#ACPI-submitdebug" title="11.13.4. 取得與回報除錯資訊">節 11.13.4, “取得與回報除錯資訊”</a> for instructions
	on how to submit a bug report.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70770360"></a>11.13.2.1. 滑鼠問題</h4></div></div></div><p xml:lang="en" lang="en">In some cases, resuming from a suspend operation will
	  cause the mouse to fail.  A known work around is to add
	  <code class="literal">hint.psm.0.flags="0x3000"</code> to
	  <code class="filename">/boot/loader.conf</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70772536"></a>11.13.2.2. 待機/喚醒</h4></div></div></div><p xml:lang="en" lang="en"><acronym class="acronym">ACPI</acronym> has three suspend to
	  <acronym class="acronym">RAM</acronym> (<acronym class="acronym">STR</acronym>) states,
	  <code class="literal">S1</code>-<code class="literal">S3</code>, and one suspend
	  to disk state (<acronym class="acronym">STD</acronym>), called
	  <code class="literal">S4</code>.  <acronym class="acronym">STD</acronym> can be
	  implemented in two separate ways.  The
	  <code class="literal">S4</code><acronym class="acronym">BIOS</acronym> is a
	  <acronym class="acronym">BIOS</acronym>-assisted suspend to disk and
	  <code class="literal">S4</code><acronym class="acronym">OS</acronym> is implemented
	  entirely by the operating system.  The normal state the
	  system is in when plugged in but not powered up is
	  <span class="quote">“<span class="quote">soft off</span>”</span> (<code class="literal">S5</code>).</p><p xml:lang="en" lang="en">Use <code class="command">sysctl hw.acpi</code> to check for the
	  suspend-related items.  These example results are from a
	  Thinkpad:</p><pre xml:lang="en" class="screen" lang="en">hw.acpi.supported_sleep_state: S3 S4 S5
hw.acpi.s4bios: 0</pre><p xml:lang="en" lang="en">Use <code class="command">acpiconf -s</code> to test
	  <code class="literal">S3</code>, <code class="literal">S4</code>, and
	  <code class="literal">S5</code>.  An <code class="option">s4bios</code> of one
	  (<code class="literal">1</code>) indicates
	  <code class="literal">S4</code><acronym class="acronym">BIOS</acronym> support instead
	  of <code class="literal">S4</code> operating system support.</p><p xml:lang="en" lang="en">When testing suspend/resume, start with
	  <code class="literal">S1</code>, if supported.  This state is most
	  likely to work since it does not require much driver
	  support.  No one has implemented <code class="literal">S2</code>,
	  which is similar to <code class="literal">S1</code>.  Next, try
	  <code class="literal">S3</code>.  This is the deepest
	  <acronym class="acronym">STR</acronym> state and requires a lot of driver
	  support to properly reinitialize the hardware.</p><p xml:lang="en" lang="en">A common problem with suspend/resume is that many device
	  drivers do not save, restore, or reinitialize their
	  firmware, registers, or device memory properly.  As a first
	  attempt at debugging the problem, try:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysctl debug.bootverbose=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl debug.acpi.suspend_bounce=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>acpiconf -s 3</code></strong></pre><p xml:lang="en" lang="en">This test emulates the suspend/resume cycle of all
	  device drivers without actually going into
	  <code class="literal">S3</code> state.  In some cases, problems such
	  as losing firmware state, device watchdog time out, and
	  retrying forever, can be captured with this method.  Note
	  that the system will not really enter <code class="literal">S3</code>
	  state, which means devices may not lose power, and many
	  will work fine even if suspend/resume methods are totally
	  missing, unlike real <code class="literal">S3</code> state.</p><p xml:lang="en" lang="en">Harder cases require additional hardware, such as a
	  serial port and cable for debugging through a serial
	  console, a Firewire port and cable for using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dcons&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dcons</span>(4)</span></a>,
	  and kernel debugging skills.</p><p xml:lang="en" lang="en">To help isolate the problem, unload as many drivers as
	  possible.  If it works, narrow down which driver is the
	  problem by loading drivers until it fails again.  Typically,
	  binary drivers like <code class="filename">nvidia.ko</code>, display
	  drivers, and <acronym class="acronym">USB</acronym> will have the most
	  problems while Ethernet interfaces usually work fine.  If
	  drivers can be properly loaded and unloaded, automate this
	  by putting the appropriate commands in
	  <code class="filename">/etc/rc.suspend</code> and
	  <code class="filename">/etc/rc.resume</code>.  Try setting
	  <code class="option">hw.acpi.reset_video</code> to <code class="literal">1</code>
	  if the display is messed up after resume.  Try setting
	  longer or shorter values for
	  <code class="option">hw.acpi.sleep_delay</code> to see if that
	  helps.</p><p xml:lang="en" lang="en">Try loading a recent <span class="trademark">Linux</span>® distribution to see if
	  suspend/resume works on the same hardware.  If it works on
	  <span class="trademark">Linux</span>®, it is likely a FreeBSD driver problem.  Narrowing down
	  which driver causes the problem will assist developers in
	  fixing the problem.  Since the <acronym class="acronym">ACPI</acronym>
	  maintainers rarely maintain other drivers, such as sound
	  or <acronym class="acronym">ATA</acronym>, any driver problems should also
	  be posted to the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">freebsd-current</a> list and mailed to the
	  driver maintainer.  Advanced users can include debugging
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=printf&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">printf</span>(3)</span></a>s in a problematic driver to track down where
	  in its resume function it hangs.</p><p xml:lang="en" lang="en">Finally, try disabling <acronym class="acronym">ACPI</acronym> and
	  enabling <acronym class="acronym">APM</acronym> instead.  If suspend/resume
	  works with <acronym class="acronym">APM</acronym>, stick with
	  <acronym class="acronym">APM</acronym>, especially on older hardware
	  (pre-2000).  It took vendors a while to get
	  <acronym class="acronym">ACPI</acronym> support correct and older hardware
	  is more likely to have <acronym class="acronym">BIOS</acronym> problems with
	  <acronym class="acronym">ACPI</acronym>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70811064"></a>11.13.2.3. 系統無回應</h4></div></div></div><p xml:lang="en" lang="en">Most system hangs are a result of lost interrupts or an
	  interrupt storm.  Chipsets may have problems based on boot,
	  how the <acronym class="acronym">BIOS</acronym> configures interrupts before
	  correctness of the <acronym class="acronym">APIC</acronym>
	  (<acronym class="acronym">MADT</acronym>) table, and routing of the System
	  Control Interrupt (<acronym class="acronym">SCI</acronym>).</p><a id="idp70813752" class="indexterm"></a><p xml:lang="en" lang="en">Interrupt storms can be distinguished from lost
	  interrupts by checking the output of
	  <code class="command">vmstat -i</code> and looking at the line that
	  has <code class="literal">acpi0</code>.  If the counter is increasing
	  at more than a couple per second, there is an interrupt
	  storm.  If the system appears hung, try breaking to
	  <acronym class="acronym">DDB</acronym> (<span class="keycap"><strong>CTRL</strong></span>+<span class="keycap"><strong>ALT</strong></span>+<span class="keycap"><strong>ESC</strong></span> on console) and type
	  <code class="literal">show interrupts</code>.</p><a id="idp70818360" class="indexterm"></a><p xml:lang="en" lang="en">When dealing with interrupt problems, try disabling
	  <acronym class="acronym">APIC</acronym> support with
	  <code class="literal">hint.apic.0.disabled="1"</code> in
	  <code class="filename">/boot/loader.conf</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70821432"></a>11.13.2.4. 當機</h4></div></div></div><p xml:lang="en" lang="en">Panics are relatively rare for <acronym class="acronym">ACPI</acronym>
	  and are the top priority to be fixed.  The first step is to
	  isolate the steps to reproduce the panic, if possible, and
	  get a backtrace.  Follow the advice for enabling
	  <code class="literal">options DDB</code> and setting up a serial
	  console in <a class="xref" href="#serialconsole-ddb" title="26.6.4. 從序列線路 (Serial Line) 進入 DDB 除錯程式">節 26.6.4, “從序列線路 (Serial Line) 進入 DDB 除錯程式”</a> or setting
	  up a dump partition.  To get a backtrace in
	  <acronym class="acronym">DDB</acronym>, use <code class="literal">tr</code>.  When
	  handwriting the backtrace, get at least the last five and
	  the top five lines in the trace.</p><p xml:lang="en" lang="en">Then, try to isolate the problem by booting with
	  <acronym class="acronym">ACPI</acronym> disabled.  If that works, isolate
	  the <acronym class="acronym">ACPI</acronym> subsystem by using various
	  values of <code class="option">debug.acpi.disable</code>.  See
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a> for some examples.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70827064"></a>11.13.2.5. 系統在待機或關機後仍開機</h4></div></div></div><p xml:lang="en" lang="en">First, try setting
	  <code class="literal">hw.acpi.disable_on_poweroff="0"</code> in
	  <code class="filename">/boot/loader.conf</code>.  This keeps
	  <acronym class="acronym">ACPI</acronym> from disabling various events during
	  the shutdown process.  Some systems need this value set to
	  <code class="literal">1</code> (the default) for the same reason.
	  This usually fixes the problem of a system powering up
	  spontaneously after a suspend or poweroff.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-aslanddump"></a>11.13.2.6. BIOS 含有有問題的 Bytecode</h4></div></div></div><a id="idp70830648" class="indexterm"></a><p xml:lang="en" lang="en">Some <acronym class="acronym">BIOS</acronym> vendors provide incorrect
	  or buggy bytecode.  This is usually manifested by kernel
	  console messages like this:</p><pre xml:lang="en" class="screen" lang="en">ACPI-1287: *** Error: Method execution failed [\\_SB_.PCI0.LPC0.FIGD._STA] \\
(Node 0xc3f6d160), AE_NOT_FOUND</pre><p xml:lang="en" lang="en">Often, these problems may be resolved by updating the
	  <acronym class="acronym">BIOS</acronym> to the latest revision.  Most
	  console messages are harmless, but if there are other
	  problems, like the battery status is not working, these
	  messages are a good place to start looking for
	  problems.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70851256"></a>11.13.3. 覆蓋預設的 <acronym class="acronym">AML</acronym></h3></div></div></div><p xml:lang="en" lang="en">The <acronym class="acronym">BIOS</acronym> bytecode, known as
	<acronym class="acronym">ACPI</acronym> Machine Language
	(<acronym class="acronym">AML</acronym>), is compiled from a source language
	called <acronym class="acronym">ACPI</acronym> Source Language
	(<acronym class="acronym">ASL</acronym>).  The <acronym class="acronym">AML</acronym> is
	found in the table known as the Differentiated System
	Description Table (<acronym class="acronym">DSDT</acronym>).</p><a id="idp70855352" class="indexterm"></a><p xml:lang="en" lang="en">The goal of FreeBSD is for everyone to have working
	<acronym class="acronym">ACPI</acronym> without any user intervention.
	Workarounds are still being developed for common mistakes made
	by <acronym class="acronym">BIOS</acronym>  vendors.  The <span class="trademark">Microsoft</span>®
	interpreter (<code class="filename">acpi.sys</code> and
	<code class="filename">acpiec.sys</code>) does not strictly check for
	adherence to the standard, and thus many
	<acronym class="acronym">BIOS</acronym> vendors who only test
	<acronym class="acronym">ACPI</acronym> under <span class="trademark">Windows</span>® never fix their
	<acronym class="acronym">ASL</acronym>.  FreeBSD developers continue to identify
	and document which non-standard behavior is allowed by
	<span class="trademark">Microsoft</span>®'s interpreter and replicate it so that FreeBSD can
	work without forcing users to fix the
	<acronym class="acronym">ASL</acronym>.</p><p xml:lang="en" lang="en">To help identify buggy behavior and possibly fix it
	manually, a copy can be made of the system's
	<acronym class="acronym">ASL</acronym>.  To copy the system's
	<acronym class="acronym">ASL</acronym> to a specified file name, use
	<code class="command">acpidump</code> with <code class="option">-t</code>, to show
	the contents of the fixed tables, and <code class="option">-d</code>, to
	disassemble the <acronym class="acronym">AML</acronym>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>acpidump -td &gt; <em class="replaceable"><code>my.asl</code></em></code></strong></pre><p xml:lang="en" lang="en">Some <acronym class="acronym">AML</acronym> versions assume the user is
	running <span class="trademark">Windows</span>®.  To override this, set
	<code class="literal">hw.acpi.osname=<em class="replaceable"><code>"Windows
	  2009"</code></em></code> in
	<code class="filename">/boot/loader.conf</code>, using the most recent
	<span class="trademark">Windows</span>® version listed in the <acronym class="acronym">ASL</acronym>.</p><p xml:lang="en" lang="en">Other workarounds may require <code class="filename">my.asl</code>
	to be customized.  If this file is edited, compile the new
	<acronym class="acronym">ASL</acronym> using the following command.  Warnings
	can usually be ignored, but errors are bugs that will usually
	prevent <acronym class="acronym">ACPI</acronym> from working correctly.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>iasl -f <em class="replaceable"><code>my.asl</code></em></code></strong></pre><p xml:lang="en" lang="en">Including <code class="option">-f</code> forces creation of the
	<acronym class="acronym">AML</acronym>, even if there are errors during
	compilation.  Some errors, such as missing return statements,
	are automatically worked around by the FreeBSD
	interpreter.</p><p xml:lang="en" lang="en">The default output filename for <code class="command">iasl</code> is
	<code class="filename">DSDT.aml</code>.  Load this file instead of the
	<acronym class="acronym">BIOS</acronym>'s buggy copy, which is still present
	in flash memory, by editing
	<code class="filename">/boot/loader.conf</code> as follows:</p><pre xml:lang="en" class="programlisting" lang="en">acpi_dsdt_load="YES"
acpi_dsdt_name="/boot/DSDT.aml"</pre><p xml:lang="en" lang="en">Be sure to copy <code class="filename">DSDT.aml</code> to
	<code class="filename">/boot</code>, then reboot the system.  If this
	fixes the problem, send a <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> of the old and new
	<acronym class="acronym">ASL</acronym> to <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a> so that developers can
	work around the buggy behavior in
	<code class="filename">acpica</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-submitdebug"></a>11.13.4. 取得與回報除錯資訊</h3></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Nate</span> <span class="surname">Lawson</span></span>. </span></div><div><span class="authorgroup">With contributions from <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Peter</span> <span class="surname">Schultz</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp70948920" class="indexterm"></a><a id="idp70950200" class="indexterm"></a><p xml:lang="en" lang="en">The <acronym class="acronym">ACPI</acronym> driver has a flexible
	debugging facility.  A set of subsystems and the level of
	verbosity can be specified.  The subsystems to debug are
	specified as layers and are broken down into components
	(<code class="literal">ACPI_ALL_COMPONENTS</code>) and
	<acronym class="acronym">ACPI</acronym> hardware support
	(<code class="literal">ACPI_ALL_DRIVERS</code>).  The verbosity of
	debugging output is specified as the level and ranges from
	just report errors (<code class="literal">ACPI_LV_ERROR</code>) to
	everything (<code class="literal">ACPI_LV_VERBOSE</code>).  The level is
	a bitmask so multiple options can be set at once, separated by
	spaces.  In practice, a serial console should be used to log
	the output so it is not lost as the console message buffer
	flushes.  A full list of the individual layers and levels is
	found in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a>.</p><p xml:lang="en" lang="en">Debugging output is not enabled by default.  To enable it,
	add <code class="literal">options ACPI_DEBUG</code> to the custom kernel
	configuration file if <acronym class="acronym">ACPI</acronym> is compiled into
	the kernel.  Add <code class="literal">ACPI_DEBUG=1</code> to
	<code class="filename">/etc/make.conf</code> to enable it globally.  If
	a module is used instead of a custom kernel, recompile just
	the <code class="filename">acpi.ko</code> module as follows:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /sys/modules/acpi/acpi &amp;&amp; make clean &amp;&amp; make ACPI_DEBUG=1</code></strong></pre><p xml:lang="en" lang="en">Copy the compiled <code class="filename">acpi.ko</code> to
	<code class="filename">/boot/kernel</code> and add the desired level
	and layer to <code class="filename">/boot/loader.conf</code>.  The
	entries in this example enable debug messages for all
	<acronym class="acronym">ACPI</acronym> components and hardware drivers and
	output error messages at the least verbose level:</p><pre xml:lang="en" class="programlisting" lang="en">debug.acpi.layer="ACPI_ALL_COMPONENTS ACPI_ALL_DRIVERS"
debug.acpi.level="ACPI_LV_ERROR"</pre><p xml:lang="en" lang="en">If the required information is triggered by a specific
	event, such as a suspend and then resume, do not modify
	<code class="filename">/boot/loader.conf</code>.  Instead, use
	<code class="command">sysctl</code> to specify the layer and level after
	booting and preparing the system for the specific event.  The
	variables which can be set using <code class="command">sysctl</code> are
	named the same as the tunables in
	<code class="filename">/boot/loader.conf</code>.</p><a id="idp70996024" class="indexterm"></a><p xml:lang="en" lang="en">Once the debugging information is gathered, it can be sent
	to <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a> so that it can be used by the FreeBSD
	<acronym class="acronym">ACPI</acronym> maintainers to identify the root cause
	of the problem and to develop a solution.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Before submitting debugging information to this mailing
	  list, ensure the latest <acronym class="acronym">BIOS</acronym> version is
	  installed and, if available, the embedded controller
	  firmware version.</p></div><p xml:lang="en" lang="en">When submitting a problem report, include the following
	information:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Description of the buggy behavior, including system
	    type, model, and anything that causes the bug to appear.
	    Note as accurately as possible when the bug began
	    occurring if it is new.</p></li><li class="listitem"><p xml:lang="en" lang="en">The output of <code class="command">dmesg</code> after running
	    <code class="command">boot -v</code>, including any error messages
	    generated by the bug.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <code class="command">dmesg</code> output from <code class="command">boot
	      -v</code> with <acronym class="acronym">ACPI</acronym> disabled,
	    if disabling <acronym class="acronym">ACPI</acronym> helps to fix the
	    problem.</p></li><li class="listitem"><p xml:lang="en" lang="en">Output from <code class="command">sysctl hw.acpi</code>.  This
	    lists which features the system offers.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <acronym class="acronym">URL</acronym> to a pasted version of the
	    system's <acronym class="acronym">ASL</acronym>.  Do
	    <span class="emphasis"><em>not</em></span> send the <acronym class="acronym">ASL</acronym>
	    directly to the list as it can be very large.  Generate a
	    copy of the <acronym class="acronym">ASL</acronym> by running this
	    command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>acpidump -dt &gt; <em class="replaceable"><code>name</code></em>-<em class="replaceable"><code>system</code></em>.asl</code></strong></pre><p xml:lang="en" lang="en">Substitute the login name for
	    <em class="replaceable"><code>name</code></em> and manufacturer/model for
	    <em class="replaceable"><code>system</code></em>.  For example, use
	    <code class="filename">njl-FooCo6000.asl</code>.</p></li></ul></div><p xml:lang="en" lang="en">Most FreeBSD developers watch the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">FreeBSD-CURRENT mailing list</a>, but one should
	submit problems to <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a> to be sure it is seen.  Be
	patient when waiting for a response.  If the bug is not
	immediately apparent, submit a bug report.
	When entering a <acronym class="acronym">PR</acronym>,
	include the same information as requested above.  This helps
	developers to track the problem and resolve it.  Do not send a
	<acronym class="acronym">PR</acronym> without emailing <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a> first as
	it is likely that the problem has been reported before.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-References"></a>11.13.5. 參考文獻</h3></div></div></div><p xml:lang="en" lang="en">More information about <acronym class="acronym">ACPI</acronym> may be
	found in the following locations:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">The FreeBSD <acronym class="acronym">ACPI</acronym> Mailing List Archives
	    (<code class="uri"><a class="uri" href="https://lists.freebsd.org/pipermail/freebsd-acpi/" target="_top">https://lists.freebsd.org/pipermail/freebsd-acpi/</a></code>)</p></li><li class="listitem"><p xml:lang="en" lang="en">The <acronym class="acronym">ACPI</acronym> 2.0 Specification (<code class="uri"><a class="uri" href="http://acpi.info/spec.htm" target="_top">http://acpi.info/spec.htm</a></code>)</p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpi_thermal&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpi_thermal</span>(4)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpidump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpidump</span>(8)</span></a>,
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=iasl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">iasl</span>(8)</span></a>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpidb&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpidb</span>(8)</span></a></p></li></ul></div></div></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp70518072" class="footnote"><p xml:lang="en" lang="en"><a href="#idp70518072" class="para"><sup class="para">[2] </sup></a>The auto-tuning algorithm sets
	      <code class="literal">maxusers</code> equal to the amount of
	      memory in the system, with a minimum of
	      <code class="literal">32</code>, and a maximum of
	      <code class="literal">384</code>.</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot"></a>章 12. FreeBSD 開機程序</h2></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#boot-synopsis">12.1. 概述</a></span></dt><dt><span class="sect1"><a href="#boot-introduction">12.2. FreeBSD 開機程序</a></span></dt><dd><dl><dt><span class="sect2"><a href="#boot-boot0">12.2.1. 開機管理程式</a></span></dt><dt><span class="sect2"><a href="#boot-boot1">12.2.2. 階段一與階段二</a></span></dt><dt><span class="sect2"><a href="#boot-loader">12.2.3. 階段三</a></span></dt><dt><span class="sect2"><a href="#boot-init">12.2.4. 最終階段</a></span></dt><dd><dl><dt><span class="sect3"><a href="#boot-singleuser">12.2.4.1. 單使用者模式</a></span></dt><dt><span class="sect3"><a href="#boot-multiuser">12.2.4.2. 多使用者模式</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#boot-splash">12.3. 設定開機啟動畫面</a></span></dt><dt><span class="sect1"><a href="#device-hints">12.4. 裝置提示</a></span></dt><dt><span class="sect1"><a href="#boot-shutdown">12.5. 關機程序</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="boot-synopsis"></a>12.1. 概述</h2></div></div></div><a id="idp71053368" class="indexterm"></a><a id="idp71054008" class="indexterm"></a><p>從開啟電腦到載入作業系統的這段流程稱為 <span class="quote">“<span class="quote">開機程序</span>”</span> (Bootstrap process) 或 <span class="quote">“<span class="quote">開機</span>”</span> (Booting)。FreeBSD 的開機程序提供大量的客製化彈性，包含可選擇安裝在同電腦的其他的作業系統、不同版本的作業系統或不同核心的作業系統的功能。</p><p>本章會詳細說明可以設定的選項。示範如何自訂 FreeBSD 開機流程，包含其中所有會發生的事，直到啟動 FreeBSD 核心、偵測裝置及啟動 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a>。這些事會發生在開機訊息的文字顏色會從亮白變成灰色之間。</p><p>在閱讀本章之後，您會了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FreeBSD 開機系統的元件以及它們如何互動。</p></li><li class="listitem"><p>FreeBSD 開機程式中各元件可使用的選項，用來控制開機程序。</p></li><li class="listitem"><p>如何設定自訂的開機啟動畫面 (Splash screen)。</p></li><li class="listitem"><p>設定 Device Hints 的基礎。</p></li><li class="listitem"><p>如何開機進入單人及多人模式以及如何正確關閉 FreeBSD 系統。</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">本章僅說明 FreeBSD 在 x86 及 amd64 系統上執行的開機流程。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="boot-introduction"></a>12.2. FreeBSD 開機程序</h2></div></div></div><p>打開電腦並啟動作業系統的這個動作呈現了一個有趣的困境。照道理，電腦在啟動作業系統之前並不知道要如何做任何事情，這些事情之中包括從磁碟執行程式。如果電腦無法在沒有作業系統的情況下執行程式，而作業系統的程式本身又在磁碟上，那麼作業系統要如何啟動呢?</p><p>這個問題如同 <em class="citetitle">The Adventures of Baron Munchausen</em> 一書中的一個角色掉進了洞裡，他抓住了靴子上的拔靴帶 (Bootstrap) 才把自己拉了出來，因此在早期電腦領域用 <em class="firstterm">bootstrap</em> 一詞來指載入作業系統的機制，後來被縮短為 <span class="quote">“<span class="quote">booting</span>”</span>。</p><a id="idp71069496" class="indexterm"></a><a id="idp71070264" class="indexterm"></a><p>在 x86 硬體上，基本輸入/輸出系統 (Basic Input/Output System, <acronym class="acronym">BIOS</acronym>) 負責載入作業系統。 <acronym class="acronym">BIOS</acronym> 會找到硬碟上的主開機記錄區 (Master Boot Record, <acronym class="acronym">MBR</acronym>)，該記錄區必須位於磁碟上的特定位置。<acronym class="acronym">BIOS</acronym> 有足夠的知識可以載入並執行這個 <acronym class="acronym">MBR</acronym>，並且假設這個 <acronym class="acronym">MBR</acronym> 在 <acronym class="acronym">BIOS</acronym> 的協助下可以完成接下來載入作業系統的工作。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">FreeBSD 在較舊的 <acronym class="acronym">MBR</acronym> 標準與較新的 GUID 分割區表 (GUID Partition Table, <acronym class="acronym">GPT</acronym>) 上都能夠開機 (Booting)。<acronym class="acronym">GPT</acronym> 磁碟分割通常會在有支援統一可延伸韌體介面 (Unified Extensible Firmware Interface, <acronym class="acronym">UEFI</acronym>) 的電腦上找到。不論如何，FreeBSD 即使在只有傳統 <acronym class="acronym">BIOS</acronym> 的機器上，也可以使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gptboot&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gptboot</span>(8)</span></a> 由 <acronym class="acronym">GPT</acronym> 分割區開機。直接使用 <acronym class="acronym">UEFI</acronym> 開機的開發工作正在進行中。</p></div><a id="idp71091128" class="indexterm"></a><a id="idp71096248" class="indexterm"></a><a id="idp71096888" class="indexterm"></a><p>在 <acronym class="acronym">MBR</acronym> 中的程式通常會稱作開機管理程式 (<span class="emphasis"><em>Boot manager</em></span>)，特別是那些會與使用者互動的程式。開機管理程式通常會另一部份的程式會存放於磁碟的第一個磁軌或檔案系統。開機管理程式的例子有標準 FreeBSD 開機管理程式 <span class="application">boot0</span> 又稱 <span class="application">Boot Easy</span> 以及 <span class="application">Grub</span> 常用於各種 <span class="trademark">Linux</span>® 發行版。</p><p>若只有安裝一個作業系統，<acronym class="acronym">MBR</acronym> 會搜尋磁碟上第一個可開機的 (使用中) 切割區 (Slice)，然後執行在該切割區上的程式來載入剩下的作業系統。當有多個作業系統存在時，可以安裝可顯示作業系統清單的開機管理程式，以讓使用者可以選擇要啟動的作業系統。</p><p>剩餘的 FreeBSD 開機系統分成三個階段，第一個階段只知道如何讓電腦進入特定狀態並執行第二階段，第二個階段在執行第三階段之前會做的事比較多一點，第三個階段會完成載入作業系統的工作。把工作分成三個階段的原因是 <acronym class="acronym">MBR</acronym> 有限制在階段一與階段二能夠執行程式的大小。將這些工作連結在一起讓 FreeBSD 能夠提供更有彈性的載入程式。</p><a id="idp71114168" class="indexterm"></a><a id="idp71114808" class="indexterm"></a><p>核心會接著開始偵測裝置並初始化這些裝置供使用。核心開機程序完成之後，核心便會傳送控制權給使用者程序 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a>，這個程序會確保磁碟在可以使用的狀態，然後啟動使用者層級的資源設置來掛載檔案系統、設定網路卡以能夠連線網路、啟動那些被設定在開機時要啟動的程序。</p><p>本章節將更詳細介紹這些階段並示範如何與 FreeBSD 開機程序互動。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-boot0"></a>12.2.1. 開機管理程式</h3></div></div></div><a id="idp71118264" class="indexterm"></a><a id="idp71118904" class="indexterm"></a><p>有時會稱在 <acronym class="acronym">MBR</acronym> 中的開機管理程式為開機程序的 <span class="emphasis"><em>第零階段 (Stage zero)</em></span>，FreeBSD 預設會使用 <span class="application">boot0</span> 開機管理程式。</p><p>由 FreeBSD 安裝程式所安裝的 <acronym class="acronym">MBR</acronym> 便是以 <code class="filename">/boot/boot0</code> 為基礎。<span class="application">boot0</span> 的大小與容量被限制在 446 個位元組是由於切割表與 <code class="literal">0x55AA</code> 識別碼位於 <acronym class="acronym">MBR</acronym> 的最末端。若安裝多個作業系統使用 <span class="application">boot0</span> ，則會在開機時顯示如下範例的訊息：</p><div class="example"><a id="boot-boot0-example"></a><div class="example-title">範例 12.1. <code class="filename">boot0</code> 螢幕截圖</div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en">F1 Win
F2 FreeBSD

Default: F2</pre></div></div><br class="example-break" /><p>其作他作業統若在 FreeBSD 之後才安裝則會覆蓋現有的 <acronym class="acronym">MBR</acronym>，若這件事發生了，或者要使用 FreeBSD <acronym class="acronym">MBR</acronym> 取代現有的 <acronym class="acronym">MBR</acronym> 可使用以下指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>fdisk -B -b /boot/boot0 <em class="replaceable"><code>device</code></em></code></strong></pre><p>其中 <em class="replaceable"><code>device</code></em> 開機磁碟，例如第一個 <acronym class="acronym">IDE</acronym> 磁碟為 <code class="filename">ad0</code>，第二個 <acronym class="acronym">IDE</acronym> 控制器的第一個 <acronym class="acronym">IDE</acronym>磁碟為 <code class="filename">ad2</code>，第一個 <acronym class="acronym">SCSI</acronym> 磁碟為 <code class="filename">da0</code>。要建立自訂的 <acronym class="acronym">MBR</acronym> 設定請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=boot0cfg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">boot0cfg</span>(8)</span></a>。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-boot1"></a>12.2.2. 階段一與階段二</h3></div></div></div><p>概念上，第一與第二個階段均為磁碟上同一個區域上同一個程式的一部份，由於空間上的限制，它們被分成兩部份，但是會一併安裝。它們會由 FreeBSD 安裝程式或 <code class="command">bsdlabel</code> 從 <code class="filename">/boot/boot</code> 複製而來。</p><p>這兩個階段均位於檔案系統之外，在開機切割區的第一個磁軌，從第一個磁碟扇區 (Sector) 開始，這個位置便是 <span class="application">boot0</span> 或其他開機管理程式所會儲存的地方，並會尋找可以執行的程式以繼續開機程序。</p><p>第一個階段的 <code class="filename">boot1</code> 非常的簡單，因為它只能有 512 位元組的大小。它只能認得儲存切割區資訊的 FreeBSD <em class="firstterm">bsdlabel</em> 以及尋找並執行 <code class="filename">boot2</code>。</p><p>階段二 <code class="filename">boot2</code> 稍微複雜一點，能夠理解 FreeBSD 檔案系統來搜尋檔案。它可以提供一個簡單的介面來選擇要執行的核心或載入程式。它所執行的載入程式 (<span class="application">loader</span>) 更複雜並能讀取開機設定檔。若開機程序在階段二中斷，則會顯示以下的互動畫面：</p><div class="example"><a id="boot-boot2-example"></a><div class="example-title">範例 12.2. <code class="filename">boot2</code> 螢幕截圖</div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en">&gt;&gt; FreeBSD/i386 BOOT
Default: 0:ad(0,a)/boot/loader
boot:</pre></div></div><br class="example-break" /><p>要更換已安裝的 <code class="filename">boot1</code> 與 <code class="filename">boot2</code> 可使用 <code class="command">bsdlabel</code>，其中 <em class="replaceable"><code>diskslice</code></em> 是要開機的磁碟與切割區，例如 <code class="filename">ad0s1</code> 代表第一個 <acronym class="acronym">IDE</acronym> 磁碟的第一個切割區：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -B <em class="replaceable"><code>diskslice</code></em></code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">若只使用磁碟名稱，如 <code class="filename">ad0</code>，<code class="command">bsdlabel</code> 便會以 <span class="quote">“<span class="quote">危險專用的模式</span>”</span> 來建立磁碟，而不會建立任何分割區。這個可能與預期的動作不同，所以在按下 <span class="keycap"><strong>Return</strong></span> 鍵之前請再次確認 <em class="replaceable"><code>diskslice</code></em>。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-loader"></a>12.2.3. 階段三</h3></div></div></div><a id="idp71172664" class="indexterm"></a><p><span class="application">loader</span> 是三階段開機程多的最後一個階段，載入程式位於檔案系統之中，通常在 <code class="filename">/boot/loader</code>。</p><p><span class="application">loader</span> 主要目地是利用擁有更複雜指令集的強大直譯器做為基礎的內建指令集提供一個互動的方式來做設定。</p><p>在初始化的過程中，<span class="application">loader</span> 會偵測 Console 與磁碟，並找出可以用來開機的磁碟。在由 Script 或互動輸入使用者指令的地方會設定相對的變數並啟動直譯器。</p><a id="idp71175736" class="indexterm"></a><a id="idp71176376" class="indexterm"></a><p><span class="application">loader</span> 接著會讀取 <code class="filename">/boot/loader.rc</code>，這個程式預設又會讀取 <code class="filename">/boot/defaults/loader.conf</code> 來設定合理的變數預設值以及讀取 <code class="filename">/boot/loader.conf</code> 來對這些變數做本地的更改。<code class="filename">loader.rc</code> 接著會依這些變數來運作，讀取選擇模組與核心。</p><p>最後，預設情況下 <span class="application">loader</span> 會待候鍵盤輸入 10 秒鐘，若沒有被中斷的話會接著啟動核心。若被使用者中斷，則會向使用者顯示提示字元，此時使用可以使用指令集來調整變數、卸載所有模組、載入模組，然後最後開機或重新開機。<a class="xref" href="#boot-loader-commands" title="表格 12.1. 載入程式內建指令">表格 12.1, “載入程式內建指令”</a> 中列出了最常使用的 <span class="application">loader</span> 指令。要完整了解所有可用的指令，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a>。</p><div class="table"><a id="boot-loader-commands"></a><div class="table-title">表格 12.1. 載入程式內建指令</div><div class="table-contents"><table summary="載入程式內建指令" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>變數</th><th>說明</th></tr></thead><tbody><tr><td xml:lang="en" lang="en">autoboot
		<em class="replaceable"><code>seconds</code></em></td><td>若在指定時間 (秒) 內沒有中斷，會繼續啟動核心。此指令會顯示倒數，預設的時間為 10 秒鐘。</td></tr><tr><td xml:lang="en" lang="en">boot
		[<span class="optional"><em class="replaceable"><code>-options</code></em></span>]
		[<span class="optional"><em class="replaceable"><code>kernelname</code></em></span>]</td><td>使用任何指定的選項或核心名稱立即啟動核心，要由指令列指定核心名稱必須先執行 <code class="command">unload</code>，否則會使用先前載入過的核心。若 <span class="emphasis"><em>kernelname</em></span> 不是完整的路徑則會搜尋 <span class="emphasis"><em>/boot/kernel</em></span> 及 <span class="emphasis"><em>/boot/modules</em></span> 底下。</td></tr><tr><td xml:lang="en" lang="en">boot-conf</td><td>依據指定的變數及最常用的 <code class="envar">kernel</code> 再做一次相同的自動模組設置。這只有在執行 <code class="command">unload</code> 之後，尚未變更變數之前方可使用。</td></tr><tr><td xml:lang="en" lang="en">help
		[<span class="optional"><em class="replaceable"><code>topic</code></em></span>]</td><td>顯示自 <code class="filename">/boot/loader.help</code> 取得的說明訊息。若指定的主題為 <code class="literal">index</code> 則會顯示所有可用的主題。</td></tr><tr><td xml:lang="en" lang="en">include <em class="replaceable"><code>filename</code></em>
		…</td><td>讀取指定的檔案並直譯每一行。若有錯誤則會立即中止 <code class="command">include</code>。</td></tr><tr><td xml:lang="en" lang="en">load [<span class="optional">-t
		  <em class="replaceable"><code>type</code></em></span>]
		<em class="replaceable"><code>filename</code></em></td><td>由指定的檔案名稱載入核心、核心模組或指定類型的檔案。任何於 <em class="replaceable"><code>filename</code></em> 之後的參數都會被傳遞到該檔案。若 <span class="emphasis"><em>filename</em></span> 不是絕對位置則會搜尋 <span class="emphasis"><em>/boot/kernel</em></span> 及 <span class="emphasis"><em>/boot/modules</em></span> 底下。</td></tr><tr><td xml:lang="en" lang="en">ls [<span class="optional">-l</span>]
		[<span class="optional"><em class="replaceable"><code>path</code></em></span>]</td><td>顯示指定路徑中的檔案，若未指定路徑則會顯示根目錄中的檔案。若有指定 <code class="option">-l</code>，則會連檔案大小一同顯示。</td></tr><tr><td xml:lang="en" lang="en">lsdev [<span class="optional">-v</span>]</td><td>列出所有的裝置，這些裝置可能可以用來載入模組。若有指定 <code class="option">-v</code> 則會顯示更詳細的資訊。</td></tr><tr><td xml:lang="en" lang="en">lsmod [<span class="optional">-v</span>]</td><td>顯示已載入的模組。若有指定 <code class="option">-v</code> 則會顯示更詳細的資訊。</td></tr><tr><td xml:lang="en" lang="en">more <em class="replaceable"><code>filename</code></em></td><td>顯示指定的檔案，並於每 <code class="varname">LINES</code> 行顯示後會暫停。</td></tr><tr><td xml:lang="en" lang="en">reboot</td><td>立即重新啟動系統。</td></tr><tr><td xml:lang="en" lang="en">set <em class="replaceable"><code>variable</code></em>, set
		<em class="replaceable"><code>variable</code></em>=<em class="replaceable"><code>value</code></em></td><td>設定指定的環境變數。</td></tr><tr><td xml:lang="en" lang="en">unload</td><td>移除所有已載入的模組。</td></tr></tbody></table></div></div><br class="table-break" /><p>這裡有一些 loader 用法的實務範例。要使用一般的核心開機進入單使用者模式 (Single-user mode<a id="idp71222712" class="indexterm"></a>) 可：</p><pre xml:lang="en" class="screen" lang="en"><strong class="userinput"><code>boot -s</code></strong></pre><p>要卸載一般的核心與模組，然後載入先前或另一個指定的核心可：</p><pre xml:lang="en" class="screen" lang="en"><strong class="userinput"><code>unload</code></strong>
<strong class="userinput"><code>load <em class="replaceable"><code>kernel.old</code></em></code></strong></pre><p>使用 <code class="filename">kernel.GENERIC</code> 來代表安裝程式使用的預設核心，或 <code class="filename">kernel.old</code> 來代表在系統升級之前或設定自訂核心前安裝的核心。</p><p>使用以下指令來使用另一個核心載入一般的模組：</p><pre xml:lang="en" class="screen" lang="en"><strong class="userinput"><code>unload</code></strong>
<strong class="userinput"><code>set kernel="<em class="replaceable"><code>kernel.old</code></em>"</code></strong>
<strong class="userinput"><code>boot-conf</code></strong></pre><p>要載入一個已自動化的核心設置 Script 可：</p><pre xml:lang="en" class="screen" lang="en"><strong class="userinput"><code>load -t userconfig_script <em class="replaceable"><code>/boot/kernel.conf</code></em></code></strong></pre><a id="idp71234360" class="indexterm"></a></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-init"></a>12.2.4. 最終階段</h3></div></div></div><a id="idp71248824" class="indexterm"></a><p>由 <span class="application">loader</span> 或由會繞開 <span class="application">loader</span> 的 <span class="application">boot2</span> 載入核心之後，載入程式便會檢查是不有使用任何開機旗標，並根據需要調整開機的方式。<a class="xref" href="#boot-kernel" title="表格 12.2. 開機時核心互動參數">表格 12.2, “開機時核心互動參數”</a> 列出了常用的開機旗標，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=boot&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">boot</span>(8)</span></a> 取得更多其他開機旗標的資訊。</p><a id="idp71252920" class="indexterm"></a><div class="table"><a id="boot-kernel"></a><div class="table-title">表格 12.2. 開機時核心互動參數</div><div class="table-contents"><table summary="開機時核心互動參數" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>項目</th><th>說明</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><code class="option">-a</code></td><td>核心初始化時，會詢問要掛載為根檔案系統的裝置。</td></tr><tr><td xml:lang="en" lang="en"><code class="option">-C</code></td><td>由 <acronym class="acronym">CDROM</acronym> 做為根檔案系統開機。</td></tr><tr><td xml:lang="en" lang="en"><code class="option">-s</code></td><td>開機進入單使用者模式。</td></tr><tr><td xml:lang="en" lang="en"><code class="option">-v</code></td><td>核心啟動時提供更多詳細資訊。</td></tr></tbody></table></div></div><br class="table-break" /><p>一旦核心完成開機程序後，便會傳送控制權給使用者程序 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a>，該程序位於 <code class="filename">/sbin/init</code> 或在 <code class="command">loader</code> 中的 <code class="envar">init_path</code> 變數所指的程式路徑。這是開機程序的最後一個階段。</p><p>開機程序會確保系統上的檔案系統的一致性 (Consistency)，若 <acronym class="acronym">UFS</acronym> 檔案系統不一致且 <code class="command">fsck</code> 無法修時，<span class="application">init</span> 會讓系統進入單使用者模式，以讓系統管理者能夠直接解決問題，否則系統會開機進入多使用者模式。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-singleuser"></a>12.2.4.1. 單使用者模式</h4></div></div></div><a id="idp71280696" class="indexterm"></a><a id="idp71281336" class="indexterm"></a><p>使用者可以在開機時指定 <code class="option">-s</code> 或在 <span class="application">loader</span> 設定 <code class="envar">boot_single</code> 變數進入這個模式。也可以透過在多使用者模式執行 <code class="command">shutdown now</code> 進入此模式。進入單使用者模式時會出現此訊息：</p><pre xml:lang="en" class="programlisting" lang="en">Enter full pathname of shell or RETURN for /bin/sh:</pre><p>若使用者按下 <span class="keycap"><strong>Enter</strong></span>，系統便會進入預設的 Bourne shell。要指定使用其他的 Shell 則輸入該 Shell 的完整路徑。</p><p>單使用者模式通常用來修復因檔案系統不一致或開機設定檔發生錯誤造成的無法開機，也可以用來重設遺忘的 <code class="systemitem">root</code> 的密碼，因為在單使用者模式會給予對本地系統及設定檔完整的存取權。在這個模式下沒有網路功能。</p><p>雖然單使用者模式對修復系統很有幫助，但若系統放在不安全的場所便會有安全上的風險。預設，開機進入單使用者模式後，任何能夠存取實體主機的使用者便擁有系統的完整控制權。</p><p>若在 <code class="filename">/etc/ttys</code> 系統 <code class="literal">console</code> 更改為 <code class="literal">insecure</code>，系統便會在初始化單使用者模式前先詢問 <code class="systemitem">root</code> 的密碼。這可增加一定程度的安全性，但便無法在忘記 <code class="systemitem">root</code> 密碼時重設密碼。</p><div class="example"><a id="boot-insecure-console"></a><div class="example-title">範例 12.3. 在 <code class="filename">/etc/ttys</code> 設定不安全的 Console</div><div class="example-contents"><pre xml:lang="en" class="programlisting" lang="en"># name  getty                           type    status          comments
#
# If console is marked "insecure", then init will ask for the root password
# when going to single-user mode.
console none                            unknown off <em class="replaceable"><code>insecure</code></em></pre></div></div><br class="example-break" /><p>不安全 (<code class="literal">insecure</code>) console  代表對 Console 的實體安全性評估為不安全 (insecure)，所以只有知道 <code class="systemitem">root</code> 密碼的人可以使用單使用者模式。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-multiuser"></a>12.2.4.2. 多使用者模式</h4></div></div></div><a id="idp71297464" class="indexterm"></a><p>若 <span class="application">init</span> 正常找到檔案系統或在單使用者模式的使用者完成了操作並輸入 <code class="command">exit</code> 離開單使用者模式，系統便會進入多使用者模式，在這個模式便會開始系統的資源設置。</p><a id="idp71299256" class="indexterm"></a><p>資源設置系統 (Resource configuration system) 會從 <code class="filename">/etc/defaults/rc.conf</code> 讀取設定預設值以及從 <code class="filename">/etc/rc.conf</code> 讀取系統特定的設定，接著會繼續掛載系統列於 <code class="filename">/etc/fstab</code> 的檔案系統，也會啟動網路服務、其他的系統 Daemon，然後執行本地已安裝套件的啟動 Script。</p><p>要了解更多有關資源設置系統，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> 以及查看位於 <code class="filename">/etc/rc.d</code> 的 Script。</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="boot-splash"></a>12.3. 設定開機啟動畫面</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Joseph J.</span> <span class="surname">Barbish</span></span>. </span></div></div></div><p>正常 FreeBSD 系統開機會在 Console 顯示以一系列訊息來表示開機進度。開機啟動畫面 (Boot splash screen) 是另一種可以把所有開機偵測與服務啟動訊息隱藏的開機畫面，但即使開啟了啟動畫面，仍有有少數的開機載入程式的訊息，如：開機選項選單以及倒數時間的提示，仍會在開機時顯示。在開機程序時可以按下鍵盤上的按鍵來關閉顯示中的啟動畫面。</p><p>FreeBSD 有兩種基本的環境可以使用，一種是預設的傳統虛擬 Console 指令列環境，在系統完成開機之後，便會顯示 Console 登入提示。另一種環境則是設定好的圖型化環境，請參考 <a class="xref" href="#x11" title="章 5. X Window 系統">章 5, <em>X Window 系統</em></a> 以取得更多有關如何安裝與設定圖型化顯示管理程式與圖型化登入管理程式的資訊。</p><p>系統開機之後，啟動畫面預設會作為螢幕保護程式，一段時間未使用便會顯示啟動畫面，並且會循環更改影像的亮度，從明亮到非常暗，然後再繼續循環。啟動螢幕保護程式的設定可在 <code class="filename">/etc/rc.conf</code> 增加一行 <code class="literal">saver=</code> 來更改。有許多內建的螢幕保護程式可用，在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=splash&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">splash</span>(4)</span></a> 中有說明。<code class="literal">saver=</code> 的選項只會套用至虛擬 Console，對圖型化顯示管理程式並不會有任何影響。</p><p>透過安裝 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/bsd-splash-changer/pkg-descr">sysutils/bsd-splash-changer</a> 套件或 Port，可在開機時顯示隨機挑選的啟動畫面。啟動畫面功能支援 256 色的點陣圖 (<code class="filename">.bmp</code>)、ZSoft <acronym class="acronym">PCX</acronym> (<code class="filename">.pcx</code>) 或 TheDraw (<code class="filename">.bin</code>) 格式。<code class="filename">.bmp</code>, <code class="filename">.pcx</code> 或 <code class="filename">.bin</code> 圖片必須放在根分割區，例如於 <code class="filename">/boot</code>。啟動圖片檔必須使用 320x200 像素或更低的解析度以能夠在標準 <acronym class="acronym">VGA</acronym> 介面卡上運作，要在預設 256 色、320x200 像素或更低的解析度設定開機啟動圖片，可加入下行到 <code class="filename">/boot/loader.conf</code>，並替換 <em class="replaceable"><code>splash.bmp</code></em> 為實際要使用的點陣圖檔：</p><pre xml:lang="en" class="programlisting" lang="en">splash_bmp_load="YES"
bitmap_load="YES"
bitmap_name="/boot/<em class="replaceable"><code>splash.bmp</code></em>"</pre><p>要使用 <acronym class="acronym">PCX</acronym> 檔則可替換點陣圖檔：</p><pre xml:lang="en" class="programlisting" lang="en">splash_pcx_load="YES"
bitmap_load="YES"
bitmap_name="/boot/<em class="replaceable"><code>splash.pcx</code></em>"</pre><p>若要改使用 <a class="link" href="https://en.wikipedia.org/wiki/TheDraw" target="_top">https://en.wikipedia.org/wiki/TheDraw</a> 格式的 ASCII 圖可：</p><pre xml:lang="en" class="programlisting" lang="en">splash_txt="YES"
bitmap_load="YES"
bitmap_name="/boot/<em class="replaceable"><code>splash.bin</code></em>"</pre><p>要使用較大的圖片來填滿整個顯示畫面支援的解析度最大可至 1024x768 像素，<acronym class="acronym">VESA</acronym> 模組也必須在系統開機時載入。若使用自訂的核心，請確定自訂核心設定檔中有含有 <code class="literal">VESA</code> 核心設定選項。要載入 <acronym class="acronym">VESA</acronym> 模組來顯示啟動畫面可在 <code class="filename">/boot/loader.conf</code> 上述例子中提到的三行之前加入下行：</p><pre xml:lang="en" class="programlisting" lang="en">vesa_load="YES"</pre><p>其他有用的 <code class="filename">loader.conf</code> 選項還有：</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en"><code class="literal">beastie_disable="YES"</code></span></dt><dd><p>這個會關閉開機選項選單的顯示，但倒數計時提示仍會在。即使關閉了開機選項選單，在倒數計時提示時輸入選擇的選項還是會啟動對應的開機選項。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="literal">loader_logo="beastie"</code></span></dt><dd><p>這個選項會替換預設與上色的小惡魔圖示一起顯示於開機選項選單右側的 <span class="quote">“<span class="quote">FreeBSD</span>”</span> 文字。</p></dd></dl></div><p>要取得更多資訊，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=splash&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">splash</span>(4)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader.conf</span>(5)</span></a> 以及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vga&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vga</span>(4)</span></a>。</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="device-hints"></a>12.4. 裝置提示</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp71079864" class="indexterm"></a><p>在一開始系統啟動時，開機 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a> 會讀取 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=device.hints&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">device.hints</span>(5)</span></a>，這個檔中儲存了核心開機資訊，即變數，有時我們又會稱其為 <span class="quote">“<span class="quote">裝置提示 (Device hints)</span>”</span>。這些 <span class="quote">“<span class="quote">裝置提示 (Device hints)</span>”</span> 會傳送給裝置驅動程式做裝置的設置使用。</p><p>裝置提示也可在階段 3 開機載入程式提示時指定，如 <a class="xref" href="#boot-loader" title="12.2.3. 階段三">節 12.2.3, “階段三”</a> 中的示範，其變數也可以使用 <code class="command">set</code> 增加、使用 <code class="command">unset</code> 移除、使用 <code class="command">show</code> 檢視，也可覆蓋設定在 <code class="filename">/boot/device.hints</code> 的變數，但在開機載入程式輸入的裝置提示並不是永久有效的，在下一次重新開機久後便會失效。</p><p>一旦系統開機後，便可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kenv&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kenv</span>(1)</span></a> 來列出所有的變數。</p><p><code class="filename">/boot/device.hints</code> 的語法為一個變數一行，使用井字號 <span class="quote">“<span class="quote">#</span>”</span> 做為註解符號，每一行的結構如下：</p><pre xml:lang="en" class="screen" lang="en"><strong class="userinput"><code>hint.driver.unit.keyword="<em class="replaceable"><code>value</code></em>"</code></strong></pre><p>在階段 3 開機載入程式的語法則為：</p><pre xml:lang="en" class="screen" lang="en"><strong class="userinput"><code>set hint.driver.unit.keyword=<em class="replaceable"><code>value</code></em></code></strong></pre><p>其中 <code class="literal">driver</code> 為裝置驅動程式名稱、<code class="literal">unit</code> 為裝置驅動程式單位編號及 <code class="literal">keyword</code> 為提示關鍵字，關鍵字由以下選項所組成：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">at</code>: 指定裝置所連結的匯流排 (Bus)。</p></li><li class="listitem"><p><code class="literal">port</code>: 指定要使用的 <acronym class="acronym">I/O</acronym> 開始位置。</p></li><li class="listitem"><p><code class="literal">irq</code>: 指定要使用的中斷請求編號。</p></li><li class="listitem"><p><code class="literal">drq</code>: 指定 DMA 頻道編號。</p></li><li class="listitem"><p><code class="literal">maddr</code>: 指定裝置所使用的實體記憶體位置。</p></li><li class="listitem"><p><code class="literal">flags</code>: 設定提供給裝置的各種旗標位元。</p></li><li class="listitem"><p><code class="literal">disabled</code>: 若設為 <code class="literal">1</code> 則可關閉該裝置。</p></li></ul></div><p>由於裝置驅動程式可能會接受或請求更多未列於此處的提示，建議先閱讀驅動程式的操作手冊。要取得更多資訊請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=device.hints&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">device.hints</span>(5)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kenv&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kenv</span>(1)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader.conf</span>(5)</span></a> 以及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a>。</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="boot-shutdown"></a>12.5. 關機程序</h2></div></div></div><a id="idp71399864" class="indexterm"></a><p>在使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=shutdown&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">shutdown</span>(8)</span></a> 控制關閉時，<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a> 會嘗試執行 <code class="filename">/etc/rc.shutdown</code> Script 接著傳送 <code class="literal">TERM</code> 信號給所有的程序，然後傳送 <code class="literal">KILL</code> 信號給未在時間內中止的程序。</p><p>要在支援電源管理的架構與系統關閉 FreeBSD 主機電源，可使用 <code class="command">shutdown -p now</code> 來立即關閉電源，要重新啟動 FreeBSD 系統可使用 <code class="command">shutdown -r now</code>。操作人必須為 <code class="systemitem">root</code> 或為 <code class="systemitem">operator</code> 的成員才可執行 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=shutdown&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">shutdown</span>(8)</span></a>，擁有這些身份的人也可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=halt&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">halt</span>(8)</span></a> 與 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=reboot&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">reboot</span>(8)</span></a>，參考這些指令與 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=shutdown&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">shutdown</span>(8)</span></a> 的操作手冊來取得更多資訊。</p><p>要修改群組成員可參考 <a class="xref" href="#users-synopsis" title="3.3. 使用者與基礎帳號管理">節 3.3, “使用者與基礎帳號管理”</a>。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">電源管理需要以載入 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a> 模組或將其靜態編譯至自訂核心中。</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security"></a>章 13. 安全性</h2></div><div><span class="authorgroup">Rewritten by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#security-synopsis">13.1. 概述</a></span></dt><dt><span class="sect1"><a href="#security-intro">13.2. 簡介</a></span></dt><dd><dl><dt><span class="sect2"><a href="#security-accounts">13.2.1. 防止登入</a></span></dt><dt><span class="sect2"><a href="#security-accountmgmt">13.2.2. 帳號升級授權</a></span></dt><dt><span class="sect2"><a href="#security-passwords">13.2.3. 密碼編碼方式</a></span></dt><dt><span class="sect2"><a href="#security-pwpolicy">13.2.4. 強制密碼政策</a></span></dt><dt><span class="sect2"><a href="#security-rkhunter">13.2.5. 偵測 Root 工具 (Rootkit)</a></span></dt><dt><span class="sect2"><a href="#security-ids">13.2.6. Binary 檢驗</a></span></dt><dt><span class="sect2"><a href="#security-tuning">13.2.7. 系統安全性調校</a></span></dt></dl></dd><dt><span class="sect1"><a href="#one-time-passwords">13.3. 一次性密碼</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp71807928">13.3.1. 初始化 <acronym class="acronym">OPIE</acronym></a></span></dt><dt><span class="sect2"><a href="#idp71814072">13.3.2. 在不安全連線下做初始化</a></span></dt><dt><span class="sect2"><a href="#idp71832248">13.3.3. 產生單組一次性密碼</a></span></dt><dt><span class="sect2"><a href="#idp71842616">13.3.4. 產生多組一次性密碼</a></span></dt><dt><span class="sect2"><a href="#idp71851576">13.3.5. 限制使用 <span class="trademark">UNIX</span>® 密碼</a></span></dt></dl></dd><dt><span class="sect1"><a href="#tcpwrappers">13.4. TCP Wrapper</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp71894840">13.4.1. 初始設定</a></span></dt><dt><span class="sect2"><a href="#idp71914040">13.4.2. 進階設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#kerberos5">13.5. <span class="application">Kerberos</span></a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp71986104">13.5.1. 設定 Heimdal <acronym class="acronym">KDC</acronym></a></span></dt><dt><span class="sect2"><a href="#idp63142200">13.5.2. 設定伺服器使用 <span class="application">Kerberos</span></a></span></dt><dt><span class="sect2"><a href="#idp72064568">13.5.3. 設定客戶端使用 <span class="application">Kerberos</span></a></span></dt><dt><span class="sect2"><a href="#idp72113080">13.5.4. 與 <acronym class="acronym">MIT</acronym> 的差異</a></span></dt><dt><span class="sect2"><a href="#idp72125496">13.5.5. <span class="application">Kerberos</span> 提示、技巧與疑難排解</a></span></dt><dt><span class="sect2"><a href="#idp72161976">13.5.6. 減輕 <span class="application">Kerberos</span> 的限制</a></span></dt><dt><span class="sect2"><a href="#idp72186296">13.5.7. 相關資源與延伸資訊</a></span></dt></dl></dd><dt><span class="sect1"><a href="#openssl">13.6. OpenSSL</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp72220088">13.6.1. 產生憑証</a></span></dt><dt><span class="sect2"><a href="#idp72274872">13.6.2. 使用憑證</a></span></dt></dl></dd><dt><span class="sect1"><a href="#ipsec">13.7. <acronym class="acronym">VPN</acronym> over
	<acronym class="acronym">IPsec</acronym></a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp72350776">13.7.1. 在 FreeBSD 上設定 <acronym class="acronym">VPN</acronym></a></span></dt></dl></dd><dt><span class="sect1"><a href="#openssh">13.8. OpenSSH</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp72454328">13.8.1. 使用 SSH 客戶端工具</a></span></dt><dd><dl><dt><span class="sect3"><a href="#security-ssh-keygen">13.8.1.1. 以金鑰為基礎的認證</a></span></dt><dt><span class="sect3"><a href="#security-ssh-tunneling">13.8.1.2. <acronym class="acronym">SSH</acronym> 通道</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp72610104">13.8.2. 開啟 SSH 伺服器</a></span></dt><dt><span class="sect2"><a href="#idp72627000">13.8.3. SSH 伺服器安全性</a></span></dt></dl></dd><dt><span class="sect1"><a href="#fs-acl">13.9. 存取控制清單</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp72666552">13.9.1. 開啟 <acronym class="acronym">ACL</acronym> 支援</a></span></dt><dt><span class="sect2"><a href="#idp72691128">13.9.2. 使用 <acronym class="acronym">ACL</acronym></a></span></dt></dl></dd><dt><span class="sect1"><a href="#security-pkg">13.10. 監視第三方安全性問題</a></span></dt><dt><span class="sect1"><a href="#security-advisories">13.11. FreeBSD 安全報告</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp72762424">13.11.1. 安全報告的格式</a></span></dt></dl></dd><dt><span class="sect1"><a href="#security-accounting">13.12. 程序追蹤</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp72836280">13.12.1. 開啟並使用程序追蹤</a></span></dt></dl></dd><dt><span class="sect1"><a href="#security-resourcelimits">13.13. 限制資源</a></span></dt><dd><dl><dt><span class="sect2"><a href="#users-limiting">13.13.1. 設定登入類別</a></span></dt><dt><span class="sect2"><a href="#idp73055928">13.13.2. 開啟並設定資源限制</a></span></dt></dl></dd><dt><span class="sect1"><a href="#security-sudo">13.14. 使用 Sudo 分享管理權限</a></span></dt><dd><dl><dt><span class="sect2"><a href="#security-sudo-loggin">13.14.1. 記錄輸出</a></span></dt></dl></dd></dl></div><a id="idp71428408" class="indexterm"></a><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="security-synopsis"></a>13.1. 概述</h2></div></div></div><p>不論實體或虛擬，安全性這個主題大到有整個產業圍繞著它，上百個標準案例已經被用來搛寫如何確保系統與網路的安全性。身為 FreeBSD 必須了解如何避免攻擊與入侵。</p><p>在此章會討論幾個基本原理及技術。FreeBSD 系統的安全性有許多層面，且有許多第三方工具可以用來增加安全性。</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>基礎 FreeBSD 系統安全概念。</p></li><li class="listitem"><p>FreeBSD 中的幾種加密 (Crypt) 機制。</p></li><li class="listitem"><p>如何設定一次性密碼認證。</p></li><li class="listitem"><p>如何設定 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> 中的 <span class="application">TCP Wrapper</span>。</p></li><li class="listitem"><p>如何在 FreeBSD 設定 <span class="application">Kerberos</span>。</p></li><li class="listitem"><p>如何設定 <acronym class="acronym">IPsec</acronym> 並且建立 <acronym class="acronym">VPN</acronym>。</p></li><li class="listitem"><p>如何在 FreeBSD 設定並使用 <span class="application">OpenSSH</span>。</p></li><li class="listitem"><p>如何使用檔案系統 <acronym class="acronym">ACL</acronym>。</p></li><li class="listitem"><p>如何使用 <span class="application">pkg</span> 來稽查從 Port 套件集安裝的第三方軟體套件。</p></li><li class="listitem"><p>如何利用 FreeBSD 安全報告。</p></li><li class="listitem"><p>什麼是程序追蹤 (Process Accounting) 以及如何在 FreeBSD 開啟。</p></li><li class="listitem"><p>如何使用登入類別或資源限制資料庫控制使用者資源。</p></li></ul></div><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>了解 FreeBSD 基礎及網路概念。</p></li></ul></div><p>其他的安全性議題會在本操作手冊的其他處說明。例如 強制存取控制 (Mandatory Access Control, MAC) 會在 <a class="xref" href="#mac" title="章 15. 強制存取控制 (MAC)">章 15, <em>強制存取控制 (MAC)</em></a> 討論及網路防火牆會在 <a class="xref" href="#firewalls" title="章 30. 防火牆">章 30, <em>防火牆</em></a> 討論。</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="security-intro"></a>13.2. 簡介</h2></div></div></div><p>保安是每個人的責任，任何系統中的弱點都可讓入侵者取得對關鍵資訊的存取權並導致整個網路的浩劫。資訊安全的其中一個核心原則便是 <acronym class="acronym">CIA</acronym> 三字訣，代表著資訊系統的機密性 (Confidentiality)、完整性 (Integrity) 以及可用性 (Availability)。</p><p><acronym class="acronym">CIA</acronym> 三字訣是電腦安全的基石，就如同客戶與使用者期望他們的資料得到保護一樣重要。例如，一個客戶會期望他們的信用卡資訊被安全的保存 (機密性)、他們的訂單不會在私底下被竄改 (完整性) 以及他們隨時可以存取他們的訂單資訊 (可用性)。</p><p>要提供 <acronym class="acronym">CIA</acronym>，安全專家會應用防禦深度的策略。防禦深度的概念是增加數個保全階層來避免單一階層失效便導致整個安全系統瓦解。例如，系統管理者不能直接打開防火牆與評估網路或系統的安全性，還要同時稽查帳號、檢查 Binary 的完整性與確保未被安裝惡意工具。要執行有效的保安策略，必須了解威脅以及如何抵禦威脅。</p><p>什麼威脅影響到電腦安全性? 威脅並不僅限於在遠端嘗試未經授權存取系統的遠端攻擊者，威脅也包含員工、惡意軟體、未經許可的網路裝置、天然災害、安全性漏洞甚至是公司競爭對手。</p><p>系統與網路可以被未經授權存取，有時是因為意外，或是因遠端攻擊者，或在某些案例中，是因商業間諜或者前員工。做為使用者，重要的是做好防範準備以及當有失誤造成安全漏洞能夠承認並回報可能的問題給安全團隊。做為管理者，重要的是了解威脅並準備在發生時能夠減緩威脅。</p><p>當要應用保安到系統上時，建議由基本帳號以及系統設定開始保全，接著確保網路層，使其遵守系統政策以及組織的安全程序。許多組織已經有涵蓋科技裝置設置的安全性政策，該政策應包含工作站、桌上型電腦、行動裝置、手機、上線伺服器、開發伺服器的安全設置。在大多數案例中，也都已經有標準操作程序 (<acronym class="acronym">SOP</acronym>)，當有疑慮時，請向安全團隊諮詢。</p><p>簡介接下來的部份將說明如何在 FreeBSD 系統上執行這些基礎的安全設置。本章接下來的部份將介紹在 FreeBSD 系統執行安全性政策時會用到的特定工具。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-accounts"></a>13.2.1. 防止登入</h3></div></div></div><p>要確保一個系統的安全最好的起點便是做好帳號的稽查，確保 <code class="systemitem">root</code> 使用了一個強而有力的密碼，並這個密碼未在其他地方使用過，然後關閉任何無須登入存取權的帳號。</p><p>要防止登入存取帳號有兩種方法，第一種是鎖定帳號，以下範例會鎖定 <code class="systemitem">toor</code> 帳號：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pw lock <em class="replaceable"><code>toor</code></em></code></strong></pre><p>第二種防止登入存取的方式是狀 Shell 更改為 <code class="filename">/usr/sbin/nologin</code>，只有超級使用者可以更改其他使用者的 Shell：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>chsh -s /usr/sbin/nologin <em class="replaceable"><code>toor</code></em></code></strong></pre><p><code class="filename">/usr/sbin/nologin</code> shell 可以避免系統分配 Shell 給嘗試登入的使用者。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-accountmgmt"></a>13.2.2. 帳號升級授權</h3></div></div></div><p>在有一些案例，需要與其他使用者共用系統管理權限，FreeBSD 有兩種方式可以處理這種情況。第一種，也是較不建議的方式，是與 <code class="systemitem">wheel</code> 群組的成員共用 root 的密碼，這種方式使用者可以在需要超級使用者的存取權時輸入 <code class="command">su</code> 然後輸入 <code class="systemitem">wheel</code> 的密碼，在完成需要管理存取權的指令之後，使用應輸入 <code class="command">exit</code> 離開。要加入使用者到這個群組，可編輯 <code class="filename">/etc/group</code> 然後加入該使用者到 <code class="literal">wheel</code> 項目的最後，使用者必須以逗號字元分隔並不可有空白。</p><p>第二種方式，也是較建議的方式，安裝 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/sudo/pkg-descr">security/sudo</a> 套件或 Port 來提升權限。這個軟體提供了額外的稽查、更細微的使用者控制，然後可以設定鎖定使用者只能執行特定需權限的指令。</p><p>在安裝之後，使用 <code class="command">visudo</code> 來編輯 <code class="filename">/usr/local/etc/sudoers</code>。這個範例會建立新 <code class="systemitem">webadmin</code> 群組，並加入 <code class="systemitem">trhodes</code> 帳號到該群組，然後設定該群組可重新啟動 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/apache24/pkg-descr">apache24</a> 的存取權：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pw groupadd webadmin -M trhodes -g 6000</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>visudo</code></strong>
%webadmin ALL=(ALL) /usr/sbin/service apache24 *</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-passwords"></a>13.2.3. 密碼編碼方式</h3></div></div></div><p>密碼是資訊科技的必要之惡，當必須使用密碼時，應要有複雜且強大的雜湊機制來加密儲存在密碼資料庫中的密碼。FreeBSD 支援 <acronym class="acronym">DES</acronym>, <acronym class="acronym">MD5</acronym>, <acronym class="acronym">SHA256</acronym>, <acronym class="acronym">SHA512</acronym> 以及 Blowfish 雜湊演算法於其 <code class="function">crypt()</code> 程式庫。預設使用 <acronym class="acronym">SHA512</acronym>，不建議改成更不安全的雜湊演算法，但可改成更安全的 Blowfish 演算法。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">Blowfish 不是 <acronym class="acronym">AES</acronym> 的一部份且不符合任何聯邦資訊處理標準 (Federal Information Processing Standards, <acronym class="acronym">FIPS</acronym>)，在某些環境可能不會允許使用這種加密方式。</p></div><p>要知道目前用何種雜湊演算法來加密某位使用者密碼，超級使用者可以檢視在 FreeBSD 密碼資料庫中該使用者的雜湊，每個雜湊的一開始便會以符號標示其用來加密密碼所使用的雜湊機制。若使用 <acronym class="acronym">DES</acronym> 則開始不會有任何符號，而 <acronym class="acronym">MD5</acronym> 的符號則是 <code class="literal">$</code>，<acronym class="acronym">SHA256</acronym> 及 <acronym class="acronym">SHA512</acronym> 的符號是 <code class="literal">$6$</code>，Blowfish 的符號是 <code class="literal">$2a$</code>。在以下例子中 <code class="systemitem">dru</code> 的密碼使以預設的 <acronym class="acronym">SHA512</acronym> 演算法加密，因為其雜湊的開始為 <code class="literal">$6$</code>。注意，該加密過的雜湊，不是原來的密碼，會儲存於密碼資料庫中：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>grep dru /etc/master.passwd</code></strong>
dru:$6$pzIjSvCAn.PBYQBA$PXpSeWPx3g5kscj3IMiM7tUEUSPmGexxta.8Lt9TGSi2lNQqYGKszsBPuGME0:1001:1001::0:0:dru:/usr/home/dru:/bin/csh</pre><p>雜湊機制是設定在該使用者的登入類別 (Login class)，以此為例，該使用者屬於 <code class="literal">default</code> 登入類別，且雜湊演算法是以下行設定在 <code class="filename">/etc/login.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">        :passwd_format=sha512:\</pre><p>要更改演算法為 Blowfish，可修改該行如下：</p><pre xml:lang="en" class="programlisting" lang="en">        :passwd_format=blf:\</pre><p>然後依 <a class="xref" href="#users-limiting" title="13.13.1. 設定登入類別">節 13.13.1, “設定登入類別”</a> 中所描述的方式執行 <code class="command">cap_mkdb /etc/login.conf</code>。注意，這個動作不會影響任何已存在的密碼雜湊，但這代表必須要求所有使用者執行 <code class="command">passwd</code> 來更改其密碼才有辦法重新加密所有密碼。</p><p>針對遠端登入，應使用雙重認證 (Two-factor authentication)，舉例來說您同時要 <span class="quote">“<span class="quote">有某樣東西</span>”</span>，如：鑰匙，以及 <span class="quote">“<span class="quote">知道某個資訊</span>”</span>，如：密碼。自從 <span class="application">OpenSSH</span> 是 FreeBSD 基礎系統的一部份，所有來算網路的登入應透過加密過的連線且使用以金鑰為基礎的認証來替代密碼。要了解更多資訊請參考 <a class="xref" href="#openssh" title="13.8. OpenSSH">節 13.8, “OpenSSH”</a>。Kerberos 的使用者可能會需要多做一些額外的更改才能在其網路上使用 <span class="application">OpenSSH</span>，這些更改在 <a class="xref" href="#kerberos5" title="13.5. Kerberos">節 13.5, “<span class="application">Kerberos</span>”</a> 中會有說明。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-pwpolicy"></a>13.2.4. 強制密碼政策</h3></div></div></div><p>強制在本地帳號使用高強度密碼的政策是系統安全的基礎之一。在 FreeBSD 密碼長度、密碼強度以及密碼複雜性可使用內建的可插拔認証模組 (Pluggable Authentication Modules, <acronym class="acronym">PAM</acronym>) 來執行。</p><p>本節將示範如何設定密碼長度下限與上限以及使用 <code class="filename">pam_passwdqc.so</code> 來強制使用混合字元的密碼，此模組可在使用者更改其密碼時強制要求。</p><p>要設定此模組，需要先成為超級使用者，然後取消註解在 <code class="filename">/etc/pam.d/passwd</code> 中含有 <code class="literal">pam_passwdqc.so</code> 的行。然後編輯該行來配合密碼政策：</p><pre xml:lang="en" class="programlisting" lang="en">password        requisite       pam_passwdqc.so         <em class="replaceable"><code>min=disabled,disabled,disabled,12,10 similar=deny retry=3</code></em> enforce=users</pre><p>這個例子會設定新密碼所需符合的需求。<code class="literal">min</code> 設定可以控制密碼長度下限，它有五個值因為這個模組根據密碼的複雜度定義了五種類型。而複雜度是由必須在密碼中存在的字元類型來定義，例如：文字、數字、符號以及大小寫，這些密碼類型在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pam_passwdqc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pam_passwdqc</span>(8)</span></a> 有詳細的說明。在這個例子，密碼類型的前三項為關閉的，代表不會接受只滿足這些複雜度的密碼，不論長度為何。<code class="literal">12</code> 設定密碼政策可接受滿足三種字元類型複雜度且至少 12 個字元的密碼，<code class="literal">10</code> 設定密碼政策接受滿足四種字元類型複雜度且至少 10 個字元的密碼。</p><p><code class="literal">similar</code> 設定則會拒絕以使用者前一次類似的密碼。<code class="literal">retry</code> 設定會提供使用者三次輸入新密碼的機會。</p><p>一這個檔案儲存之後，更改密碼的使用者將會看到如下的訊息：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>passwd</code></strong>
Changing local password for trhodes
Old Password:

You can now choose the new password.
A valid password should be a mix of upper and lower case letters,
digits and other characters.  You can use a 12 character long
password with characters from at least 3 of these 4 classes, or
a 10 character long password containing characters from all the
classes.  Characters that form a common pattern are discarded by
the check.
Alternatively, if no one else can see your terminal now, you can
pick this as your password: "trait-useful&amp;knob".
Enter new password:</pre><p>若輸入了一個不符何密碼政策的密碼，則會被拒絕並顯示警告，然後使用者會有機會再重試，直到超過設定的允許重試次數。</p><p>大多數密碼政策會讓密碼在多日過後過期。要在 FreeBSD 設定密碼年齡日期，可在 <code class="filename">/etc/login.conf</code> 中該使用者的登入類別設定 <code class="option">passwordtime</code>。在 <code class="literal">default</code> 登入類別已有設定範例：</p><pre xml:lang="en" class="programlisting" lang="en">#       :passwordtime=90d:\</pre><p>因此，要設定此登入類別的密碼在 90 天之後過期只需要移除註解符號 (<code class="literal">#</code>)，然後儲存編輯結果並執行 <code class="command">cap_mkdb /etc/login.conf</code>。</p><p>要在個別使用者設定期限，可將有效日期或到期的天數與使用者名稱傳給 <code class="command">pw</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pw usermod -p <em class="replaceable"><code>30-apr-2015</code></em> -n <em class="replaceable"><code>trhodes</code></em></code></strong></pre><p>如這個例子，有效日期的格式為天、月以及年。要取得更多資訊可參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a>。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-rkhunter"></a>13.2.5. 偵測 Root 工具 (Rootkit)</h3></div></div></div><p><em class="firstterm">rootkit</em> 指的是嘗試未經授權取得系統 <code class="systemitem">root</code> 存取權的軟體。一旦安裝之後，這個惡意軟體將可以光明正大的開啟給另一個給攻擊者進入的大門。現實上，一但系統已被 rootkit 滲透且執行了搜索動作之後，該系統就應該從頭重新安裝，因為即使非常謹真的資安或系統工程式也可能會遺漏攻擊者留下的動西。</p><p>rootkit 對管理者而言唯一有幫助的是：一但偵測到，便代表某處已經被滲透，但這類型的應用程式躲藏的非常好，本節將會示範一個可以用來偵測 rootkit 的工具，<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/rkhunter/pkg-descr">security/rkhunter</a>。</p><p>安裝此套件或 Port 之後，系統便可使用以下指令檢查。該指令提供許多資訊且會需要手動按下 <span class="keycap"><strong>ENTER</strong></span> 確認：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>rkhunter -c</code></strong></pre><p>該程序完成之後，目前狀態的訊息便會顯示在畫面上。這個訊息包含了已檢查過多少檔案、可疑的檔案、可能的 rootkit 以及其他更多資訊。在檢查的過程中，可能會產生一些有關隱藏檔案、<span class="application">OpenSSH</span> 通訊協定選擇及已安裝軟體已知漏洞版本的通用的安全性警告、這些問題可以立即處理或在更詳細的分析之後再處理。</p><p>每位管理者應了解在系統上執行了那些程式以及這些程式的用途。第三方工具如 <span class="application">rkhunter</span> 與 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/lsof/pkg-descr">sysutils/lsof</a> 以及原生指令如 <code class="command">netstat</code> 與 <code class="command">ps</code> 可以系統上大量的資訊，記錄下那一些是正常的，當有不適當的程式出現時提出疑問，然後找出答案。雖然理想要避免滲透，但也必須偵測是否已被滲透了。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-ids"></a>13.2.6. Binary 檢驗</h3></div></div></div><p>檢驗系統檔案與 Binary 是很重要的，因為它可以提供系統管理者與資安團隊有關系統變更的資訊，能夠監視系統變更的軟體應用程式稱為入侵偵測系統 (Intrusion Detection System, <acronym class="acronym">IDS</acronym>)。</p><p>FreeBSD 原生提供了基礎的 <acronym class="acronym">IDS</acronym> 系統，雖然每天晚上會有安全性的信件會通知管理者相關的變更，但這些資訊是儲存在本地的，這讓惡意的使用者有機會能夠修改這些資訊來隱藏其對系統的變更。也因此，會建議建立一個獨立的 Binary 簽名並將這些簽名儲存在唯度、root 擁有的目錄或在可移除的 <acronym class="acronym">USB</acronym> 磁碟或遠端 <span class="application">rsync</span> 伺服器更好。</p><p>內建 <code class="command">mtree</code> 工具可以對一個目錄中的內容產生一個規格檔，產生規格檔會用到一個種子碼 (Seed) 或常數，然後在檢查規格是否有更改過時會也會需要使用這個種子碼或常數。這讓檢查一個檔案或 Binary 是否被修改變成可能的一件事。由於攻擊者並不知道種子碼，要仿冒或檢查檔案的校驗碼 (Checksum) 數值是幾乎不可能的。以下例子會產生一組 <acronym class="acronym">SHA256</acronym> 雜湊，每一個在 <code class="filename">/bin</code> 的系統  Binary 都會有一個，並姐會將這些值以隱藏黨儲存在 <code class="systemitem">root</code> 的家目錄，<code class="filename">/root/.bin_chksum_mtree</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mtree -s <em class="replaceable"><code>3483151339707503</code></em> -c -K cksum,sha256digest -p <em class="replaceable"><code>/bin</code></em> &gt; <em class="replaceable"><code>/root/.bin_chksum_mtree</code></em></code></strong>
<code class="prompt">#</code> mtree: /bin checksum: 3427012225</pre><p><em class="replaceable"><code>3483151339707503</code></em> 代表種子碼，這個值應要記錄下來且不可給其它人看。</p><p>檢視 <code class="filename">/root/.bin_cksum_mtree</code> 應會產生類似以下的輸出結果：</p><pre xml:lang="en" class="programlisting" lang="en">#          user: root
#       machine: dreadnaught
#          tree: /bin
#          date: Mon Feb  3 10:19:53 2014

# .
/set type=file uid=0 gid=0 mode=0555 nlink=1 flags=none
.               type=dir mode=0755 nlink=2 size=1024 \
                time=1380277977.000000000
    \133        nlink=2 size=11704 time=1380277977.000000000 \
                cksum=484492447 \
                sha256digest=6207490fbdb5ed1904441fbfa941279055c3e24d3a4049aeb45094596400662a
    cat         size=12096 time=1380277975.000000000 cksum=3909216944 \
                sha256digest=65ea347b9418760b247ab10244f47a7ca2a569c9836d77f074e7a306900c1e69
    chflags     size=8168 time=1380277975.000000000 cksum=3949425175 \
                sha256digest=c99eb6fc1c92cac335c08be004a0a5b4c24a0c0ef3712017b12c89a978b2dac3
    chio        size=18520 time=1380277975.000000000 cksum=2208263309 \
                sha256digest=ddf7c8cb92a58750a675328345560d8cc7fe14fb3ccd3690c34954cbe69fc964
    chmod       size=8640 time=1380277975.000000000 cksum=2214429708 \
                sha256digest=a435972263bf814ad8df082c0752aa2a7bdd8b74ff01431ccbd52ed1e490bbe7</pre><p>機器的主機名稱、建立規格檔的日期與時間、以及建立此規格檔的使用者名稱皆會記錄在此報告當中，報告當中還會有在目錄中每個 Binary 的校驗碼、大小、時間以及 <acronym class="acronym">SHA</acronym>256 編碼。</p><p>要檢驗 Binary 簽名是否有被變更過，可使用先前產生的規格檔比對目前目錄的內容，然後儲存結果到檔案。這個指令需要當初產生原規格檔所使用的種子碼：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mtree -s <em class="replaceable"><code>3483151339707503</code></em> -p <em class="replaceable"><code>/bin</code></em> &lt; <em class="replaceable"><code>/root/.bin_chksum_mtree</code></em> &gt;&gt; <em class="replaceable"><code>/root/.bin_chksum_output</code></em></code></strong>
<code class="prompt">#</code> mtree: /bin checksum: 3427012225</pre><p>這個動作應會產生與上次建立 <code class="filename">/bin</code> 規格檔時產生的校驗碼相同，若在此目錄的 Binary 沒有被變更過，那麼 <code class="filename">/root/.bin_chksum_output</code> 這個輸出檔將會是空的。要模擬變更，可以使用 <code class="command">touch</code> 更改 <code class="filename">/root/.bin_chksum_output</code> 的日期然後再執行檢驗指令一次：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>touch /bin/cat</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mtree -s <em class="replaceable"><code>3483151339707503</code></em> -p <em class="replaceable"><code>/bin</code></em> &lt; <em class="replaceable"><code>/root/.bin_chksum_mtree</code></em> &gt;&gt; <em class="replaceable"><code>/root/.bin_chksum_output</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>more /root/.bin_chksum_output</code></strong>
cat changed
	modification time expected Fri Sep 27 06:32:55 2013 found Mon Feb  3 10:28:43 2014</pre><p>建議對含有 Binary 以及設定檔的目錄建立規格檔，對含有敏感資料的目錄也是。通常會為 <code class="filename">/bin</code>, <code class="filename">/sbin</code>, <code class="filename">/usr/bin</code>, <code class="filename">/usr/sbin</code>, <code class="filename">/usr/local/bin</code>, <code class="filename">/etc</code> 及 <code class="filename">/usr/local/etc</code> 建立規格檔。</p><p>也有更進階的 <acronym class="acronym">IDS</acronym> 系統，例如 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/aide/pkg-descr">security/aide</a>。大多數情況 <code class="command">mtree</code> 已可提供管理者所需的功能。將種子碼與校驗碼結果保存在惡意使用者無法存取的地方是非常重要的一件事。更多有關 <code class="command">mtree</code> 的資訊可在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mtree&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mtree</span>(8)</span></a> 找到。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-tuning"></a>13.2.7. 系統安全性調校</h3></div></div></div><p>在 FreeBSD，有許多系統功能可以使用 <code class="command">sysctl</code> 調校，本節會涵蓋少數可以調校來避免阻斷服務 (Denial of Service, <acronym class="acronym">DoS</acronym>) 攻擊的安全性功能。更多有關使用 <code class="command">sysctl</code> 的資訊包含：如何暫時更改數值及如何在測試之後做永久更改可在 <a class="xref" href="#configtuning-sysctl" title="11.9. 使用 sysctl(8) 調校">節 11.9, “使用 sysctl(8) 調校”</a> 找到。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">任何時間使用 <a class="xref" href="#configtuning-sysctl" title="11.9. 使用 sysctl(8) 調校">節 11.9, “使用 sysctl(8) 調校”</a> 做的設定變更都會讓造成不想要的傷害的可能性上升，影響到系統的可用性。因此應要對所有的變更做監視，若可能的話，先在測試系統上實驗，再到上線的系統上使用。</p></div><p>預設 FreeBSD 核心會使用安全性層級 <code class="literal">-1</code> 來開機，這又稱作<span class="quote">“<span class="quote">不安全模式</span>”</span>，因為不可變 (Immutable) 檔案旗標可以被關閉且可以讀取或寫入所有的裝置。除非有使用 <code class="command">sysctl</code> 或在啟動 Script 設定修改該值，否則安全性層級將會在 <code class="literal">-1</code>。安全性層級可以在系統啟動時透過在 <code class="filename">/etc/rc.conf</code> 設定 <code class="varname">kern_securelevel_enable</code> 為 <code class="literal">YES</code> 以及 設定 <code class="varname">kern_securelevel</code> 的值為想要的安全層級來提升。請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=security&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">security</span>(7)</span></a> 以及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a> 以取得更多與這些設定及可用的安全性層級相關的資訊。</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">提高 <code class="varname">securelevel</code> 會導致 <span class="application">Xorg</span> 無法執行以及造成其他問題，請做好除錯的準備。</p></div><p><code class="varname">net.inet.tcp.blackhole</code> 以及 <code class="varname">net.inet.udp.blackhole</code> 設定可以用來丟棄在已關閉連接埠 (Port) 收到的 <acronym class="acronym">SYN</acronym> 封包且不會回傳 <acronym class="acronym">RST</acronym> 回應，預設的動作是會回傳 <acronym class="acronym">RST</acronym> 來表示該連接埠已被關閉，更改預設的動作可對連接埠掃描 (用在查看在系統上執行的應用程式) 提供一定程度的保護，要這麼做可設定 <code class="varname">net.inet.tcp.blackhole</code> 為 <code class="literal">2</code> 及 <code class="varname">net.inet.udp.blackhole</code> 為 <code class="literal">1</code>。請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=blackhole&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">blackhole</span>(4)</span></a> 以取得更多有關這些設定的資訊。</p><p><code class="varname">net.inet.icmp.drop_redirect</code> 以及 <code class="varname">net.inet.ip.redirect</code> 設定可以幫助避免 <em class="firstterm">重新導向攻擊 (Redirect attacks)</em>，重新導向攻擊是 <acronym class="acronym">DoS</acronym> 的一種，會傳送大量 <acronym class="acronym">ICMP</acronym> 類型 5 的封包，由於這些封包並不是必要的，設定 <code class="varname">net.inet.icmp.drop_redirect</code> 為 <code class="literal">1</code> 以及設定 <code class="varname">net.inet.ip.redirect</code> 為 <code class="literal">0</code> 可丟棄這些封包。</p><p>來源路由 (Source routing) 是一種偵測與存取在內部網路中不可路由位址的方法，由於不可路由位址通常是固故讓它不可路由的，因此可以關閉這個功能。要關閉這個功能可設定 <code class="varname">net.inet.ip.sourceroute</code> 以及 <code class="varname">net.inet.ip.accept_sourceroute</code> 為 <code class="literal">0</code>。</p><p>當一台在網路上的機器需要傳送訊息給所有在子網路上的主機時，會發送 <acronym class="acronym">ICMP</acronym> 回應請求訊息到廣播位址。然而，外部的主機是沒有理由可以執行這個動作的。要拒絕所有來自外部的廣播請求可設定 <code class="varname">net.inet.icmp.bmcastecho</code> 為 <code class="literal">0</code>。</p><p>還有一些額外的設定在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=security&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">security</span>(7)</span></a> 有說明。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="one-time-passwords"></a>13.3. 一次性密碼</h2></div></div></div><a id="idp71793336" class="indexterm"></a><a id="idp71793976" class="indexterm"></a><p>預設 FreeBSD 已內建一次性密碼 (One-time Passwords In Everything, <acronym class="acronym">OPIE</acronym>)。<acronym class="acronym">OPIE</acronym> 設計用來避免重送攻擊 (Replay attack)，重送攻擊指的是攻擊者發現了某位使用者的密碼，然後使用該密碼來存取系統。由於在 <acronym class="acronym">OPIE</acronym> 的環境下，一組密碼只能被使用一次，被發現的密碼對攻擊者而言便沒有什麼作用。<acronym class="acronym">OPIE</acronym> 使用了安全的加密方式與詰問/回應系統 (Challenge/response system) 來管理密碼。FreeBSD 在實作上預設採用 <acronym class="acronym">MD5</acronym> 加密。</p><p><acronym class="acronym">OPIE</acronym> 使用了三種不同類型的密碼，第一種是一般的 <span class="trademark">UNIX</span>® 或 Kerberos 密碼，第二種是由 <code class="command">opiekey</code> 所產生的一次性密碼，第三種是用來生一次性密碼的 <span class="quote">“<span class="quote">秘密密碼 (Secret password)</span>”</span>，秘密密碼與 <span class="trademark">UNIX</span>® 密碼無關且不應相同。</p><p>對 <acronym class="acronym">OPIE</acronym> 來說還有另外兩個部份的資料很重要。其中一個是<span class="quote">“<span class="quote">種子碼 (Seed)</span>”</span> 或稱<span class="quote">“<span class="quote">金鑰 (Key)</span>”</span>，由兩個字母與五個數字組成。另一個則是<span class="quote">“<span class="quote">疊代次數 (Iteration count)</span>”</span>，是一個介於 1 到 100 間的數字。<acronym class="acronym">OPIE</acronym> 會將種子碼與秘密密碼串連後，套用 <acronym class="acronym">MD5</acronym> 加密數次後 (根據疊代次數)，再將結果轉換成六個簡短的英文單字來產生一次性密碼。認証系統會持續追蹤最後使用的一次性密碼，若使用者提供的密碼加密後與前一次的密碼相同則可通過認証。由於採用了單向的加密方式，若使用過的密碼被成功擷取也無法拿來產生之後的一次性密碼。疊代次數會在每一次登入成功之後減少，來保持使用者與登入程式間的同步。當疊代次數減少至 <code class="literal">1</code> 時，<acronym class="acronym">OPIE</acronym> 便要重新初始化。</p><p>這個整個程序會牽涉到幾個程式。傳送疊代次數、種子碼與秘密密碼來產生一組一次性密碼或數個一次性密碼的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opiekey</span>(1)</span></a>。除了初始化 <acronym class="acronym">OPIE</acronym> 之外，用來更改密碼、疊代次數或種子碼的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opiepasswd</span>(1)</span></a>。會讀取放在 <code class="filename">/etc/opiekeys</code> 的相關憑証檔來列出使用者目前的疊代次數與種子碼的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opieinfo&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opieinfo</span>(1)</span></a>。</p><p>本章節將介紹四種不同的操作，第一是如何在安全連線下做第一次的一次性密碼設定，第二是如何使用在不安全的連線下使用 <code class="command">opiepasswd</code>，第三是如何在不安全的連線下登入系統，第四是如何產生數個可以被記錄或列印下來在不安全的場所使的金鑰。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71807928"></a>13.3.1. 初始化 <acronym class="acronym">OPIE</acronym></h3></div></div></div><p>第一次要初始化 <acronym class="acronym">OPIE</acronym>，要在安全的場所執行以下指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>opiepasswd -c</code></strong>
Adding unfurl:
Only use this method from the console; NEVER from remote. If you are using
telnet, xterm, or a dial-in, type ^C now or exit with no password.
Then run opiepasswd without the -c parameter.
Using MD5 to compute responses.
Enter new secret pass phrase:
Again new secret pass phrase:

ID unfurl OTP key is 499 to4268
MOS MALL GOAT ARM AVID COED</pre><p><code class="option">-c</code> 會設定採用假設指令在安全場所執行的 Console 模式，如在使用者掌控之中的電腦或者透過 <acronym class="acronym">SSH</acronym> 連線到一台在使用者掌控之中的電腦。</p><p>提示出現後，輸入用來產生一次性登入金鑰的秘密密碼，應使用一個不容易被猜出來的密碼，且應與使用者登入帳號所使用的密碼不同，密碼必須介於 10 到 127 個字元長度之間，然後請記住這個密碼。</p><p><code class="literal">ID</code> 行會列出登入名稱 (<code class="literal">unfurl</code>)、預設的疊代次數 (<code class="literal">499</code>) 以及預設的種子碼 (<code class="literal">to4268</code>)。在進行登入時，系統會記住這些參數並且顯示出來，這也代表不需要另外記錄這些資訊。最後一行會列出根據這些參數與秘密密碼所產生出來的一次性密碼，在下一次登入時便要使用這個一次性密碼。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71814072"></a>13.3.2. 在不安全連線下做初始化</h3></div></div></div><p>要在不安全的系統上初始化或更改秘密密碼會需要某個可使用安全的連線的地方執行 <code class="command">opiekey</code>，這可能是在某一台信任的主機上的 Shell。初始化需要設定疊代次數，100 可能是不錯的數字，種子碼可以自行指定或隨機產生，在不安全連線下要被初始化主機須使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opiepasswd</span>(1)</span></a>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>opiepasswd</code></strong>

Updating unfurl:
You need the response from an OTP generator.
Old secret pass phrase:
	otp-md5 498 to4268 ext
	Response: GAME GAG WELT OUT DOWN CHAT
New secret pass phrase:
	otp-md5 499 to4269
	Response: LINE PAP MILK NELL BUOY TROY

ID mark OTP key is 499 gr4269
LINE PAP MILK NELL BUOY TROY</pre><p>要採用預設的種子碼，可直接按下 <span class="keycap"><strong>Return</strong></span> 做初始化。接著在輸入回應之前移到安全的連線然後給予相同的加密參數產生密碼：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>opiekey 498 to4268</code></strong>
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT</pre><p>切換回不安全的連線，然後複製產生的一次性密碼貼上。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71832248"></a>13.3.3. 產生單組一次性密碼</h3></div></div></div><p>在初始化 <acronym class="acronym">OPIE</acronym> 之後進行登入會顯示如下的提示訊息：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>telnet example.com</code></strong>
Trying 10.0.0.1...
Connected to example.com
Escape character is '^]'.

FreeBSD/i386 (example.com) (ttypa)

login: <strong class="userinput"><code>&lt;username&gt;</code></strong>
otp-md5 498 gr4269 ext
Password: </pre><p><acronym class="acronym">OPIE</acronym> 的提示提供了一個很有用的功能，若在密碼提示時按下 <span class="keycap"><strong>Return</strong></span>，便會開啟回應功能並顯示輸入的內容，這個功能在嘗試手工輸入列印出來的密碼時很有用。</p><a id="idp71353144" class="indexterm"></a><a id="idp71353784" class="indexterm"></a><a id="idp71833656" class="indexterm"></a><p>此時，要產生一次性密碼來回應登入時的提示，這必須在受信任且可安全執行 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opiekey</span>(1)</span></a> 的系統上完成。這個指令有提供 <span class="trademark">Windows</span>®, <span class="trademark">Mac OS</span>® 與 FreeBSD 版本，使用時需要疊代次數與種子碼做為在指令列的參數，剪下在要登入主機在登入時所提示的訊息。</p><p>在信任的系統上執行：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>opiekey 498 to4268</code></strong>
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT</pre><p>在產生一次性密碼後，回到登入畫面繼續登入。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71842616"></a>13.3.4. 產生多組一次性密碼</h3></div></div></div><p>有時會無法存取信任的主機或沒有安全的連線，在這種情況下，可以使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opiekey</span>(1)</span></a> 來預先產生多個一次性密碼，例如：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>opiekey -n 5 30 zz99999</code></strong>
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase: <strong class="userinput"><code>&lt;secret password&gt;</code></strong>
26: JOAN BORE FOSS DES NAY QUIT
27: LATE BIAS SLAY FOLK MUCH TRIG
28: SALT TIN ANTI LOON NEAL USE
29: RIO ODIN GO BYE FURY TIC
30: GREW JIVE SAN GIRD BOIL PHI</pre><p><code class="option">-n 5</code> 會請求產生連續五個金鑰，而 <code class="option">30</code> 則是指定最後一個疊代的編號。注意這些列印出的結果的順序與使用的順序<span class="emphasis"><em>相反</em></span>。十足的偏執狂可能會想要用手寫下結果，否則就列印出清單。每一行會同時顯示疊代次數及一次性密碼，在密碼使用過後便可劃掉。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71851576"></a>13.3.5. 限制使用 <span class="trademark">UNIX</span>® 密碼</h3></div></div></div><p><acronym class="acronym">OPIE</acronym> 可以根據登入階段的 IP 位置限制使用 <span class="trademark">UNIX</span>® 密碼，相關的檔案為 <code class="filename">/etc/opieaccess</code>，這個檔案預設便存在。請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opieaccess&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opieaccess</span>(5)</span></a> 來取得更多有關此檔案的資訊以及當使用時要考量的安全性問題。</p><p>這裡有一個範本 <code class="filename">opieaccess</code>：</p><pre xml:lang="en" class="programlisting" lang="en">permit 192.168.0.0 255.255.0.0</pre><p>這一行允許來源 IP 位址 (容易受到詐騙的位址) 符合指定值與遮罩的使用者在任何時間可使用 <span class="trademark">UNIX</span>® 密碼登入。</p><p>若在 <code class="filename">opieaccess</code> 中沒有符合的規則，預設會拒絕非 <acronym class="acronym">OPIE</acronym> 的登入。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="tcpwrappers"></a>13.4. TCP Wrapper</h2></div><div><span class="authorgroup">Written
	  by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp71878072" class="indexterm"></a><p xml:lang="en" lang="en"><span class="application">TCP Wrapper</span> is a host-based
      access control system which extends the abilities of <a class="xref" href="#network-inetd" title="29.2. inetd 超級伺服器">節 29.2, “<span class="application">inetd</span> 超級伺服器”</a>.  It can be configured to provide
      logging support, return messages, and connection restrictions
      for the server daemons under the control of
      <span class="application">inetd</span>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tcpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tcpd</span>(8)</span></a> for
      more information about
      <span class="application">TCP Wrapper</span> and its features.</p><p xml:lang="en" lang="en"><span class="application">TCP Wrapper</span> should not be
      considered a replacement for a properly configured firewall.
      Instead, <span class="application">TCP Wrapper</span> should be used
      in conjunction with a firewall and other security enhancements
      in order to provide another layer of protection in the
      implementation of a security policy.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71894840"></a>13.4.1. 初始設定</h3></div></div></div><p xml:lang="en" lang="en">To enable <span class="application">TCP Wrapper</span> in FreeBSD,
	add the following lines to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">inetd_enable="YES"
inetd_flags="-Ww"</pre><p xml:lang="en" lang="en">Then, properly configure
	<code class="filename">/etc/hosts.allow</code>.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Unlike other implementations of
	  <span class="application">TCP Wrapper</span>, the use of
	  <code class="filename">hosts.deny</code> is deprecated in FreeBSD.  All
	  configuration options should be placed in
	  <code class="filename">/etc/hosts.allow</code>.</p></div><p xml:lang="en" lang="en">In the simplest configuration, daemon connection policies
	are set to either permit or block, depending on the options in
	<code class="filename">/etc/hosts.allow</code>.  The default
	configuration in FreeBSD is to allow all connections to the
	daemons started with <span class="application">inetd</span>.</p><p xml:lang="en" lang="en">Basic configuration usually takes the form of
	<code class="literal">daemon : address : action</code>, where
	<code class="literal">daemon</code> is the daemon which
	<span class="application">inetd</span> started,
	<code class="literal">address</code> is a valid hostname,
	<acronym class="acronym">IP</acronym> address, or an IPv6 address enclosed in
	brackets ([ ]), and <code class="literal">action</code> is either
	<code class="literal">allow</code> or <code class="literal">deny</code>.
	<span class="application">TCP Wrapper</span> uses a first rule match
	semantic, meaning that the configuration file is scanned from
	the beginning for a matching rule.  When a match is found, the
	rule is applied and the search process stops.</p><p xml:lang="en" lang="en">For example, to allow <acronym class="acronym">POP</acronym>3 connections
	via the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/qpopper/pkg-descr">mail/qpopper</a> daemon, the following
	lines should be appended to
	<code class="filename">hosts.allow</code>:</p><pre xml:lang="en" class="programlisting" lang="en"># This line is required for POP3 connections:
qpopper : ALL : allow</pre><p xml:lang="en" lang="en">Whenever this file is edited, restart
	<span class="application">inetd</span>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service inetd restart</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71914040"></a>13.4.2. 進階設定</h3></div></div></div><p xml:lang="en" lang="en"><span class="application">TCP Wrapper</span> provides advanced
	options to allow more control over the way connections are
	handled.  In some cases, it may be appropriate to return a
	comment to certain hosts or daemon connections.  In other
	cases, a log entry should be recorded or an email sent to the
	administrator.  Other situations may require the use of a
	service for local connections only.  This is all possible
	through the use of configuration options known as wildcards,
	expansion characters, and external command execution.</p><p xml:lang="en" lang="en">Suppose that a situation occurs where a connection should
	be denied yet a reason should be sent to the host who
	attempted to establish that connection.  That action is
	possible with <code class="option">twist</code>.  When a connection
	attempt is made, <code class="option">twist</code> executes a shell
	command or script.  An example exists in
	<code class="filename">hosts.allow</code>:</p><pre xml:lang="en" class="programlisting" lang="en"># The rest of the daemons are protected.
ALL : ALL \
	: severity auth.info \
	: twist /bin/echo "You are not welcome to use %d from %h."</pre><p xml:lang="en" lang="en">In this example, the message <span class="quote">“<span class="quote">You are not allowed to
	  use <em class="replaceable"><code>daemon name</code></em> from
	  <em class="replaceable"><code>hostname</code></em>.</span>”</span> will be
	returned for any daemon not configured in
	<code class="filename">hosts.allow</code>.  This is useful for sending
	a reply back to the connection initiator right after the
	established connection is dropped.  Any message returned
	<span class="emphasis"><em>must</em></span> be wrapped in quote
	(<code class="literal">"</code>) characters.</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">It may be possible to launch a denial of service attack
	  on the server if an attacker floods these daemons with
	  connection requests.</p></div><p xml:lang="en" lang="en">Another possibility is to use <code class="option">spawn</code>.
	Like <code class="option">twist</code>, <code class="option">spawn</code> implicitly
	denies the connection and may be used to run external shell
	commands or scripts.  Unlike <code class="option">twist</code>,
	<code class="option">spawn</code> will not send a reply back to the host
	who established the connection.  For example, consider the
	following configuration:</p><pre xml:lang="en" class="programlisting" lang="en"># We do not allow connections from example.com:
ALL : .example.com \
	: spawn (/bin/echo %a from %h attempted to access %d &gt;&gt; \
	  /var/log/connections.log) \
	: deny</pre><p xml:lang="en" lang="en">This will deny all connection attempts from <code class="systemitem">*.example.com</code> and log the
	hostname, <acronym class="acronym">IP</acronym> address, and the daemon to
	which access was attempted to
	<code class="filename">/var/log/connections.log</code>.  This example
	uses the substitution characters <code class="literal">%a</code> and
	<code class="literal">%h</code>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hosts_access&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hosts_access</span>(5)</span></a> for the
	complete list.</p><p xml:lang="en" lang="en">To match every instance of a daemon, domain, or
	<acronym class="acronym">IP</acronym> address, use <code class="literal">ALL</code>.
	Another wildcard is <code class="literal">PARANOID</code> which may be
	used to match any host which provides an <acronym class="acronym">IP</acronym>
	address that may be forged because the <acronym class="acronym">IP</acronym>
	address differs from its resolved hostname.  In this example,
	all connection requests to <span class="application">Sendmail</span>
	which have an <acronym class="acronym">IP</acronym> address that varies from
	its hostname will be denied:</p><pre xml:lang="en" class="programlisting" lang="en"># Block possibly spoofed requests to sendmail:
sendmail : PARANOID : deny</pre><div xmlns="" class="caution"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Using the <code class="literal">PARANOID</code> wildcard will
	  result in denied connections if the client or server has a
	  broken <acronym class="acronym">DNS</acronym> setup.</p></div><p xml:lang="en" lang="en">To learn more about wildcards and their associated
	functionality, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hosts_access&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hosts_access</span>(5)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">When adding new configuration lines, make sure that any
	  unneeded entries for that daemon are commented out in
	  <code class="filename">hosts.allow</code>.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kerberos5"></a>13.5. <span class="application">Kerberos</span></h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tillman</span> <span class="surname">Hodgson</span></span>. </span></div><div><span class="authorgroup">Based on a contribution by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Mark</span> <span class="surname">Murray</span></span>. </span></div></div></div><p xml:lang="en" lang="en"><span class="application">Kerberos</span> is a network
      authentication protocol which was originally created by the
      Massachusetts Institute of Technology (<acronym class="acronym">MIT</acronym>)
      as a way to securely provide authentication across a potentially
      hostile network.  The <span class="application">Kerberos</span>
      protocol uses strong cryptography so that both a client and
      server can prove their identity without sending any unencrypted
      secrets over the network.  <span class="application">Kerberos</span>
      can be described as an identity-verifying proxy system and as a
      trusted third-party authentication system.  After a user
      authenticates with <span class="application">Kerberos</span>, their
      communications can be encrypted to assure privacy and data
      integrity.</p><p xml:lang="en" lang="en">The only function of <span class="application">Kerberos</span> is
      to provide the secure authentication of users and servers on the
      network.  It does not provide authorization or auditing
      functions.  It is recommended that
      <span class="application">Kerberos</span> be used with other security
      methods which provide authorization and audit services.</p><p xml:lang="en" lang="en">The current version of the protocol is version 5, described
      in <acronym class="acronym">RFC</acronym> 4120.  Several free
      implementations of this protocol are available, covering a wide
      range of operating systems.  <acronym class="acronym">MIT</acronym> continues to
      develop their <span class="application">Kerberos</span> package.  It
      is commonly used in the <acronym class="acronym">US</acronym> as a cryptography
      product, and has historically been subject to
      <acronym class="acronym">US</acronym> export regulations.  In FreeBSD,
      <acronym class="acronym">MIT</acronym> <span class="application">Kerberos</span> is
      available as the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/krb5/pkg-descr">security/krb5</a> package or
      port.  The Heimdal <span class="application">Kerberos</span>
      implementation was explicitly developed outside of the
      <acronym class="acronym">US</acronym> to avoid export regulations.  The Heimdal
      <span class="application">Kerberos</span> distribution is included in
      the base FreeBSD installation, and another distribution with more
      configurable options is available as
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/heimdal/pkg-descr">security/heimdal</a> in the Ports
      Collection.</p><p xml:lang="en" lang="en">In <span class="application">Kerberos</span> users and services
      are identified as <span class="quote">“<span class="quote">principals</span>”</span> which are contained
      within an administrative grouping, called a
      <span class="quote">“<span class="quote">realm</span>”</span>.  A typical user principal would be of the
      form
      <code class="literal"><em class="replaceable"><code>user</code></em>@<em class="replaceable"><code>REALM</code></em></code>
      (realms are traditionally uppercase).</p><p xml:lang="en" lang="en">This section provides a guide on how to set up
      <span class="application">Kerberos</span> using the Heimdal
      distribution included in FreeBSD.</p><p xml:lang="en" lang="en">For purposes of demonstrating a
      <span class="application">Kerberos</span> installation, the name
      spaces will be as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">The <acronym class="acronym">DNS</acronym> domain (zone) will be
	  <code class="systemitem">example.org</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <span class="application">Kerberos</span> realm will be
	  <code class="literal">EXAMPLE.ORG</code>.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Use real domain names when setting up
	<span class="application">Kerberos</span>, even if it will run
	internally.  This avoids <acronym class="acronym">DNS</acronym> problems and
	assures inter-operation with other
	<span class="application">Kerberos</span> realms.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71986104"></a>13.5.1. 設定 Heimdal <acronym class="acronym">KDC</acronym></h3></div></div></div><a id="idp71987000" class="indexterm"></a><p xml:lang="en" lang="en">The Key Distribution Center (<acronym class="acronym">KDC</acronym>) is
	the centralized authentication service that
	<span class="application">Kerberos</span> provides, the
	<span class="quote">“<span class="quote">trusted third party</span>”</span> of the system.  It is the
	computer that issues <span class="application">Kerberos</span>
	tickets, which are used for clients to authenticate to
	servers.  Because the <acronym class="acronym">KDC</acronym> is considered
	trusted by all other computers in the
	<span class="application">Kerberos</span> realm, it has heightened
	security concerns.  Direct access to the KDC should be
	limited.</p><p xml:lang="en" lang="en">While running a <acronym class="acronym">KDC</acronym> requires few
	computing resources, a dedicated machine acting only as a
	<acronym class="acronym">KDC</acronym> is recommended for security
	reasons.</p><p xml:lang="en" lang="en">To begin setting up a <acronym class="acronym">KDC</acronym>, add these
	lines to <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">kdc_enable="YES"
kadmind_enable="YES"</pre><p xml:lang="en" lang="en">Next, edit <code class="filename">/etc/krb5.conf</code> as
	follows:</p><pre xml:lang="en" class="programlisting" lang="en">[libdefaults]
    default_realm = <em class="replaceable"><code>EXAMPLE.ORG</code></em>
[realms]
    <em class="replaceable"><code>EXAMPLE.ORG</code></em> = {
	kdc = <em class="replaceable"><code>kerberos.example.org</code></em>
	admin_server = <em class="replaceable"><code>kerberos.example.org</code></em>
    }
[domain_realm]
    <em class="replaceable"><code>.example.org</code></em> = <em class="replaceable"><code>EXAMPLE.ORG</code></em></pre><p xml:lang="en" lang="en">In this example, the <acronym class="acronym">KDC</acronym> will use the
	fully-qualified hostname <code class="systemitem">kerberos.example.org</code>.  The
	hostname of the KDC must be resolvable in the
	<acronym class="acronym">DNS</acronym>.</p><p xml:lang="en" lang="en"><span class="application">Kerberos</span> can also use the
	<acronym class="acronym">DNS</acronym> to locate KDCs, instead of a
	<code class="literal">[realms]</code> section in
	<code class="filename">/etc/krb5.conf</code>.  For large organizations
	that have their own <acronym class="acronym">DNS</acronym> servers, the above
	example could be trimmed to:</p><pre xml:lang="en" class="programlisting" lang="en">[libdefaults]
      default_realm = <em class="replaceable"><code>EXAMPLE.ORG</code></em>
[domain_realm]
    <em class="replaceable"><code>.example.org</code></em> = <em class="replaceable"><code>EXAMPLE.ORG</code></em></pre><p xml:lang="en" lang="en">With the following lines being included in the
	<code class="systemitem">example.org</code> zone
	file:</p><pre xml:lang="en" class="programlisting" lang="en">_kerberos._udp      IN  SRV     01 00 88 <em class="replaceable"><code>kerberos.example.org</code></em>.
_kerberos._tcp      IN  SRV     01 00 88 <em class="replaceable"><code>kerberos.example.org</code></em>.
_kpasswd._udp       IN  SRV     01 00 464 <em class="replaceable"><code>kerberos.example.org</code></em>.
_kerberos-adm._tcp  IN  SRV     01 00 749 <em class="replaceable"><code>kerberos.example.org</code></em>.
_kerberos           IN  TXT     <em class="replaceable"><code>EXAMPLE.ORG</code></em></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">In order for clients to be able to find the
	  <span class="application">Kerberos</span> services, they
	  <span class="emphasis"><em>must</em></span> have either
	  a fully configured <code class="filename">/etc/krb5.conf</code> or a
	  minimally configured <code class="filename">/etc/krb5.conf</code>
	  <span class="emphasis"><em>and</em></span> a properly configured
	  <acronym class="acronym">DNS</acronym> server.</p></div><p xml:lang="en" lang="en">Next, create the <span class="application">Kerberos</span>
	database which contains the keys of all principals (users and
	hosts) encrypted with a master password.  It is not required
	to remember this password as it will be stored in
	<code class="filename">/var/heimdal/m-key</code>; it would be
	reasonable to use a 45-character random password for this
	purpose.  To create the master key, run
	<code class="command">kstash</code> and enter a password:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kstash</code></strong>
Master key: <strong class="userinput"><code><em class="replaceable"><code>xxxxxxxxxxxxxxxxxxxxxxx</code></em></code></strong>
Verifying password - Master key: <strong class="userinput"><code><em class="replaceable"><code>xxxxxxxxxxxxxxxxxxxxxxx</code></em></code></strong></pre><p xml:lang="en" lang="en">Once the master key has been created, the database should
	be initialized.  The <span class="application">Kerberos</span>
	administrative tool <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kadmin</span>(8)</span></a> can be used on the KDC in a
	mode that operates directly on the database, without using the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kadmind&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kadmind</span>(8)</span></a> network service, as
	<code class="command">kadmin -l</code>.  This resolves the
	chicken-and-egg problem of trying to connect to the database
	before it is created.  At the <code class="command">kadmin</code>
	prompt, use <code class="command">init</code> to create the realm's
	initial database:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kadmin -l</code></strong>
kadmin&gt; <strong class="userinput"><code>init <em class="replaceable"><code>EXAMPLE.ORG</code></em></code></strong>
Realm max ticket life [unlimited]:</pre><p xml:lang="en" lang="en">Lastly, while still in <code class="command">kadmin</code>, create
	the first principal using <code class="command">add</code>.  Stick to
	the default options for the principal for now, as these can be
	changed later with <code class="command">modify</code>.  Type
	<code class="literal">?</code> at the prompt to see the available
	options.</p><pre xml:lang="en" class="screen" lang="en">kadmin&gt; <strong class="userinput"><code>add <em class="replaceable"><code>tillman</code></em></code></strong>
Max ticket life [unlimited]:
Max renewable life [unlimited]:
Attributes []:
Password: <strong class="userinput"><code><em class="replaceable"><code>xxxxxxxx</code></em></code></strong>
Verifying password - Password: <strong class="userinput"><code><em class="replaceable"><code>xxxxxxxx</code></em></code></strong></pre><p xml:lang="en" lang="en">Next, start the <acronym class="acronym">KDC</acronym> services by running
	<code class="command">service kdc start</code> and
	<code class="command">service kadmind start</code>.  While there will
	not be any kerberized daemons running at this point, it is
	possible to confirm that the <acronym class="acronym">KDC</acronym> is
	functioning by obtaining a ticket for the
	principal that was just created:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>kinit <em class="replaceable"><code>tillman</code></em></code></strong>
tillman@EXAMPLE.ORG's Password:</pre><p xml:lang="en" lang="en">Confirm that a ticket was successfully obtained using
	<code class="command">klist</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>klist</code></strong>
Credentials cache: FILE:/tmp/krb5cc_1001
	Principal: tillman@EXAMPLE.ORG

  Issued                Expires               Principal
Aug 27 15:37:58 2013  Aug 28 01:37:58 2013  krbtgt/EXAMPLE.ORG@EXAMPLE.ORG</pre><p xml:lang="en" lang="en">The temporary ticket can be destroyed when the test is
	finished:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>kdestroy</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63142200"></a>13.5.2. 設定伺服器使用 <span class="application">Kerberos</span></h3></div></div></div><a id="idp63143096" class="indexterm"></a><p xml:lang="en" lang="en">The first step in configuring a server to use
	<span class="application">Kerberos</span> authentication is to
	ensure that it has the correct configuration in
	<code class="filename">/etc/krb5.conf</code>.  The version from the
	<acronym class="acronym">KDC</acronym> can be used as-is, or it can be
	regenerated on the new system.</p><p xml:lang="en" lang="en">Next, create <code class="filename">/etc/krb5.keytab</code> on the
	server.  This is the main part of <span class="quote">“<span class="quote">Kerberizing</span>”</span> a
	service — it corresponds to generating a secret shared
	between the service and the <acronym class="acronym">KDC</acronym>.  The
	secret is a cryptographic key, stored in a
	<span class="quote">“<span class="quote">keytab</span>”</span>.  The keytab contains the server's host
	key, which allows it and the <acronym class="acronym">KDC</acronym> to verify
	each others' identity.  It must be transmitted to the server
	in a secure fashion, as the security of the server can be
	broken if the key is made public.  Typically, the
	<code class="filename">keytab</code> is generated on an administrator's
	trusted machine using <code class="command">kadmin</code>, then securely
	transferred to the server, e.g., with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a>; it can also
	be created directly on the server if that is consistent with
	the desired security policy.  It is very important that the
	keytab is transmitted to the server in a secure fashion: if
	the key is known by some other party, that party can
	impersonate any user to the server!  Using
	<code class="command">kadmin</code> on the server directly is
	convenient, because the entry for the host principal in the
	<acronym class="acronym">KDC</acronym> database is also created using
	<code class="command">kadmin</code>.</p><p xml:lang="en" lang="en">Of course, <code class="command">kadmin</code> is a kerberized
	service; a <span class="application">Kerberos</span> ticket is
	needed to authenticate to the network service, but to ensure
	that the user running <code class="command">kadmin</code> is actually
	present (and their session has not been hijacked),
	<code class="command">kadmin</code> will prompt for the password to get
	a fresh ticket.  The principal authenticating to the kadmin
	service must be permitted to use the <code class="command">kadmin</code>
	interface, as specified in <code class="filename">kadmind.acl</code>.
	See the section titled <span class="quote">“<span class="quote">Remote administration</span>”</span> in
	<code class="command">info heimdal</code> for details on designing
	access control lists.  Instead of enabling remote
	<code class="command">kadmin</code> access, the administrator could
	securely connect to the <acronym class="acronym">KDC</acronym> via the local
	console or <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a>, and perform administration locally
	using <code class="command">kadmin -l</code>.</p><p xml:lang="en" lang="en">After installing <code class="filename">/etc/krb5.conf</code>,
	use <code class="command">add --random-key</code> in
	<code class="command">kadmin</code>.  This adds the server's host
	principal to the database, but does not extract a copy of the
	host principal key to a keytab.  To generate the keytab, use
	<code class="command">ext</code> to extract the server's host principal
	key to its own keytab:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kadmin</code></strong>
kadmin&gt;<strong class="userinput"><code> add --random-key host/myserver.example.org</code></strong>
Max ticket life [unlimited]:
Max renewable life [unlimited]:
Principal expiration time [never]:
Password expiration time [never]:
Attributes []:
kadmin&gt;<strong class="userinput"><code> ext_keytab <em class="replaceable"><code>host/myserver.example.org</code></em></code></strong>
kadmin&gt;<strong class="userinput"><code> exit</code></strong></pre><p xml:lang="en" lang="en">Note that <code class="command">ext_keytab</code> stores the
	extracted key in <code class="filename">/etc/krb5.keytab</code> by
	default.  This is good when being run on the server being
	kerberized, but the <code class="command">--keytab
	  <em class="replaceable"><code>path/to/file</code></em></code> argument
	should be used when the keytab is being extracted
	elsewhere:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kadmin</code></strong>
kadmin&gt;<strong class="userinput"><code> ext_keytab --keytab=/tmp/example.keytab <em class="replaceable"><code>host/myserver.example.org</code></em></code></strong>
kadmin&gt;<strong class="userinput"><code> exit</code></strong></pre><p xml:lang="en" lang="en">The keytab can then be securely copied to the server
	using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a> or a removable media.  Be sure to specify a
	non-default keytab name to avoid inserting unneeded keys into
	the system's keytab.</p><p xml:lang="en" lang="en">At this point, the server can read encrypted messages from
	the <acronym class="acronym">KDC</acronym> using its shared key, stored in
	<code class="filename">krb5.keytab</code>.  It is now ready for the
	<span class="application">Kerberos</span>-using services to be
	enabled.  One of the most common such services is
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a>, which supports
	<span class="application">Kerberos</span> via the
	<acronym class="acronym">GSS-API</acronym>.  In
	<code class="filename">/etc/ssh/sshd_config</code>, add the
	line:</p><pre xml:lang="en" class="programlisting" lang="en">GSSAPIAuthentication yes</pre><p>做完了這個變更之後，必須重新啟動 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> 來使新的設定值生效：<code class="command">service sshd restart</code>。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72064568"></a>13.5.3. 設定客戶端使用 <span class="application">Kerberos</span></h3></div></div></div><a id="idp72065464" class="indexterm"></a><p xml:lang="en" lang="en">As it was for the server, the client requires
	configuration in <code class="filename">/etc/krb5.conf</code>.  Copy
	the file in place (securely) or re-enter it as needed.</p><p xml:lang="en" lang="en">Test the client by using <code class="command">kinit</code>,
	<code class="command">klist</code>, and <code class="command">kdestroy</code> from
	the client to obtain, show, and then delete a ticket for an
	existing principal.  <span class="application">Kerberos</span>
	applications should also be able to connect to
	<span class="application">Kerberos</span> enabled servers.  If that
	does not work but obtaining a ticket does, the problem is
	likely with the server and not with the client or the
	<acronym class="acronym">KDC</acronym>.  In the case of kerberized
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a>, <acronym class="acronym">GSS-API</acronym> is disabled by
	default, so test using <code class="command">ssh -o
	  GSSAPIAuthentication=yes
	  <em class="replaceable"><code>hostname</code></em></code>.</p><p xml:lang="en" lang="en">When testing a Kerberized application, try using a packet
	sniffer such as <code class="command">tcpdump</code> to confirm that no
	sensitive information is sent in the clear.</p><p xml:lang="en" lang="en">Various <span class="application">Kerberos</span> client
	applications are available.  With the advent of a bridge so
	that applications using <acronym class="acronym">SASL</acronym> for
	authentication can use <acronym class="acronym">GSS-API</acronym> mechanisms
	as well, large classes of client applications can use
	<span class="application">Kerberos</span> for authentication, from
	Jabber clients to <acronym class="acronym">IMAP</acronym> clients.</p><a id="idp72104248" class="indexterm"></a><a id="idp72105272" class="indexterm"></a><p xml:lang="en" lang="en">Users within a realm typically have their
	<span class="application">Kerberos</span> principal mapped to a
	local user account.  Occasionally, one needs to grant access
	to a local user account to someone who does not have a
	matching <span class="application">Kerberos</span> principal.  For
	example, <code class="systemitem">tillman@EXAMPLE.ORG</code> may need
	access to the local user account <code class="systemitem">webdevelopers</code>.  Other
	principals may also need access to that local account.</p><p xml:lang="en" lang="en">The <code class="filename">.k5login</code> and
	<code class="filename">.k5users</code> files, placed in a user's home
	directory, can be used to solve this problem.  For example, if
	the following <code class="filename">.k5login</code> is placed in the
	home directory of <code class="systemitem">webdevelopers</code>, both principals
	listed will have access to that account without requiring a
	shared password:</p><pre xml:lang="en" class="programlisting" lang="en">tillman@example.org
jdoe@example.org</pre><p xml:lang="en" lang="en">Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ksu&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ksu</span>(1)</span></a> for more information about
	<code class="filename">.k5users</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72113080"></a>13.5.4. 與 <acronym class="acronym">MIT</acronym> 的差異</h3></div></div></div><p xml:lang="en" lang="en">The major difference between the <acronym class="acronym">MIT</acronym>
	and Heimdal implementations is that <code class="command">kadmin</code>
	has a different, but equivalent, set of commands and uses a
	different protocol.  If the <acronym class="acronym">KDC</acronym> is
	<acronym class="acronym">MIT</acronym>, the Heimdal version of
	<code class="command">kadmin</code> cannot be used to administer the
	<acronym class="acronym">KDC</acronym> remotely, and vice versa.</p><p xml:lang="en" lang="en">Client applications may also use slightly different
	command line options to accomplish the same tasks.  Following
	the instructions at <a class="link" href="http://web.mit.edu/Kerberos/www/" target="_top">http://web.mit.edu/Kerberos/www/</a>
	is recommended.  Be careful of path issues: the
	<acronym class="acronym">MIT</acronym> port installs into
	<code class="filename">/usr/local/</code> by default, and the FreeBSD
	system applications run instead of the
	<acronym class="acronym">MIT</acronym> versions if <code class="envar">PATH</code> lists
	the system directories first.</p><p xml:lang="en" lang="en">When using MIT Kerberos as a <acronym class="acronym">KDC</acronym> on
	FreeBSD, the following edits should also be made to
	<code class="filename">rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">kerberos5_server="/usr/local/sbin/krb5kdc"
kadmind5_server="/usr/local/sbin/kadmind"
kerberos5_server_flags=""
kerberos5_server_enable="YES"
kadmind5_server_enable="YES"</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72125496"></a>13.5.5. <span class="application">Kerberos</span> 提示、技巧與疑難排解</h3></div></div></div><p xml:lang="en" lang="en">When configuring and troubleshooting
	<span class="application">Kerberos</span>, keep the following points
	in mind:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">When using either Heimdal or <acronym class="acronym">MIT</acronym>
	    <span class="application">Kerberos</span> from ports, ensure
	    that the <code class="envar">PATH</code> lists the port's versions of
	    the client applications before the system versions.</p></li><li class="listitem"><p xml:lang="en" lang="en">If all the computers in the realm do not have
	    synchronized time settings, authentication may fail.
	    <a class="xref" href="#network-ntp" title="29.11. NTP 時間校對">節 29.11, “NTP 時間校對”</a> describes how to synchronize
	    clocks using <acronym class="acronym">NTP</acronym>.</p></li><li class="listitem"><p xml:lang="en" lang="en">If the hostname is changed, the <code class="systemitem">host/</code> principal must be
	    changed and the keytab updated.  This also applies to
	    special keytab entries like the <code class="systemitem">HTTP/</code> principal used for
	    Apache's <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/mod_auth_kerb/pkg-descr">www/mod_auth_kerb</a>.</p></li><li class="listitem"><p xml:lang="en" lang="en">All hosts in the realm must be both forward and
	    reverse resolvable in <acronym class="acronym">DNS</acronym> or, at a
	    minimum, exist in <code class="filename">/etc/hosts</code>.  CNAMEs
	    will work, but the A and PTR records must be correct and
	    in place.  The error message for unresolvable hosts is not
	    intuitive: <span class="errorname">Kerberos5 refuses authentication
	      because Read req failed: Key table entry not
	      found</span>.</p></li><li class="listitem"><p xml:lang="en" lang="en">Some operating systems that act as clients to the
	    <acronym class="acronym">KDC</acronym> do not set the permissions for
	    <code class="command">ksu</code> to be setuid <code class="systemitem">root</code>.  This means that
	    <code class="command">ksu</code> does not work.  This is a
	    permissions problem, not a <acronym class="acronym">KDC</acronym>
	    error.</p></li><li class="listitem"><p xml:lang="en" lang="en">With <acronym class="acronym">MIT</acronym>
	    <span class="application">Kerberos</span>, to allow a principal
	    to have a ticket life longer than the default lifetime of
	    ten hours, use <code class="command">modify_principal</code> at the
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kadmin</span>(8)</span></a> prompt to change the
	    <code class="literal">maxlife</code> of both the principal in
	    question and the
	    <code class="systemitem">krbtgt</code>
	    principal.  The principal can then use
	    <code class="command">kinit -l</code> to request a ticket with a
	    longer lifetime.</p></li><li class="listitem"><p xml:lang="en" lang="en">When running a packet sniffer on the
	    <acronym class="acronym">KDC</acronym> to aid in troubleshooting while
	    running <code class="command">kinit</code> from a workstation, the
	    Ticket Granting Ticket (<acronym class="acronym">TGT</acronym>) is sent
	    immediately, even before the password is typed.  This is
	    because the <span class="application">Kerberos</span> server
	    freely transmits a <acronym class="acronym">TGT</acronym> to any
	    unauthorized request.  However, every
	    <acronym class="acronym">TGT</acronym> is encrypted in a key derived from
	    the user's password.  When a user types their password, it
	    is not sent to the <acronym class="acronym">KDC</acronym>, it is instead
	    used to decrypt the <acronym class="acronym">TGT</acronym> that
	    <code class="command">kinit</code> already obtained.  If the
	    decryption process results in a valid ticket with a valid
	    time stamp, the user has valid
	    <span class="application">Kerberos</span> credentials.  These
	    credentials include a session key for establishing secure
	    communications with the
	    <span class="application">Kerberos</span> server in the future,
	    as well as the actual <acronym class="acronym">TGT</acronym>, which is
	    encrypted with the <span class="application">Kerberos</span>
	    server's own key.  This second layer of encryption allows
	    the <span class="application">Kerberos</span> server to verify
	    the authenticity of each <acronym class="acronym">TGT</acronym>.</p></li><li class="listitem"><p xml:lang="en" lang="en">Host principals can have a longer ticket lifetime.  If
	    the user principal has a lifetime of a week but the host
	    being connected to has a lifetime of nine hours, the user
	    cache will have an expired host principal and the ticket
	    cache will not work as expected.</p></li><li class="listitem"><p xml:lang="en" lang="en">When setting up <code class="filename">krb5.dict</code> to
	    prevent specific bad passwords from being used as
	    described in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kadmind&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kadmind</span>(8)</span></a>, remember that it only
	    applies to principals that have a password policy assigned
	    to them.  The format used in
	    <code class="filename">krb5.dict</code> is one string per line.
	    Creating a symbolic link to
	    <code class="filename">/usr/share/dict/words</code> might be
	    useful.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72161976"></a>13.5.6. 減輕 <span class="application">Kerberos</span> 的限制</h3></div></div></div><a id="idp72163000" class="indexterm"></a><p xml:lang="en" lang="en">Since <span class="application">Kerberos</span> is an all or
	nothing approach, every service enabled on the network must
	either be modified to work with
	<span class="application">Kerberos</span> or be otherwise secured
	against network attacks.  This is to prevent user credentials
	from being stolen and re-used.  An example is when
	<span class="application">Kerberos</span> is enabled on all remote
	shells but the non-Kerberized <acronym class="acronym">POP3</acronym> mail
	server sends passwords in plain text.</p><p xml:lang="en" lang="en">The <acronym class="acronym">KDC</acronym> is a single point of failure.
	By design, the <acronym class="acronym">KDC</acronym> must be as secure as its
	master password database.  The <acronym class="acronym">KDC</acronym> should
	have absolutely no other services running on it and should be
	physically secure.  The danger is high because
	<span class="application">Kerberos</span> stores all passwords
	encrypted with the same master key which is stored as a file
	on the <acronym class="acronym">KDC</acronym>.</p><p xml:lang="en" lang="en">A compromised master key is not quite as bad as one might
	fear.  The master key is only used to encrypt the
	<span class="application">Kerberos</span> database and as a seed for
	the random number generator.  As long as access to the
	<acronym class="acronym">KDC</acronym> is secure, an attacker cannot do much
	with the master key.</p><p xml:lang="en" lang="en">If the <acronym class="acronym">KDC</acronym> is unavailable, network
	services are unusable as authentication cannot be performed.
	This can be alleviated with a single master
	<acronym class="acronym">KDC</acronym> and one or more slaves, and with
	careful implementation of secondary or fall-back
	authentication using <acronym class="acronym">PAM</acronym>.</p><p xml:lang="en" lang="en"><span class="application">Kerberos</span> allows users, hosts
	and services to authenticate between themselves.  It does not
	have a mechanism to authenticate the
	<acronym class="acronym">KDC</acronym> to the users, hosts, or services.  This
	means that a trojanned <code class="command">kinit</code> could record
	all user names and passwords.  File system integrity checking
	tools like <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/tripwire/pkg-descr">security/tripwire</a> can
	alleviate this.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72186296"></a>13.5.7. 相關資源與延伸資訊</h3></div></div></div><a id="idp72186936" class="indexterm"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www.faqs.org/faqs/Kerberos-faq/general/preamble.html" target="_top">
	      The <span class="application">Kerberos</span>
	      FAQ</a></p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://web.mit.edu/Kerberos/www/dialogue.html" target="_top">Designing
	      an Authentication System: a Dialog in Four
	      Scenes</a></p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="https://www.ietf.org/rfc/rfc4120.txt" target="_top">RFC
	      4120, The <span class="application">Kerberos</span> Network
	      Authentication Service (V5)</a></p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://web.mit.edu/Kerberos/www/" target="_top"><acronym class="acronym">MIT</acronym>
	      <span class="application">Kerberos</span> home
	      page</a></p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="https://www.h5l.org/" target="_top">Heimdal
	      <span class="application">Kerberos</span> home
	      page</a></p></li></ul></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="openssl"></a>13.6. OpenSSL</h2></div><div><span class="authorgroup">Written
	  by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp72203448" class="indexterm"></a><p xml:lang="en" lang="en"><span class="application">OpenSSL</span> is an open source
      implementation of the <acronym class="acronym">SSL</acronym> and
      <acronym class="acronym">TLS</acronym> protocols.  It provides an encryption
      transport layer on top of the normal communications layer,
      allowing it to be intertwined with many network applications and
      services.</p><p xml:lang="en" lang="en">The version of <span class="application">OpenSSL</span> included
      in FreeBSD supports the Secure Sockets Layer 3.0 (SSLv3)
      and Transport Layer Security 1.0/1.1/1.2 (TLSv1/TLSv1.1/TLSv1.2)
      network security
      protocols and can be used as a general cryptographic
      library.  In FreeBSD 12.0-RELEASE and above, OpenSSL also supports
      Transport Layer Security 1.3 (TLSv1.3).</p><p xml:lang="en" lang="en"><span class="application">OpenSSL</span> is often used to encrypt
      authentication of mail clients and to secure web based
      transactions such as credit card payments.  Some ports, such as
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/apache24/pkg-descr">www/apache24</a> and
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/databases/postgresql11-server/pkg-descr">databases/postgresql11-server</a>, include a
      compile option for building with
      <span class="application">OpenSSL</span>.  If selected, the port will
      add support using <span class="application">OpenSSL</span> from the
      base system.  To instead have the port compile against
      <span class="application">OpenSSL</span> from the
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/openssl/pkg-descr">security/openssl</a> port, add the following to
      <code class="filename">/etc/make.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">DEFAULT_VERSIONS+= ssl=openssl</pre><p xml:lang="en" lang="en">Another common use of <span class="application">OpenSSL</span> is
      to provide certificates for use with software applications.
      Certificates can be used to verify the credentials of a company
      or individual.  If a certificate has not been signed by an
      external <em class="firstterm">Certificate Authority</em>
      (<acronym class="acronym">CA</acronym>), such as <a class="link" href="http://www.verisign.com" target="_top">http://www.verisign.com</a>,
      the application that uses the certificate will produce a
      warning.  There is a cost associated with obtaining a signed
      certificate and using a signed certificate is not mandatory as
      certificates can be self-signed.  However, using an external
      authority will prevent warnings and can put users at
      ease.</p><p xml:lang="en" lang="en">This section demonstrates how to create and use certificates
      on a FreeBSD system.  Refer to <a class="xref" href="#ldap-config" title="29.5.2. 設定 LDAP 伺服器">節 29.5.2, “設定 <acronym class="acronym">LDAP</acronym> 伺服器”</a> for an
      example of how to create a <acronym class="acronym">CA</acronym> for signing
      one's own certificates.</p><p xml:lang="en" lang="en">For more information about <acronym class="acronym">SSL</acronym>, read the
      free <a class="link" href="https://www.feistyduck.com/books/openssl-cookbook/" target="_top">OpenSSL
	Cookbook</a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72220088"></a>13.6.1. 產生憑証</h3></div></div></div><a id="idp72220728" class="indexterm"></a><p xml:lang="en" lang="en">To generate a certificate that will be signed by an
	external <acronym class="acronym">CA</acronym>, issue the following command
	and input the information requested at the prompts.  This
	input information will be written to the certificate.  At the
	<code class="literal">Common Name</code> prompt, input the fully
	qualified name for the system that will use the certificate.
	If this name does not match the server, the application
	verifying the certificate will issue a warning to the user,
	rendering the verification provided by the certificate as
	useless.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>openssl req -new -nodes -out req.pem -keyout cert.key -sha256 -newkey rsa:2048</code></strong>
Generating a 2048 bit RSA private key
..................+++
.............................................................+++
writing new private key to 'cert.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:<strong class="userinput"><code><em class="replaceable"><code>US</code></em></code></strong>
State or Province Name (full name) [Some-State]:<strong class="userinput"><code><em class="replaceable"><code>PA</code></em></code></strong>
Locality Name (eg, city) []:<strong class="userinput"><code><em class="replaceable"><code>Pittsburgh</code></em></code></strong>
Organization Name (eg, company) [Internet Widgits Pty Ltd]:<strong class="userinput"><code><em class="replaceable"><code>My Company</code></em></code></strong>
Organizational Unit Name (eg, section) []:<strong class="userinput"><code><em class="replaceable"><code>Systems Administrator</code></em></code></strong>
Common Name (eg, YOUR name) []:<strong class="userinput"><code><em class="replaceable"><code>localhost.example.org</code></em></code></strong>
Email Address []:<strong class="userinput"><code><em class="replaceable"><code>trhodes@FreeBSD.org</code></em></code></strong>

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:<strong class="userinput"><code><em class="replaceable"><code>Another Name</code></em></code></strong></pre><p xml:lang="en" lang="en">Other options, such as the expire time and alternate
	encryption algorithms, are available when creating a
	certificate.  A complete list of options is described in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=openssl&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">openssl</span>(1)</span></a>.</p><p xml:lang="en" lang="en">This command will create two files in the current
	directory.  The certificate request,
	<code class="filename">req.pem</code>, can be sent to a
	<acronym class="acronym">CA</acronym> who will validate the entered
	credentials, sign the request, and return the signed
	certificate.  The second file,
	<code class="filename">cert.key</code>, is the private key for the
	certificate and should be stored in a secure location.  If
	this falls in the hands of others, it can be used to
	impersonate the user or the server.</p><p xml:lang="en" lang="en">Alternately, if a signature from a <acronym class="acronym">CA</acronym>
	is not required, a self-signed certificate can be created.
	First, generate the <acronym class="acronym">RSA</acronym> key:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>openssl genrsa -rand -genkey -out cert.key 2048</code></strong>
0 semi-random bytes loaded
Generating RSA private key, 2048 bit long modulus
.............................................+++
.................................................................................................................+++
e is 65537 (0x10001)</pre><p xml:lang="en" lang="en">Use this key to create a self-signed certificate.
	Follow the usual prompts for creating a certificate:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>openssl req -new -x509 -days 365 -key cert.key -out cert.crt -sha256</code></strong>
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:<strong class="userinput"><code><em class="replaceable"><code>US</code></em></code></strong>
State or Province Name (full name) [Some-State]:<strong class="userinput"><code><em class="replaceable"><code>PA</code></em></code></strong>
Locality Name (eg, city) []:<strong class="userinput"><code><em class="replaceable"><code>Pittsburgh</code></em></code></strong>
Organization Name (eg, company) [Internet Widgits Pty Ltd]:<strong class="userinput"><code><em class="replaceable"><code>My Company</code></em></code></strong>
Organizational Unit Name (eg, section) []:<strong class="userinput"><code><em class="replaceable"><code>Systems Administrator</code></em></code></strong>
Common Name (e.g. server FQDN or YOUR name) []:<strong class="userinput"><code><em class="replaceable"><code>localhost.example.org</code></em></code></strong>
Email Address []:<strong class="userinput"><code><em class="replaceable"><code>trhodes@FreeBSD.org</code></em></code></strong></pre><p xml:lang="en" lang="en">This will create two new files in the current directory: a
	private key file
	<code class="filename">cert.key</code>, and the certificate itself,
	<code class="filename">cert.crt</code>.  These should be placed in a
	directory, preferably under <code class="filename">/etc/ssl/</code>,
	which is readable only by <code class="systemitem">root</code>.  Permissions of
	<code class="literal">0700</code> are appropriate for these files and
	can be set using <code class="command">chmod</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72274872"></a>13.6.2. 使用憑證</h3></div></div></div><p xml:lang="en" lang="en">One use for a certificate is to encrypt connections to the
	<span class="application">Sendmail</span> mail server in order to
	prevent the use of clear text authentication.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Some mail clients will display an error if the user has
	  not installed a local copy of the certificate.  Refer to the
	  documentation included with the software for more
	  information on certificate installation.</p></div><p xml:lang="en" lang="en">In FreeBSD 10.0-RELEASE and above, it is possible to create a
	self-signed certificate for
	<span class="application">Sendmail</span> automatically.  To enable
	this, add the following lines to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">sendmail_enable="YES"
sendmail_cert_create="YES"
sendmail_cert_cn="<em class="replaceable"><code>localhost.example.org</code></em>"</pre><p xml:lang="en" lang="en">This will automatically create a self-signed certificate,
	<code class="filename">/etc/mail/certs/host.cert</code>, a signing key,
	<code class="filename">/etc/mail/certs/host.key</code>, and a
	<acronym class="acronym">CA</acronym> certificate,
	<code class="filename">/etc/mail/certs/cacert.pem</code>.  The
	certificate will use the <code class="literal">Common Name</code>
	specified in <code class="option">sendmail_cert_cn</code>.  After saving
	the edits, restart <span class="application">Sendmail</span>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service sendmail restart</code></strong></pre><p xml:lang="en" lang="en">If all went well, there will be no error messages in
	<code class="filename">/var/log/maillog</code>.  For a simple test,
	connect to the mail server's listening port using
	<code class="command">telnet</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>telnet <em class="replaceable"><code>example.com</code></em> 25</code></strong>
Trying 192.0.34.166...
Connected to example.com.
Escape character is '^]'.
220 example.com ESMTP Sendmail 8.14.7/8.14.7; Fri, 18 Apr 2014 11:50:32 -0400 (EDT)
<strong class="userinput"><code>ehlo <em class="replaceable"><code>example.com</code></em></code></strong>
250-example.com Hello example.com [192.0.34.166], pleased to meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE
250-DSN
250-ETRN
250-AUTH LOGIN PLAIN
250-STARTTLS
250-DELIVERBY
250 HELP
<strong class="userinput"><code>quit</code></strong>
221 2.0.0 example.com closing connection
Connection closed by foreign host.</pre><p xml:lang="en" lang="en">If the <code class="literal">STARTTLS</code> line appears in the
	output, everything is working correctly.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ipsec"></a>13.7. <acronym class="acronym">VPN</acronym> over
	<acronym class="acronym">IPsec</acronym></h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Nik</span> <span class="surname">Clayton</span></span>. </span></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Hiten M.</span> <span class="surname">Pandya</span></span>. </span></div></div></div><a id="idp72297912" class="indexterm"></a><p xml:lang="en" lang="en">Internet Protocol Security (<acronym class="acronym">IPsec</acronym>) is a
      set of protocols which sit on top of the Internet Protocol
      (<acronym class="acronym">IP</acronym>) layer.  It allows two or more hosts to
      communicate in a secure manner by authenticating and encrypting
      each <acronym class="acronym">IP</acronym> packet of a communication session.
      The FreeBSD <acronym class="acronym">IPsec</acronym> network stack is based on the
      <a class="link" href="http://www.kame.net/" target="_top">http://www.kame.net/</a>
      implementation and supports both <acronym class="acronym">IPv4</acronym> and
      <acronym class="acronym">IPv6</acronym> sessions.</p><a id="idp72306488" class="indexterm"></a><a id="idp72307896" class="indexterm"></a><p xml:lang="en" lang="en"><acronym class="acronym">IPsec</acronym> is comprised of the following
      sub-protocols:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>Encapsulated Security Payload
	    (<acronym class="acronym">ESP</acronym>)</em></span>: this protocol
	  protects the <acronym class="acronym">IP</acronym> packet data from third
	  party interference by encrypting the contents using
	  symmetric cryptography algorithms such as Blowfish and
	  <acronym class="acronym">3DES</acronym>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>Authentication Header
	    (<acronym class="acronym">AH</acronym>)</em></span>: this protocol
	  protects the <acronym class="acronym">IP</acronym> packet header from third
	  party interference and spoofing by computing a cryptographic
	  checksum and hashing the <acronym class="acronym">IP </acronym> packet
	  header fields with a secure hashing function.  This is then
	  followed by an additional header that contains the hash, to
	  allow the information in the packet to be
	  authenticated.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>IP Payload Compression Protocol
	    (<acronym class="acronym">IPComp</acronym></em></span>): this protocol
	  tries to increase communication performance by compressing
	  the <acronym class="acronym">IP </acronym> payload in order to reduce the
	  amount of data sent.</p></li></ul></div><p xml:lang="en" lang="en">These protocols can either be used together or separately,
      depending on the environment.</p><a id="idp72313400" class="indexterm"></a><a id="idp72314424" class="indexterm"></a><p xml:lang="en" lang="en"><acronym class="acronym">IPsec</acronym> supports two modes of operation.
      The first mode, <em class="firstterm">Transport Mode</em>, protects
      communications between two hosts.  The second mode,
      <em class="firstterm">Tunnel Mode</em>, is used to build virtual
      tunnels, commonly known as Virtual Private Networks
      (<acronym class="acronym">VPN</acronym>s).  Consult <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipsec&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipsec</span>(4)</span></a> for detailed
      information on the <acronym class="acronym">IPsec</acronym> subsystem in
      FreeBSD.</p><p>在 FreeBSD 11 與之後的版本預設會開啟 <acronym class="acronym">IPsec</acronym> 功能，先前版本的 FreeBSD 可在自訂核心設定檔中加入以下選項然後依 <a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a> 的指示來重新編譯核心：</p><a id="idp72336312" class="indexterm"></a><pre xml:lang="en" class="screen" lang="en">options   IPSEC        #IP security
device    crypto</pre><a id="idp72337720" class="indexterm"></a><p xml:lang="en" lang="en">If <acronym class="acronym">IPsec</acronym> debugging support is desired,
      the following kernel option should also be added:</p><pre xml:lang="en" class="screen" lang="en">options   IPSEC_DEBUG  #debug for IP security</pre><p xml:lang="en" lang="en">This rest of this chapter demonstrates the process of
      setting up an <acronym class="acronym">IPsec</acronym> <acronym class="acronym">VPN</acronym>
      between a home network and a corporate network.  In the example
      scenario:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Both sites are connected to the Internet through a
	  gateway that is running FreeBSD.</p></li><li class="listitem"><p xml:lang="en" lang="en">The gateway on each network has at least one external
	  <acronym class="acronym">IP</acronym> address.  In this example, the
	  corporate <acronym class="acronym">LAN</acronym>'s external
	  <acronym class="acronym">IP</acronym> address is <code class="systemitem">172.16.5.4</code> and the home
	  <acronym class="acronym">LAN</acronym>'s external <acronym class="acronym">IP</acronym>
	  address is <code class="systemitem">192.168.1.12</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en">The internal addresses of the two networks can be either
	  public or private <acronym class="acronym">IP</acronym> addresses.  However,
	  the address space must not collide.  For example, both
	  networks cannot use <code class="systemitem">192.168.1.x</code>.  In this
	  example, the corporate <acronym class="acronym">LAN</acronym>'s internal
	  <acronym class="acronym">IP</acronym> address is <code class="systemitem">10.246.38.1</code> and the home
	  <acronym class="acronym">LAN</acronym>'s internal <acronym class="acronym">IP</acronym>
	  address is <code class="systemitem">10.0.0.5</code>.</p></li></ul></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72350776"></a>13.7.1. 在 FreeBSD 上設定 <acronym class="acronym">VPN</acronym></h3></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p xml:lang="en" lang="en">To begin, <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/ipsec-tools/pkg-descr">security/ipsec-tools</a> must be
	installed from the Ports Collection.  This software provides a
	number of applications which support the configuration.</p><p xml:lang="en" lang="en">The next requirement is to create two <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gif&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gif</span>(4)</span></a>
	pseudo-devices which will be used to tunnel packets and allow
	both networks to communicate properly.  As <code class="systemitem">root</code>, run the following
	commands, replacing <em class="replaceable"><code>internal</code></em> and
	<em class="replaceable"><code>external</code></em> with the real IP
	addresses of the internal and external interfaces of the two
	gateways:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig gif0 create</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig gif0 <em class="replaceable"><code>internal1 internal2</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig gif0 tunnel <em class="replaceable"><code>external1 external2</code></em></code></strong></pre><p xml:lang="en" lang="en">Verify the setup on each gateway, using
	<code class="command">ifconfig</code>.  Here is the output from Gateway
	1:</p><pre xml:lang="en" class="programlisting" lang="en">gif0: flags=8051 mtu 1280
tunnel inet 172.16.5.4 --&gt; 192.168.1.12
inet6 fe80::2e0:81ff:fe02:5881%gif0 prefixlen 64 scopeid 0x6
inet 10.246.38.1 --&gt; 10.0.0.5 netmask 0xffffff00</pre><p xml:lang="en" lang="en">Here is the output from Gateway 2:</p><pre xml:lang="en" class="programlisting" lang="en">gif0: flags=8051 mtu 1280
tunnel inet 192.168.1.12 --&gt; 172.16.5.4
inet 10.0.0.5 --&gt; 10.246.38.1 netmask 0xffffff00
inet6 fe80::250:bfff:fe3a:c1f%gif0 prefixlen 64 scopeid 0x4</pre><p xml:lang="en" lang="en">Once complete, both internal <acronym class="acronym">IP</acronym>
	addresses should be reachable using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a>:</p><pre xml:lang="en" class="programlisting" lang="en">priv-net# ping 10.0.0.5
PING 10.0.0.5 (10.0.0.5): 56 data bytes
64 bytes from 10.0.0.5: icmp_seq=0 ttl=64 time=42.786 ms
64 bytes from 10.0.0.5: icmp_seq=1 ttl=64 time=19.255 ms
64 bytes from 10.0.0.5: icmp_seq=2 ttl=64 time=20.440 ms
64 bytes from 10.0.0.5: icmp_seq=3 ttl=64 time=21.036 ms
--- 10.0.0.5 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max/stddev = 19.255/25.879/42.786/9.782 ms

corp-net# ping 10.246.38.1
PING 10.246.38.1 (10.246.38.1): 56 data bytes
64 bytes from 10.246.38.1: icmp_seq=0 ttl=64 time=28.106 ms
64 bytes from 10.246.38.1: icmp_seq=1 ttl=64 time=42.917 ms
64 bytes from 10.246.38.1: icmp_seq=2 ttl=64 time=127.525 ms
64 bytes from 10.246.38.1: icmp_seq=3 ttl=64 time=119.896 ms
64 bytes from 10.246.38.1: icmp_seq=4 ttl=64 time=154.524 ms
--- 10.246.38.1 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 28.106/94.594/154.524/49.814 ms</pre><p xml:lang="en" lang="en">As expected, both sides have the ability to send and
	receive <acronym class="acronym">ICMP</acronym> packets from the privately
	configured addresses.  Next, both gateways must be told how to
	route packets in order to correctly send traffic from either
	network.  The following commands will achieve this
	goal:</p><pre xml:lang="en" class="screen" lang="en">corp-net<code class="prompt">#</code> <strong class="userinput"><code>route add <em class="replaceable"><code>10.0.0.0 10.0.0.5 255.255.255.0</code></em></code></strong>
corp-net<code class="prompt">#</code> <strong class="userinput"><code>route add net <em class="replaceable"><code>10.0.0.0: gateway 10.0.0.5</code></em></code></strong>
priv-net<code class="prompt">#</code> <strong class="userinput"><code>route add <em class="replaceable"><code>10.246.38.0 10.246.38.1 255.255.255.0</code></em></code></strong>
priv-net<code class="prompt">#</code> <strong class="userinput"><code>route add host <em class="replaceable"><code>10.246.38.0: gateway 10.246.38.1</code></em></code></strong></pre><p xml:lang="en" lang="en">At this point, internal machines should be reachable from
	each gateway as well as from machines behind the gateways.
	Again, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a> to confirm:</p><pre xml:lang="en" class="programlisting" lang="en">corp-net# ping 10.0.0.8
PING 10.0.0.8 (10.0.0.8): 56 data bytes
64 bytes from 10.0.0.8: icmp_seq=0 ttl=63 time=92.391 ms
64 bytes from 10.0.0.8: icmp_seq=1 ttl=63 time=21.870 ms
64 bytes from 10.0.0.8: icmp_seq=2 ttl=63 time=198.022 ms
64 bytes from 10.0.0.8: icmp_seq=3 ttl=63 time=22.241 ms
64 bytes from 10.0.0.8: icmp_seq=4 ttl=63 time=174.705 ms
--- 10.0.0.8 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 21.870/101.846/198.022/74.001 ms

priv-net# ping 10.246.38.107
PING 10.246.38.1 (10.246.38.107): 56 data bytes
64 bytes from 10.246.38.107: icmp_seq=0 ttl=64 time=53.491 ms
64 bytes from 10.246.38.107: icmp_seq=1 ttl=64 time=23.395 ms
64 bytes from 10.246.38.107: icmp_seq=2 ttl=64 time=23.865 ms
64 bytes from 10.246.38.107: icmp_seq=3 ttl=64 time=21.145 ms
64 bytes from 10.246.38.107: icmp_seq=4 ttl=64 time=36.708 ms
--- 10.246.38.107 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 21.145/31.721/53.491/12.179 ms</pre><p xml:lang="en" lang="en">Setting up the tunnels is the easy part.  Configuring a
	secure link is a more in depth process.  The following
	configuration uses pre-shared (<acronym class="acronym">PSK</acronym>)
	<acronym class="acronym">RSA</acronym> keys.  Other than the
	<acronym class="acronym">IP</acronym> addresses, the
	<code class="filename">/usr/local/etc/racoon/racoon.conf</code> on both
	gateways will be identical and look similar to:</p><pre xml:lang="en" class="programlisting" lang="en">path    pre_shared_key  "/usr/local/etc/racoon/psk.txt"; #location of pre-shared key file
log     debug;	#log verbosity setting: set to 'notify' when testing and debugging is complete

padding	# options are not to be changed
{
        maximum_length  20;
        randomize       off;
        strict_check    off;
        exclusive_tail  off;
}

timer	# timing options. change as needed
{
        counter         5;
        interval        20 sec;
        persend         1;
#       natt_keepalive  15 sec;
        phase1          30 sec;
        phase2          15 sec;
}

listen	# address [port] that racoon will listen on
{
        isakmp          172.16.5.4 [500];
        isakmp_natt     172.16.5.4 [4500];
}

remote  192.168.1.12 [500]
{
        exchange_mode   main,aggressive;
        doi             ipsec_doi;
        situation       identity_only;
        my_identifier   address 172.16.5.4;
        peers_identifier        address 192.168.1.12;
        lifetime        time 8 hour;
        passive         off;
        proposal_check  obey;
#       nat_traversal   off;
        generate_policy off;

                        proposal {
                                encryption_algorithm    blowfish;
                                hash_algorithm          md5;
                                authentication_method   pre_shared_key;
                                lifetime time           30 sec;
                                dh_group                1;
                        }
}

sainfo  (address 10.246.38.0/24 any address 10.0.0.0/24 any)	# address $network/$netmask $type address $network/$netmask $type ( $type being any or esp)
{								# $network must be the two internal networks you are joining.
        pfs_group       1;
        lifetime        time    36000 sec;
        encryption_algorithm    blowfish,3des;
        authentication_algorithm        hmac_md5,hmac_sha1;
        compression_algorithm   deflate;
}</pre><p xml:lang="en" lang="en">For descriptions of each available option, refer to the
	manual page for <code class="filename">racoon.conf</code>.</p><p xml:lang="en" lang="en">The Security Policy Database (<acronym class="acronym">SPD</acronym>)
	needs to be configured so that FreeBSD and
	<span class="application">racoon</span> are able to encrypt and
	decrypt network traffic between the hosts.</p><p xml:lang="en" lang="en">This can be achieved with a shell script, similar to the
	following, on the corporate gateway.  This file will be used
	during system initialization and should be saved as
	<code class="filename">/usr/local/etc/racoon/setkey.conf</code>.</p><pre xml:lang="en" class="programlisting" lang="en">flush;
spdflush;
# To the home network
spdadd 10.246.38.0/24 10.0.0.0/24 any -P out ipsec esp/tunnel/172.16.5.4-192.168.1.12/use;
spdadd 10.0.0.0/24 10.246.38.0/24 any -P in ipsec esp/tunnel/192.168.1.12-172.16.5.4/use;</pre><p xml:lang="en" lang="en">Once in place, <span class="application">racoon</span> may be
	started on both gateways using the following command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>/usr/local/sbin/racoon -F -f /usr/local/etc/racoon/racoon.conf -l /var/log/racoon.log</code></strong></pre><p xml:lang="en" lang="en">The output should be similar to the following:</p><pre xml:lang="en" class="programlisting" lang="en">corp-net# /usr/local/sbin/racoon -F -f /usr/local/etc/racoon/racoon.conf
Foreground mode.
2006-01-30 01:35:47: INFO: begin Identity Protection mode.
2006-01-30 01:35:48: INFO: received Vendor ID: KAME/racoon
2006-01-30 01:35:55: INFO: received Vendor ID: KAME/racoon
2006-01-30 01:36:04: INFO: ISAKMP-SA established 172.16.5.4[500]-192.168.1.12[500] spi:623b9b3bd2492452:7deab82d54ff704a
2006-01-30 01:36:05: INFO: initiate new phase 2 negotiation: 172.16.5.4[0]192.168.1.12[0]
2006-01-30 01:36:09: INFO: IPsec-SA established: ESP/Tunnel 192.168.1.12[0]-&gt;172.16.5.4[0] spi=28496098(0x1b2d0e2)
2006-01-30 01:36:09: INFO: IPsec-SA established: ESP/Tunnel 172.16.5.4[0]-&gt;192.168.1.12[0] spi=47784998(0x2d92426)
2006-01-30 01:36:13: INFO: respond new phase 2 negotiation: 172.16.5.4[0]192.168.1.12[0]
2006-01-30 01:36:18: INFO: IPsec-SA established: ESP/Tunnel 192.168.1.12[0]-&gt;172.16.5.4[0] spi=124397467(0x76a279b)
2006-01-30 01:36:18: INFO: IPsec-SA established: ESP/Tunnel 172.16.5.4[0]-&gt;192.168.1.12[0] spi=175852902(0xa7b4d66)</pre><p xml:lang="en" lang="en">To ensure the tunnel is working properly, switch to
	another console and use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tcpdump&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tcpdump</span>(1)</span></a> to view network
	traffic using the following command.  Replace
	<code class="literal">em0</code> with the network interface card as
	required:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>tcpdump -i em0 host <em class="replaceable"><code>172.16.5.4 and dst 192.168.1.12</code></em></code></strong></pre><p xml:lang="en" lang="en">Data similar to the following should appear on the
	console.  If not, there is an issue and debugging the
	returned data will be required.</p><pre xml:lang="en" class="programlisting" lang="en">01:47:32.021683 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xa)
01:47:33.022442 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xb)
01:47:34.024218 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xc)</pre><p xml:lang="en" lang="en">At this point, both networks should be available and seem
	to be part of the same network.  Most likely both networks are
	protected by a firewall.  To allow traffic to flow between
	them, rules need to be added to pass packets.  For the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a> firewall, add the following lines to the firewall
	configuration file:</p><pre xml:lang="en" class="programlisting" lang="en">ipfw add 00201 allow log esp from any to any
ipfw add 00202 allow log ah from any to any
ipfw add 00203 allow log ipencap from any to any
ipfw add 00204 allow log udp from any 500 to any</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The rule numbers may need to be altered depending on the
	  current host configuration.</p></div><p xml:lang="en" lang="en">For users of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pf&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pf</span>(4)</span></a> or <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipf</span>(8)</span></a>, the following
	rules should do the trick:</p><pre xml:lang="en" class="programlisting" lang="en">pass in quick proto esp from any to any
pass in quick proto ah from any to any
pass in quick proto ipencap from any to any
pass in quick proto udp from any port = 500 to any port = 500
pass in quick on gif0 from any to any
pass out quick proto esp from any to any
pass out quick proto ah from any to any
pass out quick proto ipencap from any to any
pass out quick proto udp from any port = 500 to any port = 500
pass out quick on gif0 from any to any</pre><p xml:lang="en" lang="en">Finally, to allow the machine to start support for the
	<acronym class="acronym">VPN</acronym> during system initialization, add the
	following lines to <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">ipsec_enable="YES"
ipsec_program="/usr/local/sbin/setkey"
ipsec_file="/usr/local/etc/racoon/setkey.conf" # allows setting up spd policies on boot
racoon_enable="yes"</pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="openssh"></a>13.8. OpenSSH</h2></div><div><span class="authorgroup">Contributed
	  by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Chern</span> <span class="surname">Lee</span></span>. </span></div></div></div><a id="idp72434488" class="indexterm"></a><a id="idp72435128" class="indexterm"></a><p><span class="application">OpenSSH</span> 是一套網路連線工具，可安全的存取遠端的主機，此外，透過 <acronym class="acronym">SSH</acronym> 連線可以建立 <acronym class="acronym">TCP/IP</acronym> 連線通道或安全的轉送 <acronym class="acronym">TCP/IP</acronym> 的封包。<span class="application">OpenSSH</span> 會對所有傳輸的資料做加密，可有效的避免竊聽 (Eavesdropping)、或連線劫持 (Connection hijacking) 與其他網路層的攻擊。</p><p><span class="application">OpenSSH</span> 由 OpenBSD 專案所維護且在 FreeBSD 預設會安裝，它可同時相容 <acronym class="acronym">SSH</acronym> 版本 1 與 2 通訊協定。</p><p>當以未加密的方式在網路上傳送資料時，任何在客戶端與伺服器之間的網路竊聽程式 (Network sniffer) 皆可竊取使用者/密碼資訊或者在連線階段傳送的資料，<span class="application">OpenSSH</span> 提供了數種認証與加密方式來避免這種事情發生。更多有關 <span class="application">OpenSSH</span> 的資訊可於 <a class="link" href="http://www.openssh.com/" target="_top">http://www.openssh.com/</a> 取得。</p><p>本節會簡單介紹如何使用內建的客戶端工具安全的存取其他系統及安全的傳輸檔案到 FreeBSD 系統，然後會說明如何設定在 FreeBSD 系統上的 <acronym class="acronym">SSH</acronym> 伺服器。更多的資訊可於本章節所提及的操作手冊 (Man page) 取得。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72454328"></a>13.8.1. 使用 SSH 客戶端工具</h3></div></div></div><a id="idp72454968" class="indexterm"></a><p>要登入一台 <acronym class="acronym">SSH</acronym> 伺服器，可使用 <code class="command">ssh</code> 然後指定在伺服器上存在的使用者名稱與 <acronym class="acronym">IP</acronym> 位址或伺服器的主機名稱。若這是第一次連線到指定的伺服器，會提示該使用者伺服器的指紋做第一次檢驗：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ssh <em class="replaceable"><code>user@example.com</code></em></code></strong>
The authenticity of host 'example.com (10.0.0.1)' can't be established.
ECDSA key fingerprint is 25:cc:73:b5:b3:96:75:3d:56:19:49:d2:5c:1f:91:3b.
Are you sure you want to continue connecting (yes/no)? <strong class="userinput"><code>yes</code></strong>
Permanently added 'example.com' (ECDSA) to the list of known hosts.
Password for user@example.com: <strong class="userinput"><code><em class="replaceable"><code>user_password</code></em></code></strong></pre><p><acronym class="acronym">SSH</acronym> 會在客戶端連線時利用金鑰指紋 (Key fingerprint) 系統來驗證伺服器的真偽，當使用者在第一次連線時輸入 <code class="literal">yes</code> 接受了這個金鑰指紋，便會將該金鑰的複本儲存到使用者家目錄的 <code class="filename">.ssh/known_hosts</code>，未來嘗試登入時便會以這個存好的金鑰來驗證，若伺服器的金鑰與儲存的金鑰不同將會顯示警告訊息。若出現這個警告時，使用者應在繼續連線之前檢查金鑰變動的原因。</p><p>最近版本的 <span class="application">OpenSSH</span> 預設只會接受 <acronym class="acronym">SSH</acronym>v2 的連線。客戶端預設會盡可能使用版本 2 的通訊協定，若伺服器不支援版本 2 的通訊協定便會向下相容版本 1 的協定。要強制 <code class="command">ssh</code> 只能使用指定的通訊協定，可使用 <code class="option">-1</code> 或 <code class="option">-2</code>，其他的選項在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> 中有說明。</p><a id="idp72468664" class="indexterm"></a><a id="idp72469944" class="indexterm"></a><p>使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a> 可從遠端主機安全的複製一個檔案，以下範例會複製在遠端主機的 <code class="filename">COPYRIGHT</code> 到本地主機的目前目錄：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>scp <em class="replaceable"><code>user@example.com:/COPYRIGHT COPYRIGHT</code></em></code></strong>
Password for user@example.com: <strong class="userinput"><code><em class="replaceable"><code>*******</code></em></code></strong>
COPYRIGHT            100% |*****************************|  4735
00:00
<code class="prompt">#</code></pre><p>由於這個主機的指紋已驗證過，在提示用者輸入密碼之前伺服器的金鑰已自動檢查。</p><p>傳給 <code class="command">scp</code> 的參數與傳給 <code class="command">cp</code> 的參數相似。第一個參數是要複製的檔案，第二個參數是目地，由於檔案是透過網路取得，檔案參數需要使用 <code class="option">user@host:&lt;path_to_remote_file&gt;</code> 格式。注意，在 <code class="command">scp</code> 要遞迴複製目錄是使用 <code class="option">-r</code>，如同 <code class="command">cp</code> 使用 <code class="option">-R</code>。</p><p>要開啟可互動的連線來複製檔案可使用 <code class="command">sftp</code>，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sftp&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sftp</span>(1)</span></a> 來取得在 <code class="command">sftp</code> 連線時可用的指令清單。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-ssh-keygen"></a>13.8.1.1. 以金鑰為基礎的認證</h4></div></div></div><p>除了使用密碼之外，客戶端可以設定成使用金鑰來連線到遠端的主機。要產生 <acronym class="acronym">RSA</acronym> 認証金鑰可使用 <code class="command">ssh-keygen</code>。要產生成對的公鑰與私鑰，可指定金鑰的類型並依提示操作。建議使用容易記住但較難猜出的密碼來保護這個金鑰。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>ssh-keygen -t rsa</code></strong>
Generating public/private rsa key pair.
Enter file in which to save the key (/home/user/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):  <a id="co-ssh-keygen-passphrase1"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
Enter same passphrase again:                 <a id="co-ssh-keygen-passphrase2"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
Your identification has been saved in /home/user/.ssh/id_rsa.
Your public key has been saved in /home/user/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:54Xm9Uvtv6H4NOo6yjP/YCfODryvUU7yWHzMqeXwhq8 user@host.example.com
The key's randomart image is:
+---[RSA 2048]----+
|                 |
|                 |
|                 |
|        . o..    |
|       .S*+*o    |
|      . O=Oo . . |
|       = Oo= oo..|
|      .oB.* +.oo.|
|       =OE**.o..=|
+----[SHA256]-----+</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-ssh-keygen-passphrase1"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>在此輸入密碼，密碼不可含有空白或符號。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ssh-keygen-passphrase2"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>再輸入一次密碼驗證。</p></td></tr></table></div><p>私鑰會儲存於 <code class="filename">~/.ssh/id_rsa</code> 而公鑰會儲存於 <code class="filename">~/.ssh/id_rsa.pub</code>。<span class="emphasis"><em>公鑰</em></span>必須複製到遠端主機的<code class="filename">~/.ssh/authorized_keys</code> 來讓以金鑰為基礎的認証可以運作。</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">許多使用者認為金鑰的設計是安全的並在產生金鑰時未使用密碼，這樣的行為其實很<span class="emphasis"><em>危險</em></span>。管理者可以手動查看私鑰來檢查金鑰對是否受密碼保護，如果私鑰檔案中包含 <code class="literal">ENCRYPTED</code> 字詞，則代表金鑰的擁有者有使用密碼。此外，要更進一步保護最終使用者的安全，可在公鑰檔案中放入 <code class="literal">from</code>，例如，在 <code class="literal">ssh-rsa</code> 前加上 <code class="literal">from="192.168.10.5"</code> 將只允許指定的使用者由該 IP 位址登入。</p></div><p>不同版本 <span class="application">OpenSSH</span> 的選項與檔案會不同，要避免發生問題請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh-keygen</span>(1)</span></a>。</p><p>若使用了密碼，在每次連線到伺服器時都會提示使用者輸入密碼。要將 <acronym class="acronym">SSH</acronym> 金鑰載入到記憶體並讓每次連線時不必再輸入密碼，可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a> 與 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh-add&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh-add</span>(1)</span></a>。</p><p>認証可用 <code class="command">ssh-agent</code> 來管理，只要將私鑰載入，<code class="command">ssh-agent</code> 可用在執行其他應用程式，如 Shell 或視窗管理程式。</p><p>要在 Shell 使用 <code class="command">ssh-agent</code>，使用 Shell 做為參數來啟動 <code class="command">ssh-agent</code>。執行 <code class="command">ssh-add</code> 來加入識別碼，然後輸入私鑰的密碼。使用者將可使用 <code class="command">ssh</code> 連線到任何有安裝對應公鑰的主機，例如：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>ssh-agent <em class="replaceable"><code>csh</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>ssh-add</code></strong>
Enter passphrase for key '/usr/home/user/.ssh/id_rsa':  <a id="co-ssh-agent-passphrase"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
Identity added: /usr/home/user/.ssh/id_rsa (/usr/home/user/.ssh/id_rsa)
<code class="prompt">%</code></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-ssh-agent-passphrase"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>輸入金鑰的密碼。</p></td></tr></table></div><p>要在 <span class="application">Xorg</span> 使用 <code class="command">ssh-agent</code> 可在 <code class="filename">~/.xinitrc</code> 加入一個設定項目，這可讓 <code class="command">ssh-agent</code> 對所有在 <span class="application">Xorg</span> 中執行的程式提供服務。<code class="filename">~/.xinitrc</code> 範例如下：</p><pre xml:lang="en" class="programlisting" lang="en">exec ssh-agent <em class="replaceable"><code>startxfce4</code></em></pre><p>這會在每次啟動 <span class="application">Xorg</span> 時，反過來先執行 <code class="command">ssh-agent</code> 再由執行 <span class="application">XFCE</span>，一但 <span class="application">Xorg</span> 被重新啟動，要讓所有變更生效需執行 <code class="command">ssh-add</code> 來載入所有的 <acronym class="acronym">SSH</acronym> 金鑰。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-ssh-tunneling"></a>13.8.1.2. <acronym class="acronym">SSH</acronym> 通道</h4></div></div></div><a id="idp72534328" class="indexterm"></a><p><span class="application">OpenSSH</span> 可以建立一個通道 (Tunnel) 來封裝其他通訊協定到一個加密的連線。</p><p>以下指令會告訴 <code class="command">ssh</code> 建立一個供 <span class="application">telnet</span> 使用的通道：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>ssh -2 -N -f -L <em class="replaceable"><code>5023:localhost:23 user@foo.example.com</code></em></code></strong>
<code class="prompt">%</code></pre><p>這個例子使用了以下選項：</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en"><code class="option">-2</code></span></dt><dd><p>強制 <code class="command">ssh</code> 使用版本 2 的通訊協定連線到伺服器。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="option">-N</code></span></dt><dd><p>代表不需下指令、只建立通道。若省略這個選項 <code class="command">ssh</code> 會初始化一個正常的連線。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="option">-f</code></span></dt><dd><p>強制 <code class="command">ssh</code> 在背景執行。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="option">-L</code></span></dt><dd><p>代表這是一個本地通道，使用 <em class="replaceable"><code>localport:remotehost:remoteport</code></em> 格式。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="option">user@foo.example.com</code></span></dt><dd><p>在指定的遠端 <acronym class="acronym">SSH</acronym> 伺服器要使用的登入名稱。</p></dd></dl></div><p>SSH 通道會建立一個傾聽 <code class="systemitem">localhost</code> 指定 <code class="literal">localport</code> 的 Socket ，然後會透過 <acronym class="acronym">SSH</acronym>  連線轉送任何在 <code class="literal">localport</code> 接收的連線。以這個例子來說在客戶端的 Port <code class="literal">5023</code> 會被轉送到遠端主機的 Port <code class="literal">23</code>，由於 Port 23 是由 <span class="application">telnet</span> 使用，所以這會透過 <acronym class="acronym">SSH</acronym> 通道建立一個加密的 <span class="application">telnet</span> 連線。</p><p>這個方法可用來包裝許多不安全的 <acronym class="acronym">TCP</acronym> 通訊協定，例如 <acronym class="acronym">SMTP</acronym>, <acronym class="acronym">POP3</acronym> 以及 <acronym class="acronym">FTP</acronym>，如下例所示。</p><div class="example"><a id="idp72589368"></a><div class="example-title">範例 13.1. 建立供 <acronym class="acronym">SMTP</acronym> 使用的安全通道</div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>ssh -2 -N -f -L <em class="replaceable"><code>5025:localhost:25 user@mailserver.example.com</code></em></code></strong>
user@mailserver.example.com's password: <strong class="userinput"><code>*****</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>telnet localhost 5025</code></strong>
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
220 mailserver.example.com ESMTP</pre><p>這可配合 <code class="command">ssh-keygen</code> 與另一個使用者帳號與來建立一個更無縫的 <acronym class="acronym">SSH</acronym> 通道環境，可使用金鑰來代替手動輸入密碼，然後該通道便可以另一個使用者執行。</p></div></div><br class="example-break" /><div class="example"><a id="idp72594360"></a><div class="example-title">範例 13.2. 安全存取 <acronym class="acronym">POP3</acronym> 伺服器</div><div class="example-contents"><p>在這個例子中有一個 <acronym class="acronym">SSH</acronym> 伺服器會接受來自外部的連線，在同個網段下有一個郵件伺服器執行 <acronym class="acronym">POP3</acronym> 伺服器。要使用較安全的方式檢查有沒有新郵件可建立一個 <acronym class="acronym">SSH</acronym> 連線到 <acronym class="acronym">SSH</acronym> 伺服器然後透過通道連線到郵件伺服器：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>ssh -2 -N -f -L <em class="replaceable"><code>2110:mail.example.com:110 user@ssh-server.example.com</code></em></code></strong>
user@ssh-server.example.com's password: <strong class="userinput"><code>******</code></strong></pre><p>一但通道啟動並執行後，指定郵件客戶端將 <acronym class="acronym">POP3</acronym> 請求傳送到 <code class="systemitem">localhost</code> 的 Port 2110，這個連線將會被安全的透過通道轉送到 <code class="systemitem">mail.example.com</code>。</p></div></div><br class="example-break" /><div class="example"><a id="idp72604728"></a><div class="example-title">範例 13.3. 跳過防火牆</div><div class="example-contents"><p>有些防火牆會同時過濾傳入與傳出的連線。例如，防火牆很可能會限制來自遠端主機只能存取 Port 22 與 80 來只讓 <acronym class="acronym">SSH</acronym> 與網頁瀏覽器連線，這會使得 Port 使用 22 或 80 以外的服務無法存取。</p><p>這問題的解決方法是建立一個 <acronym class="acronym">SSH</acronym> 連線到在防火牆防護之外主機然後使用該連線的通道連到想要使用的服務：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>ssh -2 -N -f -L <em class="replaceable"><code>8888:music.example.com:8000 user@unfirewalled-system.example.org</code></em></code></strong>
user@unfirewalled-system.example.org's password: <strong class="userinput"><code>*******</code></strong></pre><p>在這個例子中，串流 Ogg Vorbis 客戶端現在可以指向 <code class="systemitem">localhost</code> Port 8888，連線將會被轉送到 <code class="systemitem">music.example.com</code> 於 Port 8000，成功的跳過防火牆。</p></div></div><br class="example-break" /></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72610104"></a>13.8.2. 開啟 SSH 伺服器</h3></div></div></div><a id="idp72610744" class="indexterm"></a><p>除了提供內建的 <acronym class="acronym">SSH</acronym> 客戶端工具外，還可以設定 FreeBSD 系統為一個 <acronym class="acronym">SSH</acronym> 伺服器，以接受來自其他 <acronym class="acronym">SSH</acronym> 客戶端的連線。</p><p>要查看 <span class="application">sshd</span> 是否正在運作，可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=service&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">service</span>(8)</span></a> 指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service sshd status</code></strong></pre><p>若服務未執行，請加入下行到 <code class="filename">/etc/rc.conf</code>。</p><pre xml:lang="en" class="programlisting" lang="en">sshd_enable="YES"</pre><p>這會讓下次系統開機時啟動 <span class="application">OpenSSH</span> 的 Daemon 程式 <span class="application">sshd</span>。若要立即啟動：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service sshd start</code></strong></pre><p>在 FreeBSD 系統第一次啟動 <span class="application">sshd</span> 時便會自動產生系統的主機金鑰且會顯示指紋在  Console 上，這個指紋可供使用者在第一次連線到伺服器時驗證用。</p><p>請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> 可取得在啟動 <span class="application">sshd</span> 時可用選項的清單以及更多完整有關認証、登入程序與各種設定檔的資訊。</p><p>現在，<span class="application">sshd</span> 應可供所有在系統上有使用者名稱及密碼的使用者使用。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72627000"></a>13.8.3. SSH 伺服器安全性</h3></div></div></div><p>在 FreeBSD 廣泛使用 <span class="application">sshd</span> 做為遠端管理基礎設施的同時，所有暴露在公有網路上的系統也會時常受到暴力攻擊 (Brute force attack) 與路過攻擊 (Drive by attack)。在本節會介紹一些可用來避免這些攻擊的參數。</p><p>使用在 <span class="application">OpenSSH</span> 伺服器設定檔的 <code class="literal">AllowUsers</code> 關鍵字限制可以登入到 <acronym class="acronym">SSH</acronym> 伺服器的使用者及來源是一個不錯的方式。例如要只允許來自 <code class="systemitem">192.168.1.32</code> 的 <code class="systemitem">root</code> 登入，可加入下行到 <code class="filename">/etc/ssh/sshd_config</code>：</p><pre xml:lang="en" class="programlisting" lang="en">AllowUsers root@192.168.1.32</pre><p>要允許來自任何地方的 <code class="systemitem">admin</code> 登入，可只列出使用者名稱，不指定 <acronym class="acronym">IP</acronym> 位址：</p><pre xml:lang="en" class="programlisting" lang="en">AllowUsers admin</pre><p>有多位使用者也應列在同一行，例如：</p><pre xml:lang="en" class="programlisting" lang="en">AllowUsers root@192.168.1.32 admin</pre><p>在對 <code class="filename">/etc/ssh/sshd_config</code> 做完變更後，執行以下指令告訴 <span class="application">sshd</span> 重新載入設定檔：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service sshd reload</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">在使用了這個關鍵字時，列出每一位需要登入此主機的使用者很重要，任何未被在該行指定的使用者將無法登入。同時，在 <span class="application">OpenSSH</span> 伺服器設定檔使用的關鍵字是區分大小寫的，若關鍵字未正確的拼寫 (含其大小寫)，則將會被忽略，永遠要記得測試對這個檔案所做的更改來確保伺服器有如預期的方式運作。請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd_config&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd_config</span>(5)</span></a> 來檢查拼寫以及可用的關鍵字。</p></div><p>此外，使用者可能被強制要透過公鑰與私鑰使用雙重認證 (Two factor authentication)。當需要時，使用者可以透過使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh-keygen</span>(1)</span></a> 產生一堆金鑰然後將公鑰傳送給管理者，這個金鑰檔會如以上在客戶端章節所述的被放在 <code class="filename">authorized_keys</code>。要強制使用者只能使用這個金鑰，可能需要設定以下選項：</p><pre xml:lang="en" class="programlisting" lang="en">AuthenticationMethods publickey</pre><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml">請不要將 <code class="filename">/etc/ssh/sshd_config</code> 以及 <code class="filename">/etc/ssh/ssh_config</code> 搞混 (注意在第一節檔名有多出個 <code class="literal">d</code>)，第一個檔案用來設定伺服器，而第二個檔案用來設定客戶端。請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh_config&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh_config</span>(5)</span></a> 來取得可用的客戶端設定清單。</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="fs-acl"></a>13.9. 存取控制清單</h2></div><div><span class="authorgroup">Contributed
	  by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp72658744" class="indexterm"></a><p xml:lang="en" lang="en">Access Control Lists (<acronym class="acronym">ACL</acronym>s) extend the
      standard <span class="trademark">UNIX</span>® permission model in a <span class="trademark">POSIX</span>®.1e compatible way.
      This permits an administrator to take advantage of a more
      fine-grained permissions model.</p><p xml:lang="en" lang="en">The FreeBSD <code class="filename">GENERIC</code> kernel provides
      <acronym class="acronym">ACL</acronym> support for <acronym class="acronym">UFS</acronym> file
      systems.  Users who prefer to compile a custom kernel must
      include the following option in their custom kernel
      configuration file:</p><pre xml:lang="en" class="programlisting" lang="en">options UFS_ACL</pre><p xml:lang="en" lang="en">If this option is not compiled in, a warning message will be
      displayed when attempting to mount a file system with
      <acronym class="acronym">ACL</acronym> support.  <acronym class="acronym">ACL</acronym>s rely on
      extended attributes which are natively supported in
      <acronym class="acronym">UFS2</acronym>.</p><p xml:lang="en" lang="en">This chapter describes how to enable
      <acronym class="acronym">ACL</acronym> support and provides some usage
      examples.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72666552"></a>13.9.1. 開啟 <acronym class="acronym">ACL</acronym> 支援</h3></div></div></div><p xml:lang="en" lang="en"><acronym class="acronym">ACL</acronym>s are enabled by the mount-time
	administrative flag, <code class="option">acls</code>, which may be added
	to <code class="filename">/etc/fstab</code>.  The mount-time flag can
	also be automatically set in a persistent manner using
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a> to modify a superblock <acronym class="acronym">ACL</acronym>s
	flag in the file system header.  In general, it is preferred
	to use the superblock flag for several reasons:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">The superblock flag cannot be changed by a remount
	    using <code class="option">mount -u</code> as it requires a complete
	    <code class="command">umount</code> and fresh
	    <code class="command">mount</code>.  This means that
	    <acronym class="acronym">ACL</acronym>s cannot be enabled on the root file
	    system after boot.  It also means that
	    <acronym class="acronym">ACL</acronym> support on a file system cannot be
	    changed while the system is in use.</p></li><li class="listitem"><p xml:lang="en" lang="en">Setting the superblock flag causes the file system to
	    always be mounted with <acronym class="acronym">ACL</acronym>s enabled,
	    even if there is not an <code class="filename">fstab</code> entry
	    or if the devices re-order.  This prevents accidental
	    mounting of the file system without <acronym class="acronym">ACL</acronym>
	    support.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">It is desirable to discourage accidental mounting
	  without <acronym class="acronym">ACL</acronym>s enabled because nasty things
	  can happen if <acronym class="acronym">ACL</acronym>s are enabled, then
	  disabled, then re-enabled without flushing the extended
	  attributes.  In general, once <acronym class="acronym">ACL</acronym>s are
	  enabled on a file system, they should not be disabled, as
	  the resulting file protections may not be compatible with
	  those intended by the users of the system, and re-enabling
	  <acronym class="acronym">ACL</acronym>s may re-attach the previous
	  <acronym class="acronym">ACL</acronym>s to files that have since had their
	  permissions changed, resulting in unpredictable
	  behavior.</p></div><p xml:lang="en" lang="en">File systems with <acronym class="acronym">ACL</acronym>s enabled will
	show a plus (<code class="literal">+</code>) sign in their permission
	settings:</p><pre xml:lang="en" class="programlisting" lang="en">drwx------  2 robert  robert  512 Dec 27 11:54 private
drwxrwx---+ 2 robert  robert  512 Dec 23 10:57 directory1
drwxrwx---+ 2 robert  robert  512 Dec 22 10:20 directory2
drwxrwx---+ 2 robert  robert  512 Dec 27 11:57 directory3
drwxr-xr-x  2 robert  robert  512 Nov 10 11:54 public_html</pre><p xml:lang="en" lang="en">In this example, <code class="filename">directory1</code>,
	<code class="filename">directory2</code>, and
	<code class="filename">directory3</code> are all taking advantage of
	<acronym class="acronym">ACL</acronym>s, whereas
	<code class="filename">public_html</code> is not.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72691128"></a>13.9.2. 使用 <acronym class="acronym">ACL</acronym></h3></div></div></div><p xml:lang="en" lang="en">File system <acronym class="acronym">ACL</acronym>s can be viewed using
	<code class="command">getfacl</code>.  For instance, to view the
	<acronym class="acronym">ACL</acronym> settings on
	<code class="filename">test</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>getfacl test</code></strong>
	#file:test
	#owner:1001
	#group:1001
	user::rw-
	group::r--
	other::r--</pre><p xml:lang="en" lang="en">To change the <acronym class="acronym">ACL</acronym> settings on this
	file, use <code class="command">setfacl</code>.  To remove all of the
	currently defined <acronym class="acronym">ACL</acronym>s from a file or file
	system, include <code class="option">-k</code>.  However, the preferred
	method is to use <code class="option">-b</code> as it leaves the basic
	fields required for <acronym class="acronym">ACL</acronym>s to work.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>setfacl -k test</code></strong></pre><p xml:lang="en" lang="en">To modify the default <acronym class="acronym">ACL</acronym> entries, use
	<code class="option">-m</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>setfacl -m u:trhodes:rwx,group:web:r--,o::--- test</code></strong></pre><p xml:lang="en" lang="en">In this example, there were no pre-defined entries, as
	they were removed by the previous command.  This command
	restores the default options and assigns the options listed.
	If a user or group is added which does not exist on the
	system, an <span class="errorname">Invalid argument</span> error will
	be displayed.</p><p xml:lang="en" lang="en">Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=getfacl&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">getfacl</span>(1)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=setfacl&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">setfacl</span>(1)</span></a> for more
	information about the options available for these
	commands.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="security-pkg"></a>13.10. 監視第三方安全性問題</h2></div><div><span class="authorgroup">Contributed
	  by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp72723768" class="indexterm"></a><p xml:lang="en" lang="en">In recent years, the security world has made many
      improvements to how vulnerability assessment is handled.  The
      threat of system intrusion increases as third party utilities
      are installed and configured for virtually any operating
      system available today.</p><p xml:lang="en" lang="en">Vulnerability assessment is a key factor in security.
      While FreeBSD releases advisories for the base system, doing so
      for every third party utility is beyond the FreeBSD Project's
      capability.  There is a way to mitigate third party
      vulnerabilities and warn administrators of known security
      issues.  A FreeBSD add on utility known as
      <span class="application">pkg</span> includes options explicitly for
      this purpose.</p><p xml:lang="en" lang="en"><span class="application">pkg</span> polls a database for security
      issues.  The database is updated and maintained by the FreeBSD
      Security Team and ports developers.</p><p xml:lang="en" lang="en">Please refer to <a class="link" href="../../../../doc/en_US.ISO8859-1/books/handbook/pkgng-intro.html" target="_top">instructions</a>
      for installing
      <span class="application">pkg</span>.</p><p xml:lang="en" lang="en">Installation provides <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">periodic</span>(8)</span></a> configuration files
      for maintaining the <span class="application">pkg</span> audit
      database, and provides a programmatic method of keeping it
      updated.  This functionality is enabled if
      <code class="literal">daily_status_security_pkgaudit_enable</code>
      is set to <code class="literal">YES</code> in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=periodic.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">periodic.conf</span>(5)</span></a>.
      Ensure that daily security run emails, which are sent to
      <code class="systemitem">root</code>'s email account,
      are being read.</p><p xml:lang="en" lang="en">After installation, and to audit third party utilities as
      part of the Ports Collection at any time, an administrator may
      choose to update the database and view known vulnerabilities
      of installed packages by invoking:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg audit -F</code></strong></pre><p xml:lang="en" lang="en"><span class="application">pkg</span> displays messages
      any published vulnerabilities in installed packages:</p><pre xml:lang="en" class="programlisting" lang="en">Affected package: cups-base-1.1.22.0_1
Type of problem: cups-base -- HPGL buffer overflow vulnerability.
Reference: &lt;https://www.FreeBSD.org/ports/portaudit/40a3bca2-6809-11d9-a9e7-0001020eed82.html&gt;

1 problem(s) in your installed packages found.

You are advised to update or deinstall the affected package(s) immediately.</pre><p xml:lang="en" lang="en">By pointing a web browser to the displayed
      <acronym class="acronym">URL</acronym>, an administrator may obtain more
      information about the vulnerability.  This will include the
      versions affected, by FreeBSD port version, along with other web
      sites which may contain security advisories.</p><p xml:lang="en" lang="en"><span class="application">pkg</span> is a powerful utility
      and is extremely useful when coupled with
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portmaster/pkg-descr">ports-mgmt/portmaster</a>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="security-advisories"></a>13.11. FreeBSD 安全報告</h2></div><div><span class="authorgroup">Contributed
	  by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp72756280" class="indexterm"></a><p xml:lang="en" lang="en">Like many producers of quality operating systems, the FreeBSD
      Project has a security team which is responsible for
      determining the End-of-Life (<acronym class="acronym">EoL</acronym>) date for
      each FreeBSD release and to provide security updates for supported
      releases which have not yet reached their
      <acronym class="acronym">EoL</acronym>.  More information about the FreeBSD
      security team and the supported releases is available on the
      <a class="link" href="../../../../security" target="_top">FreeBSD security
	page</a>.</p><p xml:lang="en" lang="en">One task of the security team is to respond to reported
      security vulnerabilities in the FreeBSD operating system.  Once a
      vulnerability is confirmed, the security team verifies the steps
      necessary to fix the vulnerability and updates the source code
      with the fix.  It then publishes the details as a
      <span class="quote">“<span class="quote">Security Advisory</span>”</span>.  Security
      advisories are published on the <a class="link" href="../../../../security/advisories.html" target="_top">FreeBSD
	website</a> and mailed to the
      <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security-notifications" target="_top">freebsd-security-notifications</a>, <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security" target="_top">freebsd-security</a>, and
      <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-announce" target="_top">freebsd-announce</a> mailing lists.</p><p xml:lang="en" lang="en">This section describes the format of a FreeBSD security
      advisory.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72762424"></a>13.11.1. 安全報告的格式</h3></div></div></div><p xml:lang="en" lang="en">Here is an example of a FreeBSD security advisory:</p><pre xml:lang="en" class="programlisting" lang="en">=============================================================================
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

=============================================================================
FreeBSD-SA-14:04.bind                                       Security Advisory
                                                          The FreeBSD Project

Topic:          BIND remote denial of service vulnerability

Category:       contrib
Module:         bind
Announced:      2014-01-14
Credits:        ISC
Affects:        FreeBSD 8.x and FreeBSD 9.x
Corrected:      2014-01-14 19:38:37 UTC (stable/9, 9.2-STABLE)
                2014-01-14 19:42:28 UTC (releng/9.2, 9.2-RELEASE-p3)
                2014-01-14 19:42:28 UTC (releng/9.1, 9.1-RELEASE-p10)
                2014-01-14 19:38:37 UTC (stable/8, 8.4-STABLE)
                2014-01-14 19:42:28 UTC (releng/8.4, 8.4-RELEASE-p7)
                2014-01-14 19:42:28 UTC (releng/8.3, 8.3-RELEASE-p14)
CVE Name:       CVE-2014-0591

For general information regarding FreeBSD Security Advisories,
including descriptions of the fields above, security branches, and the
following sections, please visit &lt;URL:http://security.FreeBSD.org/&gt;.

I.   Background

BIND 9 is an implementation of the Domain Name System (DNS) protocols.
The named(8) daemon is an Internet Domain Name Server.

II.  Problem Description

Because of a defect in handling queries for NSEC3-signed zones, BIND can
crash with an "INSIST" failure in name.c when processing queries possessing
certain properties.  This issue only affects authoritative nameservers with
at least one NSEC3-signed zone.  Recursive-only servers are not at risk.

III. Impact

An attacker who can send a specially crafted query could cause named(8)
to crash, resulting in a denial of service.

IV.  Workaround

No workaround is available, but systems not running authoritative DNS service
with at least one NSEC3-signed zone using named(8) are not vulnerable.

V.   Solution

Perform one of the following:

1) Upgrade your vulnerable system to a supported FreeBSD stable or
release / security branch (releng) dated after the correction date.

2) To update your vulnerable system via a source code patch:

The following patches have been verified to apply to the applicable
FreeBSD release branches.

a) Download the relevant patch from the location below, and verify the
detached PGP signature using your PGP utility.

[FreeBSD 8.3, 8.4, 9.1, 9.2-RELEASE and 8.4-STABLE]
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-release.patch
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-release.patch.asc
# gpg --verify bind-release.patch.asc

[FreeBSD 9.2-STABLE]
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-stable-9.patch
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-stable-9.patch.asc
# gpg --verify bind-stable-9.patch.asc

b) Execute the following commands as root:

# cd /usr/src
# patch &lt; /path/to/patch

Recompile the operating system using buildworld and installworld as
described in &lt;URL:https://www.FreeBSD.org/handbook/makeworld.html&gt;.

Restart the applicable daemons, or reboot the system.

3) To update your vulnerable system via a binary patch:

Systems running a RELEASE version of FreeBSD on the i386 or amd64
platforms can be updated via the freebsd-update(8) utility:

# freebsd-update fetch
# freebsd-update install

VI.  Correction details

The following list contains the correction revision numbers for each
affected branch.

Branch/path                                                      Revision
- -------------------------------------------------------------------------
stable/8/                                                         r260646
releng/8.3/                                                       r260647
releng/8.4/                                                       r260647
stable/9/                                                         r260646
releng/9.1/                                                       r260647
releng/9.2/                                                       r260647
- -------------------------------------------------------------------------

To see which files were modified by a particular revision, run the
following command, replacing NNNNNN with the revision number, on a
machine with Subversion installed:

# svn diff -cNNNNNN --summarize svn://svn.freebsd.org/base

Or visit the following URL, replacing NNNNNN with the revision number:

&lt;URL:https://svnweb.freebsd.org/base?view=revision&amp;revision=NNNNNN&gt;

VII. References

&lt;URL:https://kb.isc.org/article/AA-01078&gt;

&lt;URL:http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0591&gt;

The latest revision of this advisory is available at
&lt;URL:http://security.FreeBSD.org/advisories/FreeBSD-SA-14:04.bind.asc&gt;
-----BEGIN PGP SIGNATURE-----

iQIcBAEBCgAGBQJS1ZTYAAoJEO1n7NZdz2rnOvQP/2/68/s9Cu35PmqNtSZVVxVG
ZSQP5EGWx/lramNf9566iKxOrLRMq/h3XWcC4goVd+gZFrvITJSVOWSa7ntDQ7TO
XcinfRZ/iyiJbs/Rg2wLHc/t5oVSyeouyccqODYFbOwOlk35JjOTMUG1YcX+Zasg
ax8RV+7Zt1QSBkMlOz/myBLXUjlTZ3Xg2FXVsfFQW5/g2CjuHpRSFx1bVNX6ysoG
9DT58EQcYxIS8WfkHRbbXKh9I1nSfZ7/Hky/kTafRdRMrjAgbqFgHkYTYsBZeav5
fYWKGQRJulYfeZQ90yMTvlpF42DjCC3uJYamJnwDIu8OhS1WRBI8fQfr9DRzmRua
OK3BK9hUiScDZOJB6OqeVzUTfe7MAA4/UwrDtTYQ+PqAenv1PK8DZqwXyxA9ThHb
zKO3OwuKOVHJnKvpOcr+eNwo7jbnHlis0oBksj/mrq2P9m2ueF9gzCiq5Ri5Syag
Wssb1HUoMGwqU0roS8+pRpNC8YgsWpsttvUWSZ8u6Vj/FLeHpiV3mYXPVMaKRhVm
067BA2uj4Th1JKtGleox+Em0R7OFbCc/9aWC67wiqI6KRyit9pYiF3npph+7D5Eq
7zPsUdDd+qc+UTiLp3liCRp5w6484wWdhZO6wRtmUgxGjNkxFoNnX8CitzF8AaqO
UWWemqWuz3lAZuORQ9KX
=OQzQ
-----END PGP SIGNATURE-----</pre><p xml:lang="en" lang="en">Every security advisory uses the following format:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Each security advisory is signed by the
	    <acronym class="acronym">PGP</acronym> key of the Security Officer.  The
	    public key for the Security Officer can be verified at
	    <a class="xref" href="#pgpkeys" title="附錄 D. OpenPGP 金鑰">附錄 D, <em>Open<acronym class="acronym">PGP</acronym> 金鑰</em></a>.</p></li><li class="listitem"><p xml:lang="en" lang="en">The name of the security advisory always begins with
	    <code class="literal">FreeBSD-SA-</code> (for FreeBSD Security
	    Advisory), followed by the year in two digit format
	    (<code class="literal">14:</code>), followed by the advisory number
	    for that year (<code class="literal">04.</code>), followed by the
	    name of the affected application or subsystem
	    (<code class="literal">bind</code>).  The advisory shown here is the
	    fourth advisory for 2014 and it affects
	    <span class="application">BIND</span>.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <code class="literal">Topic</code> field summarizes the
	    vulnerability.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <code class="literal">Category</code> refers to the
	    affected part of the system which may be one of
	    <code class="literal">core</code>, <code class="literal">contrib</code>, or
	    <code class="literal">ports</code>.  The <code class="literal">core</code>
	    category means that the vulnerability affects a core
	    component of the FreeBSD operating system.  The
	    <code class="literal">contrib</code> category means that the
	    vulnerability affects software included with  FreeBSD,
	    such as <span class="application">BIND</span>.  The
	    <code class="literal">ports</code> category indicates that the
	    vulnerability affects software available through the Ports
	    Collection.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <code class="literal">Module</code> field refers to the
	    component location.  In this example, the
	    <code class="literal">bind</code> module is affected; therefore,
	    this vulnerability affects an application installed with
	    the operating system.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <code class="literal">Announced</code> field reflects the
	    date the security advisory was published.  This means
	    that the security team has verified that the problem
	    exists and that a patch has been committed to the FreeBSD
	    source code repository.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <code class="literal">Credits</code> field gives credit to
	    the individual or organization who noticed the
	    vulnerability and reported it.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <code class="literal">Affects</code> field explains which
	    releases of FreeBSD are affected by this
	    vulnerability.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <code class="literal">Corrected</code> field indicates the
	    date, time, time offset, and releases that were
	    corrected.  The section in parentheses shows each branch
	    for which the fix has been merged, and the version number
	    of the corresponding release from that branch.  The
	    release identifier itself includes the version number
	    and, if appropriate, the patch level.  The patch level is
	    the letter <code class="literal">p</code> followed by a number,
	    indicating the sequence number of the patch, allowing
	    users to track which patches have already been applied to
	    the system.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <code class="literal">CVE Name</code> field lists the
	    advisory number, if one exists, in the public <a class="link" href="http://cve.mitre.org" target="_top">cve.mitre.org</a>
	    security vulnerabilities database.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <code class="literal">Background</code> field provides a
	    description of the affected module.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <code class="literal">Problem Description</code> field
	    explains the vulnerability.  This can include
	    information about the flawed code and how the utility
	    could be maliciously used.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <code class="literal">Impact</code> field describes what
	    type of impact the problem could have on a system.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <code class="literal">Workaround</code> field indicates if
	    a workaround is available to system administrators who
	    cannot immediately patch the system .</p></li><li class="listitem"><p xml:lang="en" lang="en">The <code class="literal">Solution</code> field provides the
	    instructions for patching the affected system.  This is a
	    step by step tested and verified method for getting a
	    system patched and working securely.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <code class="literal">Correction Details</code> field
	    displays each affected Subversion branch with the revision
	    number that contains the corrected code.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <code class="literal">References</code> field offers sources
	    of additional information regarding the
	    vulnerability.</p></li></ul></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="security-accounting"></a>13.12. 程序追蹤</h2></div><div><span class="authorgroup">Contributed
	  by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp72833080" class="indexterm"></a><p xml:lang="en" lang="en">Process accounting is a security method in which an
      administrator may keep track of system resources used and
      their allocation among users, provide for system monitoring,
      and minimally track a user's commands.</p><p xml:lang="en" lang="en">Process accounting has both positive and negative points.
      One of the positives is that an intrusion may be narrowed down
      to the point of entry.  A negative is the amount of logs
      generated by process accounting, and the disk space they may
      require.  This section walks an administrator through the basics
      of process accounting.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">If more fine-grained accounting is needed, refer to
	<a class="xref" href="#audit" title="章 16. 安全事件稽查">章 16, <em>安全事件稽查</em></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72836280"></a>13.12.1. 開啟並使用程序追蹤</h3></div></div></div><p xml:lang="en" lang="en">Before using process accounting, it must be enabled using
	the following commands:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysrc accounting_enable=yes</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service accounting start</code></strong></pre><p xml:lang="en" lang="en">The accounting information is stored in files located in
	<code class="filename">/var/account</code>, which is automatically created,
	if necessary, the first time the accounting service starts.
	These files contain sensitive information, including all the
	commands issued by all users.  Write access to the files is
	limited to <code class="systemitem">root</code>,
	and read access is limited to <code class="systemitem">root</code> and members of the
	<code class="systemitem">wheel</code> group.
	To also prevent	members of <code class="systemitem">wheel</code> from reading the files,
	change the mode of the <code class="filename">/var/account</code>
	directory to allow access only by <code class="systemitem">root</code>.</p><p xml:lang="en" lang="en">Once enabled, accounting will begin to track information
	such as <acronym class="acronym">CPU</acronym> statistics and executed
	commands.  All accounting logs are in a non-human readable
	format which can be viewed using <code class="command">sa</code>.  If
	issued without any options, <code class="command">sa</code> prints
	information relating to the number of per-user calls, the
	total elapsed time in minutes, total <acronym class="acronym">CPU</acronym>
	and user time in minutes, and the average number of
	<acronym class="acronym">I/O</acronym> operations.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sa&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sa</span>(8)</span></a> for
	the list of available options which control the output.</p><p xml:lang="en" lang="en">To display the commands issued by users, use
	<code class="command">lastcomm</code>.  For example, this command
	prints out all usage of <code class="command">ls</code> by <code class="systemitem">trhodes</code> on the
	<code class="literal">ttyp1</code> terminal:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>lastcomm ls trhodes ttyp1</code></strong></pre><p xml:lang="en" lang="en">Many other useful options exist and are explained in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lastcomm&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lastcomm</span>(1)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acct&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acct</span>(5)</span></a>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sa&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sa</span>(8)</span></a>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="security-resourcelimits"></a>13.13. 限制資源</h2></div><div><span class="authorgroup">Contributed
	  by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp72867768" class="indexterm"></a><p xml:lang="en" lang="en">FreeBSD provides several methods for an administrator to
	limit the amount of system resources an individual may use.
	Disk quotas limit the amount of disk space available to users.
	Quotas are discussed in <a class="xref" href="#quotas" title="17.11. 磁碟配額">節 17.11, “磁碟配額”</a>.</p><a id="idp72869560" class="indexterm"></a><a id="idp72903224" class="indexterm"></a><a id="idp72904504" class="indexterm"></a><p xml:lang="en" lang="en">Limits to other resources, such as <acronym class="acronym">CPU</acronym>
      and memory, can be set using either a flat file or a command to
      configure a resource limits database.  The traditional method
      defines login classes by editing
      <code class="filename">/etc/login.conf</code>.  While this method is
      still supported, any changes require a multi-step process of
      editing this file, rebuilding the resource database, making
      necessary changes to <code class="filename">/etc/master.passwd</code>,
      and rebuilding the password database.  This can become time
      consuming, depending upon the number of users to
      configure.</p><p xml:lang="en" lang="en"><code class="command">rctl</code> can be used to provide a more
      fine-grained method for controlling resource limits.  This
      command supports more than user limits as it can also be used to
      set resource constraints on processes and jails.</p><p xml:lang="en" lang="en">This section demonstrates both methods for controlling
      resources, beginning with the traditional method.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-limiting"></a>13.13.1. 設定登入類別</h3></div></div></div><a id="idp72909112" class="indexterm"></a><a id="idp72910008" class="indexterm"></a><a id="idp72911288" class="indexterm"></a><p xml:lang="en" lang="en">In the traditional method, login classes and the resource
	limits to apply to a login class are defined in
	<code class="filename">/etc/login.conf</code>.   Each user account can
	be assigned to a login class, where <code class="literal">default</code>
	is the default login class.  Each login class has a set of
	login capabilities associated with it.  A login capability is
	a
	<code class="literal"><em class="replaceable"><code>name</code></em>=<em class="replaceable"><code>value</code></em></code>
	pair, where <em class="replaceable"><code>name</code></em> is a well-known
	identifier and <em class="replaceable"><code>value</code></em> is an
	arbitrary string which is processed accordingly depending on
	the <em class="replaceable"><code>name</code></em>.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Whenever <code class="filename">/etc/login.conf</code> is edited,
	  the <code class="filename">/etc/login.conf.db</code> must be updated
	  by executing the following command:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cap_mkdb /etc/login.conf</code></strong></pre></div><p xml:lang="en" lang="en">Resource limits differ from the default login capabilities
	in two ways.  First, for every limit, there is a
	<em class="firstterm">soft</em> and <em class="firstterm">hard</em>
	limit.  A soft limit may be adjusted by the user or
	application, but may not be set higher than the hard limit.
	The hard limit may be lowered by the user, but can only be
	raised by the superuser.  Second, most resource limits apply
	per process to a specific user.</p><p xml:lang="en" lang="en"><a class="xref" href="#resource-limits" title="表格 13.1. 登入類別限制資源類型">表格 13.1, “登入類別限制資源類型”</a> lists the most commonly
	used resource limits.  All of the available resource limits
	and capabilities are described in detail in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">login.conf</span>(5)</span></a>.</p><a id="idp72933432" class="indexterm"></a><a id="idp72934712" class="indexterm"></a><a id="idp72940088" class="indexterm"></a><a id="idp72941368" class="indexterm"></a><a id="idp72942648" class="indexterm"></a><a id="idp72943928" class="indexterm"></a><a id="idp72945208" class="indexterm"></a><a id="idp72946488" class="indexterm"></a><a id="idp72947768" class="indexterm"></a><div class="table"><a id="resource-limits"></a><div class="table-title">表格 13.1. 登入類別限制資源類型</div><div class="table-contents"><table summary="登入類別限制資源類型" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>限制資源</th><th>說明</th></tr></thead><tbody><tr><td xml:lang="en" lang="en">coredumpsize</td><td xml:lang="en" lang="en">The limit on the size of a core file generated by
		a program is subordinate to other limits on disk
		usage, such as <code class="literal">filesize</code> or disk
		quotas.  This limit is often used as a less severe
		method of controlling disk space consumption.  Since
		users do not generate core files and often do not
		delete them, this setting may save them from running
		out of disk space should a large program
		crash.</td></tr><tr><td xml:lang="en" lang="en">cputime</td><td xml:lang="en" lang="en">The maximum amount of <acronym class="acronym">CPU</acronym> time
		a user's process may consume.  Offending processes
		will be killed by the kernel.  This is a limit on
		<acronym class="acronym">CPU</acronym> <span class="emphasis"><em>time</em></span>
		consumed, not the percentage of the
		<acronym class="acronym">CPU</acronym> as displayed in some of the
		fields generated by <code class="command">top</code> and
		<code class="command">ps</code>.</td></tr><tr><td xml:lang="en" lang="en">filesize</td><td xml:lang="en" lang="en">The maximum size of a file the user may own.
		Unlike disk quotas (<a class="xref" href="#quotas" title="17.11. 磁碟配額">節 17.11, “磁碟配額”</a>), this
		limit is enforced on individual files, not the set of
		all files a user owns.</td></tr><tr><td xml:lang="en" lang="en">maxproc</td><td xml:lang="en" lang="en">The maximum number of foreground and background
		processes a user can run.  This limit may not be
		larger than the system limit specified by
		<code class="varname">kern.maxproc</code>.  Setting this limit
		too small may hinder a user's productivity as some
		tasks, such as compiling a large program, start lots
		of processes.</td></tr><tr><td xml:lang="en" lang="en">memorylocked</td><td xml:lang="en" lang="en">The maximum amount of memory a process may
		request to be locked into main memory using
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mlock&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mlock</span>(2)</span></a>.  Some system-critical programs, such as
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=amd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">amd</span>(8)</span></a>, lock into main memory so that if the
		system begins to swap, they do not contribute to disk
		thrashing.</td></tr><tr><td xml:lang="en" lang="en">memoryuse</td><td xml:lang="en" lang="en">The maximum amount of memory a process may
		consume at any given time.  It includes both core
		memory and swap usage.  This is not a catch-all limit
		for restricting memory consumption, but is a good
		start.</td></tr><tr><td xml:lang="en" lang="en">openfiles</td><td xml:lang="en" lang="en">The maximum number of files a process may have
		open.  In FreeBSD, files are used to represent sockets
		and <acronym class="acronym">IPC</acronym> channels, so be careful not
		to set this too low.  The system-wide limit for this
		is defined by
		<code class="varname">kern.maxfiles</code>.</td></tr><tr><td xml:lang="en" lang="en">sbsize</td><td xml:lang="en" lang="en">The limit on the amount of network memory a user
		may consume.  This can be generally used to limit
		network communications.</td></tr><tr><td xml:lang="en" lang="en">stacksize</td><td xml:lang="en" lang="en">The maximum size of a process stack.  This alone
		is not sufficient to limit the amount of memory a
		program may use, so it should be used in conjunction
		with other limits.</td></tr></tbody></table></div></div><br class="table-break" /><p xml:lang="en" lang="en">There are a few other things to remember when setting
	resource limits:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Processes started at system startup by
	    <code class="filename">/etc/rc</code> are assigned to the
	    <code class="literal">daemon</code> login class.</p></li><li class="listitem"><p xml:lang="en" lang="en">Although the default
	    <code class="filename">/etc/login.conf</code> is a good source of
	    reasonable values for most limits, they may not be
	    appropriate for every system.  Setting a limit too high
	    may open the system up to abuse, while setting it too low
	    may put a strain on productivity.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="application">Xorg</span> takes a lot of
	    resources and encourages users to run more programs
	    simultaneously.</p></li><li class="listitem"><p xml:lang="en" lang="en">Many limits apply to individual processes, not the
	    user as a whole.  For example, setting
	    <code class="varname">openfiles</code> to <code class="literal">50</code>
	    means that each process the user runs may open up to
	    <code class="literal">50</code> files.  The total amount of files a
	    user may open is the value of <code class="literal">openfiles</code>
	    multiplied by the value of <code class="literal">maxproc</code>.
	    This also applies to memory consumption.</p></li></ul></div><p xml:lang="en" lang="en">For further information on resource limits and login
	classes and capabilities in general, refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cap_mkdb&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cap_mkdb</span>(1)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=getrlimit&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">getrlimit</span>(2)</span></a>, and
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">login.conf</span>(5)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73055928"></a>13.13.2. 開啟並設定資源限制</h3></div></div></div><p xml:lang="en" lang="en">The <code class="varname">kern.racct.enable</code> tunable must be
	set to a non-zero value.  Custom kernels require specific
	configuration:</p><pre xml:lang="en" class="programlisting" lang="en">options         RACCT
options         RCTL</pre><p xml:lang="en" lang="en">Once the system has rebooted into the new kernel,
	<code class="command">rctl</code> may be used to set rules for the
	system.</p><p xml:lang="en" lang="en">Rule syntax is controlled through the use of a subject,
	subject-id, resource, and action, as seen in this example
	rule:</p><pre xml:lang="en" class="programlisting" lang="en">user:trhodes:maxproc:deny=10/user</pre><p xml:lang="en" lang="en">In this rule, the subject is <code class="literal">user</code>, the
	subject-id is <code class="literal">trhodes</code>, the resource,
	<code class="literal">maxproc</code>, is the maximum number of
	processes, and the action is <code class="literal">deny</code>, which
	blocks any new processes from being created.  This means that
	the user, <code class="literal">trhodes</code>, will be constrained to
	no greater than <code class="literal">10</code> processes.  Other
	possible actions include logging to the console, passing a
	notification to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a>, or sending a sigterm to the
	process.</p><p xml:lang="en" lang="en">Some care must be taken when adding rules.  Since this
	user is constrained to <code class="literal">10</code> processes, this
	example will prevent the user from performing other tasks
	after logging in and executing a
	<code class="command">screen</code> session.  Once a resource limit has
	been hit, an error will be printed, as in this example:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>man test</code></strong>
    /usr/bin/man: Cannot fork: Resource temporarily unavailable
eval: Cannot fork: Resource temporarily unavailable</pre><p xml:lang="en" lang="en">As another example, a jail can be prevented from exceeding
	a memory limit.  This rule could be written as:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>rctl -a jail:httpd:memoryuse:deny=2G/jail</code></strong></pre><p xml:lang="en" lang="en">Rules will persist across reboots if they have been added
	to <code class="filename">/etc/rctl.conf</code>.  The format is a rule,
	without the preceding command.  For example, the previous rule
	could be added as:</p><pre xml:lang="en" class="programlisting" lang="en"># Block jail from using more than 2G memory:
jail:httpd:memoryuse:deny=2G/jail</pre><p xml:lang="en" lang="en">To remove a rule, use <code class="command">rctl</code> to remove it
	from the list:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>rctl -r user:trhodes:maxproc:deny=10/user</code></strong></pre><p xml:lang="en" lang="en">A method for removing all rules is documented in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rctl</span>(8)</span></a>.  However, if removing all rules for a single
	user is required, this command may be issued:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>rctl -r user:trhodes</code></strong></pre><p xml:lang="en" lang="en">Many other resources exist which can be used to exert
	additional control over various <code class="literal">subjects</code>.
	See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rctl</span>(8)</span></a> to learn about them.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="security-sudo"></a>13.14. 使用 Sudo 分享管理權限</h2></div><div><span class="authorgroup">Contributed
	  by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp73123128" class="indexterm"></a><p>系統管理者通常會要能夠授予額外的權限給其他使用者，以讓這些使用者可以執行需權限的工作。要讓團隊成員可以存取 FreeBSD 系統來完成其特定的工作對所有管理者都會帶來挑戰，這些團隊成員通常只需要比一般使用者多出一些存取權限便可作業，但他們總是會告訴管理者若沒有超級使用者的存取權便無法完成其工作。幸好，有工具可以管理這類的需求，這樣便不需提供這麼大的權限給一般使用者。</p><p>到目前為止，安全性章節已說明了如何允許已授權的使用者存取以及嘗試防止未經授權的存取，而現在有另一個問題，是由已授權的使用者擁有權限存取系統資源造成的。在很多的情況，使用者會需要存取應用程式啟動 Script 的權限或是管理者團隊需要維護系統，以往會使用標準的使用者與群組、檔案權限、甚至是 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> 指令來管理存取權，但當應用程式需要更多存取權，更多使用者需要使用系統資源時，便需要更好的解決方案，目前最常用來解決此問題的應用程式便是 <span class="application">Sudo</span>。</p><p><span class="application">Sudo</span> 讓管理者可以對系統指令的存取設下更嚴格的限制並提供進階的記錄功能。如同其他工具，它可自 Port 套件集取得，於其中的 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/sudo/pkg-descr">security/sudo</a>，或使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg</span>(8)</span></a> 工具取得，若要使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg</span>(8)</span></a> 工具可：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install sudo</code></strong></pre><p>安裝完成之後，可用安裝的 <code class="command">visudo</code> 以文字編輯器開啟設定檔，強烈建議使用 <code class="command">visudo</code> 來編輯設定檔，由於它有內建的語法檢查程式可在檔案儲存之前檢驗是否有誤。</p><p>設定檔由個小節所組成，透過這些小節可做常廣泛的設定，在以下的範例中，網站應用程式維護人員 user1 需要啟動、停止與重新啟動名稱為 <em class="replaceable"><code>webservice</code></em> 的網站應用程式 。要授權此使用者執行這些工作的權限，可加入此行到 <code class="filename">/usr/local/etc/sudoers</code> 的最後：</p><pre xml:lang="en" class="programlisting" lang="en">user1   ALL=(ALL)       /usr/sbin/service webservice *</pre><p>現在使用者可使用此指令來啟動 <em class="replaceable"><code>webservice</code></em>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>sudo /usr/sbin/service <em class="replaceable"><code>webservice</code></em> start</code></strong></pre><p>雖然這項設定可以讓一位使用者存取 <span class="application">webservice</span> 服務，但在大部份組織中會有一整個網站小組負責管理該服務，因此也可以一行來授予整個群組存取權，以下步驟會建立一個網站群組、加入使用者到這個群組，然後讓該群組中的所有成員能夠管理服務：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pw groupadd -g 6001 -n webteam</code></strong></pre><p>同樣使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a> 指令來加入該使用到 webteam 群組：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pw groupmod -m user1 -n webteam</code></strong></pre><p>最後，在 <code class="filename">/usr/local/etc/sudoers</code> 中的這行設定可以讓 webteam 群組的所有成員可以管理 <em class="replaceable"><code>webservice</code></em>：</p><pre xml:lang="en" class="programlisting" lang="en">%webteam   ALL=(ALL)       /usr/sbin/service webservice *</pre><p>與 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> 不同的是 <span class="application">Sudo</span> 只需要一般使用者的密碼，這有一個使用者不需要共用密碼的優點，在大多數安全稽查都會發現共用密碼的問題且這種情況只有壞處可言。</p><p>使用 <span class="application">Sudo</span> 允許使用者執行應用程式只需要輸入使用者自己的密碼，這更安全且提供比 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> 更佳的控制權，因為 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> 只要輸入 <code class="systemitem">root</code> 密碼之後該使用者便可取得所有的 <code class="systemitem">root</code> 權限。</p><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml">大多數組織已正在導入或已導入雙重認証 (Two factor authentication)，在這個情境下使用者可以不用輸入密碼，<span class="application">Sudo</span> 提供了 <code class="literal">NOPASSWD</code> 變數來供這個情境使用，可將該設定加入到上述的設定將可允許所有 <em class="replaceable"><code>webteam</code></em> 群組的成員不需要輸入密碼便可管理該服務：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="programlisting" lang="en">%webteam   ALL=(ALL)       NOPASSWD: /usr/sbin/service webservice *</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-sudo-loggin"></a>13.14.1. 記錄輸出</h3></div></div></div><p>採用 <span class="application">Sudo</span> 的另一個優點是能夠開啟連線階段的記錄。使用內建立記錄機制與內含的 <span class="application">sudoreplay</span> 指令，所有透過 <span class="application">Sudo</span> 初始化的指令會被記錄下來供往後檢驗用。要開啟這個功能要加入預設記錄目錄的項目，在以下範例中使用了使用者變數來做目錄名稱，也還有許多其他記錄檔名稱慣例，可參考 <span class="application">sudoreplay</span> 的操作手冊來取得進一步資訊。</p><pre xml:lang="en" class="programlisting" lang="en">Defaults iolog_dir=/var/log/sudo-io/%{user}</pre><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml">這個目錄會在記錄功能設定之後自動建立，最好讓系統以預設的權限來建立目錄比較保險，除此之外，這個設定項目也會記錄使用 <span class="application">sudoreplay</span> 指令的管理者，要更改設定請閱讀並取消在 <code class="filename">sudoers</code> 中記錄選項的註解。</p></div><p>一旦這個設定加入至 <code class="filename">sudoers</code> 檔案之後，所有的使用者設定項目便可加上記錄存取動作的項目，在 <em class="replaceable"><code>webteam</code></em> 項目加入額外設定之後的範例如下：</p><pre xml:lang="en" class="programlisting" lang="en">%webteam ALL=(ALL) NOPASSWD: LOG_INPUT: LOG_OUTPUT: /usr/sbin/service webservice *</pre><p>從此之後，所有 <em class="replaceable"><code>webteam</code></em> 修改 <em class="replaceable"><code>webservice</code></em> 應用程式狀態的成員將會被記錄下來。要列出先前與目前連線階段的記錄可：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sudoreplay -l</code></strong></pre><p>在輸出結果中要重播指定連線階段的記錄可搜尋 <code class="literal">TSID=</code> 項目，然後傳送給 <span class="application">sudoreplay</span> 且不加其他選項便可以一般速度重播連線階段，例如：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sudoreplay user1/00/00/02</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">雖然所有連線階段都會被記錄，但任何管理者都可以移除連線階段，使得沒人知道它們做了什麼事，所以非常值得在入侵偵測系統 (<acronym class="acronym">IDS</acronym>) 或類似的軟體加入每日檢查，以便在有人為修改時通知其他管理人員。</p></div><p><code class="command">sudoreplay</code> 的擴充空間非常大，請參考說明文件來取得更多資訊。</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails"></a>章 14. Jail</h2></div><div><span class="authorgroup">Contributed
	by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Matteo</span> <span class="surname">Riondato</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#jails-synopsis">14.1. 概述</a></span></dt><dt><span class="sect1"><a href="#jails-terms">14.2. Jail 相關術語</a></span></dt><dt><span class="sect1"><a href="#jails-build">14.3. 建立和控制 Jail</a></span></dt><dt><span class="sect1"><a href="#jails-tuning">14.4. 調校與管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#jails-tuning-utilities">14.4.1. 在 FreeBSD 中調校 Jail 的系統工具</a></span></dt><dt><span class="sect2"><a href="#jails-tuning-admintools">14.4.2. 在 FreeBSD Port 套件集中的高層級管理工具</a></span></dt><dt><span class="sect2"><a href="#jails-updating">14.4.3. 持續 Jail 的修補與更新</a></span></dt></dl></dd><dt><span class="sect1"><a href="#jails-application">14.5. 更新多個 Jail</a></span></dt><dd><dl><dt><span class="sect2"><a href="#jails-service-jails-template">14.5.1. 建立範本</a></span></dt><dt><span class="sect2"><a href="#jails-service-jails-creating">14.5.2. 建立 Jail</a></span></dt><dt><span class="sect2"><a href="#jails-service-jails-upgrading">14.5.3. 升級</a></span></dt></dl></dd><dt><span class="sect1"><a href="#jails-ezjail">14.6. 使用 <span class="application">ezjail</span> 管理 Jail</a></span></dt><dd><dl><dt><span class="sect2"><a href="#jails-ezjail-install">14.6.1. 安裝 <span class="application">ezjail</span></a></span></dt><dt><span class="sect2"><a href="#jails-ezjail-initialsetup">14.6.2. 初始設定</a></span></dt><dt><span class="sect2"><a href="#jails-ezjail-create">14.6.3. 建立並啟動新的 Jail</a></span></dt><dt><span class="sect2"><a href="#jails-ezjail-update">14.6.4. 更新 Jail</a></span></dt><dd><dl><dt><span class="sect3"><a href="#jails-ezjail-update-os">14.6.4.1. 更新作業系統</a></span></dt><dt><span class="sect3"><a href="#jails-ezjail-update-ports">14.6.4.2. 更新 Port</a></span></dt></dl></dd><dt><span class="sect2"><a href="#jails-ezjail-control">14.6.5. 控制 Jail</a></span></dt><dd><dl><dt><span class="sect3"><a href="#jails-ezjail-control-stop-start">14.6.5.1. 停止與啟動 Jail</a></span></dt><dt><span class="sect3"><a href="#jails-ezjail-control-backup">14.6.5.2. 封存與還原 Jail</a></span></dt></dl></dd><dt><span class="sect2"><a href="#jails-ezjail-example-bind">14.6.6. 完整範例：在 Jail 中安裝 <span class="application">BIND</span></a></span></dt></dl></dd></dl></div><a id="idp73209528" class="indexterm"></a><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="jails-synopsis"></a>14.1. 概述</h2></div></div></div><p>由於系統管理是一項困難的工作，許多工具開發來讓系統管理者能夠更輕鬆。這些工具通常可以強化系統安裝、設定以及維護的方式。這些工具之可以用來強化 FreeBSD 系統的安全性之一的就是 <em class="firstterm">Jail</em>。Jail 早在 FreeBSD 4.X 便可使用並持續強化它的功能、效率、穩定性以及安全性。</p><p>Jail 建立在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chroot&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chroot</span>(2)</span></a> 概念之上，會更改一系列程序的根目錄。這可以創造一個安全的環境，將程序與系統的其他部份分隔。在 chroot 的環境所建立的程序不能存取該環境以外的檔案或資源。也因此，滲透一個在 chroot 的環境執行的服務並不會讓整個系統被攻擊者滲透。但 chroot 有許多限制，只適合用在簡單的工作，不需要許多彈性或複雜性、進階功能的工作。隨著時間推移，許多可以逃離 chroot 的環境的方法已經被找到，讓這個方法不再是確保服務安全的理想方案。</p><p>Jail 用許多方式改進了傳統 chroot 環境的概念。在傳統 chroot 環境，程序僅限制在一部份檔案系統可存取的地方。其餘的系統資源、系統使用者、執行的程序以及網路子系統被 chroot 的程序及主機系統的程序所共享。Jail 透過虛擬化存取檔案系統、使用者及網路子系統來擴展這個模型，可使用更多細微的控制參數來調校 Jail 的環境存取方式，Jail 可算是一種作業系統層級的虛擬化。</p><p>Jail 的四個要素：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>一個子樹狀目錄：進入 Jail 的起點目錄，一但在 Jail 中，程序便沒有權限離開此目錄之外。</p></li><li class="listitem"><p>一個主機名稱：將會由 Jail 所使用。</p></li><li class="listitem"><p>一個 <acronym class="acronym">IP</acronym> 位址：用來分配給 Jail。Jail 的 <acronym class="acronym">IP</acronym> 位址通常是現有網路介面的別名位址。</p></li><li class="listitem"><p>一個指令：要在 Jail 中可執行的執行檔路徑名稱。該路徑是 Jail 環境根目錄的相對路徑。</p></li></ul></div><p>Jail 有自己使用者及自己的 <code class="systemitem">root</code> 帳號，皆受到 Jail 環境的限制。Jail 中的 <code class="systemitem">root</code> 帳號不允許對指定 Jail 環境之外的系統執行操作。</p><p>本章將提供 FreeBSD Jail 術語及管理指令的概述，Jail 對系統管理者及進階的使用者來二者來說皆是強大的工具。</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Jail 是什麼及它在 FreeBSD 中提供的目的。</p></li><li class="listitem"><p>如何建立、啟動及停止 Jail。</p></li><li class="listitem"><p>Jail 管理基礎，不論從內部或外部。</p></li></ul></div><div xmlns="" class="important"><h3 class="admontitle">重要: </h3><p xmlns="http://www.w3.org/1999/xhtml">Jail 是強大的工具，但它不是安全性問題的萬靈丹。雖然 Jail 的程序不可能自己獨自打破規則，但有許多方法可以讓在 Jail 之外無權限的使用者與在 Jail 之內有權限的使用者串通來取得主機環境的更高權限。</p><p xmlns="http://www.w3.org/1999/xhtml">大多數這類型的攻擊者可以由確保 Jail 根目錄不會被無權限使用者存取來減少。基本上，不受信任的使用者有 Jail 的存取權限並不會讓其可存取主機環境。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="jails-terms"></a>14.2. Jail 相關術語</h2></div></div></div><p>為協助更容易理解 FreeBSD 系統有關 Jail 部份， 以及它們與 FreeBSD 其他部分的相互作用關係， 以下列出本章將使用的術語：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chroot&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chroot</span>(8)</span></a> (指令)</span></dt><dd><p>工具，用來使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chroot&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chroot</span>(2)</span></a> FreeBSD 系統呼叫 (System call) 來更改程予及其衍伸程序的根目錄。</p></dd><dt><span class="term"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chroot&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chroot</span>(2)</span></a> (環境)</span></dt><dd><p>指程序在 <span class="quote">“<span class="quote">chroot</span>”</span> 中執行的環境。包含的資源如：一部份可見的檔案系統、可用的使用者及群組 ID、網路介面及其他 IPC 機制等。</p></dd><dt><span class="term"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> (指令)</span></dt><dd><p>允許在 Jail 環境下執行程序的系統管理工具。</p></dd><dt><span class="term">主機 (系統、程序、使用者等)</span></dt><dd><p>Jail 環境的控制系統。 主機系統可以存取所有可用的硬體資源，並能控制 Jail 環境內外的程序。主機系統與 Jail 最大的差別在於：在主機系統中的超級使用者程序並不像在 Jail 環境那樣受到限制。</p></dd><dt><span class="term">託管 (主機、程序、使用者等)</span></dt><dd><p>存取資源受到 FreeBSD Jail 限制的託管程序、使用者或其他實體。</p></dd></dl></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="jails-build"></a>14.3. 建立和控制 Jail</h2></div></div></div><p>部份管理者將 Jail 分成兩種類型：<span class="quote">“<span class="quote">完整的</span>”</span> Jail，它像一個真正的 FreeBSD 系統以及 <span class="quote">“<span class="quote">服務的</span>”</span> Jail，專門用於某個應用程式或服務，可能使用管理權限執行。但這些只是概念上的區分，建立 Jail 的程序並不受這個概念的影響。當要建立一個 <span class="quote">“<span class="quote">完整的</span>”</span> Jail，Userland 有兩個來源選項：使用預先編譯的 Binary (如安裝媒體上提供的 Binary) 或從原始碼編譯。</p><p>要從安裝媒體安裝 Userland，需要先建立根目錄供 Jail 使用。這個動作可以透過設定 <code class="varname">DESTDIR</code> 來到適當的位置來完成。</p><p>啟動 Shell 並定義 <code class="varname">DESTDIR</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sh</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>export DESTDIR=<em class="replaceable"><code>/here/is/the/jail</code></em></code></strong></pre><p>當使用安裝 ISO 時，可依 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a> 中的說明掛載安裝媒體：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount -t cd9660 /dev/`mdconfig -f cdimage.iso` /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /mnt/usr/freebsd-dist/</code></strong></pre><p>或者自鏡像站下載 Tarball 壓縮檔：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sh</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>export DESTRELEASE=<em class="replaceable"><code>12.0-RELEASE</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>export DESTARCH=<em class="replaceable"><code>`uname -m`</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>export SOURCEURL=<em class="replaceable"><code>http://ftp.freebsd.org/pub/</code></em>FreeBSD/releases/$DESTARCH/$DESTRELEASE/</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>for set in base ports; do fetch $SOURCEURL/$set.txz ; done</code></strong></pre><p>從安裝媒體上的 Tarball 中取出 Binary 並放到宣告的位置，至少需要取出 Base set 的部份，若需要也可完整安裝。</p><p>只安裝基礎系統 (Base system)：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tar -xf base.txz -C $DESTDIR</code></strong></pre><p>安裝全部不含核心：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>for set in base ports; do tar -xf $set.txz -C $DESTDIR ; done</code></strong></pre><p>依 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> 操作手冊說明的程序建置 Jail：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>setenv D <em class="replaceable"><code>/here/is/the/jail</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p $D</code></strong>      <a id="jailpath"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make buildworld</code></strong>  <a id="jailbuildworld"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>make installworld DESTDIR=$D</code></strong>  <a id="jailinstallworld"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>make distribution DESTDIR=$D</code></strong>  <a id="jaildistrib"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>mount -t devfs devfs $D/dev</code></strong>   <a id="jaildevfs"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#jailpath"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>選擇 Jail 的位置是建置 Jail 最好的起點，這是在 Jail 主機上儲存 Jail 的實體位置。較好的選擇是 <code class="filename">/usr/jail/<em class="replaceable"><code>jailname</code></em></code>，其中 <em class="replaceable"><code>jailname</code></em> 是用來辦識 Jail 的主機名稱。通常在 <code class="filename">/usr/</code> 會有足夠的空間供 Jail 檔案系統使用，對 <span class="quote">“<span class="quote">完整的</span>”</span> Jail 來說，便是複製 FreeBSD 基礎系統預設安裝的每一個檔案。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jailbuildworld"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>若您已經使用 <code class="command">make world</code> 或 <code class="command">make buildworld</code> 重新編譯您的 Userland，您可以跳過這個步驟並安裝您已存在的 Userland 到新的 Jail。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jailinstallworld"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>這個指令將會在檔案系統中 Jail 所在的實體位置產生樹狀目錄及必要的 Binary、程式庫、操作手冊與相關檔案。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jaildistrib"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p><span class="application">make</span> 的 <code class="buildtarget">distribution</code> 目標會安裝所有需要的設定檔。簡單來說，它會安裝所有 <code class="filename">/usr/src/etc/</code> 中可安裝的檔案到 Jail 環境的 <code class="filename">/etc</code>目錄：<code class="filename">$D/etc/</code>。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jaildevfs"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>在 Jail 中掛載 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> 檔案系統並非必要的動作。從另一個角度來說，任何或大部份的應用程式會依該程式的目的會需要存取至少一個裝置，在 Jail 中控制存取的裝置非常重要，不恰當的設定可能會讓攻擊者可以在 Jail 中做不軌的事。對 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> 的控制是透過  Ruleset，在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> 及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs.conf</span>(5)</span></a> 操作手冊中有詳細說明。</p></td></tr></table></div><p>Jail 安裝完成之後，便可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> 工具來啟動。<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> 工具需要四個必要參數，在 <a class="xref" href="#jails-synopsis" title="14.1. 概述">節 14.1, “概述”</a> 有說明。其他參數也可能需要指定，例如要使用特定使用者的身份來執行要 Jail 的程序。<code class="option"><em class="replaceable"><code>command</code></em></code> 參數依 Jail 的類型所需而定，對一個 <span class="emphasis"><em>虛擬系統</em></span> 來說，<code class="filename">/etc/rc</code> 是不錯的選擇，因為該檔案可以模仿真實 FreeBSD 的啟動順序。對於 <span class="emphasis"><em>服務型</em></span> 的 Jail 來說，則看在 Jail 中要執行的服務或應用程式來決定。</p><p>Jail 通常會需要隨著開機執行，使用 FreeBSD <code class="filename">rc</code> 機制可讓以簡單的達成這件事。</p><div class="procedure"><ul class="procedure"><li class="step"><p>在 <code class="filename">jail.conf</code> 中設定 jail 參數：</p><pre xml:lang="en" class="programlisting" lang="en"><em class="replaceable"><code>www</code></em> {
    host.hostname = <em class="replaceable"><code>www.example.org</code></em>;           # Hostname
    ip4.addr = <em class="replaceable"><code>192.168.0.10</code></em>;                   # IP address of the jail
    path ="<em class="replaceable"><code>/usr/jail/www</code></em>";                     # Path to the jail
    devfs_ruleset = "<em class="replaceable"><code>www_ruleset</code></em>";             # devfs ruleset
    mount.devfs;                               # Mount devfs inside the jail
    exec.start = "/bin/sh /etc/rc";            # Start command
    exec.stop = "/bin/sh /etc/rc.shutdown";    # Stop command
}</pre><p>在 <code class="filename">rc.conf</code> 中設定開機時啟動 Jail：</p><pre xml:lang="en" class="programlisting" lang="en">jail_enable="YES"   # Set to NO to disable starting of any jails</pre><p>預設要啟動的 Jail 可在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail.conf</span>(5)</span></a> 設定，會把 Jail 當作是一個完全虛擬的系統，然後執行 Jail 中的 <code class="filename">/etc/rc</code> Script。針對服務型的 Jail 則需透過設定 <code class="varname">exec.start</code> 選項來適當更改 Jail 的預設啟動指令。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">要取得完整可用選項的清單，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail.conf</span>(5)</span></a>操作手冊。</p></div></li></ul></div><p>若 Jail 項目已經在 <code class="filename">jail.conf</code> 中設定好，可以手動用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=service&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">service</span>(8)</span></a> 來啟動或停止某個 Jail 項目：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service jail start <em class="replaceable"><code>www</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service jail stop <em class="replaceable"><code>www</code></em></code></strong></pre><p>Jail 可以使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jexec&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jexec</span>(8)</span></a> 來關機。先使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jls&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jls</span>(8)</span></a> 來辦識 Jail 的 <code class="varname">JID</code>，然後使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jexec&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jexec</span>(8)</span></a> 在該 Jail 中執行關機 Script。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>jls</code></strong>
   JID  IP Address      Hostname                      Path
     3  192.168.0.10    www                           /usr/jail/www
<code class="prompt">#</code> <strong class="userinput"><code>jexec <em class="replaceable"><code>3</code></em> /etc/rc.shutdown</code></strong></pre><p>更多有關 Jail 的資訊可在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> 操作手冊取得。</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="jails-tuning"></a>14.4. 調校與管理</h2></div></div></div><p>還有許多選項可以對所有 Jail 做設定，以及各種可讓 Jail 與主機 FreeBSD 系統結合的方法來提供更高層級的應用程式使用。 本節將介紹：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Some of the options available for tuning the behavior
	  and security restrictions implemented by a jail
	  installation.</p></li><li class="listitem"><p xml:lang="en" lang="en">Some of the high-level applications for jail management,
	  which are available through the FreeBSD Ports Collection, and
	  can be used to implement overall jail-based
	  solutions.</p></li></ul></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-tuning-utilities"></a>14.4.1. 在 FreeBSD 中調校 Jail 的系統工具</h3></div></div></div><p xml:lang="en" lang="en">Fine tuning of a jail's configuration is mostly done by
	setting <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variables.  A special subtree of sysctl
	exists as a basis for organizing all the relevant options: the
	<code class="varname">security.jail.*</code> hierarchy of FreeBSD kernel
	options.  Here is a list of the main jail-related sysctls,
	complete with their default value.  Names should be
	self-explanatory, but for more information about them, please
	refer to the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> manual
	pages.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.jail.set_hostname_allowed:
	      1</code></p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.jail.socket_unixiproute_only:
	      1</code></p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.jail.sysvipc_allowed:
	      0</code></p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.jail.enforce_statfs:
	      2</code></p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.jail.allow_raw_sockets:
	      0</code></p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.jail.chflags_allowed:
	      0</code></p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.jail.jailed: 0</code></p></li></ul></div><p xml:lang="en" lang="en">These variables can be used by the system administrator of
	the <span class="emphasis"><em>host system</em></span> to add or remove some of
	the limitations imposed by default on the <code class="systemitem">root</code> user.  Note that there
	are some limitations which cannot be removed.  The
	<code class="systemitem">root</code> user is not
	allowed to mount or unmount file systems from within a
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>.  The <code class="systemitem">root</code> inside a jail may not
	load or unload <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> rulesets, set firewall rules, or
	do many other administrative tasks which require modifications
	of in-kernel data, such as setting the
	<code class="varname">securelevel</code> of the kernel.</p><p xml:lang="en" lang="en">The base system of FreeBSD contains a basic set of tools for
	viewing information about the active jails, and attaching to a
	jail to run administrative commands.  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jls&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jls</span>(8)</span></a> and
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jexec&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jexec</span>(8)</span></a> commands are part of the base FreeBSD system, and
	can be used to perform the following simple tasks:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Print a list of active jails and their corresponding
	    jail identifier (<acronym class="acronym">JID</acronym>),
	    <acronym class="acronym">IP</acronym> address, hostname and path.</p></li><li class="listitem"><p xml:lang="en" lang="en">Attach to a running jail, from its host system, and
	    run a command inside the jail or perform administrative
	    tasks inside the jail itself.  This is especially useful
	    when the <code class="systemitem">root</code>
	    user wants to cleanly shut down a jail.  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jexec&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jexec</span>(8)</span></a>
	    utility can also be used to start a shell in a jail to do
	    administration in it; for example:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>jexec <em class="replaceable"><code>1</code></em> tcsh</code></strong></pre></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-tuning-admintools"></a>14.4.2. 在 FreeBSD Port 套件集中的高層級管理工具</h3></div></div></div><p xml:lang="en" lang="en">Among the many third-party utilities for jail
	administration, one of the most complete and useful is
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/ezjail/pkg-descr">sysutils/ezjail</a>.  It is a set of scripts
	that contribute to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> management.  Please refer to
	<a class="link" href="../../../../doc/en_US.ISO8859-1/books/handbook/jails-ezjail.html" target="_top">the
	  handbook section on <span class="application">ezjail</span></a>
	for more information.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-updating"></a>14.4.3. 持續 Jail 的修補與更新</h3></div></div></div><p xml:lang="en" lang="en">Jails should be kept up to date from the host operating
	system as attempting to patch userland from within the jail
	may likely fail as the default behavior in FreeBSD is to
	disallow the use of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chflags</span>(1)</span></a> in a jail which prevents
	the replacement of some files.  It is possible to change this
	behavior but it is recommended to use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=freebsd-update&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">freebsd-update</span>(8)</span></a>
	to maintain jails instead.  Use <code class="option">-b</code> to specify
	the path of the jail to be updated.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update -b <em class="replaceable"><code>/here/is/the/jail</code></em> fetch</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>freebsd-update -b <em class="replaceable"><code>/here/is/the/jail</code></em> install</code></strong></pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="jails-application"></a>14.5. 更新多個 Jail</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Daniel</span> <span class="surname">Gerzo</span></span>. </span></div><div><span class="authorgroup">Based upon an idea presented by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Simon</span> <span class="surname">L. B. Nielsen</span></span>. </span></div><div><span class="authorgroup">And an article written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Ken</span> <span class="surname">Tom</span></span>. </span></div></div></div><p xml:lang="en" lang="en">The management of multiple jails can become problematic
      because every jail has to be rebuilt from scratch whenever it is
      upgraded.  This can be time consuming and tedious if a lot of
      jails are created and manually updated.</p><p xml:lang="en" lang="en">This section demonstrates one method to resolve this issue
      by safely sharing as much as is possible between jails using
      read-only <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount_nullfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount_nullfs</span>(8)</span></a> mounts, so that updating is
      simpler.  This makes it more attractive to put single services,
      such as <acronym class="acronym">HTTP</acronym>, <acronym class="acronym">DNS</acronym>, and
      <acronym class="acronym">SMTP</acronym>, into individual jails.  Additionally,
      it provides a simple way to add, remove, and upgrade
      jails.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Simpler solutions exist, such as
	<span class="application">ezjail</span>, which provides an easier
	method of administering FreeBSD jails but is less versatile than
	this setup.  <span class="application">ezjail</span> is covered in
	more detail in <a class="xref" href="#jails-ezjail" title="14.6. 使用 ezjail 管理 Jail">節 14.6, “使用 <span class="application">ezjail</span> 管理 Jail”</a>.</p></div><p xml:lang="en" lang="en">The goals of the setup described in this section are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Create a simple and easy to understand jail structure
	  that does not require running a full installworld on each
	  and every jail.</p></li><li class="listitem"><p xml:lang="en" lang="en">Make it easy to add new jails or remove existing
	  ones.</p></li><li class="listitem"><p xml:lang="en" lang="en">Make it easy to update or upgrade existing jails.</p></li><li class="listitem"><p xml:lang="en" lang="en">Make it possible to run a customized FreeBSD branch.</p></li><li class="listitem"><p xml:lang="en" lang="en">Be paranoid about security, reducing as much as
	  possible the possibility of compromise.</p></li><li class="listitem"><p xml:lang="en" lang="en">Save space and inodes, as much as possible.</p></li></ul></div><p xml:lang="en" lang="en">This design relies on a single, read-only master template
      which is mounted into each jail and one read-write device per
      jail.  A device can be a separate physical disc, a partition, or
      a vnode backed memory device.  This example uses read-write
      <span class="application">nullfs</span> mounts.</p><p xml:lang="en" lang="en">The file system layout is as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">The jails are based under the
	  <code class="filename">/home</code> partition.</p></li><li class="listitem"><p xml:lang="en" lang="en">Each jail will be mounted under the
	  <code class="filename">/home/j</code> directory.</p></li><li class="listitem"><p xml:lang="en" lang="en">The template for each jail and the read-only partition
	  for  all of the jails is
	  <code class="filename">/home/j/mroot</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en">A blank directory will be created for each jail under
	  the <code class="filename">/home/j</code> directory.</p></li><li class="listitem"><p xml:lang="en" lang="en">Each jail will have a <code class="filename">/s</code> directory
	  that will be linked to the read-write portion of the
	  system.</p></li><li class="listitem"><p xml:lang="en" lang="en">Each jail will have its own read-write system that is
	  based upon <code class="filename">/home/j/skel</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en">The read-write portion of each jail will be created in
	  <code class="filename">/home/js</code>.</p></li></ul></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-service-jails-template"></a>14.5.1. 建立範本</h3></div></div></div><p xml:lang="en" lang="en">This section describes the steps needed to create the
	master template.</p><p xml:lang="en" lang="en">It is recommended to first update the host FreeBSD system to
	the latest -RELEASE branch using the instructions in <a class="xref" href="#makeworld" title="23.5. 從原始碼更新 FreeBSD">節 23.5, “從原始碼更新 FreeBSD”</a>.  Additionally, this template uses the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/cpdup/pkg-descr">sysutils/cpdup</a> package or port and
	<span class="application">portsnap</span> will be used to download
	the FreeBSD Ports Collection.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">First, create a directory structure for the read-only
	    file system which will contain the FreeBSD binaries for the
	    jails.  Then, change directory to the FreeBSD source tree and
	    install the read-only file system to the jail
	    template:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /home/j /home/j/mroot</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installworld DESTDIR=/home/j/mroot</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">Next, prepare a FreeBSD Ports Collection for the jails as
	    well as a FreeBSD source tree, which is required for
	    <span class="application">mergemaster</span>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /home/j/mroot</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir usr/ports</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>portsnap -p /home/j/mroot/usr/ports fetch extract</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cpdup /usr/src /home/j/mroot/usr/src</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">Create a skeleton for the read-write portion of the
	    system:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /home/j/skel /home/j/skel/home /home/j/skel/usr-X11R6 /home/j/skel/distfiles</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv etc /home/j/skel</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv usr/local /home/j/skel/usr-local</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv tmp /home/j/skel</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv var /home/j/skel</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv root /home/j/skel</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">Use <span class="application">mergemaster</span> to install
	    missing configuration files.  Then, remove the extra
	    directories that <span class="application">mergemaster</span>
	    creates:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mergemaster -t /home/j/skel/var/tmp/temproot -D /home/j/skel -i</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /home/j/skel</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rm -R bin boot lib libexec mnt proc rescue sbin sys usr dev</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">Now, symlink the read-write file system to the
	    read-only file system.  Ensure that the symlinks are
	    created in the correct <code class="filename">s/</code> locations
	    as the creation of directories in the wrong locations will
	    cause the installation to fail.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /home/j/mroot</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir s</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s s/etc etc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s s/home home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s s/root root</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s ../s/usr-local usr/local</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s ../s/usr-X11R6 usr/X11R6</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s ../../s/distfiles usr/ports/distfiles</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s s/tmp tmp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s s/var var</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">As a last step, create a generic
	    <code class="filename">/home/j/skel/etc/make.conf</code> containing
	    this line:</p><pre xml:lang="en" class="programlisting" lang="en">WRKDIRPREFIX?=  /s/portbuild</pre><p xml:lang="en" lang="en">This makes it possible to compile FreeBSD ports inside
	    each jail.  Remember that the ports directory is part of
	    the read-only system.  The custom path for
	    <code class="literal">WRKDIRPREFIX</code> allows builds to be done
	    in the read-write portion of every jail.</p></li></ol></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-service-jails-creating"></a>14.5.2. 建立 Jail</h3></div></div></div><p xml:lang="en" lang="en">The jail template can now be used to setup and configure
	the jails in <code class="filename">/etc/rc.conf</code>.  This example
	demonstrates the creation of 3 jails: <code class="literal">NS</code>,
	<code class="literal">MAIL</code> and <code class="literal">WWW</code>.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">Add the following lines to
	    <code class="filename">/etc/fstab</code>, so that the read-only
	    template for the jails and the read-write space will be
	    available in the respective jails:</p><pre xml:lang="en" class="programlisting" lang="en">/home/j/mroot   /home/j/ns     nullfs  ro  0   0
/home/j/mroot   /home/j/mail   nullfs  ro  0   0
/home/j/mroot   /home/j/www    nullfs  ro  0   0
/home/js/ns     /home/j/ns/s   nullfs  rw  0   0
/home/js/mail   /home/j/mail/s nullfs  rw  0   0
/home/js/www    /home/j/www/s  nullfs  rw  0   0</pre><p xml:lang="en" lang="en">To prevent
	    <span class="application">fsck</span> from checking
	    <span class="application">nullfs</span> mounts during boot and
	    <span class="application">dump</span> from backing up the
	    read-only nullfs mounts of the jails, the last two
	    columns are both set to <code class="literal">0</code>.</p></li><li class="step"><p xml:lang="en" lang="en">Configure the jails in
	    <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">jail_enable="YES"
jail_set_hostname_allow="NO"
jail_list="ns mail www"
jail_ns_hostname="ns.example.org"
jail_ns_ip="192.168.3.17"
jail_ns_rootdir="/usr/home/j/ns"
jail_ns_devfs_enable="YES"
jail_mail_hostname="mail.example.org"
jail_mail_ip="192.168.3.18"
jail_mail_rootdir="/usr/home/j/mail"
jail_mail_devfs_enable="YES"
jail_www_hostname="www.example.org"
jail_www_ip="62.123.43.14"
jail_www_rootdir="/usr/home/j/www"
jail_www_devfs_enable="YES"</pre><p xml:lang="en" lang="en">The
	    <code class="varname">jail_<em class="replaceable"><code>name</code></em>_rootdir</code>
	    variable is set to
	    <code class="filename">/usr/home</code> instead
	    of <code class="filename">/home</code> because
	    the physical path of <code class="filename">/home</code> on a default FreeBSD
	    installation is <code class="filename">/usr/home</code>.  The
	    <code class="varname">jail_<em class="replaceable"><code>name</code></em>_rootdir</code>
	    variable must <span class="emphasis"><em>not</em></span> be set to a path
	    which includes a symbolic link, otherwise the jails will
	    refuse to start.</p></li><li class="step"><p xml:lang="en" lang="en">Create the required mount points for the read-only
	    file system of each jail:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /home/j/ns /home/j/mail /home/j/www</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">Install the read-write template into each jail using
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/cpdup/pkg-descr">sysutils/cpdup</a>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /home/js</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cpdup /home/j/skel /home/js/ns</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cpdup /home/j/skel /home/js/mail</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cpdup /home/j/skel /home/js/www</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">In this phase, the jails are built and prepared to
	    run.  First, mount the required file systems for each
	    jail, and then start them:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount -a</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service jail start</code></strong></pre></li></ol></div><p xml:lang="en" lang="en">The jails should be running now.  To check if they have
	started correctly, use <code class="command">jls</code>.  Its output
	should be similar to the following:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>jls</code></strong>
   JID  IP Address      Hostname                      Path
     3  192.168.3.17    ns.example.org                /home/j/ns
     2  192.168.3.18    mail.example.org              /home/j/mail
     1  62.123.43.14    www.example.org               /home/j/www</pre><p xml:lang="en" lang="en">At this point, it should be possible to log onto each
	jail, add new users, or configure daemons.  The
	<code class="literal">JID</code> column indicates the jail
	identification number of each running jail.  Use the following
	command to perform administrative tasks in the jail whose
	<acronym class="acronym">JID</acronym> is <code class="literal">3</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>jexec 3 tcsh</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-service-jails-upgrading"></a>14.5.3. 升級</h3></div></div></div><p xml:lang="en" lang="en">The design of this setup provides an easy way to upgrade
	existing jails while minimizing their downtime.  Also, it
	provides a way to roll back to the older version should a
	problem occur.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">The first step is to upgrade the host system.  Then,
	    create a new temporary read-only template in
	    <code class="filename">/home/j/mroot2</code>.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /home/j/mroot2</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installworld DESTDIR=/home/j/mroot2</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /home/j/mroot2</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cpdup /usr/src usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir s</code></strong></pre><p xml:lang="en" lang="en">The <code xml:lang="en" class="buildtarget" lang="en">installworld</code> creates a
	    few unnecessary directories, which should be
	    removed:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>chflags -R 0 var</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rm -R etc var root usr/local tmp</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">Recreate the read-write symlinks for the master file
	    system:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ln -s s/etc etc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s s/root root</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s s/home home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s ../s/usr-local usr/local</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s ../s/usr-X11R6 usr/X11R6</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s s/tmp tmp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s s/var var</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">Next, stop the jails:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service jail stop</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">Unmount the original file systems as the read-write
	    systems are attached to the read-only system
	    (<code class="filename">/s</code>):</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>umount /home/j/ns/s</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>umount /home/j/ns</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>umount /home/j/mail/s</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>umount /home/j/mail</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>umount /home/j/www/s</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>umount /home/j/www</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">Move the old read-only file system and replace it with
	    the new one.  This will serve as a backup and archive of
	    the old read-only file system should something go wrong.
	    The naming convention used here corresponds to when a new
	    read-only file system has been created.  Move the original
	    FreeBSD Ports Collection over to the new file system to save
	    some space and inodes:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /home/j</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv mroot mroot.20060601</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv mroot2 mroot</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv mroot.20060601/usr/ports mroot/usr</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">At this point the new read-only template is ready, so
	    the only remaining task is to remount the file systems and
	    start the jails:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount -a</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service jail start</code></strong></pre></li></ol></div><p xml:lang="en" lang="en">Use <code class="command">jls</code> to check if the jails started
	correctly.  Run <code class="command">mergemaster</code> in each jail to
	update the configuration files.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="jails-ezjail"></a>14.6. 使用 <span class="application">ezjail</span> 管理 Jail</h2></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Warren</span> <span class="surname">Block</span></span>. </span></div></div></div><p xml:lang="en" lang="en">Creating and managing multiple jails can quickly become
      tedious and error-prone.  Dirk Engling's
      <span class="application">ezjail</span> automates and greatly
      simplifies many jail tasks.  A <span class="emphasis"><em>basejail</em></span> is
      created as a template.  Additional jails use
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount_nullfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount_nullfs</span>(8)</span></a> to share many of the basejail directories
      without using additional disk space.  Each additional jail takes
      only a few megabytes of disk space before applications are
      installed.  Upgrading the copy of the userland in the basejail
      automatically upgrades all of the other jails.</p><p xml:lang="en" lang="en">Additional benefits and features are described in detail on
      the <span class="application">ezjail</span> web site, <a class="link" href="https://erdgeist.org/arts/software/ezjail/" target="_top">https://erdgeist.org/arts/software/ezjail/</a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-install"></a>14.6.1. 安裝 <span class="application">ezjail</span></h3></div></div></div><p xml:lang="en" lang="en">Installing <span class="application">ezjail</span> consists of
	adding a loopback interface for use in jails, installing the
	port or package, and enabling the service.</p><div class="procedure"><a id="jails-ezjail-install-procedure"></a><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">To keep jail loopback traffic off the host's loopback
	    network interface <code class="literal">lo0</code>, a second
	    loopback interface is created by adding an entry to
	    <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">cloned_interfaces="lo1"</pre><p xml:lang="en" lang="en">The second loopback interface <code class="literal">lo1</code>
	    will be created when the system starts.  It can also be
	    created manually without a restart:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service netif cloneup</code></strong>
Created clone interfaces: lo1.</pre><p xml:lang="en" lang="en">Jails can be allowed to use aliases of this secondary
	    loopback interface without interfering with the
	    host.</p><p xml:lang="en" lang="en">Inside a jail, access to the loopback address
	    <code class="systemitem">127.0.0.1</code> is
	    redirected to the first <acronym class="acronym">IP</acronym> address
	    assigned to the jail.  To make the jail loopback
	    correspond with the new <code class="literal">lo1</code> interface,
	    that interface must be specified first in the list of
	    interfaces and <acronym class="acronym">IP</acronym> addresses given when
	    creating a new jail.</p><p xml:lang="en" lang="en">Give each jail a unique loopback address in the
	    <code class="systemitem">127.0.0.0</code><code class="systemitem">/8</code> netblock.</p></li><li class="step"><p xml:lang="en" lang="en">Install
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/ezjail/pkg-descr">sysutils/ezjail</a>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/sysutils/ezjail</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">Enable <span class="application">ezjail</span> by adding
	    this line to <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">ezjail_enable="YES"</pre></li><li class="step"><p xml:lang="en" lang="en">The service will automatically start on system boot.
	    It can be started immediately for the current
	    session:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service ezjail start</code></strong></pre></li></ol></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-initialsetup"></a>14.6.2. 初始設定</h3></div></div></div><p xml:lang="en" lang="en">With <span class="application">ezjail</span> installed, the
	basejail directory structure can be created and populated.
	This step is only needed once on the jail host
	computer.</p><p xml:lang="en" lang="en">In both of these examples, <code class="option">-p</code> causes the
	ports tree to be retrieved with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=portsnap&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">portsnap</span>(8)</span></a> into the
	basejail.  That single copy of the ports directory will be
	shared by all the jails.  Using a separate copy of the ports
	directory for jails isolates them from the host.  The
	<span class="application">ezjail</span> <acronym class="acronym">FAQ</acronym>
	explains in more detail: <a class="link" href="http://erdgeist.org/arts/software/ezjail/#FAQ" target="_top">http://erdgeist.org/arts/software/ezjail/#FAQ</a>.</p><div class="procedure"><a id="jails-ezjail-initialsetup-procedure"></a><ul class="procedure"><li class="step"><ul class="stepalternatives">
	    <li class="step"><p xml:lang="en" class="title" lang="en"><strong>To Populate the Jail with FreeBSD-RELEASE</strong></p><p xml:lang="en" lang="en">For a basejail based on the FreeBSD RELEASE matching
		that of the host computer, use
		<code class="command">install</code>.  For example, on a host
		computer running FreeBSD 10-STABLE, the latest
		RELEASE version of FreeBSD -10 will be installed in
		the jail):</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin install -p</code></strong></pre></li>

	    <li class="step"><p xml:lang="en" class="title" lang="en"><strong>To Populate the Jail with
		<code class="command">installworld</code></strong></p><p xml:lang="en" lang="en">The basejail can be installed from binaries
		created by <code xml:lang="en" class="buildtarget" lang="en">buildworld</code> on
		the host with
		<code class="command">ezjail-admin update</code>.</p><p xml:lang="en" lang="en">In this example, FreeBSD 10-STABLE has been
		built from source.  The jail directories are created.
		Then <code xml:lang="en" class="buildtarget" lang="en">installworld</code> is
		executed, installing the host's
		<code class="filename">/usr/obj</code> into the
		basejail.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin update -i -p</code></strong></pre><p xml:lang="en" lang="en">The host's <code class="filename">/usr/src</code> is used
		by default.  A different source directory on the host
		can be specified with <code class="option">-s</code> and a path,
		or set with <code class="varname">ezjail_sourcetree</code> in
		<code class="filename">/usr/local/etc/ezjail.conf</code>.</p></li>
	  </ul></li></ul></div><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The basejail's ports tree is shared by other jails.
	  However, downloaded distfiles are stored in the jail that
	  downloaded them.  By default, these files are stored in
	  <code class="filename">/var/ports/distfiles</code> within each
	  jail.  <code class="filename">/var/ports</code> inside each jail is
	  also used as a work directory when building ports.</p></div><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The <acronym class="acronym">FTP</acronym> protocol is used by default
	  to download packages for the installation of the basejail.
	  Firewall or proxy configurations can prevent or interfere
	  with <acronym class="acronym">FTP</acronym> transfers.  The
	  <acronym class="acronym">HTTP</acronym> protocol works differently and
	  avoids these problems.  It can be chosen by specifying a
	  full <acronym class="acronym">URL</acronym> for a particular download mirror
	  in <code class="filename">/usr/local/etc/ezjail.conf</code>:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="programlisting" lang="en">ezjail_ftphost=http://<em class="replaceable"><code>ftp.FreeBSD.org</code></em></pre><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">See <a class="xref" href="#mirrors-ftp" title="A.2. FTP 站">節 A.2, “<acronym class="acronym">FTP</acronym> 站”</a> for a list of
	  sites.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-create"></a>14.6.3. 建立並啟動新的 Jail</h3></div></div></div><p xml:lang="en" lang="en">New jails are created with
	<code class="command">ezjail-admin create</code>.  In these examples,
	the <code class="literal">lo1</code> loopback interface is used as
	described above.</p><div class="procedure"><a id="jails-ezjail-create-steps"></a><div class="procedure-title">過程 14.1. Create and Start a New Jail</div><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">Create the jail, specifying a name and the loopback
	    and network interfaces to use, along with their
	    <acronym class="acronym">IP</acronym> addresses.  In this example, the
	    jail is named <code class="literal">dnsjail</code>.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin create <em class="replaceable"><code>dnsjail</code></em> '<em class="replaceable"><code>lo1|127.0.1.1</code></em>,<em class="replaceable"><code>em0</code></em>|<em class="replaceable"><code>192.168.1.50</code></em>'</code></strong></pre><div xmlns="" class="tip"><h3 class="admontitle"><a xmlns="http://www.w3.org/1999/xhtml" id="jails-ezjail-raw-network-sockets"></a>提示: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Most network services run in jails without
	      problems.  A few network services, most notably
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a>, use
	      <span class="emphasis"><em>raw network sockets</em></span>.  In jails, raw
	      network sockets are disabled by default for security.
	      Services that require them will not work.</p><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Occasionally, a jail genuinely needs raw sockets.
	      For example, network monitoring applications often use
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a> to check the availability of other
	      computers.  When raw network sockets are actually needed
	      in a jail, they can be enabled by editing the
	      <span class="application">ezjail</span>
	      configuration file for the individual jail,
	      <code class="filename">/usr/local/etc/ezjail/<em class="replaceable"><code>jailname</code></em></code>.
	      Modify the <code class="literal">parameters</code>
	      entry:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="programlisting" lang="en">export jail_<em class="replaceable"><code>jailname</code></em>_parameters="allow.raw_sockets=1"</pre><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Do not enable raw network sockets unless services in
	      the jail actually require them.</p></div></li><li class="step"><p xml:lang="en" lang="en">Start the jail:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin start <em class="replaceable"><code>dnsjail</code></em></code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">Use a console on the jail:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin console <em class="replaceable"><code>dnsjail</code></em></code></strong></pre></li></ol></div><p xml:lang="en" lang="en">The jail is operating and additional configuration can be
	completed.  Typical settings added at this point
	include:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p xml:lang="en" class="title" lang="en"><strong>Set the
	    <code class="systemitem">root</code>
	    Password</strong></p><p xml:lang="en" lang="en">Connect to the jail and set the
	    <code class="systemitem">root</code> user's
	    password:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin console <em class="replaceable"><code>dnsjail</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>passwd</code></strong>
Changing local password for root
New Password:
Retype New Password:</pre></li><li class="step"><p xml:lang="en" class="title" lang="en"><strong>Time Zone Configuration</strong></p><p xml:lang="en" lang="en">The jail's time zone can be set with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tzsetup&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tzsetup</span>(8)</span></a>.
	    To avoid spurious error messages, the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=adjkerntz&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">adjkerntz</span>(8)</span></a>
	    entry in <code class="filename">/etc/crontab</code> can be
	    commented or removed.  This job attempts to update the
	    computer's hardware clock with time zone changes, but
	    jails are not allowed to access that hardware.</p></li><li class="step"><p xml:lang="en" class="title" lang="en"><strong><acronym class="acronym">DNS</acronym> Servers</strong></p><p xml:lang="en" lang="en">Enter domain name server lines in
	    <code class="filename">/etc/resolv.conf</code> so
	    <acronym class="acronym">DNS</acronym> works in the jail.</p></li><li class="step"><p xml:lang="en" class="title" lang="en"><strong>Edit <code class="filename">/etc/hosts</code></strong></p><p xml:lang="en" lang="en">Change the address and add the jail name to the
	    <code class="literal">localhost</code> entries in
	    <code class="filename">/etc/hosts</code>.</p></li><li class="step"><p xml:lang="en" class="title" lang="en"><strong>Configure <code class="filename">/etc/rc.conf</code></strong></p><p xml:lang="en" lang="en">Enter configuration settings in
	    <code class="filename">/etc/rc.conf</code>.  This is much like
	    configuring a full computer.  The host name and
	    <acronym class="acronym">IP</acronym> address are not set here.  Those
	    values are already provided by the jail
	    configuration.</p></li></ol></div><p xml:lang="en" lang="en">With the jail configured, the applications for which the
	jail was created can be installed.</p><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Some ports must be built with special options to be used
	  in a jail.  For example, both of the network monitoring
	  plugin packages
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/nagios-plugins/pkg-descr">net-mgmt/nagios-plugins</a> and
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/monitoring-plugins/pkg-descr">net-mgmt/monitoring-plugins</a>
	  have a <code class="literal">JAIL</code> option which must be enabled
	  for them to work correctly inside a jail.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-update"></a>14.6.4. 更新 Jail</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-update-os"></a>14.6.4.1. 更新作業系統</h4></div></div></div><p xml:lang="en" lang="en">Because the basejail's copy of the userland is shared by
	  the other jails, updating the basejail automatically updates
	  all of the other jails.  Either source or binary updates can
	  be used.</p><p xml:lang="en" lang="en">To build the world from source on the host, then
	  install it in the basejail, use:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin update -b</code></strong></pre><p xml:lang="en" lang="en">If the world has already been compiled on the host,
	  install it in the basejail with:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin update -i</code></strong></pre><p xml:lang="en" lang="en">Binary updates use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=freebsd-update&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">freebsd-update</span>(8)</span></a>.  These
	  updates have the same limitations as if
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=freebsd-update&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">freebsd-update</span>(8)</span></a> were being run directly.  The most
	  important one is that only -RELEASE versions of FreeBSD are
	  available with this method.</p><p xml:lang="en" lang="en">Update the basejail to the latest patched release of
	  the version of FreeBSD on the host.  For example, updating from
	  RELEASE-p1 to RELEASE-p2.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin update -u</code></strong></pre><p xml:lang="en" lang="en">To upgrade the basejail to a new version, first
	  upgrade the host system as described in <a class="xref" href="#freebsdupdate-upgrade" title="23.2.3. 執行主要及次要版號升級">節 23.2.3, “執行主要及次要版號升級”</a>.  Once the host has
	  been upgraded and rebooted, the basejail can then be
	  upgraded.  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=freebsd-update&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">freebsd-update</span>(8)</span></a> has no way of determining
	  which version is currently installed in the basejail, so the
	  original version must be specified.  Use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=file&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">file</span>(1)</span></a> to
	  determine the original version in the basejail:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>file /usr/jails/basejail/bin/sh</code></strong>
/usr/jails/basejail/bin/sh: ELF 64-bit LSB executable, x86-64, version 1 (FreeBSD), dynamically linked (uses shared libs), for FreeBSD 9.3, stripped</pre><p xml:lang="en" lang="en">Now use this information to perform the upgrade from
	  <code class="literal">9.3-RELEASE</code> to the current version of
	  the host system:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin update -U -s <em class="replaceable"><code>9.3-RELEASE</code></em></code></strong></pre><p xml:lang="en" lang="en">After updating the basejail, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> must
	  be run to update each jail's configuration files.</p><p xml:lang="en" lang="en">How to use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> depends on the purpose
	  and trustworthiness of a jail.  If a jail's services or
	  users are not trusted, then <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> should only
	  be run from within that jail:</p><div class="example"><a id="jails-ezjail-update-mergemaster-untrusted"></a><div class="example-title">範例 14.1. 在不信任的 Jail 做 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a></div><div class="example-contents"><p xml:lang="en" lang="en">Delete the link from the jail's
	    <code class="filename">/usr/src</code> into the basejail and
	    create a new <code class="filename">/usr/src</code> in the jail
	    as a mountpoint.  Mount the host computer's
	    <code class="filename">/usr/src</code> read-only on the jail's
	    new <code class="filename">/usr/src</code> mountpoint:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>rm /usr/jails/<em class="replaceable"><code>jailname</code></em>/usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir /usr/jails/<em class="replaceable"><code>jailname</code></em>/usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -t nullfs -o ro /usr/src /usr/jails/<em class="replaceable"><code>jailname</code></em>/usr/src</code></strong></pre><p xml:lang="en" lang="en">Get a console in the jail:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin console <em class="replaceable"><code>jailname</code></em></code></strong></pre><p xml:lang="en" lang="en">Inside the jail, run <code class="command">mergemaster</code>.
	    Then exit the jail console:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mergemaster -U</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>exit</code></strong></pre><p xml:lang="en" lang="en">Finally, unmount the jail's
	    <code class="filename">/usr/src</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>umount /usr/jails/<em class="replaceable"><code>jailname</code></em>/usr/src</code></strong></pre></div></div><br class="example-break" /><div class="example"><a id="jails-ezjail-update-mergemaster-trusted"></a><div class="example-title">範例 14.2. 在信任的 Jail 做 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a></div><div class="example-contents"><p xml:lang="en" lang="en">If the users and services in a jail are trusted,
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> can be run from the host:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mergemaster -U -D /usr/jails/<em class="replaceable"><code>jailname</code></em></code></strong></pre></div></div><br class="example-break" /></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-update-ports"></a>14.6.4.2. 更新 Port</h4></div></div></div><p xml:lang="en" lang="en">The ports tree in the basejail is shared by the other
	  jails.  Updating that copy of the ports tree gives the other
	  jails the updated version also.</p><p xml:lang="en" lang="en">The basejail ports tree is updated with
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=portsnap&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">portsnap</span>(8)</span></a>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin update -P</code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-control"></a>14.6.5. 控制 Jail</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-control-stop-start"></a>14.6.5.1. 停止與啟動 Jail</h4></div></div></div><p xml:lang="en" lang="en"><span class="application">ezjail</span> automatically starts
	  jails when the computer is started.  Jails can be manually
	  stopped and restarted with <code class="command">stop</code> and
	  <code class="command">start</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin stop <em class="replaceable"><code>sambajail</code></em></code></strong>
Stopping jails: sambajail.</pre><p xml:lang="en" lang="en">By default, jails are started automatically when the
	  host computer starts.  Autostarting can be disabled
	  with <code class="command">config</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin config -r norun <em class="replaceable"><code>seldomjail</code></em></code></strong></pre><p xml:lang="en" lang="en">This takes effect the next time the host computer is
	  started.  A jail that is already running will not be
	  stopped.</p><p xml:lang="en" lang="en">Enabling autostart is very similar:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin config -r run <em class="replaceable"><code>oftenjail</code></em></code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-control-backup"></a>14.6.5.2. 封存與還原 Jail</h4></div></div></div><p xml:lang="en" lang="en">Use <code class="command">archive</code> to create a
	  <code class="filename">.tar.gz</code> archive of a jail.  The file
	  name is composed from the name of the jail and the current
	  date.  Archive files are written to the archive directory,
	  <code class="filename">/usr/jails/ezjail_archives</code>.  A
	  different archive directory can be chosen by setting
	  <code class="varname">ezjail_archivedir</code> in the configuration
	  file.</p><p xml:lang="en" lang="en">The archive file can be copied elsewhere as a backup, or
	  an existing jail can be restored from it with
	  <code class="command">restore</code>.  A new jail can be created from
	  the archive, providing a convenient way to clone existing
	  jails.</p><p xml:lang="en" lang="en">Stop and archive a jail named
	  <code class="literal">wwwserver</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin stop <em class="replaceable"><code>wwwserver</code></em></code></strong>
Stopping jails: wwwserver.
<code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin archive <em class="replaceable"><code>wwwserver</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls /usr/jails/ezjail-archives/</code></strong>
wwwserver-201407271153.13.tar.gz</pre><p xml:lang="en" lang="en">Create a new jail named
	  <code class="literal">wwwserver-clone</code> from the archive created
	  in the previous step.  Use the <code class="filename">em1</code>
	  interface and assign a new <acronym class="acronym">IP</acronym> address to
	  avoid conflict with the original:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin create -a /usr/jails/ezjail_archives/wwwserver-201407271153.13.tar.gz <em class="replaceable"><code>wwwserver-clone</code></em> 'lo1|127.0.3.1,em1|192.168.1.51'</code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-example-bind"></a>14.6.6. 完整範例：在 Jail 中安裝 <span class="application">BIND</span></h3></div></div></div><p xml:lang="en" lang="en">Putting the <span class="application">BIND</span>
	<acronym class="acronym">DNS</acronym> server in a jail improves security by
	isolating it.  This example creates a simple caching-only name
	server.</p><div class="itemizedlist"><a id="jails-ezjail-example-bind-assumptions"></a><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">The jail will be called
	    <code class="literal">dns1</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en">The jail will use <acronym class="acronym">IP</acronym> address
	    <code class="literal">192.168.1.240</code> on the host's
	    <code class="literal">re0</code> interface.</p></li><li class="listitem"><p xml:lang="en" lang="en">The upstream <acronym class="acronym">ISP</acronym>'s DNS servers are
	    at <code class="literal">10.0.0.62</code> and
	    <code class="literal">10.0.0.61</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en">The basejail has already been created and a ports tree
	    installed as shown in
	    <a class="xref" href="#jails-ezjail-initialsetup" title="14.6.2. 初始設定">節 14.6.2, “初始設定”</a>.</p></li></ul></div><div class="example"><a id="jails-ezjail-example-bind-steps"></a><div class="example-title">範例 14.3. 在 Jail 中執行 BIND</div><div class="example-contents"><p xml:lang="en" lang="en">Create a cloned loopback interface by adding a line to
	  <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">cloned_interfaces="lo1"</pre><p xml:lang="en" lang="en">Immediately create the new loopback interface:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service netif cloneup</code></strong>
Created clone interfaces: lo1.</pre><p xml:lang="en" lang="en">Create the jail:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin create dns1 'lo1|127.0.2.1,re0|192.168.1.240'</code></strong></pre><p xml:lang="en" lang="en">Start the jail, connect to a console running on it, and
	  perform some basic configuration:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin start dns1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin console dns1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>passwd</code></strong>
Changing local password for root
New Password:
Retype New Password:
<code class="prompt">#</code> <strong class="userinput"><code>tzsetup</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sed -i .bak -e '/adjkerntz/ s/^/#/' /etc/crontab</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sed -i .bak -e 's/127.0.0.1/127.0.2.1/g; s/localhost.my.domain/dns1.my.domain dns1/' /etc/hosts</code></strong></pre><p xml:lang="en" lang="en">Temporarily set the upstream <acronym class="acronym">DNS</acronym>
	  servers in <code class="filename">/etc/resolv.conf</code> so ports
	  can be downloaded:</p><pre xml:lang="en" class="programlisting" lang="en">nameserver 10.0.0.62
nameserver 10.0.0.61</pre><p xml:lang="en" lang="en">Still using the jail console, install
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/dns/bind99/pkg-descr">dns/bind99</a>.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>make -C /usr/ports/dns/bind99 install clean</code></strong></pre><p xml:lang="en" lang="en">Configure the name server by editing
	  <code class="filename">/usr/local/etc/namedb/named.conf</code>.</p><p xml:lang="en" lang="en">Create an Access Control List (<acronym class="acronym">ACL</acronym>)
	  of addresses and networks that are permitted to send
	  <acronym class="acronym">DNS</acronym> queries to this name server.  This
	  section is added just before the <code class="literal">options</code>
	  section already in the file:</p><pre xml:lang="en" class="programlisting" lang="en">...
// or cause huge amounts of useless Internet traffic.

acl "trusted" {
	192.168.1.0/24;
	localhost;
	localnets;
};

options {
...</pre><p xml:lang="en" lang="en">Use the jail <acronym class="acronym">IP</acronym> address in the
	  <code class="literal">listen-on</code> setting to accept
	  <acronym class="acronym">DNS</acronym> queries from other computers on the
	  network:</p><pre xml:lang="en" class="programlisting" lang="en">	listen-on	{ 192.168.1.240; };</pre><p xml:lang="en" lang="en">A simple caching-only <acronym class="acronym">DNS</acronym> name server
	  is created by changing the <code class="literal">forwarders</code>
	  section.  The original file contains:</p><pre xml:lang="en" class="programlisting" lang="en">/*
	forwarders {
		127.0.0.1;
	};
*/</pre><p xml:lang="en" lang="en">Uncomment the section by removing the
	  <code class="literal">/*</code> and <code class="literal">*/</code> lines.
	  Enter the <acronym class="acronym">IP</acronym> addresses of the upstream
	  <acronym class="acronym">DNS</acronym> servers.  Immediately after the
	  <code class="literal">forwarders</code> section, add references to the
	  <code class="literal">trusted</code> <acronym class="acronym">ACL</acronym> defined
	  earlier:</p><pre xml:lang="en" class="programlisting" lang="en">	forwarders {
		10.0.0.62;
		10.0.0.61;
	};

	allow-query       { any; };
	allow-recursion   { trusted; };
	allow-query-cache { trusted; };</pre><p xml:lang="en" lang="en">Enable the service in
	  <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">named_enable="YES"</pre><p xml:lang="en" lang="en">Start and test the name server:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service named start</code></strong>
wrote key file "/usr/local/etc/namedb/rndc.key"
Starting named.
<code class="prompt">#</code> <strong class="userinput"><code>/usr/local/bin/dig @192.168.1.240 freebsd.org</code></strong></pre><p xml:lang="en" lang="en">A response that includes</p><pre xml:lang="en" class="screen" lang="en">;; Got answer;</pre><p xml:lang="en" lang="en">shows that the new <acronym class="acronym">DNS</acronym> server is
	  working.  A long delay followed by a response
	  including</p><pre xml:lang="en" class="screen" lang="en">;; connection timed out; no servers could be reached</pre><p xml:lang="en" lang="en">shows a problem.  Check the configuration settings and
	  make sure any local firewalls allow the new
	  <acronym class="acronym">DNS</acronym> access to the upstream
	  <acronym class="acronym">DNS</acronym> servers.</p><p xml:lang="en" lang="en">The new <acronym class="acronym">DNS</acronym> server can use itself for
	  local name resolution, just like other local computers.  Set
	  the address of the <acronym class="acronym">DNS</acronym> server in the
	  client computer's
	  <code class="filename">/etc/resolv.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">nameserver 192.168.1.240</pre><p xml:lang="en" lang="en">A local <acronym class="acronym">DHCP</acronym> server can be configured
	  to provide this address for a local <acronym class="acronym">DNS</acronym>
	  server, providing automatic configuration on
	  <acronym class="acronym">DHCP</acronym> clients.</p></div></div><br class="example-break" /></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac"></a>章 15. 強制存取控制 (MAC)</h2></div><div><span class="authorgroup">Written
	by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#mac-synopsis">15.1. 概述</a></span></dt><dt><span class="sect1"><a href="#mac-inline-glossary">15.2. 關鍵詞</a></span></dt><dt><span class="sect1"><a href="#mac-understandlabel">15.3. 了解 MAC 標籤</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp74021560">15.3.1. 標籤設定</a></span></dt><dt><span class="sect2"><a href="#idp74050360">15.3.2. 預先定義的標籤</a></span></dt><dt><span class="sect2"><a href="#idp74084408">15.3.3. 數值標籤</a></span></dt><dt><span class="sect2"><a href="#idp74090552">15.3.4. 使用者標籤</a></span></dt><dt><span class="sect2"><a href="#idp74110904">15.3.5. 網路介面標籤</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mac-planning">15.4. 規劃安全架構</a></span></dt><dt><span class="sect1"><a href="#mac-policies">15.5. 可用的 MAC 管理政策</a></span></dt><dd><dl><dt><span class="sect2"><a href="#mac-seeotheruids">15.5.1. MAC See Other UIDs 政策</a></span></dt><dt><span class="sect2"><a href="#mac-bsdextended">15.5.2. MAC BSD Extended 政策</a></span></dt><dt><span class="sect2"><a href="#mac-ifoff">15.5.3. MAC Interface Silencing 政策</a></span></dt><dt><span class="sect2"><a href="#mac-portacl">15.5.4. MAC Port Access Control 政策</a></span></dt><dt><span class="sect2"><a href="#mac-partition">15.5.5. MAC Partition 政策</a></span></dt><dt><span class="sect2"><a href="#mac-mls">15.5.6. MAC Multi-Level Security 模組</a></span></dt><dt><span class="sect2"><a href="#mac-biba">15.5.7. MAC Biba 模組</a></span></dt><dt><span class="sect2"><a href="#mac-lomac">15.5.8. MAC Low-watermark 模組</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mac-userlocked">15.6. User Lock Down</a></span></dt><dt><span class="sect1"><a href="#mac-implementing">15.7. 在 MAC Jail 中使用 Nagios</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp74076216">15.7.1. 建立不安全的使用者類別</a></span></dt><dt><span class="sect2"><a href="#idp74080952">15.7.2. 設定使用者</a></span></dt><dt><span class="sect2"><a href="#idp74491320">15.7.3. 建立關聯檔 (Context File)</a></span></dt><dt><span class="sect2"><a href="#idp74498616">15.7.4. 載入程式設定</a></span></dt><dt><span class="sect2"><a href="#idp74502584">15.7.5. 測試設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mac-troubleshoot">15.8. MAC 架構疑難排解</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-synopsis"></a>15.1. 概述</h2></div></div></div><a id="idp73908408" class="indexterm"></a><a id="idp73909048" class="indexterm"></a><p xml:lang="en" lang="en">FreeBSD supports security extensions  based on the
      <span class="trademark">POSIX</span>®.1e draft.  These security mechanisms include file system
      Access Control Lists (<a class="xref" href="#fs-acl" title="13.9. 存取控制清單">節 13.9, “存取控制清單”</a>) and Mandatory
      Access Control (<acronym class="acronym">MAC</acronym>).  <acronym class="acronym">MAC</acronym>
      allows access control modules to be loaded in order to implement
      security policies.  Some modules provide protections for a
      narrow subset of the system, hardening a particular service.
      Others provide comprehensive labeled security across all
      subjects and objects.  The mandatory part of the definition
      indicates that enforcement of controls is performed by
      administrators and the operating system.  This is in contrast to
      the default security mechanism of Discretionary Access Control
      (<acronym class="acronym">DAC</acronym>) where enforcement is left to the
      discretion of users.</p><p xml:lang="en" lang="en">This chapter focuses on the <acronym class="acronym">MAC</acronym> framework
      and the set of pluggable security policy modules FreeBSD provides
      for enabling various security mechanisms.</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">The terminology associated with the
	  <acronym class="acronym">MAC</acronym> framework.</p></li><li class="listitem"><p xml:lang="en" lang="en">The capabilities of <acronym class="acronym">MAC</acronym> security
	  policy modules as well as the difference between a labeled
	  and non-labeled policy.</p></li><li class="listitem"><p xml:lang="en" lang="en">The considerations to take into account before
	  configuring a system to use the
	  <acronym class="acronym">MAC</acronym> framework.</p></li><li class="listitem"><p xml:lang="en" lang="en">Which <acronym class="acronym">MAC</acronym> security policy modules
	  are included in FreeBSD and how to configure them.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to implement a more secure environment using the
	  <acronym class="acronym">MAC</acronym> framework.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to test the <acronym class="acronym">MAC</acronym> configuration
	  to ensure the framework has been properly
	  implemented.</p></li></ul></div><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>了解 <span class="trademark">UNIX</span>® 及 FreeBSD 基礎 (<a class="xref" href="#basics" title="章 3. FreeBSD 基礎">章 3, <em>FreeBSD 基礎</em></a>)。</p></li><li class="listitem"><p xml:lang="en" lang="en">Have some familiarity with security and how it pertains
	  to FreeBSD (<a class="xref" href="#security" title="章 13. 安全性">章 13, <em>安全性</em></a>).</p></li></ul></div><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Improper <acronym class="acronym">MAC</acronym> configuration may cause
	loss of system access, aggravation of users, or inability to
	access the features provided by
	<span class="application">Xorg</span>.  More importantly,
	<acronym class="acronym">MAC</acronym> should not be relied upon to completely
	secure a system.  The <acronym class="acronym">MAC</acronym> framework only
	augments an existing security policy.  Without sound security
	practices and regular security checks, the system will never
	be completely secure.</p><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The examples contained within this chapter are for
	demonstration purposes and the example settings should
	<span class="emphasis"><em>not</em></span> be implemented on a production
	system.  Implementing any security policy takes a good deal of
	understanding, proper design, and thorough testing.</p></div><p xml:lang="en" lang="en">While this chapter covers a broad range of security issues
      relating to the <acronym class="acronym">MAC</acronym> framework, the
      development of new <acronym class="acronym">MAC</acronym> security policy
      modules will not be covered.  A number of security policy
      modules included with the <acronym class="acronym">MAC</acronym> framework have
      specific characteristics which are provided for both testing and
      new module development.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_test&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_test</span>(4)</span></a>,
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_stub&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_stub</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_none&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_none</span>(4)</span></a> for more information on
      these security policy modules and the various mechanisms they
      provide.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-inline-glossary"></a>15.2. 關鍵詞</h2></div></div></div><p xml:lang="en" lang="en">The following key terms are used when referring to the
      <acronym class="acronym">MAC</acronym> framework:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>compartment</em></span>: a set of programs and
	  data to be partitioned or separated, where users are given
	  explicit access to specific component of a system.  A
	  compartment represents a grouping, such as a work group,
	  department, project, or topic.  Compartments make it
	  possible to implement a need-to-know-basis security
	  policy.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>integrity</em></span>: the level of trust which
	  can be placed on data.  As the integrity of the data is
	  elevated, so does the ability to trust that data.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>level</em></span>: the increased or decreased
	  setting of a security attribute.  As the level increases,
	  its security is considered to elevate as well.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>label</em></span>: a security attribute which
	  can be applied to files, directories, or other items in the
	  system.  It could be considered a confidentiality stamp.
	  When a label is placed on a file, it describes the security
	  properties of that file and will only permit access by
	  files, users, and resources with a similar security setting.
	  The meaning and interpretation of label values depends on
	  the policy configuration.  Some policies treat a label as
	  representing the integrity or secrecy of an object while
	  other policies might use labels to hold rules for
	  access.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>multilabel</em></span>: this property is a file
	  system option which can be set in single-user mode using
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a>, during boot using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a>, or during
	  the creation of a new file system.  This option permits
	  an administrator to apply different <acronym class="acronym">MAC</acronym>
	  labels on different objects.  This option only applies to
	  security policy modules which support labeling.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>single label</em></span>: a policy where the
	  entire file system uses one label to enforce access control
	  over the flow of data.  Whenever <code class="option">multilabel</code>
	  is not set, all files will conform to the same label
	  setting.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>object</em></span>: an entity through which
	  information flows under the direction of a
	  <span class="emphasis"><em>subject</em></span>.  This includes directories,
	  files, fields, screens, keyboards, memory, magnetic storage,
	  printers or any other data storage or moving device.  An
	  object is a data container or a system resource.  Access to
	  an object effectively means access to its data.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>subject</em></span>: any active entity that
	  causes information to flow between
	  <span class="emphasis"><em>objects</em></span> such as a user, user process,
	  or system process.  On FreeBSD, this is almost always a
	  thread acting in a process on behalf of a user.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>policy</em></span>: a collection of rules
	  which defines how objectives are to be achieved.  A policy
	  usually documents how certain items are to be handled.  This
	  chapter considers a policy to be a collection of rules which
	  controls the flow of data and information and defines who
	  has access to that data and information.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>high-watermark</em></span>: this type of
	  policy permits the raising of security levels for the
	  purpose of accessing higher level information.  In most
	  cases, the original level is restored after the process is
	  complete.  Currently, the FreeBSD <acronym class="acronym">MAC</acronym>
	  framework does not include this type of policy.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>low-watermark</em></span>: this type of policy
	  permits lowering security levels for the purpose of
	  accessing information which is less secure.  In most cases,
	  the original security level of the user is restored after
	  the process is complete.  The only security policy module in
	  FreeBSD to use this is <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_lomac&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_lomac</span>(4)</span></a>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>sensitivity</em></span>: usually used when
	  discussing Multilevel Security (<acronym class="acronym">MLS</acronym>).  A
	  sensitivity level describes how important or secret the data
	  should be.  As the sensitivity level increases, so does the
	  importance of the secrecy, or confidentiality, of the
	  data.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-understandlabel"></a>15.3. 了解 MAC 標籤</h2></div></div></div><p xml:lang="en" lang="en">A <acronym class="acronym">MAC</acronym> label is a security attribute
      which may be applied to subjects and objects throughout the
      system.  When setting a label, the administrator must
      understand its implications in order to prevent unexpected or
      undesired behavior of the system.  The attributes available on
      an object depend on the loaded policy module, as policy modules
      interpret their attributes in different ways.</p><p xml:lang="en" lang="en">The security label on an object is used as a part of a
      security access control decision by a policy.  With some
      policies, the label contains all of the information necessary
      to make a decision.  In other policies, the labels may be
      processed as part of a larger rule set.</p><p xml:lang="en" lang="en">There are two types of label policies: single label and
      multi label.  By default, the system will use single label.  The
      administrator should be aware of the pros and cons of each in
      order to implement policies which meet the requirements of the
      system's security model.</p><p xml:lang="en" lang="en">A single label security policy only permits one label to be
      used for every subject or object.  Since a single label policy
      enforces one set of access permissions across the entire system,
      it provides lower administration overhead, but decreases the
      flexibility of policies which support labeling.  However, in
      many environments, a single label policy may be all that is
      required.</p><p xml:lang="en" lang="en">A single label policy is somewhat similar to
      <acronym class="acronym">DAC</acronym> as <code class="systemitem">root</code> configures the policies so
      that users are placed in the appropriate categories and access
      levels.  A notable difference is that many policy modules can
      also restrict <code class="systemitem">root</code>.
      Basic control over objects will then be released to the group,
      but <code class="systemitem">root</code> may revoke or
      modify the settings at any time.</p><p xml:lang="en" lang="en">When appropriate, a multi label policy can be set on a
      <acronym class="acronym">UFS</acronym> file system by passing
      <code class="option">multilabel</code> to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a>.  A multi label
      policy permits each subject or object to have its own
      independent <acronym class="acronym">MAC</acronym> label.  The decision to use a
      multi label or single label policy is only required for policies
      which implement the labeling feature, such as
      <code class="literal">biba</code>, <code class="literal">lomac</code>, and
      <code class="literal">mls</code>.  Some policies, such as
      <code class="literal">seeotheruids</code>, <code class="literal">portacl</code> and
      <code class="literal">partition</code>, do not use labels at all.</p><p xml:lang="en" lang="en">Using a multi label policy on a partition and establishing a
      multi label security model can increase administrative overhead
      as everything in that file system has a label.  This includes
      directories, files, and even device nodes.</p><p xml:lang="en" lang="en">The following command will set <code class="option">multilabel</code>
      on the specified <acronym class="acronym">UFS</acronym> file system.  This may
      only be done in single-user mode and is not a requirement for
      the swap file system:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>tunefs -l enable /</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Some users have experienced problems with setting the
	<code class="option">multilabel</code> flag on the root partition.  If
	this is the case, please review <a class="xref" href="#mac-troubleshoot" title="15.8. MAC 架構疑難排解">節 15.8, “MAC 架構疑難排解”</a>.</p></div><p xml:lang="en" lang="en">Since the multi label policy is set on a per-file system
      basis, a multi label policy may not be needed if the file system
      layout is well designed.  Consider an example security
      <acronym class="acronym">MAC</acronym> model for a FreeBSD web server.  This
      machine uses the single label, <code class="literal">biba/high</code>, for
      everything in the default file systems.  If the web server needs
      to run at <code class="literal">biba/low</code> to prevent write up
      capabilities, it could be installed to a separate
      <acronym class="acronym">UFS</acronym> <code class="filename">/usr/local</code> file
      system set at <code class="literal">biba/low</code>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74021560"></a>15.3.1. 標籤設定</h3></div></div></div><p xml:lang="en" lang="en">Virtually all aspects of label policy module configuration
	will be performed using the base system utilities.  These
	commands provide a simple interface for object or subject
	configuration or the manipulation and verification of
	the configuration.</p><p xml:lang="en" lang="en">All configuration may be done using
	<code class="command">setfmac</code>, which is used to set
	<acronym class="acronym">MAC</acronym> labels on system objects, and
	<code class="command">setpmac</code>, which is used to set the labels on
	system subjects.  For example, to set the
	<code class="literal">biba</code> <acronym class="acronym">MAC</acronym> label to
	<code class="literal">high</code> on <code class="filename">test</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>setfmac biba/high test</code></strong></pre><p xml:lang="en" lang="en">If the configuration is successful, the prompt will be
	returned without error.  A common error is
	<span class="errorname">Permission denied</span> which usually occurs
	when the label is being set or modified on a restricted
	object.  Other conditions may produce different failures.  For
	instance, the file may not be owned by the user attempting to
	relabel the object, the object may not exist, or the object
	may be read-only.  A mandatory policy will not allow the
	process to relabel the file, maybe because of a property of
	the file, a property of the process, or a property of the
	proposed new label value.  For example, if a user running at
	low integrity tries to change the label of a high integrity
	file, or a user running at low integrity tries to change the
	label of a low integrity file to a high integrity label, these
	operations will fail.</p><p xml:lang="en" lang="en">The system administrator may use
	<code class="command">setpmac</code> to override the policy module's
	settings by assigning a different label to the invoked
	process:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>setfmac biba/high test</code></strong>
<span class="errorname">Permission denied</span>
<code class="prompt">#</code> <strong class="userinput"><code>setpmac biba/low setfmac biba/high test</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>getfmac test</code></strong>
test: biba/high</pre><p xml:lang="en" lang="en">For currently running processes, such as
	<span class="application">sendmail</span>,
	<code class="command">getpmac</code> is usually used instead.  This
	command takes a process ID (<acronym class="acronym">PID</acronym>) in place
	of a command name.  If users attempt to manipulate a file not
	in their access, subject to the rules of the loaded policy
	modules, the <span class="errorname">Operation not permitted</span>
	error will be displayed.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74050360"></a>15.3.2. 預先定義的標籤</h3></div></div></div><p xml:lang="en" lang="en">A few FreeBSD policy modules which support the labeling
	feature offer three predefined labels: <code class="literal">low</code>,
	<code class="literal">equal</code>, and <code class="literal">high</code>,
	where:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">low</code> is considered the lowest label
	    setting an object or subject may have.  Setting this on
	    objects or subjects blocks their access to objects or
	    subjects marked high.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">equal</code> sets the subject or object to
	    be disabled or unaffected and should only be placed on
	    objects considered to be exempt from the policy.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">high</code> grants an object or subject
	    the highest setting available in the Biba and
	    <acronym class="acronym">MLS</acronym> policy modules.</p></li></ul></div><p xml:lang="en" lang="en">Such policy modules include <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_biba&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_biba</span>(4)</span></a>,
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_mls&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_mls</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_lomac&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_lomac</span>(4)</span></a>.  Each of the predefined
	labels establishes a different information flow directive.
	Refer to the manual page of the module to determine the traits
	of the generic label configurations.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74084408"></a>15.3.3. 數值標籤</h3></div></div></div><p xml:lang="en" lang="en">The Biba and <acronym class="acronym">MLS</acronym> policy modules support
	a numeric label which may be set to indicate the precise level
	of hierarchical control.  This numeric level is used to
	partition or sort information into different groups of
	classification, only permitting access to that group or a
	higher group level.  For example:</p><pre xml:lang="en" class="programlisting" lang="en">biba/10:2+3+6(5:2+3-20:2+3+4+5+6)</pre><p xml:lang="en" lang="en">may be interpreted as <span class="quote">“<span class="quote">Biba Policy Label/Grade
	  10:Compartments 2, 3 and 6: (grade 5 ...</span>”</span>)</p><p xml:lang="en" lang="en">In this example, the first grade would be considered the
	effective grade with effective compartments, the second grade
	is the low grade, and the last one is the high grade.  In most
	configurations, such fine-grained settings are not needed as
	they are considered to be advanced configurations.</p><p xml:lang="en" lang="en">System objects only have a current grade and compartment.
	System subjects reflect the range of available rights in the
	system, and network interfaces, where they are used for access
	control.</p><p xml:lang="en" lang="en">The grade and compartments in a subject and object pair
	are used to construct a relationship known as
	<em class="firstterm">dominance</em>, in which a subject dominates
	an object, the object dominates the subject, neither dominates
	the other, or both dominate each other.  The <span class="quote">“<span class="quote">both
	  dominate</span>”</span> case occurs when the two labels are equal.
	Due to the information flow nature of Biba, a user has rights
	to a set of compartments that might correspond to projects,
	but objects also have a set of compartments.  Users may have
	to subset their rights using <code class="command">su</code> or
	<code class="command">setpmac</code> in order to access objects in a
	compartment from which they are not restricted.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74090552"></a>15.3.4. 使用者標籤</h3></div></div></div><p xml:lang="en" lang="en">Users are required to have labels so that their files and
	processes properly interact with the security policy defined
	on the system.  This is configured in
	<code class="filename">/etc/login.conf</code> using login classes.
	Every policy module that uses labels will implement the user
	class setting.</p><p xml:lang="en" lang="en">To set the user class default label which will be enforced
	by <acronym class="acronym">MAC</acronym>, add a <code class="option">label</code> entry.
	An example <code class="option">label</code> entry containing every
	policy module is displayed below.  Note that in a real
	configuration, the administrator would never enable every
	policy module.  It is recommended that the rest of this
	chapter be reviewed before any configuration is
	implemented.</p><pre xml:lang="en" class="programlisting" lang="en">default:\
	:copyright=/etc/COPYRIGHT:\
	:welcome=/etc/motd:\
	:setenv=MAIL=/var/mail/$,BLOCKSIZE=K:\
	:path=~/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin:\
	:manpath=/usr/share/man /usr/local/man:\
	:nologin=/usr/sbin/nologin:\
	:cputime=1h30m:\
	:datasize=8M:\
	:vmemoryuse=100M:\
	:stacksize=2M:\
	:memorylocked=4M:\
	:memoryuse=8M:\
	:filesize=8M:\
	:coredumpsize=8M:\
	:openfiles=24:\
	:maxproc=32:\
	:priority=0:\
	:requirehome:\
	:passwordtime=91d:\
	:umask=022:\
	:ignoretime@:\
	:label=partition/13,mls/5,biba/10(5-15),lomac/10[2]:</pre><p xml:lang="en" lang="en">While users can not modify the default value, they may
	change their label after they login, subject to the
	constraints of the policy.  The example above tells the Biba
	policy that a process's minimum integrity is
	<code class="literal">5</code>, its maximum is <code class="literal">15</code>,
	and the default effective label is <code class="literal">10</code>.  The
	process will run at <code class="literal">10</code> until it chooses to
	change label, perhaps due to the user using
	<code class="command">setpmac</code>, which will be constrained by Biba
	to the configured range.</p><p xml:lang="en" lang="en">After any change to <code class="filename">login.conf</code>, the
	login class capability database must be rebuilt using
	<code class="command">cap_mkdb</code>.</p><p xml:lang="en" lang="en">Many sites have a large number of users requiring
	several different user classes.  In depth planning is
	required as this can become difficult to manage.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74110904"></a>15.3.5. 網路介面標籤</h3></div></div></div><p xml:lang="en" lang="en">Labels may be set on network interfaces to help control
	the flow of data across the network.  Policies using network
	interface labels function in the same way that policies
	function with respect to objects.  Users at high settings in
	Biba, for example, will not be permitted to access network
	interfaces with a label of <code class="literal">low</code>.</p><p xml:lang="en" lang="en">When setting the <acronym class="acronym">MAC</acronym> label on network
	interfaces, <code class="option">maclabel</code> may be passed to
	<code class="command">ifconfig</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bge0 maclabel biba/equal</code></strong></pre><p xml:lang="en" lang="en">This example will set the <acronym class="acronym">MAC</acronym> label of
	<code class="literal">biba/equal</code> on the <code class="literal">bge0</code>
	interface.  When using a setting similar to
	<code class="literal">biba/high(low-high)</code>, the entire label
	should be quoted to prevent an error from being
	returned.</p><p xml:lang="en" lang="en">Each policy module which supports labeling has a tunable
	which may be used to disable the <acronym class="acronym">MAC</acronym> label
	on network interfaces.  Setting the label to
	<code class="option">equal</code> will have a similar effect.  Review
	the output of <code class="command">sysctl</code>, the policy manual
	pages, and the information in the rest of this chapter for
	more information on those tunables.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-planning"></a>15.4. 規劃安全架構</h2></div></div></div><p xml:lang="en" lang="en">Before implementing any <acronym class="acronym">MAC</acronym> policies, a
      planning phase is recommended.  During the planning stages, an
      administrator should consider the implementation requirements
      and goals, such as:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">How to classify information and resources available on
	  the target systems.</p></li><li class="listitem"><p xml:lang="en" lang="en">Which information or resources to restrict access to
	  along with the type of restrictions that should be
	  applied.</p></li><li class="listitem"><p xml:lang="en" lang="en">Which <acronym class="acronym">MAC</acronym> modules will be required to
	  achieve this goal.</p></li></ul></div><p xml:lang="en" lang="en">A trial run of the trusted system and its configuration
      should occur <span class="emphasis"><em>before</em></span> a
      <acronym class="acronym">MAC</acronym> implementation is used on production
      systems.  Since different environments have different needs and
      requirements, establishing a complete security profile will
      decrease the need of changes once the system goes live.</p><p xml:lang="en" lang="en">Consider how the <acronym class="acronym">MAC</acronym> framework augments
      the security of the system as a whole.  The various security
      policy modules provided by the <acronym class="acronym">MAC</acronym> framework
      could be used to protect the network and file systems or to
      block users from accessing certain ports and sockets.  Perhaps
      the best use of the policy modules is to load several security
      policy modules at a time in order to provide a
      <acronym class="acronym">MLS</acronym> environment.  This approach differs from
      a hardening policy, which typically hardens elements of a system
      which are used only for specific purposes.  The downside to
      <acronym class="acronym">MLS</acronym> is increased administrative
      overhead.</p><p xml:lang="en" lang="en">The overhead is minimal when compared to the lasting effect
      of a framework which provides the ability to pick and choose
      which policies are required for a specific configuration and
      which keeps performance overhead down.  The reduction of support
      for unneeded policies can increase the overall performance of
      the system as well as offer flexibility of choice.  A good
      implementation would consider the overall security requirements
      and effectively implement the various security policy modules
      offered by the framework.</p><p xml:lang="en" lang="en">A system utilizing <acronym class="acronym">MAC</acronym> guarantees that a
      user will not be permitted to change security attributes at
      will.  All user utilities, programs, and scripts must work
      within the constraints of the access rules provided by the
      selected security policy modules and control of the
      <acronym class="acronym">MAC</acronym> access rules is in the hands of the
      system administrator.</p><p xml:lang="en" lang="en">It is the duty of the system administrator to carefully
      select the correct security policy modules.  For an environment
      that needs to limit access control over the network, the
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_portacl</span>(4)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_ifoff&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_ifoff</span>(4)</span></a>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_biba&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_biba</span>(4)</span></a>
      policy modules make good starting points.  For an environment
      where strict confidentiality of file system objects is required,
      consider the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_bsdextended&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_bsdextended</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_mls&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_mls</span>(4)</span></a> policy
      modules.</p><p xml:lang="en" lang="en">Policy decisions could be made based on network
      configuration.  If only certain users should be permitted
      access to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a>, the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_portacl</span>(4)</span></a> policy module is
      a good choice.  In the case of file systems, access to objects
      might be considered confidential to some users, but not to
      others.  As an example, a large development team might be
      broken off into smaller projects where  developers in project A
      might not be permitted to access objects written by developers
      in project B.  Yet both projects might need to access objects
      created by developers in project C.  Using the different
      security policy modules provided by the <acronym class="acronym">MAC</acronym>
      framework, users could be divided into these groups and then
      given access to the appropriate objects.</p><p xml:lang="en" lang="en">Each security policy module has a unique way of dealing with
      the overall security of a system.  Module selection should be
      based on a well thought out security policy which may require
      revision and reimplementation.  Understanding the different
      security policy modules offered by the <acronym class="acronym">MAC</acronym>
      framework will help administrators choose the best policies
      for their situations.</p><p xml:lang="en" lang="en">  The rest of this chapter covers the available modules,
      describes their use and configuration, and in some cases,
      provides insight on applicable situations.</p><div xmlns="" class="caution"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Implementing <acronym class="acronym">MAC</acronym> is much like
	implementing a firewall since care must be taken to prevent
	being completely locked out of the system.  The ability to
	revert back to a previous configuration should be considered
	and the implementation of <acronym class="acronym">MAC</acronym> over a remote
	connection should be done with extreme caution.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-policies"></a>15.5. 可用的 MAC 管理政策</h2></div></div></div><p xml:lang="en" lang="en">The default FreeBSD kernel
      includes <code class="literal">options MAC</code>.  This means that every
      module included with the <acronym class="acronym">MAC</acronym> framework can be
      loaded with <code class="command">kldload</code> as a run-time kernel
      module.  After testing the module, add the module name to
      <code class="filename">/boot/loader.conf</code> so that it will load
      during boot.  Each module also provides a kernel option for
      those administrators who choose to compile their own custom
      kernel.</p><p xml:lang="en" lang="en">FreeBSD includes a group of policies that will cover most
      security requirements.  Each policy is summarized below.  The
      last three policies support integer settings in place of the
      three default labels.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac-seeotheruids"></a>15.5.1. MAC See Other UIDs 政策</h3></div></div></div><a id="idp74148024" class="indexterm"></a><p xml:lang="en" lang="en">Module name:
	<code class="filename">mac_seeotheruids.ko</code></p><p xml:lang="en" lang="en">Kernel configuration line:
	<code class="literal">options MAC_SEEOTHERUIDS</code></p><p xml:lang="en" lang="en">Boot option:
	<code class="literal">mac_seeotheruids_load="YES"</code></p><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_seeotheruids&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_seeotheruids</span>(4)</span></a> module extends the
	<code class="varname">security.bsd.see_other_uids</code> and
	<code class="varname">security.bsd.see_other_gids</code>
	<code class="command">sysctl</code> tunables.  This option does not
	require any labels to be set before configuration and can
	operate transparently with other modules.</p><p xml:lang="en" lang="en">After loading the module, the following
	<code class="command">sysctl</code> tunables may be used to control its
	features:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.mac.seeotheruids.enabled</code>
	    enables the module and implements the default settings
	    which deny users the ability to view processes and sockets
	    owned by other users.</p></li><li class="listitem"><p xml:lang="en" lang="en">
	    <code class="varname">security.mac.seeotheruids.specificgid_enabled</code>
	    allows specified groups to be exempt from this policy.  To
	    exempt specific groups, use the
	    <code class="varname">security.mac.seeotheruids.specificgid=<em class="replaceable"><code>XXX</code></em></code>
	    <code class="command">sysctl</code> tunable, replacing
	    <em class="replaceable"><code>XXX</code></em> with the numeric group ID
	    to be exempted.</p></li><li class="listitem"><p xml:lang="en" lang="en">
	    <code class="varname">security.mac.seeotheruids.primarygroup_enabled</code>
	    is used to exempt specific primary groups from this
	    policy.  When using this tunable,
	    <code class="varname">security.mac.seeotheruids.specificgid_enabled</code>
	    may not be set.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac-bsdextended"></a>15.5.2. MAC BSD Extended 政策</h3></div></div></div><a id="idp74177720" class="indexterm"></a><p xml:lang="en" lang="en">Module name:
	<code class="filename">mac_bsdextended.ko</code></p><p xml:lang="en" lang="en">Kernel configuration line:
	<code class="literal">options MAC_BSDEXTENDED</code></p><p xml:lang="en" lang="en">Boot option:
	<code class="literal">mac_bsdextended_load="YES"</code></p><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_bsdextended&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_bsdextended</span>(4)</span></a> module enforces a file system
	firewall.  It provides an extension to the standard file
	system permissions model, permitting an administrator to
	create a firewall-like ruleset to protect files, utilities,
	and directories in the file system hierarchy.  When access to
	a file system object is attempted, the list of rules is
	iterated until either a matching rule is located or the end is
	reached.  This behavior may be changed using
	<code class="varname">security.mac.bsdextended.firstmatch_enabled</code>.
	Similar to other firewall modules in FreeBSD, a file containing
	the access control rules can be created and read by the system
	at boot time using an <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> variable.</p><p xml:lang="en" lang="en">The rule list may be entered using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ugidfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ugidfw</span>(8)</span></a> which
	has a syntax similar to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a>.  More tools can be
	written by using the functions in the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=libugidfw&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">libugidfw</span>(3)</span></a>
	library.</p><p xml:lang="en" lang="en">After the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_bsdextended&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_bsdextended</span>(4)</span></a> module has been loaded,
	the following command may be used to list the current rule
	configuration:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ugidfw list</code></strong>
0 slots, 0 rules</pre><p xml:lang="en" lang="en">By default, no rules are defined and everything is
	completely accessible.  To create a rule which blocks all
	access by users but leaves <code class="systemitem">root</code> unaffected:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ugidfw add subject not uid root new object not uid root mode n</code></strong></pre><p xml:lang="en" lang="en">While this rule is simple to implement, it is a very bad
	idea as it blocks all users from issuing any commands.  A
	more realistic example blocks <code class="systemitem">user1</code> all access, including
	directory listings, to <code class="systemitem"><em class="replaceable"><code>user2</code></em></code>'s
	home directory:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ugidfw set 2 subject uid <em class="replaceable"><code>user1</code></em> object uid <em class="replaceable"><code>user2</code></em> mode n</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ugidfw set 3 subject uid <em class="replaceable"><code>user1</code></em> object gid <em class="replaceable"><code>user2</code></em> mode n</code></strong></pre><p xml:lang="en" lang="en">Instead of <code class="systemitem">user1</code>, <code class="option">not
	  uid <em class="replaceable"><code>user2</code></em></code> could be used
	in order to enforce the same access restrictions for all
	users.  However, the <code class="systemitem">root</code> user is unaffected by
	these rules.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Extreme caution should be taken when working with this
	  module as incorrect use could block access to certain
	  parts of the file system.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac-ifoff"></a>15.5.3. MAC Interface Silencing 政策</h3></div></div></div><a id="idp74224568" class="indexterm"></a><p xml:lang="en" lang="en">Module name: <code class="filename">mac_ifoff.ko</code></p><p xml:lang="en" lang="en">Kernel configuration line: <code class="literal">options
	  MAC_IFOFF</code></p><p xml:lang="en" lang="en">Boot option:
	<code class="literal">mac_ifoff_load="YES"</code></p><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_ifoff&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_ifoff</span>(4)</span></a> module is used to disable network
	interfaces on the fly and to keep network interfaces from
	being brought up during system boot.  It does not use labels
	and does not depend on any other
	<acronym class="acronym">MAC</acronym> modules.</p><p xml:lang="en" lang="en">Most of this module's control is performed through these
	<code class="command">sysctl</code> tunables:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.mac.ifoff.lo_enabled</code>
	    enables or disables all traffic on the loopback,
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lo&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lo</span>(4)</span></a>, interface.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.mac.ifoff.bpfrecv_enabled</code>
	    enables or disables all traffic on the Berkeley Packet
	    Filter interface, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.mac.ifoff.other_enabled</code>
	    enables or disables traffic on all other
	    interfaces.</p></li></ul></div><p xml:lang="en" lang="en">One of the most common uses of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_ifoff&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_ifoff</span>(4)</span></a> is
	network monitoring in an environment where network traffic
	should not be permitted during the boot sequence.  Another
	use would be to write a script which uses an application such
	as <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/aide/pkg-descr">security/aide</a> to automatically block
	network traffic if it finds new or altered files in protected
	directories.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac-portacl"></a>15.5.4. MAC Port Access Control 政策</h3></div></div></div><a id="idp74242360" class="indexterm"></a><p xml:lang="en" lang="en">Module name: <code class="filename">mac_portacl.ko</code></p><p xml:lang="en" lang="en">Kernel configuration line:
	<code class="literal">MAC_PORTACL</code></p><p xml:lang="en" lang="en">Boot option:
	<code class="literal">mac_portacl_load="YES"</code></p><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_portacl</span>(4)</span></a> module is used to limit binding to
	local <acronym class="acronym">TCP</acronym> and <acronym class="acronym">UDP</acronym> ports,
	making it possible to allow non-<code class="systemitem">root</code> users to bind to
	specified privileged ports below 1024.</p><p xml:lang="en" lang="en">Once loaded, this module enables the
	<acronym class="acronym">MAC</acronym> policy on all sockets.  The following
	tunables are available:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.mac.portacl.enabled</code>
	    enables or disables the policy completely.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.mac.portacl.port_high</code>
	    sets the highest port number that <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_portacl</span>(4)</span></a>
	    protects.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.mac.portacl.suser_exempt</code>,
	    when set to a non-zero value, exempts the <code class="systemitem">root</code> user from this
	    policy.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.mac.portacl.rules</code>
	    specifies the policy as a text string of the form
	    <code class="literal">rule[,rule,...]</code>, with as many rules as
	    needed, and where each rule is of the form
	    <code class="literal">idtype:id:protocol:port</code>.  The
	    <em class="parameter"><code>idtype</code></em> is either
	    <code class="literal">uid</code> or <code class="literal">gid</code>.  The
	    <em class="parameter"><code>protocol</code></em> parameter can be
	    <code class="literal">tcp</code> or <code class="literal">udp</code>.  The
	    <em class="parameter"><code>port</code></em> parameter is the port number
	    to allow the specified user or group to bind to.  Only
	    numeric values can be used for the user ID, group ID,
	    and port parameters.</p></li></ul></div><p xml:lang="en" lang="en">By default, ports below 1024 can only be used by
	privileged processes which run as <code class="systemitem">root</code>.  For <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_portacl</span>(4)</span></a>
	to allow non-privileged processes to bind to ports below 1024,
	set the following tunables as
	follows:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysctl security.mac.portacl.port_high=1023</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl net.inet.ip.portrange.reservedlow=0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl net.inet.ip.portrange.reservedhigh=0</code></strong></pre><p xml:lang="en" lang="en">To prevent the <code class="systemitem">root</code> user from being affected
	by this policy, set
	<code class="varname">security.mac.portacl.suser_exempt</code> to a
	non-zero value.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysctl security.mac.portacl.suser_exempt=1</code></strong></pre><p xml:lang="en" lang="en">To allow the <code class="systemitem">www</code>
	user with <acronym class="acronym">UID</acronym> 80 to bind to port 80
	without ever needing <code class="systemitem">root</code> privilege:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysctl security.mac.portacl.rules=uid:80:tcp:80</code></strong></pre><p xml:lang="en" lang="en">This next example permits the user with the
	<acronym class="acronym">UID</acronym> of 1001 to bind to
	<acronym class="acronym">TCP</acronym> ports 110 (POP3) and 995
	(POP3s):</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysctl security.mac.portacl.rules=uid:1001:tcp:110,uid:1001:tcp:995</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac-partition"></a>15.5.5. MAC Partition 政策</h3></div></div></div><a id="idp74288056" class="indexterm"></a><p xml:lang="en" lang="en">Module name: <code class="filename">mac_partition.ko</code></p><p xml:lang="en" lang="en">Kernel configuration line:
	<code class="literal">options MAC_PARTITION</code></p><p xml:lang="en" lang="en">Boot option:
	<code class="literal">mac_partition_load="YES"</code></p><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_partition&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_partition</span>(4)</span></a> policy drops processes into
	specific <span class="quote">“<span class="quote">partitions</span>”</span> based on their
	<acronym class="acronym">MAC</acronym> label.  Most configuration for this
	policy is done using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=setpmac&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">setpmac</span>(8)</span></a>.  One
	<code class="command">sysctl</code> tunable is available for this
	policy:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.mac.partition.enabled</code>
	    enables the enforcement of <acronym class="acronym">MAC</acronym> process
	    partitions.</p></li></ul></div><p xml:lang="en" lang="en">When this policy is enabled, users will only be permitted
	to see their processes, and any others within their partition,
	but will not be permitted to work with utilities outside the
	scope of this partition.  For instance, a user in the
	<code class="literal">insecure</code> class will not be permitted to
	access <code class="command">top</code> as well as many other commands
	that must spawn a process.</p><p xml:lang="en" lang="en">This example adds <code class="command">top</code> to the label set
	on users in the <code class="literal">insecure</code> class.  All
	processes spawned by users in the <code class="literal">insecure</code>
	class will stay in the <code class="literal">partition/13</code>
	label.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>setpmac partition/13 top</code></strong></pre><p xml:lang="en" lang="en">This command displays the partition label and the process
	list:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ps Zax</code></strong></pre><p xml:lang="en" lang="en">This command displays another user's process partition
	label and that user's currently running processes:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ps -ZU trhodes</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Users can see processes in <code class="systemitem">root</code>'s label unless the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_seeotheruids&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_seeotheruids</span>(4)</span></a> policy is loaded.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac-mls"></a>15.5.6. MAC Multi-Level Security 模組</h3></div></div></div><a id="idp74323256" class="indexterm"></a><p xml:lang="en" lang="en">Module name: <code class="filename">mac_mls.ko</code></p><p xml:lang="en" lang="en">Kernel configuration line:
	<code class="literal">options MAC_MLS</code></p><p xml:lang="en" lang="en">Boot option: <code class="literal">mac_mls_load="YES"</code></p><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_mls&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_mls</span>(4)</span></a> policy controls access between
	subjects and objects in the system by enforcing a strict
	information flow policy.</p><p xml:lang="en" lang="en">In <acronym class="acronym">MLS</acronym> environments, a
	<span class="quote">“<span class="quote">clearance</span>”</span> level is set in the label of each
	subject or object, along with compartments.  Since these
	clearance levels can reach numbers greater than several
	thousand, it would be a daunting task to thoroughly configure
	every subject or object.  To ease this administrative
	overhead, three labels are included in this policy:
	<code class="literal">mls/low</code>, <code class="literal">mls/equal</code>, and
	<code class="literal">mls/high</code>, where:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Anything labeled with <code class="literal">mls/low</code> will
	    have a low clearance level and not be permitted to access
	    information of a higher level.  This label also prevents
	    objects of a higher clearance level from writing or
	    passing information to a lower level.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">mls/equal</code> should be placed on
	    objects which should be exempt from the policy.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">mls/high</code> is the highest level of
	    clearance possible.  Objects assigned this label will hold
	    dominance over all other objects in the system; however,
	    they will not permit the leaking of information to objects
	    of a lower class.</p></li></ul></div><p xml:lang="en" lang="en"><acronym class="acronym">MLS</acronym> provides:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">A hierarchical security level with a set of
	    non-hierarchical categories.</p></li><li class="listitem"><p xml:lang="en" lang="en">Fixed rules of <code class="literal">no read up, no write
	      down</code>.  This means that a subject can have read
	    access to objects on its own level or below, but not
	    above.  Similarly, a subject can have write access to
	    objects on its own level or above, but not beneath.</p></li><li class="listitem"><p xml:lang="en" lang="en">Secrecy, or the prevention of inappropriate disclosure
	    of data.</p></li><li class="listitem"><p xml:lang="en" lang="en">A basis for the design of systems that concurrently
	    handle data at multiple sensitivity levels without leaking
	    information between secret and confidential.</p></li></ul></div><p xml:lang="en" lang="en">The following <code class="command">sysctl</code> tunables are
	available:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.mac.mls.enabled</code> is used to
	    enable or disable the <acronym class="acronym">MLS</acronym>
	    policy.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.mac.mls.ptys_equal</code>
	    labels all <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pty&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pty</span>(4)</span></a> devices as
	    <code class="literal">mls/equal</code> during creation.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.mac.mls.revocation_enabled</code>
	    revokes access to objects after their label changes to a
	    label of a lower grade.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.mac.mls.max_compartments</code>
	    sets the maximum number of compartment levels allowed on a
	    system.</p></li></ul></div><p xml:lang="en" lang="en">To manipulate <acronym class="acronym">MLS</acronym> labels, use
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=setfmac&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">setfmac</span>(8)</span></a>.  To assign a label to an object:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>setfmac mls/5 test</code></strong></pre><p xml:lang="en" lang="en">To get the <acronym class="acronym">MLS</acronym> label for the file
	<code class="filename">test</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>getfmac test</code></strong></pre><p xml:lang="en" lang="en">Another approach is to create a master policy file in
	<code class="filename">/etc/</code> which specifies the
	<acronym class="acronym">MLS</acronym> policy information and to feed that
	file to <code class="command">setfmac</code>.</p><p xml:lang="en" lang="en">When using the <acronym class="acronym">MLS</acronym> policy module, an
	administrator plans to control the flow of sensitive
	information.  The default <code class="literal">block read up block write
	  down</code> sets everything to a low state.  Everything
	is accessible and an administrator slowly augments the
	confidentiality of the information.</p><p xml:lang="en" lang="en">Beyond the three basic label options, an administrator
	may group users and groups as required to block the
	information flow between them.  It might be easier to look at
	the information in clearance levels using descriptive words,
	such as classifications of <code class="literal">Confidential</code>,
	<code class="literal">Secret</code>, and <code class="literal">Top Secret</code>.
	Some administrators instead create different groups based on
	project levels.  Regardless of the classification method, a
	well thought out plan must exist before implementing a
	restrictive policy.</p><p xml:lang="en" lang="en">Some example situations for the <acronym class="acronym">MLS</acronym>
	policy module include an e-commerce web server, a file server
	holding critical company information, and financial
	institution environments.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac-biba"></a>15.5.7. MAC Biba 模組</h3></div></div></div><a id="idp74366392" class="indexterm"></a><p xml:lang="en" lang="en">Module name: <code class="filename">mac_biba.ko</code></p><p xml:lang="en" lang="en">Kernel configuration line: <code class="literal">options
	  MAC_BIBA</code></p><p xml:lang="en" lang="en">Boot option: <code class="literal">mac_biba_load="YES"</code></p><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_biba&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_biba</span>(4)</span></a> module loads the
	<acronym class="acronym">MAC</acronym> Biba policy.  This policy is similar to
	the <acronym class="acronym">MLS</acronym> policy with the exception that the
	rules for information flow are slightly reversed.  This is to
	prevent the downward flow of sensitive information whereas the
	<acronym class="acronym">MLS</acronym> policy prevents the upward flow of
	sensitive information.</p><p xml:lang="en" lang="en">In Biba environments, an <span class="quote">“<span class="quote">integrity</span>”</span> label is
	set on each subject or object.  These labels are made up of
	hierarchical grades and non-hierarchical components.  As a
	grade ascends, so does its integrity.</p><p xml:lang="en" lang="en">Supported labels are <code class="literal">biba/low</code>,
	<code class="literal">biba/equal</code>, and
	<code class="literal">biba/high</code>, where:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">biba/low</code> is considered the lowest
	    integrity an object or subject may have.  Setting this on
	    objects or subjects blocks their write access to objects
	    or subjects marked as <code class="literal">biba/high</code>, but
	    will not prevent read access.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">biba/equal</code> should only be placed on
	    objects considered to be exempt from the policy.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">biba/high</code> permits writing to
	    objects set at a lower label, but does not permit reading
	    that object.  It is recommended that this label be
	    placed on objects that affect the integrity of the entire
	    system.</p></li></ul></div><p xml:lang="en" lang="en">Biba provides:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Hierarchical integrity levels with a set of
	    non-hierarchical integrity categories.</p></li><li class="listitem"><p xml:lang="en" lang="en">Fixed rules are <code class="literal">no write up, no read
	      down</code>, the opposite of
	    <acronym class="acronym">MLS</acronym>.  A subject can have write access
	    to objects on its own level or below, but not above.
	    Similarly, a subject can have read access to objects on
	    its own level or above, but not below.</p></li><li class="listitem"><p xml:lang="en" lang="en">Integrity by preventing inappropriate modification of
	    data.</p></li><li class="listitem"><p xml:lang="en" lang="en">Integrity levels instead of <acronym class="acronym">MLS</acronym>
	    sensitivity levels.</p></li></ul></div><p xml:lang="en" lang="en">The following tunables can be used to manipulate the Biba
	policy:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.mac.biba.enabled</code> is used
	    to enable or disable enforcement of the Biba policy on the
	    target machine.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.mac.biba.ptys_equal</code> is
	    used to disable the Biba policy on <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pty&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pty</span>(4)</span></a>
	    devices.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="varname">security.mac.biba.revocation_enabled</code>
	    forces the revocation of access to objects if the label is
	    changed to dominate the subject.</p></li></ul></div><p xml:lang="en" lang="en">To access the Biba policy setting on system objects, use
	<code class="command">setfmac</code> and
	<code class="command">getfmac</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>setfmac biba/low test</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>getfmac test</code></strong>
test: biba/low</pre><p xml:lang="en" lang="en">Integrity, which is different from sensitivity, is used to
	guarantee that information is not manipulated by untrusted
	parties.  This includes information passed between subjects
	and objects.  It ensures that users will only be able to
	modify or access information they have been given explicit
	access to.  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_biba&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_biba</span>(4)</span></a> security policy module
	permits an administrator to configure which files and programs
	a user may see and invoke while assuring that the programs and
	files are trusted by the system for that user.</p><p xml:lang="en" lang="en">During the initial planning phase, an administrator must
	be prepared to partition users into grades, levels, and areas.
	The system will default to a high label once this policy
	module is enabled, and it is up to the administrator to
	configure the different grades and levels for users.  Instead
	of using clearance levels, a good planning method could
	include topics.  For instance, only allow developers
	modification access to the source code repository, source
	code compiler, and other development utilities.  Other users
	would be grouped into other categories such as testers,
	designers, or end users and would only be permitted read
	access.</p><p xml:lang="en" lang="en">A lower integrity subject is unable to write to a higher
	integrity subject and a higher integrity subject cannot list
	or read a lower integrity object.  Setting a label at the
	lowest possible grade could make it inaccessible to subjects.
	Some prospective environments for this security policy module
	would include a constrained web server, a development and test
	machine, and a source code repository.  A less useful
	implementation would be a personal workstation, a machine used
	as a router, or a network firewall.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac-lomac"></a>15.5.8. MAC Low-watermark 模組</h3></div></div></div><a id="idp74416440" class="indexterm"></a><p xml:lang="en" lang="en">Module name: <code class="filename">mac_lomac.ko</code></p><p xml:lang="en" lang="en">Kernel configuration line: <code class="literal">options
	  MAC_LOMAC</code></p><p xml:lang="en" lang="en">Boot option:
	<code class="literal">mac_lomac_load="YES"</code></p><p xml:lang="en" lang="en">Unlike the <acronym class="acronym">MAC</acronym> Biba policy, the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_lomac&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_lomac</span>(4)</span></a> policy permits access to lower integrity
	objects only after decreasing the integrity level to not
	disrupt any integrity rules.</p><p xml:lang="en" lang="en">The Low-watermark integrity policy works almost
	identically to Biba, with the exception of using floating
	labels to support subject demotion via an auxiliary grade
	compartment.  This secondary compartment takes the form
	<code class="literal">[auxgrade]</code>.  When assigning a policy with
	an auxiliary grade, use the syntax
	<code class="literal">lomac/10[2]</code>, where
	<code class="literal">2</code> is the auxiliary grade.</p><p xml:lang="en" lang="en">This policy relies on the ubiquitous labeling of all
	system objects with integrity labels, permitting subjects to
	read from low integrity objects and then downgrading the label
	on the subject to prevent future writes to high integrity
	objects using <code class="literal">[auxgrade]</code>.  The policy may
	provide greater compatibility and require less initial
	configuration than Biba.</p><p xml:lang="en" lang="en">Like the Biba and <acronym class="acronym">MLS</acronym> policies,
	<code class="command">setfmac</code> and <code class="command">setpmac</code>
	are used to place labels on system objects:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>setfmac /usr/home/trhodes lomac/high[low]</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>getfmac /usr/home/trhodes lomac/high[low]</code></strong></pre><p xml:lang="en" lang="en">The auxiliary grade <code class="literal">low</code> is a feature
	provided only by the <acronym class="acronym">MAC</acronym>
	<acronym class="acronym">LOMAC</acronym> policy.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-userlocked"></a>15.6. User Lock Down</h2></div></div></div><p xml:lang="en" lang="en">This example considers a relatively small storage system
      with fewer than fifty users.  Users will have login
      capabilities and are permitted to store data and access
      resources.</p><p xml:lang="en" lang="en">For this scenario, the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_bsdextended&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_bsdextended</span>(4)</span></a> and
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_seeotheruids&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_seeotheruids</span>(4)</span></a> policy modules could co-exist and block
      access to system objects while hiding user processes.</p><p xml:lang="en" lang="en">Begin by adding the following line to
      <code class="filename">/boot/loader.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">mac_seeotheruids_load="YES"</pre><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_bsdextended&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_bsdextended</span>(4)</span></a> security policy module may be
      activated by adding this line to
      <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">ugidfw_enable="YES"</pre><p xml:lang="en" lang="en">Default rules stored in
      <code class="filename">/etc/rc.bsdextended</code> will be loaded at
      system initialization.  However, the default entries may need
      modification.  Since this machine is expected only to service
      users, everything may be left commented out except the last
      two lines in order to force the loading of user owned system
      objects by default.</p><p xml:lang="en" lang="en">Add the required users to this machine and reboot.  For
      testing purposes, try logging in as a different user across
      two consoles.  Run <code class="command">ps aux</code> to see if processes
      of other users are visible.  Verify that running <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a> on
      another user's home directory fails.</p><p xml:lang="en" lang="en">Do not try to test with the <code class="systemitem">root</code> user unless the specific
      <code class="command">sysctl</code>s have been modified to block super
      user access.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">When a new user is added, their <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_bsdextended&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_bsdextended</span>(4)</span></a>
	rule will not be in the ruleset list.  To update the ruleset
	quickly, unload the security policy module and reload it again
	using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kldunload&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kldunload</span>(8)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-implementing"></a>15.7. 在 MAC Jail 中使用 Nagios</h2></div></div></div><a id="idp74067512" class="indexterm"></a><p xml:lang="en" lang="en">This section demonstrates the steps that are needed to
      implement the <span class="application">Nagios</span> network
      monitoring system in a <acronym class="acronym">MAC</acronym> environment.  This
      is meant as an example which still requires the administrator to
      test that the implemented policy meets the security requirements
      of the network before using in a production environment.</p><p xml:lang="en" lang="en">This example requires <code class="option">multilabel</code> to be set
      on each file system.  It also assumes that
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/nagios-plugins/pkg-descr">net-mgmt/nagios-plugins</a>,
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/nagios/pkg-descr">net-mgmt/nagios</a>, and
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/apache22/pkg-descr">www/apache22</a> are all installed, configured,
      and working correctly before attempting the integration into the
      <acronym class="acronym">MAC</acronym> framework.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74076216"></a>15.7.1. 建立不安全的使用者類別</h3></div></div></div><p xml:lang="en" lang="en">Begin the procedure by adding the following user class
	to <code class="filename">/etc/login.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">insecure:\
:copyright=/etc/COPYRIGHT:\
:welcome=/etc/motd:\
:setenv=MAIL=/var/mail/$,BLOCKSIZE=K:\
:path=~/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin
:manpath=/usr/share/man /usr/local/man:\
:nologin=/usr/sbin/nologin:\
:cputime=1h30m:\
:datasize=8M:\
:vmemoryuse=100M:\
:stacksize=2M:\
:memorylocked=4M:\
:memoryuse=8M:\
:filesize=8M:\
:coredumpsize=8M:\
:openfiles=24:\
:maxproc=32:\
:priority=0:\
:requirehome:\
:passwordtime=91d:\
:umask=022:\
:ignoretime@:\
:label=biba/10(10-10):</pre><p xml:lang="en" lang="en">Then, add the following line to the default user class
	section:</p><pre xml:lang="en" class="programlisting" lang="en">:label=biba/high:</pre><p xml:lang="en" lang="en">Save the edits and issue the following command to rebuild
	the database:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cap_mkdb /etc/login.conf</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74080952"></a>15.7.2. 設定使用者</h3></div></div></div><p xml:lang="en" lang="en">Set the <code class="systemitem">root</code>
	user to the default class using:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pw usermod root -L default</code></strong></pre><p xml:lang="en" lang="en">All user accounts that are not <code class="systemitem">root</code> will now require a login
	class.  The login class is required, otherwise users will be
	refused access to common commands.  The following
	<code class="command">sh</code> script should do the trick:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>for x in `awk -F: '($3 &gt;= 1001) &amp;&amp; ($3 != 65534) { print $1 }' \</code></strong>
	<strong class="userinput"><code>/etc/passwd`; do pw usermod $x -L default; done;</code></strong></pre><p xml:lang="en" lang="en">Next, drop the <code class="systemitem">nagios</code> and <code class="systemitem">www</code> accounts into the insecure
	class:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pw usermod nagios -L insecure</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>pw usermod www -L insecure</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74491320"></a>15.7.3. 建立關聯檔 (Context File)</h3></div></div></div><p xml:lang="en" lang="en">A contexts file should now be created as
	  <code class="filename">/etc/policy.contexts</code>:</p><pre xml:lang="en" class="programlisting" lang="en"># This is the default BIBA policy for this system.

# System:
/var/run(/.*)?			biba/equal

/dev/(/.*)?			biba/equal

/var				biba/equal
/var/spool(/.*)?		biba/equal

/var/log(/.*)?			biba/equal

/tmp(/.*)?			biba/equal
/var/tmp(/.*)?			biba/equal

/var/spool/mqueue		biba/equal
/var/spool/clientmqueue		biba/equal

# For Nagios:
/usr/local/etc/nagios(/.*)?	biba/10

/var/spool/nagios(/.*)?		biba/10

# For apache
/usr/local/etc/apache(/.*)?	biba/10</pre><p xml:lang="en" lang="en">This policy enforces security by setting restrictions on
	the flow of information.  In this specific configuration,
	users, including <code class="systemitem">root</code>, should never be
	allowed to access <span class="application">Nagios</span>.
	Configuration files and processes that are a part of
	<span class="application">Nagios</span> will be completely self
	contained or jailed.</p><p xml:lang="en" lang="en">This file will be read after running
	<code class="command">setfsmac</code> on every file system.  This
	example sets the policy on the root file system:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>setfsmac -ef /etc/policy.contexts /</code></strong></pre><p xml:lang="en" lang="en">Next, add these edits to the main section of
	<code class="filename">/etc/mac.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">default_labels file ?biba
default_labels ifnet ?biba
default_labels process ?biba
default_labels socket ?biba</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74498616"></a>15.7.4. 載入程式設定</h3></div></div></div><p xml:lang="en" lang="en">To finish the configuration, add the following lines to
	<code class="filename">/boot/loader.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">mac_biba_load="YES"
mac_seeotheruids_load="YES"
security.mac.biba.trust_all_interfaces=1</pre><p xml:lang="en" lang="en">And the following line to the network card configuration
	stored in <code class="filename">/etc/rc.conf</code>.  If the primary
	network configuration is done via <acronym class="acronym">DHCP</acronym>,
	this may need to be configured manually after every system
	boot:</p><pre xml:lang="en" class="programlisting" lang="en">maclabel biba/equal</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74502584"></a>15.7.5. 測試設定</h3></div></div></div><a id="idp74503224" class="indexterm"></a><p xml:lang="en" lang="en">First, ensure that the web server and
	<span class="application">Nagios</span> will not be started on
	system initialization and reboot.  Ensure that <code class="systemitem">root</code> cannot access any of the
	files in the <span class="application">Nagios</span> configuration
	directory.  If <code class="systemitem">root</code>
	can list the contents of
	<code class="filename">/var/spool/nagios</code>, something is wrong.
	Instead, a <span class="quote">“<span class="quote">permission denied</span>”</span> error should be
	returned.</p><p xml:lang="en" lang="en">If all seems well, <span class="application">Nagios</span>,
	<span class="application">Apache</span>, and
	<span class="application">Sendmail</span> can now be started:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /etc/mail &amp;&amp; make stop &amp;&amp; \
setpmac biba/equal make start &amp;&amp; setpmac biba/10\(10-10\) apachectl start &amp;&amp; \
setpmac biba/10\(10-10\) /usr/local/etc/rc.d/nagios.sh forcestart</code></strong></pre><p xml:lang="en" lang="en">Double check to ensure that everything is working
	properly.  If not, check the log files for error messages.  If
	needed, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> to disable the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_biba&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_biba</span>(4)</span></a>
	security policy module and try starting everything again as
	usual.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The <code class="systemitem">root</code> user
	  can still change the security enforcement and edit its
	  configuration files.  The following command will permit the
	  degradation of the security policy to a lower grade for a
	  newly spawned shell:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>setpmac biba/10 csh</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">To block this from happening, force the user into a
	  range using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">login.conf</span>(5)</span></a>.  If <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=setpmac&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">setpmac</span>(8)</span></a> attempts
	  to run a command outside of the compartment's range, an
	  error will be returned and the command will not be executed.
	  In this case, set root to
	  <code class="literal">biba/high(high-high)</code>.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-troubleshoot"></a>15.8. MAC 架構疑難排解</h2></div></div></div><a id="idp74542520" class="indexterm"></a><p xml:lang="en" lang="en">This section discusses common configuration errors and how
      to resolve them.</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en">The <code class="option">multilabel</code> flag does not stay
	  enabled on the root (<code class="filename">/</code>)
	  partition:</span></dt><dd><p xml:lang="en" lang="en">The following steps may resolve this transient
	    error:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">Edit <code class="filename">/etc/fstab</code> and set the
		root partition to <code class="option">ro</code> for
		read-only.</p></li><li class="step"><p xml:lang="en" lang="en">Reboot into single user mode.</p></li><li class="step"><p xml:lang="en" lang="en">Run <code class="command">tunefs</code> <code class="option">-l
		  enable</code> on <code class="filename">/</code>.</p></li><li class="step"><p xml:lang="en" lang="en">Reboot the system.</p></li><li class="step"><p xml:lang="en" lang="en">Run <code class="command">mount</code> <code class="option">-urw</code>
		<code class="filename">/</code> and change the
		<code class="option">ro</code> back to <code class="option">rw</code> in
		<code class="filename">/etc/fstab</code> and reboot the system
		again.</p></li><li class="step"><p xml:lang="en" lang="en">Double-check the output from
		<code class="command">mount</code> to ensure that
		<code class="option">multilabel</code> has been properly set on
		the root file system.</p></li></ol></div></dd><dt><span xml:lang="en" class="term" lang="en">After establishing a secure environment with
	  <acronym class="acronym">MAC</acronym>, <span class="application">Xorg</span> no
	  longer starts:</span></dt><dd><p xml:lang="en" lang="en">This could be caused by the <acronym class="acronym">MAC</acronym>
	    <code class="literal">partition</code> policy or by a mislabeling
	    in one of the <acronym class="acronym">MAC</acronym> labeling policies.
	    To debug, try the following:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">Check the error message.  If the user is in the
		<code class="literal">insecure</code> class, the
		<code class="literal">partition</code> policy may be the
		culprit.  Try setting the user's class back to the
		<code class="literal">default</code> class and rebuild the
		database with <code class="command">cap_mkdb</code>.  If this
		does not alleviate the problem, go to step two.</p></li><li class="step"><p xml:lang="en" lang="en">Double-check that the label policies are set
		correctly for the user,
		<span class="application">Xorg</span>, and the
		<code class="filename">/dev</code> entries.</p></li><li class="step"><p xml:lang="en" lang="en">If neither of these resolve the problem, send the
		error message and a description of the environment to
		the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions" target="_top">FreeBSD general questions mailing list</a>.</p></li></ol></div></dd><dt><span xml:lang="en" class="term" lang="en">The <span class="errorname">_secure_path: unable to stat
	    .login_conf</span> error appears:</span></dt><dd><p xml:lang="en" lang="en">This error can appear when a user attempts to switch
	    from the <code class="systemitem">root</code>
	    user to another user in the system.  This message
	    usually occurs when the user has a higher label setting
	    than that of the user they are attempting to become.
	    For instance, if <code class="systemitem">joe</code> has a default label
	    of <code class="option">biba/low</code> and <code class="systemitem">root</code> has a label of
	    <code class="option">biba/high</code>, <code class="systemitem">root</code> cannot view
	    <code class="systemitem">joe</code>'s home
	    directory.  This will happen whether or not <code class="systemitem">root</code> has used
	    <code class="command">su</code> to become <code class="systemitem">joe</code> as the Biba
	    integrity model will not permit <code class="systemitem">root</code> to view objects set
	    at a lower integrity level.</p></dd><dt><span xml:lang="en" class="term" lang="en">The system no longer recognizes <code class="systemitem">root</code>:</span></dt><dd><p xml:lang="en" lang="en">When this occurs, <code class="command">whoami</code> returns
	    <code class="literal">0</code> and <code class="command">su</code> returns
	    <span class="errorname">who are you?</span>.</p><p xml:lang="en" lang="en">This can happen if a labeling policy has been
	    disabled by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> or the policy module was
	    unloaded.  If the policy is disabled, the login
	    capabilities database needs to be reconfigured.  Double
	    check <code class="filename">/etc/login.conf</code> to ensure
	    that all <code class="option">label</code> options have been
	    removed and rebuild the database with
	    <code class="command">cap_mkdb</code>.</p><p xml:lang="en" lang="en">This may also happen if a policy restricts access to
	    <code class="filename">master.passwd</code>.  This is usually
	    caused by an administrator altering the file under a
	    label which conflicts with the general policy being used
	    by the system.  In these cases, the user information
	    would be read by the system and access would be blocked
	    as the file has inherited the new label.  Disable the
	    policy using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> and everything should return
	    to normal.</p></dd></dl></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="audit"></a>章 16. 安全事件稽查</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Robert</span> <span class="surname">Watson</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#audit-synopsis">16.1. 概述</a></span></dt><dt><span class="sect1"><a href="#audit-inline-glossary">16.2. 關鍵詞</a></span></dt><dt><span class="sect1"><a href="#audit-config">16.3. 稽查設定</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp74680632">16.3.1. 事件選擇表示法</a></span></dt><dt><span class="sect2"><a href="#idp74783416">16.3.2. 設定檔</a></span></dt><dd><dl><dt><span class="sect3"><a href="#audit-auditcontrol">16.3.2.1. The <code class="filename">audit_control</code> File</a></span></dt><dt><span class="sect3"><a href="#audit-audituser">16.3.2.2. The <code class="filename">audit_user</code> File</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#audit-administration">16.4. 查看稽查線索</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp74883128">16.4.1. 使用 Audit Pipes 即時監視</a></span></dt><dt><span class="sect2"><a href="#idp74908728">16.4.2. 翻轉與壓縮 Audit Trail 檔</a></span></dt></dl></dd></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="audit-synopsis"></a>16.1. 概述</h2></div></div></div><a id="idp74626488" class="indexterm"></a><a id="idp74627128" class="indexterm"></a><p xml:lang="en" lang="en">The FreeBSD operating system includes support for security
      event auditing.  Event auditing supports reliable, fine-grained,
      and configurable logging of a variety of security-relevant
      system events, including logins, configuration changes, and file
      and network access.  These log records can be invaluable for
      live system monitoring, intrusion detection, and postmortem
      analysis.  FreeBSD implements <span class="trademark">Sun</span>™'s published Basic Security
      Module (<acronym class="acronym">BSM</acronym>) Application Programming
      Interface (<acronym class="acronym">API</acronym>) and file format, and is
      interoperable with the <span class="trademark">Solaris</span>™ and <span class="trademark">Mac OS</span>® X audit
      implementations.</p><p xml:lang="en" lang="en">This chapter focuses on the installation and configuration
      of event auditing.  It explains audit policies and provides an
      example audit configuration.</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">What event auditing is and how it works.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to configure event auditing on FreeBSD for users and
	  processes.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to review the audit trail using the audit reduction
	  and review tools.</p></li></ul></div><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>了解 <span class="trademark">UNIX</span>® 及 FreeBSD 基礎 (<a class="xref" href="#basics" title="章 3. FreeBSD 基礎">章 3, <em>FreeBSD 基礎</em></a>)。</p></li><li class="listitem"><p xml:lang="en" lang="en">Be familiar with the basics of kernel
	  configuration/compilation (<a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a>).</p></li><li class="listitem"><p xml:lang="en" lang="en">Have some familiarity with security and how it pertains
	  to FreeBSD (<a class="xref" href="#security" title="章 13. 安全性">章 13, <em>安全性</em></a>).</p></li></ul></div><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The audit facility has some known limitations.  Not all
	security-relevant system events are auditable and some login
	mechanisms, such as <span class="application">Xorg</span>-based
	display managers and third-party daemons, do not properly
	configure auditing for user login sessions.</p><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The security event auditing facility is able to generate
	very detailed logs of system activity.  On a busy system,
	trail file data can be very large when configured for high
	detail, exceeding gigabytes a week in some configurations.
	Administrators should take into account the disk space
	requirements associated with high volume audit configurations.
	For example, it may be desirable to dedicate a file system to
	<code class="filename">/var/audit</code> so that other file systems are
	not affected if the audit file system becomes full.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="audit-inline-glossary"></a>16.2. 關鍵詞</h2></div></div></div><p xml:lang="en" lang="en">The following terms are related to security event
      auditing:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>event</em></span>: an auditable event is any
	  event that can be logged using the audit subsystem.
	  Examples of security-relevant events include the creation of
	  a file, the building of a network connection, or a user
	  logging in.  Events are either <span class="quote">“<span class="quote">attributable</span>”</span>,
	  meaning that they can be traced to an authenticated user, or
	  <span class="quote">“<span class="quote">non-attributable</span>”</span>.  Examples of
	  non-attributable events are any events that occur before
	  authentication in the login process, such as bad password
	  attempts.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>class</em></span>: a named set of related
	  events which are used in selection expressions.  Commonly
	  used classes of events include <span class="quote">“<span class="quote">file creation</span>”</span>
	  (fc), <span class="quote">“<span class="quote">exec</span>”</span> (ex), and
	  <span class="quote">“<span class="quote">login_logout</span>”</span> (lo).</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>record</em></span>: an audit log entry
	  describing a security event.  Records contain a record
	  event type, information on the subject (user) performing the
	  action, date and time information, information on any
	  objects or arguments, and a success or failure
	  condition.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>trail</em></span>: a log file consisting of a
	  series of audit records describing security events.  Trails
	  are in roughly chronological order with respect to the time
	  events completed.  Only authorized processes are allowed to
	  commit records to the audit trail.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>selection expression</em></span>: a string
	  containing a list of prefixes and audit event class names
	  used to match events.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>preselection</em></span>: the process by which
	  the system identifies which events are of interest to the
	  administrator.  The preselection configuration uses a series
	  of selection expressions to identify which classes of events
	  to audit for which users, as well as global settings that
	  apply to both authenticated and unauthenticated
	  processes.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>reduction</em></span>: the process by which
	  records from existing audit trails are selected for
	  preservation, printing, or analysis.  Likewise, the process
	  by which undesired audit records are removed from the audit
	  trail.  Using reduction, administrators can implement
	  policies for the preservation of audit data.  For example,
	  detailed audit trails might be kept for one month, but after
	  that, trails might be reduced in order to preserve only
	  login information for archival purposes.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="audit-config"></a>16.3. 稽查設定</h2></div></div></div><p xml:lang="en" lang="en">User space support for event auditing is installed as part
      of the base FreeBSD operating system.  Kernel support is available
      in the <code class="filename">GENERIC</code> kernel by default,
      and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=auditd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">auditd</span>(8)</span></a> can be enabled
      by adding the following line to
      <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">auditd_enable="YES"</pre><p xml:lang="en" lang="en">Then, start the audit daemon:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service auditd start</code></strong></pre><p xml:lang="en" lang="en">Users who prefer to compile a custom kernel must include the
      following line in their custom kernel configuration file:</p><pre xml:lang="en" class="programlisting" lang="en">options	AUDIT</pre><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74680632"></a>16.3.1. 事件選擇表示法</h3></div></div></div><p xml:lang="en" lang="en">Selection expressions are used in a number of places in
	the audit configuration to determine which events should be
	audited.  Expressions contain a list of event classes to
	match.  Selection expressions are evaluated from left to
	right, and two expressions are combined by appending one onto
	the other.</p><p xml:lang="en" lang="en"><a class="xref" href="#event-selection" title="表格 16.1. 預設稽查事件類別">表格 16.1, “預設稽查事件類別”</a> summarizes the default
	audit event classes:</p><div class="table"><a id="event-selection"></a><div class="table-title">表格 16.1. 預設稽查事件類別</div><div class="table-contents"><table summary="預設稽查事件類別" width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>類別名稱</th><th>說明</th><th>動作</th></tr></thead><tbody><tr><td xml:lang="en" lang="en">all</td><td xml:lang="en" lang="en">all</td><td xml:lang="en" lang="en">Match all event classes.</td></tr><tr><td xml:lang="en" lang="en">aa</td><td xml:lang="en" lang="en">authentication and authorization</td><td> </td></tr><tr><td xml:lang="en" lang="en">ad</td><td xml:lang="en" lang="en">administrative</td><td xml:lang="en" lang="en">Administrative actions performed on the system as
		a whole.</td></tr><tr><td xml:lang="en" lang="en">ap</td><td xml:lang="en" lang="en">application</td><td xml:lang="en" lang="en">Application defined action.</td></tr><tr><td xml:lang="en" lang="en">cl</td><td xml:lang="en" lang="en">file close</td><td xml:lang="en" lang="en">Audit calls to the
		<code class="function">close</code> system call.</td></tr><tr><td xml:lang="en" lang="en">ex</td><td xml:lang="en" lang="en">exec</td><td xml:lang="en" lang="en">Audit program execution.  Auditing of command
		line arguments and environmental variables is
		controlled via <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=audit_control&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">audit_control</span>(5)</span></a> using the
		<code class="literal">argv</code> and <code class="literal">envv</code>
		parameters to the <code class="literal">policy</code>
		setting.</td></tr><tr><td xml:lang="en" lang="en">fa</td><td xml:lang="en" lang="en">file attribute access</td><td xml:lang="en" lang="en">Audit the access of object attributes such as
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=stat&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">stat</span>(1)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pathconf&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pathconf</span>(2)</span></a>.</td></tr><tr><td xml:lang="en" lang="en">fc</td><td xml:lang="en" lang="en">file create</td><td xml:lang="en" lang="en">Audit events where a file is created as a
		result.</td></tr><tr><td xml:lang="en" lang="en">fd</td><td xml:lang="en" lang="en">file delete</td><td xml:lang="en" lang="en">Audit events where file deletion occurs.</td></tr><tr><td xml:lang="en" lang="en">fm</td><td xml:lang="en" lang="en">file attribute modify</td><td xml:lang="en" lang="en">Audit events  where file attribute modification
		occurs, such as by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chown&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chown</span>(8)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chflags</span>(1)</span></a>, and
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=flock&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">flock</span>(2)</span></a>.</td></tr><tr><td xml:lang="en" lang="en">fr</td><td xml:lang="en" lang="en">file read</td><td xml:lang="en" lang="en">Audit events in which data is read or files are
		opened for reading.</td></tr><tr><td xml:lang="en" lang="en">fw</td><td xml:lang="en" lang="en">file write</td><td xml:lang="en" lang="en">Audit events in which data is written or files
		are written or modified.</td></tr><tr><td xml:lang="en" lang="en">io</td><td xml:lang="en" lang="en">ioctl</td><td xml:lang="en" lang="en">Audit use of the <code class="function">ioctl</code>
		system call.</td></tr><tr><td xml:lang="en" lang="en">ip</td><td xml:lang="en" lang="en">ipc</td><td xml:lang="en" lang="en">Audit various forms of Inter-Process
		Communication, including POSIX pipes and System V
		<acronym class="acronym">IPC</acronym> operations.</td></tr><tr><td xml:lang="en" lang="en">lo</td><td xml:lang="en" lang="en">login_logout</td><td xml:lang="en" lang="en">Audit <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=login&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">login</span>(1)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=logout&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">logout</span>(1)</span></a>
		events.</td></tr><tr><td xml:lang="en" lang="en">na</td><td xml:lang="en" lang="en">non attributable</td><td xml:lang="en" lang="en">Audit non-attributable events.</td></tr><tr><td xml:lang="en" lang="en">no</td><td xml:lang="en" lang="en">invalid class</td><td xml:lang="en" lang="en">Match no audit events.</td></tr><tr><td xml:lang="en" lang="en">nt</td><td xml:lang="en" lang="en">network</td><td xml:lang="en" lang="en">Audit events related to network actions such as
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=connect&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">connect</span>(2)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=accept&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">accept</span>(2)</span></a>.</td></tr><tr><td xml:lang="en" lang="en">ot</td><td xml:lang="en" lang="en">other</td><td xml:lang="en" lang="en">Audit miscellaneous events.</td></tr><tr><td xml:lang="en" lang="en">pc</td><td xml:lang="en" lang="en">process</td><td xml:lang="en" lang="en">Audit process operations such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=exec&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">exec</span>(3)</span></a> and
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=exit&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">exit</span>(3)</span></a>.</td></tr></tbody></table></div></div><br class="table-break" /><p xml:lang="en" lang="en">These audit event classes may be customized by modifying
	the <code class="filename">audit_class</code> and
	<code class="filename">audit_event</code> configuration files.</p><p xml:lang="en" lang="en">Each audit event class may be combined with a prefix
	indicating whether successful/failed operations are matched,
	and whether the entry is adding or removing matching for the
	class and type.  <a class="xref" href="#event-prefixes" title="表格 16.2. 稽查事件類別字首">表格 16.2, “稽查事件類別字首”</a> summarizes
	the available prefixes:</p><div class="table"><a id="event-prefixes"></a><div class="table-title">表格 16.2. 稽查事件類別字首</div><div class="table-contents"><table summary="稽查事件類別字首" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>字首</th><th>動作</th></tr></thead><tbody><tr><td xml:lang="en" lang="en">+</td><td xml:lang="en" lang="en">Audit successful events in this class.</td></tr><tr><td xml:lang="en" lang="en">-</td><td xml:lang="en" lang="en">Audit failed events in this class.</td></tr><tr><td xml:lang="en" lang="en">^</td><td xml:lang="en" lang="en">Audit neither successful nor failed events in
		this class.</td></tr><tr><td xml:lang="en" lang="en">^+</td><td xml:lang="en" lang="en">Do not audit successful events in this
		class.</td></tr><tr><td xml:lang="en" lang="en">^-</td><td xml:lang="en" lang="en">Do not audit failed events in this class.</td></tr></tbody></table></div></div><br class="table-break" /><p xml:lang="en" lang="en">If no prefix is present, both successful and failed
	instances of the event will be audited.</p><p xml:lang="en" lang="en">The following example selection string selects both
	successful and failed login/logout events, but only successful
	execution events:</p><pre xml:lang="en" class="programlisting" lang="en">lo,+ex</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74783416"></a>16.3.2. 設定檔</h3></div></div></div><p xml:lang="en" lang="en">The following configuration files for security event
	auditing are found in
	<code class="filename">/etc/security</code>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><code class="filename">audit_class</code>: contains the
	    definitions of the audit classes.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="filename">audit_control</code>: controls aspects
	    of the audit subsystem, such as default audit classes,
	    minimum disk space to leave on the audit log volume, and
	    maximum audit trail size.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="filename">audit_event</code>: textual names and
	    descriptions of system audit events and a list of which
	    classes each event is in.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="filename">audit_user</code>: user-specific audit
	    requirements to be combined with the global defaults at
	    login.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="filename">audit_warn</code>: a customizable shell
	    script used by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=auditd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">auditd</span>(8)</span></a> to generate warning messages
	    in exceptional situations, such as when space for audit
	    records is running low or when the audit trail file has
	    been rotated.</p></li></ul></div><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Audit configuration files should be edited and
	  maintained carefully, as errors in configuration may result
	  in improper logging of events.</p></div><p xml:lang="en" lang="en">In most cases, administrators will only need to modify
	<code class="filename">audit_control</code> and
	<code class="filename">audit_user</code>.  The first file controls
	system-wide audit properties and policies and the second file
	may be used to fine-tune auditing by user.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="audit-auditcontrol"></a>16.3.2.1. The <code class="filename">audit_control</code> File</h4></div></div></div><p xml:lang="en" lang="en">A number of defaults for the audit subsystem are
	  specified in <code class="filename">audit_control</code>:</p><pre xml:lang="en" class="programlisting" lang="en">dir:/var/audit
dist:off
flags:lo,aa
minfree:5
naflags:lo,aa
policy:cnt,argv
filesz:2M
expire-after:10M</pre><p xml:lang="en" lang="en">The <code class="option">dir</code> entry is used to set one or
	  more directories where audit logs will be stored.  If more
	  than one directory entry appears, they will be used in order
	  as they fill.  It is common to configure audit so that audit
	  logs are stored on a dedicated file system, in order to
	  prevent interference between the audit subsystem and other
	  subsystems if the file system fills.</p><p xml:lang="en" lang="en">If the <code class="option">dist</code> field is set to
	  <code class="literal">on</code> or <code class="literal">yes</code>, hard links
	  will be created to all trail files in
	  <code class="filename">/var/audit/dist</code>.</p><p xml:lang="en" lang="en">The <code class="option">flags</code> field sets the system-wide
	  default preselection mask for attributable events.  In the
	  example above, successful and failed login/logout events as
	  well as authentication and authorization are audited for all
	  users.</p><p xml:lang="en" lang="en">The <code class="option">minfree</code> entry defines the minimum
	  percentage of free space for the file system where the audit
	  trail is stored.</p><p xml:lang="en" lang="en">The <code class="option">naflags</code> entry specifies audit
	  classes to be audited for non-attributed events, such as the
	  login/logout process and authentication and
	  authorization.</p><p xml:lang="en" lang="en">The <code class="option">policy</code> entry specifies a
	  comma-separated list of policy flags controlling various
	  aspects of audit behavior.  The <code class="literal">cnt</code>
	  indicates that the system should continue running despite an
	  auditing failure (this flag is highly recommended).  The
	  other flag, <code class="literal">argv</code>, causes command line
	  arguments to the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=execve&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a> system call to be audited as
	  part of command execution.</p><p xml:lang="en" lang="en">The <code class="option">filesz</code> entry specifies the maximum
	  size for an audit trail before automatically terminating and
	  rotating the trail file.  A value of <code class="literal">0</code>
	  disables automatic log rotation.  If the requested file size
	  is below the minimum of 512k, it will be ignored and a log
	  message will be generated.</p><p xml:lang="en" lang="en">The <code class="option">expire-after</code> field specifies when
	  audit log files will expire and be removed.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="audit-audituser"></a>16.3.2.2. The <code class="filename">audit_user</code> File</h4></div></div></div><p xml:lang="en" lang="en">The administrator can specify further audit requirements
	  for specific users in <code class="filename">audit_user</code>.
	  Each line configures auditing for a user via two fields:
	  the <code class="literal">alwaysaudit</code> field specifies a set of
	  events that should always be audited for the user, and the
	  <code class="literal">neveraudit</code> field specifies a set of
	  events that should never be audited for the user.</p><p xml:lang="en" lang="en">The following example entries audit login/logout events
	  and successful command execution for <code class="systemitem">root</code> and file creation and
	  successful command execution for <code class="systemitem">www</code>.  If used with the
	  default <code class="filename">audit_control</code>, the
	  <code class="literal">lo</code> entry for <code class="systemitem">root</code> is redundant, and
	  login/logout events will also be audited for <code class="systemitem">www</code>.</p><pre xml:lang="en" class="programlisting" lang="en">root:lo,+ex:no
www:fc,+ex:no</pre></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="audit-administration"></a>16.4. 查看稽查線索</h2></div></div></div><p xml:lang="en" lang="en">Since audit trails are stored in the <acronym class="acronym">BSM</acronym>
      binary format, several built-in tools are available to modify or
      convert these trails to text.  To convert trail files to a
      simple text format, use <code class="command">praudit</code>.  To reduce
      the audit trail file for analysis, archiving, or printing
      purposes, use <code class="command">auditreduce</code>.  This utility
      supports a variety of selection parameters, including event
      type, event class, user, date or time of the event, and the file
      path or object acted on.</p><p xml:lang="en" lang="en">For example, to dump the entire contents of a specified
      audit log in plain text:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>praudit /var/audit/<em class="replaceable"><code>AUDITFILE</code></em></code></strong></pre><p xml:lang="en" lang="en">Where <em class="replaceable"><code>AUDITFILE</code></em> is the audit log
      to dump.</p><p xml:lang="en" lang="en">Audit trails consist of a series of audit records made up of
      tokens, which <code class="command">praudit</code> prints sequentially,
      one per line.  Each token is of a specific type, such as
      <code class="literal">header</code> (an audit record header) or
      <code class="literal">path</code> (a file path from a name lookup).  The
      following is an example of an
      <code class="literal">execve</code> event:</p><pre xml:lang="en" class="programlisting" lang="en">header,133,10,execve(2),0,Mon Sep 25 15:58:03 2006, + 384 msec
exec arg,finger,doug
path,/usr/bin/finger
attribute,555,root,wheel,90,24918,104944
subject,robert,root,wheel,root,wheel,38439,38032,42086,128.232.9.100
return,success,0
trailer,133</pre><p xml:lang="en" lang="en">This audit represents a successful
      <code class="literal">execve</code> call, in which the command
      <code class="literal">finger doug</code> has been run.  The
      <code class="literal">exec arg</code> token contains the processed command
      line presented by the shell to the kernel.  The
      <code class="literal">path</code> token holds the path to the executable
      as looked up by the kernel.  The <code class="literal">attribute</code>
      token describes the binary and includes the file mode.  The
      <code class="literal">subject</code> token stores the audit user ID,
      effective user ID and group ID, real user ID and group ID,
      process ID, session ID, port ID, and login address.  Notice that
      the audit user ID and real user ID differ as the user
      <code class="systemitem">robert</code> switched to the
      <code class="systemitem">root</code> account before
      running this command, but it is audited using the original
      authenticated user.  The <code class="literal">return</code> token
      indicates the successful execution and the
      <code class="literal">trailer</code> concludes the record.</p><p xml:lang="en" lang="en"><acronym class="acronym">XML</acronym> output format is also supported and
      can be selected by including <code class="option">-x</code>.</p><p xml:lang="en" lang="en">Since audit logs may be very large, a subset of records can
      be selected using <code class="command">auditreduce</code>.  This example
      selects all audit records produced for the user
      <code class="systemitem">trhodes</code> stored in
      <code class="filename">AUDITFILE</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>auditreduce -u <em class="replaceable"><code>trhodes</code></em> /var/audit/<em class="replaceable"><code>AUDITFILE</code></em> | praudit</code></strong></pre><p xml:lang="en" lang="en">Members of the <code class="systemitem">audit</code> group have permission to
      read audit trails in <code class="filename">/var/audit</code>.  By
      default, this group is empty, so only the <code class="systemitem">root</code> user can read audit trails.
      Users may be added to the <code class="systemitem">audit</code> group in order to
      delegate audit review rights.  As the ability to track audit log
      contents provides significant insight into the behavior of users
      and processes, it is recommended that the delegation of audit
      review rights be performed with caution.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74883128"></a>16.4.1. 使用 Audit Pipes 即時監視</h3></div></div></div><p xml:lang="en" lang="en">Audit pipes are cloning pseudo-devices which allow
	applications to tap the live audit record stream.  This is
	primarily of interest to authors of intrusion detection and
	system monitoring applications.  However, the audit pipe
	device is a convenient way for the administrator to allow live
	monitoring without running into problems with audit trail file
	ownership or log rotation interrupting the event stream.  To
	track the live audit event stream:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>praudit /dev/auditpipe</code></strong></pre><p xml:lang="en" lang="en">By default, audit pipe device nodes are accessible only to
	the <code class="systemitem">root</code> user.  To
	make them accessible to the members of the <code class="systemitem">audit</code> group, add a
	<code class="literal">devfs</code> rule to
	<code class="filename">/etc/devfs.rules</code>:</p><pre xml:lang="en" class="programlisting" lang="en">add path 'auditpipe*' mode 0440 group audit</pre><p xml:lang="en" lang="en">See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs.rules&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs.rules</span>(5)</span></a> for more information on
	configuring the devfs file system.</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">It is easy to produce audit event feedback cycles, in
	  which the viewing of each audit event results in the
	  generation of more audit events.  For example, if all
	  network <acronym class="acronym">I/O</acronym> is audited, and
	  <code class="command">praudit</code> is run from an
	  <acronym class="acronym">SSH</acronym> session, a continuous stream of audit
	  events will be generated at a high rate, as each event being
	  printed will generate another event.  For this reason, it is
	  advisable to run <code class="command">praudit</code> on an audit pipe
	  device from sessions without fine-grained
	  <acronym class="acronym">I/O</acronym> auditing.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74908728"></a>16.4.2. 翻轉與壓縮 Audit Trail 檔</h3></div></div></div><p xml:lang="en" lang="en">Audit trails are written to by the kernel and
	managed by the audit daemon, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=auditd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">auditd</span>(8)</span></a>.
	Administrators should not attempt to use
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=newsyslog.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">newsyslog.conf</span>(5)</span></a> or other tools to directly rotate
	audit logs.  Instead, <code class="command">audit</code> should
	be used to shut down auditing, reconfigure the audit system,
	and perform log rotation.  The following command causes the
	audit daemon to create a new audit log and signal the kernel
	to switch to using the new log.  The old log will be
	terminated and renamed, at which point it may then be
	manipulated by the administrator:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>audit -n</code></strong></pre><p xml:lang="en" lang="en">If <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=auditd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">auditd</span>(8)</span></a> is not currently running, this command
	will fail and an error message will be produced.</p><p xml:lang="en" lang="en">Adding the following line to
	<code class="filename">/etc/crontab</code> will schedule this rotation
	every twelve hours:</p><pre xml:lang="en" class="programlisting" lang="en">0     */12       *       *       *       root    /usr/sbin/audit -n</pre><p xml:lang="en" lang="en">The change will take effect once
	<code class="filename">/etc/crontab</code> is saved.</p><p xml:lang="en" lang="en">Automatic rotation of the audit trail file based on file
	size is possible using <code class="option">filesz</code> in
	<code class="filename">audit_control</code> as described in <a class="xref" href="#audit-auditcontrol" title="16.3.2.1. The audit_control File">節 16.3.2.1, “The <code class="filename">audit_control</code> File”</a>.</p><p xml:lang="en" lang="en">As audit trail files can become very large, it is often
	desirable to compress or otherwise archive trails once they
	have been closed by the audit daemon.  The
	<code class="filename">audit_warn</code> script can be used to perform
	customized operations for a variety of audit-related events,
	including the clean termination of audit trails when they are
	rotated.  For example, the following may be added to
	<code class="filename">/etc/security/audit_warn</code> to compress
	audit trails on close:</p><pre xml:lang="en" class="programlisting" lang="en">#
# Compress audit trail files on close.
#
if [ "$1" = closefile ]; then
        gzip -9 $2
fi</pre><p xml:lang="en" lang="en">Other archiving activities might include copying trail
	files to a centralized server, deleting old trail files, or
	reducing the audit trail to remove unneeded records.  This
	script will be run only when audit trail files are cleanly
	terminated, so will not be run on trails left unterminated
	following an improper shutdown.</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks"></a>章 17. 儲存設備</h2></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#disks-synopsis">17.1. 概述</a></span></dt><dt><span class="sect1"><a href="#disks-adding">17.2. 加入磁碟</a></span></dt><dt><span class="sect1"><a href="#disks-growing">17.3. 重設大小與擴增磁碟</a></span></dt><dt><span class="sect1"><a href="#usb-disks">17.4. <acronym class="acronym">USB</acronym> 儲存裝置</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp75067192">17.4.1. 裝置設定</a></span></dt><dt><span class="sect2"><a href="#idp75186232">17.4.2. 自動掛載可移除的媒體</a></span></dt></dl></dd><dt><span class="sect1"><a href="#creating-cds">17.5. 建立與使用 <acronym class="acronym">CD</acronym> 媒體</a></span></dt><dd><dl><dt><span class="sect2"><a href="#atapicam">17.5.1. 支援的裝置</a></span></dt><dt><span class="sect2"><a href="#cdrecord">17.5.2. 燒錄 <acronym class="acronym">CD</acronym></a></span></dt><dt><span class="sect2"><a href="#mkisofs">17.5.3. 寫入資料到一個 <acronym class="acronym">ISO</acronym> 檔案系統</a></span></dt><dt><span class="sect2"><a href="#mounting-cd">17.5.4. 使用資料 <acronym class="acronym">CD</acronym></a></span></dt><dt><span class="sect2"><a href="#duplicating-audiocds">17.5.5. 複製音樂 <acronym class="acronym">CD</acronym></a></span></dt></dl></dd><dt><span class="sect1"><a href="#creating-dvds">17.6. 建立與使用 <acronym class="acronym">DVD</acronym> 媒體</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp75436856">17.6.1. 設定</a></span></dt><dt><span class="sect2"><a href="#idp75468600">17.6.2. 燒錄資料 <acronym class="acronym">DVD</acronym></a></span></dt><dt><span class="sect2"><a href="#idp75514168">17.6.3. 燒錄 <acronym class="acronym">DVD</acronym>-Video</a></span></dt><dt><span class="sect2"><a href="#idp75524408">17.6.4. 使用 <acronym class="acronym">DVD+RW</acronym></a></span></dt><dt><span class="sect2"><a href="#idp75561784">17.6.5. 使用 <acronym class="acronym">DVD-RW</acronym></a></span></dt><dt><span class="sect2"><a href="#idp75611832">17.6.6. 多階段燒錄 (Multi-Session)</a></span></dt><dt><span class="sect2"><a href="#idp75619384">17.6.7. 取得更多資訊</a></span></dt><dt><span class="sect2"><a href="#creating-dvd-ram">17.6.8. 使用 <acronym class="acronym">DVD-RAM</acronym></a></span></dt></dl></dd><dt><span class="sect1"><a href="#floppies">17.7. 建立與使用軟碟</a></span></dt><dt><span class="sect1"><a href="#backup-basics">17.8. 備份基礎概念</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp75669816">17.8.1. 檔案系統備份</a></span></dt><dt><span class="sect2"><a href="#idp75722680">17.8.2. 目錄備份</a></span></dt><dt><span class="sect2"><a href="#backups-tapebackups">17.8.3. 使用資料磁帶備份</a></span></dt><dt><span class="sect2"><a href="#backups-programs-amanda">17.8.4. 第三方備份工具</a></span></dt><dt><span class="sect2"><a href="#idp75801912">17.8.5. 緊急還原</a></span></dt></dl></dd><dt><span class="sect1"><a href="#disks-virtual">17.9. 記憶體磁碟</a></span></dt><dd><dl><dt><span class="sect2"><a href="#disks-mdconfig">17.9.1. 連接與解除連接既有的映象檔</a></span></dt><dt><span class="sect2"><a href="#disks-md-freebsd5">17.9.2. 建立以檔案或記憶體為基底的磁碟</a></span></dt></dl></dd><dt><span class="sect1"><a href="#snapshots">17.10. 檔案系統快照</a></span></dt><dt><span class="sect1"><a href="#quotas">17.11. 磁碟配額</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp75990968">17.11.1. 開啟磁碟配額</a></span></dt><dt><span class="sect2"><a href="#idp76013240">17.11.2. 設定配額限制</a></span></dt><dt><span class="sect2"><a href="#idp76034488">17.11.3. 檢查配額限制與磁碟使用狀況</a></span></dt><dt><span class="sect2"><a href="#idp76050616">17.11.4. NFS 上的配額</a></span></dt></dl></dd><dt><span class="sect1"><a href="#disks-encrypting">17.12. 磁碟分割區加密</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp76085432">17.12.1. 使用 <span class="application">gbde</span> 做磁碟加密</a></span></dt><dt><span class="sect2"><a href="#disks-encrypting-geli">17.12.2. 使用 <code class="command">geli</code> 做磁碟加密</a></span></dt></dl></dd><dt><span class="sect1"><a href="#swap-encrypting">17.13. 交換空間加密</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp76252344">17.13.1. 設定已加密的交換空間</a></span></dt><dt><span class="sect2"><a href="#idp76289336">17.13.2. 加密的交換空間檢驗</a></span></dt></dl></dd><dt><span class="sect1"><a href="#disks-hast">17.14. 高可用存儲空間 (<acronym class="acronym">HAST</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp76339768">17.14.1. HAST 運作模式</a></span></dt><dt><span class="sect2"><a href="#idp76371256">17.14.2. HAST 設定</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp76439608">17.14.2.1. 容錯移轉設定</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp76492728">17.14.3. 疑難排解</a></span></dt><dd><dl><dt><span class="sect3"><a href="#disks-hast-sb">17.14.3.1. 自 Split-brain 情況復原</a></span></dt></dl></dd></dl></dd></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-synopsis"></a>17.1. 概述</h2></div></div></div><p>本章涵蓋如何在 FreeBSD 下使用磁碟及儲存媒體，這包含 <acronym class="acronym">SCSI</acronym> 及 <acronym class="acronym">IDE</acronym> 磁碟、<acronym class="acronym">CD</acronym> 及 <acronym class="acronym">DVD</acronym> 媒體、記憶體磁碟及 <acronym class="acronym">USB</acronym> 儲存裝置。</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>如何在 FreeBSD 系統加入額外的硬碟。</p></li><li class="listitem"><p>如何在 FreeBSD 擴增磁碟分割區的大小。</p></li><li class="listitem"><p>如何設定 FreeBSD 使用 <acronym class="acronym">USB</acronym> 儲存裝置。</p></li><li class="listitem"><p>如何在 FreeBSD 系統使用 <acronym class="acronym">CD</acronym> 及 <acronym class="acronym">DVD</acronym> 媒體。</p></li><li class="listitem"><p>如何使用在 FreeBSD 下可用的備份程式。</p></li><li class="listitem"><p>如何設定記憶體磁碟。</p></li><li class="listitem"><p>什麼是檔案系統快照 (Snapshot) 以及如何有效使用。</p></li><li class="listitem"><p>如何使用配額 (Quota) 來限制磁碟空間使用量。</p></li><li class="listitem"><p>如何加密磁碟及交換空間來防範攻擊者。</p></li><li class="listitem"><p>如何設定高可用性 (Highly available) 的儲存網路。</p></li></ul></div><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>了解如何 <a class="link" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">設定並安裝新的 FreeBSD 核心</a>。</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-adding"></a>17.2. 加入磁碟</h2></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">David</span> <span class="surname">O'Brien</span></span>. </span></div></div></div><a id="idp74944440" class="indexterm"></a><p>本節將說明如何加入新的 <acronym class="acronym">SATA</acronym> 磁碟到目前只有一個磁碟的機器上。 首先要關閉電腦並依照電腦、控制器及磁碟製造商的操作指南將磁碟安裝到電腦。重新啟動系統並登入 <code class="systemitem">root</code>。</p><p>查看 <code class="filename">/var/run/dmesg.boot</code> 來確認已經找到新的磁碟。在本例中，會以 <code class="filename">ada1</code> 代表新加入的 <acronym class="acronym">SATA</acronym> 磁碟。</p><a id="idp74948664" class="indexterm"></a><a id="idp74949304" class="indexterm"></a><p>在本例中，會在新的磁碟上建立單一大型分割區，使用 <a class="link" href="http://en.wikipedia.org/wiki/GUID_Partition_Table" target="_top"> <acronym class="acronym">GPT</acronym></a> 分割表格式而非較舊與通用性較差的 <acronym class="acronym">MBR</acronym> 結構。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">若新加入的磁碟不是空白的，可以使用 <code class="command">gpart delete</code> 來移除舊的分割區資訊。請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gpart</span>(8)</span></a> 取得詳細資訊。</p></div><p>建立完分割表格式後接著加入一個分割區，要在新的磁碟增進效能可使用較大的硬體區塊大小 (Block size)，此分割區會對齊 1 MB 的邊界：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gpart create -s GPT ada1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart add -t freebsd-ufs -a 1M ada1</code></strong></pre><p>依據使用情況，也可以使用較小的分割區。請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gpart</span>(8)</span></a> 來取得建立較小分割區的選項。</p><p>磁碟分割區資訊可以使用 <code class="command">gpart show</code> 檢視：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>gpart show ada1</code></strong>
=&gt;        34  1465146988  ada1  GPT  (699G)
          34        2014        - free -  (1.0M)
        2048  1465143296     1  freebsd-ufs  (699G)
  1465145344        1678        - free -  (839K)</pre><p>在新磁碟的新分割區上建立檔案系統：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/ada1p1</code></strong></pre><p>建立一個空的目錄做來做為<span class="emphasis"><em>掛載點 (mountpoint)</em></span>，一個在原有磁碟的檔案系統上可用來掛載新磁碟的位置：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /newdisk</code></strong></pre><p>最後，將磁碟項目加入到 <code class="filename">/etc/fstab</code>，讓啟動時會自動掛載新的磁碟：</p><pre xml:lang="en" class="programlisting" lang="en">/dev/ada1p1	/newdisk	ufs	rw	2	2</pre><p>新的磁碟也可手動掛載，無須重新啟動系統：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount /newdisk</code></strong></pre></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-growing"></a>17.3. 重設大小與擴增磁碟</h2></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Allan</span> <span class="surname">Jude</span></span>. </span></div></div></div><a id="idp74989112" class="indexterm"></a><p>磁碟的容量可以增加且不需要更動任何已存在的資料。這時常會用在虛擬機器，當虛擬磁碟太小且需要增加時。有時磁碟映像檔會被寫入到 <acronym class="acronym">USB</acronym> 隨身碟，但卻沒有使用全部的容量。此節我們將說明如合重設大小或 <span class="emphasis"><em>擴增</em></span> 磁碟內容來使用增加的容量。</p><p>要取得要重設大小的磁碟的代號可以查看 <code class="filename">/var/run/dmesg.boot</code>。在本例中，在系統上只有一個 <acronym class="acronym">SATA</acronym> 磁碟，該磁碟會以 <code class="filename">ada0</code> 表示。</p><a id="idp74993080" class="indexterm"></a><a id="idp74993720" class="indexterm"></a><p>列出在磁碟上的分割區來查看目前的設定：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gpart show <em class="replaceable"><code>ada0</code></em></code></strong>
=&gt;      34  83886013  ada0  GPT  (48G) [CORRUPT]
        34       128     1  freebsd-boot  (64k)
       162  79691648     2  freebsd-ufs  (38G)
  79691810   4194236     3  freebsd-swap  (2G)
  83886046         1        - free -  (512B)</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">若磁碟已使用 <a class="link" href="http://en.wikipedia.org/wiki/GUID_Partition_Table" target="_top"> <acronym class="acronym">GPT</acronym></a> 分割表格式做格式化，可能會顯示為 <span class="quote">“<span class="quote">已損壞 (corrupted)</span>”</span> 因為 <acronym class="acronym">GPT</acronym> 備份分割區已不存在於磁碟結尾。 使用 <code class="command">gpart</code> 來修正備份分割區：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gpart recover <em class="replaceable"><code>ada0</code></em></code></strong>
ada0 recovered</pre></div><p>現在在磁碟上的額外空間已經可以被新的分割區使用，或者可以拿來擴充既有的分割區：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gpart show <em class="replaceable"><code>ada0</code></em></code></strong>
=&gt;       34  102399933  ada0  GPT  (48G)
         34        128     1  freebsd-boot  (64k)
        162   79691648     2  freebsd-ufs  (38G)
   79691810    4194236     3  freebsd-swap  (2G)
   83886046   18513921        - free -  (8.8G)</pre><p>分割區只能在連續的未使用空間上重設大小。在這個例子中，磁碟上最後的分割區為交換 (Swap) 分割區，而第二個分割區才是需要重設大小的分割區。由於交換分割區中只會有暫存的資料，所以此時可以安全的卸載、刪除，然後在重設第二個分割區大小之後再重建最後一個分割區。</p><p>停用交換分割區：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>swapoff <em class="replaceable"><code>/dev/ada0p3</code></em></code></strong></pre><p>刪除 <em class="replaceable"><code>ada0</code></em> 磁碟上的第三個分割區，可使用 <code class="option">-i</code> 參數來指定分割區。</p><pre xml:lang="en" class="screen" lang="en">
<code class="prompt">#</code> <strong class="userinput"><code>gpart delete -i <em class="replaceable"><code>3</code></em> <em class="replaceable"><code>ada0</code></em></code></strong>
ada0p3 deleted
<code class="prompt">#</code> <strong class="userinput"><code>gpart show <em class="replaceable"><code>ada0</code></em></code></strong>
=&gt;       34  102399933  ada0  GPT  (48G)
         34        128     1  freebsd-boot  (64k)
        162   79691648     2  freebsd-ufs  (38G)
   79691810   22708157        - free -  (10G)</pre><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">在掛載的檔案系統上修改分割區表可能會造成資料遺失。最好的方式是在未掛載檔案系統的情況下 (使用 Live <acronym class="acronym">CD-ROM</acronym> 或 <acronym class="acronym">USB</acronym> 裝置) 執行以下步驟。雖然如此，若仍要這樣做的話，在關閉 GEOM 安全性功能之後可以在掛載的檔案系統上修改分割區表：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysctl kern.geom.debugflags=16</code></strong></pre></div><p>重設分割區大小並保留要用來重建交換分割區的空間，要重設大小的分割區可以用 <code class="option">-i</code> 來指定，而要重設的大小可用 <code class="option">-s</code> 來指定，若要對齊分割區可以使用 <code class="option">-a</code>。這個動作只會修改分割區大小，分割區中的檔案系統需在另一個步驟擴增。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gpart resize -i <em class="replaceable"><code>2</code></em> -s <em class="replaceable"><code>47G</code></em> -a 4k <em class="replaceable"><code>ada0</code></em></code></strong>
ada0p2 resized
<code class="prompt">#</code> <strong class="userinput"><code>gpart show <em class="replaceable"><code>ada0</code></em></code></strong>
=&gt;       34  102399933  ada0  GPT  (48G)
         34        128     1  freebsd-boot  (64k)
        162   98566144     2  freebsd-ufs  (47G)
   98566306    3833661        - free -  (1.8G)</pre><p>重建交換分割區並且啟動，若不使用 <code class="option">-s</code> 指定大小則會使用所有剩餘的空間：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gpart add -t freebsd-swap -a 4k <em class="replaceable"><code>ada0</code></em></code></strong>
ada0p3 added
<code class="prompt">#</code> <strong class="userinput"><code>gpart show <em class="replaceable"><code>ada0</code></em></code></strong>
=&gt;       34  102399933  ada0  GPT  (48G)
         34        128     1  freebsd-boot  (64k)
        162   98566144     2  freebsd-ufs  (47G)
   98566306    3833661     3  freebsd-swap  (1.8G)
<code class="prompt">#</code> <strong class="userinput"><code>swapon <em class="replaceable"><code>/dev/ada0p3</code></em></code></strong></pre><p>擴增 <acronym class="acronym">UFS</acronym> 檔案系統來使用重設分割區大小之後的新容量：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>growfs <em class="replaceable"><code>/dev/ada0p2</code></em></code></strong>
Device is mounted read-write; resizing will result in temporary write suspension for /.
It's strongly recommended to make a backup before growing the file system.
OK to grow file system on /dev/ada0p2, mounted on /, from 38GB to 47GB? [Yes/No] <strong class="userinput"><code>Yes</code></strong>
super-block backups (for fsck -b #) at:
 80781312, 82063552, 83345792, 84628032, 85910272, 87192512, 88474752,
 89756992, 91039232, 92321472, 93603712, 94885952, 96168192, 97450432</pre><p>若檔案系統使用 <acronym class="acronym">ZFS</acronym>，重設大小需執行 <code class="option">online</code> 子指令並使用 <code class="option">-e</code> 來觸發動作：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool online -e <em class="replaceable"><code>zroot</code></em> <em class="replaceable"><code>/dev/ada0p2</code></em></code></strong></pre><p>現在分割區與檔案系統已透過重設大小來使用新增加的磁碟空間。</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="usb-disks"></a>17.4. <acronym class="acronym">USB</acronym> 儲存裝置</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><a id="idp75054648" class="indexterm"></a><p>許多外部儲存裝置的解決方案，例如硬碟、<acronym class="acronym">USB</acronym> 隨身碟及
<acronym class="acronym">CD</acronym> 與 <acronym class="acronym">DVD</acronym> 燒錄機皆使用通用序列匯流排 (Universal Serial Bus, <acronym class="acronym">USB</acronym>)，FreeBSD 提供了對 <acronym class="acronym">USB</acronym> 1.x, 2.0 及 3.0 裝置的支援。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">部份硬體尚不相容 <acronym class="acronym">USB</acronym> 3.0，包含 Haswell (Lynx point) 晶片組，若 FreeBSD 開機出現 <span class="errorname">failed with error 19</span> 訊息，請在系統 <acronym class="acronym">BIOS</acronym> 關閉 xHCI/USB3。</p></div><p>對 <acronym class="acronym">USB</acronym> 儲存裝置的支援已內建於 <code class="filename">GENERIC</code> 核心，若為自訂的核心，請確定在核心設定檔中有下列幾行設定：</p><pre xml:lang="en" class="programlisting" lang="en">device scbus	# SCSI bus (required for ATA/SCSI)
device da	# Direct Access (disks)
device pass	# Passthrough device (direct ATA/SCSI access)
device uhci	# provides USB 1.x support
device ohci	# provides USB 1.x support
device ehci	# provides USB 2.0 support
device xhci	# provides USB 3.0 support
device usb	# USB Bus (required)
device umass	# Disks/Mass storage - Requires scbus and da
device cd	# needed for CD and DVD burners</pre><p>FreeBSD 使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=umass&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">umass</span>(4)</span></a> 驅動程式透過 <acronym class="acronym">SCSI</acronym> 子系統來存取 <acronym class="acronym">USB</acronym> 儲存裝置，因此任何在系統的 <acronym class="acronym">USB</acronym> 裝置都會以 <acronym class="acronym">SCSI</acronym> 裝置呈現，若 <acronym class="acronym">USB</acronym> 裝置是 <acronym class="acronym">CD</acronym> 或 <acronym class="acronym">DVD</acronym> 燒錄機，請<span class="emphasis"><em>不要</em></span>在自訂核心設定檔中引用 <code class="option">device atapicam</code>。</p><p>本節後續的部份將示範如何檢查 FreeBSD 能夠辦識 <acronym class="acronym">USB</acronym> 儲存裝置以及如何設定該裝置。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75067192"></a>17.4.1. 裝置設定</h3></div></div></div><p>要測試 <acronym class="acronym">USB</acronym> 設定，請先插入 <acronym class="acronym">USB</acronym> 裝置，然後使用 <code class="command">dmesg</code> 來確認系統訊息緩衝區中有出現該磁碟機，該訊息如下：</p><pre xml:lang="en" class="screen" lang="en">umass0: &lt;STECH Simple Drive, class 0/0, rev 2.00/1.04, addr 3&gt; on usbus0
umass0:  SCSI over Bulk-Only; quirks = 0x0100
umass0:4:0:-1: Attached to scbus4
da0 at umass-sim0 bus 0 scbus4 target 0 lun 0
da0: &lt;STECH Simple Drive 1.04&gt; Fixed Direct Access SCSI-4 device
da0: Serial Number WD-WXE508CAN263
da0: 40.000MB/s transfers
da0: 152627MB (312581808 512 byte sectors: 255H 63S/T 19457C)
da0: quirks=0x2&lt;NO_6_BYTE&gt;</pre><p>不同的裝置會有不同的廠牌、裝置節點 (<code class="filename">da0</code>)、速度與大小。</p><p>當 <acronym class="acronym">USB</acronym> 裝置可以做為 <acronym class="acronym">SCSI</acronym> 檢視時，便可使用 <code class="command">camcontrol</code> 來列出連接到系統的 <acronym class="acronym">USB</acronym> 儲存裝置：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>camcontrol devlist</code></strong>
&lt;STECH Simple Drive 1.04&gt;          at scbus4 target 0 lun 0 (pass3,da0)</pre><p>或者，可以使用 <code class="command">usbconfig</code> 來列出裝置，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=usbconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">usbconfig</span>(8)</span></a> 來取得更多有關此指令的資訊。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>usbconfig</code></strong>
ugen0.3: &lt;Simple Drive STECH&gt; at usbus0, cfg=0 md=HOST spd=HIGH (480Mbps) pwr=ON (2mA)</pre><p>若該裝置尚未被格式化，請參考 <a class="xref" href="#disks-adding" title="17.2. 加入磁碟">節 17.2, “加入磁碟”</a> 中有關如何在 <acronym class="acronym">USB</acronym> 磁碟格式化與建立分割區的說明。若磁碟中有檔案系統，可由 <code class="systemitem">root</code> 依據 <a class="xref" href="#mount-unmount" title="3.7. 掛載與卸載檔案系統">節 3.7, “掛載與卸載檔案系統”</a> 中的說明掛載磁碟。</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">要允許未被信任的使用者掛載任意媒體，可開啟 <code class="varname">vfs.usermount</code>，詳細說明如下。從安全性的角度來看這並不是安全的，大多的檔案系統並不會防範惡意裝置。</p></div><p>要讓裝置可讓一般使用者掛載，其中一個解決方案便是使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a> 讓所有裝置的使用者成為 <code class="systemitem">operator</code> 群組的成員。接著，將下列幾行加入 <code class="filename">/etc/devfs.rules</code> 來確保 <code class="systemitem">operator</code> 能夠讀取與寫入裝置：</p><pre xml:lang="en" class="programlisting" lang="en">[localrules=5]
add path 'da*' mode 0660 group operator</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">若系統也同時安裝了內建 <acronym class="acronym">SCSI</acronym> 磁碟，請更改第二行如下：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="programlisting" lang="en">add path 'da[<em class="replaceable"><code>3</code></em>-9]*' mode 0660 group operator</pre><p xmlns="http://www.w3.org/1999/xhtml">這會從 <code class="systemitem">operator</code> 群組中排除前三個 <acronym class="acronym">SCSI</acronym> 磁碟 (<code class="filename">da0</code> 到 <code class="filename">da2</code>)，接著取代 <em class="replaceable"><code>3</code></em> 為內部 <acronym class="acronym">SCSI</acronym> 磁碟的編號。請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs.rules&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs.rules</span>(5)</span></a> 來取得更多有關此檔案的資訊。</p></div><p>接著，在 <code class="filename">/etc/rc.conf</code> 開啟規則：</p><pre xml:lang="en" class="programlisting" lang="en">devfs_system_ruleset="localrules"</pre><p>然後，加入以下行到 <code class="filename">/etc/sysctl.conf</code> 指示系統允許正常使用者掛載檔案系統：</p><pre xml:lang="en" class="programlisting" lang="en">vfs.usermount=1</pre><p>這樣只會在下次重新開機時生效，可使用 <code class="command">sysctl</code> 來立即設定這個變數：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysctl vfs.usermount=1</code></strong>
vfs.usermount: 0 -&gt; 1</pre><p>最後一個步驟是建立要掛載檔案系統要的目錄，要掛載檔案系統的使用者需要擁有這個目錄。其中一個辦法是讓 <code class="systemitem">root</code> 建立由該使用者擁有的子目錄 <code class="filename">/mnt/<em class="replaceable"><code>username</code></em></code>。在下面的例子，將 <em class="replaceable"><code>username</code></em> 替換為該使用者的登入名稱並將 <em class="replaceable"><code>usergroup</code></em> 替換為該使用者的主要群組：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /mnt/<em class="replaceable"><code>username</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chown <em class="replaceable"><code>username</code></em>:<em class="replaceable"><code>usergroup</code></em> /mnt/<em class="replaceable"><code>username</code></em></code></strong></pre><p>假如已經插入 <acronym class="acronym">USB</acronym> 隨身碟，且已出現 <code class="filename">/dev/da0s1</code> 裝置。若裝置使用 <acronym class="acronym">FAT</acronym> 格式的檔案系統，則使用者可使用以下指令掛載該檔案系統：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>mount -t msdosfs -o -m=644,-M=755 /dev/da0s1 /mnt/<em class="replaceable"><code>username</code></em></code></strong></pre><p>在裝置可以被拔除前，<span class="emphasis"><em>必須</em></span>先卸載：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>umount /mnt/<em class="replaceable"><code>username</code></em></code></strong></pre><p>裝置移除之後，系統訊息緩衝區會顯示如下的訊息：</p><pre xml:lang="en" class="screen" lang="en">umass0: at uhub3, port 2, addr 3 (disconnected)
da0 at umass-sim0 bus 0 scbus4 target 0 lun 0
da0: &lt;STECH Simple Drive 1.04&gt; s/n WD-WXE508CAN263          detached
(da0:umass-sim0:0:0:0): Periph destroyed</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75186232"></a>17.4.2. 自動掛載可移除的媒體</h3></div></div></div><p>可以取消註解在 <code class="filename">/etc/auto_master</code> 中的下行來自動掛載 <acronym class="acronym">USB</acronym> 裝置：</p><pre xml:lang="en" class="screen" lang="en">/media		-media		-nosuid</pre><p>然後加入這些行到 <code class="filename">/etc/devd.conf</code>：</p><pre xml:lang="en" class="screen" lang="en">notify 100 {
	match "system" "GEOM";
	match "subsystem" "DEV";
	action "/usr/sbin/automount -c";
};</pre><p>若 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> 以及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a> 已經正在執行，則需重新載入設定：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service automount restart</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service devd restart</code></strong></pre><p>要設定讓 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> 在開機時啟動可以加入此行到 <code class="filename">/etc/rc.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">autofs_enable="YES"</pre><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> 需要開啟 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a>，預設已經開啟。</p><p>立即啟動服務：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service automount start</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service automountd start</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service autounmountd start</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service devd start</code></strong></pre><p>可以被自動掛載的檔案系統會在 <code class="filename">/media/</code> 中以目錄呈現，會以檔案系統的標籤來命名目錄，若標籤遺失，則會以裝置節點命名。</p><p>檔案系統會在第一次存取時自動掛載，並在一段時間未使用後自動卸載。自動掛載的磁碟也可手動卸載：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>automount -fu</code></strong></pre><p>這個機制一般會用在記憶卡與 <acronym class="acronym">USB</acronym> 隨身碟，也可用在任何 Block 裝置，包含光碟機或 <acronym class="acronym">iSCSI</acronym> <acronym class="acronym">LUN</acronym>。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="creating-cds"></a>17.5. 建立與使用 <acronym class="acronym">CD</acronym> 媒體</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Mike</span> <span class="surname">Meyer</span></span>. </span></div></div></div><a id="idp75213112" class="indexterm"></a><p xml:lang="en" lang="en">Compact Disc (<acronym class="acronym">CD</acronym>) media provide a number
      of features that differentiate them from conventional disks.
      They are designed so that they can be read continuously without
      delays to move the head between tracks.  While
      <acronym class="acronym">CD</acronym> media do have tracks, these refer to a
      section of data to be read continuously, and not a physical
      property of the disk.  The <acronym class="acronym">ISO</acronym> 9660 file
      system was designed to deal with these differences.</p><a id="idp75216312" class="indexterm"></a><a id="idp75221304" class="indexterm"></a><a id="idp75222584" class="indexterm"></a><p xml:lang="en" lang="en">The FreeBSD Ports Collection provides several utilities for
      burning and duplicating audio and data <acronym class="acronym">CD</acronym>s.
      This chapter demonstrates the use of several command line
      utilities.  For <acronym class="acronym">CD</acronym> burning software with a
      graphical utility, consider installing the
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/xcdroast/pkg-descr">sysutils/xcdroast</a> or
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/k3b/pkg-descr">sysutils/k3b</a> packages or ports.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="atapicam"></a>17.5.1. 支援的裝置</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><a id="idp75229880" class="indexterm"></a><p xml:lang="en" lang="en">The <code class="filename">GENERIC</code> kernel provides support
	for <acronym class="acronym">SCSI</acronym>,  <acronym class="acronym">USB</acronym>, and
	<acronym class="acronym">ATAPI</acronym> <acronym class="acronym">CD</acronym> readers and
	burners.  If a custom kernel is used, the options that need to
	be present in the kernel configuration file vary by the type
	of device.</p><p xml:lang="en" lang="en">For a <acronym class="acronym">SCSI</acronym> burner, make sure these
	options are present:</p><pre xml:lang="en" class="programlisting" lang="en">device scbus	# SCSI bus (required for ATA/SCSI)
device da	# Direct Access (disks)
device pass	# Passthrough device (direct ATA/SCSI access)
device cd	# needed for CD and DVD burners</pre><p xml:lang="en" lang="en">For a <acronym class="acronym">USB</acronym> burner, make sure these
	options are present:</p><pre xml:lang="en" class="programlisting" lang="en">device scbus	# SCSI bus (required for ATA/SCSI)
device da	# Direct Access (disks)
device pass	# Passthrough device (direct ATA/SCSI access)
device cd	# needed for CD and DVD burners
device uhci	# provides USB 1.x support
device ohci	# provides USB 1.x support
device ehci	# provides USB 2.0 support
device xhci	# provides USB 3.0 support
device usb	# USB Bus (required)
device umass	# Disks/Mass storage - Requires scbus and da</pre><p xml:lang="en" lang="en">For an <acronym class="acronym">ATAPI</acronym> burner, make sure these
	options are present:</p><pre xml:lang="en" class="programlisting" lang="en">device ata	# Legacy ATA/SATA controllers
device scbus	# SCSI bus (required for ATA/SCSI)
device pass	# Passthrough device (direct ATA/SCSI access)
device cd	# needed for CD and DVD burners</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">On FreeBSD versions prior to 10.x, this line is also
	  needed in the kernel configuration file if the burner is an
	  <acronym class="acronym">ATAPI</acronym> device:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="programlisting" lang="en">device atapicam</pre><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Alternately, this driver can be loaded at boot time by
	  adding the following line to
	  <code class="filename">/boot/loader.conf</code>:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="programlisting" lang="en">atapicam_load="YES"</pre><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">This will require a reboot of the system as this driver
	  can only be loaded at boot time.</p></div><p xml:lang="en" lang="en">To verify that FreeBSD recognizes the device, run
	<code class="command">dmesg</code> and look for an entry for the device.
	On systems prior to 10.x, the device name in the first line of
	the output will be <code class="filename">acd0</code> instead of
	<code class="filename">cd0</code>.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>dmesg | grep cd</code></strong>
cd0 at ahcich1 bus 0 scbus1 target 0 lun 0
cd0: &lt;HL-DT-ST DVDRAM GU70N LT20&gt; Removable CD-ROM SCSI-0 device
cd0: Serial Number M3OD3S34152
cd0: 150.000MB/s transfers (SATA 1.x, UDMA6, ATAPI 12bytes, PIO 8192bytes)
cd0: Attempt to query device size failed: NOT READY, Medium not present - tray closed</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="cdrecord"></a>17.5.2. 燒錄 <acronym class="acronym">CD</acronym></h3></div></div></div><p xml:lang="en" lang="en">In FreeBSD, <code class="command">cdrecord</code> can be used to burn
	<acronym class="acronym">CD</acronym>s.  This command is installed with the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/cdrtools/pkg-descr">sysutils/cdrtools</a> package or port.</p><p xml:lang="en" lang="en">While <code class="command">cdrecord</code> has many options, basic
	usage is simple.  Specify the name of the
	<acronym class="acronym">ISO</acronym> file to burn and, if the system has
	multiple burner devices, specify the name of the device to
	use:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cdrecord <em class="replaceable"><code>dev=device</code></em> <em class="replaceable"><code>imagefile.iso</code></em></code></strong></pre><p xml:lang="en" lang="en">To determine the device name of the burner, use
	<code class="option">-scanbus</code> which might produce results like
	this:</p><a id="idp75263800" class="indexterm"></a><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cdrecord -scanbus</code></strong>
ProDVD-ProBD-Clone 3.00 (amd64-unknown-freebsd10.0) Copyright (C) 1995-2010 Jörg Schilling
Using libscg version 'schily-0.9'
scsibus0:
        0,0,0     0) 'SEAGATE ' 'ST39236LW       ' '0004' Disk
        0,1,0     1) 'SEAGATE ' 'ST39173W        ' '5958' Disk
        0,2,0     2) *
        0,3,0     3) 'iomega  ' 'jaz 1GB         ' 'J.86' Removable Disk
        0,4,0     4) 'NEC     ' 'CD-ROM DRIVE:466' '1.26' Removable CD-ROM
        0,5,0     5) *
        0,6,0     6) *
        0,7,0     7) *
scsibus1:
        1,0,0   100) *
        1,1,0   101) *
        1,2,0   102) *
        1,3,0   103) *
        1,4,0   104) *
        1,5,0   105) 'YAMAHA  ' 'CRW4260         ' '1.0q' Removable CD-ROM
        1,6,0   106) 'ARTEC   ' 'AM12S           ' '1.06' Scanner
        1,7,0   107) *</pre><p xml:lang="en" lang="en">Locate the entry for the <acronym class="acronym">CD</acronym> burner and
	use the three numbers separated by commas as the value for
	<code class="option">dev</code>.  In this case, the Yamaha burner device
	is <code class="literal">1,5,0</code>, so the appropriate input to
	specify that device is <code class="option">dev=1,5,0</code>.  Refer to
	the manual page for <code class="command">cdrecord</code> for other ways
	to specify this value and for information on writing audio
	tracks and controlling the write speed.</p><p xml:lang="en" lang="en">Alternately, run the following command to get the device
	address of the burner:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>camcontrol devlist</code></strong>
&lt;MATSHITA CDRW/DVD UJDA740 1.00&gt;   at scbus1 target 0 lun 0 (cd0,pass0)</pre><p xml:lang="en" lang="en">Use the numeric values for <code class="literal">scbus</code>,
	<code class="literal">target</code>, and <code class="literal">lun</code>.  For
	this example, <code class="literal">1,0,0</code> is the device name to
	use.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mkisofs"></a>17.5.3. 寫入資料到一個 <acronym class="acronym">ISO</acronym> 檔案系統</h3></div></div></div><p xml:lang="en" lang="en">In order to produce a data <acronym class="acronym">CD</acronym>, the data
	files that are going to make up the tracks on the
	<acronym class="acronym">CD</acronym> must be prepared before they can be
	burned to the <acronym class="acronym">CD</acronym>.  In FreeBSD,
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/cdrtools/pkg-descr">sysutils/cdrtools</a> installs
	<code class="command">mkisofs</code>, which can be used to produce an
	<acronym class="acronym">ISO</acronym> 9660 file system that is an image of a
	directory tree within a <span class="trademark">UNIX</span>® file system.  The simplest
	usage is to specify the name of the <acronym class="acronym">ISO</acronym>
	file to create and the path to the files to place into the
	<acronym class="acronym">ISO</acronym> 9660 file system:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mkisofs -o <em class="replaceable"><code>imagefile.iso</code></em> <em class="replaceable"><code>/path/to/tree</code></em></code></strong></pre><a id="idp75283896" class="indexterm"></a><p xml:lang="en" lang="en">This command maps the file names in the specified path to
	names that fit the limitations of the standard
	<acronym class="acronym">ISO</acronym> 9660 file system, and will exclude
	files that do not meet the standard for <acronym class="acronym">ISO</acronym>
	file systems.</p><a id="idp75302840" class="indexterm"></a><p xml:lang="en" lang="en">A number of options are available to overcome the
	restrictions imposed by the standard.  In particular,
	<code class="option">-R</code> enables the Rock Ridge extensions common
	to <span class="trademark">UNIX</span>® systems and <code class="option">-J</code> enables Joliet
	extensions used by <span class="trademark">Microsoft</span>® systems.</p><p xml:lang="en" lang="en">For <acronym class="acronym">CD</acronym>s that are going to be used only
	on FreeBSD systems, <code class="option">-U</code> can be used to disable
	all filename restrictions.  When used with
	<code class="option">-R</code>, it produces a file system image that is
	identical to the specified FreeBSD tree, even if it violates the
	<acronym class="acronym">ISO</acronym> 9660 standard.</p><a id="idp75320760" class="indexterm"></a><p xml:lang="en" lang="en">The last option of general use is <code class="option">-b</code>.
	This is used to specify the location of a boot image for use
	in producing an <span class="quote">“<span class="quote">El Torito</span>”</span> bootable
	<acronym class="acronym">CD</acronym>.  This option takes an argument which is
	the path to a boot image from the top of the tree being
	written to the <acronym class="acronym">CD</acronym>.  By default,
	<code class="command">mkisofs</code> creates an <acronym class="acronym">ISO</acronym>
	image in <span class="quote">“<span class="quote">floppy disk emulation</span>”</span> mode, and thus
	expects the boot image to be exactly 1200, 1440 or
	2880 KB in size.  Some boot loaders, like the one used by
	the FreeBSD distribution media, do not use emulation mode.  In
	this case, <code class="option">-no-emul-boot</code> should be used.  So,
	if <code class="filename">/tmp/myboot</code> holds a bootable FreeBSD
	system with the boot image in
	<code class="filename">/tmp/myboot/boot/cdboot</code>, this command
	would produce
	<code class="filename">/tmp/bootable.iso</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mkisofs -R -no-emul-boot -b boot/cdboot -o /tmp/bootable.iso /tmp/myboot</code></strong></pre><p xml:lang="en" lang="en">The resulting <acronym class="acronym">ISO</acronym> image can be mounted
	as a memory disk with:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mdconfig -a -t vnode -f /tmp/bootable.iso -u 0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -t cd9660 /dev/md0 /mnt</code></strong></pre><p xml:lang="en" lang="en">One can then verify that <code class="filename">/mnt</code> and
	<code class="filename">/tmp/myboot</code> are identical.</p><p xml:lang="en" lang="en">There are many other options available for
	<code class="command">mkisofs</code> to fine-tune its behavior.  Refer
	to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mkisofs</span>(8)</span></a> for details.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">It is possible to copy a data <acronym class="acronym">CD</acronym> to
	  an image file that is functionally equivalent to the image
	  file created with <code class="command">mkisofs</code>.  To do so, use
	  <code class="filename">dd</code> with the device name as the input
	  file and the name of the <acronym class="acronym">ISO</acronym> to create as
	  the output file:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/<em class="replaceable"><code>cd0</code></em> of=<em class="replaceable"><code>file.iso</code></em> bs=2048</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The resulting image file can be burned to
	  <acronym class="acronym">CD</acronym> as described in <a class="xref" href="#cdrecord" title="17.5.2. 燒錄 CD">節 17.5.2, “燒錄 <acronym class="acronym">CD</acronym>”</a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mounting-cd"></a>17.5.4. 使用資料 <acronym class="acronym">CD</acronym></h3></div></div></div><p xml:lang="en" lang="en">Once an <acronym class="acronym">ISO</acronym> has been burned to a
	<acronym class="acronym">CD</acronym>, it can be mounted by specifying the
	file system type, the name of the device containing the
	<acronym class="acronym">CD</acronym>, and an existing mount point:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount -t cd9660 <em class="replaceable"><code>/dev/cd0</code></em> <em class="replaceable"><code>/mnt</code></em></code></strong></pre><p xml:lang="en" lang="en">Since <code class="command">mount</code> assumes that a file system
	is of type <code class="literal">ufs</code>, a <span class="errorname">Incorrect
	  super block</span> error will occur if <code class="literal">-t
	  cd9660</code> is not included when mounting a data
	<acronym class="acronym">CD</acronym>.</p><p xml:lang="en" lang="en">While any data <acronym class="acronym">CD</acronym> can be mounted this
	way, disks with certain <acronym class="acronym">ISO</acronym> 9660 extensions
	might behave oddly.  For example, Joliet disks store all
	filenames in two-byte Unicode characters.  If some non-English
	characters show up as question marks, specify the local
	charset with <code class="option">-C</code>.  For more information, refer
	to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount_cd9660&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount_cd9660</span>(8)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">In order to do this character conversion with the help
	  of <code class="option">-C</code>, the kernel requires the
	  <code class="filename">cd9660_iconv.ko</code> module to be loaded.
	  This can be done either by adding this line to
	  <code class="filename">loader.conf</code>:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="programlisting" lang="en">cd9660_iconv_load="YES"</pre><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">and then rebooting the machine, or by directly loading
	  the module with <code class="command">kldload</code>.</p></div><p xml:lang="en" lang="en">Occasionally, <span class="errorname">Device not configured</span>
	will be displayed when trying to mount a data
	<acronym class="acronym">CD</acronym>.  This usually means that the
	<acronym class="acronym">CD</acronym> drive has not detected a disk in
	the tray, or that the drive is not visible on the bus.  It
	can take a couple of seconds for a <acronym class="acronym">CD</acronym>
	drive to detect media, so be
	patient.</p><p xml:lang="en" lang="en">Sometimes, a <acronym class="acronym">SCSI</acronym>
	<acronym class="acronym">CD</acronym> drive may be missed because it did not
	have enough time to answer the bus reset.  To resolve this,
	a custom kernel can be created which increases the default
	<acronym class="acronym">SCSI</acronym> delay.  Add the following option to
	the custom kernel configuration file and rebuild the kernel
	using the instructions in <a class="xref" href="#kernelconfig-building" title="8.5. 編譯與安裝自訂核心">節 8.5, “編譯與安裝自訂核心”</a>:</p><pre xml:lang="en" class="programlisting" lang="en">options SCSI_DELAY=15000</pre><p xml:lang="en" lang="en">This tells the <acronym class="acronym">SCSI</acronym> bus to pause 15
	seconds during boot, to give the <acronym class="acronym">CD</acronym>
	drive every possible chance to answer the bus reset.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">It is possible to burn a file directly to
	  <acronym class="acronym">CD</acronym>, without creating an
	  <acronym class="acronym">ISO</acronym> 9660 file system.  This is known as
	  burning a raw data <acronym class="acronym">CD</acronym> and some people do
	  this for backup purposes.</p><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">This type of disk can not be mounted as a normal data
	  <acronym class="acronym">CD</acronym>.  In order to retrieve the data burned
	  to such a <acronym class="acronym">CD</acronym>, the data must be read from
	  the raw device node.  For example, this command will extract
	  a compressed tar file located on the second
	  <acronym class="acronym">CD</acronym> device into the current working
	  directory:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>tar xzvf /dev/<em class="replaceable"><code>cd1</code></em></code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">  In order to mount a data <acronym class="acronym">CD</acronym>, the
	  data must be written using
	  <code class="command">mkisofs</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="duplicating-audiocds"></a>17.5.5. 複製音樂 <acronym class="acronym">CD</acronym></h3></div></div></div><p xml:lang="en" lang="en">To duplicate an audio <acronym class="acronym">CD</acronym>, extract the
	audio data from the <acronym class="acronym">CD</acronym> to a series of
	files, then write these files to a blank
	<acronym class="acronym">CD</acronym>.</p><p xml:lang="en" lang="en"><a class="xref" href="#using-cdrecord" title="過程 17.1. Duplicating an Audio CD">過程 17.1, “Duplicating an Audio <acronym class="acronym">CD</acronym>”</a> describes how to
	duplicate and burn an audio <acronym class="acronym">CD</acronym>.  If the
	FreeBSD version is less than 10.0 and the device is
	<acronym class="acronym">ATAPI</acronym>, the <code class="option">atapicam</code> module
	must be first loaded using the instructions in <a class="xref" href="#atapicam" title="17.5.1. 支援的裝置">節 17.5.1, “支援的裝置”</a>.</p><div class="procedure"><a id="using-cdrecord"></a><div class="procedure-title">過程 17.1. Duplicating an Audio <acronym class="acronym">CD</acronym></div><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">The <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/cdrtools/pkg-descr">sysutils/cdrtools</a> package or
	    port installs <code class="command">cdda2wav</code>.  This command
	    can be used to extract all of the audio tracks, with each
	    track written to a separate <acronym class="acronym">WAV</acronym> file in
	    the current working directory:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>cdda2wav -vall -B -Owav</code></strong></pre><p xml:lang="en" lang="en">A device name does not need to be specified if there
	    is only one <acronym class="acronym">CD</acronym> device on the system.
	    Refer to the <code class="command">cdda2wav</code> manual page for
	    instructions on how to specify a device and to learn more
	    about the other options available for this command.</p></li><li class="step"><p xml:lang="en" lang="en">Use <code class="command">cdrecord</code> to write the
	    <code class="filename">.wav</code> files:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>cdrecord -v dev=<em class="replaceable"><code>2,0</code></em> -dao -useinfo  *.wav</code></strong></pre><p xml:lang="en" lang="en">Make sure that <em class="replaceable"><code>2,0</code></em> is set
	    appropriately, as described in <a class="xref" href="#cdrecord" title="17.5.2. 燒錄 CD">節 17.5.2, “燒錄 <acronym class="acronym">CD</acronym>”</a>.</p></li></ol></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="creating-dvds"></a>17.6. 建立與使用 <acronym class="acronym">DVD</acronym> 媒體</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div><div><span class="authorgroup">With inputs from <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Andy</span> <span class="surname">Polyakov</span></span>. </span></div></div></div><a id="idp75411000" class="indexterm"></a><p xml:lang="en" lang="en">Compared to the <acronym class="acronym">CD</acronym>, the
      <acronym class="acronym">DVD</acronym> is the next generation of optical media
      storage technology.  The <acronym class="acronym">DVD</acronym> can hold more
      data than any <acronym class="acronym">CD</acronym> and is the standard for
      video publishing.</p><p xml:lang="en" lang="en">Five physical recordable formats can be defined for a
      recordable <acronym class="acronym">DVD</acronym>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">DVD-R: This was the first <acronym class="acronym">DVD</acronym>
	  recordable format available.  The DVD-R standard is defined
	  by the <a class="link" href="http://www.dvdforum.org/forum.shtml" target="_top"><acronym class="acronym">DVD</acronym>
	    Forum</a>.  This format is write once.</p></li><li class="listitem"><p xml:lang="en" lang="en"><acronym class="acronym">DVD-RW</acronym>: This is the rewritable
	  version of the DVD-R standard.  A
	  <acronym class="acronym">DVD-RW</acronym> can be rewritten about 1000
	  times.</p></li><li class="listitem"><p xml:lang="en" lang="en"><acronym class="acronym">DVD-RAM</acronym>: This is a rewritable format
	  which can be seen as a removable hard drive.  However, this
	  media is not compatible with most
	  <acronym class="acronym">DVD-ROM</acronym> drives and DVD-Video players as
	  only a few <acronym class="acronym">DVD</acronym> writers support the
	  <acronym class="acronym">DVD-RAM</acronym> format.  Refer to <a class="xref" href="#creating-dvd-ram" title="17.6.8. 使用 DVD-RAM">節 17.6.8, “使用 <acronym class="acronym">DVD-RAM</acronym>”</a> for more information on
	  <acronym class="acronym">DVD-RAM</acronym> use.</p></li><li class="listitem"><p xml:lang="en" lang="en"><acronym class="acronym">DVD+RW</acronym>: This is a rewritable format
	  defined by the <a class="link" href="https://en.wikipedia.org/wiki/DVD%2BRW_Alliance" target="_top">
	    <acronym class="acronym">DVD+RW</acronym> Alliance</a>.  A
	  <acronym class="acronym">DVD+RW</acronym> can be rewritten about 1000
	    times.</p></li><li class="listitem"><p xml:lang="en" lang="en">DVD+R: This format is the write once variation of the
	  <acronym class="acronym">DVD+RW</acronym> format.</p></li></ul></div><p xml:lang="en" lang="en">A single layer recordable <acronym class="acronym">DVD</acronym> can hold up
      to 4,700,000,000 bytes which is actually 4.38 GB or
      4485 MB as 1 kilobyte is 1024 bytes.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">A distinction must be made between the physical media and
	the application.  For example, a DVD-Video is a specific file
	layout that can be written on any recordable
	<acronym class="acronym">DVD</acronym> physical media such as DVD-R, DVD+R, or
	<acronym class="acronym">DVD-RW</acronym>.  Before choosing the type of media,
	ensure that both the burner and the DVD-Video player are
	compatible with the media under consideration.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75436856"></a>17.6.1. 設定</h3></div></div></div><p xml:lang="en" lang="en">To perform <acronym class="acronym">DVD</acronym> recording, use
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a>.  This command is part of the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/dvd+rw-tools/pkg-descr">sysutils/dvd+rw-tools</a> utilities which
	support all <acronym class="acronym">DVD</acronym> media types.</p><p xml:lang="en" lang="en">These tools use the <acronym class="acronym">SCSI</acronym> subsystem to
	access the devices, therefore <a class="link" href="#atapicam" title="17.5.1. 支援的裝置">ATAPI/CAM support</a> must be loaded
	or statically compiled into the kernel.  This support is not
	needed if the burner uses the <acronym class="acronym">USB</acronym>
	interface.  Refer to <a class="xref" href="#usb-disks" title="17.4. USB 儲存裝置">節 17.4, “<acronym class="acronym">USB</acronym> 儲存裝置”</a> for more
	details on <acronym class="acronym">USB</acronym> device configuration.</p><p xml:lang="en" lang="en">DMA access must also be enabled for
	<acronym class="acronym">ATAPI</acronym> devices, by adding the following line
	to <code class="filename">/boot/loader.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">hw.ata.atapi_dma="1"</pre><p xml:lang="en" lang="en">Before attempting to use
	<span class="application">dvd+rw-tools</span>, consult the <a class="link" href="http://fy.chalmers.se/~appro/linux/DVD+RW/hcn.html" target="_top">Hardware
	  Compatibility Notes</a>.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">For a graphical user interface, consider using
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/k3b/pkg-descr">sysutils/k3b</a> which provides a user
	  friendly interface to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a> and many other
	  burning tools.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75468600"></a>17.6.2. 燒錄資料 <acronym class="acronym">DVD</acronym></h3></div></div></div><p xml:lang="en" lang="en">Since <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a> is a front-end to <a class="link" href="#mkisofs" title="17.5.3. 寫入資料到一個 ISO 檔案系統">mkisofs</a>, it will invoke
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mkisofs</span>(8)</span></a> to create the file system layout and perform
	the write on the <acronym class="acronym">DVD</acronym>.  This means that an
	image of the data does not need to be created before the
	burning process.</p><p xml:lang="en" lang="en">To burn to a DVD+R or a DVD-R the data in
	<code class="filename">/path/to/data</code>, use the following
	command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -dvd-compat -Z <em class="replaceable"><code>/dev/cd0</code></em> -J -R <em class="replaceable"><code>/path/to/data</code></em></code></strong></pre><p xml:lang="en" lang="en">In this example, <code class="option">-J -R</code> is passed to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mkisofs</span>(8)</span></a>  to create an ISO 9660 file system with Joliet
	and Rock Ridge extensions.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mkisofs</span>(8)</span></a> for more
	details.</p><p xml:lang="en" lang="en">For the initial session recording, <code class="option">-Z</code> is
	used for both single and multiple sessions.  Replace
	<em class="replaceable"><code>/dev/cd0</code></em>, with the name of the
	<acronym class="acronym">DVD</acronym> device.  Using
	<code class="option">-dvd-compat</code> indicates that the disk will be
	closed and that the recording will be unappendable.  This
	should also provide better media compatibility with
	<acronym class="acronym">DVD-ROM</acronym> drives.</p><p xml:lang="en" lang="en">To burn a pre-mastered image, such as
	<em class="replaceable"><code>imagefile.iso</code></em>, use:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -dvd-compat -Z <em class="replaceable"><code>/dev/cd0</code></em>=<em class="replaceable"><code>imagefile.iso</code></em></code></strong></pre><p xml:lang="en" lang="en">The write speed should be detected and automatically set
	according to the media and the drive being used.  To force the
	write speed, use  <code class="option">-speed=</code>.  Refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a> for example usage.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">In order to support working files larger than 4.38GB, an
	  UDF/ISO-9660 hybrid file system must be created by passing
	  <code class="option">-udf -iso-level 3</code> to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mkisofs</span>(8)</span></a> and
	  all related programs, such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a>.  This is
	  required only when creating an ISO image file or when
	  writing files directly to a disk.  Since a disk created this
	  way must be mounted as an UDF file system with
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount_udf&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount_udf</span>(8)</span></a>, it will be usable only on an UDF aware
	  operating system.  Otherwise it will look as if it contains
	  corrupted files.</p><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">To create this type of ISO file:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>mkisofs -R -J -udf -iso-level 3 -o <em class="replaceable"><code>imagefile.iso</code></em> <em class="replaceable"><code>/path/to/data</code></em></code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">To burn files directly to a disk:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -dvd-compat -udf -iso-level 3 -Z <em class="replaceable"><code>/dev/cd0</code></em> -J -R <em class="replaceable"><code>/path/to/data</code></em></code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">When an ISO image already contains large files, no
	  additional options are required for <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a> to
	  burn that image on a disk.</p><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Be sure to use an up-to-date version of
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/cdrtools/pkg-descr">sysutils/cdrtools</a>, which contains
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mkisofs</span>(8)</span></a>, as an older version may not contain large
	  files support.  If the latest version does not work, install
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/cdrtools-devel/pkg-descr">sysutils/cdrtools-devel</a> and read its
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mkisofs</span>(8)</span></a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75514168"></a>17.6.3. 燒錄 <acronym class="acronym">DVD</acronym>-Video</h3></div></div></div><a id="idp75515192" class="indexterm"></a><p xml:lang="en" lang="en">A DVD-Video is a specific file layout based on the ISO
	9660 and micro-UDF (M-UDF) specifications.  Since DVD-Video
	presents a specific data structure hierarchy, a particular
	program such as <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/dvdauthor/pkg-descr">multimedia/dvdauthor</a> is
	needed to author the <acronym class="acronym">DVD</acronym>.</p><p xml:lang="en" lang="en">If an image of the DVD-Video file system already exists,
	it can be burned in the same way as any other image.  If
	<code class="command">dvdauthor</code> was used to make the
	<acronym class="acronym">DVD</acronym> and the result is in
	<code class="filename">/path/to/video</code>, the following command
	should be used to burn the DVD-Video:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -Z <em class="replaceable"><code>/dev/cd0</code></em> -dvd-video <em class="replaceable"><code>/path/to/video</code></em></code></strong></pre><p xml:lang="en" lang="en"><code class="option">-dvd-video</code> is passed to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mkisofs</span>(8)</span></a>
	to instruct it to create a DVD-Video file system layout.
	This option implies the <code class="option">-dvd-compat</code>
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a> option.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75524408"></a>17.6.4. 使用 <acronym class="acronym">DVD+RW</acronym></h3></div></div></div><a id="idp75525304" class="indexterm"></a><p xml:lang="en" lang="en">Unlike CD-RW, a virgin <acronym class="acronym">DVD+RW</acronym> needs to
	be formatted before first use.  It is
	<span class="emphasis"><em>recommended</em></span> to let <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a> take
	care of this automatically whenever appropriate.  However, it
	is possible to use <code class="command">dvd+rw-format</code> to format
	the <acronym class="acronym">DVD+RW</acronym>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>dvd+rw-format <em class="replaceable"><code>/dev/cd0</code></em></code></strong></pre><p xml:lang="en" lang="en">Only perform this operation once and keep in mind that
	only virgin <acronym class="acronym">DVD+RW</acronym> medias need to be
	formatted.  Once formatted, the <acronym class="acronym">DVD+RW</acronym> can
	be burned as usual.</p><p xml:lang="en" lang="en">To burn a totally new file system and not just append some
	data onto a <acronym class="acronym">DVD+RW</acronym>, the media does not need
	to be blanked first.  Instead, write over the previous
	recording like this:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -Z <em class="replaceable"><code>/dev/cd0</code></em> -J -R <em class="replaceable"><code>/path/to/newdata</code></em></code></strong></pre><p xml:lang="en" lang="en">The <acronym class="acronym">DVD+RW</acronym> format supports appending
	data to a previous recording.  This operation consists of
	merging a new session to the existing one as it is not
	considered to be multi-session writing.  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a>
	will <span class="emphasis"><em>grow</em></span> the ISO 9660 file system
	present on the media.</p><p xml:lang="en" lang="en">For example, to append data to a
	<acronym class="acronym">DVD+RW</acronym>, use the following:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -M <em class="replaceable"><code>/dev/cd0</code></em> -J -R <em class="replaceable"><code>/path/to/nextdata</code></em></code></strong></pre><p xml:lang="en" lang="en">The same <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mkisofs</span>(8)</span></a> options used to burn the
	initial session should be used during next writes.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Use <code class="option">-dvd-compat</code> for better media
	  compatibility with <acronym class="acronym">DVD-ROM</acronym> drives.  When
	  using <acronym class="acronym">DVD+RW</acronym>, this option will not
	  prevent the addition of data.</p></div><p xml:lang="en" lang="en">To blank the media, use:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -Z <em class="replaceable"><code>/dev/cd0</code></em>=<em class="replaceable"><code>/dev/zero</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75561784"></a>17.6.5. 使用 <acronym class="acronym">DVD-RW</acronym></h3></div></div></div><a id="idp75562680" class="indexterm"></a><p xml:lang="en" lang="en">A <acronym class="acronym">DVD-RW</acronym> accepts two disc formats:
	incremental sequential and restricted overwrite.  By default,
	<acronym class="acronym">DVD-RW</acronym> discs are in sequential
	format.</p><p xml:lang="en" lang="en">A virgin <acronym class="acronym">DVD-RW</acronym> can be directly written
	without being formatted.  However, a non-virgin
	<acronym class="acronym">DVD-RW</acronym> in sequential format needs to be
	blanked before writing a new initial session.</p><p xml:lang="en" lang="en">To blank a <acronym class="acronym">DVD-RW</acronym> in sequential
	mode:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>dvd+rw-format -blank=full <em class="replaceable"><code>/dev/cd0</code></em></code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">A full blanking using <code class="option">-blank=full</code> will
	  take about one hour on a 1x media.  A fast blanking can be
	  performed using <code class="option">-blank</code>, if the
	  <acronym class="acronym">DVD-RW</acronym> will be recorded in Disk-At-Once
	  (DAO) mode.  To burn the <acronym class="acronym">DVD-RW</acronym> in DAO
	  mode, use the command:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -use-the-force-luke=dao -Z <em class="replaceable"><code>/dev/cd0</code></em>=<em class="replaceable"><code>imagefile.iso</code></em></code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Since <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a> automatically attempts to detect
	  fast blanked media and engage DAO write,
	  <code class="option">-use-the-force-luke=dao</code> should not be
	  required.</p><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">One should instead use restricted overwrite mode with
	  any <acronym class="acronym">DVD-RW</acronym> as this format is more
	  flexible than the default of incremental sequential.</p></div><p xml:lang="en" lang="en">To write data on a sequential <acronym class="acronym">DVD-RW</acronym>,
	use the same instructions as for the other
	<acronym class="acronym">DVD</acronym> formats:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -Z <em class="replaceable"><code>/dev/cd0</code></em> -J -R <em class="replaceable"><code>/path/to/data</code></em></code></strong></pre><p xml:lang="en" lang="en">To append some data to a previous recording, use
	<code class="option">-M</code> with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a>.  However, if data
	is appended on a <acronym class="acronym">DVD-RW</acronym> in incremental
	sequential mode, a new session will be created on the disc and
	the result will be a multi-session disc.</p><p xml:lang="en" lang="en">A <acronym class="acronym">DVD-RW</acronym> in restricted overwrite format
	does not need to be blanked before a new initial session.
	Instead, overwrite the disc with <code class="option">-Z</code>.  It is
	also possible to grow an existing ISO 9660 file system written
	on the disc with <code class="option">-M</code>.  The result will be a
	one-session <acronym class="acronym">DVD</acronym>.</p><p xml:lang="en" lang="en">To put a <acronym class="acronym">DVD-RW</acronym> in restricted overwrite
	format, the following command must be used:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>dvd+rw-format <em class="replaceable"><code>/dev/cd0</code></em></code></strong></pre><p xml:lang="en" lang="en">To change back to sequential format, use:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>dvd+rw-format -blank=full <em class="replaceable"><code>/dev/cd0</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75611832"></a>17.6.6. 多階段燒錄 (Multi-Session)</h3></div></div></div><p xml:lang="en" lang="en">Few <acronym class="acronym">DVD-ROM</acronym> drives support
	multi-session DVDs and most of the time only read the first
	session.  DVD+R, DVD-R and <acronym class="acronym">DVD-RW</acronym> in
	sequential format can accept multiple sessions.  The notion
	of multiple sessions does not exist for the
	<acronym class="acronym">DVD+RW</acronym> and the <acronym class="acronym">DVD-RW</acronym>
	restricted overwrite formats.</p><p xml:lang="en" lang="en">Using the following command after an initial non-closed
	session on a DVD+R, DVD-R, or <acronym class="acronym">DVD-RW</acronym> in
	sequential format, will add a new session to the disc:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -M <em class="replaceable"><code>/dev/cd0</code></em> -J -R <em class="replaceable"><code>/path/to/nextdata</code></em></code></strong></pre><p xml:lang="en" lang="en">Using this command with a <acronym class="acronym">DVD+RW</acronym> or a
	<acronym class="acronym">DVD-RW</acronym> in restricted overwrite mode will
	append data while merging the new session to the existing one.
	The result will be a single-session disc.  Use this method to
	add data after an initial write on these types of
	media.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Since some space on the media is used between each
	  session to mark the end and start of sessions, one should
	  add sessions with a large amount of data to optimize media
	  space.  The number of sessions is limited to 154 for a
	  DVD+R, about 2000 for a DVD-R, and 127 for a DVD+R Double
	  Layer.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75619384"></a>17.6.7. 取得更多資訊</h3></div></div></div><p xml:lang="en" lang="en">To obtain more information about a <acronym class="acronym">DVD</acronym>,
	use <code class="command">dvd+rw-mediainfo
	  <em class="replaceable"><code>/dev/cd0</code></em></code> while the
	disc in the specified drive.</p><p xml:lang="en" lang="en">More information about
	<span class="application">dvd+rw-tools</span> can be found in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a>, on the <a class="link" href="http://fy.chalmers.se/~appro/linux/DVD+RW/" target="_top">dvd+rw-tools
	  web site</a>, and in the <a class="link" href="http://lists.debian.org/cdwrite/" target="_top">cdwrite
	  mailing list</a> archives.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">When creating a problem report related to the use of
	  <span class="application">dvd+rw-tools</span>, always include the
	  output of <code class="command">dvd+rw-mediainfo</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="creating-dvd-ram"></a>17.6.8. 使用 <acronym class="acronym">DVD-RAM</acronym></h3></div></div></div><a id="idp75631288" class="indexterm"></a><p xml:lang="en" lang="en"><acronym class="acronym">DVD-RAM</acronym> writers can use either a
	<acronym class="acronym">SCSI</acronym> or <acronym class="acronym">ATAPI</acronym> interface.
	For <acronym class="acronym">ATAPI</acronym> devices, DMA access has to be
	enabled by adding the following line to
	<code class="filename">/boot/loader.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">hw.ata.atapi_dma="1"</pre><p xml:lang="en" lang="en">A <acronym class="acronym">DVD-RAM</acronym> can be seen as a removable
	hard drive.  Like any other hard drive, the
	<acronym class="acronym">DVD-RAM</acronym> must be formatted before it can be
	used.  In this example, the whole disk space will be formatted
	with a standard UFS2 file system:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=<em class="replaceable"><code>/dev/acd0</code></em> bs=2k count=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -Bw <em class="replaceable"><code>acd0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs <em class="replaceable"><code>/dev/acd0</code></em></code></strong></pre><p xml:lang="en" lang="en">The <acronym class="acronym">DVD</acronym> device,
	<code class="filename">acd0</code>, must be changed according to the
	configuration.</p><p xml:lang="en" lang="en">Once the <acronym class="acronym">DVD-RAM</acronym> has been formatted, it
	can be mounted as a normal hard drive:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount <em class="replaceable"><code>/dev/acd0</code></em> <em class="replaceable"><code>/mnt</code></em></code></strong></pre><p xml:lang="en" lang="en">Once mounted, the <acronym class="acronym">DVD-RAM</acronym> will be both
	readable and writeable.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="floppies"></a>17.7. 建立與使用軟碟</h2></div></div></div><p xml:lang="en" lang="en">This section explains how to format a 3.5 inch floppy disk
      in FreeBSD.</p><div class="procedure"><a id="idp75646904"></a><div class="procedure-title">過程 17.2. Steps to Format a Floppy</div><p xml:lang="en" lang="en">A floppy disk needs to be low-level formatted before it
	can be used.  This is usually done by the vendor, but
	formatting is a good way to check media integrity.  To
	low-level format the floppy disk on FreeBSD, use
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fdformat&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fdformat</span>(1)</span></a>.  When using this utility, make note of any
	error messages, as these can help determine if the disk is
	good or bad.</p><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">To format the floppy, insert a new 3.5 inch floppy disk
	  into the first floppy drive and issue:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>/usr/sbin/fdformat -f 1440 /dev/fd0</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">After low-level formatting the disk, create a disk label
	  as it is needed by the system to determine the size of the
	  disk and its geometry.  The supported geometry values are
	  listed in <code class="filename">/etc/disktab</code>.</p><p xml:lang="en" lang="en">To write the disk label, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>/sbin/bsdlabel -B -w /dev/fd0 fd1440</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">The floppy is now ready to be high-level formatted with
	  a file system.  The floppy's file system can be either UFS
	  or FAT, where FAT is generally a better choice for
	  floppies.</p><p xml:lang="en" lang="en">To format the floppy with FAT, issue:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>/sbin/newfs_msdos /dev/fd0</code></strong></pre></li></ol></div><p xml:lang="en" lang="en">The disk is now ready for use.  To use the floppy, mount it
      with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount_msdosfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount_msdosfs</span>(8)</span></a>.  One can also install and use
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/emulators/mtools/pkg-descr">emulators/mtools</a> from the Ports
      Collection.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="backup-basics"></a>17.8. 備份基礎概念</h2></div></div></div><p>為了要能夠從磁碟故障、意外刪除文件、隨機文件損壞或完全機器毀壞，包含本地備份毀壞進行恢復，執行備份計劃是必要的。</p><p>備份的類型與排程會依情況有所不同，取決於資料的重要性、檔案還原所需的程度以及可接受的停機時間。一些可用來備份的技術有：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>封存整個檔案系統，備份至永久、異地媒體。這可在以上所列的所有問題發生時提供保護，但要還原會較慢且不方便，特別是對於沒有權限的使用者。</p></li><li class="listitem"><p>檔案系統快照 (Snapshot)，對於還原已刪除的檔案或先前版本的檔案非常有用。</p></li><li class="listitem"><p>整個檔案系統或磁碟的複本，使用排程的 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/rsync/pkg-descr">net/rsync</a> 來與網路上的另一個系統同步。</p></li><li class="listitem"><p>硬體或軟體 <acronym class="acronym">RAID</acronym>，來最小化或避免當磁碟故障時的停機時間。</p></li></ul></div><p>通常會混合使用各種備份技術，例如，建立一個排程每週自動做儲存於異地的完整系統備份，並使用每小時的 ZFS 快照來輔助備份。此外，在對檔案做編輯或刪除前手動備份各別目錄或檔案。</p><p>本章節會介紹一些可以用來在 FreeBSD 上建立與管理系統備份的工具。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75669816"></a>17.8.1. 檔案系統備份</h3></div></div></div><a id="idp75670456" class="indexterm"></a><a id="idp75684024" class="indexterm"></a><a id="idp75685048" class="indexterm"></a><p>要備份一個檔案系統，會用到 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> 這個傳統 <span class="trademark">UNIX</span>® 程式來建立備份，並可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=restore&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">restore</span>(8)</span></a> 來還原備份。這兩個工具可在磁碟區塊的層級運作，這個層級比由檔案系統建立檔案、連結與目錄的抽象層級還要低，因此不像其他的備份軟體，<code class="command">dump</code> 必須一次備份整個檔案系統，且無法只備份部份檔案系統或跨多個檔案系統的目錄樹，<code class="command">dump</code> 會備份構成檔案與目錄的原始資料區塊，而非直接備份檔案與目錄。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">在根目錄使用 <code class="command">dump</code>，會無法備份 <code class="filename">/home</code>, <code class="filename">/usr</code> 或其他許多的目錄，由於這些目錄通常是其他檔案系統的掛載點或連結到其他檔案系統的符號連結。</p></div><p>還原資料時，<code class="command">restore</code> 預設會儲存暫存檔案於 <code class="filename">/tmp/</code>，當使用一個 <code class="filename">/tmp</code> 較小的復原磁碟時，請設定 <code class="envar">TMPDIR</code> 到一個擁有較多可用空間的目錄以讓還原可以順利執行。</p><p>當使用 <code class="command">dump</code> 時，請小心最早自 AT&amp;T <span class="trademark">UNIX</span>®,circa 1975 的版本 6 仍有一些問題存在，預設的參數會假設備份到一個 9 軌的磁帶，這並非其他類型的媒體或現今可用的高密度磁帶，必須另外在指令列修改這個預設值。</p><a id="idp75694392" class="indexterm"></a><p>雖然可以使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rdump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rdump</span>(8)</span></a> 與 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rrestore&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rrestore</span>(8)</span></a> 工具可以跨網路備份一個檔案系統到另一個系統或備份到連結另一台電腦的磁帶機，但這使用兩個工具備份的安全性並不足夠。</p><p>可改以在較安全的 <acronym class="acronym">SSH</acronym> 連線上使用 <code class="command">dump</code> 與 <code class="command">restore</code>。以下例子會建立一個完整、壓縮的 <code class="filename">/usr</code> 備份並透過 <acronym class="acronym">SSH</acronym> 連線傳送備份檔案到指定的主機。</p><div class="example"><a id="idp75703736"></a><div class="example-title">範例 17.1. 在 <span class="application">ssh</span> 使用 <code class="command">dump</code></div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>/sbin/dump -0uan -f - /usr | gzip -2 | ssh -c blowfish \
          targetuser@targetmachine.example.com dd of=/mybigfiles/dump-usr-l0.gz</code></strong></pre></div></div><br class="example-break" /><p>這個例子會設定 <code class="envar">RSH</code>，以便透過 <acronym class="acronym">SSH</acronym> 連線寫入備份到遠端系統的磁帶機：</p><div class="example"><a id="idp75719608"></a><div class="example-title">範例 17.2. 在 <span class="application">ssh</span> 使用 <code class="command">dump</code> 透過 <code class="envar">RSH</code> 設定</div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>env RSH=/usr/bin/ssh /sbin/dump -0uan -f targetuser@targetmachine.example.com:/dev/sa0 /usr</code></strong></pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75722680"></a>17.8.2. 目錄備份</h3></div></div></div><a id="idp75723320" class="indexterm"></a><p>系統已有內建數個工具可在需要時用來備份與還原指定的檔案與目錄。</p><p>要備份一個目錄中的所有檔案最好的選擇是 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tar&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tar</span>(1)</span></a>，這個工具最早可以追朔自 AT&amp;T <span class="trademark">UNIX</span>® 版本 6 時，因此預設會做一個遞迴備份到一個磁帶機，可以使用參數來改指定備份檔案的名稱。</p><a id="idp75726776" class="indexterm"></a><p>這個例子會建立目前目錄的壓縮備份並儲存至 <code class="filename">/tmp/mybackup.tgz</code>，在建立備份檔案時，要確認備份檔案不要儲存到與目前備份目錄相同的目錄。</p><div class="example"><a id="idp75728312"></a><div class="example-title">範例 17.3. 使用 <code class="command">tar</code> 備份目前目錄</div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>tar czvf <em class="replaceable"><code>/tmp/mybackup.tgz</code></em> . </code></strong></pre></div></div><br class="example-break" /><p>要還原整個備份，先 <code class="command">cd</code> 進入要放置還原檔的目錄並指定備份的名稱。注意，這個動作會覆寫任何在該還原目錄中任何較新版的檔案，當不確定時，可先還原到一個暫時的目錄或指定備份檔中的檔案做還原。</p><div class="example"><a id="idp75735736"></a><div class="example-title">範例 17.4. 使用 <code class="command">tar</code> 還原目前目錄</div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>tar xzvf <em class="replaceable"><code>/tmp/mybackup.tgz</code></em></code></strong></pre></div></div><br class="example-break" /><p>除此之外還有許多可用的參數在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tar&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tar</span>(1)</span></a> 中會有說明。本工具也支援使用排除模式 (Exclude pattern) 來指定那些檔案應該在備份指定目錄或自備份還原檔案時排除。</p><a id="idp75743416" class="indexterm"></a><p>要使用指定的檔案與目錄清單做備份使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cpio&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cpio</span>(1)</span></a> 是不錯的選擇。它並不像 <code class="command">tar</code>，<code class="command">cpio</code> 並不知道如何走訪目錄樹，所以必須提供檔案的清單才能做備份。</p><p>例如，檔案的清單可以使用 <code class="command">ls</code> 或 <code class="command">find</code> 來產生。以下例子會建立一個目前目錄的遞迴清單然後轉送 (Piped) 給 <code class="command">cpio</code> 來建立名稱為 <code class="filename">/tmp/mybackup.cpio</code> 的備份檔。</p><div class="example"><a id="idp75760952"></a><div class="example-title">範例 17.5. 使用 <code class="command">ls</code> 與 <code class="command">cpio</code> 來製作目前目錄的遞迴備份</div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ls -R | cpio -ovF <em class="replaceable"><code>/tmp/mybackup.cpio</code></em></code></strong></pre></div></div><br class="example-break" /><a id="idp75763768" class="indexterm"></a><a id="idp75765176" class="indexterm"></a><a id="idp75765944" class="indexterm"></a><a id="idp75766584" class="indexterm"></a><p>有一個備份工具嘗試整合 <code class="command">tar</code> 與 <code class="command">cpio</code> 所提供的功能，便是 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pax&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pax</span>(1)</span></a>。經歷數年，各種版本的 <code class="command">tar</code> 與 <code class="command">cpio</code> 變的有一些無法相容。<span class="trademark">POSIX</span>® 開發出 <code class="command">pax</code>，嘗試讀取與寫入各種版本的 <code class="command">cpio</code> and <code class="command">tar</code> 格式並加入自己的新格式。</p><p>以先前的例子改使用 <code class="command">pax</code> 會是：</p><div class="example"><a id="idp75772344"></a><div class="example-title">範例 17.6. 使用 <code class="command">pax</code> 備份目前目錄</div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pax -wf <em class="replaceable"><code>/tmp/mybackup.pax</code></em> .</code></strong></pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="backups-tapebackups"></a>17.8.3. 使用資料磁帶備份</h3></div></div></div><a id="idp75775800" class="indexterm"></a><p>隨著磁帶的技術持續發展，當今的備份系統將異地備份與本地可移除媒體做了結合。FreeBSD 支援任何使用 <acronym class="acronym">SCSI</acronym> 的磁帶機，如 <acronym class="acronym">LTO</acronym> 或 <acronym class="acronym">DAT</acronym>，並有限制的支援 <acronym class="acronym">SATA</acronym> 與 <acronym class="acronym">USB</acronym> 磁帶機。</p><p><acronym class="acronym">SCSI</acronym> 磁帶機在 FreeBSD 會使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sa&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sa</span>(4)</span></a> 驅動程式以及 <code class="filename">/dev/sa0</code>, <code class="filename">/dev/nsa0</code> 與 <code class="filename">/dev/esa0</code> 裝置，實體裝置名稱為 <code class="filename">/dev/sa0</code>，當使用 <code class="filename">/dev/nsa0</code> 時，備份程式在寫入檔案之後不會倒帶，這可允許寫入超過一個檔案到磁帶，而使用 <code class="filename">/dev/esa0</code> 時，當關閉裝置後便會退出磁帶。</p><p>在 FreeBSD 中會使用 <code class="command">mt</code> 來做磁帶機的控制操作，例如在磁帶中搜尋檔案或寫入磁帶控制記號到磁帶。例如，要保留磁帶上的前三個檔案，可以在寫入新檔案前跳過這些檔案：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mt -f /dev/nsa0 fsf 3</code></strong></pre><p>這個工具尚支援許多操作，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mt&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mt</span>(1)</span></a> 了解詳情。</p><p>要使用 <code class="command">tar</code> 寫入單一檔案到磁帶，可指定磁帶裝置的名稱以及要備份的檔案：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>tar cvf /dev/sa0 <em class="replaceable"><code>file</code></em></code></strong></pre><p>要從磁帶上的 <code class="command">tar</code> 封存檔還原檔案到目前的目錄可：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>tar xvf /dev/sa0</code></strong></pre><p>要備份一個 <acronym class="acronym">UFS</acronym> 檔案系統可使用 <code class="command">dump</code>。以下例子會備份 <code class="filename">/usr</code> 並在完成時不做倒帶：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>dump -0aL -b64 -f /dev/nsa0 /usr</code></strong></pre><p>要以互動的方式從磁帶上的 <code class="command">dump</code> 檔案還原到目前目錄：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>restore -i -f /dev/nsa0</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="backups-programs-amanda"></a>17.8.4. 第三方備份工具</h3></div></div></div><a id="idp75798584" class="indexterm"></a><p>FreeBSD Port 套件集提供了許多第三方工具可用於排程建立備份，簡化磁帶備份並讓備份更簡單方便。許多這類的應用程式是以客戶端/伺服器為基礎，可用來自動化單一系統或網路上所有電腦的備份。</p><p>較熱門的工具包含 <span class="application">Amanda</span>, <span class="application">Bacula</span>, <span class="application">rsync</span> 以及 <span class="application">duplicity</span>。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75801912"></a>17.8.5. 緊急還原</h3></div></div></div><p>除了正常的備份外，建議將下以步驟做為緊急準備計劃的一部份。</p><a id="idp75827512" class="indexterm"></a><p>替以下指令的輸出建立一份可列印的複本：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><code class="command">gpart show</code></p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="command">more /etc/fstab</code></p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="command">dmesg</code></p></li></ul></div><a id="idp75832248" class="indexterm"></a><p>在安全的地方保存這份列印結果與安裝媒體的複本，在緊急還原時可能會需要，接著開機進入安裝媒體並選擇 <code class="literal">Live CD</code> 以存取救援 Shell (Rescue shell)，這個救援模式可以用來檢視目前系統的狀態，若有需要，可重新格式化磁碟然後自備份還原資料。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">FreeBSD/i386 11.2-RELEASE 的安裝媒體未內含救援 Shell，針對該版本，可改自 <code class="uri"><a class="uri" href="ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/ISO-IMAGES/11.2/FreeBSD-11.2-RELEASE-i386-livefs.iso" target="_top">ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/ISO-IMAGES/11.2/FreeBSD-11.2-RELEASE-i386-livefs.iso</a></code> 下載 Livefs <acronym class="acronym">CD</acronym> 映像檔並燒錄。</p></div><p>然後，測試救援 Shell 下的備份。記錄下整個程序，將這份記錄隨媒體、列印結果、備份檔一併保存，這份記錄可以避免在緊張壓力下做緊急還原時因不慎造成備份的毀壞。</p><p>要再安全性一點，則可將最新的備份儲存在與實體電腦與磁碟機有一段明顯距離的遠端位置。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-virtual"></a>17.9. 記憶體磁碟</h2></div><div><span class="authorgroup">Reorganized and enhanced by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><p xml:lang="en" lang="en">In addition to physical disks, FreeBSD also supports the
      creation and use of memory disks.  One possible use for a
      memory disk is to access the contents of an
      <acronym class="acronym">ISO</acronym> file system without the overhead of first
      burning it to a <acronym class="acronym">CD</acronym> or <acronym class="acronym">DVD</acronym>,
      then mounting the <acronym class="acronym">CD/DVD</acronym> media.</p><p xml:lang="en" lang="en">In FreeBSD, the  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a> driver is used to provide support
      for memory disks.  The <code class="filename">GENERIC</code> kernel
      includes this driver.  When using a custom kernel configuration
      file, ensure it includes this line:</p><pre xml:lang="en" class="programlisting" lang="en">device md</pre><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks-mdconfig"></a>17.9.1. 連接與解除連接既有的映象檔</h3></div></div></div><a id="idp75861816" class="indexterm"></a><p xml:lang="en" lang="en">To mount an existing file system image, use
	<code class="command">mdconfig</code> to specify the name of the
	<acronym class="acronym">ISO</acronym> file and a free unit number.  Then,
	refer to that unit number to mount it on an existing mount
	point.  Once mounted, the files in the <acronym class="acronym">ISO</acronym>
	will appear in the mount point.  This example attaches
	<em class="replaceable"><code>diskimage.iso</code></em> to the memory device
	<code class="filename">/dev/md0</code> then mounts that memory device
	on <code class="filename">/mnt</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mdconfig -f <em class="replaceable"><code>diskimage.iso</code></em> -u <em class="replaceable"><code>0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -t cd9660 /dev/md<em class="replaceable"><code>0</code></em> <em class="replaceable"><code>/mnt</code></em></code></strong></pre><p xml:lang="en" lang="en">Notice that <code class="option">-t cd9660</code> was used to mount
	an ISO format.  If a unit number is not specified with
	<code class="option">-u</code>, <code class="command">mdconfig</code> will
	automatically allocate an unused memory device and output
	the name of the allocated unit, such as
	<code class="filename">md4</code>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a> for more
	details about this command and its options.</p><a id="idp75871800" class="indexterm"></a><p xml:lang="en" lang="en">When a memory disk is no longer in use, its resources
	should be released back to the system.  First, unmount the
	file system, then use <code class="command">mdconfig</code> to detach
	the disk from the system and release its resources.  To
	continue this example:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>umount /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mdconfig -d -u <em class="replaceable"><code>0</code></em></code></strong></pre><p xml:lang="en" lang="en">To determine if any memory disks are still attached to the
	system, type <code class="command">mdconfig -l</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks-md-freebsd5"></a>17.9.2. 建立以檔案或記憶體為基底的磁碟</h3></div></div></div><a id="idp75877816" class="indexterm"></a><p xml:lang="en" lang="en">FreeBSD also supports memory disks where the storage to use
	is allocated from either a hard disk or an area of memory.
	The first method is commonly referred to as a file-backed file
	system and the second method as a memory-backed file system.
	Both types can be created using
	<code class="command">mdconfig</code>.</p><p xml:lang="en" lang="en">To create a new memory-backed file system, specify a type
	of <code class="literal">swap</code> and the size of the memory disk to
	create.  Then, format the memory disk with a file system and
	mount as usual.  This example creates a 5M memory disk on unit
	<code class="literal">1</code>.  That memory disk is then formatted with
	the <acronym class="acronym">UFS</acronym> file system before it is
	mounted:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mdconfig -a -t swap -s <em class="replaceable"><code>5</code></em>m -u <em class="replaceable"><code>1</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U md<em class="replaceable"><code>1</code></em></code></strong>
/dev/md1: 5.0MB (10240 sectors) block size 16384, fragment size 2048
        using 4 cylinder groups of 1.27MB, 81 blks, 192 inodes.
        with soft updates
super-block backups (for fsck -b #) at:
 160, 2752, 5344, 7936
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/md<em class="replaceable"><code>1</code></em> <em class="replaceable"><code>/mnt</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df <em class="replaceable"><code>/mnt</code></em></code></strong>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md1        4718    4  4338     0%    /mnt</pre><p xml:lang="en" lang="en">To create a new file-backed memory disk, first allocate an
	area of disk to use.  This example creates an empty 5MB file
	named <code class="filename">newimage</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=<em class="replaceable"><code>newimage</code></em> bs=1k count=<em class="replaceable"><code>5</code></em>k</code></strong>
5120+0 records in
5120+0 records out</pre><p xml:lang="en" lang="en">Next, attach that file to a memory disk, label the memory
	disk and format it with the <acronym class="acronym">UFS</acronym> file
	system, mount the memory disk, and verify the size of the
	file-backed disk:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mdconfig -f <em class="replaceable"><code>newimage</code></em> -u <em class="replaceable"><code>0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -w md<em class="replaceable"><code>0</code></em> auto</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U md<em class="replaceable"><code>0</code></em>a</code></strong>
/dev/md0a: 5.0MB (10224 sectors) block size 16384, fragment size 2048
        using 4 cylinder groups of 1.25MB, 80 blks, 192 inodes.
super-block backups (for fsck -b #) at:
 160, 2720, 5280, 7840
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/md<em class="replaceable"><code>0</code></em>a <em class="replaceable"><code>/mnt</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df <em class="replaceable"><code>/mnt</code></em></code></strong>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md0a       4710    4  4330     0%    /mnt</pre><p xml:lang="en" lang="en">It takes several commands to create a file- or
	memory-backed file system using <code class="command">mdconfig</code>.
	FreeBSD also comes with <code class="command">mdmfs</code> which
	automatically configures a memory disk, formats it with the
	<acronym class="acronym">UFS</acronym> file system, and mounts it.  For
	example, after creating <em class="replaceable"><code>newimage</code></em>
	with <code class="command">dd</code>, this one command is equivalent to
	running the <code class="command">bsdlabel</code>,
	<code class="command">newfs</code>, and <code class="command">mount</code>
	commands shown above:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mdmfs -F <em class="replaceable"><code>newimage</code></em> -s <em class="replaceable"><code>5</code></em>m md<em class="replaceable"><code>0</code></em> <em class="replaceable"><code>/mnt</code></em></code></strong></pre><p xml:lang="en" lang="en">To instead create a new memory-based memory disk with
	<code class="command">mdmfs</code>, use this one command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mdmfs -s <em class="replaceable"><code>5</code></em>m md<em class="replaceable"><code>1</code></em> <em class="replaceable"><code>/mnt</code></em></code></strong></pre><p xml:lang="en" lang="en">If the unit number is not specified,
	<code class="command">mdmfs</code> will automatically select an unused
	memory device.  For more details about
	<code class="command">mdmfs</code>, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mdmfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mdmfs</span>(8)</span></a>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="snapshots"></a>17.10. 檔案系統快照</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp75932472" class="indexterm"></a><p xml:lang="en" lang="en">FreeBSD offers a feature in conjunction with
      <a class="link" href="#soft-updates" title="11.10.2. 軟更新">Soft Updates</a>: file system
      snapshots.</p><p xml:lang="en" lang="en">UFS snapshots allow a user to create images of specified
      file systems, and treat them as a file.  Snapshot files must be
      created in the file system that the action is performed on, and
      a user may create no more than 20 snapshots per file system.
      Active snapshots are recorded in the superblock so they are
      persistent across unmount and remount operations along with
      system reboots.  When a snapshot is no longer required, it can
      be removed using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rm&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rm</span>(1)</span></a>.  While snapshots may be removed in
      any order, all the used space may not be acquired because
      another snapshot will possibly claim some of the released
      blocks.</p><p xml:lang="en" lang="en">The un-alterable <code class="option">snapshot</code> file flag is set
      by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mksnap_ffs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mksnap_ffs</span>(8)</span></a> after initial creation of a snapshot file.
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=unlink&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">unlink</span>(1)</span></a> makes an exception for snapshot files since it
      allows them to be removed.</p><p xml:lang="en" lang="en">Snapshots are created using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a>.  To place a
      snapshot of <code class="filename">/var</code> in the
      file <code class="filename">/var/snapshot/snap</code>, use the following
      command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount -u -o snapshot /var/snapshot/snap /var</code></strong></pre><p xml:lang="en" lang="en">Alternatively, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mksnap_ffs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mksnap_ffs</span>(8)</span></a> to create the
      snapshot:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mksnap_ffs /var /var/snapshot/snap</code></strong></pre><p xml:lang="en" lang="en">One can find snapshot files on a file system, such as
      <code class="filename">/var</code>, using
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=find&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">find</span>(1)</span></a>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>find /var -flags snapshot</code></strong></pre><p xml:lang="en" lang="en">Once a snapshot has been created, it has several
      uses:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Some administrators will use a snapshot file for backup
	  purposes, because the snapshot can be transferred to
	  <acronym class="acronym">CD</acronym>s or tape.</p></li><li class="listitem"><p xml:lang="en" lang="en">The file system integrity checker, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a>, may be
	  run on the snapshot.  Assuming that the file system was
	  clean when it was mounted, this should always provide a
	  clean and unchanging result.</p></li><li class="listitem"><p xml:lang="en" lang="en">Running <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> on the snapshot will produce a dump
	  file that is consistent with the file system and the
	  timestamp of the snapshot.  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> can also take a
	  snapshot, create a dump image, and then remove the snapshot
	  in one command by using <code class="option">-L</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en">The snapshot can be mounted as a frozen image of the
	  file system.  To <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> the snapshot
	  <code class="filename">/var/snapshot/snap</code> run:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mdconfig -a -t vnode -o readonly -f /var/snapshot/snap -u 4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -r /dev/md4 /mnt</code></strong></pre></li></ul></div><p xml:lang="en" lang="en">The frozen <code class="filename">/var</code> is now available
      through <code class="filename">/mnt</code>.  Everything will initially be
      in the same state it was during the snapshot creation time.  The
      only exception is that any earlier snapshots will appear as zero
      length files.  To unmount the snapshot, use:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>umount /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mdconfig -d -u 4</code></strong></pre><p xml:lang="en" lang="en">For more information about <code class="option">softupdates</code> and
      file system snapshots, including technical papers, visit
      Marshall Kirk McKusick's website at <code class="uri"><a class="uri" href="http://www.mckusick.com/" target="_top">http://www.mckusick.com/</a></code>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="quotas"></a>17.11. 磁碟配額</h2></div></div></div><a id="idp75987256" class="indexterm"></a><a id="idp75988536" class="indexterm"></a><p>磁碟配額可以用來限制使用者或群組成員能夠在各別檔案系統上使用的磁碟空間量或檔案數量。這個可避免一個使用者或群組成員耗盡所有磁碟的可用空間。</p><p>本節將說明如何設定 <acronym class="acronym">UFS</acronym> 檔案系統的磁碟配額。要在 <acronym class="acronym">ZFS</acronym> 檔案系統上設定配額，請參考 <a class="xref" href="#zfs-zfs-quota" title="19.4.8. 資料集、使用者以及群組配額">節 19.4.8, “資料集、使用者以及群組配額”</a></p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75990968"></a>17.11.1. 開啟磁碟配額</h3></div></div></div><p>查看 FreeBSD 核心是否支援磁碟配額：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>sysctl kern.features.ufs_quota</code></strong>
kern.features.ufs_quota: 1</pre><p>在本例中，數值 <code class="literal">1</code> 代表支援磁碟配額，若為 <code class="literal">0</code>，則需加入下列設定到自訂核心設定檔然後依照 <a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a> 的指示重新編譯核心：</p><pre xml:lang="en" class="programlisting" lang="en">options QUOTA</pre><p>接著，在 <code class="filename">/etc/rc.conf</code> 開啟磁碟配額：</p><pre xml:lang="en" class="programlisting" lang="en">quota_enable="YES"</pre><a id="idp76000568" class="indexterm"></a><p>正常在開機時，會使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=quotacheck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">quotacheck</span>(8)</span></a> 檢查每個檔案系統的配額完整性，這個程式會確保在配額資料庫中的資料正確的反映了檔案系統上的資料。這是一個耗費時間的程序，會明顯的影響系統開機的時間，要跳過這個步驟可以加入此變數到 <code class="filename">/etc/rc.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">check_quotas="NO"</pre><p>最後，編輯 <code class="filename">/etc/fstab</code> 來開啟在各個檔案系統上的磁碟配額。要開啟在檔案系統上對每個使用者的配額要加入 <code class="option">userquota</code> 選項到  <code class="filename">/etc/fstab</code> 要開啟配額的檔案系統的項目中。例如：</p><pre xml:lang="en" class="programlisting" lang="en">/dev/da1s2g   /home    ufs rw,userquota 1 2</pre><p>要開啟群組配額，則使用 <code class="option">groupquota</code>。要同時開啟使用者及群組配額，可使用逗號隔開選項：</p><pre xml:lang="en" class="programlisting" lang="en">/dev/da1s2g    /home    ufs rw,userquota,groupquota 1 2</pre><p>預設配額檔案會儲存在檔案系統的根目錄的 <code class="filename">quota.user</code> 及 <code class="filename">quota.group</code>，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a> 來取得更多資訊，較不建議指定其他位置來儲存配額檔案。</p><p>設定完成之後，重新啟動系統，<code class="filename">/etc/rc</code> 會自動執行適當的指令對所有在 <code class="filename">/etc/fstab</code> 中開啟配磁的檔案系統建立初始的配額檔。</p><p>在一般的操作中，並不需要手動執行 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=quotacheck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">quotacheck</span>(8)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=quotaon&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">quotaon</span>(8)</span></a> 或是 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=quotaoff&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">quotaoff</span>(8)</span></a>，雖然如此，仍應閱讀這些指令的操作手冊來熟悉這些指令的操作。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76013240"></a>17.11.2. 設定配額限制</h3></div></div></div><a id="idp76013880" class="indexterm"></a><p>要確認配額已經開啟，可執行：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>quota -v</code></strong></pre><p>每個有開啟配額的檔案系統應該會有一行磁碟用量及目前配額限制的摘要。</p><p>現在系統已準備好可以使用 <code class="command">edquota</code> 分配配額限制。</p><p>有數個選項可以強制限制使用者或群組對磁碟空間的使用量以及可以建立多少檔案。可以用磁碟空間 (block 配額)，檔案數量 (inode 配額) 或同時使用來分配。每種限制又可進一步細分為兩個類型：硬性 (Hard) 及軟性 (Soft) 限制。</p><a id="idp76022200" class="indexterm"></a><p>硬性限制無法被超額使用。一旦使用者超出了硬性限制，該使用者在該檔案系統將無法再使用任何空間。舉例來說，若一個使用者在一個檔案系統上有 500 KB 的硬性限制，且目前已經使用了  490 KB，該使用者只能再使用 10 KB 的空間，若嘗試使用 11 KB 的空間將會失敗。</p><a id="idp76023224" class="indexterm"></a><p>軟性限制在有限的時間內可以被超額使用，即為寬限期 (Grace period)，預設為一週。若一個使用者超出限制並超過寬限期，則軟性限制將轉為硬性限制並且將不允許再使用空間。當使用者使用的空間回到低於軟性限制內，寬限期就會被重置。</p><p>在下面的例子中，會編輯 <code class="systemitem">test</code> 的配額。當執行 <code class="command">edquota</code> 時，將會使用 <code class="envar">EDITOR</code> 指定的編輯器來編輯配額限制。預設的編輯器為 <span class="application">vi</span>。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>edquota -u test</code></strong>
Quotas for user test:
/usr: kbytes in use: 65, limits (soft = 50, hard = 75)
        inodes in use: 7, limits (soft = 50, hard = 60)
/usr/var: kbytes in use: 0, limits (soft = 50, hard = 75)
        inodes in use: 0, limits (soft = 50, hard = 60)</pre><p>正常每個開啟配額的檔案系統會有兩行需要設定，一行代表區塊限制 (Block limit) 而另一行代表節點限制 (inode limit)，更改行內的值來修改配額限制。舉例來說，要在 <code class="filename">/usr</code> 提高區塊的軟性限制到 <code class="literal">500</code> 以及硬性限制到 <code class="literal">600</code>，可更改行內的值如下：</p><pre xml:lang="en" class="programlisting" lang="en">/usr: kbytes in use: 65, limits (soft = 500, hard = 600)</pre><p>新的配額限制將在離開編輯器後生效。</p><p>有時會想要針對一群使用者設定配額限，這時可以透過指定想要的配額給第一個使用者，若然後使用 <code class="option">-p</code> 來複製配額到指定範圍的使用者 ID  (<acronym class="acronym">UID</acronym>)。以下指定將複製配額限制給 <acronym class="acronym">UID</acronym> <code class="literal">10,000</code> 到 <code class="literal">19,999</code> 的使用者：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>edquota -p test 10000-19999</code></strong></pre><p>要取得更多資訊，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a>。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76034488"></a>17.11.3. 檢查配額限制與磁碟使用狀況</h3></div></div></div><a id="idp76035128" class="indexterm"></a><p>要檢查各別使用者或群組的配額與磁碟用量可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=quota&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">quota</span>(1)</span></a>。使用者僅可查看自己的配額以及所屬群組的配額，只有使超級使用者可以檢視所有使用者及群組的配額。要取得某個有開啟配額的檔案系統的所有配額及磁碟用量摘要，可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=repquota&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">repquota</span>(8)</span></a>。</p><p>正常情況，使用者未使用任何磁碟空間的檔案系統並不會顯示在 <code class="command">quota</code> 的輸出結果中，即使該使用者有在該檔案系統設定配額限制，使用 <code class="option">-v</code> 可以顯示這些檔案系統。以下是使用使用 <code class="command">quota -v</code> 查詢某個使用者在兩個檔案系統上的配額限制的範例輸出。</p><pre xml:lang="en" class="programlisting" lang="en">Disk quotas for user test (uid 1002):
     Filesystem  usage    quota   limit   grace   files   quota   limit   grace
           /usr      65*     50      75   5days       7      50      60
       /usr/var       0      50      75               0      50      60</pre><a id="idp76048696" class="indexterm"></a><p>在這個例子當中，使用者在 <code class="filename">/usr</code> 的軟性限制 50 KB 已經超出了 15 KB 並已經過了 5 天寬限期。星號 <code class="literal">*</code> 代表該使用者目前已超出配額限制。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76050616"></a>17.11.4. NFS 上的配額</h3></div></div></div><a id="idp76051256" class="indexterm"></a><p>在 <acronym class="acronym">NFS</acronym> 伺服器上，配額會由配額子系統強制執行，<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rpc.rquotad&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rpc.rquotad</span>(8)</span></a> Daemon 會提供配額資訊給 <acronym class="acronym">NFS</acronym> 客戶端的 <code class="command">quota</code>，讓在那些主機的使用者可以查看它們的配額統計資訊。</p><p>在 <acronym class="acronym">NFS</acronym> 伺服器上將 <code class="filename">/etc/inetd.conf</code> 中 <code class="command">rpc.rquotad</code> 行前的 <code class="literal">#</code> 移除來開啟：</p><pre xml:lang="en" class="programlisting" lang="en">rquotad/1      dgram rpc/udp wait root /usr/libexec/rpc.rquotad rpc.rquotad</pre><p>然後重新啟動 <code class="command">inetd</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service inetd restart</code></strong></pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-encrypting"></a>17.12. 磁碟分割區加密</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Lucky</span> <span class="surname">Green</span></span>. </span></div></div></div><a id="idp76080056" class="indexterm"></a><p xml:lang="en" lang="en">FreeBSD offers excellent online protections against
      unauthorized data access.  File permissions and <a class="link" href="#mac" title="章 15. 強制存取控制 (MAC)">Mandatory Access Control</a> (MAC) help
      prevent unauthorized users from accessing data while the
      operating system is active and the computer is powered up.
      However, the permissions enforced by the operating system are
      irrelevant if an attacker has physical access to a computer and
      can move the computer's hard drive to another system to copy and
      analyze the data.</p><p xml:lang="en" lang="en">Regardless of how an attacker may have come into possession
      of a hard drive or powered-down computer, the
      <acronym class="acronym">GEOM</acronym>-based cryptographic subsystems built
      into FreeBSD are able to protect the data on the computer's file
      systems against even highly-motivated attackers with significant
      resources.  Unlike encryption methods that encrypt individual
      files, the built-in <code class="command">gbde</code> and
      <code class="command">geli</code> utilities can be used to transparently
      encrypt entire file systems.  No cleartext ever touches the hard
      drive's platter.</p><p xml:lang="en" lang="en">This chapter demonstrates how to create an encrypted file
      system on FreeBSD.  It first demonstrates the process using
      <code class="command">gbde</code> and then demonstrates the same example
      using <code class="command">geli</code>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76085432"></a>17.12.1. 使用 <span class="application">gbde</span> 做磁碟加密</h3></div></div></div><p xml:lang="en" lang="en">The objective of the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gbde</span>(4)</span></a> facility is to provide a
	formidable challenge for an attacker to gain access to the
	contents of a <span class="emphasis"><em>cold</em></span> storage device.
	However, if the computer is compromised while up and running
	and the storage device is actively attached, or the attacker
	has access to a valid passphrase, it offers no protection to
	the contents of the storage device.  Thus, it is important to
	provide physical security while the system is running and to
	protect the passphrase used by the encryption
	mechanism.</p><p xml:lang="en" lang="en">This facility provides several barriers to protect the
	data stored in each disk sector.  It encrypts the contents of
	a disk sector using 128-bit <acronym class="acronym">AES</acronym> in
	<acronym class="acronym">CBC</acronym> mode.  Each sector on the disk is
	encrypted with a different <acronym class="acronym">AES</acronym> key.  For
	more information on the cryptographic design, including how
	the sector keys are derived from the user-supplied passphrase,
	refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gbde</span>(4)</span></a>.</p><p xml:lang="en" lang="en">FreeBSD provides a kernel module for
	<span class="application">gbde</span> which can be loaded with this
	command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload geom_bde</code></strong></pre><p xml:lang="en" lang="en">If using a custom kernel configuration file, ensure it
	contains this line:</p><p xml:lang="en" lang="en"><code class="literal">options GEOM_BDE</code></p><p xml:lang="en" lang="en">The following example demonstrates adding a new hard drive
	to a system that will hold a single encrypted partition that
	will be mounted as <code class="filename">/private</code>.</p><div class="procedure"><a id="idp76094520"></a><div class="procedure-title">過程 17.3. Encrypting a Partition with
	  <span class="application">gbde</span></div><ol class="procedure" type="1"><li class="step"><p xml:lang="en" class="title" lang="en"><strong>Add the New Hard Drive</strong></p><p xml:lang="en" lang="en">Install the new drive to the system as explained in
	    <a class="xref" href="#disks-adding" title="17.2. 加入磁碟">節 17.2, “加入磁碟”</a>.  For the purposes of this
	    example, a new hard drive partition has been added as
	    <code class="filename">/dev/ad4s1c</code> and
	    <code class="filename">/dev/ad0s1<em class="replaceable"><code>*</code></em></code>
	    represents the existing standard FreeBSD partitions.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ls /dev/ad*</code></strong>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4</pre></li><li class="step"><p xml:lang="en" class="title" lang="en"><strong>Create a Directory to Hold <code class="command">gbde</code>
	    Lock Files</strong></p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /etc/gbde</code></strong></pre><p xml:lang="en" lang="en">The <span class="application">gbde</span> lock file
	    contains information that <span class="application">gbde</span>
	    requires to access encrypted partitions.  Without access
	    to the lock file, <span class="application">gbde</span> will not
	    be able to decrypt the data contained in the encrypted
	    partition without significant manual intervention which is
	    not supported by the software.  Each encrypted partition
	    uses a separate lock file.</p></li><li class="step"><p xml:lang="en" class="title" lang="en"><strong>Initialize the <code class="command">gbde</code>
	    Partition</strong></p><p xml:lang="en" lang="en">A <span class="application">gbde</span> partition must be
	    initialized before it can be used.  This initialization
	    needs to be performed only once.  This command will open
	    the default editor, in order to set various configuration
	    options in a template.  For use with the
	    <acronym class="acronym">UFS</acronym> file system, set the sector_size to
	    2048:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gbde init /dev/ad4s1c -i -L /etc/gbde/ad4s1c.lock</code></strong>
# <span class="phrase">$FreeBSD: src/sbin/gbde/template.txt,v 1.1.36.1 2009/08/03 08:13:06 kensmith Exp $</span>
#
# Sector size is the smallest unit of data which can be read or written.
# Making it too small decreases performance and decreases available space.
# Making it too large may prevent filesystems from working.  512 is the
# minimum and always safe.  For UFS, use the fragment size
#
sector_size	=	2048
[...]</pre><p xml:lang="en" lang="en">Once the edit is saved, the user will be asked twice
	    to type the passphrase used to secure the data.  The
	    passphrase must be the same both times.  The ability of
	    <span class="application">gbde</span> to protect data depends
	    entirely on the quality of the passphrase.  For tips on
	    how to select a secure passphrase that is easy to
	    remember, see <a class="link" href="http://world.std.com/~reinhold/diceware.html" target="_top">http://world.std.com/~reinhold/diceware.htm</a>.</p><p xml:lang="en" lang="en">This initialization creates a lock file for the
	    <span class="application">gbde</span> partition.  In this
	    example, it is stored as
	    <code class="filename">/etc/gbde/ad4s1c.lock</code>.  Lock files
	    must end in <span class="quote">“<span class="quote">.lock</span>”</span> in order to be correctly
	    detected by the <code class="filename">/etc/rc.d/gbde</code> start
	    up script.</p><div xmlns="" class="caution"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Lock files <span class="emphasis"><em>must</em></span> be backed up
	      together with the contents of any encrypted partitions.
	      Without the lock file, the legitimate owner will be
	      unable to access the data on the encrypted
	      partition.</p></div></li><li class="step"><p xml:lang="en" class="title" lang="en"><strong>Attach the Encrypted Partition to the
	    Kernel</strong></p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c.lock</code></strong></pre><p xml:lang="en" lang="en">This command will prompt to input the passphrase that
	    was selected during the initialization of the encrypted
	    partition.  The new encrypted device will appear in
	    <code class="filename">/dev</code> as
	    <code class="filename">/dev/device_name.bde</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ls /dev/ad*</code></strong>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4        /dev/ad4s1c.bde</pre></li><li class="step"><p xml:lang="en" class="title" lang="en"><strong>Create a File System on the Encrypted
	    Device</strong></p><p xml:lang="en" lang="en">Once the encrypted device has been attached to the
	    kernel, a file system can be created on the device.  This
	    example creates a <acronym class="acronym">UFS</acronym> file system with
	    soft updates enabled.  Be sure to specify the partition
	    which has a
	    <code class="filename"><em class="replaceable"><code>*</code></em>.bde</code>
	    extension:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/ad4s1c.bde</code></strong></pre></li><li class="step"><p xml:lang="en" class="title" lang="en"><strong>Mount the Encrypted Partition</strong></p><p xml:lang="en" lang="en">Create a mount point and mount the encrypted file
	    system:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /private</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/ad4s1c.bde /private</code></strong></pre></li><li class="step"><p xml:lang="en" class="title" lang="en"><strong>Verify That the Encrypted File System is
	    Available</strong></p><p xml:lang="en" lang="en">The encrypted file system should now be visible and
	    available for use:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>df -H</code></strong>
Filesystem        Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a      1037M    72M   883M     8%    /
/devfs            1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f       8.1G    55K   7.5G     0%    /home
/dev/ad0s1e      1037M   1.1M   953M     0%    /tmp
/dev/ad0s1d       6.1G   1.9G   3.7G    35%    /usr
/dev/ad4s1c.bde   150G   4.1K   138G     0%    /private</pre></li></ol></div><p xml:lang="en" lang="en">After each boot, any encrypted file systems must be
	manually re-attached to the kernel, checked for errors, and
	mounted, before the file systems can be used.  To configure
	these steps, add the following lines to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">gbde_autoattach_all="YES"
gbde_devices="<em class="replaceable"><code>ad4s1c</code></em>"
gbde_lockdir="/etc/gbde"</pre><p xml:lang="en" lang="en">This requires that the passphrase be entered at the
	console at boot time.  After typing the correct passphrase,
	the encrypted partition will be mounted automatically.
	Additional <span class="application">gbde</span> boot options are
	available and listed in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><span class="application">sysinstall</span> is incompatible
	  with <span class="application">gbde</span>-encrypted devices.  All
	  <code class="filename">*.bde</code> devices must be detached from the
	  kernel before starting <span class="application">sysinstall</span>
	  or it will crash during its initial probing for devices.  To
	  detach the encrypted device used in the example, use the
	  following command:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gbde detach /dev/<em class="replaceable"><code>ad4s1c</code></em></code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks-encrypting-geli"></a>17.12.2. 使用 <code class="command">geli</code> 做磁碟加密</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Daniel</span> <span class="surname">Gerzo</span></span>. </span></div></div></div><p xml:lang="en" lang="en">An alternative cryptographic <acronym class="acronym">GEOM</acronym> class
	is available using <code class="command">geli</code>.  This control
	utility adds some features and uses a different scheme for
	doing cryptographic work.  It provides the following
	features:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Utilizes the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=crypto&amp;sektion=9&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">crypto</span>(9)</span></a> framework and
	    automatically uses cryptographic hardware when it is
	    available.</p></li><li class="listitem"><p xml:lang="en" lang="en">Supports multiple cryptographic algorithms such as
	    <acronym class="acronym">AES</acronym>, Blowfish, and
	    <acronym class="acronym">3DES</acronym>.</p></li><li class="listitem"><p xml:lang="en" lang="en">Allows the root partition to be encrypted.  The
	    passphrase used to access the encrypted root partition
	    will be requested during system boot.</p></li><li class="listitem"><p xml:lang="en" lang="en">Allows the use of two independent keys.</p></li><li class="listitem"><p xml:lang="en" lang="en">It is fast as it performs simple sector-to-sector
	    encryption.</p></li><li class="listitem"><p xml:lang="en" lang="en">Allows backup and restore of master keys.  If a user
	    destroys their keys, it is still possible to get access to
	    the data by restoring keys from the backup.</p></li><li class="listitem"><p xml:lang="en" lang="en">Allows a disk to attach with a random, one-time key
	    which is useful for swap partitions and temporary file
	    systems.</p></li></ul></div><p xml:lang="en" lang="en">More features and usage examples can be found in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a>.</p><p xml:lang="en" lang="en">The following example describes how to generate a key file
	which will be used as part of the master key for the encrypted
	provider mounted under <code class="filename">/private</code>.  The key
	file will provide some random data used to encrypt the master
	key.  The master key will also be protected by a passphrase.
	The provider's sector size will be 4kB.  The example describes
	how to attach to the <code class="command">geli</code> provider, create
	a file system on it, mount it, work with it, and finally, how
	to detach it.</p><div class="procedure"><a id="idp76178360"></a><div class="procedure-title">過程 17.4. Encrypting a Partition with
	  <code class="command">geli</code></div><ol class="procedure" type="1"><li class="step"><p xml:lang="en" class="title" lang="en"><strong>Load <code class="command">geli</code> Support</strong></p><p xml:lang="en" lang="en">Support for <code class="command">geli</code> is available as a
	    loadable kernel module.  To configure the system to
	    automatically load the module at boot time, add the
	    following line to
	    <code class="filename">/boot/loader.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">geom_eli_load="YES"</pre><p xml:lang="en" lang="en">To load the kernel module now:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload geom_eli</code></strong></pre><p xml:lang="en" lang="en">For a custom kernel, ensure the kernel configuration
	    file contains these lines:</p><pre xml:lang="en" class="programlisting" lang="en">options GEOM_ELI
device crypto</pre></li><li class="step"><p xml:lang="en" class="title" lang="en"><strong>Generate the Master Key</strong></p><p xml:lang="en" lang="en">The following commands generate a master key
	    (<code class="filename">/root/da2.key</code>) that is protected
	    with a passphrase.  The data source for the key file is
	    <code class="filename">/dev/random</code> and the sector size of
	    the provider (<code class="filename">/dev/da2.eli</code>) is 4kB as
	    a bigger sector size provides better performance:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/random of=/root/da2.key bs=64 count=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>geli init -s 4096 -K /root/da2.key /dev/da2</code></strong>
Enter new passphrase:
Reenter new passphrase:</pre><p xml:lang="en" lang="en">It is not mandatory to use both a passphrase and a key
	    file as either method of securing the master key can be
	    used in isolation.</p><p xml:lang="en" lang="en">If the key file is given as <span class="quote">“<span class="quote">-</span>”</span>, standard
	    input will be used.  For example, this command generates
	    three key files:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cat keyfile1 keyfile2 keyfile3 | geli init -K - /dev/da2</code></strong></pre></li><li class="step"><p xml:lang="en" class="title" lang="en"><strong>Attach the Provider with the Generated Key</strong></p><p xml:lang="en" lang="en">To attach the provider, specify the key file, the name
	    of the disk, and the passphrase:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>geli attach -k /root/da2.key /dev/da2</code></strong>
Enter passphrase:</pre><p xml:lang="en" lang="en">This creates a new device with an
	    <code class="filename">.eli</code> extension:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ls /dev/da2*</code></strong>
/dev/da2  /dev/da2.eli</pre></li><li class="step"><p xml:lang="en" class="title" lang="en"><strong>Create the New File System</strong></p><p xml:lang="en" lang="en">Next, format the device with the
	    <acronym class="acronym">UFS</acronym> file system and mount it on an
	    existing mount point:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/random of=/dev/da2.eli bs=1m</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs /dev/da2.eli</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/da2.eli <em class="replaceable"><code>/private</code></em></code></strong></pre><p xml:lang="en" lang="en">The encrypted file system should now be available for
	    use:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>df -H</code></strong>
Filesystem     Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a    248M    89M   139M    38%    /
/devfs         1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f    7.7G   2.3G   4.9G    32%    /usr
/dev/ad0s1d    989M   1.5M   909M     0%    /tmp
/dev/ad0s1e    3.9G   1.3G   2.3G    35%    /var
/dev/da2.eli   150G   4.1K   138G     0%    /private</pre></li></ol></div><p xml:lang="en" lang="en">Once the work on the encrypted partition is done, and the
	<code class="filename">/private</code> partition is no longer needed,
	it is prudent to put the device into cold storage by
	unmounting and detaching the <code class="command">geli</code> encrypted
	partition from the kernel:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>umount /private</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>geli detach da2.eli</code></strong></pre><p xml:lang="en" lang="en">A <code class="filename">rc.d</code> script is provided to
	simplify the mounting of <code class="command">geli</code>-encrypted
	devices at boot time.  For this example, add these lines to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">geli_devices="<em class="replaceable"><code>da2</code></em>"
geli_da2_flags="-k /root/<em class="replaceable"><code>da2.key</code></em>"</pre><p xml:lang="en" lang="en">This configures <code class="filename">/dev/da2</code> as a
	<code class="command">geli</code> provider with a master key of
	<code class="filename">/root/da2.key</code>.  The system will
	automatically detach the provider from the kernel before the
	system shuts down.  During the startup process, the script
	will prompt for the passphrase before attaching the provider.
	Other kernel messages might be shown before and after the
	password prompt.  If the boot process seems to stall, look
	carefully for the password prompt among the other messages.
	Once the correct passphrase is entered, the provider is
	attached.  The file system is then mounted, typically by an
	entry in <code class="filename">/etc/fstab</code>.  Refer to <a class="xref" href="#mount-unmount" title="3.7. 掛載與卸載檔案系統">節 3.7, “掛載與卸載檔案系統”</a> for instructions on how to
	configure a file system to mount at boot time.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="swap-encrypting"></a>17.13. 交換空間加密</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Christian</span> <span class="surname">Brueffer</span></span>. </span></div></div></div><a id="idp76248120" class="indexterm"></a><p xml:lang="en" lang="en">Like the encryption of disk partitions, encryption of swap
      space is used to protect sensitive information.  Consider an
      application that deals with passwords.  As long as these
      passwords stay in physical memory, they are not written to disk
      and will be cleared after a reboot.  However, if FreeBSD starts
      swapping out memory pages to free space, the passwords may be
      written to the disk unencrypted.  Encrypting swap space can be a
      solution for this scenario.</p><p xml:lang="en" lang="en">This section demonstrates how to configure an encrypted
      swap partition using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a> or <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> encryption.
      It assumes that
      <code class="filename">/dev/ada0s1b</code> is the swap partition.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76252344"></a>17.13.1. 設定已加密的交換空間</h3></div></div></div><p xml:lang="en" lang="en">Swap partitions are not encrypted by default and should be
	cleared of any sensitive data before continuing.  To overwrite
	the current swap partition with random garbage, execute the
	following command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/random of=/dev/<em class="replaceable"><code>ada0s1b</code></em> bs=1m</code></strong></pre><p xml:lang="en" lang="en">To encrypt the swap partition using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a>, add the
	<code class="literal">.bde</code> suffix to the swap line in
	<code class="filename">/etc/fstab</code>:</p><pre xml:lang="en" class="programlisting" lang="en"># Device		Mountpoint	FStype	Options		Dump	Pass#
/dev/ada0s1b.bde	none		swap	sw		0	0</pre><p xml:lang="en" lang="en">To instead encrypt the swap partition using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a>,
	use the
	<code class="literal">.eli</code> suffix:</p><pre xml:lang="en" class="programlisting" lang="en"># Device		Mountpoint	FStype	Options		Dump	Pass#
/dev/ada0s1b.eli	none		swap	sw		0	0</pre><p xml:lang="en" lang="en">By default, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> uses the <acronym class="acronym">AES</acronym>
	algorithm with a key length of 128 bits.  Normally the default
	settings will suffice.  If desired, these defaults can be
	altered in the options field in
	<code class="filename">/etc/fstab</code>.  The possible flags
	are:</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en">aalgo</span></dt><dd><p xml:lang="en" lang="en">Data integrity verification algorithm used to ensure
	      that the encrypted data has not been tampered with.  See
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> for a list of supported algorithms.</p></dd><dt><span xml:lang="en" class="term" lang="en">ealgo</span></dt><dd><p xml:lang="en" lang="en">Encryption algorithm used to protect the data.  See
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> for a list of supported algorithms.</p></dd><dt><span xml:lang="en" class="term" lang="en">keylen</span></dt><dd><p xml:lang="en" lang="en">The length of the key used for the encryption
	      algorithm.  See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> for the key lengths that
	      are supported by each encryption algorithm.</p></dd><dt><span xml:lang="en" class="term" lang="en">sectorsize</span></dt><dd><p xml:lang="en" lang="en">The size of the blocks data is broken into before
	      it is encrypted.  Larger sector sizes increase
	      performance at the cost of higher storage
	      overhead.  The recommended size is 4096 bytes.</p></dd></dl></div><p xml:lang="en" lang="en">This example configures an encrypted swap partition using
	the Blowfish algorithm with a key length of 128 bits and a
	sectorsize of 4 kilobytes:</p><pre xml:lang="en" class="programlisting" lang="en"># Device		Mountpoint	FStype	Options				Dump	Pass#
/dev/ada0s1b.eli	none		swap	sw,ealgo=blowfish,keylen=128,sectorsize=4096	0	0</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76289336"></a>17.13.2. 加密的交換空間檢驗</h3></div></div></div><p xml:lang="en" lang="en">Once the system has rebooted, proper operation of the
	encrypted swap can be verified using
	<code class="command">swapinfo</code>.</p><p xml:lang="en" lang="en">If <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a> is being used:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>swapinfo</code></strong>
Device          1K-blocks     Used    Avail Capacity
/dev/ada0s1b.bde   542720        0   542720     0%</pre><p xml:lang="en" lang="en">If <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> is being used:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>swapinfo</code></strong>
Device          1K-blocks     Used    Avail Capacity
/dev/ada0s1b.eli   542720        0   542720     0%</pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-hast"></a>17.14. 高可用存儲空間 (<acronym class="acronym">HAST</acronym>)</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Daniel</span> <span class="surname">Gerzo</span></span>. </span></div><div><span class="authorgroup">With inputs from <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Freddie</span> <span class="surname">Cash</span></span>, <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Pawel Jakub</span> <span class="surname">Dawidek</span></span>, <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Michael W.</span> <span class="surname">Lucas</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Viktor</span> <span class="surname">Petersson</span></span>. </span></div></div></div><a id="idp76315576" class="indexterm"></a><p xml:lang="en" lang="en">High availability is one of the main requirements in
      serious business applications and highly-available storage is a
      key component in such environments.  In FreeBSD, the Highly
      Available STorage (<acronym class="acronym">HAST</acronym>) framework allows
      transparent storage of the same data across several physically
      separated machines connected by a <acronym class="acronym">TCP/IP</acronym>
      network.  <acronym class="acronym">HAST</acronym> can be understood as a
      network-based RAID1 (mirror), and is similar to the DRBD®
      storage system used in the GNU/<span class="trademark">Linux</span>® platform.  In combination
      with other high-availability features of FreeBSD like
      <acronym class="acronym">CARP</acronym>, <acronym class="acronym">HAST</acronym> makes it
      possible to build a highly-available storage cluster that is
      resistant to hardware failures.</p><p xml:lang="en" lang="en">The following are the main features of
      <acronym class="acronym">HAST</acronym>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Can be used to mask <acronym class="acronym">I/O</acronym> errors on
	  local hard drives.</p></li><li class="listitem"><p xml:lang="en" lang="en">File system agnostic as it works with any file system
	  supported by FreeBSD.</p></li><li class="listitem"><p xml:lang="en" lang="en">Efficient and quick resynchronization as only the blocks
	  that were modified during the downtime of a node are
	  synchronized.</p></li><li class="listitem"><p xml:lang="en" lang="en">Can be used in an already deployed environment to add
	  additional redundancy.</p></li><li class="listitem"><p xml:lang="en" lang="en">Together with <acronym class="acronym">CARP</acronym>,
	  <span class="application">Heartbeat</span>, or other tools, it can
	  be used to build a robust and durable storage system.</p></li></ul></div><p xml:lang="en" lang="en">After reading this section, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">What <acronym class="acronym">HAST</acronym> is, how it works, and
	  which features it provides.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to set up and use <acronym class="acronym">HAST</acronym> on
	  FreeBSD.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to integrate <acronym class="acronym">CARP</acronym> and
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a> to build a robust storage system.</p></li></ul></div><p xml:lang="en" lang="en">Before reading this section, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>了解 <span class="trademark">UNIX</span>® 及 FreeBSD 基礎 (<a class="xref" href="#basics" title="章 3. FreeBSD 基礎">章 3, <em>FreeBSD 基礎</em></a>)。</p></li><li class="listitem"><p xml:lang="en" lang="en">Know how to configure network
	  interfaces and other core FreeBSD subsystems (<a class="xref" href="#config-tuning" title="章 11. 設定與調校">章 11, <em>設定與調校</em></a>).</p></li><li class="listitem"><p xml:lang="en" lang="en">Have a good understanding of FreeBSD
	  networking (<a class="xref" href="#network-communication" title="部 IV. 網路通訊">部 IV, “網路通訊”</a>).</p></li></ul></div><p xml:lang="en" lang="en">The <acronym class="acronym">HAST</acronym> project was sponsored by The
      FreeBSD Foundation with support from <a class="link" href="http://www.omc.net/" target="_top">http://www.omc.net/</a>
      and <a class="link" href="http://www.transip.nl/" target="_top">http://www.transip.nl/</a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76339768"></a>17.14.1. HAST 運作模式</h3></div></div></div><p xml:lang="en" lang="en"><acronym class="acronym">HAST</acronym> provides synchronous block-level
	replication between two physical machines: the
	<span class="emphasis"><em>primary</em></span>, also known as the
	<span class="emphasis"><em>master</em></span> node, and the
	<span class="emphasis"><em>secondary</em></span>, or <span class="emphasis"><em>slave</em></span>
	node.  These two machines together are referred to as a
	cluster.</p><p xml:lang="en" lang="en">Since <acronym class="acronym">HAST</acronym> works in a primary-secondary
	configuration, it allows only one of the cluster nodes to be
	active at any given time.  The primary node, also called
	<span class="emphasis"><em>active</em></span>, is the one which will handle all
	the <acronym class="acronym">I/O</acronym> requests to
	<acronym class="acronym">HAST</acronym>-managed devices.  The secondary node
	is automatically synchronized from the primary node.</p><p xml:lang="en" lang="en">The physical components of the <acronym class="acronym">HAST</acronym>
	system are the local disk on primary node, and the disk on the
	remote, secondary node.</p><p xml:lang="en" lang="en"><acronym class="acronym">HAST</acronym> operates synchronously on a block
	level, making it transparent to file systems and applications.
	<acronym class="acronym">HAST</acronym> provides regular GEOM providers in
	<code class="filename">/dev/hast/</code> for use by other tools or
	applications.  There is no difference between using
	<acronym class="acronym">HAST</acronym>-provided devices and raw disks or
	partitions.</p><p xml:lang="en" lang="en">Each write, delete, or flush operation is sent to both the
	local disk and to the remote disk over
	<acronym class="acronym">TCP/IP</acronym>.  Each read operation is served from
	the local disk, unless the local disk is not up-to-date or an
	<acronym class="acronym">I/O</acronym> error occurs.  In such cases, the read
	operation is sent to the secondary node.</p><p xml:lang="en" lang="en"><acronym class="acronym">HAST</acronym> tries to provide fast failure
	recovery.  For this reason, it is important to reduce
	synchronization time after a node's outage.  To provide fast
	synchronization, <acronym class="acronym">HAST</acronym> manages an on-disk
	bitmap of dirty extents and only synchronizes those during a
	regular synchronization, with an exception of the initial
	sync.</p><p xml:lang="en" lang="en">There are many ways to handle synchronization.
	<acronym class="acronym">HAST</acronym> implements several replication modes
	to handle different synchronization methods:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>memsync</em></span>: This mode reports a
	    write operation as completed when the local write
	    operation is finished and when the remote node
	    acknowledges data arrival, but before actually storing the
	    data.  The data on the remote node will be stored directly
	    after sending the acknowledgement.  This mode is intended
	    to reduce latency, but still provides good reliability.
	    This mode is the default.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>fullsync</em></span>: This mode reports a
	    write operation as completed when both the local write and
	    the remote write complete.  This is the safest and the
	    slowest replication mode.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>async</em></span>: This mode reports a write
	    operation as completed when the local write completes.
	    This is the fastest and the most dangerous replication
	    mode.  It should only be used when replicating to a
	    distant node where latency is too high for other
	    modes.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76371256"></a>17.14.2. HAST 設定</h3></div></div></div><p xml:lang="en" lang="en">The <acronym class="acronym">HAST</acronym> framework consists of several
	components:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hastd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hastd</span>(8)</span></a> daemon which provides data
	    synchronization.  When this daemon is started, it will
	    automatically load <code class="varname">geom_gate.ko</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en">The userland management utility,
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hastctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hastctl</span>(8)</span></a>.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hast.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hast.conf</span>(5)</span></a> configuration file.  This file
	    must exist before starting
	    <span class="application">hastd</span>.</p></li></ul></div><p xml:lang="en" lang="en">Users who prefer to statically build
	<code class="literal">GEOM_GATE</code> support into the kernel should
	add this line to the custom kernel configuration file, then
	rebuild the kernel using the instructions in <a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a>:</p><pre xml:lang="en" class="programlisting" lang="en">options	GEOM_GATE</pre><p xml:lang="en" lang="en">The following example describes how to configure two nodes
	in master-slave/primary-secondary operation using
	<acronym class="acronym">HAST</acronym> to replicate the data between the two.
	The nodes will be called <code class="literal">hasta</code>, with an
	<acronym class="acronym">IP</acronym> address of
	<code class="literal">172.16.0.1</code>, and <code class="literal">hastb</code>,
	with an <acronym class="acronym">IP</acronym> address of
	<code class="literal">172.16.0.2</code>.  Both nodes will have a
	dedicated hard drive <code class="filename">/dev/ad6</code> of the same
	size for <acronym class="acronym">HAST</acronym> operation.  The
	<acronym class="acronym">HAST</acronym> pool, sometimes referred to as a
	resource or the <acronym class="acronym">GEOM</acronym> provider in <code class="filename">/dev/hast/</code>, will be called
	<code class="literal">test</code>.</p><p xml:lang="en" lang="en">Configuration of <acronym class="acronym">HAST</acronym> is done using
	<code class="filename">/etc/hast.conf</code>.  This file should be
	identical on both nodes.  The simplest configuration
	is:</p><pre xml:lang="en" class="programlisting" lang="en">resource <em class="replaceable"><code>test</code></em> {
	on <em class="replaceable"><code>hasta</code></em> {
		local <em class="replaceable"><code>/dev/ad6</code></em>
		remote <em class="replaceable"><code>172.16.0.2</code></em>
	}
	on <em class="replaceable"><code>hastb</code></em> {
		local <em class="replaceable"><code>/dev/ad6</code></em>
		remote <em class="replaceable"><code>172.16.0.1</code></em>
	}
}</pre><p xml:lang="en" lang="en">For more advanced configuration, refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hast.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hast.conf</span>(5)</span></a>.</p><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">It is also possible to use host names in the
	  <code class="literal">remote</code> statements if the hosts are
	  resolvable and defined either in
	  <code class="filename">/etc/hosts</code> or in the local
	  <acronym class="acronym">DNS</acronym>.</p></div><p xml:lang="en" lang="en">Once the configuration exists on both nodes, the
	<acronym class="acronym">HAST</acronym> pool can be created.  Run these
	commands on both nodes to place the initial metadata onto the
	local disk and to start <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hastd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hastd</span>(8)</span></a>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>hastctl create <em class="replaceable"><code>test</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service hastd onestart</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">It is <span class="emphasis"><em>not</em></span> possible to use
	  <acronym class="acronym">GEOM</acronym>
	  providers with an existing file system or to convert an
	  existing storage to a <acronym class="acronym">HAST</acronym>-managed pool.
	  This procedure needs to store some metadata on the provider
	  and there will not be enough required space available on an
	  existing provider.</p></div><p xml:lang="en" lang="en">A HAST node's <code class="literal">primary</code> or
	<code class="literal">secondary</code> role is selected by an
	administrator, or software like
	<span class="application">Heartbeat</span>, using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hastctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hastctl</span>(8)</span></a>.
	On the primary node, <code class="literal">hasta</code>, issue this
	command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>hastctl role primary <em class="replaceable"><code>test</code></em></code></strong></pre><p xml:lang="en" lang="en">Run this command on the secondary node,
	<code class="literal">hastb</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>hastctl role secondary <em class="replaceable"><code>test</code></em></code></strong></pre><p xml:lang="en" lang="en">Verify the result by running <code class="command">hastctl</code> on
	each node:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>hastctl status <em class="replaceable"><code>test</code></em></code></strong></pre><p xml:lang="en" lang="en">Check the <code class="literal">status</code> line in the output.
	If it says <code class="literal">degraded</code>, something is wrong
	with the configuration file.  It should say
	<code class="literal">complete</code> on each node, meaning that the
	synchronization between the nodes has started.  The
	synchronization completes when <code class="command">hastctl
	  status</code> reports 0 bytes of <code class="literal">dirty</code>
	extents.</p><p xml:lang="en" lang="en">The next step is to create a file system on the
	<acronym class="acronym">GEOM</acronym> provider and mount it.  This must be
	done on the <code class="literal">primary</code> node.  Creating the
	file system can take a few minutes, depending on the size of
	the hard drive.  This example creates a <acronym class="acronym">UFS</acronym>
	file system on <code class="filename">/dev/hast/test</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/hast/<em class="replaceable"><code>test</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir /hast/<em class="replaceable"><code>test</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/hast/<em class="replaceable"><code>test</code></em> <em class="replaceable"><code>/hast/test</code></em></code></strong></pre><p xml:lang="en" lang="en">Once the <acronym class="acronym">HAST</acronym> framework is configured
	properly, the final step is to make sure that
	<acronym class="acronym">HAST</acronym> is started automatically during
	system boot.  Add this line to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">hastd_enable="YES"</pre><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76439608"></a>17.14.2.1. 容錯移轉設定</h4></div></div></div><p xml:lang="en" lang="en">The goal of this example is to build a robust storage
	  system which is resistant to the failure of any given node.
	  If the primary node fails, the secondary node is there to
	  take over seamlessly, check and mount the file system, and
	  continue to work without missing a single bit of
	  data.</p><p xml:lang="en" lang="en">To accomplish this task, the Common Address Redundancy
	  Protocol (<acronym class="acronym">CARP</acronym>) is used to provide for
	  automatic failover at the <acronym class="acronym">IP</acronym> layer.
	  <acronym class="acronym">CARP</acronym> allows multiple hosts on the same
	  network segment to share an <acronym class="acronym">IP</acronym> address.
	  Set up <acronym class="acronym">CARP</acronym> on both nodes of the cluster
	  according to the documentation available in <a class="xref" href="#carp" title="31.10. 共用位址備援協定 (CARP)">節 31.10, “共用位址備援協定 (<acronym class="acronym">CARP</acronym>)”</a>.  In this example, each node will have
	  its own management <acronym class="acronym">IP</acronym> address and a
	  shared <acronym class="acronym">IP</acronym> address of
	  <em class="replaceable"><code>172.16.0.254</code></em>.  The primary
	  <acronym class="acronym">HAST</acronym> node of the cluster must be the
	  master <acronym class="acronym">CARP</acronym> node.</p><p xml:lang="en" lang="en">The <acronym class="acronym">HAST</acronym> pool created in the previous
	  section is now ready to be exported to the other hosts on
	  the network.  This can be accomplished by exporting it
	  through <acronym class="acronym">NFS</acronym> or
	  <span class="application">Samba</span>, using the shared
	  <acronym class="acronym">IP</acronym> address
	  <em class="replaceable"><code>172.16.0.254</code></em>.  The only problem
	  which remains unresolved is an automatic failover should the
	  primary node fail.</p><p xml:lang="en" lang="en">In the event of <acronym class="acronym">CARP</acronym> interfaces going
	  up or down, the FreeBSD operating system generates a
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a> event, making it possible to watch for state
	  changes on the <acronym class="acronym">CARP</acronym> interfaces.  A state
	  change on the <acronym class="acronym">CARP</acronym> interface is an
	  indication that one of the nodes failed or came back online.
	  These state change events make it possible to run a script
	  which will automatically handle the HAST failover.</p><p xml:lang="en" lang="en">To catch state changes on the
	  <acronym class="acronym">CARP</acronym> interfaces, add this configuration
	  to <code class="filename">/etc/devd.conf</code> on each node:</p><pre xml:lang="en" class="programlisting" lang="en">notify 30 {
	match "system" "IFNET";
	match "subsystem" "carp0";
	match "type" "LINK_UP";
	action "/usr/local/sbin/carp-hast-switch master";
};

notify 30 {
	match "system" "IFNET";
	match "subsystem" "carp0";
	match "type" "LINK_DOWN";
	action "/usr/local/sbin/carp-hast-switch slave";
};</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">If the systems are running FreeBSD 10 or higher,
	    replace <code class="filename">carp0</code> with the name of the
	    <acronym class="acronym">CARP</acronym>-configured interface.</p></div><p xml:lang="en" lang="en">Restart <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a> on both nodes to put the new
	  configuration into effect:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service devd restart</code></strong></pre><p xml:lang="en" lang="en">When the specified interface state changes by going up
	  or down , the system generates a notification, allowing the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a> subsystem to run the specified automatic
	  failover script,
	  <code class="filename">/usr/local/sbin/carp-hast-switch</code>.
	  For further clarification about this configuration, refer to
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd.conf</span>(5)</span></a>.</p><p xml:lang="en" lang="en">Here is an example of an automated failover
	  script:</p><pre xml:lang="en" class="programlisting" lang="en">#!/bin/sh

# Original script by Freddie Cash &lt;fjwcash@gmail.com&gt;
# Modified by Michael W. Lucas &lt;mwlucas@BlackHelicopters.org&gt;
# and Viktor Petersson &lt;vpetersson@wireload.net&gt;

# The names of the HAST resources, as listed in /etc/hast.conf
resources="<em class="replaceable"><code>test</code></em>"

# delay in mounting HAST resource after becoming master
# make your best guess
delay=3

# logging
log="local0.debug"
name="carp-hast"

# end of user configurable stuff

case "$1" in
	master)
		logger -p $log -t $name "Switching to primary provider for ${resources}."
		sleep ${delay}

		# Wait for any "hastd secondary" processes to stop
		for disk in ${resources}; do
			while $( pgrep -lf "hastd: ${disk} \(secondary\)" &gt; /dev/null 2&gt;&amp;1 ); do
				sleep 1
			done

			# Switch role for each disk
			hastctl role primary ${disk}
			if [ $? -ne 0 ]; then
				logger -p $log -t $name "Unable to change role to primary for resource ${disk}."
				exit 1
			fi
		done

		# Wait for the /dev/hast/* devices to appear
		for disk in ${resources}; do
			for I in $( jot 60 ); do
				[ -c "/dev/hast/${disk}" ] &amp;&amp; break
				sleep 0.5
			done

			if [ ! -c "/dev/hast/${disk}" ]; then
				logger -p $log -t $name "GEOM provider /dev/hast/${disk} did not appear."
				exit 1
			fi
		done

		logger -p $log -t $name "Role for HAST resources ${resources} switched to primary."


		logger -p $log -t $name "Mounting disks."
		for disk in ${resources}; do
			mkdir -p /hast/${disk}
			fsck -p -y -t ufs /dev/hast/${disk}
			mount /dev/hast/${disk} /hast/${disk}
		done

	;;

	slave)
		logger -p $log -t $name "Switching to secondary provider for ${resources}."

		# Switch roles for the HAST resources
		for disk in ${resources}; do
			if ! mount | grep -q "^/dev/hast/${disk} on "
			then
			else
				umount -f /hast/${disk}
			fi
			sleep $delay
			hastctl role secondary ${disk} 2&gt;&amp;1
			if [ $? -ne 0 ]; then
				logger -p $log -t $name "Unable to switch role to secondary for resource ${disk}."
				exit 1
			fi
			logger -p $log -t $name "Role switched to secondary for resource ${disk}."
		done
	;;
esac</pre><p xml:lang="en" lang="en">In a nutshell, the script takes these actions when a
	  node becomes master:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Promotes the <acronym class="acronym">HAST</acronym> pool to
	      primary on the other node.</p></li><li class="listitem"><p xml:lang="en" lang="en">Checks the file system under the
	      <acronym class="acronym">HAST</acronym> pool.</p></li><li class="listitem"><p xml:lang="en" lang="en">Mounts the pool.</p></li></ul></div><p xml:lang="en" lang="en">When a node becomes secondary:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Unmounts the <acronym class="acronym">HAST</acronym> pool.</p></li><li class="listitem"><p xml:lang="en" lang="en">Degrades the <acronym class="acronym">HAST</acronym> pool to
	      secondary.</p></li></ul></div><div xmlns="" class="caution"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">This is just an example script which serves as a proof
	    of concept.  It does not handle all the possible scenarios
	    and can be extended or altered in any way, for example, to
	    start or stop required services.</p></div><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">For this example, a standard <acronym class="acronym">UFS</acronym>
	    file system was used.  To reduce the time needed for
	    recovery, a journal-enabled <acronym class="acronym">UFS</acronym> or
	    <acronym class="acronym">ZFS</acronym> file system can be used
	    instead.</p></div><p xml:lang="en" lang="en">More detailed information with additional examples can
	  be found at <a class="link" href="http://wiki.FreeBSD.org/HAST" target="_top">http://wiki.FreeBSD.org/HAST</a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76492728"></a>17.14.3. 疑難排解</h3></div></div></div><p xml:lang="en" lang="en"><acronym class="acronym">HAST</acronym> should generally work without
	issues.  However, as with any other software product, there
	may be times when it does not work as supposed.  The sources
	of the problems may be different, but the rule of thumb is to
	ensure that the time is synchronized between the nodes of the
	cluster.</p><p xml:lang="en" lang="en">When troubleshooting <acronym class="acronym">HAST</acronym>, the
	debugging level of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hastd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hastd</span>(8)</span></a> should be increased by
	starting <code class="command">hastd</code> with <code class="literal">-d</code>.
	This argument may be specified multiple times to further
	increase the debugging level.  Consider also using
	<code class="literal">-F</code>, which starts <code class="command">hastd</code>
	in the foreground.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks-hast-sb"></a>17.14.3.1. 自 Split-brain 情況復原</h4></div></div></div><p xml:lang="en" lang="en"><em class="firstterm">Split-brain</em> occurs when the nodes
	  of the cluster are unable to communicate with each other,
	  and both are configured as primary.  This is a dangerous
	  condition because it allows both nodes to make incompatible
	  changes to the data.  This problem must be corrected
	  manually by the system administrator.</p><p xml:lang="en" lang="en">The administrator must either decide which node has more
	  important changes, or perform the merge manually.  Then, let
	  <acronym class="acronym">HAST</acronym> perform full synchronization of the
	  node which has the broken data.  To do this, issue these
	  commands on the node which needs to be
	  resynchronized:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>hastctl role init <em class="replaceable"><code>test</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>hastctl create <em class="replaceable"><code>test</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>hastctl role secondary <em class="replaceable"><code>test</code></em></code></strong></pre></div></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom"></a>章 18. GEOM: 模組化磁碟轉換框架</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#geom-synopsis">18.1. 概述</a></span></dt><dt><span class="sect1"><a href="#geom-striping">18.2. RAID0 - 串連 (Striping)</a></span></dt><dt><span class="sect1"><a href="#geom-mirror">18.3. RAID1 - 鏡像 (Mirroring)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#geom-mirror-metadata">18.3.1. Metadata 問題</a></span></dt><dt><span class="sect2"><a href="#geom-mirror-two-new-disks">18.3.2. 使用兩個新磁碟建立鏡像</a></span></dt><dt><span class="sect2"><a href="#geom-mirror-existing-drive">18.3.3. 使用既有磁碟建立鏡像</a></span></dt><dt><span class="sect2"><a href="#gmirror-troubleshooting">18.3.4. 疑難排解</a></span></dt><dt><span class="sect2"><a href="#idp76872888">18.3.5. 自磁碟故障復原</a></span></dt></dl></dd><dt><span class="sect1"><a href="#geom-raid3">18.4. <acronym class="acronym">RAID</acronym>3 - 位元級串連與獨立奇偶校驗</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp76924600">18.4.1. 建立 Dedicated <acronym class="acronym">RAID</acronym>3 陣列</a></span></dt></dl></dd><dt><span class="sect1"><a href="#geom-graid">18.5. 軟體 <acronym class="acronym">RAID</acronym> 裝置</a></span></dt><dd><dl><dt><span class="sect2"><a href="#geom-graid-creating">18.5.1. 建立陣列</a></span></dt><dt><span class="sect2"><a href="#geom-graid-volumes">18.5.2. 多磁碟區</a></span></dt><dt><span class="sect2"><a href="#geom-graid-converting">18.5.3. 轉換單一磁碟為鏡像</a></span></dt><dt><span class="sect2"><a href="#geom-graid-inserting">18.5.4. 插入新磁碟到陣列</a></span></dt><dt><span class="sect2"><a href="#geom-graid-removing">18.5.5. 從陣列移除磁碟</a></span></dt><dt><span class="sect2"><a href="#geom-graid-stopping">18.5.6. 停止陣列</a></span></dt><dt><span class="sect2"><a href="#geom-graid-status">18.5.7. 檢查陣列狀態</a></span></dt><dt><span class="sect2"><a href="#geom-graid-deleting">18.5.8. 刪除陣列</a></span></dt><dt><span class="sect2"><a href="#geom-graid-unexpected">18.5.9. 刪除預期之外的陣列</a></span></dt></dl></dd><dt><span class="sect1"><a href="#geom-ggate">18.6. <acronym class="acronym">GEOM</acronym> Gate Network</a></span></dt><dt><span class="sect1"><a href="#geom-glabel">18.7. 磁碟裝置標籤</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp77152056">18.7.1. 標籤類型與範例</a></span></dt></dl></dd><dt><span class="sect1"><a href="#geom-gjournal">18.8. UFS Journaling 透過 <acronym class="acronym">GEOM</acronym></a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="geom-synopsis"></a>18.1. 概述</h2></div></div></div><a id="idp76524984" class="indexterm"></a><a id="idp76526008" class="indexterm"></a><p>在 FreeBSD 中，<acronym class="acronym">GEOM</acronym> 可允許對類別做存取與控制，例如：主開機記錄 (Master Boot Record) 與 <acronym class="acronym">BSD</acronym> 標籤，透過利用提供者，或在 <code class="filename">/dev</code> 中的磁碟裝置。透過支援各種 <acronym class="acronym">RAID</acronym> 的配置，<acronym class="acronym">GEOM</acronym> 透明的提供了對作業系統與作業系統工具的存取。</p><p xml:lang="en" lang="en">This chapter covers the use of disks under the
      <acronym class="acronym">GEOM</acronym> framework in FreeBSD.  This includes the
      major <acronym class="acronym">RAID</acronym> control utilities which use the
      framework for configuration.  This chapter is not a definitive
      guide to <acronym class="acronym">RAID</acronym> configurations and only
      <acronym class="acronym">GEOM</acronym>-supported <acronym class="acronym">RAID</acronym>
      classifications are discussed.</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">What type of <acronym class="acronym">RAID</acronym> support is
	  available through <acronym class="acronym">GEOM</acronym>.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to use the base utilities to configure, maintain,
	  and manipulate the various <acronym class="acronym">RAID</acronym>
	  levels.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to mirror, stripe, encrypt, and remotely connect
	  disk devices through <acronym class="acronym">GEOM</acronym>.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to troubleshoot disks attached to the
	  <acronym class="acronym">GEOM</acronym> framework.</p></li></ul></div><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Understand how FreeBSD treats disk devices (<a class="xref" href="#disks" title="章 17. 儲存設備">章 17, <em>儲存設備</em></a>).</p></li><li class="listitem"><p>了解如何設定並安裝新的核心 (<a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a>)。</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="geom-striping"></a>18.2. RAID0 - 串連 (Striping)</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Murray</span> <span class="surname">Stokely</span></span>. </span></div></div></div><a id="idp76551480" class="indexterm"></a><a id="idp76552504" class="indexterm"></a><p>串連會合併數個磁碟成單一個磁碟區 (Volume)，可以透過使用硬體 <acronym class="acronym">RAID</acronym> 控制器來做到串連。<acronym class="acronym">GEOM</acronym> 磁碟子系統提供了軟體支援的磁碟串連，也就是所謂的 <acronym class="acronym">RAID0</acronym>，而不需要 <acronym class="acronym">RAID</acronym> 磁碟控制器。</p><p>在 <acronym class="acronym">RAID0</acronym> 中，資料會被切割成數個資料區塊 (Block) 寫入到磁碟陣列中的每一個磁碟機。如下圖所示，取代以往等候系統寫入 256k 到一個磁碟的時間， <acronym class="acronym">RAID0</acronym> 可以同時寫入 64k 到磁碟陣列中四個磁碟的每個磁碟，這可提供優異的 <acronym class="acronym">I/O</acronym> 效能，若使用多個磁碟控制器可增加更多的效能。</p><div xml:lang="en" class="mediaobject" align="center" lang="en"><img src="geom/striping.png" align="middle" alt="Disk Striping Illustration" /></div><p>在 <acronym class="acronym">RAID0</acronym> 串連中的每個磁碟必須要相同大小，因為 <acronym class="acronym">I/O</acronym> 的請求是平行交錯讀取或寫入到多個磁碟的。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml"><acronym class="acronym">RAID0</acronym> 並<span class="emphasis"><em>不</em></span>提供任何備援 (Redundancy) 功能。這意謂著若磁碟陣列中的其中一個磁碟故障，所有在該磁碟上的資料便會遺失。若資料很重要，請規畫備份策略，定期儲存備份到遠端系統或裝置。</p></div><p xml:lang="en" lang="en">The process for creating a software,
      <acronym class="acronym">GEOM</acronym>-based <acronym class="acronym">RAID0</acronym> on a FreeBSD
      system using commodity disks is as follows.  Once the stripe is
      created, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gstripe&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gstripe</span>(8)</span></a> for more information on how
      to control an existing stripe.</p><div class="procedure"><a id="idp76567992"></a><div class="procedure-title">過程 18.1. Creating a Stripe of Unformatted <acronym class="acronym">ATA</acronym>
	Disks</div><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">Load the <code class="filename">geom_stripe.ko</code>
	  module:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload geom_stripe</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">Ensure that a suitable mount point exists.  If this
	  volume will become a root partition, then temporarily use
	  another mount point such as
	  <code class="filename">/mnt</code>.</p></li><li class="step"><p xml:lang="en" lang="en">Determine the device names for the disks which will
	  be striped, and create the new stripe device.  For example,
	  to stripe two unused and unpartitioned
	  <acronym class="acronym">ATA</acronym> disks with device names of
	  <code class="filename">/dev/ad2</code> and
	  <code class="filename">/dev/ad3</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gstripe label -v st0 /dev/ad2 /dev/ad3</code></strong>
Metadata value stored on /dev/ad2.
Metadata value stored on /dev/ad3.
Done.</pre></li><li class="step"><p xml:lang="en" lang="en">Write a standard label, also known as a partition table,
	  on the new volume and install the default bootstrap
	  code:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -wB /dev/stripe/st0</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">This process should create two other devices in
	  <code class="filename">/dev/stripe</code> in addition to
	  <code class="filename">st0</code>.  Those include
	  <code class="filename">st0a</code> and <code class="filename">st0c</code>.  At
	  this point, a <acronym class="acronym">UFS</acronym> file system can be
	  created on <code class="filename">st0a</code> using
	  <code class="command">newfs</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/stripe/st0a</code></strong></pre><p xml:lang="en" lang="en">Many numbers will glide across the screen, and after a
	  few seconds, the process will be complete.  The volume has
	  been created and is ready to be mounted.</p></li><li class="step"><p xml:lang="en" lang="en">To manually mount the created disk stripe:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount /dev/stripe/st0a /mnt</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">To mount this striped file system automatically during
	  the boot process, place the volume information in
	  <code class="filename">/etc/fstab</code>.  In this example, a
	  permanent mount point, named <code class="filename">stripe</code>, is
	  created:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /stripe</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>echo "/dev/stripe/st0a /stripe ufs rw 2 2" \</code></strong>
<strong class="userinput"><code>&gt;&gt; /etc/fstab</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">The <code class="filename">geom_stripe.ko</code> module must also
	  be automatically loaded during system initialization, by
	  adding a line to
	  <code class="filename">/boot/loader.conf</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /boot/loader.conf geom_stripe_load=YES</code></strong></pre></li></ol></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="geom-mirror"></a>18.3. RAID1 - 鏡像 (Mirroring)</h2></div></div></div><a id="idp76625336" class="indexterm"></a><a id="idp76626360" class="indexterm"></a><a id="idp76627256" class="indexterm"></a><p><acronym class="acronym">RAID1</acronym> 或<span class="emphasis"><em>鏡像</em></span>是一項寫入相同資料到超過一個磁碟機的技術。鏡像通常用來保護資料因磁碟機故障導致的損失，每個在鏡像中的磁碟機會擁有完全相同的資料，當各別磁碟機故障時，鏡像會繼續運作，由還可運作的磁碟機提供資料。電腦會繼續執行，等到管理者有時間更換故障的硬碟，而不會被使用者中斷運作。</p><p xml:lang="en" lang="en">Two common situations are illustrated in these examples.
      The first creates a mirror out of two new drives and uses it as
      a replacement for an existing single drive.  The second example
      creates a mirror on a single new drive, copies the old drive's
      data to it, then inserts the old drive into the mirror.  While
      this procedure is slightly more complicated, it only requires
      one new drive.</p><p xml:lang="en" lang="en">Traditionally, the two drives in a mirror are identical in
      model and capacity, but <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gmirror</span>(8)</span></a> does not require that.
      Mirrors created with dissimilar drives will have a capacity
      equal to that of the smallest drive in the mirror.  Extra space
      on larger drives will be unused.  Drives inserted into the
      mirror later must have at least as much capacity as the smallest
      drive already in the mirror.</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The mirroring procedures shown here are non-destructive,
	but as with any major disk operation, make a full backup
	first.</p></div><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">While <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> is used in these procedures
	to copy file systems, it does not work on file systems with
	soft updates journaling.  See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a> for information
	on detecting and disabling soft updates journaling.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-mirror-metadata"></a>18.3.1. Metadata 問題</h3></div></div></div><p xml:lang="en" lang="en">Many disk systems store metadata at the end of each disk.
	Old metadata should be erased before reusing the disk for a
	mirror.  Most problems are caused by two particular types of
	leftover metadata: <acronym class="acronym">GPT</acronym> partition tables and
	old metadata from a previous mirror.</p><p xml:lang="en" lang="en"><acronym class="acronym">GPT</acronym> metadata can be erased with
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gpart</span>(8)</span></a>.  This example erases both primary and backup
	<acronym class="acronym">GPT</acronym> partition tables from disk
	<code class="filename">ada8</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gpart destroy -F ada8</code></strong></pre><p xml:lang="en" lang="en">A disk can be removed from an active mirror and the
	metadata erased in one step using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gmirror</span>(8)</span></a>.  Here, the
	example disk <code class="filename">ada8</code> is removed from the
	active mirror <code class="filename">gm4</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gmirror remove gm4 ada8</code></strong></pre><p xml:lang="en" lang="en">If the mirror is not running, but old mirror metadata is
	still on the disk, use <code class="command">gmirror clear</code> to
	remove it:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gmirror clear ada8</code></strong></pre><p xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gmirror</span>(8)</span></a> stores one block of metadata at the end of
	the disk.  Because <acronym class="acronym">GPT</acronym> partition schemes
	also store metadata at the end of the disk, mirroring entire
	<acronym class="acronym">GPT</acronym> disks with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gmirror</span>(8)</span></a> is not
	recommended.  <acronym class="acronym">MBR</acronym> partitioning is used here
	because it only stores a partition table at the start of the
	disk and does not conflict with the mirror metadata.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-mirror-two-new-disks"></a>18.3.2. 使用兩個新磁碟建立鏡像</h3></div></div></div><p xml:lang="en" lang="en">In this example, FreeBSD has already been installed on a
	single disk, <code class="filename">ada0</code>.  Two new disks,
	<code class="filename">ada1</code> and <code class="filename">ada2</code>, have
	been connected to the system.  A new mirror will be created on
	these two disks and used to replace the old single
	disk.</p><p xml:lang="en" lang="en">The <code class="filename">geom_mirror.ko</code> kernel module must
	either be built into the kernel or loaded at boot- or
	run-time.  Manually load the kernel module now:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gmirror load</code></strong></pre><p xml:lang="en" lang="en">Create the mirror with the two new drives:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gmirror label -v gm0 /dev/ada1 /dev/ada2</code></strong></pre><p xml:lang="en" lang="en"><code class="filename">gm0</code> is a user-chosen device name
	assigned to the new mirror.  After the mirror has been
	started, this device name appears in
	<code class="filename">/dev/mirror/</code>.</p><p xml:lang="en" lang="en"><acronym class="acronym">MBR</acronym> and
	<span class="application">bsdlabel</span> partition tables can now
	be created on the mirror with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gpart</span>(8)</span></a>.  This example
	uses a traditional file system layout, with partitions for
	<code class="filename">/</code>, swap, <code class="filename">/var</code>,
	<code class="filename">/tmp</code>, and <code class="filename">/usr</code>.  A
	single <code class="filename">/</code> and a swap partition
	will also work.</p><p xml:lang="en" lang="en">Partitions on the mirror do not have to be the same size
	as those on the existing disk, but they must be large enough
	to hold all the data already present on
	<code class="filename">ada0</code>.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gpart create -s MBR mirror/gm0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart add -t freebsd -a 4k mirror/gm0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart show mirror/gm0</code></strong>
=&gt;       63  156301423  mirror/gm0  MBR  (74G)
         63         63                    - free -  (31k)
        126  156301299                 1  freebsd  (74G)
  156301425         61                    - free -  (30k)</pre><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gpart create -s BSD mirror/gm0s1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart add -t freebsd-ufs  -a 4k -s 2g mirror/gm0s1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart add -t freebsd-swap -a 4k -s 4g mirror/gm0s1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart add -t freebsd-ufs  -a 4k -s 2g mirror/gm0s1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart add -t freebsd-ufs  -a 4k -s 1g mirror/gm0s1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart add -t freebsd-ufs  -a 4k       mirror/gm0s1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart show mirror/gm0s1</code></strong>
=&gt;        0  156301299  mirror/gm0s1  BSD  (74G)
          0          2                      - free -  (1.0k)
          2    4194304                   1  freebsd-ufs  (2.0G)
    4194306    8388608                   2  freebsd-swap  (4.0G)
   12582914    4194304                   4  freebsd-ufs  (2.0G)
   16777218    2097152                   5  freebsd-ufs  (1.0G)
   18874370  137426928                   6  freebsd-ufs  (65G)
  156301298          1                      - free -  (512B)</pre><p xml:lang="en" lang="en">Make the mirror bootable by installing bootcode in the
	<acronym class="acronym">MBR</acronym> and bsdlabel and setting the active
	slice:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -b /boot/mbr mirror/gm0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart set -a active -i 1 mirror/gm0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -b /boot/boot mirror/gm0s1</code></strong></pre><p xml:lang="en" lang="en">Format the file systems on the new mirror, enabling
	soft-updates.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/mirror/gm0s1a</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/mirror/gm0s1d</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/mirror/gm0s1e</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/mirror/gm0s1f</code></strong></pre><p xml:lang="en" lang="en">File systems from the original <code class="filename">ada0</code>
	disk can now be copied onto the mirror with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> and
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=restore&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">restore</span>(8)</span></a>.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1a /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dump -C16 -b64 -0aL -f - / | (cd /mnt &amp;&amp; restore -rf -)</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1d /mnt/var</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1e /mnt/tmp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1f /mnt/usr</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dump -C16 -b64 -0aL -f - /var | (cd /mnt/var &amp;&amp; restore -rf -)</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dump -C16 -b64 -0aL -f - /tmp | (cd /mnt/tmp &amp;&amp; restore -rf -)</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dump -C16 -b64 -0aL -f - /usr | (cd /mnt/usr &amp;&amp; restore -rf -)</code></strong></pre><p xml:lang="en" lang="en">Edit <code class="filename">/mnt/etc/fstab</code> to point to
	the new mirror file systems:</p><pre xml:lang="en" class="programlisting" lang="en"># Device		Mountpoint	FStype	Options	Dump	Pass#
/dev/mirror/gm0s1a	/		ufs	rw	1	1
/dev/mirror/gm0s1b	none		swap	sw	0	0
/dev/mirror/gm0s1d	/var		ufs	rw	2	2
/dev/mirror/gm0s1e	/tmp		ufs	rw	2	2
/dev/mirror/gm0s1f	/usr		ufs	rw	2	2</pre><p xml:lang="en" lang="en">If the <code class="filename">geom_mirror.ko</code> kernel module
	has not been built into the kernel,
	<code class="filename">/mnt/boot/loader.conf</code> is edited to load
	the module at boot:</p><pre xml:lang="en" class="programlisting" lang="en">geom_mirror_load="YES"</pre><p xml:lang="en" lang="en">Reboot the system to test the new mirror and verify that
	all data has been copied.  The <acronym class="acronym">BIOS</acronym> will
	see the mirror as two individual drives rather than a mirror.
	Because the drives are identical, it does not matter which is
	selected to boot.</p><p xml:lang="en" lang="en">See <a class="xref" href="#gmirror-troubleshooting" title="18.3.4. 疑難排解">節 18.3.4, “疑難排解”</a> if there are
	problems booting.  Powering down and disconnecting the
	original <code class="filename">ada0</code> disk will allow it to be
	kept as an offline backup.</p><p xml:lang="en" lang="en">In use, the mirror will behave just like the original
	single drive.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-mirror-existing-drive"></a>18.3.3. 使用既有磁碟建立鏡像</h3></div></div></div><p xml:lang="en" lang="en">In this example, FreeBSD has already been installed on a
	single disk, <code class="filename">ada0</code>.  A new disk,
	<code class="filename">ada1</code>, has been connected to the system.
	A one-disk mirror will be created on the new disk, the
	existing system copied onto it, and then the old disk will be
	inserted into the mirror.  This slightly complex procedure is
	required because <code class="command">gmirror</code> needs to put a
	512-byte block of metadata at the end of each disk, and the
	existing <code class="filename">ada0</code> has usually had all of its
	space already allocated.</p><p xml:lang="en" lang="en">Load the <code class="filename">geom_mirror.ko</code> kernel
	module:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gmirror load</code></strong></pre><p xml:lang="en" lang="en">Check the media size of the original disk with
	<code class="command">diskinfo</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>diskinfo -v ada0 | head -n3</code></strong>
/dev/ada0
	512             # sectorsize
	1000204821504   # mediasize in bytes (931G)</pre><p xml:lang="en" lang="en">Create a mirror on the new disk.  To make certain that the
	mirror capacity is not any larger than the original
	<code class="filename">ada0</code> drive, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gnop&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gnop</span>(8)</span></a> is used to
	create a fake drive of the exact same size.  This drive does
	not store any data, but is used only to limit the size of the
	mirror.  When <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gmirror</span>(8)</span></a> creates the mirror, it will
	restrict the capacity to the size of
	<code class="filename">gzero.nop</code>, even if the new
	<code class="filename">ada1</code> drive has more space.  Note that the
	<em class="replaceable"><code>1000204821504</code></em> in the second line is
	equal to <code class="filename">ada0</code>'s media size as shown by
	<code class="command">diskinfo</code> above.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>geom zero load</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gnop create -s 1000204821504 gzero</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gmirror label -v gm0 gzero.nop ada1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gmirror forget gm0</code></strong></pre><p xml:lang="en" lang="en">Since <code class="filename">gzero.nop</code> does not store any
	data, the mirror does not see it as connected.  The mirror is
	told to <span class="quote">“<span class="quote">forget</span>”</span> unconnected components, removing
	references to <code class="filename">gzero.nop</code>.  The result is a
	mirror device containing only a single disk,
	<code class="filename">ada1</code>.</p><p xml:lang="en" lang="en">After creating <code class="filename">gm0</code>, view the
	partition table on <code class="filename">ada0</code>.  This output is
	from a 1 TB drive.  If there is some unallocated space at
	the end of the drive, the contents may be copied directly from
	<code class="filename">ada0</code> to the new mirror.</p><p xml:lang="en" lang="en">However, if the output shows that all of the space on the
	disk is allocated, as in the following listing, there is no
	space available for the 512-byte mirror metadata at the end of
	the disk.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gpart show ada0</code></strong>
=&gt;        63  1953525105        ada0  MBR  (931G)
          63  1953525105           1  freebsd  [active]  (931G)</pre><p xml:lang="en" lang="en">In this case, the partition table must be edited to reduce
	the capacity by one sector on <code class="filename">mirror/gm0</code>.
	The procedure will be explained later.</p><p xml:lang="en" lang="en">In either case, partition tables on the primary disk
	should be first copied using <code class="command">gpart backup</code>
	and <code class="command">gpart restore</code>.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gpart backup ada0 &gt; table.ada0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart backup ada0s1 &gt; table.ada0s1</code></strong></pre><p xml:lang="en" lang="en">These commands create two files,
	<code class="filename">table.ada0</code> and
	<code class="filename">table.ada0s1</code>.  This example is from a
	1 TB drive:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cat table.ada0</code></strong>
MBR 4
1 freebsd         63 1953525105   [active]</pre><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cat table.ada0s1</code></strong>
BSD 8
1  freebsd-ufs          0    4194304
2 freebsd-swap    4194304   33554432
4  freebsd-ufs   37748736   50331648
5  freebsd-ufs   88080384   41943040
6  freebsd-ufs  130023424  838860800
7  freebsd-ufs  968884224  984640881</pre><p xml:lang="en" lang="en">If no free space is shown at the end of the disk, the size
	of both the slice and the last partition must be reduced by
	one sector.  Edit the two files, reducing the size of both the
	slice and last partition by one.  These are the last numbers
	in each listing.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cat table.ada0</code></strong>
MBR 4
1 freebsd         63 <span class="emphasis"><em>1953525104</em></span>   [active]</pre><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cat table.ada0s1</code></strong>
BSD 8
1  freebsd-ufs          0    4194304
2 freebsd-swap    4194304   33554432
4  freebsd-ufs   37748736   50331648
5  freebsd-ufs   88080384   41943040
6  freebsd-ufs  130023424  838860800
7  freebsd-ufs  968884224  <span class="emphasis"><em>984640880</em></span></pre><p xml:lang="en" lang="en">If at least one sector was unallocated at the end of the
	disk, these two files can be used without modification.</p><p xml:lang="en" lang="en">Now restore the partition table into
	<code class="filename">mirror/gm0</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gpart restore mirror/gm0 &lt; table.ada0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart restore mirror/gm0s1 &lt; table.ada0s1</code></strong></pre><p xml:lang="en" lang="en">Check the partition table with
	<code class="command">gpart show</code>.  This example has
	<code class="filename">gm0s1a</code> for <code class="filename">/</code>,
	<code class="filename">gm0s1d</code> for <code class="filename">/var</code>,
	<code class="filename">gm0s1e</code> for <code class="filename">/usr</code>,
	<code class="filename">gm0s1f</code> for <code class="filename">/data1</code>,
	and <code class="filename">gm0s1g</code> for
	<code class="filename">/data2</code>.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gpart show mirror/gm0</code></strong>
=&gt;        63  1953525104  mirror/gm0  MBR  (931G)
          63  1953525042           1  freebsd  [active]  (931G)
  1953525105          62              - free -  (31k)

<code class="prompt">#</code> <strong class="userinput"><code>gpart show mirror/gm0s1</code></strong>
=&gt;         0  1953525042  mirror/gm0s1  BSD  (931G)
           0     2097152             1  freebsd-ufs  (1.0G)
     2097152    16777216             2  freebsd-swap  (8.0G)
    18874368    41943040             4  freebsd-ufs  (20G)
    60817408    20971520             5  freebsd-ufs  (10G)
    81788928   629145600             6  freebsd-ufs  (300G)
   710934528  1242590514             7  freebsd-ufs  (592G)
  1953525042          63                - free -  (31k)</pre><p xml:lang="en" lang="en">Both the slice and the last partition must have at least
	one free block at the end of the disk.</p><p xml:lang="en" lang="en">Create file systems on these new partitions.  The number
	of partitions will vary to match the original disk,
	<code class="filename">ada0</code>.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/mirror/gm0s1a</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/mirror/gm0s1d</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/mirror/gm0s1e</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/mirror/gm0s1f</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/mirror/gm0s1g</code></strong></pre><p xml:lang="en" lang="en">Make the mirror bootable by installing bootcode in the
	<acronym class="acronym">MBR</acronym> and bsdlabel and setting the active
	slice:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -b /boot/mbr mirror/gm0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart set -a active -i 1 mirror/gm0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -b /boot/boot mirror/gm0s1</code></strong></pre><p xml:lang="en" lang="en">Adjust <code class="filename">/etc/fstab</code> to use the new
	partitions on the mirror.  Back up this file first by copying
	it to <code class="filename">/etc/fstab.orig</code>.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cp /etc/fstab /etc/fstab.orig</code></strong></pre><p xml:lang="en" lang="en">Edit <code class="filename">/etc/fstab</code>, replacing
	<code class="filename">/dev/ada0</code> with
	<code class="filename">mirror/gm0</code>.</p><pre xml:lang="en" class="programlisting" lang="en"># Device		Mountpoint	FStype	Options	Dump	Pass#
/dev/mirror/gm0s1a	/		ufs	rw	1	1
/dev/mirror/gm0s1b	none		swap	sw	0	0
/dev/mirror/gm0s1d	/var		ufs	rw	2	2
/dev/mirror/gm0s1e	/usr		ufs	rw	2	2
/dev/mirror/gm0s1f	/data1		ufs	rw	2	2
/dev/mirror/gm0s1g	/data2		ufs	rw	2	2</pre><p xml:lang="en" lang="en">If the <code class="filename">geom_mirror.ko</code> kernel module
	has not been built into the kernel, edit
	<code class="filename">/boot/loader.conf</code> to load it at
	boot:</p><pre xml:lang="en" class="programlisting" lang="en">geom_mirror_load="YES"</pre><p xml:lang="en" lang="en">File systems from the original disk can now be copied onto
	the mirror with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=restore&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">restore</span>(8)</span></a>.  Each file
	system dumped with <code class="command">dump -L</code> will create a
	snapshot first, which can take some time.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1a /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dump -C16 -b64 -0aL -f - /    | (cd /mnt &amp;&amp; restore -rf -)</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1d /mnt/var</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1e /mnt/usr</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1f /mnt/data1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1g /mnt/data2</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dump -C16 -b64 -0aL -f - /usr | (cd /mnt/usr &amp;&amp; restore -rf -)</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dump -C16 -b64 -0aL -f - /var | (cd /mnt/var &amp;&amp; restore -rf -)</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dump -C16 -b64 -0aL -f - /data1 | (cd /mnt/data1 &amp;&amp; restore -rf -)</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dump -C16 -b64 -0aL -f - /data2 | (cd /mnt/data2 &amp;&amp; restore -rf -)</code></strong></pre><p xml:lang="en" lang="en">Restart the system, booting from
	<code class="filename">ada1</code>.  If everything is working, the
	system will boot from <code class="filename">mirror/gm0</code>, which
	now contains the same data as <code class="filename">ada0</code> had
	previously.  See <a class="xref" href="#gmirror-troubleshooting" title="18.3.4. 疑難排解">節 18.3.4, “疑難排解”</a> if
	there are problems booting.</p><p xml:lang="en" lang="en">At this point, the mirror still consists of only the
	single <code class="filename">ada1</code> disk.</p><p xml:lang="en" lang="en">After booting from <code class="filename">mirror/gm0</code>
	successfully, the final step is inserting
	<code class="filename">ada0</code> into the mirror.</p><div xmlns="" class="important"><h3 class="admontitle">重要: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">When <code class="filename">ada0</code> is inserted into the
	  mirror, its former contents will be overwritten by data from
	  the mirror.  Make certain that
	  <code class="filename">mirror/gm0</code> has the same contents as
	  <code class="filename">ada0</code> before adding
	  <code class="filename">ada0</code> to the mirror.  If the contents
	  previously copied by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=restore&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">restore</span>(8)</span></a> are
	  not identical to what was on <code class="filename">ada0</code>,
	  revert <code class="filename">/etc/fstab</code> to mount the file
	  systems on <code class="filename">ada0</code>, reboot, and start the
	  whole procedure again.</p></div><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gmirror insert gm0 ada0</code></strong>
GEOM_MIRROR: Device gm0: rebuilding provider ada0</pre><p xml:lang="en" lang="en">Synchronization between the two disks will start
	immediately.  Use <code class="command">gmirror status</code> to view
	the progress.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gmirror status</code></strong>
      Name    Status  Components
mirror/gm0  DEGRADED  ada1 (ACTIVE)
                      ada0 (SYNCHRONIZING, 64%)</pre><p xml:lang="en" lang="en">After a while, synchronization will finish.</p><pre xml:lang="en" class="screen" lang="en">GEOM_MIRROR: Device gm0: rebuilding provider ada0 finished.
<code class="prompt">#</code> <strong class="userinput"><code>gmirror status</code></strong>
      Name    Status  Components
mirror/gm0  COMPLETE  ada1 (ACTIVE)
                      ada0 (ACTIVE)</pre><p xml:lang="en" lang="en"><code class="filename">mirror/gm0</code> now consists
	of the two disks <code class="filename">ada0</code> and
	<code class="filename">ada1</code>, and the contents are automatically
	synchronized with each other.  In use,
	<code class="filename">mirror/gm0</code> will behave just like the
	original single drive.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="gmirror-troubleshooting"></a>18.3.4. 疑難排解</h3></div></div></div><p xml:lang="en" lang="en">If the system no longer boots, <acronym class="acronym">BIOS</acronym>
	settings may have to be changed to boot from one of the new
	mirrored drives.  Either mirror drive can be used for booting,
	as they contain identical data.</p><p xml:lang="en" lang="en">If the boot stops with this message, something is wrong
	with the mirror device:</p><pre xml:lang="en" class="screen" lang="en">Mounting from ufs:/dev/mirror/gm0s1a failed with error 19.

Loader variables:
  vfs.root.mountfrom=ufs:/dev/mirror/gm0s1a
  vfs.root.mountfrom.options=rw

Manual root filesystem specification:
  &lt;fstype&gt;:&lt;device&gt; [options]
      Mount &lt;device&gt; using filesystem &lt;fstype&gt;
      and with the specified (optional) option list.

    eg. ufs:/dev/da0s1a
        zfs:tank
        cd9660:/dev/acd0 ro
          (which is equivalent to: mount -t cd9660 -o ro /dev/acd0 /)

  ?               List valid disk boot devices
  .               Yield 1 second (for background tasks)
  &lt;empty line&gt;    Abort manual input

mountroot&gt;</pre><p xml:lang="en" lang="en">Forgetting to load the <code class="filename">geom_mirror.ko</code>
	module in <code class="filename">/boot/loader.conf</code> can cause
	this problem.  To fix it, boot from a FreeBSD
	installation media and choose <code class="literal">Shell</code> at the
	first prompt.  Then load the mirror module and mount the
	mirror device:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gmirror load</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1a /mnt</code></strong></pre><p xml:lang="en" lang="en">Edit <code class="filename">/mnt/boot/loader.conf</code>, adding a
	line to load the mirror module:</p><pre xml:lang="en" class="programlisting" lang="en">geom_mirror_load="YES"</pre><p xml:lang="en" lang="en">Save the file and reboot.</p><p xml:lang="en" lang="en">Other problems that cause <span class="errorname">error 19</span>
	require more effort to fix.  Although the system should boot
	from <code class="filename">ada0</code>, another prompt to select a
	shell will appear if <code class="filename">/etc/fstab</code> is
	incorrect.  Enter <code class="literal">ufs:/dev/ada0s1a</code> at the
	boot loader prompt and press <span class="keycap"><strong>Enter</strong></span>.  Undo the
	edits in <code class="filename">/etc/fstab</code> then mount the file
	systems from the original disk (<code class="filename">ada0</code>)
	instead of the mirror.  Reboot the system and try the
	procedure again.</p><pre xml:lang="en" class="screen" lang="en">Enter full pathname of shell or RETURN for /bin/sh:
<code class="prompt">#</code> <strong class="userinput"><code>cp /etc/fstab.orig /etc/fstab</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>reboot</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76872888"></a>18.3.5. 自磁碟故障復原</h3></div></div></div><p xml:lang="en" lang="en">The benefit of disk mirroring is that an individual disk
	can fail without causing the mirror to lose any data.  In the
	above example, if <code class="filename">ada0</code> fails, the mirror
	will continue to work, providing data from the remaining
	working drive, <code class="filename">ada1</code>.</p><p xml:lang="en" lang="en">To replace the failed drive, shut down the system and
	physically replace the failed drive with a new drive of equal
	or greater capacity.  Manufacturers use somewhat arbitrary
	values when rating drives in gigabytes, and the only way to
	really be sure is to compare the total count of sectors shown
	by <code class="command">diskinfo -v</code>.  A drive with larger
	capacity than the mirror will work, although the extra space
	on the new drive will not be used.</p><p xml:lang="en" lang="en">After the computer is powered back up, the mirror will be
	running in a <span class="quote">“<span class="quote">degraded</span>”</span> mode with only one drive.
	The mirror is told to forget drives that are not currently
	connected:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gmirror forget gm0</code></strong></pre><p xml:lang="en" lang="en">Any old metadata should be cleared from the replacement
	disk using the instructions in
	<a class="xref" href="#geom-mirror-metadata" title="18.3.1. Metadata 問題">節 18.3.1, “Metadata 問題”</a>.  Then the replacement
	disk, <code class="filename">ada4</code> for this example, is inserted
	into the mirror:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gmirror insert gm0 /dev/ada4</code></strong></pre><p xml:lang="en" lang="en">Resynchronization begins when the new drive is inserted
	into the mirror.  This process of copying mirror data to a new
	drive can take a while.  Performance of the mirror will be
	greatly reduced during the copy, so inserting new drives is
	best done when there is low demand on the computer.</p><p xml:lang="en" lang="en">Progress can be monitored with <code class="command">gmirror
	  status</code>, which shows drives that are being
	synchronized and the percentage of completion.  During
	resynchronization, the status will be
	<code class="computeroutput">DEGRADED</code>, changing to
	<code class="computeroutput">COMPLETE</code> when the process is
	finished.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="geom-raid3"></a>18.4. <acronym class="acronym">RAID</acronym>3 - 位元級串連與獨立奇偶校驗</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Mark</span> <span class="surname">Gladman</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Daniel</span> <span class="surname">Gerzo</span></span>. </span></div><div><span class="authorgroup">Based on documentation by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Murray</span> <span class="surname">Stokely</span></span>. </span></div></div></div><a id="idp76912568" class="indexterm"></a><a id="idp76913592" class="indexterm"></a><p xml:lang="en" lang="en"><acronym class="acronym">RAID</acronym>3 is a method used to combine several
      disk drives into a single volume with a dedicated parity disk.
      In a <acronym class="acronym">RAID</acronym>3 system, data is split up into a
      number of bytes that are written across all the drives in the
      array except for one disk which acts as a dedicated parity disk.
      This means that disk reads from a <acronym class="acronym">RAID</acronym>3
      implementation access all disks in the array.  Performance can
      be enhanced by using multiple disk controllers.  The
      <acronym class="acronym">RAID</acronym>3 array provides a fault tolerance of 1
      drive, while providing a capacity of 1 - 1/n times the total
      capacity of all drives in the array, where n is the number of
      hard drives in the array.  Such a configuration is mostly
      suitable for storing data of larger sizes such as multimedia
      files.</p><p xml:lang="en" lang="en">At least 3 physical hard drives are required to build a
      <acronym class="acronym">RAID</acronym>3 array.  Each disk must be of the same
      size, since <acronym class="acronym">I/O</acronym> requests are interleaved to
      read or write to multiple disks in parallel.  Also, due to the
      nature of <acronym class="acronym">RAID</acronym>3, the number of drives must be
      equal to 3, 5, 9, 17, and so on, or 2^n + 1.</p><p xml:lang="en" lang="en">This section demonstrates how to create a software
      <acronym class="acronym">RAID</acronym>3 on a FreeBSD system.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">While it is theoretically possible to boot from a
	<acronym class="acronym">RAID</acronym>3 array on FreeBSD, that configuration is
	uncommon and is not advised.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76924600"></a>18.4.1. 建立 Dedicated <acronym class="acronym">RAID</acronym>3 陣列</h3></div></div></div><p xml:lang="en" lang="en">In FreeBSD, support for <acronym class="acronym">RAID</acronym>3 is
	implemented by the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid3&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid3</span>(8)</span></a> <acronym class="acronym">GEOM</acronym>
	class.  Creating a dedicated <acronym class="acronym">RAID</acronym>3 array on
	FreeBSD requires the following steps.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">First, load the <code class="filename">geom_raid3.ko</code>
	    kernel module by issuing one of the following
	    commands:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>graid3 load</code></strong></pre><p xml:lang="en" lang="en">or:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload geom_raid3</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">Ensure that a suitable mount point exists.  This
	    command creates a new directory to use as the mount
	    point:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mkdir <em class="replaceable"><code>/multimedia</code></em></code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">Determine the device names for the disks which will be
	    added to the array, and create the new
	    <acronym class="acronym">RAID</acronym>3 device.  The final device listed
	    will act as the dedicated parity disk.  This example uses
	    three unpartitioned <acronym class="acronym">ATA</acronym> drives:
	    <code class="filename"><em class="replaceable"><code>ada1</code></em></code> and
	    <code class="filename"><em class="replaceable"><code>ada2</code></em></code> for
	    data, and
	    <code class="filename"><em class="replaceable"><code>ada3</code></em></code> for
	    parity.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>graid3 label -v gr0 /dev/ada1 /dev/ada2 /dev/ada3</code></strong>
Metadata value stored on /dev/ada1.
Metadata value stored on /dev/ada2.
Metadata value stored on /dev/ada3.
Done.</pre></li><li class="step"><p xml:lang="en" lang="en">Partition the newly created <code class="filename">gr0</code>
	    device and put a <acronym class="acronym">UFS</acronym> file system on
	    it:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gpart create -s GPT /dev/raid3/gr0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart add -t freebsd-ufs /dev/raid3/gr0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -j /dev/raid3/gr0p1</code></strong></pre><p xml:lang="en" lang="en">Many numbers will glide across the screen, and after a
	    bit of time, the process will be complete.  The volume has
	    been created and is ready to be mounted:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount /dev/raid3/gr0p1 /multimedia/</code></strong></pre><p xml:lang="en" lang="en">The <acronym class="acronym">RAID</acronym>3 array is now ready to
	    use.</p></li></ol></div><p xml:lang="en" lang="en">Additional configuration is needed to retain this setup
	across system reboots.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">The <code class="filename">geom_raid3.ko</code> module must be
	    loaded before the array can be mounted.  To automatically
	    load the kernel module during system initialization, add
	    the following line to
	    <code class="filename">/boot/loader.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">geom_raid3_load="YES"</pre></li><li class="step"><p xml:lang="en" lang="en">The following volume information must be added to
	    <code class="filename">/etc/fstab</code> in order to
	    automatically mount the array's file system during the
	    system boot process:</p><pre xml:lang="en" class="programlisting" lang="en">/dev/raid3/gr0p1	/multimedia	ufs	rw	2	2</pre></li></ol></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="geom-graid"></a>18.5. 軟體 <acronym class="acronym">RAID</acronym> 裝置</h2></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Warren</span> <span class="surname">Block</span></span>. </span></div></div></div><a id="idp76971320" class="indexterm"></a><a id="idp76972344" class="indexterm"></a><p xml:lang="en" lang="en">Some motherboards and expansion cards add some simple
      hardware, usually just a <acronym class="acronym">ROM</acronym>, that allows the
      computer to boot from a <acronym class="acronym">RAID</acronym> array.  After
      booting, access to the <acronym class="acronym">RAID</acronym> array is handled
      by software running on the computer's main processor.  This
      <span class="quote">“<span class="quote">hardware-assisted software
	<acronym class="acronym">RAID</acronym></span>”</span> gives <acronym class="acronym">RAID</acronym>
      arrays that are not dependent on any particular operating
      system, and which are functional even before an operating system
      is loaded.</p><p xml:lang="en" lang="en">Several levels of <acronym class="acronym">RAID</acronym> are supported,
      depending on the hardware in use.  See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> for a
      complete list.</p><p xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> requires the <code class="filename">geom_raid.ko</code>
      kernel module, which is included in the
      <code class="filename">GENERIC</code> kernel starting with FreeBSD 9.1.
      If needed, it can be loaded manually with
      <code class="command">graid load</code>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-graid-creating"></a>18.5.1. 建立陣列</h3></div></div></div><p xml:lang="en" lang="en">Software <acronym class="acronym">RAID</acronym> devices often have a menu
	that can be entered by pressing special keys when the computer
	is booting.  The menu can be used to create and delete
	<acronym class="acronym">RAID</acronym> arrays.  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> can also create
	arrays directly from the command line.</p><p xml:lang="en" lang="en"><code class="command">graid label</code> is used to create a new
	array.  The motherboard used for this example has an Intel
	software <acronym class="acronym">RAID</acronym> chipset, so the Intel
	metadata format is specified.  The new array is given a label
	of <code class="filename">gm0</code>, it is a mirror
	(<acronym class="acronym">RAID1</acronym>), and uses drives
	<code class="filename">ada0</code> and
	<code class="filename">ada1</code>.</p><div xmlns="" class="caution"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Some space on the drives will be overwritten when they
	  are made into a new array.  Back up existing data
	  first!</p></div><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>graid label Intel gm0 RAID1 ada0 ada1</code></strong>
GEOM_RAID: Intel-a29ea104: Array Intel-a29ea104 created.
GEOM_RAID: Intel-a29ea104: Disk ada0 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:0-ada0 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Disk ada1 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-ada1 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Array started.
GEOM_RAID: Intel-a29ea104: Volume gm0 state changed from STARTING to OPTIMAL.
Intel-a29ea104 created
GEOM_RAID: Intel-a29ea104: Provider raid/r0 for volume gm0 created.</pre><p xml:lang="en" lang="en">A status check shows the new mirror is ready for
	use:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>graid status</code></strong>
   Name   Status  Components
raid/r0  OPTIMAL  ada0 (ACTIVE (ACTIVE))
                  ada1 (ACTIVE (ACTIVE))</pre><p xml:lang="en" lang="en">The array device appears in
	<code class="filename">/dev/raid/</code>.  The first array is called
	<code class="filename">r0</code>.  Additional arrays, if present, will
	be <code class="filename">r1</code>, <code class="filename">r2</code>, and so
	on.</p><p xml:lang="en" lang="en">The <acronym class="acronym">BIOS</acronym> menu on some of these devices
	can create arrays with special characters in their names.  To
	avoid problems with those special characters, arrays are given
	simple numbered names like <code class="filename">r0</code>.  To show
	the actual labels, like <code class="filename">gm0</code> in the
	example above, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysctl kern.geom.raid.name_format=1</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-graid-volumes"></a>18.5.2. 多磁碟區</h3></div></div></div><p xml:lang="en" lang="en">Some software <acronym class="acronym">RAID</acronym> devices support
	more than one <span class="emphasis"><em>volume</em></span> on an array.
	Volumes work like partitions, allowing space on the physical
	drives to be split and used in different ways.  For example,
	Intel software <acronym class="acronym">RAID</acronym> devices support two
	volumes.  This example creates a 40 G mirror for safely
	storing the operating system, followed by a 20 G
	<acronym class="acronym">RAID0</acronym> (stripe) volume for fast temporary
	storage:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>graid label -S 40G Intel gm0 RAID1 ada0 ada1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>graid add -S 20G gm0 RAID0</code></strong></pre><p xml:lang="en" lang="en">Volumes appear as additional
	<code class="filename">r<em class="replaceable"><code>X</code></em></code> entries
	in <code class="filename">/dev/raid/</code>.  An array with two volumes
	will show <code class="filename">r0</code> and
	<code class="filename">r1</code>.</p><p xml:lang="en" lang="en">See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> for the number of volumes supported by
	different software <acronym class="acronym">RAID</acronym> devices.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-graid-converting"></a>18.5.3. 轉換單一磁碟為鏡像</h3></div></div></div><p xml:lang="en" lang="en">Under certain specific conditions, it is possible to
	convert an existing single drive to a <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> array
	without reformatting.  To avoid data loss during the
	conversion, the existing drive must meet these minimum
	requirements:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">The drive must be partitioned with the
	    <acronym class="acronym">MBR</acronym> partitioning scheme.
	    <acronym class="acronym">GPT</acronym> or other partitioning schemes with
	    metadata at the end of the drive will be overwritten and
	    corrupted by the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> metadata.</p></li><li class="listitem"><p xml:lang="en" lang="en">There must be enough unpartitioned and unused space at
	    the end of the drive to hold the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> metadata.
	    This metadata varies in size, but the largest occupies
	    64 M, so at least that much free space is
	    recommended.</p></li></ul></div><p xml:lang="en" lang="en">If the drive meets these requirements, start by making a
	full backup.  Then create a single-drive mirror with that
	drive:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>graid label Intel gm0 RAID1 ada0 NONE</code></strong></pre><p xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> metadata was written to the end of the drive
	in the unused space.  A second drive can now be inserted into
	the mirror:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>graid insert raid/r0 ada1</code></strong></pre><p xml:lang="en" lang="en">Data from the original drive will immediately begin to be
	copied to the second drive.  The mirror will operate in
	degraded status until the copy is complete.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-graid-inserting"></a>18.5.4. 插入新磁碟到陣列</h3></div></div></div><p xml:lang="en" lang="en">Drives can be inserted into an array as replacements for
	drives that have failed or are missing.  If there are no
	failed or missing drives, the new drive becomes a spare.  For
	example, inserting a new drive into a working two-drive mirror
	results in a two-drive mirror with one spare drive, not a
	three-drive mirror.</p><p xml:lang="en" lang="en">In the example mirror array, data immediately begins to be
	copied to the newly-inserted drive.  Any existing information
	on the new drive will be overwritten.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>graid insert raid/r0 ada1</code></strong>
GEOM_RAID: Intel-a29ea104: Disk ada1 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-ada1 state changed from NONE to NEW.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-ada1 state changed from NEW to REBUILD.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-ada1 rebuild start at 0.</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-graid-removing"></a>18.5.5. 從陣列移除磁碟</h3></div></div></div><p xml:lang="en" lang="en">Individual drives can be permanently removed from a
	from an array and their metadata erased:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>graid remove raid/r0 ada1</code></strong>
GEOM_RAID: Intel-a29ea104: Disk ada1 state changed from ACTIVE to OFFLINE.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-[unknown] state changed from ACTIVE to NONE.
GEOM_RAID: Intel-a29ea104: Volume gm0 state changed from OPTIMAL to DEGRADED.</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-graid-stopping"></a>18.5.6. 停止陣列</h3></div></div></div><p xml:lang="en" lang="en">An array can be stopped without removing metadata from the
	drives.  The array will be restarted when the system is
	booted.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>graid stop raid/r0</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-graid-status"></a>18.5.7. 檢查陣列狀態</h3></div></div></div><p xml:lang="en" lang="en">Array status can be checked at any time.  After a drive
	was added to the mirror in the example above, data is being
	copied from the original drive to the new drive:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>graid status</code></strong>
   Name    Status  Components
raid/r0  DEGRADED  ada0 (ACTIVE (ACTIVE))
                   ada1 (ACTIVE (REBUILD 28%))</pre><p xml:lang="en" lang="en">Some types of arrays, like <code class="literal">RAID0</code> or
	<code class="literal">CONCAT</code>, may not be shown in the status
	report if disks have failed.  To see these partially-failed
	arrays, add <code class="option">-ga</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>graid status -ga</code></strong>
          Name  Status  Components
Intel-e2d07d9a  BROKEN  ada6 (ACTIVE (ACTIVE))</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-graid-deleting"></a>18.5.8. 刪除陣列</h3></div></div></div><p xml:lang="en" lang="en">Arrays are destroyed by deleting all of the volumes from
	them.  When the last volume present is deleted, the array is
	stopped and metadata is removed from the drives:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>graid delete raid/r0</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-graid-unexpected"></a>18.5.9. 刪除預期之外的陣列</h3></div></div></div><p xml:lang="en" lang="en">Drives may unexpectedly contain <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> metadata,
	either from previous use or manufacturer testing.
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> will detect these drives and create an array,
	interfering with access to the individual drive.  To remove
	the unwanted metadata:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">Boot the system.  At the boot menu, select
	    <code class="literal">2</code> for the loader prompt.  Enter:</p><pre xml:lang="en" class="screen" lang="en">OK <strong class="userinput"><code>set kern.geom.raid.enable=0</code></strong>
OK <strong class="userinput"><code>boot</code></strong></pre><p xml:lang="en" lang="en">The system will boot with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a>
	    disabled.</p></li><li class="step"><p xml:lang="en" lang="en">Back up all data on the affected drive.</p></li><li class="step"><p xml:lang="en" lang="en">As a workaround, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> array detection
	    can be disabled by adding</p><pre xml:lang="en" class="programlisting" lang="en">kern.geom.raid.enable=0</pre><p xml:lang="en" lang="en">to <code class="filename">/boot/loader.conf</code>.</p><p xml:lang="en" lang="en">To permanently remove the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> metadata
	    from the affected drive, boot a FreeBSD installation
	    <acronym class="acronym">CD-ROM</acronym> or memory stick, and select
	    <code class="literal">Shell</code>.  Use <code class="command">status</code>
	    to find the name of the array, typically
	    <code class="literal">raid/r0</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>graid status</code></strong>
   Name   Status  Components
raid/r0  OPTIMAL  ada0 (ACTIVE (ACTIVE))
                  ada1 (ACTIVE (ACTIVE))</pre><p xml:lang="en" lang="en">Delete the volume by name:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>graid delete raid/r0</code></strong></pre><p xml:lang="en" lang="en">If there is more than one volume shown, repeat the
	    process for each volume.  After the last array has been
	    deleted, the volume will be destroyed.</p><p xml:lang="en" lang="en">Reboot and verify data, restoring from backup if
	    necessary.  After the metadata has been removed, the
	    <code class="literal">kern.geom.raid.enable=0</code> entry in
	    <code class="filename">/boot/loader.conf</code> can also be
	    removed.</p></li></ol></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="geom-ggate"></a>18.6. <acronym class="acronym">GEOM</acronym> Gate Network</h2></div></div></div><p xml:lang="en" lang="en"><acronym class="acronym">GEOM</acronym> provides a simple mechanism for
      providing remote access to devices such as disks,
      <acronym class="acronym">CD</acronym>s, and file systems through the use of the
      <acronym class="acronym">GEOM</acronym> Gate network daemon,
      <span class="application">ggated</span>.  The system with the device
      runs the server daemon which handles requests made by clients
      using <span class="application">ggatec</span>.  The devices should not
      contain any sensitive data as the connection between the client
      and the server is not encrypted.</p><p xml:lang="en" lang="en">Similar to <acronym class="acronym">NFS</acronym>, which is discussed in
      <a class="xref" href="#network-nfs" title="29.3. 網路檔案系統 (NFS)">節 29.3, “網路檔案系統 (NFS)”</a>, <span class="application">ggated</span>
      is configured using an exports file.  This file specifies which
      systems are permitted to access the exported resources and what
      level of access they are offered.  For example, to give the
      client <code class="systemitem">192.168.1.5</code>
      read and write access to the fourth slice on the first
      <acronym class="acronym">SCSI</acronym> disk, create
      <code class="filename">/etc/gg.exports</code> with this line:</p><pre xml:lang="en" class="programlisting" lang="en">192.168.1.5 RW /dev/da0s4d</pre><p xml:lang="en" lang="en">Before exporting the device, ensure it is not currently
      mounted.  Then, start <span class="application">ggated</span>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ggated</code></strong></pre><p xml:lang="en" lang="en">Several options are available for specifying an alternate
      listening port or changing the default location of the exports
      file.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ggated&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ggated</span>(8)</span></a> for details.</p><p xml:lang="en" lang="en">To access the exported device on the client machine, first
      use <code class="command">ggatec</code> to specify the
      <acronym class="acronym">IP</acronym> address of the server and the device name
      of the exported device.  If successful, this command will
      display a <code class="literal">ggate</code> device name to mount.  Mount
      that specified device name on a free mount point.  This example
      connects to the <code class="filename">/dev/da0s4d</code> partition on
      <code class="literal">192.168.1.1</code>, then mounts
      <code class="filename">/dev/ggate0</code> on
      <code class="filename">/mnt</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ggatec create -o rw 192.168.1.1 /dev/da0s4d</code></strong>
ggate0
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/ggate0 /mnt</code></strong></pre><p xml:lang="en" lang="en">The device on the server may now be accessed through
      <code class="filename">/mnt</code> on the client.  For more details about
      <code class="command">ggatec</code> and a few usage examples, refer to
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ggatec&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ggatec</span>(8)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The mount will fail if the device is currently mounted on
	either the server or any other client on the network.  If
	simultaneous access is needed to network resources, use
	<acronym class="acronym">NFS</acronym> instead.</p></div><p xml:lang="en" lang="en">When the device is no longer needed, unmount it with
      <code class="command">umount</code> so that the resource is available to
      other clients.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="geom-glabel"></a>18.7. 磁碟裝置標籤</h2></div></div></div><a id="idp77119544" class="indexterm"></a><a id="idp77120568" class="indexterm"></a><p xml:lang="en" lang="en">During system initialization, the FreeBSD kernel creates
      device nodes as devices are found.  This method of probing for
      devices raises some issues.  For instance, what if a new disk
      device is added via <acronym class="acronym">USB</acronym>?  It is likely that
      a flash device may be handed the device name of
      <code class="filename">da0</code> and the original
      <code class="filename">da0</code> shifted to
      <code class="filename">da1</code>.  This will cause issues mounting
      file systems if they are listed in
      <code class="filename">/etc/fstab</code> which may also prevent the
      system from booting.</p><p xml:lang="en" lang="en">One solution is to chain <acronym class="acronym">SCSI</acronym> devices
      in order so a new device added to the <acronym class="acronym">SCSI</acronym>
      card will be issued unused device numbers.  But what about
      <acronym class="acronym">USB</acronym> devices which may replace the primary
      <acronym class="acronym">SCSI</acronym> disk?  This happens because
      <acronym class="acronym">USB</acronym> devices are usually probed before the
      <acronym class="acronym">SCSI</acronym> card.  One solution is to only insert
      these devices after the system has been booted.  Another method
      is to use only a single <acronym class="acronym">ATA</acronym> drive and never
      list the <acronym class="acronym">SCSI</acronym> devices in
      <code class="filename">/etc/fstab</code>.</p><p xml:lang="en" lang="en">A better solution is to use <code class="command">glabel</code> to
      label the disk devices and use the labels in
      <code class="filename">/etc/fstab</code>.  Because
      <code class="command">glabel</code> stores the label in the last sector of
      a given provider, the label will remain persistent across
      reboots.  By using this label as a device, the file system may
      always be mounted regardless of what device node it is accessed
      through.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><code class="command">glabel</code> can create both transient and
	permanent labels.  Only permanent labels are consistent across
	reboots.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=glabel&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">glabel</span>(8)</span></a> for more information on the
	differences between labels.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77152056"></a>18.7.1. 標籤類型與範例</h3></div></div></div><p xml:lang="en" lang="en">Permanent labels can be a generic or a file system label.
	Permanent file system labels can be created with
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a> or <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=newfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">newfs</span>(8)</span></a>.  These types of labels are
	created in a sub-directory of <code class="filename">/dev</code>, and
	will be named according to the file system type.  For example,
	<acronym class="acronym">UFS</acronym>2 file system labels will be created in
	<code class="filename">/dev/ufs</code>.  Generic permanent labels can
	be created with <code class="command">glabel label</code>.  These are
	not file system specific and will be created in
	<code class="filename">/dev/label</code>.</p><p xml:lang="en" lang="en">Temporary labels are destroyed at the next reboot.  These
	labels are created in <code class="filename">/dev/label</code> and are
	suited to experimentation.  A temporary label can be created
	using <code class="command">glabel create</code>.</p><p xml:lang="en" lang="en">To create a permanent label for a
	<acronym class="acronym">UFS</acronym>2 file system without destroying any
	data, issue the following command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>tunefs -L <em class="replaceable"><code>home</code></em> <em class="replaceable"><code>/dev/da3</code></em></code></strong></pre><p xml:lang="en" lang="en">A label should now exist in <code class="filename">/dev/ufs</code>
	which may be added to <code class="filename">/etc/fstab</code>:</p><pre xml:lang="en" class="programlisting" lang="en">/dev/ufs/home		/home            ufs     rw              2      2</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The file system must not be mounted while attempting
	  to run <code class="command">tunefs</code>.</p></div><p xml:lang="en" lang="en">Now the file system may be mounted:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount /home</code></strong></pre><p xml:lang="en" lang="en">From this point on, so long as the
	<code class="filename">geom_label.ko</code> kernel module is loaded at
	boot with <code class="filename">/boot/loader.conf</code> or the
	<code class="literal">GEOM_LABEL</code> kernel option is present,
	the device node may change without any ill effect on the
	system.</p><p xml:lang="en" lang="en">File systems may also be created with a default label
	by using the <code class="option">-L</code> flag with
	<code class="command">newfs</code>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=newfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">newfs</span>(8)</span></a> for
	more information.</p><p xml:lang="en" lang="en">The following command can be used to destroy the
	label:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>glabel destroy home</code></strong></pre><p xml:lang="en" lang="en">The following example shows how to label the partitions of
	a boot disk.</p><div class="example"><a id="idp77175352"></a><div class="example-title">範例 18.1. 在開機磁碟標記分割區標籤</div><div class="example-contents"><p xml:lang="en" lang="en">By permanently labeling the partitions on the boot disk,
	  the system should be able to continue to boot normally, even
	  if the disk is moved to another controller or transferred to
	  a different system.  For this example, it is assumed that a
	  single <acronym class="acronym">ATA</acronym> disk is used, which is
	  currently recognized by the system as
	  <code class="filename">ad0</code>.  It is also assumed that the
	  standard FreeBSD partition scheme is used, with
	  <code class="filename">/</code>,
	  <code class="filename">/var</code>,
	  <code class="filename">/usr</code> and
	  <code class="filename">/tmp</code>, as
	  well as a swap partition.</p><p xml:lang="en" lang="en">Reboot the system, and at the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a> prompt,
	  press <span class="keycap"><strong>4</strong></span> to boot into single user mode.
	  Then enter the following commands:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>glabel label rootfs /dev/ad0s1a</code></strong>
GEOM_LABEL: Label for provider /dev/ad0s1a is label/rootfs
<code class="prompt">#</code> <strong class="userinput"><code>glabel label var /dev/ad0s1d</code></strong>
GEOM_LABEL: Label for provider /dev/ad0s1d is label/var
<code class="prompt">#</code> <strong class="userinput"><code>glabel label usr /dev/ad0s1f</code></strong>
GEOM_LABEL: Label for provider /dev/ad0s1f is label/usr
<code class="prompt">#</code> <strong class="userinput"><code>glabel label tmp /dev/ad0s1e</code></strong>
GEOM_LABEL: Label for provider /dev/ad0s1e is label/tmp
<code class="prompt">#</code> <strong class="userinput"><code>glabel label swap /dev/ad0s1b</code></strong>
GEOM_LABEL: Label for provider /dev/ad0s1b is label/swap
<code class="prompt">#</code> <strong class="userinput"><code>exit</code></strong></pre><p xml:lang="en" lang="en">The system will continue with multi-user boot.  After
	  the boot completes, edit <code class="filename">/etc/fstab</code> and
	  replace the conventional device names, with their respective
	  labels.  The final <code class="filename">/etc/fstab</code> will
	  look like this:</p><pre xml:lang="en" class="programlisting" lang="en"># Device                Mountpoint      FStype  Options         Dump    Pass#
/dev/label/swap         none            swap    sw              0       0
/dev/label/rootfs       /               ufs     rw              1       1
/dev/label/tmp          /tmp            ufs     rw              2       2
/dev/label/usr          /usr            ufs     rw              2       2
/dev/label/var          /var            ufs     rw              2       2</pre><p xml:lang="en" lang="en">The system can now be rebooted.  If everything went
	  well, it will come up normally and <code class="command">mount</code>
	  will show:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount</code></strong>
/dev/label/rootfs on / (ufs, local)
devfs on /dev (devfs, local)
/dev/label/tmp on /tmp (ufs, local, soft-updates)
/dev/label/usr on /usr (ufs, local, soft-updates)
/dev/label/var on /var (ufs, local, soft-updates)</pre></div></div><br class="example-break" /><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=glabel&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">glabel</span>(8)</span></a> class
	supports a label type for <acronym class="acronym">UFS</acronym> file
	systems, based on the unique file system id,
	<code class="literal">ufsid</code>.  These labels may be found in
	<code class="filename">/dev/ufsid</code> and are
	created automatically during system startup.  It is possible
	to use <code class="literal">ufsid</code> labels to mount partitions
	using <code class="filename">/etc/fstab</code>.  Use <code class="command">glabel
	  status</code> to receive a list of file systems and their
	corresponding <code class="literal">ufsid</code> labels:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>glabel status</code></strong>
                  Name  Status  Components
ufsid/486b6fc38d330916     N/A  ad4s1d
ufsid/486b6fc16926168e     N/A  ad4s1f</pre><p xml:lang="en" lang="en">In the above example, <code class="filename">ad4s1d</code>
	represents <code class="filename">/var</code>,
	while <code class="filename">ad4s1f</code> represents
	<code class="filename">/usr</code>.
	Using the <code class="literal">ufsid</code> values shown, these
	partitions may now be mounted with the following entries in
	<code class="filename">/etc/fstab</code>:</p><pre xml:lang="en" class="programlisting" lang="en">/dev/ufsid/486b6fc38d330916        /var        ufs        rw        2      2
/dev/ufsid/486b6fc16926168e        /usr        ufs        rw        2      2</pre><p xml:lang="en" lang="en">Any partitions with <code class="literal">ufsid</code> labels can be
	mounted in this way, eliminating the need to manually create
	permanent labels, while still enjoying the benefits of device
	name independent mounting.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="geom-gjournal"></a>18.8. UFS Journaling 透過 <acronym class="acronym">GEOM</acronym></h2></div></div></div><a id="idp77277880" class="indexterm"></a><a id="idp77278904" class="indexterm"></a><p xml:lang="en" lang="en">Support for journals on
      <acronym class="acronym">UFS</acronym> file systems is available on FreeBSD.  The
      implementation is provided through the <acronym class="acronym">GEOM</acronym>
      subsystem and is configured using <code class="command">gjournal</code>.
      Unlike other file system journaling implementations, the
      <code class="command">gjournal</code> method is block based and not
      implemented as part of the file system.  It is a
      <acronym class="acronym">GEOM</acronym> extension.</p><p xml:lang="en" lang="en">Journaling stores a log of file system transactions, such as
      changes that make up a complete disk write operation, before
      meta-data and file writes are committed to the disk.  This
      transaction log can later be replayed to redo file system
      transactions, preventing file system inconsistencies.</p><p xml:lang="en" lang="en">This method provides another mechanism to protect against
      data loss and inconsistencies of the file system.  Unlike Soft
      Updates, which tracks and enforces meta-data updates, and
      snapshots, which create an image of the file system, a log is
      stored in disk space specifically for this task.  For better
      performance, the journal may be stored on another disk.  In this
      configuration, the journal provider or storage device should be
      listed after the device to enable journaling on.</p><p xml:lang="en" lang="en">The <code class="filename">GENERIC</code> kernel provides support for
      <code class="command">gjournal</code>.  To automatically load the
      <code class="filename">geom_journal.ko</code> kernel module at boot time,
      add the following line to
      <code class="filename">/boot/loader.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">geom_journal_load="YES"</pre><p xml:lang="en" lang="en">If a custom kernel is used, ensure the following line is in
      the kernel configuration file:</p><pre xml:lang="en" class="programlisting" lang="en">options	GEOM_JOURNAL</pre><p xml:lang="en" lang="en">Once the module is loaded, a journal can be created on a new
      file system using the following steps.  In this example,
      <code class="filename">da4</code> is a new <acronym class="acronym">SCSI</acronym>
      disk:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gjournal load</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gjournal label /dev/<em class="replaceable"><code>da4</code></em></code></strong></pre><p xml:lang="en" lang="en">This will load the module and create a
      <code class="filename">/dev/da4.journal</code> device node on
      <code class="filename">/dev/da4</code>.</p><p xml:lang="en" lang="en">A <acronym class="acronym">UFS</acronym> file system may now be created on
      the journaled device, then mounted on an existing mount
      point:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>newfs -O 2 -J /dev/<em class="replaceable"><code>da4</code></em>.journal</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/<em class="replaceable"><code>da4</code></em>.journal <em class="replaceable"><code>/mnt</code></em></code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">In the case of several slices, a journal will be created
	for each individual slice.  For instance, if
	<code class="filename">ad4s1</code> and <code class="filename">ad4s2</code> are
	both slices, then <code class="command">gjournal</code> will create
	<code class="filename">ad4s1.journal</code> and
	<code class="filename">ad4s2.journal</code>.</p></div><p xml:lang="en" lang="en">Journaling may also be enabled on current file systems by
      using <code class="command">tunefs</code>.  However,
      <span class="emphasis"><em>always</em></span> make a backup before attempting to
      alter an existing file system.  In most cases,
      <code class="command">gjournal</code> will fail if it is unable to create
      the journal, but this does not protect against data loss
      incurred as a result of misusing <code class="command">tunefs</code>.
      Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gjournal&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gjournal</span>(8)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a> for more
      information about these commands.</p><p xml:lang="en" lang="en">It is possible to journal the boot disk of a FreeBSD system.
      Refer to the article <a class="link" href="../../../../doc/en_US.ISO8859-1/articles/gjournal-desktop" target="_top">Implementing UFS
	Journaling on a Desktop PC</a> for detailed
      instructions.</p></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs"></a>章 19. Z 檔案系統 (<acronym class="acronym">ZFS</acronym>)</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>, <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Allan</span> <span class="surname">Jude</span></span>, <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Benedict</span> <span class="surname">Reuschling</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Warren</span> <span class="surname">Block</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#zfs-differences">19.1. 什麼使 <acronym class="acronym">ZFS</acronym> 與眾不同</a></span></dt><dt><span class="sect1"><a href="#zfs-quickstart">19.2. 快速入門指南</a></span></dt><dd><dl><dt><span class="sect2"><a href="#zfs-quickstart-single-disk-pool">19.2.1. 單磁碟儲存池</a></span></dt><dt><span class="sect2"><a href="#zfs-quickstart-raid-z">19.2.2. RAID-Z</a></span></dt><dt><span class="sect2"><a href="#zfs-quickstart-recovering-raid-z">19.2.3. 復原 <acronym class="acronym">RAID-Z</acronym></a></span></dt><dt><span class="sect2"><a href="#zfs-quickstart-data-verification">19.2.4. 資料檢驗</a></span></dt></dl></dd><dt><span class="sect1"><a href="#zfs-zpool">19.3. <code class="command">zpool</code> 管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#zfs-zpool-create">19.3.1. 建立與摧毀儲存池</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-attach">19.3.2. 加入與移除裝置</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-status">19.3.3. 檢查儲存池狀態</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-clear">19.3.4. 清除錯誤</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-replace">19.3.5. 更換運作中的裝置</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-resilver">19.3.6. 處理故障裝置</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-scrub">19.3.7. 清潔儲存池</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-selfheal">19.3.8. 自我修復</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-online">19.3.9. 擴增儲存池</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-import">19.3.10. 匯入與匯出儲存池</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-upgrade">19.3.11. 升級儲存儲存池</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-history">19.3.12. 顯示已記錄的儲存池歷史日誌</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-iostat">19.3.13. 監視效能</a></span></dt><dt><span class="sect2"><a href="#zfs-zpool-split">19.3.14. 分割儲存儲存池</a></span></dt></dl></dd><dt><span class="sect1"><a href="#zfs-zfs">19.4. <code class="command">zfs</code> 管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#zfs-zfs-create">19.4.1. 建立與摧毀資料集</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-volume">19.4.2. 建立與摧毀磁碟區</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-rename">19.4.3. 重新命名資料集</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-set">19.4.4. 設定資料集屬性</a></span></dt><dd><dl><dt><span class="sect3"><a href="#zfs-zfs-set-share">19.4.4.1. 取得與設定共享屬性</a></span></dt></dl></dd><dt><span class="sect2"><a href="#zfs-zfs-snapshot">19.4.5. 管理快照 (Snapshot)</a></span></dt><dd><dl><dt><span class="sect3"><a href="#zfs-zfs-snapshot-creation">19.4.5.1. 建立快照</a></span></dt><dt><span class="sect3"><a href="#zfs-zfs-snapshot-diff">19.4.5.2. 比對快照</a></span></dt><dt><span class="sect3"><a href="#zfs-zfs-snapshot-rollback">19.4.5.3. 使用快照還原</a></span></dt><dt><span class="sect3"><a href="#zfs-zfs-snapshot-snapdir">19.4.5.4. 從快照還原個別檔案</a></span></dt></dl></dd><dt><span class="sect2"><a href="#zfs-zfs-clones">19.4.6. 管理複本 (Clone)</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-send">19.4.7. 備份 (Replication)</a></span></dt><dd><dl><dt><span class="sect3"><a href="#zfs-send-incremental">19.4.7.1. 漸進式備份</a></span></dt><dt><span class="sect3"><a href="#zfs-send-ssh">19.4.7.2. 透過 <span class="application">SSH</span> 傳送加密的備份</a></span></dt></dl></dd><dt><span class="sect2"><a href="#zfs-zfs-quota">19.4.8. 資料集、使用者以及群組配額</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-reservation">19.4.9. 保留空間</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-compression">19.4.10. 壓縮 (Compression)</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-deduplication">19.4.11. 去重複 (Deduplication)</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-jail">19.4.12. <acronym class="acronym">ZFS</acronym> 與 Jail</a></span></dt></dl></dd><dt><span class="sect1"><a href="#zfs-zfs-allow">19.5. 委託管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#zfs-zfs-allow-create">19.5.1. 委託資料集建立</a></span></dt><dt><span class="sect2"><a href="#zfs-zfs-allow-allow">19.5.2. 委託權限委託</a></span></dt></dl></dd><dt><span class="sect1"><a href="#zfs-advanced">19.6. 進階主題</a></span></dt><dd><dl><dt><span class="sect2"><a href="#zfs-advanced-tuning">19.6.1. 調校</a></span></dt><dt><span class="sect2"><a href="#zfs-advanced-i386">19.6.2. i386 上的 <acronym class="acronym">ZFS</acronym></a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp78541624">19.6.2.1. 記憶體</a></span></dt><dt><span class="sect3"><a href="#idp78544312">19.6.2.2. 核心設定</a></span></dt><dt><span class="sect3"><a href="#idp78548664">19.6.2.3. 載入程式可調參數</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#zfs-links">19.7. 其他資源</a></span></dt><dt><span class="sect1"><a href="#zfs-term">19.8. <acronym class="acronym">ZFS</acronym> 特色與術語</a></span></dt></dl></div><p><span class="emphasis"><em>Z 檔案系統</em></span> 或 <acronym class="acronym">ZFS</acronym> 是設計來克服許多在以往設計中發現的主要問題的一個先進的檔案系統。</p><p>最初由 <span class="trademark">Sun</span>™ 所開發，後來的開放源始碼 <acronym class="acronym">ZFS</acronym> 開發已移到 <a class="link" href="http://open-zfs.org" target="_top">OpenZFS 計劃</a>。</p><p><acronym class="acronym">ZFS</acronym> 的設計目標主要有三個：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>資料完整性：所有資料都會有一個資料的校驗碼 (<a class="link" href="#zfs-term-checksum">checksum</a>)，資料寫入時會計算校驗碼然後一併寫入，往後讀取資料時會再計算一次校驗碼，若校驗碼與當初寫入時不相符，便可偵測到資料錯誤，此時若有可用的資料備援 (Data redundancy)，<acronym class="acronym">ZFS</acronym> 會嘗試自動修正錯誤。</p></li><li class="listitem"><p>儲存池：實體的儲存裝置都會先被加入到一個儲存池 (Pool)，這個共用的儲存池可用來配置儲存空間，儲存池的空間可被所有的檔案系統使用且透過加入新的儲存裝置來增加空間。</p></li><li class="listitem"><p>效能：提供多個快取機制來增加效能。先進、以記憶體為基礎的讀取快取可使用 <a class="link" href="#zfs-term-arc">ARC</a>。第二層以磁碟為基礎的讀取快取可使用 <a class="link" href="#zfs-term-l2arc">L2ARC</a>，以磁碟為基礎的同步寫入快取則可使用 <a class="link" href="#zfs-term-zil">ZIL</a>。</p></li></ul></div><p>完整的功能清單與術語在 <a class="xref" href="#zfs-term" title="19.8. ZFS 特色與術語">節 19.8, “<acronym class="acronym">ZFS</acronym> 特色與術語”</a> 中有詳述。</p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="zfs-differences"></a>19.1. 什麼使 <acronym class="acronym">ZFS</acronym> 與眾不同</h2></div></div></div><p><acronym class="acronym">ZFS</acronym> 與以往任何的檔案系統有顯著的不同，因為它不只是一個檔案系統，<acronym class="acronym">ZFS</acronym> 的獨特優點來自結合了以往被分開的磁碟區管理程式 (Volume Manager) 及檔案系統兩個角色，讓檔案系統也能夠察覺磁碟底層結構的變動。傳統在一個磁碟上只能建立一個檔案系統，若有兩個磁碟則會需要建立兩個分開的檔案系統，在傳統要解決這個問題要使用硬體 <acronym class="acronym">RAID</acronym> 來製作一個空間實際上由數顆實體磁碟所組成的單一的邏輯磁碟給作業系統，作業系統便可在這個邏輯磁碟上放置檔案系統，即使是在那些使用 <acronym class="acronym">GEOM</acronym> 提供的軟體 <acronym class="acronym">RAID</acronym> 解決方案也是一樣，把 <acronym class="acronym">UFS</acronym> 檔案系統放在 <acronym class="acronym">RAID</acronym> Transform 上面當做是一個單一的裝置。<acronym class="acronym">ZFS</acronym> 結合了磁碟區管理程式 (Volume Manager) 與檔案系統來解決這個問題並讓建立多個檔案系統可以共用一個儲存池 (Pool)。<acronym class="acronym">ZFS</acronym> 最大的優點是可以察覺實體磁碟配置的變動，當有額外的磁碟加入到儲存池時可以自動擴增現有的檔案系統，所有的檔案系統便可使用這個新的空間。<acronym class="acronym">ZFS</acronym> 也有數個不同的屬性可以套用到各別檔案系統上，比起單一檔案系統，對建立數個不同檔案系統與資料集 (Dataset) 時有許多的好處。</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="zfs-quickstart"></a>19.2. 快速入門指南</h2></div></div></div><p>這裡有一個啟動機制，可讓 FreeBSD 在系統初始化時掛載 <acronym class="acronym">ZFS</acronym> 儲存池。要開啟這個功能，可加入此行到 <code class="filename">/etc/rc.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">zfs_enable="YES"</pre><p>然後啟動服務：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service zfs start</code></strong></pre><p>本節的例子會假設有三個 <acronym class="acronym">SCSI</acronym> 磁碟，名稱分別為 <code class="filename"><em class="replaceable"><code>da0</code></em></code>, <code class="filename"><em class="replaceable"><code>da1</code></em></code> 及 <code class="filename"><em class="replaceable"><code>da2</code></em></code>。<acronym class="acronym">SATA</acronym> 硬體的使用者裝置名稱改為 <code class="filename"><em class="replaceable"><code>ada</code></em></code> 。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-quickstart-single-disk-pool"></a>19.2.1. 單磁碟儲存池</h3></div></div></div><p>要使用一個磁碟裝置建立一個簡單、無備援的儲存池可：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool create <em class="replaceable"><code>example</code></em> <em class="replaceable"><code>/dev/da0</code></em></code></strong></pre><p>要檢視這個新的儲存池，可查看 <code class="command">df</code> 的輸出結果：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem  1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a   2026030  235230  1628718    13%    /
devfs               1       1        0   100%    /dev
/dev/ad0s1d  54098308 1032846 48737598     2%    /usr
example      17547136       0 17547136     0%    /example</pre><p>這個輸出結果說明 <code class="literal">example</code> 儲存池已建立且被掛載，現在已經可以作為檔案系統存取，可以在上面建立檔案且使用者可以瀏覽：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /example</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>touch testfile</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls -al</code></strong>
total 4
drwxr-xr-x   2 root  wheel    3 Aug 29 23:15 .
drwxr-xr-x  21 root  wheel  512 Aug 29 23:12 ..
-rw-r--r--   1 root  wheel    0 Aug 29 23:15 testfile</pre><p>但是，這個儲存池並未運用到任何 <acronym class="acronym">ZFS</acronym> 功能，若要在這個儲存池上建立一個有開啟壓縮功能的資料集：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs create example/compressed</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs set compression=gzip example/compressed</code></strong></pre><p><code class="literal">example/compressed</code> 資料集現在是一個 <acronym class="acronym">ZFS</acronym> 壓縮的檔案系統，可以試著複製較大的檔案到 <code class="filename">/example/compressed</code>。</p><p>壓縮功能也可以使用以下指令關閉：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs set compression=off example/compressed</code></strong></pre><p>要卸載檔案系統，使用 <code class="command">zfs umount</code> 然後再使用 <code class="command">df</code> 確認：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs umount example/compressed</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem  1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a   2026030  235232  1628716    13%    /
devfs               1       1        0   100%    /dev
/dev/ad0s1d  54098308 1032864 48737580     2%    /usr
example      17547008       0 17547008     0%    /example</pre><p>要重新掛載檔案系統以便再次使用，使用 <code class="command">zfs mount</code> 然後以 <code class="command">df</code> 檢查：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs mount example/compressed</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem         1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a          2026030  235234  1628714    13%    /
devfs                      1       1        0   100%    /dev
/dev/ad0s1d         54098308 1032864 48737580     2%    /usr
example             17547008       0 17547008     0%    /example
example/compressed  17547008       0 17547008     0%    /example/compressed</pre><p>儲存池與檔案系統也可以從 <code class="command">mount</code> 的結果查詢到：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount</code></strong>
/dev/ad0s1a on / (ufs, local)
devfs on /dev (devfs, local)
/dev/ad0s1d on /usr (ufs, local, soft-updates)
example on /example (zfs, local)
example/compressed on /example/compressed (zfs, local)</pre><p>在建立之後，<acronym class="acronym">ZFS</acronym> 的資料集可如同其他檔案系統一般使用，且有許多額外功能可在每個資料集上設定。例如，建立一個預計存放重要的資料的新檔案系統 <code class="literal">data</code>，要設定每個資料區塊 (Data block) 要保留兩份備份：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs create example/data</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs set copies=2 example/data</code></strong></pre><p>現在，可以使用 <code class="command">df</code> 指令來查看資料與空間的使用率：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem         1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a          2026030  235234  1628714    13%    /
devfs                      1       1        0   100%    /dev
/dev/ad0s1d         54098308 1032864 48737580     2%    /usr
example             17547008       0 17547008     0%    /example
example/compressed  17547008       0 17547008     0%    /example/compressed
example/data        17547008       0 17547008     0%    /example/data</pre><p>注意，從這個可以發現每個在儲存池上的檔案系統都擁有相同的可用空間，這是為什麼要在這些範例使用 <code class="command">df</code> 的原因，為了要顯示檔案系統只會用它們所需要使用到的空間，且均取自同一個儲存池。<acronym class="acronym">ZFS</acronym> 淘汰了磁碟區 (Volume) 與分割區 (Partition) 的概念，且允許多個檔案系統共用相同的儲存池。</p><p>不需要使用時可摧毀檔案系統後再摧毀儲存池：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs destroy example/compressed</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs destroy example/data</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool destroy example</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-quickstart-raid-z"></a>19.2.2. RAID-Z</h3></div></div></div><p>磁碟損壞時，要避免資料因磁碟故障造成遺失便是使用 <acronym class="acronym">RAID</acronym>。<acronym class="acronym">ZFS</acronym> 在它的儲存池設計中支援了這項功能。<acronym class="acronym">RAID-Z</acronym>  儲存池需要使用三個或更多的磁碟，但可以提供比鏡像 (Mirror) 儲存池更多的可用空間。</p><p>這個例子會建立一個 <acronym class="acronym">RAID-Z</acronym> 儲存池，並指定要加入這個儲存池的磁碟：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool create storage raidz da0 da1 da2</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml"><span class="trademark">Sun</span>™ 建議用在 <acronym class="acronym">RAID</acronym>-Z 設定的裝置數在三到九個之間。若需要由 10 個或更多磁碟組成單一儲存池的環境，可考慮分成較小的 <acronym class="acronym">RAID-Z</acronym> 群組。若只有兩個可用的磁碟且需要做備援 (Redundancy)，可考慮使用 <acronym class="acronym">ZFS</acronym> 鏡像 (Mirror)。請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=zpool&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">zpool</span>(8)</span></a> 取得更多詳細資訊。</p></div><p>先前的例子已經建立了 <code class="literal">storage</code> 儲存池 (zpool)，現在這個例子會在該儲存池中建立一個新的檔案系統，名稱為 <code class="literal">home</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs create storage/home</code></strong></pre><p>可以設定開啟壓縮及保留目錄及檔案額外備份的功能：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs set copies=2 storage/home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs set compression=gzip storage/home</code></strong></pre><p>要讓這個空間作為使用者的新家目錄位置，需複製使用者資料到這個目錄並建立適合的符號連結 (Symbolic link)：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cp -rp /home/* /storage/home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rm -rf /home /usr/home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /storage/home /home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /storage/home /usr/home</code></strong></pre><p>現在使用者的資料會儲存在新建立的 <code class="filename">/storage/home</code>，可以加入新使用者並登入該使用者來測試。</p><p>試著建立檔案系統快照 (Snapshot)，稍後可用來還原 (Rollback)：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs snapshot storage/home@08-30-08</code></strong></pre><p>快照只可以使用整個檔案系統製作，無法使用各別目錄或檔案。</p><p><code class="literal">@</code> 字元用來區隔檔案系統名稱 (File system) 或磁碟區 (Volume) 名稱，若有重要的目錄意外被刪除，檔案系統可以備份然後還原到先前目錄還存在時的快照 (Snapshot)：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs rollback storage/home@08-30-08</code></strong></pre><p>要列出所有可用的快照，可在檔案系統的 <code class="filename">.zfs/snapshot</code> 目錄執行 <code class="command">ls</code>，舉例來說，要查看先前已做的快照：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ls /storage/home/.zfs/snapshot</code></strong></pre><p>也可以寫一個 Script 來對使用者資料做例行性的快照，但隨著時間快照可能消耗大量的磁碟空間。先前的快照可以使用指令移除：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs destroy storage/home@08-30-08</code></strong></pre><p>在測試之後，便可讓 <code class="filename">/storage/home</code> 成為真正的 <code class="filename">/home</code> 使用此指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs set mountpoint=/home storage/home</code></strong></pre><p>執行 <code class="command">df</code> 興 <code class="command">mount</code> 來確認系統現在是否以把檔案系統做為真正的 <code class="filename">/home</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount</code></strong>
/dev/ad0s1a on / (ufs, local)
devfs on /dev (devfs, local)
/dev/ad0s1d on /usr (ufs, local, soft-updates)
storage on /storage (zfs, local)
storage/home on /home (zfs, local)
<code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem   1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a    2026030  235240  1628708    13%    /
devfs                1       1        0   100%    /dev
/dev/ad0s1d   54098308 1032826 48737618     2%    /usr
storage       26320512       0 26320512     0%    /storage
storage/home  26320512       0 26320512     0%    /home</pre><p>這個動作完成 <acronym class="acronym">RAID-Z</acronym> 最後的設定，有關已建立的檔案系統每日狀態更新可以做為 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">periodic</span>(8)</span></a> 的一部份在每天晚上執行。加入此行到 <code class="filename">/etc/periodic.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">daily_status_zfs_enable="YES"</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-quickstart-recovering-raid-z"></a>19.2.3. 復原 <acronym class="acronym">RAID-Z</acronym></h3></div></div></div><p>每個軟體 <acronym class="acronym">RAID</acronym> 都有監控其狀態 (<code class="literal">state</code>) 的方式，而 <acronym class="acronym">RAID-Z</acronym> 裝置的狀態可以使用這個指令來查看：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool status -x</code></strong></pre><p>如果所有儲存池為上線 (<a class="link" href="#zfs-term-online">Online</a>) 且正常，則訊息會顯示：</p><pre xml:lang="en" class="screen" lang="en">all pools are healthy</pre><p>如果有發生問題，可能磁碟會呈現離線 (<a class="link" href="#zfs-term-offline">Offline</a>) 的狀態，此時儲存池的狀態會是：</p><pre xml:lang="en" class="screen" lang="en">  pool: storage
 state: DEGRADED
status: One or more devices has been taken offline by the administrator.
	Sufficient replicas exist for the pool to continue functioning in a
	degraded state.
action: Online the device using 'zpool online' or replace the device with
	'zpool replace'.
 scrub: none requested
config:

	NAME        STATE     READ WRITE CKSUM
	storage     DEGRADED     0     0     0
	  raidz1    DEGRADED     0     0     0
	    da0     ONLINE       0     0     0
	    da1     OFFLINE      0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</pre><p>這代表著裝置在之前被管理者使用此指令拿下線：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool offline storage da1</code></strong></pre><p>現在系統可以關機然後更換 <code class="filename">da1</code>，當系統恢復上線，則可以替換掉儲存池中故障的磁碟：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool replace storage da1</code></strong></pre><p>到這裡，可以再檢查狀態一次，這時不需使用 <code class="option">-x</code> 參數來顯示所有的儲存池：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool status storage</code></strong>
 pool: storage
 state: ONLINE
 scrub: resilver completed with 0 errors on Sat Aug 30 19:44:11 2008
config:

	NAME        STATE     READ WRITE CKSUM
	storage     ONLINE       0     0     0
	  raidz1    ONLINE       0     0     0
	    da0     ONLINE       0     0     0
	    da1     ONLINE       0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</pre><p>在這個例子中，所有的磁碟均已正常運作。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-quickstart-data-verification"></a>19.2.4. 資料檢驗</h3></div></div></div><p><acronym class="acronym">ZFS</acronym> 使用校驗碼 (Checksum) 來檢驗資料的完整性 (Integrity)，會在建立檔案系統時便自動開啟。</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">校驗碼 (Checksum) 可以關閉，但並<span class="emphasis"><em>不</em></span>建議！校驗碼只會使用非常少的儲存空間來確保資料的完整性。若關閉校驗碼會使許多 <acronym class="acronym">ZFS</acronym> 功能無法正常運作，且關閉校驗碼對並不會明顯的改善效能。</p></div><p>檢驗校驗碼這個動作即所謂的<span class="emphasis"><em>清潔 (Scrub)</em></span>，可以使用以下指令來檢驗 <code class="literal">storage</code> 儲存池的資料完整性：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool scrub storage</code></strong></pre><p>清潔所需要的時間依儲存的資料量而定，較大的資料量相對會需要花費較長的時間來檢驗。清潔會對 <acronym class="acronym">I/O</acronym> 有非常密集的操作且一次只能進行一個清潔動作。在清潔完成之後，可以使用 <code class="command">status</code> 來查看狀態：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool status storage</code></strong>
 pool: storage
 state: ONLINE
 scrub: scrub completed with 0 errors on Sat Jan 26 19:57:37 2013
config:

	NAME        STATE     READ WRITE CKSUM
	storage     ONLINE       0     0     0
	  raidz1    ONLINE       0     0     0
	    da0     ONLINE       0     0     0
	    da1     ONLINE       0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</pre><p>查詢結果會顯示上次完成清潔的時間來協助追蹤是否要再做清潔。定期清潔可以協助保護資料不會默默損壞且確保儲存池的完整性。</p><p>請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=zfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">zfs</span>(8)</span></a> 及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=zpool&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">zpool</span>(8)</span></a> 來取得其他 <acronym class="acronym">ZFS</acronym> 選項。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="zfs-zpool"></a>19.3. <code class="command">zpool</code> 管理</h2></div></div></div><p><acronym class="acronym">ZFS</acronym> 管理分成兩個主要的工具。<code class="command">zpool</code> 工具用來控制儲存池的運作並可處理磁碟的新增、移除、更換與管理。<a class="link" href="#zfs-zfs" title="19.4. zfs 管理"><code class="command">zfs</code></a> 工具用來建立、摧毀與管理檔案系統 (<a class="link" href="#zfs-term-filesystem">File system</a>) 與磁碟區 (<a class="link" href="#zfs-term-volume">Volume</a>) 的資料集。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-create"></a>19.3.1. 建立與摧毀儲存池</h3></div></div></div><p>建立 <acronym class="acronym">ZFS</acronym> 儲存池 (<span class="emphasis"><em>zpool</em></span>) 要做幾個涉及長遠規劃的決定，因為建立儲存池之後便無法再更改儲存池的結構。最重要的決定是要使用那一種型態的 vdev 來將實體磁碟設為同一群組。請參考 <a class="link" href="#zfs-term-vdev">vdev 型態</a> 的清單來取得有關可用選項的詳細資訊。大部份的 vdev 型態不允許在建立儲存池之後再加入額外的磁碟，鏡像 (Mirror) 是可以允許加入額外的磁碟到 vdev 的其中一個例外，另一個則是串連 (Stripe)，可以加入額外的磁碟到 vdev 來升級為鏡像。雖然可以加入額外的 vdev 來擴充儲存池，但儲存池的配置在建立之後便無法更改，若要要更改，則必須先備份資料，把儲存池摧毀後再重新建立。</p><p>建立一個簡單的鏡像儲存池：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool create <em class="replaceable"><code>mypool</code></em> mirror <em class="replaceable"><code>/dev/ada1</code></em> <em class="replaceable"><code>/dev/ada2</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada1    ONLINE       0     0     0
            ada2    ONLINE       0     0     0

errors: No known data errors</pre><p>可以一次建立數個 vdev，磁碟群組間使用 vdev 型態關鍵字來區隔，在這個例子使用 <code class="literal">mirror</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool create <em class="replaceable"><code>mypool</code></em> mirror <em class="replaceable"><code>/dev/ada1</code></em> <em class="replaceable"><code>/dev/ada2</code></em> mirror <em class="replaceable"><code>/dev/ada3</code></em> <em class="replaceable"><code>/dev/ada4</code></em></code></strong>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada1    ONLINE       0     0     0
            ada2    ONLINE       0     0     0
          mirror-1  ONLINE       0     0     0
            ada3    ONLINE       0     0     0
            ada4    ONLINE       0     0     0

errors: No known data errors</pre><p>儲存池也可以不使用整個磁碟而改使用分割區 (Partition) 來建立。把 <acronym class="acronym">ZFS</acronym> 放到不同的分割區可讓同一個磁碟有其他的分割區可做其他用途，尤其是有 Bootcode 與檔案系統要用來開機的分割區，這讓磁碟可以用來開機也同樣可以做為儲存池的一部份。在 FreeBSD 用分割區來替代整個磁碟並不會對效能有影響。使用分割區也讓管理者可以對磁碟容量做 <span class="emphasis"><em>少算的預備</em></span>，使用比完整容量少的容量，未來若要替換的磁碟號稱與原磁碟相同，但實際上卻比較小時，也可符合這個較小的分割區容量，以使用替換的磁碟。</p><p>使用分割區建立一個 <a class="link" href="#zfs-term-vdev-raidz">RAID-Z2</a> 儲存池：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool create <em class="replaceable"><code>mypool</code></em> raidz2 <em class="replaceable"><code>/dev/ada0p3</code></em> <em class="replaceable"><code>/dev/ada1p3</code></em> <em class="replaceable"><code>/dev/ada2p3</code></em> <em class="replaceable"><code>/dev/ada3p3</code></em> <em class="replaceable"><code>/dev/ada4p3</code></em> <em class="replaceable"><code>/dev/ada5p3</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          raidz2-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0
            ada3p3  ONLINE       0     0     0
            ada4p3  ONLINE       0     0     0
            ada5p3  ONLINE       0     0     0

errors: No known data errors</pre><p>不需使用的儲存池可以摧毀，來讓磁碟可以再次使用。摧毀一個儲存池要先卸載所有該儲存池的資料集。若資料集在使用中，卸載的操作會失敗且儲存池不會被摧毀。儲存池的摧毀可以使用 <code class="option">-f</code> 來強制執行，但這可能造成那些有開啟這些資料集之中檔案的應用程式無法辨識的行為。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-attach"></a>19.3.2. 加入與移除裝置</h3></div></div></div><p>加入磁碟到儲存池 (zpool) 會有兩種情形：使用 <code class="command">zpool attach</code> 加入一個磁碟到既有的 vdev，或使用 <code class="command">zpool add</code> 加入 vdev 到儲存池。只有部份 <a class="link" href="#zfs-term-vdev">vdev 型態</a> 允許在 vdev 建立之後加入磁碟。</p><p>由單一磁碟所建立的儲存池缺乏備援 (Redundancy) 功能，可以偵測到資料的損壞但無法修復，因為資料沒有其他備份可用。備份數 (<a class="link" href="#zfs-term-copies">Copies</a>) 屬性可以讓您從較小的故障中復原，如磁碟壞軌 (Bad sector)，但無法提供與鏡像或 <acronym class="acronym">RAID-Z</acronym> 同樣層級的保護。由單一磁碟所建立的儲存池可以使用 <code class="command">zpool attach</code> 來加入額外的磁碟到 vdev，來建立鏡像。<code class="command">zpool attach</code> 也可用來加入額外的磁碟到鏡像群組，來增加備援與讀取效率。若使用的磁碟已有分割區，可以複製該磁碟的分割區配置到另一個，使用 <code class="command">gpart backup</code> 與 <code class="command">gpart restore</code> 可讓這件事變的很簡單。</p><p>加入 <em class="replaceable"><code>ada1p3</code></em> 來升級單一磁碟串連 (stripe) vdev <em class="replaceable"><code>ada0p3</code></em> 採用鏡像型態 (mirror)：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          ada0p3    ONLINE       0     0     0

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool attach <em class="replaceable"><code>mypool</code></em> <em class="replaceable"><code>ada0p3</code></em> <em class="replaceable"><code>ada1p3</code></em></code></strong>
Make sure to wait until resilver is done before rebooting.

If you boot from pool 'mypool', you may need to update
boot code on newly attached disk 'ada1p3'.

Assuming you use GPT partitioning and 'da0' is your new boot disk
you may use the following command:

        gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 da0
<code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 <em class="replaceable"><code>ada1</code></em></code></strong>
bootcode written to ada1
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
status: One or more devices is currently being resilvered.  The pool will
        continue to function, possibly in a degraded state.
action: Wait for the resilver to complete.
  scan: resilver in progress since Fri May 30 08:19:19 2014
        527M scanned out of 781M at 47.9M/s, 0h0m to go
        527M resilvered, 67.53% done
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0  (resilvering)

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: resilvered 781M in 0h0m with 0 errors on Fri May 30 08:15:58 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0

errors: No known data errors</pre><p>若不想選擇加入磁碟到既有的 vdev ，對 <acronym class="acronym">RAID-Z</acronym> 來說，可選擇另一種方式，便是加入另一個 vdev 到儲存池。額外的 vdev 可以提供更高的效能，分散寫入資料到 vdev 之間，每個 vdev 會負責自己的備援。也可以混合使用不同的 vdev 型態，但並不建議，例如混合使用 <code class="literal">mirror</code> 與 <code class="literal">RAID-Z</code>，加入一個無備援的 vdev 到一個含有 mirror 或 <acronym class="acronym">RAID-Z</acronym> vdev 的儲存池會讓資料損壞的風險擴大整個儲存池，由於會分散寫入資料，若在無備援的磁碟上發生故障的結果便是遺失大半寫到儲存池的資料區塊。</p><p>在每個 vdev 間的資料是串連的，例如，有兩個 mirror vdev，便跟 <acronym class="acronym">RAID</acronym> 10 一樣在兩個 mirror 間分散寫入資料，且會做空間的分配，因此 vdev 會在同時達到全滿 100% 的用量。若 vdev 間的可用空間量不同則會影響到效能，因為資料量會不成比例的寫入到使用量較少的 vdev。</p><p>當連接額外的裝置到一個可以開機的儲存池，要記得更新 Bootcode。</p><p>連接第二個 mirror 群組 (<code class="filename">ada2p3</code> 及 <code class="filename">ada3p3</code>) 到既有的 mirror：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: resilvered 781M in 0h0m with 0 errors on Fri May 30 08:19:35 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool add <em class="replaceable"><code>mypool</code></em> mirror <em class="replaceable"><code>ada2p3</code></em> <em class="replaceable"><code>ada3p3</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 <em class="replaceable"><code>ada2</code></em></code></strong>
bootcode written to ada2
<code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 <em class="replaceable"><code>ada3</code></em></code></strong>
bootcode written to ada3
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: scrub repaired 0 in 0h0m with 0 errors on Fri May 30 08:29:51 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
          mirror-1  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0
            ada3p3  ONLINE       0     0     0

errors: No known data errors</pre><p>現在已無法從儲存池上移除 vdev，且磁碟只能夠在有足夠備援空間的情況下從 mirror 移除，若在 mirror 群組中只剩下一個磁碟，便會取消 mirror 然後還原為 stripe，若剩下的那個磁碟故障，便會影響到整個儲存池。</p><p>從一個三方 mirror 群組移除一個磁碟：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: scrub repaired 0 in 0h0m with 0 errors on Fri May 30 08:29:51 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool detach <em class="replaceable"><code>mypool</code></em> <em class="replaceable"><code>ada2p3</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: scrub repaired 0 in 0h0m with 0 errors on Fri May 30 08:29:51 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0

errors: No known data errors</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-status"></a>19.3.3. 檢查儲存池狀態</h3></div></div></div><p>儲存池的狀態很重要，若有磁碟機離線或偵測到讀取、寫入或校驗碼 (Checksum) 錯誤，對應的錯誤計數便會增加。<code class="command">status</code> 會顯示儲存池中每一個磁碟機的設定與狀態及整個儲存池的狀態。需要處置的方式與有關最近清潔 (<a class="link" href="#zfs-zpool-scrub" title="19.3.7. 清潔儲存池"><code class="command">Scrub</code></a>) 的詳細資訊也會一併顯示。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: scrub repaired 0 in 2h25m with 0 errors on Sat Sep 14 04:25:50 2013
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          raidz2-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0
            ada3p3  ONLINE       0     0     0
            ada4p3  ONLINE       0     0     0
            ada5p3  ONLINE       0     0     0

errors: No known data errors</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-clear"></a>19.3.4. 清除錯誤</h3></div></div></div><p>當偵測到錯誤發生，讀取、寫入或校驗碼 (Checksum) 的計數便會增加。使用 <code class="command">zpool clear <em class="replaceable"><code>mypool</code></em></code> 可以清除錯誤訊息及重置計數。清空錯誤狀態對當儲存池發生錯誤要使用自動化 Script 通知的管理者來說會很重要，因在舊的錯誤尚未清除前不會回報後續的錯誤。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-replace"></a>19.3.5. 更換運作中的裝置</h3></div></div></div><p>可能有一些情況會需要更換磁碟為另一個磁碟，當要更換運作中的磁碟，此程序會維持舊有的磁碟在更換的過程為上線的狀態，儲存池不會進入降級 (<a class="link" href="#zfs-term-degraded">Degraded</a>) 的狀態，來減少資料遺失的風險。<code class="command">zpool replace</code> 會複製所有舊磁碟的資料到新磁碟，操作完成之後舊磁碟便會與 vdev 中斷連線。若新磁碟容量較舊磁碟大，也可以會增加儲存池來使用新的空間，請參考 <a class="link" href="#zfs-zpool-online" title="19.3.9. 擴增儲存池">擴增儲存池</a>。</p><p>更換儲存池中正在運作的狀置：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool replace <em class="replaceable"><code>mypool</code></em> <em class="replaceable"><code>ada1p3</code></em> <em class="replaceable"><code>ada2p3</code></em></code></strong>
Make sure to wait until resilver is done before rebooting.

If you boot from pool 'zroot', you may need to update
boot code on newly attached disk 'ada2p3'.

Assuming you use GPT partitioning and 'da0' is your new boot disk
you may use the following command:

        gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 da0
<code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 <em class="replaceable"><code>ada2</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
status: One or more devices is currently being resilvered.  The pool will
        continue to function, possibly in a degraded state.
action: Wait for the resilver to complete.
  scan: resilver in progress since Mon Jun  2 14:21:35 2014
        604M scanned out of 781M at 46.5M/s, 0h0m to go
        604M resilvered, 77.39% done
config:

        NAME             STATE     READ WRITE CKSUM
        mypool           ONLINE       0     0     0
          mirror-0       ONLINE       0     0     0
            ada0p3       ONLINE       0     0     0
            replacing-1  ONLINE       0     0     0
              ada1p3     ONLINE       0     0     0
              ada2p3     ONLINE       0     0     0  (resilvering)

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: resilvered 781M in 0h0m with 0 errors on Mon Jun  2 14:21:52 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0

errors: No known data errors</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-resilver"></a>19.3.6. 處理故障裝置</h3></div></div></div><p>當儲存池中的磁碟故障，該故障硬碟所屬的 vdev 便會進入降級 (<a class="link" href="#zfs-term-degraded">Degraded</a>) 狀態，所有的資料仍可使用，但效能可能會降低，因為遺失的資料必須從可用的備援資料計算才能取得。要將 vdev 恢復完整運作的狀態必須更換故障的實體裝置。然後 <acronym class="acronym">ZFS</acronym> 便會開始修復 (<a class="link" href="#zfs-term-resilver">Resilver</a>，古代鏡子的修復稱 Resilver) 作業，會從可用的備援資料計算出故障磁碟中的資料並寫入到替換的裝置上。完成後 vdev 便會重新返回上線 (<a class="link" href="#zfs-term-online">Online</a>) 的狀態。</p><p>若 vdev 沒有任何備援資料或有多個裝置故障，沒有足夠的備援資料可以補償，儲存池便會進入故障 (<a class="link" href="#zfs-term-faulted">Faulted</a>) 的狀態。</p><p>更換故障的磁碟時，故障磁碟的名稱會更換為裝置的 <acronym class="acronym">GUID</acronym>，若替換裝置要使用相同的裝置名稱，則在 <code class="command">zpool replace</code> 不須加上新裝置名稱參數。</p><p>使用 <code class="command">zpool replace</code> 更換故障的磁碟：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: DEGRADED
status: One or more devices could not be opened.  Sufficient replicas exist for
        the pool to continue functioning in a degraded state.
action: Attach the missing device and online it using 'zpool online'.
   see: http://illumos.org/msg/ZFS-8000-2Q
  scan: none requested
config:

        NAME                    STATE     READ WRITE CKSUM
        mypool                  DEGRADED     0     0     0
          mirror-0              DEGRADED     0     0     0
            ada0p3              ONLINE       0     0     0
            316502962686821739  UNAVAIL      0     0     0  was /dev/ada1p3

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool replace <em class="replaceable"><code>mypool</code></em> <em class="replaceable"><code>316502962686821739</code></em> <em class="replaceable"><code>ada2p3</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: DEGRADED
status: One or more devices is currently being resilvered.  The pool will
        continue to function, possibly in a degraded state.
action: Wait for the resilver to complete.
  scan: resilver in progress since Mon Jun  2 14:52:21 2014
        641M scanned out of 781M at 49.3M/s, 0h0m to go
        640M resilvered, 82.04% done
config:

        NAME                        STATE     READ WRITE CKSUM
        mypool                      DEGRADED     0     0     0
          mirror-0                  DEGRADED     0     0     0
            ada0p3                  ONLINE       0     0     0
            replacing-1             UNAVAIL      0     0     0
              15732067398082357289  UNAVAIL      0     0     0  was /dev/ada1p3/old
              ada2p3                ONLINE       0     0     0  (resilvering)

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: resilvered 781M in 0h0m with 0 errors on Mon Jun  2 14:52:38 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0

errors: No known data errors</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-scrub"></a>19.3.7. 清潔儲存池</h3></div></div></div><p>建議儲存池要定期清潔 (<a class="link" href="#zfs-term-scrub">Scrub</a>)，最好是每一個月清潔一次。 <code class="command">scrub</code> 作業對磁碟操作非常的密集，在執行時會降低磁碟的效能。在排程 <code class="command">scrub</code> 時避免在使用高峰的時期，或使用 <a class="link" href="#zfs-advanced-tuning-scrub_delay"><code class="varname">vfs.zfs.scrub_delay</code></a> 來調整 <code class="command">scrub</code> 的相對優先權來避免影響其他的工作。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool scrub <em class="replaceable"><code>mypool</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: scrub in progress since Wed Feb 19 20:52:54 2014
        116G scanned out of 8.60T at 649M/s, 3h48m to go
        0 repaired, 1.32% done
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          raidz2-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0
            ada3p3  ONLINE       0     0     0
            ada4p3  ONLINE       0     0     0
            ada5p3  ONLINE       0     0     0

errors: No known data errors</pre><p>若發生需要取消清潔作業的事，可以下 <code class="command">zpool scrub -s <em class="replaceable"><code>mypool</code></em></code>。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-selfheal"></a>19.3.8. 自我修復</h3></div></div></div><p>校驗碼 (Checksum) 會隨資料區塊一併儲存，這使得檔案系統可以做到<span class="emphasis"><em>自我修復</em></span>。這個功能可以在校驗碼與儲存池中的另一個裝置不同時自動修復資料。舉例來說，有兩個磁碟做鏡像 (Mirror)，其中一個磁碟機開始失常並無法正常儲存資料，甚至是資料放在長期封存的儲存裝置上，已經很久沒有被存取。傳統的檔案系統需要執行演算法來檢查並修復資料如 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a>，這些指令耗費時間，且在嚴重時需要管理者手動決定要做那一種修復操作。當 <acronym class="acronym">ZFS</acronym> 偵測到資料區塊的校驗碼不對時，它除了把資料交給需要的應用程式外，也會修正在磁碟上錯誤的資料。這件事不需要與系統管理者作任何互動便會在一般的儲存池操作時完成。</p><p>接下來的例子會示範自我修復會如何運作。建立一個使用磁碟 <code class="filename">/dev/ada0</code> 及 <code class="filename">/dev/ada1</code> 做鏡像的儲存池。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool create <em class="replaceable"><code>healer</code></em> mirror <em class="replaceable"><code>/dev/ada0</code></em> <em class="replaceable"><code>/dev/ada1</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool status <em class="replaceable"><code>healer</code></em></code></strong>
  pool: healer
 state: ONLINE
  scan: none requested
config:

    NAME        STATE     READ WRITE CKSUM
    healer      ONLINE       0     0     0
      mirror-0  ONLINE       0     0     0
       ada0     ONLINE       0     0     0
       ada1     ONLINE       0     0     0

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool list</code></strong>
NAME     SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG   CAP  DEDUP  HEALTH  ALTROOT
healer   960M  92.5K   960M         -         -     0%    0%  1.00x  ONLINE  -</pre><p>將部份需要使用自我修復功能來保護的重要資料複製到該儲存池，建立一個儲存池的校驗碼供稍後做比較時使用。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cp /some/important/data /healer</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list</code></strong>
NAME     SIZE  ALLOC   FREE    CAP  DEDUP  HEALTH  ALTROOT
healer   960M  67.7M   892M     7%  1.00x  ONLINE  -
<code class="prompt">#</code> <strong class="userinput"><code>sha1 /healer &gt; checksum.txt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cat checksum.txt</code></strong>
SHA1 (/healer) = 2753eff56d77d9a536ece6694bf0a82740344d1f</pre><p>寫入隨機的資料到鏡像的第一個磁碟來模擬資料損毀的情況。要避免 <acronym class="acronym">ZFS</acronym> 偵測到錯誤時馬上做修復，接著要將儲存池匯出，待模擬資料損毀之後再匯入。</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">這是一個危險的操作，會破壞重要的資料。在這裡使用僅為了示範用，不應在儲存池正常運作時嘗試使用，也不應將這個故意損壞資料的例子用在任何其他的檔案系統上，所以請勿使用任何不屬於該儲存池的其他磁碟裝置名稱並確定在執行指令前已對儲存池做正確的備份！</p></div><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool export <em class="replaceable"><code>healer</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/random of=/dev/ada1 bs=1m count=200</code></strong>
200+0 records in
200+0 records out
209715200 bytes transferred in 62.992162 secs (3329227 bytes/sec)
<code class="prompt">#</code> <strong class="userinput"><code>zpool import healer</code></strong></pre><p>儲存池的狀態顯示有一個裝置發生了錯誤。注意，應用程式從儲存池讀取的資料中並沒有任何的錯誤資料，<acronym class="acronym">ZFS</acronym> 會自 <code class="filename">ada0</code> 裝置提供有正確校驗碼的資料。結果裡面 <code class="literal">CKSUM</code> 欄位含有非零值便是有錯誤校驗碼的裝置。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool status <em class="replaceable"><code>healer</code></em></code></strong>
    pool: healer
   state: ONLINE
  status: One or more devices has experienced an unrecoverable error.  An
          attempt was made to correct the error.  Applications are unaffected.
  action: Determine if the device needs to be replaced, and clear the errors
          using 'zpool clear' or replace the device with 'zpool replace'.
     see: http://illumos.org/msg/ZFS-8000-4J
    scan: none requested
  config:

      NAME        STATE     READ WRITE CKSUM
      healer      ONLINE       0     0     0
        mirror-0  ONLINE       0     0     0
         ada0     ONLINE       0     0     0
         ada1     ONLINE       0     0     1

errors: No known data errors</pre><p>錯誤已經被偵測到並且由未被影響的 <code class="filename">ada0</code> 鏡像磁碟上的備援提供資料。可與原來的校驗碼做比較來看儲存池是否已修復為一致。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sha1 /healer &gt;&gt; checksum.txt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cat checksum.txt</code></strong>
SHA1 (/healer) = 2753eff56d77d9a536ece6694bf0a82740344d1f
SHA1 (/healer) = 2753eff56d77d9a536ece6694bf0a82740344d1f</pre><p>儲存池在故意竄改資料前與後的兩個校驗碼仍相符顯示了 <acronym class="acronym">ZFS</acronym> 在校驗碼不同時偵測與自動修正錯誤的能力。注意，這只在當儲存池中有足夠的備援時才可做到，由單一裝置組成的儲存池並沒有自我修復的能力。這也是為什麼在 <acronym class="acronym">ZFS</acronym> 中校驗碼如此重要，任何原因都不該關閉。不需要 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a> 或類似的檔案系統一致性檢查程式便能夠偵測與修正問題，且儲存儲存池在發生問題時仍可正常運作。接著需要做清潔作業來覆蓋在 <code class="filename">ada1</code> 上的錯誤資料。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool scrub <em class="replaceable"><code>healer</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool status <em class="replaceable"><code>healer</code></em></code></strong>
  pool: healer
 state: ONLINE
status: One or more devices has experienced an unrecoverable error.  An
            attempt was made to correct the error.  Applications are unaffected.
action: Determine if the device needs to be replaced, and clear the errors
            using 'zpool clear' or replace the device with 'zpool replace'.
   see: http://illumos.org/msg/ZFS-8000-4J
  scan: scrub in progress since Mon Dec 10 12:23:30 2012
        10.4M scanned out of 67.0M at 267K/s, 0h3m to go
        9.63M repaired, 15.56% done
config:

    NAME        STATE     READ WRITE CKSUM
    healer      ONLINE       0     0     0
      mirror-0  ONLINE       0     0     0
       ada0     ONLINE       0     0     0
       ada1     ONLINE       0     0   627  (repairing)

errors: No known data errors</pre><p>清潔作業會從 <code class="filename">ada0</code> 讀取資料並重新寫入任何在 <code class="filename">ada1</code> 上有錯誤校驗碼的資料。這個操作可以由 <code class="command">zpool status</code> 的輸出中呈現修復中 <code class="literal">(repairing)</code> 的項目來辨識。這個作業完成後，儲存池的狀態會更改為：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool status <em class="replaceable"><code>healer</code></em></code></strong>
  pool: healer
 state: ONLINE
status: One or more devices has experienced an unrecoverable error.  An
        attempt was made to correct the error.  Applications are unaffected.
action: Determine if the device needs to be replaced, and clear the errors
             using 'zpool clear' or replace the device with 'zpool replace'.
   see: http://illumos.org/msg/ZFS-8000-4J
  scan: scrub repaired 66.5M in 0h2m with 0 errors on Mon Dec 10 12:26:25 2012
config:

    NAME        STATE     READ WRITE CKSUM
    healer      ONLINE       0     0     0
      mirror-0  ONLINE       0     0     0
       ada0     ONLINE       0     0     0
       ada1     ONLINE       0     0 2.72K

errors: No known data errors</pre><p>清潔操作完成便同步了 <code class="filename">ada0</code> 到 <code class="filename">ada1</code> 間的所有資料。執行 <code class="command">zpool clear</code> 可以清除 (<a class="link" href="#zfs-zpool-clear" title="19.3.4. 清除錯誤">Clear</a>) 儲存池狀態的錯誤訊息。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool clear <em class="replaceable"><code>healer</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool status <em class="replaceable"><code>healer</code></em></code></strong>
  pool: healer
 state: ONLINE
  scan: scrub repaired 66.5M in 0h2m with 0 errors on Mon Dec 10 12:26:25 2012
config:

    NAME        STATE     READ WRITE CKSUM
    healer      ONLINE       0     0     0
      mirror-0  ONLINE       0     0     0
       ada0     ONLINE       0     0     0
       ada1     ONLINE       0     0     0

errors: No known data errors</pre><p>儲存池現在恢復完整運作的狀態且清除所有的錯誤了。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-online"></a>19.3.9. 擴增儲存池</h3></div></div></div><p>可用的備援儲存池大小會受到每個 vdev 中容量最小的裝置限制。最小的裝置可以替換成較大的裝置，在更換 (<a class="link" href="#zfs-zpool-replace" title="19.3.5. 更換運作中的裝置">Replace</a>) 或修復 (<a class="link" href="#zfs-term-resilver">Resilver</a>) 作業後，儲存池可以成長到該新裝置的可用容量。例如，要做一個 1 TB 磁碟機與一個 2 TB 磁碟機的鏡像，可用的空間會是 1 TB，當 1 TB 磁碟機備更換成另一個 2 TB 的磁碟機時，修復程序會複製既有的資料到新的磁碟機，由於現在兩個裝置都有 2 TB 的容量，所以鏡像的可用空間便會成長到 2 TB。</p><p>可以在每個裝置用 <code class="command">zpool online -e</code> 來觸發擴充的動作，在擴充完所有裝置後，儲存池便可使用額外的空間。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-import"></a>19.3.10. 匯入與匯出儲存池</h3></div></div></div><p>儲存池在移動到其他系統之前需要做匯出 (<span class="emphasis"><em>Export</em></span>)，會卸載所有的資料集，然後標記每個裝置為已匯出，為了避免被其他磁碟子系統存取，因此仍會鎖定這些裝置。這個動作讓儲存池可以在支援 <acronym class="acronym">ZFS</acronym> 的其他機器、其他作業系統做匯入 (<span class="emphasis"><em>Import</em></span>)，甚至是不同的硬體架構 (有一些注意事項，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=zpool&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">zpool</span>(8)</span></a>)。當資料集有被開啟的檔案，可使用 <code class="command">zpool export -f</code> 來強制匯出儲存池，使用這個指令需要小心，資料集是被強制卸載的，因此有可能造成在該資料集開啟檔案的應用程式發生無法預期的結果。</p><p>匯出未使用的儲存池：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool export mypool</code></strong></pre><p>匯入儲存池會自動掛載資料集，若不想自動掛載，可以使用 <code class="command">zpool import -N</code>。<code class="command">zpool import -o</code> 可以設定在匯入時暫時使用的屬性。<code class="command">zpool import altroot=</code> 允許匯入時指定基礎掛載點 (Base mount point) 來替換檔案系統根目錄。若儲存池先前用在不同的系統且不正常匯出，可能會需要使用 <code class="command">zpool import -f</code> 來強制匯入。<code class="command">zpool import -a</code> 會匯入所有沒有被其他系統使用的儲存池。</p><p>列出所有可以匯入的儲存池：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool import</code></strong>
   pool: mypool
     id: 9930174748043525076
  state: ONLINE
 action: The pool can be imported using its name or numeric identifier.
 config:

        mypool      ONLINE
          ada2p3    ONLINE</pre><p>使用替代的根目錄匯入儲存池：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool import -o altroot=<em class="replaceable"><code>/mnt</code></em> <em class="replaceable"><code>mypool</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list</code></strong>
zfs list
NAME                 USED  AVAIL  REFER  MOUNTPOINT
mypool               110K  47.0G    31K  /mnt/mypool</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-upgrade"></a>19.3.11. 升級儲存儲存池</h3></div></div></div><p>在升級 FreeBSD 之後或儲存池是由其他使用舊版 <acronym class="acronym">ZFS</acronym> 的系統匯入，儲存池可以手動升級到最新版本的 <acronym class="acronym">ZFS</acronym> 來支援新的功能。在升級前請評估儲存池是否還要在舊的系統做匯入，由於升級是一個單向的程序，舊的儲存池可以升級，但有新功能的儲存池無法降級。</p><p>升級一個 v28 的儲存以支援功能旗標 (<code class="literal">Feature Flags</code>)：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
status: The pool is formatted using a legacy on-disk format.  The pool can
        still be used, but some features are unavailable.
action: Upgrade the pool using 'zpool upgrade'.  Once this is done, the
        pool will no longer be accessible on software that does not support feat
        flags.
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
	    ada0    ONLINE       0     0     0
	    ada1    ONLINE       0     0     0

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool upgrade</code></strong>
This system supports ZFS pool feature flags.

The following pools are formatted with legacy version numbers and can
be upgraded to use feature flags.  After being upgraded, these pools
will no longer be accessible by software that does not support feature
flags.

VER  POOL
---  ------------
28   mypool

Use 'zpool upgrade -v' for a list of available legacy versions.
Every feature flags pool has all supported features enabled.
<code class="prompt">#</code> <strong class="userinput"><code>zpool upgrade mypool</code></strong>
This system supports ZFS pool feature flags.

Successfully upgraded 'mypool' from version 28 to feature flags.
Enabled the following features on 'mypool':
  async_destroy
  empty_bpobj
  lz4_compress
  multi_vdev_crash_dump</pre><p><acronym class="acronym">ZFS</acronym> 的新功能在 <code class="command">zpool upgrade</code> 尚未完成之前無法使用。可以用 <code class="command">zpool upgrade -v</code> 來查看升級後有那些新功能，也同時會列出已經支援那些功能。</p><p>升級儲存池支援新版的功能旗標 (Feature flags)：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
status: Some supported features are not enabled on the pool. The pool can
        still be used, but some features are unavailable.
action: Enable all features using 'zpool upgrade'. Once this is done,
        the pool may no longer be accessible by software that does not support
        the features. See zpool-features(7) for details.
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
	    ada0    ONLINE       0     0     0
	    ada1    ONLINE       0     0     0

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool upgrade</code></strong>
This system supports ZFS pool feature flags.

All pools are formatted using feature flags.


Some supported features are not enabled on the following pools. Once a
feature is enabled the pool may become incompatible with software
that does not support the feature. See zpool-features(7) for details.

POOL  FEATURE
---------------
zstore
      multi_vdev_crash_dump
      spacemap_histogram
      enabled_txg
      hole_birth
      extensible_dataset
      bookmarks
      filesystem_limits
<code class="prompt">#</code> <strong class="userinput"><code>zpool upgrade mypool</code></strong>
This system supports ZFS pool feature flags.

Enabled the following features on 'mypool':
  spacemap_histogram
  enabled_txg
  hole_birth
  extensible_dataset
  bookmarks
  filesystem_limits</pre><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">在使用儲存池來開機的系統上的 Boot code 也必須一併更新來支援新的儲存池版本，可在含有 Boot code 的分割區使用 <code class="command">gpart bootcode</code> 來更新。目前有兩種 Boot code 可使用，需視系統開機的方式使用：<acronym class="acronym">GPT</acronym> (最常用的選項) 以及 <acronym class="acronym">EFI</acronym> (較新的系統)。</p><p xmlns="http://www.w3.org/1999/xhtml">針對傳統使用 GPT 開機的系統，可以使用以下指令：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i <em class="replaceable"><code>1</code></em> <em class="replaceable"><code>ada1</code></em></code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">針對使用 EFI 開機的系統可以執行以下指令：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -p /boot/boot1.efifat -i <em class="replaceable"><code>1</code></em> <em class="replaceable"><code>ada1</code></em></code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">套用 Boot code 到所有儲存池中可開機的磁碟。請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gpart</span>(8)</span></a> 以取得更多資訊。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-history"></a>19.3.12. 顯示已記錄的儲存池歷史日誌</h3></div></div></div><p>修改儲存池的指令會被記錄下來，會記錄的動作包含資料集的建立，屬性更改或更換磁碟。這個歷史記錄用來查看儲存池是如何建立、由誰執行、什麼動作及何時。歷史記錄並非儲存在日誌檔 (Log file)，而是儲存在儲存池。查看這個歷史記錄的指令名稱為 <code class="command">zpool history</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool history</code></strong>
History for 'tank':
2013-02-26.23:02:35 zpool create tank mirror /dev/ada0 /dev/ada1
2013-02-27.18:50:58 zfs set atime=off tank
2013-02-27.18:51:09 zfs set checksum=fletcher4 tank
2013-02-27.18:51:18 zfs create tank/backup</pre><p>輸出結果顯示曾在該儲存池上執行的 <code class="command">zpool</code> 與 <code class="command">zfs</code> 指令以及時間戳記。只有會修改儲存池或類似的指令會被記錄下來，像是 <code class="command">zfs list</code> 這種指令並不會被記錄。當不指定儲存池名稱時，會列出所有儲存池的歷史記錄。</p><p>在提供選項 <code class="option">-i</code> 或 <code class="option">-l</code> 時 <code class="command">zpool history</code> 可以顯更多詳細資訊。<code class="option">-i</code> 會顯示使用者觸發的事件外，也會顯示內部記錄的  <acronym class="acronym">ZFS</acronym> 事件。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool history -i</code></strong>
History for 'tank':
2013-02-26.23:02:35 [internal pool create txg:5] pool spa 28; zfs spa 28; zpl 5;uts  9.1-RELEASE 901000 amd64
2013-02-27.18:50:53 [internal property set txg:50] atime=0 dataset = 21
2013-02-27.18:50:58 zfs set atime=off tank
2013-02-27.18:51:04 [internal property set txg:53] checksum=7 dataset = 21
2013-02-27.18:51:09 zfs set checksum=fletcher4 tank
2013-02-27.18:51:13 [internal create txg:55] dataset = 39
2013-02-27.18:51:18 zfs create tank/backup</pre><p>更多詳細的資訊可加上 <code class="option">-l</code> 來取得，歷史記錄會以較長的格式顯示，包含的資訊有執行指令的使用者名稱、主機名稱以及更改的項目。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool history -l</code></strong>
History for 'tank':
2013-02-26.23:02:35 zpool create tank mirror /dev/ada0 /dev/ada1 [user 0 (root) on :global]
2013-02-27.18:50:58 zfs set atime=off tank [user 0 (root) on myzfsbox:global]
2013-02-27.18:51:09 zfs set checksum=fletcher4 tank [user 0 (root) on myzfsbox:global]
2013-02-27.18:51:18 zfs create tank/backup [user 0 (root) on myzfsbox:global]</pre><p>輸出結果顯示 <code class="systemitem">root</code> 使用者使用 <code class="filename">/dev/ada0</code> 及 <code class="filename">/dev/ada1</code> 建立鏡像的儲存池。主機名稱 <code class="systemitem">myzfsbox</code> 在建立完儲存池後也同樣會顯示。由於儲存池可以從一個系統匯出再匯入到另一個系統，因此主機名稱也很重要，這樣一來可以清楚的辦識在其他系統上執行的每一個指令的主機名稱。</p><p>兩個 <code class="command">zpool history</code> 選項可以合併使用來取得最完整的儲存池詳細資訊。儲存池歷史記錄在追蹤執行什麼動作或要取得除錯所需的輸出結果提供了非常有用的資訊。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-iostat"></a>19.3.13. 監視效能</h3></div></div></div><p>內建的監視系統可以即時顯示儲存池的 <acronym class="acronym">I/O</acronym> 統計資訊。它會顯示儲存池剩餘的空間與使用的空間，每秒執行了多少讀取與寫入的操作，有多少 <acronym class="acronym">I/O</acronym> 頻寬被使用。預設會監視所有在系統中的儲存池都並顯示出來，可以提供儲存池名稱來只顯示該儲存池的監視資訊。舉一個簡單的例子：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool iostat</code></strong>
               capacity     operations    bandwidth
pool        alloc   free   read  write   read  write
----------  -----  -----  -----  -----  -----  -----
data         288G  1.53T      2     11  11.3K  57.1K</pre><p>要持續監視 <acronym class="acronym">I/O</acronym> 的活動可以在最後的參數指定一個數字，這個數字代表每次更新資訊所間隔的秒數。在每次經過間隔的時間後會列出新一行的統計資訊，按下 <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span> 可以中止監視。或者在指令列的間隔時間之後再指定一個數字，代表總共要顯示的統計資訊筆數。</p><p>使用 <code class="option">-v</code> 可以顯示更詳細的 <acronym class="acronym">I/O</acronym> 統計資訊。每個在儲存池中的裝置會以一行統計資訊顯示。這可以幫助了解每一個裝置做了多少讀取與寫入的操作，並可協助確認是否有各別裝置拖慢了整個儲存池的速度。以下範例會顯示有兩個裝置的鏡像儲存池：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool iostat -v </code></strong>
                            capacity     operations    bandwidth
pool                     alloc   free   read  write   read  write
-----------------------  -----  -----  -----  -----  -----  -----
data                      288G  1.53T      2     12  9.23K  61.5K
  mirror                  288G  1.53T      2     12  9.23K  61.5K
    ada1                     -      -      0      4  5.61K  61.7K
    ada2                     -      -      1      4  5.04K  61.7K
-----------------------  -----  -----  -----  -----  -----  -----</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-split"></a>19.3.14. 分割儲存儲存池</h3></div></div></div><p>由一個或多個鏡像 vdev 所組成的儲存池可以切分開成兩個儲存池。除非有另外指定，否則每個鏡像的最後一個成員會被分離來然用來建立一個含有相同資料的新儲存池。在做這個操作的第一次應先使用 <code class="option">-n</code>，會顯示預計會做的操作而不會真的執行，這可以協助確認操作是否與使用者所要的相同。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="zfs-zfs"></a>19.4. <code class="command">zfs</code> 管理</h2></div></div></div><p><code class="command">zfs</code> 工具負責建立、摧毀與管理在一個儲存池中所有的 <acronym class="acronym">ZFS</acronym> 資料集。儲存池使用 <a class="link" href="#zfs-zpool" title="19.3. zpool 管理"><code class="command">zpool</code></a> 來管理。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-create"></a>19.4.1. 建立與摧毀資料集</h3></div></div></div><p>不同於傳統的磁碟與磁碟區管理程式 (Volume manager) ，在 <acronym class="acronym">ZFS</acronym> 中的空間並<span class="emphasis"><em>不</em></span>會預先分配。傳統的檔案系統在分割與分配空間完後，若沒有增加新的磁碟便無法再增加額外的檔案系統。在 <acronym class="acronym">ZFS</acronym>，可以隨時建立新的檔案系統，每個資料集 (<a class="link" href="#zfs-term-dataset"><span class="emphasis"><em>Dataset</em></span></a>) 都有自己的屬性，包含壓縮 (Compression)、去重複 (Deduplication)、快取 (Caching) 與配額 (Quota) 功能以及其他有用的屬性如唯讀 (Readonly)、區分大小寫 (Case sensitivity)、網路檔案分享 (Network file sharing) 以及掛載點 (Mount point)。資料集可以存在於其他資料集中，且子資料集會繼承其父資料集的屬性。每個資料集都可以作為一個單位來管理、委託 (<a class="link" href="#zfs-zfs-allow" title="19.5. 委託管理">Delegate</a>)、備份 (<a class="link" href="#zfs-zfs-send" title="19.4.7. 備份 (Replication)">Replicate</a>)、快照 (<a class="link" href="#zfs-zfs-snapshot" title="19.4.5. 管理快照 (Snapshot)">Snapshot</a>)、監禁 (<a class="link" href="#zfs-zfs-jail" title="19.4.12. ZFS 與 Jail">Jail</a>) 與摧毀 (Destroy)，替每種不同類型或集合的檔案建立各別的資料集還有許多的好處。唯一的缺點是在當有非常大數量的資料集時，部份指令例如 <code class="command">zfs list</code> 會變的較緩慢，且掛載上百個或其至上千個資料集可能會使 FreeBSD 的開機程序變慢。</p><p>建立一個新資料集並開啟 <a class="link" href="#zfs-term-compression-lz4">LZ4 壓縮</a>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs list</code></strong>
NAME                  USED  AVAIL  REFER  MOUNTPOINT
mypool                781M  93.2G   144K  none
mypool/ROOT           777M  93.2G   144K  none
mypool/ROOT/default   777M  93.2G   777M  /
mypool/tmp            176K  93.2G   176K  /tmp
mypool/usr            616K  93.2G   144K  /usr
mypool/usr/home       184K  93.2G   184K  /usr/home
mypool/usr/ports      144K  93.2G   144K  /usr/ports
mypool/usr/src        144K  93.2G   144K  /usr/src
mypool/var           1.20M  93.2G   608K  /var
mypool/var/crash      148K  93.2G   148K  /var/crash
mypool/var/log        178K  93.2G   178K  /var/log
mypool/var/mail       144K  93.2G   144K  /var/mail
mypool/var/tmp        152K  93.2G   152K  /var/tmp
<code class="prompt">#</code> <strong class="userinput"><code>zfs create -o compress=lz4 <em class="replaceable"><code>mypool/usr/mydataset</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list</code></strong>
NAME                   USED  AVAIL  REFER  MOUNTPOINT
mypool                 781M  93.2G   144K  none
mypool/ROOT            777M  93.2G   144K  none
mypool/ROOT/default    777M  93.2G   777M  /
mypool/tmp             176K  93.2G   176K  /tmp
mypool/usr             704K  93.2G   144K  /usr
mypool/usr/home        184K  93.2G   184K  /usr/home
mypool/usr/mydataset  87.5K  93.2G  87.5K  /usr/mydataset
mypool/usr/ports       144K  93.2G   144K  /usr/ports
mypool/usr/src         144K  93.2G   144K  /usr/src
mypool/var            1.20M  93.2G   610K  /var
mypool/var/crash       148K  93.2G   148K  /var/crash
mypool/var/log         178K  93.2G   178K  /var/log
mypool/var/mail        144K  93.2G   144K  /var/mail
mypool/var/tmp         152K  93.2G   152K  /var/tmp</pre><p>摧毀資料集會比刪除所有在資料集上所殘留的檔案來的快，由於摧毀資料集並不會掃描所有檔案並更新所有相關的 Metadata。</p><p>摧毀先前建立的資料集：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs list</code></strong>
NAME                   USED  AVAIL  REFER  MOUNTPOINT
mypool                 880M  93.1G   144K  none
mypool/ROOT            777M  93.1G   144K  none
mypool/ROOT/default    777M  93.1G   777M  /
mypool/tmp             176K  93.1G   176K  /tmp
mypool/usr             101M  93.1G   144K  /usr
mypool/usr/home        184K  93.1G   184K  /usr/home
mypool/usr/mydataset   100M  93.1G   100M  /usr/mydataset
mypool/usr/ports       144K  93.1G   144K  /usr/ports
mypool/usr/src         144K  93.1G   144K  /usr/src
mypool/var            1.20M  93.1G   610K  /var
mypool/var/crash       148K  93.1G   148K  /var/crash
mypool/var/log         178K  93.1G   178K  /var/log
mypool/var/mail        144K  93.1G   144K  /var/mail
mypool/var/tmp         152K  93.1G   152K  /var/tmp
<code class="prompt">#</code> <strong class="userinput"><code>zfs destroy <em class="replaceable"><code>mypool/usr/mydataset</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list</code></strong>
NAME                  USED  AVAIL  REFER  MOUNTPOINT
mypool                781M  93.2G   144K  none
mypool/ROOT           777M  93.2G   144K  none
mypool/ROOT/default   777M  93.2G   777M  /
mypool/tmp            176K  93.2G   176K  /tmp
mypool/usr            616K  93.2G   144K  /usr
mypool/usr/home       184K  93.2G   184K  /usr/home
mypool/usr/ports      144K  93.2G   144K  /usr/ports
mypool/usr/src        144K  93.2G   144K  /usr/src
mypool/var           1.21M  93.2G   612K  /var
mypool/var/crash      148K  93.2G   148K  /var/crash
mypool/var/log        178K  93.2G   178K  /var/log
mypool/var/mail       144K  93.2G   144K  /var/mail
mypool/var/tmp        152K  93.2G   152K  /var/tmp</pre><p>在最近版本的 <acronym class="acronym">ZFS</acronym>，<code class="command">zfs destroy</code> 是非同步的，且釋放出的空間會許要花費數分鐘才會出現在儲存池上，可使用 <code class="command">zpool get freeing <em class="replaceable"><code>poolname</code></em></code> 來查看 <code class="literal">freeing</code> 屬性，這個屬性會指出資料集在背景已經釋放多少資料區塊了。若有子資料集，如快照 (<a class="link" href="#zfs-term-snapshot">Snapshot</a>) 或其他資料集存在的話，則會無法摧毀父資料集。要摧毀一個資料集及其所有子資料集，可使用 <code class="option">-r</code> 來做遞迴摧毀資料集及其所有子資料集，可用 <code class="option">-n</code> <code class="option">-v</code> 來列出會被這個操作所摧毀的資料集及快照，而不會真的摧毀，因摧毀快照所釋放出的空間也會同時顯示。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-volume"></a>19.4.2. 建立與摧毀磁碟區</h3></div></div></div><p>磁碟區 (Volume) 是特殊類型的資料集，不會被掛載成一個檔案系統，而是會被當做儲存區塊裝置出現在 <code class="filename">/dev/zvol/<em class="replaceable"><code>poolname</code></em>/<em class="replaceable"><code>dataset</code></em></code> 下。這讓磁碟區可供其他檔案系統使用、拿來備份虛擬機器的磁碟或是使用 <acronym class="acronym">iSCSI</acronym> 或 <acronym class="acronym">HAST</acronym> 通訊協定匯出。</p><p>磁碟區可以被格式化成任何檔案系統，或不使用檔案系統來儲存原始資料。對一般使用者，磁碟區就像是一般的磁碟，可以放置一般的檔案系統在這些 <span class="emphasis"><em>zvols</em></span> 上，並提供一般磁碟或檔案系統一般所沒有的功能。例如，使用壓縮屬性在一個 250 MB 的磁碟區可建立一個壓縮的 <acronym class="acronym">FAT</acronym> 檔案系統。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs create -V 250m -o compression=on tank/fat32</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list tank</code></strong>
NAME USED AVAIL REFER MOUNTPOINT
tank 258M  670M   31K /tank
<code class="prompt">#</code> <strong class="userinput"><code>newfs_msdos -F32 /dev/zvol/tank/fat32</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -t msdosfs /dev/zvol/tank/fat32 /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df -h /mnt | grep fat32</code></strong>
Filesystem           Size Used Avail Capacity Mounted on
/dev/zvol/tank/fat32 249M  24k  249M     0%   /mnt
<code class="prompt">#</code> <strong class="userinput"><code>mount | grep fat32</code></strong>
/dev/zvol/tank/fat32 on /mnt (msdosfs, local)</pre><p>摧毀一個磁碟區與摧毀一個一般的檔案系統資料集差不多。操作上幾乎是即時的，但在背景會需要花費數分鐘來讓釋放空間再次可用。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-rename"></a>19.4.3. 重新命名資料集</h3></div></div></div><p>資料集的名稱可以使用 <code class="command">zfs rename</code> 更改。父資料集也同樣可以使用這個指令來更改名稱。重新命名一個資料集到另一個父資料集也會更改自父資料集繼承的屬性值。重新命名資料集後，會被卸載然後重新掛載到新的位置 (依繼承的新父資料集而定)，可使用 <code class="option">-u</code> 來避免重新掛載。</p><p>重新命名一個資料集並移動該資料集到另一個父資料集：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs list</code></strong>
NAME                   USED  AVAIL  REFER  MOUNTPOINT
mypool                 780M  93.2G   144K  none
mypool/ROOT            777M  93.2G   144K  none
mypool/ROOT/default    777M  93.2G   777M  /
mypool/tmp             176K  93.2G   176K  /tmp
mypool/usr             704K  93.2G   144K  /usr
mypool/usr/home        184K  93.2G   184K  /usr/home
mypool/usr/mydataset  87.5K  93.2G  87.5K  /usr/mydataset
mypool/usr/ports       144K  93.2G   144K  /usr/ports
mypool/usr/src         144K  93.2G   144K  /usr/src
mypool/var            1.21M  93.2G   614K  /var
mypool/var/crash       148K  93.2G   148K  /var/crash
mypool/var/log         178K  93.2G   178K  /var/log
mypool/var/mail        144K  93.2G   144K  /var/mail
mypool/var/tmp         152K  93.2G   152K  /var/tmp
<code class="prompt">#</code> <strong class="userinput"><code>zfs rename <em class="replaceable"><code>mypool/usr/mydataset</code></em> <em class="replaceable"><code>mypool/var/newname</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list</code></strong>
NAME                  USED  AVAIL  REFER  MOUNTPOINT
mypool                780M  93.2G   144K  none
mypool/ROOT           777M  93.2G   144K  none
mypool/ROOT/default   777M  93.2G   777M  /
mypool/tmp            176K  93.2G   176K  /tmp
mypool/usr            616K  93.2G   144K  /usr
mypool/usr/home       184K  93.2G   184K  /usr/home
mypool/usr/ports      144K  93.2G   144K  /usr/ports
mypool/usr/src        144K  93.2G   144K  /usr/src
mypool/var           1.29M  93.2G   614K  /var
mypool/var/crash      148K  93.2G   148K  /var/crash
mypool/var/log        178K  93.2G   178K  /var/log
mypool/var/mail       144K  93.2G   144K  /var/mail
mypool/var/newname   87.5K  93.2G  87.5K  /var/newname
mypool/var/tmp        152K  93.2G   152K  /var/tmp</pre><p>快照也可以像這樣重新命名，由於快照的本質使其無法被重新命名到另一個父資料集。要遞迴重新命名快照可指定 <code class="option">-r</code>，然後在子資料集中所有同名的快照也會一併被重新命名。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs list -t snapshot</code></strong>
NAME                                USED  AVAIL  REFER  MOUNTPOINT
mypool/var/newname@first_snapshot      0      -  87.5K  -
<code class="prompt">#</code> <strong class="userinput"><code>zfs rename <em class="replaceable"><code>mypool/var/newname@first_snapshot</code></em> <em class="replaceable"><code>new_snapshot_name</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list -t snapshot</code></strong>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/newname@new_snapshot_name      0      -  87.5K  -</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-set"></a>19.4.4. 設定資料集屬性</h3></div></div></div><p>每個 <acronym class="acronym">ZFS</acronym> 資料集有數個屬性可以用來控制其行為。大部份的屬性會自動繼承自其父資料集，但可以被自己覆蓋。設定資料集上的屬性可使用 <code class="command">zfs set <em class="replaceable"><code>property</code></em>=<em class="replaceable"><code>value</code></em> <em class="replaceable"><code>dataset</code></em></code>。大部份屬性有限制可用的值，<code class="command">zfs get</code> 會顯示每個可以使用的屬性及其可用的值。大部份可以使用 <code class="command">zfs inherit</code> 還原成其繼承的值。</p><p>也可設定使用者自訂的屬性。這些屬性也會成為資料集設定的一部份，且可以被用來提供資料集或其內容的額外資訊。要別分自訂屬性與 <acronym class="acronym">ZFS</acronym> 提供的屬性，會使用冒號 (<code class="literal">:</code>) 建立一個自訂命名空間供自訂屬性使用。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs set <em class="replaceable"><code>custom</code></em>:<em class="replaceable"><code>costcenter</code></em>=<em class="replaceable"><code>1234</code></em> <em class="replaceable"><code>tank</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs get <em class="replaceable"><code>custom</code></em>:<em class="replaceable"><code>costcenter</code></em> <em class="replaceable"><code>tank</code></em></code></strong>
NAME PROPERTY           VALUE SOURCE
tank custom:costcenter  1234  local</pre><p>要移除自訂屬性，可用 <code class="command">zfs inherit</code> 加上 <code class="option">-r</code>。若父資料集未定義任何自訂屬性，將會將該屬性完全移除 (更改動作仍會記錄於儲存池的歷史記錄)。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs inherit -r <em class="replaceable"><code>custom</code></em>:<em class="replaceable"><code>costcenter</code></em> <em class="replaceable"><code>tank</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs get <em class="replaceable"><code>custom</code></em>:<em class="replaceable"><code>costcenter</code></em> <em class="replaceable"><code>tank</code></em></code></strong>
NAME    PROPERTY           VALUE              SOURCE
tank    custom:costcenter  -                  -
<code class="prompt">#</code> <strong class="userinput"><code>zfs get all <em class="replaceable"><code>tank</code></em> | grep <em class="replaceable"><code>custom</code></em>:<em class="replaceable"><code>costcenter</code></em></code></strong>
<code class="prompt">#</code></pre><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-set-share"></a>19.4.4.1. 取得與設定共享屬性</h4></div></div></div><p xml:lang="en" lang="en">Two commonly used and useful dataset properties are the
	<acronym class="acronym">NFS</acronym> and <acronym class="acronym">SMB</acronym> share
	options.  Setting these define if and how
	<acronym class="acronym">ZFS</acronym> datasets may be shared on the network.
	At present, only setting sharing via <acronym class="acronym">NFS</acronym> is
	supported on FreeBSD.  To get the current status of
	a share, enter:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs get sharenfs <em class="replaceable"><code>mypool/usr/home</code></em></code></strong>
NAME             PROPERTY  VALUE    SOURCE
mypool/usr/home  sharenfs  on       local
<code class="prompt">#</code> <strong class="userinput"><code>zfs get sharesmb <em class="replaceable"><code>mypool/usr/home</code></em></code></strong>
NAME             PROPERTY  VALUE    SOURCE
mypool/usr/home  sharesmb  off      local</pre><p xml:lang="en" lang="en">To enable sharing of a dataset, enter:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code> zfs set sharenfs=on <em class="replaceable"><code>mypool/usr/home</code></em></code></strong></pre><p xml:lang="en" lang="en">It is also possible to set additional options for sharing
      datasets through <acronym class="acronym">NFS</acronym>, such as
      <code class="option">-alldirs</code>, <code class="option">-maproot</code> and
      <code class="option">-network</code>.  To set additional options to a
      dataset shared through NFS, enter:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code> zfs set sharenfs="-alldirs,-maproot=<em class="replaceable"><code>root</code></em>,-network=<em class="replaceable"><code>192.168.1.0/24</code></em>" <em class="replaceable"><code>mypool/usr/home</code></em></code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-snapshot"></a>19.4.5. 管理快照 (Snapshot)</h3></div></div></div><p>快照 (<a class="link" href="#zfs-term-snapshot">Snapshot</a>) 是 <acronym class="acronym">ZFS</acronym> 最強大的功能之一。快照提供了資料集唯讀、單一時間點 (Point-in-Time) 的複製功能，使用了寫入時複製 (Copy-On-Write, <acronym class="acronym">COW</acronym>) 的技術，可以透過保存在磁碟上的舊版資料快速的建立快照。若沒有快照存在，在資料被覆蓋或刪除時，便回收空間供未來使用。由於只記錄前一個版本與目前資料集的差異，因此快照可節省磁碟空間。快照只允許在整個資料集上使用，無法在各別檔案或目錄。當建立了一個資料集的快照時，便備份了所有內含的資料，這包含了檔案系統屬性、檔案、目錄、權限等等。第一次建立快照時只會使用到更改參照到資料區塊的空間，不會用到其他額外的空間。使用 <code class="option">-r</code> 可以對使用同名的資料集及其所有子資料集的建立一個遞迴快照，提供一致且即時 (Moment-in-time) 的完整檔案系統快照功能，這對於那些彼此有相關或相依檔案存放在不同資料集的應用程式非常重要。不使用快照所備份的資料其實是分散不同時間點的。</p><p><acronym class="acronym">ZFS</acronym> 中的快照提供了多種功能，即使是在其他缺乏快照功能的檔案系統上。一個使用快照的典型例子是在安裝軟體或執行系統升級這種有風險的動作時，能有一個快速的方式可以備份檔案系統目前的狀態，若動作失敗，可以使用快照還原 (Roll back) 到與快照建立時相同的系統狀態，若升級成功，便可刪除快照來釋放空間。若沒有快照功能，升級失敗通常會需要使用備份來恢復 (Restore) 系統，而這個動作非常繁瑣、耗時且可能會需要停機一段時間系統無法使用。使用快照可以快速的還原，即使系統正在執行一般的運作，只而要短暫或甚至不需停機。能夠節省大量在有數 TB 的儲存系統上從備份複製所需資料的時間。快照並非要用來取代儲存池的完整備份，但可以用在快速且簡單的保存某個特定時間點的資料集。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-snapshot-creation"></a>19.4.5.1. 建立快照</h4></div></div></div><p>快照可以使用 <code class="command">zfs snapshot <em class="replaceable"><code>dataset</code></em>@<em class="replaceable"><code>snapshotname</code></em></code> 來建立。加入 <code class="option">-r</code> 可以遞迴對所有同名的子資料集建立快照。</p><p>建立一個整個儲存池的遞迴快照：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs list -t all</code></strong>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool                                 780M  93.2G   144K  none
mypool/ROOT                            777M  93.2G   144K  none
mypool/ROOT/default                    777M  93.2G   777M  /
mypool/tmp                             176K  93.2G   176K  /tmp
mypool/usr                             616K  93.2G   144K  /usr
mypool/usr/home                        184K  93.2G   184K  /usr/home
mypool/usr/ports                       144K  93.2G   144K  /usr/ports
mypool/usr/src                         144K  93.2G   144K  /usr/src
mypool/var                            1.29M  93.2G   616K  /var
mypool/var/crash                       148K  93.2G   148K  /var/crash
mypool/var/log                         178K  93.2G   178K  /var/log
mypool/var/mail                        144K  93.2G   144K  /var/mail
mypool/var/newname                    87.5K  93.2G  87.5K  /var/newname
mypool/var/newname@new_snapshot_name      0      -  87.5K  -
mypool/var/tmp                         152K  93.2G   152K  /var/tmp
<code class="prompt">#</code> <strong class="userinput"><code>zfs snapshot -r <em class="replaceable"><code>mypool@my_recursive_snapshot</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list -t snapshot</code></strong>
NAME                                        USED  AVAIL  REFER  MOUNTPOINT
mypool@my_recursive_snapshot                   0      -   144K  -
mypool/ROOT@my_recursive_snapshot              0      -   144K  -
mypool/ROOT/default@my_recursive_snapshot      0      -   777M  -
mypool/tmp@my_recursive_snapshot               0      -   176K  -
mypool/usr@my_recursive_snapshot               0      -   144K  -
mypool/usr/home@my_recursive_snapshot          0      -   184K  -
mypool/usr/ports@my_recursive_snapshot         0      -   144K  -
mypool/usr/src@my_recursive_snapshot           0      -   144K  -
mypool/var@my_recursive_snapshot               0      -   616K  -
mypool/var/crash@my_recursive_snapshot         0      -   148K  -
mypool/var/log@my_recursive_snapshot           0      -   178K  -
mypool/var/mail@my_recursive_snapshot          0      -   144K  -
mypool/var/newname@new_snapshot_name           0      -  87.5K  -
mypool/var/newname@my_recursive_snapshot       0      -  87.5K  -
mypool/var/tmp@my_recursive_snapshot           0      -   152K  -</pre><p>建立的快照不會顯示在一般的 <code class="command">zfs list</code> 操作結果，要列出快照需在 <code class="command">zfs list</code> 後加上 <code class="option">-t snapshot</code>，使用 <code class="option">-t all</code> 可以同時列出檔案系統的內容及快照。</p><p>快照並不會直接掛載，因此 <code class="literal">MOUNTPOINT</code> 欄位的路徑如此顯示。在 <code class="literal">AVAIL</code> 欄位不會有可用的磁碟空間，因為快照建立之後便無法再寫入。比較快照與其原來建立時的資料集：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs list -rt all <em class="replaceable"><code>mypool/usr/home</code></em></code></strong>
NAME                                    USED  AVAIL  REFER  MOUNTPOINT
mypool/usr/home                         184K  93.2G   184K  /usr/home
mypool/usr/home@my_recursive_snapshot      0      -   184K  -</pre><p>同時顯示資料集與快照可以了解快照如何使用 <a class="link" href="#zfs-term-cow">COW</a> 技術來運作。快照只會保存有更動 (<span class="emphasis"><em>差異</em></span>) 的資料，並非整個檔案系統的內容，這個意思是說，快照只會在有做更動時使用一小部份的空間，複製一個檔案到該資料集，可以讓空間使用量變的更明顯，然後再做第二個快照：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cp <em class="replaceable"><code>/etc/passwd</code></em> <em class="replaceable"><code>/var/tmp</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs snapshot <em class="replaceable"><code>mypool/var/tmp</code></em>@<em class="replaceable"><code>after_cp</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list -rt all <em class="replaceable"><code>mypool/var/tmp</code></em></code></strong>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp                         206K  93.2G   118K  /var/tmp
mypool/var/tmp@my_recursive_snapshot    88K      -   152K  -
mypool/var/tmp@after_cp                   0      -   118K  -</pre><p>第二快照只會包含了資料集做了複製動作後的更動，這樣的機制可以節省大量的空間。注意在複製之後快照 <em class="replaceable"><code>mypool/var/tmp@my_recursive_snapshot</code></em> 於 <code class="literal">USED</code> 欄位中的大小也更改了，這說明了這個更動在前次快照與之後快照間的關係。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-snapshot-diff"></a>19.4.5.2. 比對快照</h4></div></div></div><p>ZFS 提供了內建指令可以用來比對兩個快照 (Snapshot) 之間的差異，在使用者想要查看一段時間之間檔案系統所的變更時非常有用。例如 <code class="command">zfs diff</code> 可以讓使用者在最後一次快照中找到意外刪除的檔案。對前面一節所做的兩個快照使用這個指令會產生以下結果：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs list -rt all <em class="replaceable"><code>mypool/var/tmp</code></em></code></strong>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp                         206K  93.2G   118K  /var/tmp
mypool/var/tmp@my_recursive_snapshot    88K      -   152K  -
mypool/var/tmp@after_cp                   0      -   118K  -
<code class="prompt">#</code> <strong class="userinput"><code>zfs diff <em class="replaceable"><code>mypool/var/tmp@my_recursive_snapshot</code></em></code></strong>
M       /var/tmp/
+       /var/tmp/passwd</pre><p>指令會列出指定快照 (在這個例子中為 <code class="literal"><em class="replaceable"><code>mypool/var/tmp@my_recursive_snapshot</code></em></code>) 與目前檔案系統間的更改。第一個欄位是更改的類型：</p><div class="informaltable"><table width="100%" border="1"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td xml:lang="en" valign="top" lang="en">+</td><td valign="top">加入了該路徑或檔案。</td></tr><tr><td xml:lang="en" valign="top" lang="en">-</td><td valign="top">刪除了該路徑或檔案。</td></tr><tr><td xml:lang="en" valign="top" lang="en">M</td><td valign="top">修改了該路徑或檔案。</td></tr><tr><td xml:lang="en" valign="top" lang="en">R</td><td valign="top">重新命名了該路徑或檔案。</td></tr></tbody></table></div><p>對照這個表格來看輸出的結果，可以明顯的看到 <code class="filename"><em class="replaceable"><code>passwd</code></em></code> 是在快照 <code class="literal"><em class="replaceable"><code>mypool/var/tmp@my_recursive_snapshot</code></em></code> 建立之後才加入的，結果也同樣看的到掛載到 <code class="literal"><em class="replaceable"><code>/var/tmp</code></em></code> 的父目錄已經做過修改。</p><p>在使用 <acronym class="acronym">ZFS</acronym> 備份功能來傳輸一個資料集到另一個主機備份時比對兩個快照也同樣很有用。</p><p>比對兩個快照需要提供兩個資料集的完整資料集名稱與快照名稱：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cp /var/tmp/passwd /var/tmp/passwd.copy</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs snapshot <em class="replaceable"><code>mypool/var/tmp@diff_snapshot</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs diff <em class="replaceable"><code>mypool/var/tmp@my_recursive_snapshot</code></em> <em class="replaceable"><code>mypool/var/tmp@diff_snapshot</code></em></code></strong>
M       /var/tmp/
+       /var/tmp/passwd
+       /var/tmp/passwd.copy
<code class="prompt">#</code> <strong class="userinput"><code>zfs diff <em class="replaceable"><code>mypool/var/tmp@my_recursive_snapshot</code></em> <em class="replaceable"><code>mypool/var/tmp@after_cp</code></em></code></strong>
M       /var/tmp/
+       /var/tmp/passwd</pre><p>備份管理者可以比對兩個自傳送主機所接收到的兩個快照並查看實際在資料集中的變更。請參考 <a class="link" href="#zfs-zfs-send" title="19.4.7. 備份 (Replication)">備份</a> 一節來取得更多資訊。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-snapshot-rollback"></a>19.4.5.3. 使用快照還原</h4></div></div></div><p>只要至少有一個可用的快照便可以隨時還原。大多數在已不需要目前資料集，想要改用較舊版的資料的情況，例如，本地開發的測試發生錯誤、不良的系統更新破壞了系統的整體功能或需要還原意外刪除檔案或目錄 ... 等，都是非常常見的情形。幸運的，要還原到某個快照只需要簡單輸入 <code class="command">zfs rollback <em class="replaceable"><code>snapshotname</code></em></code>。會依快照所做的變更數量來決定處理的時間，還原的操作會在一段時間後完成。在這段時間中，資料集會一直保持一致的狀態，類似一個符合 ACID 原則的資料庫在做還原。還原可在資料集處於上線及可存取的情況下完成，不需要停機。還原到快照之後，資料集便回到當初執行快照時相同的狀態，所有沒有在快照中的其他資料便會被丟棄，因此往後若還有可能需要部份資料時，建議在還原到前一個快照之前先對目前的資料集做快照，這樣一來，使用者便可以在快照之間來回快換，而不會遺失重要的資料。</p><p>在第一個範例中，因為 <code class="command">rm</code> 操作不小心移除了預期外的資料，要還原到快照。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs list -rt all <em class="replaceable"><code>mypool/var/tmp</code></em></code></strong>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp                         262K  93.2G   120K  /var/tmp
mypool/var/tmp@my_recursive_snapshot    88K      -   152K  -
mypool/var/tmp@after_cp               53.5K      -   118K  -
mypool/var/tmp@diff_snapshot              0      -   120K  -
<code class="prompt">#</code> <strong class="userinput"><code>ls /var/tmp</code></strong>
passwd          passwd.copy     vi.recover
<code class="prompt">#</code> <strong class="userinput"><code>rm /var/tmp/passwd*</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls /var/tmp</code></strong>
vi.recover</pre><p>在此時，使用者發現到刪除了太多檔案並希望能夠還原。<acronym class="acronym">ZFS</acronym> 提供了簡單的方可以取回檔案，便是使用還原 (Rollback)，但這只在有定期對重要的資料使用快照時可用。要拿回檔案並從最後一次快照重新開始，可執行以下指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs rollback <em class="replaceable"><code>mypool/var/tmp@diff_snapshot</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls /var/tmp</code></strong>
passwd          passwd.copy     vi.recover</pre><p>還原操作會將資料集還原為最後一次快照的狀態。這也可以還原到更早之前，有其他在其之後建立的快照。要這麼做時，<acronym class="acronym">ZFS</acronym> 會發出這個警告：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs list -rt snapshot <em class="replaceable"><code>mypool/var/tmp</code></em></code></strong>
AME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp@my_recursive_snapshot    88K      -   152K  -
mypool/var/tmp@after_cp               53.5K      -   118K  -
mypool/var/tmp@diff_snapshot              0      -   120K  -
<code class="prompt">#</code> <strong class="userinput"><code>zfs rollback <em class="replaceable"><code>mypool/var/tmp@my_recursive_snapshot</code></em></code></strong>
cannot rollback to 'mypool/var/tmp@my_recursive_snapshot': more recent snapshots exist
use '-r' to force deletion of the following snapshots:
mypool/var/tmp@after_cp
mypool/var/tmp@diff_snapshot</pre><p>這個警告是因在該快照與資料集的目前狀態之間有其他快照存在，然而使用者想要還原到該快照。要完成這樣的還原動作，必須刪除在這之間的快照，因為 <acronym class="acronym">ZFS</acronym> 無法追蹤不同資料集狀態間的變更。在使用者未指定 <code class="option">-r</code> 來確認這個動作前，<acronym class="acronym">ZFS</acronym> 不會刪除受影響的快照。若確定要這麼做，那麼必須要知道會遺失所有在這之間的快照，然後可執行以下指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs rollback -r <em class="replaceable"><code>mypool/var/tmp@my_recursive_snapshot</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list -rt snapshot <em class="replaceable"><code>mypool/var/tmp</code></em></code></strong>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp@my_recursive_snapshot     8K      -   152K  -
<code class="prompt">#</code> <strong class="userinput"><code>ls /var/tmp</code></strong>
vi.recover</pre><p>可從 <code class="command">zfs list -t snapshot</code> 的結果來確認 <code class="command">zfs rollback -r</code> 會移除的快照。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-snapshot-snapdir"></a>19.4.5.4. 從快照還原個別檔案</h4></div></div></div><p>快照會掛載在父資料集下的隱藏目錄：<code class="filename">.zfs/snapshots/<em class="replaceable"><code>snapshotname</code></em></code>。預設不會顯示這些目錄，即使是用 <code class="command">ls -a</code> 指令。雖然該目錄不會顯示，但該目錄實際存在，而且可以像一般的目錄一樣存取。一個名稱為 <code class="literal">snapdir</code> 的屬性可以控制是否在目錄清單中顯示這些隱藏目錄，設定該屬性為可見 (<code class="literal">visible</code>) 可以讓這些目錄出現在 <code class="command">ls</code> 以及其他處理目錄內容的指令中。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs get snapdir <em class="replaceable"><code>mypool/var/tmp</code></em></code></strong>
NAME            PROPERTY  VALUE    SOURCE
mypool/var/tmp  snapdir   hidden   default
<code class="prompt">#</code> <strong class="userinput"><code>ls -a /var/tmp</code></strong>
.               ..              passwd          vi.recover
<code class="prompt">#</code> <strong class="userinput"><code>zfs set snapdir=visible <em class="replaceable"><code>mypool/var/tmp</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls -a /var/tmp</code></strong>
.               ..              .zfs            passwd          vi.recover</pre><p>要還原個別檔案到先前的狀態非常簡單，只要從快照中複製檔案到父資料集。在 <code class="filename">.zfs/snapshot</code> 目錄結構下有一個與先前所做的快照名稱相同的目錄，可以很容易的找到。在下個範例中，我們會示範從隱藏的 <code class="filename">.zfs</code> 目錄還原一個檔案，透過從含有該檔案的最新版快照複製：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>rm /var/tmp/passwd</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls -a /var/tmp</code></strong>
.               ..              .zfs            vi.recover
<code class="prompt">#</code> <strong class="userinput"><code>ls /var/tmp/.zfs/snapshot</code></strong>
after_cp                my_recursive_snapshot
<code class="prompt">#</code> <strong class="userinput"><code>ls /var/tmp/.zfs/snapshot/<em class="replaceable"><code>after_cp</code></em></code></strong>
passwd          vi.recover
<code class="prompt">#</code> <strong class="userinput"><code>cp /var/tmp/.zfs/snapshot/<em class="replaceable"><code>after_cp/passwd</code></em> <em class="replaceable"><code>/var/tmp</code></em></code></strong></pre><p>執行 <code class="command">ls .zfs/snapshot</code> 時，雖然 <code class="literal">snapdir</code> 可能已經設為隱藏，但仍可能可以顯示該目錄中的內容，這取決於管理者是否要顯示這些目錄，可以只顯示特定的資料集，而其他的則不顯示。從這個隱藏的 <code class="filename">.zfs/snapshot</code> 複製檔案或目錄非常簡單，除此之外，嘗試其他的動作則會出現以下錯誤：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cp <em class="replaceable"><code>/etc/rc.conf</code></em> /var/tmp/.zfs/snapshot/<em class="replaceable"><code>after_cp/</code></em></code></strong>
cp: /var/tmp/.zfs/snapshot/after_cp/rc.conf: Read-only file system</pre><p>這個錯誤用來提醒使用者快照是唯讀的，在建立之後不能更改。無法複製檔案進去或從該快照目錄中移除，因為這會變更該資料集所代表的狀態。</p><p>快照所消耗的空間是依據自快照之後父檔案系統做了多少變更來決定，快照的 <code class="literal">written</code> 屬性可以用來追蹤有多少空間被快照所使用。</p><p>使用 <code class="command">zfs destroy <em class="replaceable"><code>dataset</code></em>@<em class="replaceable"><code>snapshot</code></em></code> 可以摧毀快照並回收空間。加上 <code class="option">-r</code> 可以遞迴移除所有在父資料集下使用同名的快照。加入 <code class="option">-n -v</code> 來顯示將要移除的快照清單以及估計回收的空間，而不會實際執行摧毀的操作。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-clones"></a>19.4.6. 管理複本 (Clone)</h3></div></div></div><p>複本 (Clone) 是快照的複製，但更像是一般的資料集，與快照不同的是，複本是非唯讀的 (可寫)，且可掛載，可以有自己的屬性。使用 <code class="command">zfs clone</code> 建立複本之後，便無法再摧毀用來建立複本的快照。複本與快照的父/子關係可以使用 <code class="command">zfs promote</code> 來對換。提升複本之後 ，快照便會成為複本的子資料集，而不是原來的父資料集，這個動作會改變空間計算的方式，但並不會實際改變空間的使用量。複本可以被掛載到 <acronym class="acronym">ZFS</acronym> 檔案系統階層中的任何一點，並非只能位於原來快照的位置底下。</p><p>要示範複本功能會用到這個範例資料集：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs list -rt all <em class="replaceable"><code>camino/home/joe</code></em></code></strong>
NAME                    USED  AVAIL  REFER  MOUNTPOINT
camino/home/joe         108K   1.3G    87K  /usr/home/joe
camino/home/joe@plans    21K      -  85.5K  -
camino/home/joe@backup    0K      -    87K  -</pre><p>會使用到複本一般是要在可以保留快照以便出錯時可還原的情況下使用指定的資料集做實驗，由於快照並無法做更改，所以會建立一個可以讀/寫的快照複本。當在複本中做完想要執行的動作後，便可以提升複本成資料集，然後移除舊的檔案系統。嚴格來說這並非必要，因為複本與資料集可同時存在，不會有任何問題。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs clone <em class="replaceable"><code>camino/home/joe</code></em>@<em class="replaceable"><code>backup</code></em> <em class="replaceable"><code>camino/home/joenew</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls /usr/home/joe*</code></strong>
/usr/home/joe:
backup.txz     plans.txt

/usr/home/joenew:
backup.txz     plans.txt
<code class="prompt">#</code> <strong class="userinput"><code>df -h /usr/home</code></strong>
Filesystem          Size    Used   Avail Capacity  Mounted on
usr/home/joe        1.3G     31k    1.3G     0%    /usr/home/joe
usr/home/joenew     1.3G     31k    1.3G     0%    /usr/home/joenew</pre><p>建立完的複本便有與建立快照時狀態相同的資料集，現在複本可以獨立於原來的資料集來做更改。剩下唯一與資料集之間的關係便是快照，<acronym class="acronym">ZFS</acronym> 會在屬性 <code class="literal">origin</code> 記錄這個關係，一旦在快照與複本之間的相依關係因為使用 <code class="command">zfs promote</code> 提升而移除時，複本的 <code class="literal">origin</code> 也會因為成為一個完全獨立的資料集而移除。以下範例會示範這個動作：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs get origin <em class="replaceable"><code>camino/home/joenew</code></em></code></strong>
NAME                  PROPERTY  VALUE                     SOURCE
camino/home/joenew    origin    camino/home/joe@backup    -
<code class="prompt">#</code> <strong class="userinput"><code>zfs promote <em class="replaceable"><code>camino/home/joenew</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs get origin <em class="replaceable"><code>camino/home/joenew</code></em></code></strong>
NAME                  PROPERTY  VALUE   SOURCE
camino/home/joenew    origin    -       -</pre><p>做為部份更改之後，例如複製 <code class="filename">loader.conf</code> 到提升後的複本，這個例子中的舊目錄便無須保留，取而代之的是提升後的複本，這個動作可以用兩個連續的指令來完成：在舊資料集上執行 <code class="command">zfs destroy</code> 並在與舊資料相似名稱 (也可能用完全不同的名稱) 的複本上執行 <code class="command">zfs rename</code>。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cp <em class="replaceable"><code>/boot/defaults/loader.conf</code></em> <em class="replaceable"><code>/usr/home/joenew</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs destroy -f <em class="replaceable"><code>camino/home/joe</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs rename <em class="replaceable"><code>camino/home/joenew</code></em> <em class="replaceable"><code>camino/home/joe</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls /usr/home/joe</code></strong>
backup.txz     loader.conf     plans.txt
<code class="prompt">#</code> <strong class="userinput"><code>df -h <em class="replaceable"><code>/usr/home</code></em></code></strong>
Filesystem          Size    Used   Avail Capacity  Mounted on
usr/home/joe        1.3G    128k    1.3G     0%    /usr/home/joe</pre><p>快照的複本現在可以如同一般資料集一樣使用，它的內容包含了所有來自原始快照的資料以及後來加入的檔案，例如 <code class="filename">loader.conf</code>。複本可以在許多不同的情境下使用提供 ZFS 的使用者有用的功能，例如，Jail 可以透過含有已安裝了各種應用程式集的快照來提供，使用者可以複製這些快照然後加入自己想要嘗試的應用程式，一但更改可以滿足需求，便可提升複本為完整的資料集然後提供給終端使用者，讓終端使用者可以如同實際擁有資料集一般的使用，這個以節省提供這些 Jail 的時間與管理成本。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-send"></a>19.4.7. 備份 (Replication)</h3></div></div></div><p>將資料保存在單一地點的單一儲存池上會讓資料暴露在盜竊、自然或人為的風險之下，定期備份整個儲存池非常重要，<acronym class="acronym">ZFS</acronym> 提供了內建的序列化 (Serialization) 功能可以將資料以串流傳送到標準輸出。使用這項技術，不僅可以將資料儲存到另一個已連結到本地系統的儲存池，也可以透過網路將資料傳送到另一個系統，這種備份方式以快照為基礎 (請參考章節 <a class="link" href="#zfs-zfs-snapshot" title="19.4.5. 管理快照 (Snapshot)"><acronym class="acronym">ZFS</acronym> 快照(Snapshot)</a>)。用來備份資料的指令為 <code class="command">zfs send</code> 及 <code class="command">zfs receive</code>。</p><p>以下例子將示範使用兩個儲存池來做 <acronym class="acronym">ZFS</acronym> 備份：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool list</code></strong>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG   CAP  DEDUP  HEALTH  ALTROOT
backup  960M    77K   896M         -         -     0%    0%  1.00x  ONLINE  -
mypool  984M  43.7M   940M         -         -     0%    4%  1.00x  ONLINE  -</pre><p>名為 <em class="replaceable"><code>mypool</code></em> 的儲存池為主要的儲存池，資料會定期寫入與讀取的位置。第二個儲存池 <em class="replaceable"><code>backup</code></em> 用來待命 (Standby)，萬一主要儲存池無法使用時可替換。注意，<acronym class="acronym">ZFS</acronym> 並不會自動做容錯移轉 (Fail-over)，必須要由系統管理者在需要的時候手動完成。快照會用來提供一個與檔系統一致的版本來做備份，<em class="replaceable"><code>mypool</code></em> 的快照建立之後，便可以複製到 <em class="replaceable"><code>backup</code></em> 儲存池，只有快照可以做備份，最近一次快照之後所做的變更不會含在內容裡面。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs snapshot <em class="replaceable"><code>mypool</code></em>@<em class="replaceable"><code>backup1</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list -t snapshot</code></strong>
NAME                    USED  AVAIL  REFER  MOUNTPOINT
mypool@backup1             0      -  43.6M  -</pre><p>快照存在以後，便可以使用 <code class="command">zfs send</code> 來建立一個代表快照內容的串流，這個串流可以儲存成檔案或由其他儲存池接收。串流會寫入到標準輸出，但是必須要重新導向到一個檔案或轉接到其他地方，否則會錯誤：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs send <em class="replaceable"><code>mypool</code></em>@<em class="replaceable"><code>backup1</code></em></code></strong>
Error: Stream can not be written to a terminal.
You must redirect standard output.</pre><p>要使用 <code class="command">zfs send</code> 備份一個資料集，可重新導向到一個位於在已掛載到備份儲存池上的檔案。確定該儲存池有足夠的空間容納要傳送的快照，這裡指的是該快照中內含的所有資料，並非只有上次快照到該快照間的變更。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs send <em class="replaceable"><code>mypool</code></em>@<em class="replaceable"><code>backup1</code></em> &gt; <em class="replaceable"><code>/backup/backup1</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool list</code></strong>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP  HEALTH  ALTROOT
backup  960M  63.7M   896M         -         -     0%     6%  1.00x  ONLINE  -
mypool  984M  43.7M   940M         -         -     0%     4%  1.00x  ONLINE  -</pre><p><code class="command">zfs send</code> 會傳輸在快照 <em class="replaceable"><code>backup1</code></em> 中所有的資料到儲存池 <em class="replaceable"><code>backup</code></em>。可以使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> 排程來自動完成建立與傳送快照的動作。</p><p>若不想將備份以封存檔案儲存，<acronym class="acronym">ZFS</acronym> 可用實際的檔案系統來接收資料，讓備份的資料可以直接被存取。要取得實際包含在串流中的資料可以用 <code class="command">zfs receive</code> 將串流轉換回檔案與目錄。以下例子會以管線符號連接 <code class="command">zfs send</code> 及 <code class="command">zfs receive</code>，將資料從一個儲存池複製到另一個，傳輸完成後可以直接使用接收儲存池上的資料。一個資料集只可以被複製到另一個空的資料集。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs snapshot <em class="replaceable"><code>mypool</code></em>@<em class="replaceable"><code>replica1</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs send -v <em class="replaceable"><code>mypool</code></em>@<em class="replaceable"><code>replica1</code></em> | zfs receive <em class="replaceable"><code>backup/mypool</code></em></code></strong>
send from @ to mypool@replica1 estimated size is 50.1M
total estimated size is 50.1M
TIME        SENT   SNAPSHOT

<code class="prompt">#</code> <strong class="userinput"><code>zpool list</code></strong>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP  HEALTH  ALTROOT
backup  960M  63.7M   896M         -         -     0%     6%  1.00x  ONLINE  -
mypool  984M  43.7M   940M         -         -     0%     4%  1.00x  ONLINE  -</pre><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-send-incremental"></a>19.4.7.1. 漸進式備份</h4></div></div></div><p><code class="command">zfs send</code> 也可以比較兩個快照之間的差異，並且只傳送兩者之間的差異，這麼做可以節省磁碟空間及傳輸時間。例如：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs snapshot <em class="replaceable"><code>mypool</code></em>@<em class="replaceable"><code>replica2</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list -t snapshot</code></strong>
NAME                    USED  AVAIL  REFER  MOUNTPOINT
mypool@replica1         5.72M      -  43.6M  -
mypool@replica2             0      -  44.1M  -
<code class="prompt">#</code> <strong class="userinput"><code>zpool list</code></strong>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG   CAP  DEDUP  HEALTH  ALTROOT
backup  960M  61.7M   898M         -         -     0%    6%  1.00x  ONLINE  -
mypool  960M  50.2M   910M         -         -     0%    5%  1.00x  ONLINE  -</pre><p>會建立一個名為 <em class="replaceable"><code>replica2</code></em> 的第二個快照，這個快照只中只會含有目前與前次快照 <em class="replaceable"><code>replica1</code></em> 之間檔案系統所做的變更。使用 <code class="command">zfs send -i</code> 並指定要用來產生漸進備份串流的快照，串流中只會含有做過更改的資料。這個動作只在接收端已經有初始快照時才可用。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs send -v -i <em class="replaceable"><code>mypool</code></em>@<em class="replaceable"><code>replica1</code></em> <em class="replaceable"><code>mypool</code></em>@<em class="replaceable"><code>replica2</code></em> | zfs receive <em class="replaceable"><code>/backup/mypool</code></em></code></strong>
send from @replica1 to mypool@replica2 estimated size is 5.02M
total estimated size is 5.02M
TIME        SENT   SNAPSHOT

<code class="prompt">#</code> <strong class="userinput"><code>zpool list</code></strong>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG  CAP  DEDUP  HEALTH  ALTROOT
backup  960M  80.8M   879M         -         -     0%   8%  1.00x  ONLINE  -
mypool  960M  50.2M   910M         -         -     0%   5%  1.00x  ONLINE  -

<code class="prompt">#</code> <strong class="userinput"><code>zfs list</code></strong>
NAME                         USED  AVAIL  REFER  MOUNTPOINT
backup                      55.4M   240G   152K  /backup
backup/mypool               55.3M   240G  55.2M  /backup/mypool
mypool                      55.6M  11.6G  55.0M  /mypool

<code class="prompt">#</code> <strong class="userinput"><code>zfs list -t snapshot</code></strong>
NAME                                         USED  AVAIL  REFER  MOUNTPOINT
backup/mypool@replica1                       104K      -  50.2M  -
backup/mypool@replica2                          0      -  55.2M  -
mypool@replica1                             29.9K      -  50.0M  -
mypool@replica2                                 0      -  55.0M  -</pre><p>如此一來，便成功傳輸漸進式的串流，只有做過更改的資料會被備份，不會傳送完整的 <em class="replaceable"><code>replica1</code></em>。由於不會備份完整的儲存池，只傳送差異的部份，所以可以減少傳輸的時間並節省磁碟空間，特別是在網路緩慢或需要考量每位元傳輸成本時非常有用。</p><p>從儲存池 <em class="replaceable"><code>mypool</code></em> 複製所有檔案與資料的新檔案系統 <em class="replaceable"><code>backup/mypool</code></em> 便可以使用。若指定 <code class="option">-P</code>，會一併複製資料集的屬性，這包含壓縮 (Compression) 設定，配額 (Quota) 及掛載點 (Mount point)。若指定 <code class="option">-R</code>，會複製所有指定資料集的子資料集，及這些子資料集的所有屬性。可將傳送與接收自動化來定期使用第二個儲存池做備份。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-send-ssh"></a>19.4.7.2. 透過 <span class="application">SSH</span> 傳送加密的備份</h4></div></div></div><p>透過網路來傳送串流是一個做遠端備份不錯的方式，但是也有一些缺點，透過網路連線傳送的資料沒有加密，這會讓任何人都可以在未告知傳送方的情況下攔截並轉換串流回資料，這是我們所不想見到的情況，特別是在使用網際網路傳送串流到遠端的主機時。<span class="application">SSH</span> 可用來加密要透過網路連線傳送的資料，在 <acronym class="acronym">ZFS</acronym> 只需要將串流重新導向到標準輸出，如此一來便可簡單的轉接到 <span class="application">SSH</span>。若要讓檔案系統內容在傳送或在遠端系統中也維持在加密的狀態可考慮使用 <a class="link" href="https://wiki.freebsd.org/PEFS" target="_top">PEFS</a>。</p><p>有一些設定以及安全性注意事項必須先完成，只有對 <code class="command">zfs send</code> 操作必要的步驟才會在此說明，要取得更多有關 <span class="application">SSH</span> 的資訊請參考 <a class="xref" href="#openssh" title="13.8. OpenSSH">節 13.8, “OpenSSH”</a>。</p><p>必要的環境設定：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>使用 <span class="application">SSH</span> 金鑰設定傳送端與接收端間無密碼的 <span class="application">SSH</span> 存取</p></li><li class="listitem"><p>正常會需要 <code class="systemitem">root</code> 的權限來傳送與接收串流，這需要可以 <code class="systemitem">root</code> 登入到接收端系統。但是，預設因安全性考慮會關閉以 <code class="systemitem">root</code> 登入。ZFS 委託 (<a class="link" href="#zfs-zfs-allow" title="19.5. 委託管理">ZFS Delegation</a>) 系統可以用來允許一個非 <code class="systemitem">root</code> 使用者在每個系統上執行各自的發送與接收操作。</p></li><li class="listitem"><p>在傳送端系統上：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs allow -u someuser send,snapshot <em class="replaceable"><code>mypool</code></em></code></strong></pre></li><li class="listitem"><p>要掛載儲存池，無權限的使用者必須擁有該目錄且必須允許一般的使用者掛載檔案系統。在接收端系統上：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysctl vfs.usermount=1</code></strong>
vfs.usermount: 0 -&gt; 1
<code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /etc/sysctl.conf vfs.usermount=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs create <em class="replaceable"><code>recvpool/backup</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs allow -u <em class="replaceable"><code>someuser</code></em> create,mount,receive <em class="replaceable"><code>recvpool/backup</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chown <em class="replaceable"><code>someuser</code></em> <em class="replaceable"><code>/recvpool/backup</code></em></code></strong></pre></li></ul></div><p>無權限的使用者現在有能力可以接收並掛載資料集，且 <em class="replaceable"><code>home</code></em> 資料集可以被複製到遠端系統：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>zfs snapshot -r <em class="replaceable"><code>mypool/home</code></em>@<em class="replaceable"><code>monday</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>zfs send -R <em class="replaceable"><code>mypool/home</code></em>@<em class="replaceable"><code>monday</code></em> | ssh <em class="replaceable"><code>someuser@backuphost</code></em> zfs recv -dvu <em class="replaceable"><code>recvpool/backup</code></em></code></strong></pre><p>替儲存在儲存池 <em class="replaceable"><code>mypool</code></em> 上的檔案系統資料集 <em class="replaceable"><code>home</code></em> 製作一個遞迴快照 <em class="replaceable"><code>monday</code></em>，然後使用 <code class="command">zfs send -R</code> 來傳送包含該資料集及其所有子資料集、快照、複製與設定的串流。輸出會被導向到 <span class="application">SSH</span> 連線的遠端主機 <em class="replaceable"><code>backuphost</code></em> 上等候輸入的 <code class="command">zfs receive</code>，在此建議使用完整網域名稱或 IP 位置。接收端的機器會寫入資料到 <em class="replaceable"><code>recvpool</code></em> 儲存池上的 <em class="replaceable"><code>backup</code></em> 資料集，在 <code class="command">zfs recv</code> 加上 <code class="option">-d</code> 可覆寫在接收端使用相同名稱的快照，加上 <code class="option">-u</code> 可讓檔案系統在接收端不會被掛載，當使用 <code class="option">-v</code>，會顯示更多有關傳輸的詳細資訊，包含已花費的時間及已傳輸的資料量。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-quota"></a>19.4.8. 資料集、使用者以及群組配額</h3></div></div></div><p>資料集配額 (<a class="link" href="#zfs-term-quota">Dataset quota</a>) 可用來限制特定資料集可以使用的的空間量。參考配額 (<a class="link" href="#zfs-term-refquota">Reference Quota</a>) 的功能也非常相似，差在參考配額只會計算資料集自己使用的空間，不含快照與子資料集。類似的，使用者 (<a class="link" href="#zfs-term-userquota">User</a>) 與群組 (<a class="link" href="#zfs-term-groupquota">Group</a>) 配額可以用來避免使用者或群組用掉儲存池或資料集的所有空間。</p><p>要設定 <code class="filename">storage/home/bob</code> 的資料集配額為 10 GB：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs set quota=10G storage/home/bob</code></strong></pre><p>要設定 <code class="filename">storage/home/bob</code> 的參考配額為 10 GB：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs set refquota=10G storage/home/bob</code></strong></pre><p>要移除 <code class="filename">storage/home/bob</code> 的 10 GB 配額：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs set quota=none storage/home/bob</code></strong></pre><p>設定使用者配額的一般格式為 <code class="literal">userquota@<em class="replaceable"><code>user</code></em>=<em class="replaceable"><code>size</code></em></code> 使用者的名稱必須使用以下格式：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><acronym class="acronym">POSIX</acronym> 相容的名稱，如 <em class="replaceable"><code>joe</code></em>。</p></li><li class="listitem"><p><acronym class="acronym">POSIX</acronym> 數字 ID，如 <em class="replaceable"><code>789</code></em>。</p></li><li class="listitem"><p><acronym class="acronym">SID</acronym> 名稱，如 <em class="replaceable"><code>joe.bloggs@example.com</code></em>。</p></li><li class="listitem"><p><acronym class="acronym">SID</acronym> 數字 ID，如 <em class="replaceable"><code>S-1-123-456-789</code></em>。</p></li></ul></div><p>例如，要設定使用者名為 <em class="replaceable"><code>joe</code></em> 的使用者配額為 50 GB：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs set userquota@joe=50G</code></strong></pre><p>要移除所有配額：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs set userquota@joe=none</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">使用者配額的屬性不會顯示在 <code class="command">zfs get all</code>。非 <code class="systemitem">root</code> 的使用者只可以看到自己的配額，除非它們有被授予 <code class="literal">userquota</code> 權限，擁有這個權限的使用者可以檢視與設定任何人的配額。</p></div><p>要設定群組配額的一般格式為：<code class="literal">groupquota@<em class="replaceable"><code>group</code></em>=<em class="replaceable"><code>size</code></em></code>。</p><p>要設定群組 <em class="replaceable"><code>firstgroup</code></em> 的配額為 50 GB 可使用：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs set groupquota@firstgroup=50G</code></strong></pre><p>要移除群組 <em class="replaceable"><code>firstgroup</code></em> 的配額，或確保該群組未設定配額可使用：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs set groupquota@firstgroup=none</code></strong></pre><p>如同使用者配額屬性，非 <code class="systemitem">root</code> 使用者只可以查看自己所屬群組的配額。而 <code class="systemitem">root</code> 或擁有 <code class="literal">groupquota</code> 權限的使用者，可以檢視並設定所有群組的任何配額。</p><p>要顯示在檔案系統或快照上每位使用者所使用的空間量及配額可使用 <code class="command">zfs userspace</code>，要取得群組的資訊則可使用 <code class="command">zfs groupspace</code>，要取得有關支援的選項資訊或如何只顯示特定選項的資訊請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=zfs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">zfs</span>(1)</span></a>。</p><p>有足夠權限的使用者及 <code class="systemitem">root</code> 可以使用以下指令列出 <code class="filename">storage/home/bob</code> 的配額：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs get quota storage/home/bob</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-reservation"></a>19.4.9. 保留空間</h3></div></div></div><p>保留空間 (<a class="link" href="#zfs-term-reservation">Reservation</a>) 可以確保資料集最少可用的空間量，其他任何資料集無法使用保留的空間，這個功能在要確保有足夠的可用空間來存放重要的資料集或日誌檔時特別有用。</p><p><code class="literal">reservation</code> 屬性的一般格式為 <code class="literal">reservation=<em class="replaceable"><code>size</code></em></code>，所以要在 <code class="filename">storage/home/bob</code> 設定保留 10 GB 的空間可以用：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs set reservation=10G storage/home/bob</code></strong></pre><p>要清除任何保留空間：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs set reservation=none storage/home/bob</code></strong></pre><p>同樣的原則可以應用在 <code class="literal">refreservation</code> 屬性來設定參考保留空間 (<a class="link" href="#zfs-term-refreservation">Reference Reservation</a>)，參考保留空間的一般格式為 <code class="literal">refreservation=<em class="replaceable"><code>size</code></em></code>。</p><p>這個指令會顯示任何已設定於 <code class="filename">storage/home/bob</code> 的 reservation 或 refreservation：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs get reservation storage/home/bob</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs get refreservation storage/home/bob</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-compression"></a>19.4.10. 壓縮 (Compression)</h3></div></div></div><p><acronym class="acronym">ZFS</acronym> 提供直接的壓縮功能，在資料區塊層級壓縮資料不僅可以節省空間，也可以增加磁碟的效能。若資料壓縮了 25%，但壓縮的資料會使用了與未壓縮版本相同的速率寫入到磁碟，所以實際的寫入速度會是原來的 125%。壓縮功能也可來替代去重複 (<a class="link" href="#zfs-zfs-deduplication" title="19.4.11. 去重複 (Deduplication)">Deduplication</a>) 功能，因為壓縮並不需要使用額外的記憶體。</p><p><acronym class="acronym">ZFS</acronym> 提了多種不同的壓縮演算法，每一種都有不同的優缺點，隨著 <acronym class="acronym">ZFS</acronym> v5000 引進了 <acronym class="acronym">LZ4</acronym> 壓縮技術，可對整個儲存池開啟壓縮，而不像其他演算法需要消耗大量的效能來達成，最大的優點是 <acronym class="acronym">LZ4</acronym> 擁有 <span class="emphasis"><em>提早放棄</em></span> 的功能，若 <acronym class="acronym">LZ4</acronym> 無法在資料一開始的部份達成至少 12.5% 的壓縮率，便會以不壓縮的方式來寫入資料區塊來避免 CPU 在那些已經壓縮過或無法壓縮的資料上浪費運算能力。要取得更多有關 <acronym class="acronym">ZFS</acronym> 中可用的壓縮演算法詳細資訊，可參考術語章節中的壓縮 (<a class="link" href="#zfs-term-compression">Compression</a>) 項目。</p><p>管理者可以使用資料集的屬性來監視壓縮的效果。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs get used,compressratio,compression,logicalused <em class="replaceable"><code>mypool/compressed_dataset</code></em></code></strong>
NAME        PROPERTY          VALUE     SOURCE
mypool/compressed_dataset  used              449G      -
mypool/compressed_dataset  compressratio     1.11x     -
mypool/compressed_dataset  compression       lz4       local
mypool/compressed_dataset  logicalused       496G      -</pre><p>資料集目前使用了 449 GB 的空間 (在 used 屬性)。在尚未壓縮前，該資料集應該會使用 496 GB 的空間 (於 <code class="literal">logicalused</code> 屬性)，這個結果顯示目前的壓縮比為 1.11:1。</p><p>壓縮功能在與使用者配額 (<a class="link" href="#zfs-term-userquota">User Quota</a>) 一併使用時可能會產生無法預期的副作用。使用者配額會限制一個使用者在一個資料集上可以使用多少空間，但衡量的依據是以 <span class="emphasis"><em>壓縮後</em></span> 所使用的空間，因此，若一個使用者有 10 GB 的配額，寫入了 10 GB 可壓縮的資料，使用者將還會有空間儲存額外的資料。若使用者在之後更新了一個檔案，例如一個資料庫，可能有更多或較少的可壓縮資料，那麼剩餘可用的空間量也會因此而改變，這可能會造成奇怪的現象便是，一個使用者雖然沒有增加實際的資料量 (於 <code class="literal">logicalused</code> 屬性)，但因為更改影響了壓縮率，導致使用者達到配額的上限。</p><p>壓縮功能在與備份功能一起使用時也可能會有類似的問題，通常會使用配額功能來限制能夠儲存的資料量來確保有足夠的備份空間可用。但是由於配額功能並不會考量壓縮狀況，可能會有比未壓縮版本備份更多的資料量會被寫入到資料集。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-deduplication"></a>19.4.11. 去重複 (Deduplication)</h3></div></div></div><p>當開啟，去重複 (<a class="link" href="#zfs-term-deduplication">Deduplication</a>) 功能會使用每個資料區塊的校驗碼 (Checksum) 來偵測重複的資料區塊，當新的資料區塊與現有的資料區塊重複，<acronym class="acronym">ZFS</acronym> 便會寫入連接到現有資料的參考來替代寫入重複的資料區塊，這在資料中有大量重複的檔案或資訊時可以節省大量的空間，要注意的是：去重複功能需要使用大量的記憶體且大部份可節省的空間可改開啟壓縮功能來達成，而壓縮功能不需要使用額外的記憶體。</p><p>要開啟去重複功能，需在目標儲存池設定 <code class="literal">dedup</code> 屬性：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs set dedup=on <em class="replaceable"><code>pool</code></em></code></strong></pre><p>只有要被寫入到儲存池的新資料才會做去重複的動作，先前已被寫入到儲存池的資料不會因此啟動了這個選項而做去重複。查看已開啟去重複屬性的儲存池會如下：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool list</code></strong>
NAME  SIZE ALLOC  FREE   CKPOINT  EXPANDSZ   FRAG   CAP   DEDUP   HEALTH   ALTROOT
pool 2.84G 2.19M 2.83G         -         -     0%    0%   1.00x   ONLINE   -</pre><p><code class="literal">DEDUP</code> 欄位會顯示儲存池的實際去重複率，數值為 <code class="literal">1.00x</code> 代表資料尚未被去重複。在下一個例子會在前面所建立的去重複儲存池中複製三份 Port 樹到不同的目錄中。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>for d in dir1 dir2 dir3; do</code></strong>
&gt; <strong class="userinput"><code>mkdir $d &amp;&amp; cp -R /usr/ports $d &amp;</code></strong>
&gt; <strong class="userinput"><code>done</code></strong></pre><p>已經偵測到重複的資料並做去重複：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zpool list</code></strong>
NAME SIZE  ALLOC  FREE   CKPOINT  EXPANDSZ   FRAG  CAP   DEDUP   HEALTH   ALTROOT
pool 2.84G 20.9M 2.82G         -         -     0%   0%   3.00x   ONLINE   -</pre><p><code class="literal">DEDUP</code> 欄位顯示有 <code class="literal">3.00x</code> 的去重複率，這代表已偵測到多份複製的 Port 樹資料並做了去重複的動作，且只會使用第三份資料所佔的空間。去重複能節省空間的潛力可以非常巨大，但會需要消耗大量的記憶體來持續追蹤去重複的資料區塊。</p><p>去重複並非總是有效益的，特別是當儲存池中的資料本身並沒有重複時。<acronym class="acronym">ZFS</acronym> 可以透過在現有儲存池上模擬開啟去重複功能來顯示可能節省的空間：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zdb -S <em class="replaceable"><code>pool</code></em></code></strong>
Simulated DDT histogram:

bucket              allocated                       referenced
______   ______________________________   ______________________________
refcnt   blocks   LSIZE   PSIZE   DSIZE   blocks   LSIZE   PSIZE   DSIZE
------   ------   -----   -----   -----   ------   -----   -----   -----
     1    2.58M    289G    264G    264G    2.58M    289G    264G    264G
     2     206K   12.6G   10.4G   10.4G     430K   26.4G   21.6G   21.6G
     4    37.6K    692M    276M    276M     170K   3.04G   1.26G   1.26G
     8    2.18K   45.2M   19.4M   19.4M    20.0K    425M    176M    176M
    16      174   2.83M   1.20M   1.20M    3.33K   48.4M   20.4M   20.4M
    32       40   2.17M    222K    222K    1.70K   97.2M   9.91M   9.91M
    64        9     56K   10.5K   10.5K      865   4.96M    948K    948K
   128        2   9.50K      2K      2K      419   2.11M    438K    438K
   256        5   61.5K     12K     12K    1.90K   23.0M   4.47M   4.47M
    1K        2      1K      1K      1K    2.98K   1.49M   1.49M   1.49M
 Total    2.82M    303G    275G    275G    3.20M    319G    287G    287G

dedup = 1.05, compress = 1.11, copies = 1.00, dedup * compress / copies = 1.16</pre><p>在 <code class="command">zdb -S</code> 分析完儲存池後會顯示在啟動去重複後可達到的空間減少比例。在本例中，<code class="literal">1.16</code> 是非常差的空間節省比例，因為這個比例使用壓縮功能便能達成。若在此儲存池上啟動去重複並不能明顯的節省空間使用量，那麼就不值得耗費大量的記憶體來開啟去重複功能。透過公式 <span class="emphasis"><em>ratio = dedup * compress / copies</em></span>，系統管理者可以規劃儲存空間的配置，來判斷要處理的資料是否有足夠的重複資料區塊來平衡所需的記憶體。若資料是可壓縮的，那麼空間節少的效果可能會非常好，建議先開啟壓縮功能，且壓縮功能也可以大大提高效能。去重複功能只有在可以節省可觀的空間且有足夠的記憶體做 <a class="link" href="#zfs-term-deduplication"><acronym class="acronym">DDT</acronym></a> 時才開啟。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-jail"></a>19.4.12. <acronym class="acronym">ZFS</acronym> 與 Jail</h3></div></div></div><p><code class="command">zfs jail</code> 以及相關的 <code class="literal">jailed</code> 屬性可以用來將一個 <acronym class="acronym">ZFS</acronym> 資料集委託給一個 <a class="link" href="#jails" title="章 14. Jail">Jail</a> 管理。<code class="command">zfs jail <em class="replaceable"><code>jailid</code></em></code> 可以將一個資料集連結到一個指定的 Jail，而 <code class="command">zfs unjail</code> 則可解除連結。資料集要可以在 Jail 中控制需設定 <code class="literal">jailed</code> 屬性，一旦資料集被隔離便無法再掛載到主機，因為有掛載點可能會破壞主機的安全性。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="zfs-zfs-allow"></a>19.5. 委託管理</h2></div></div></div><p>一個全面性的權限委託系統可能無權限的使用者執行 <acronym class="acronym">ZFS</acronym> 的管理功能。例如，若每個使用者的家目錄均為一個資料集，便可以給予使用者權限建立與摧毀它們家目錄中的快照。可以給予備份使用者使用備份功能的權限。一個使用量統計的 Script 可以允許其在執行時能存取所有使用者的空間利用率資料。甚至可以將委託權限委託給其他人，每個子指令與大多數屬性都可使用權限委託。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-allow-create"></a>19.5.1. 委託資料集建立</h3></div></div></div><p><code class="command">zfs allow <em class="replaceable"><code>someuser</code></em> create <em class="replaceable"><code>mydataset</code></em></code> 可以給予指定的使用者在指定的父資料集下建立子資料集的權限。這裡需要注意：建立新資料集會牽涉到掛載，因此需要設定 FreeBSD 的 <code class="literal">vfs.usermount</code> <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> 為 <code class="literal">1</code> 來允許非 root 的使用者掛載一個檔案系統。這裡還有另一項限制可以避免濫用：非 <code class="systemitem">root</code> 使用者必須擁有掛載點在檔案系統中所在位置的權限才可掛載。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-allow-allow"></a>19.5.2. 委託權限委託</h3></div></div></div><p><code class="command">zfs allow <em class="replaceable"><code>someuser</code></em> allow <em class="replaceable"><code>mydataset</code></em></code> 可以給予指定的使用者有權限指派它們在目標資料集或其子資料集上擁有的任何權限給其他人。若該使用者擁有 <code class="literal">snapshot</code> 權限及 <code class="literal">allow</code> 權限，則該使用者可以授權 <code class="literal">snapshot</code> 權限給其他使用者。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="zfs-advanced"></a>19.6. 進階主題</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-advanced-tuning"></a>19.6.1. 調校</h3></div></div></div><p>這裡有數個可調校的項目可以調整，來讓 <acronym class="acronym">ZFS</acronym> 在面對各種工作都能以最佳狀況運作。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a id="zfs-advanced-tuning-arc_max"></a><span class="emphasis"><em><code class="varname">vfs.zfs.arc_max</code></em></span>
	    - Maximum size of the <a class="link" href="#zfs-term-arc"><acronym class="acronym">ARC</acronym></a>.
	    The default is all <acronym class="acronym">RAM</acronym> but 1 GB,
	    or 5/8 of all <acronym class="acronym">RAM</acronym>, whichever is more.
	    However, a lower value should be used if the system will
	    be running any other daemons or processes that may require
	    memory.  This value can be adjusted at runtime with
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> and can be set in
	    <code class="filename">/boot/loader.conf</code> or
	    <code class="filename">/etc/sysctl.conf</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><a id="zfs-advanced-tuning-arc_meta_limit"></a><span class="emphasis"><em><code class="varname">vfs.zfs.arc_meta_limit</code></em></span>
	    - Limit the portion of the
	    <a class="link" href="#zfs-term-arc"><acronym class="acronym">ARC</acronym></a>
	    that can be used to store metadata.  The default is one
	    fourth of <code class="varname">vfs.zfs.arc_max</code>.  Increasing
	    this value will improve performance if the workload
	    involves operations on a large number of files and
	    directories, or frequent metadata operations, at the cost
	    of less file data fitting in the <a class="link" href="#zfs-term-arc"><acronym class="acronym">ARC</acronym></a>.
	    This value can be adjusted at runtime with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	    and can be set in
	    <code class="filename">/boot/loader.conf</code> or
	    <code class="filename">/etc/sysctl.conf</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><a id="zfs-advanced-tuning-arc_min"></a><span class="emphasis"><em><code class="varname">vfs.zfs.arc_min</code></em></span>
	    - Minimum size of the <a class="link" href="#zfs-term-arc"><acronym class="acronym">ARC</acronym></a>.
	    The default is one half of
	    <code class="varname">vfs.zfs.arc_meta_limit</code>.  Adjust this
	    value to prevent other applications from pressuring out
	    the entire <a class="link" href="#zfs-term-arc"><acronym class="acronym">ARC</acronym></a>.
	    This value can be adjusted at runtime with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	    and can be set in
	    <code class="filename">/boot/loader.conf</code> or
	    <code class="filename">/etc/sysctl.conf</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><a id="zfs-advanced-tuning-vdev-cache-size"></a><span class="emphasis"><em><code class="varname">vfs.zfs.vdev.cache.size</code></em></span>
	    - A preallocated amount of memory reserved as a cache for
	    each device in the pool.  The total amount of memory used
	    will be this value multiplied by the number of devices.
	    This value can only be adjusted at boot time, and is set
	    in <code class="filename">/boot/loader.conf</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><a id="zfs-advanced-tuning-min-auto-ashift"></a><span class="emphasis"><em><code class="varname">vfs.zfs.min_auto_ashift</code></em></span>
	    - Minimum <code class="varname">ashift</code> (sector size) that
	    will be used automatically at pool creation time.  The
	    value is a power of two.  The default value of
	    <code class="literal">9</code> represents
	    <code class="literal">2^9 = 512</code>, a sector size of 512 bytes.
	    To avoid <span class="emphasis"><em>write amplification</em></span> and get
	    the best performance, set this value to the largest sector
	    size used by a device in the pool.</p><p xml:lang="en" lang="en">Many drives have 4 KB sectors.  Using the default
	    <code class="varname">ashift</code> of <code class="literal">9</code> with
	    these drives results in write amplification on these
	    devices.  Data that could be contained in a single
	    4 KB write must instead be written in eight 512-byte
	    writes.  <acronym class="acronym">ZFS</acronym> tries to read the native
	    sector size from all devices when creating a pool, but
	    many drives with 4 KB sectors report that their
	    sectors are 512 bytes for compatibility.  Setting
	    <code class="varname">vfs.zfs.min_auto_ashift</code> to
	    <code class="literal">12</code> (<code class="literal">2^12 = 4096</code>)
	    before creating a pool forces <acronym class="acronym">ZFS</acronym> to
	    use 4 KB blocks for best performance on these
	    drives.</p><p xml:lang="en" lang="en">Forcing 4 KB blocks is also useful on pools where
	    disk upgrades are planned.  Future disks are likely to use
	    4 KB sectors, and <code class="varname">ashift</code> values
	    cannot be changed after a pool is created.</p><p xml:lang="en" lang="en">In some specific cases, the smaller 512-byte block
	    size might be preferable.  When used with 512-byte disks
	    for databases, or as storage for virtual machines, less
	    data is transferred during small random reads.  This can
	    provide better performance, especially when using a
	    smaller <acronym class="acronym">ZFS</acronym> record size.</p></li><li class="listitem"><p xml:lang="en" lang="en"><a id="zfs-advanced-tuning-prefetch_disable"></a><span class="emphasis"><em><code class="varname">vfs.zfs.prefetch_disable</code></em></span>
	    - Disable prefetch.  A value of <code class="literal">0</code> is
	    enabled and <code class="literal">1</code> is disabled.  The default
	    is <code class="literal">0</code>, unless the system has less than
	    4 GB of <acronym class="acronym">RAM</acronym>.  Prefetch works by
	    reading larger blocks than were requested into the
	    <a class="link" href="#zfs-term-arc"><acronym class="acronym">ARC</acronym></a>
	    in hopes that the data will be needed soon.  If the
	    workload has a large number of random reads, disabling
	    prefetch may actually improve performance by reducing
	    unnecessary reads.  This value can be adjusted at any time
	    with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><a id="zfs-advanced-tuning-vdev-trim_on_init"></a><span class="emphasis"><em><code class="varname">vfs.zfs.vdev.trim_on_init</code></em></span>
	    - Control whether new devices added to the pool have the
	    <code class="literal">TRIM</code> command run on them.  This ensures
	    the best performance and longevity for
	    <acronym class="acronym">SSD</acronym>s, but takes extra time.  If the
	    device has already been secure erased, disabling this
	    setting will make the addition of the new device faster.
	    This value can be adjusted at any time with
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><a id="zfs-advanced-tuning-vdev-max_pending"></a><span class="emphasis"><em><code class="varname">vfs.zfs.vdev.max_pending</code></em></span>
	    - Limit the number of pending I/O requests per device.
	    A higher value will keep the device command queue full
	    and may give higher throughput.  A lower value will reduce
	    latency.  This value can be adjusted at any time with
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><a id="zfs-advanced-tuning-top_maxinflight"></a><span class="emphasis"><em><code class="varname">vfs.zfs.top_maxinflight</code></em></span>
	    - Maxmimum number of outstanding I/Os per top-level
	    <a class="link" href="#zfs-term-vdev">vdev</a>.  Limits the
	    depth of the command queue to prevent high latency.  The
	    limit is per top-level vdev, meaning the limit applies to
	    each <a class="link" href="#zfs-term-vdev-mirror">mirror</a>,
	    <a class="link" href="#zfs-term-vdev-raidz">RAID-Z</a>, or
	    other vdev independently.  This value can be adjusted at
	    any time with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><a id="zfs-advanced-tuning-l2arc_write_max"></a><span class="emphasis"><em><code class="varname">vfs.zfs.l2arc_write_max</code></em></span>
	    - Limit the amount of data written to the <a class="link" href="#zfs-term-l2arc"><acronym class="acronym">L2ARC</acronym></a>
	    per second.  This tunable is designed to extend the
	    longevity of <acronym class="acronym">SSD</acronym>s by limiting the
	    amount of data written to the device.  This value can be
	    adjusted at any time with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><a id="zfs-advanced-tuning-l2arc_write_boost"></a><span class="emphasis"><em><code class="varname">vfs.zfs.l2arc_write_boost</code></em></span>
	    - The value of this tunable is added to <a class="link" href="#zfs-advanced-tuning-l2arc_write_max"><code class="varname">vfs.zfs.l2arc_write_max</code></a>
	    and increases the write speed to the
	    <acronym class="acronym">SSD</acronym> until the first block is evicted
	    from the <a class="link" href="#zfs-term-l2arc"><acronym class="acronym">L2ARC</acronym></a>.
	    This <span class="quote">“<span class="quote">Turbo Warmup Phase</span>”</span> is designed to
	    reduce the performance loss from an empty <a class="link" href="#zfs-term-l2arc"><acronym class="acronym">L2ARC</acronym></a>
	    after a reboot.  This value can be adjusted at any time
	    with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><a id="zfs-advanced-tuning-scrub_delay"></a><span class="emphasis"><em><code class="varname">vfs.zfs.scrub_delay</code></em></span>
	    - Number of ticks to delay between each I/O during a
	    <a class="link" href="#zfs-term-scrub"><code class="command">scrub</code></a>.
	    To ensure that a <code class="command">scrub</code> does not
	    interfere with the normal operation of the pool, if any
	    other <acronym class="acronym">I/O</acronym> is happening the
	    <code class="command">scrub</code> will delay between each command.
	    This value controls the limit on the total
	    <acronym class="acronym">IOPS</acronym> (I/Os Per Second) generated by the
	    <code class="command">scrub</code>.  The granularity of the setting
	    is determined by the value of <code class="varname">kern.hz</code>
	    which defaults to 1000 ticks per second.  This setting may
	    be changed, resulting in a different effective
	    <acronym class="acronym">IOPS</acronym> limit.  The default value is
	    <code class="literal">4</code>, resulting in a limit of:
	    1000 ticks/sec / 4 =
	    250 <acronym class="acronym">IOPS</acronym>.  Using a value of
	    <em class="replaceable"><code>20</code></em> would give a limit of:
	    1000 ticks/sec / 20 =
	    50 <acronym class="acronym">IOPS</acronym>.  The speed of
	    <code class="command">scrub</code> is only limited when there has
	    been recent activity on the pool, as determined by <a class="link" href="#zfs-advanced-tuning-scan_idle"><code class="varname">vfs.zfs.scan_idle</code></a>.
	    This value can be adjusted at any time with
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><a id="zfs-advanced-tuning-resilver_delay"></a><span class="emphasis"><em><code class="varname">vfs.zfs.resilver_delay</code></em></span>
	    - Number of milliseconds of delay inserted between
	    each I/O during a
	    <a class="link" href="#zfs-term-resilver">resilver</a>.  To
	    ensure that a resilver does not interfere with the normal
	    operation of the pool, if any other I/O is happening the
	    resilver will delay between each command.  This value
	    controls the limit of total <acronym class="acronym">IOPS</acronym> (I/Os
	    Per Second) generated by the resilver.  The granularity of
	    the setting is determined by the value of
	    <code class="varname">kern.hz</code> which defaults to 1000 ticks
	    per second.  This setting may be changed, resulting in a
	    different effective <acronym class="acronym">IOPS</acronym> limit.  The
	    default value is 2, resulting in a limit of:
	    1000 ticks/sec / 2 =
	    500 <acronym class="acronym">IOPS</acronym>.  Returning the pool to
	    an <a class="link" href="#zfs-term-online">Online</a> state may
	    be more important if another device failing could
	    <a class="link" href="#zfs-term-faulted">Fault</a> the pool,
	    causing data loss.  A value of 0 will give the resilver
	    operation the same priority as other operations, speeding
	    the healing process.  The speed of resilver is only
	    limited when there has been other recent activity on the
	    pool, as determined by <a class="link" href="#zfs-advanced-tuning-scan_idle"><code class="varname">vfs.zfs.scan_idle</code></a>.
	    This value can be adjusted at any time with
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><a id="zfs-advanced-tuning-scan_idle"></a><span class="emphasis"><em><code class="varname">vfs.zfs.scan_idle</code></em></span>
	    - Number of milliseconds since the last operation before
	    the pool is considered idle.  When the pool is idle the
	    rate limiting for <a class="link" href="#zfs-term-scrub"><code class="command">scrub</code></a>
	    and
	    <a class="link" href="#zfs-term-resilver">resilver</a> are
	    disabled.  This value can be adjusted at any time with
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><a id="zfs-advanced-tuning-txg-timeout"></a><span class="emphasis"><em><code class="varname">vfs.zfs.txg.timeout</code></em></span>
	    - Maximum number of seconds between
	    <a class="link" href="#zfs-term-txg">transaction group</a>s.
	    The current transaction group will be written to the pool
	    and a fresh transaction group started if this amount of
	    time has elapsed since the previous transaction group.  A
	    transaction group my be triggered earlier if enough data
	    is written.  The default value is 5 seconds.  A larger
	    value may improve read performance by delaying
	    asynchronous writes, but this may cause uneven performance
	    when the transaction group is written.  This value can be
	    adjusted at any time with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-advanced-i386"></a>19.6.2. i386 上的 <acronym class="acronym">ZFS</acronym></h3></div></div></div><p><acronym class="acronym">ZFS</acronym> 所提供的部份功能需要使用大量記憶體，且可能需要對有限 <acronym class="acronym">RAM</acronym> 的系統調校來取得最佳的效率。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78541624"></a>19.6.2.1. 記憶體</h4></div></div></div><p>最低需求，總系統記憶體應至少有 1 GB，建議的 <acronym class="acronym">RAM</acronym> 量需視儲存池的大小以及使用的 <acronym class="acronym">ZFS</acronym> 功能而定。一般的經驗法則是每 1 TB 的儲存空間需要 1 GB 的 RAM，若有開啟去重複的功能，一般的經驗法則是每 1 TB 的要做去重複的儲存空間需要 5 GB 的 RAM。雖然有部份使用者成功使用較少的 <acronym class="acronym">RAM</acronym> 來運作 <acronym class="acronym">ZFS</acronym>，但系統在負載較重時有可能會因為記憶用耗而導致當機，對於要使用低於建議 RAM 需求量來運作的系統可能會需要更進一步的調校。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78544312"></a>19.6.2.2. 核心設定</h4></div></div></div><p>由於在 <span class="trademark">i386</span>™ 平台上位址空間的限制，在 <span class="trademark">i386</span>™ 架構上的 <acronym class="acronym">ZFS</acronym> 使用者必須加入這個選項到自訂核心設定檔，重新編譯核心並重新開啟：</p><pre xml:lang="en" class="programlisting" lang="en">options        KVA_PAGES=512</pre><p>這個選項會增加核心位址空間，允許調整 <code class="varname">vm.kvm_size</code> 超出目前的 1 GB 限制或在 <acronym class="acronym">PAE</acronym> 的 2 GB 限制。要找到這個選項最合適的數值，可以將想要的位址空間換算成 MB 然後除以 4，在本例中，以 2 GB 計算後即為 <code class="literal">512</code>。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78548664"></a>19.6.2.3. 載入程式可調參數</h4></div></div></div><p>在所有的 FreeBSD 架構上均可增加 <code class="filename">kmem</code> 位址空間，經測試在一個 1 GB 實體記憶體的測試系統上，加入以下選項到 <code class="filename">/boot/loader.conf</code>，重新開啟系統，可成功設定：</p><pre xml:lang="en" class="programlisting" lang="en">vm.kmem_size="330M"
vm.kmem_size_max="330M"
vfs.zfs.arc_max="40M"
vfs.zfs.vdev.cache.size="5M"</pre><p>要取得更多詳細的 <acronym class="acronym">ZFS</acronym> 相關調校的建議清單，請參考 <a class="link" href="https://wiki.freebsd.org/ZFSTuningGuide" target="_top">https://wiki.freebsd.org/ZFSTuningGuide</a>。</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="zfs-links"></a>19.7. 其他資源</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="https://wiki.freebsd.org/ZFS" target="_top">FreeBSD
	    Wiki - <acronym class="acronym">ZFS</acronym></a></p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="https://wiki.freebsd.org/ZFSTuningGuide" target="_top">FreeBSD
	    Wiki - <acronym class="acronym">ZFS</acronym> Tuning</a></p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://wiki.illumos.org/display/illumos/ZFS" target="_top">Illumos
	    Wiki - <acronym class="acronym">ZFS</acronym></a></p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://docs.oracle.com/cd/E19253-01/819-5461/index.html" target="_top">Oracle
	    Solaris <acronym class="acronym">ZFS</acronym> Administration
	    Guide</a></p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="https://calomel.org/zfs_raid_speed_capacity.html" target="_top">Calomel
	    Blog - <acronym class="acronym">ZFS</acronym> Raidz Performance, Capacity
	    and Integrity</a></p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="zfs-term"></a>19.8. <acronym class="acronym">ZFS</acronym> 特色與術語</h2></div></div></div><p><acronym class="acronym">ZFS</acronym> 是一個從本質上與眾不同的檔案系統，由於它並非只是一個檔案系統，<acronym class="acronym">ZFS</acronym> 結合了檔案系統及磁碟區管理程式，讓額外的儲存裝置可以即時的加入到系統並可讓既有的檔案系統立即使用這些在儲存池中空間。透過結合傳統區分為二的兩個角色，<acronym class="acronym">ZFS</acronym> 能夠克服以往 <acronym class="acronym">RAID</acronym> 磁碟群組無法擴充的限制。每個在儲存池頂層的裝置稱作 <span class="emphasis"><em>vdev</em></span>，其可以是一個簡單的磁碟或是一個 <acronym class="acronym">RAID</acronym> 如鏡像或 <acronym class="acronym">RAID-Z</acronym> 陣列。<acronym class="acronym">ZFS</acronym> 的檔案系統 (稱作 <span class="emphasis"><em>資料集 (Dataset)</em></span>) 每一個資料集均可存取整個存池所共通的可用空間，隨著使用儲存池來配置空間區塊，儲存池能給每個檔案系統使用的可用空間就會減少，這個方法可以避免擴大分割區會使的可用空間分散分割區之間的常見問題。</p><div class="informaltable"><table width="100%" border="1"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top"><a id="zfs-term-pool"></a>儲存池 (Pool)</td><td valign="top"><span class="emphasis"><em>儲存池 (Pool)</em></span> 是建構 <acronym class="acronym">ZFS</acronym> 最基礎的單位。一個儲存池可由一個或多個 vdev 所組成，是用來儲存資料的底層裝置。儲存池會被拿來建立一個或多個檔案系統 (資料集 Dataset) 或區塊裝置 (磁碟區 Volume)，這些資料集與磁碟區會共用儲存池的剩餘可用空間。每一個儲存池可由名稱與 <acronym class="acronym">GUID</acronym> 來辨識。可用的功能會依儲存池上的 <acronym class="acronym">ZFS</acronym> 版本而有不同。</td></tr><tr><td valign="top"><a id="zfs-term-vdev"></a>vdev 型態 (vdev Types)</td><td valign="top">儲存池是由一個或多個 vdev 所組成，vdev 可以是一個磁碟或是 <acronym class="acronym">RAID</acronym> Transform 的磁碟群組。當使用多個 vdev，<acronym class="acronym">ZFS</acronym> 可以分散資料到各個 vdev 來增加效能與最大的可用空間。<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a id="zfs-term-vdev-disk"></a><span class="emphasis"><em>磁碟 (Disk)</em></span> - 最基本的 vdev 型態便是一個標準的資料區塊裝置，這可以是一整個磁碟 (例如 <code class="filename"><em class="replaceable"><code>/dev/ada0</code></em></code> 或 <code class="filename"><em class="replaceable"><code>/dev/da0</code></em></code>) 或一個分割區 (<code class="filename"><em class="replaceable"><code>/dev/ada0p3</code></em></code>)。在 FreeBSD 上，使用分割區來替代整個磁碟不會影響效能，這可能與 Solaris 說明文件所建議的有所不同。</p></li><li class="listitem"><p><a id="zfs-term-vdev-file"></a><span class="emphasis"><em>檔案 (File)</em></span> - 除了磁碟外，<acronym class="acronym">ZFS</acronym> 儲存池可以使用一般檔案為基礎，這在測試與實驗時特別有用。在 <code class="command">zpool create</code> 時使用檔案的完整路徑作為裝置路徑。所有 vdev 必須至少有 128 MB 的大小。</p></li><li class="listitem"><p><a id="zfs-term-vdev-mirror"></a><span class="emphasis"><em>鏡像 (Mirror)</em></span> - 要建立鏡像，需使用 <code class="literal">mirror</code> 關鍵字，後面接著要做為該鏡像成員裝置的清單。一個鏡像需要由兩個或多個裝置來組成，所有的資料都會被寫入到所有的成員裝置。鏡像 vdev 可以對抗所有成員故障只剩其中一個而不損失任何資料。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">正常單一磁碟的 vdev 可以使用 <code class="command">zpool <a class="link" href="#zfs-zpool-attach" title="19.3.2. 加入與移除裝置">attach</a></code> 隨時升級成為鏡像 vdev。</p></div></li><li class="listitem"><p><a id="zfs-term-vdev-raidz"></a><span class="emphasis"><em><acronym class="acronym">RAID-Z</acronym></em></span> - <acronym class="acronym">ZFS</acronym> 實作了 <acronym class="acronym">RAID-Z</acronym>，以標準的 <acronym class="acronym">RAID-5</acronym> 修改而來，可提供奇偶校驗 (Parity) 更佳的分散性並去除了 <span class="quote">“<span class="quote"><acronym class="acronym">RAID-5</acronym> write hole</span>”</span> 導致在預期之外的重啟後資料與奇偶校驗資訊不一致的問題。<acronym class="acronym">ZFS</acronym> 支援三個層級的 <acronym class="acronym">RAID-Z</acronym>，可提供不同程度的備援來換取減少不同程度的可用空間，類型的名稱以陣列中奇偶校驗裝置的數量與儲存池可以容許磁碟故障的數量來命名，從 <acronym class="acronym">RAID-Z1</acronym> 到 <acronym class="acronym">RAID-Z3</acronym> 。</p><p>在 <acronym class="acronym">RAID-Z1</acronym> 配置 4 個磁碟，每個磁碟 1 TB，可用的儲存空間則為 3 TB，且若其中一個磁碟故障仍可以降級 (Degraded) 的模式運作，若在故障磁碟尚未更換並修復 (Resilver) 之前又有磁碟故障，所有在儲存池中的資料便會遺失。</p><p>在 <acronym class="acronym">RAID-Z3</acronym> 配置 8 個 1 TB 的磁碟，磁碟區將會可以提供 5 TB 的可用空間且在 3 個磁碟故障的情況下仍可運作。<span class="trademark">Sun</span>™ 建議單一個 vdev 不要使用超過 9 個磁碟。若配置需要使用更多磁碟，建議分成兩個 vdev，這樣儲存池的資料便會分散到這兩個 vdev。</p><p>使用兩個 <acronym class="acronym">RAID-Z2</acronym> 各由 8 個磁碟組成的 vdev 的配置可以建立一個類似 <acronym class="acronym">RAID-60</acronym> 的陣列。<acronym class="acronym">RAID-Z</acronym> 群組的儲存空量會接近其中最小的磁碟乘上非奇偶校驗磁碟的數量。4 個 1 TB 磁碟在 <acronym class="acronym">RAID-Z1</acronym> 會有接近 3 TB 的實際大小，且一個由 8 個 1 TB 磁碟組成的 <acronym class="acronym">RAID-Z3</acronym> 陣列會有 5 TB 的可用空間。</p></li><li class="listitem"><p><a id="zfs-term-vdev-spare"></a><span class="emphasis"><em>備援 (Spare)</em></span> - <acronym class="acronym">ZFS</acronym> 有特殊的虛擬 vdev 型態可用來持續追蹤可用的熱備援裝置 (Hot spare)。注意，安裝的熱備援裝置並不會自動佈署，熱備援裝置需要手動使用 <code class="command">zfs replace</code> 設定替換故障的裝置。</p></li><li class="listitem"><p><a id="zfs-term-vdev-log"></a><span class="emphasis"><em>日誌 (Log)</em></span> - <acronym class="acronym">ZFS</acronym> 記錄裝置，也被稱作 <acronym class="acronym">ZFS</acronym> 意圖日誌 (ZFS Intent Log, <a class="link" href="#zfs-term-zil"><acronym class="acronym">ZIL</acronym></a>) 會從正常的儲存池裝置移動意圖日誌到獨立的裝置上，通常是一個 <acronym class="acronym">SSD</acronym>。有了獨立的日誌裝置，可以明顯的增進有大量同步寫入應用程式的效能，特別是資料庫。日誌裝置可以做成鏡像，但不支援 <acronym class="acronym">RAID-Z</acronym>，若使用多個日誌裝置，寫入動作會被負載平衡分散到這些裝置。</p></li><li class="listitem"><p><a id="zfs-term-vdev-cache"></a><span class="emphasis"><em>快取 (Cache)</em></span> - 加入快取 vdev 到儲存池可以增加儲存空間的 <a class="link" href="#zfs-term-l2arc"><acronym class="acronym">L2ARC</acronym></a> 快取。快取裝置無法做鏡像，因快取裝置只會儲存額外的現有資料的複本，並沒有資料遺失的風險。</p></li></ul></div></td></tr><tr><td valign="top"><a id="zfs-term-txg"></a>交易群組 (Transaction Group, <acronym class="acronym">TXG</acronym>)</td><td valign="top">交易群組是一種將更動的資料區塊包裝成一組的方式，最後再一次寫入到儲存池。交易群組是 <acronym class="acronym">ZFS</acronym> 用來檢驗一致性的基本單位。每個交易群組會被分配一個獨一無二的 64-bit 連續代號。最多一次可以有三個活動中的交易群組，這三個交易群組的每一個都有這三種狀態：<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>開放 (Open)</em></span> - 新的交易群組建立之後便處於開放的狀態，可以接受新的寫入動作。永遠會有開放狀態的交易群組，即始交易群組可能會因到達上限而拒絕新的寫入動作。一但開放的交易群組到達上限或到達 <a class="link" href="#zfs-advanced-tuning-txg-timeout"><code class="varname">vfs.zfs.txg.timeout</code></a>，交易群組便會繼續進入下一個狀態。</p></li><li class="listitem"><p><span class="emphasis"><em>靜置中 (Quiescing)</em></span> - 一個短暫的狀態，會等候任何未完成的操作完成，不會阻擋新開放的交易群組建立。一旦所有在群組中的交易完成，交易群組便會進入到最終狀態。</p></li><li class="listitem"><p><span class="emphasis"><em>同步中 (Syncing)</em></span> - 所有在交易群組中的資料會被寫任到穩定的儲存空間，這個程序會依序修改其他也需同樣寫入到穩定儲存空間的資料，如 Metadata 與空間對應表。同步的程多會牽涉多個循環，首先是同步所有更改的資料區塊，也是最大的部份，接著是 Metadata，這可能會需要多個循環來完成。由於要配置空間供資料區塊使用會產生新的 Metadata，同步中狀態在到達循環完成而不再需要分配任何額外空間的狀態前無法結束。同步中狀態也是完成 <span class="emphasis"><em>synctask</em></span> 的地方，Synctask 是指管理操作，如：建立或摧毀快照與資料集，會修改 uberblock，也會在此時完成。同步狀態完成後，其他處於狀態中狀態的交易群組便會進入同步中狀態。</p></li></ul></div> 所有管理功能如快照 (<a class="link" href="#zfs-term-snapshot"><code class="command">Snapshot</code></a>) 會作為交易群組的一部份寫入。當 synctask 建立之後，便會加入到目前開放的交易群組中，然後該群組會盡快的進入同步中狀態來減少管理指令的延遲。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><a id="zfs-term-arc"></a>Adaptive Replacement
	      Cache (<acronym class="acronym">ARC</acronym>)</td><td valign="top"><acronym class="acronym">ZFS</acronym> 使用了自適應替換快取 (Adaptive Replacement Cache, <acronym class="acronym">ARC</acronym>)，而不是傳統的最近最少使用 (Least Recently Used, <acronym class="acronym">LRU</acronym>) 快取，LRU 快取在快取中是一個簡單的項目清單，會依每個物件最近使用的時間來排序，新項會加入到清單的最上方，當快取額滿了便會去除清單最下方的項目來空出空間給較常使用的物件。<acronym class="acronym">ARC</acronym> 結合了四種快取清單，最近最常使用 (Most Recently Used, <acronym class="acronym">MRU</acronym>) 及最常使用 (Most Frequently Used, <acronym class="acronym">MFU</acronym>) 物件加上兩個清單各自的幽靈清單 (Ghost list)，這些幽靈清單會追蹤最近被去除的物件來避免又被加回到快取，避免過去只有偶爾被使用的物件加入清單可以增加快取的命中率。同時使用 <acronym class="acronym">MRU</acronym> 及 <acronym class="acronym">MFU</acronym> 的另外一個優點是掃描一個完整檔案系統可以去除在 <acronym class="acronym">MRU</acronym> 或 <acronym class="acronym">LRU</acronym> 快取中的所有資料，有利於這些才剛存取的內容。使用 <acronym class="acronym">ZFS</acronym> 也有 <acronym class="acronym">MFU</acronym> 可只追蹤最常使用的物件並保留最常被存取的資料區塊快取。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><a id="zfs-term-l2arc"></a><acronym class="acronym">L2ARC</acronym></td><td valign="top"><acronym class="acronym">L2ARC</acronym> 是  <acronym class="acronym">ZFS</acronym> 快取系統的第二層，主要的 <acronym class="acronym">ARC</acronym> 會儲存在 <acronym class="acronym">RAM</acronym> 當中，但因為 <acronym class="acronym">RAM</acronym> 可用的空間量通常有限，因此 <acronym class="acronym">ZFS</acronym> 也可以使用 <a class="link" href="#zfs-term-vdev-cache">快取 vdev (Cache vdev)</a>。固態磁碟 (Solid State Disk, <acronym class="acronym">SSD</acronym>) 常被拿來此處作為快取裝置，因為比起傳統旋轉碟片的磁碟，固態磁碟有較快的速度與較低的延遲。<acronym class="acronym">L2ARC</acronym> 是選用的，但使用可以明顯增進那些已使用 <acronym class="acronym">SSD</acronym> 快取的檔案讀取速度，無須從一般磁碟讀取。<acronym class="acronym">L2ARC</acronym> 也同樣可以加速去重複 (<a class="link" href="#zfs-term-deduplication">Deduplication</a>)，因為 <acronym class="acronym">DDT</acronym> 並不適合放在 <acronym class="acronym">RAM</acronym>，但適合放在 <acronym class="acronym">L2ARC</acronym>，比起要從磁碟讀取，可以加快不少速度。為了避免  <acronym class="acronym">SSD</acronym> 因寫入次速過多而過早耗損，加入到快取裝置的資料速率會被限制，直到快取用盡 (去除第一個資料區塊來騰出空間) 之前，寫入到 <acronym class="acronym">L2ARC</acronym> 的資料速率會限制在寫入限制 (Write limit) 與加速限制 (Boost limit) 的總合，之後則會限制為寫入限制，可以控制這兩個速度限制的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> 數值分別為 <a class="link" href="#zfs-advanced-tuning-l2arc_write_max"><code class="varname">vfs.zfs.l2arc_write_max</code></a> 控制每秒有多少數位元組可寫入到快取，而 <a class="link" href="#zfs-advanced-tuning-l2arc_write_boost"><code class="varname">vfs.zfs.l2arc_write_boost</code></a> 可在 <span class="quote">“<span class="quote">渦輪預熱階段</span>”</span> (即寫入加速) 時增加寫入限制。</td></tr><tr><td xml:lang="en" valign="top" lang="en"><a id="zfs-term-zil"></a><acronym class="acronym">ZIL</acronym></td><td valign="top"><acronym class="acronym">ZIL</acronym> 會使用比主要儲存池還更快的儲存裝置來加速同步寫入動作 (Synchronous transaction)，如 <acronym class="acronym">SSD</acronym>。當應用程式請求做一個同步的寫入時 (保証資料會安全的儲存到磁碟，而不是先快取稍後再寫入)，資料會先寫入到速度較快的 <acronym class="acronym">ZIL</acronym> 儲存空間，之後再一併寫入到一般的磁碟。這可大量的減少延遲並增進效能。<acronym class="acronym">ZIL</acronym> 只會有利於使用像資料庫這類的同步工作，一般非同步的寫入像複製檔案，則完全不會用到 <acronym class="acronym">ZIL</acronym>。</td></tr><tr><td valign="top"><a id="zfs-term-cow"></a>寫入時複製 (Copy-On-Write)</td><td valign="top">不像傳統的檔案系統，在 <acronym class="acronym">ZFS</acronym>，當資料要被覆寫時，不會直接覆寫舊資料所在的位置，而是將新資料會寫入到另一個資料區塊，只在資料寫入完成後才會更新 Metadata 指向新的位置。因此，在發生寫入中斷 (在寫入檔案的過程中系統當機或電源中斷) 時，原來檔案的完整內容並不會遺失，只會放棄未寫入完成的新資料，這也意謂著 <acronym class="acronym">ZFS</acronym> 在發生預期之外的關機後不需要做 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a>。</td></tr><tr><td valign="top"><a id="zfs-term-dataset"></a>資料集 (Dataset)</td><td valign="top"><span class="emphasis"><em>資料集 (Dataset)</em></span> 是 <acronym class="acronym">ZFS</acronym> 檔案系統、磁碟區、快照或複本的通用術語。每個資料集都有獨一無二的名稱使用 <em class="replaceable"><code>poolname/path@snapshot</code></em> 格式。儲存池的根部技術上來說也算一個資料集，子資料集會採用像目錄一樣的層級來命名，例如 <em class="replaceable"><code>mypool/home</code></em>，home 資料集是 <em class="replaceable"><code>mypool</code></em> 的子資料集並且會繼承其屬性。這可以在往後繼續擴展成 <em class="replaceable"><code>mypool/home/user</code></em>，這個孫資料集會繼承其父及祖父的屬性。在子資料集的屬性可以覆蓋預設繼承自父及祖父的屬性。資料集及其子資料級的管理權限可以委託 (<a class="link" href="#zfs-zfs-allow" title="19.5. 委託管理">Delegate</a>) 給他人。</td></tr><tr><td valign="top"><a id="zfs-term-filesystem"></a>檔案系統 (File system)</td><td valign="top"><acronym class="acronym">ZFS</acronym> 資料集最常被當做檔案系統使用。如同大多數其他的檔案系統，<acronym class="acronym">ZFS</acronym> 檔案系統會被掛載在系統目錄層級的某一處且內含各自擁有權限、旗標及 Metadata 的檔案與目錄。</td></tr><tr><td valign="top"><a id="zfs-term-volume"></a>磁碟區 (Volume)</td><td valign="top">除了一般的檔案系統資料集之外，<acronym class="acronym">ZFS</acronym> 也可以建立磁碟區 (Volume)，磁碟區是資料區塊裝置。磁碟區有許多與資料集相似的功能，包含複製時寫入、快照、複本以及資料校驗。要在 <acronym class="acronym">ZFS</acronym> 的頂層執行其他檔案系統格式時使用磁碟區非常有用，例如 <acronym class="acronym">UFS</acronym> 虛擬化或匯出 <acronym class="acronym">iSCSI</acronym> 延伸磁區 (Extent)。</td></tr><tr><td valign="top"><a id="zfs-term-snapshot"></a>快照 (Snapshot)</td><td valign="top"><acronym class="acronym">ZFS</acronym> 的寫入時複製 (<a class="link" href="#zfs-term-cow">Copy-On-Write</a>, <acronym class="acronym">COW</acronym>) 設計可以使用任意的名稱做到幾乎即時、一致的快照。在製做資料集的快照或父資料集遞迴快照 (會包含其所有子資料集) 之後，新的資料會寫入到資的資料區塊，但不會回收舊的資料區塊為可用空間，快照中會使用原版本的檔案系統，而快照之後所做的變更則會儲存在目前的檔案系統，因此不會重複使用額外的空間。當新的資料寫入到目前的檔案系統，便會配置新的資料區塊來儲存這些資料。快照表面大小 (Apparent size) 會隨著在目前檔案系統停止使用的資料區塊而成長，但僅限於快照。可以用唯讀的方式掛載這些快照來復原先前版本的檔案，也可以還原 (<a class="link" href="#zfs-zfs-snapshot" title="19.4.5. 管理快照 (Snapshot)">Rollback</a>) 目前的檔案系統到指定的快照，來還原任何在快照之後所做的變更。每個在儲存池中的資料區塊都會有一個參考記數器，可以用來持續追蹤有多少快照、複本、資料集或是磁碟區使用這個資料區塊，當刪除檔案與快照參照的計數變會滅少，直到沒有任何東西參考這個資料區塊才會被回收為可用空間。快照也可使用 <a class="link" href="#zfs-zfs-snapshot" title="19.4.5. 管理快照 (Snapshot)">hold</a> 來標記，檔標記為 hold 時，任何嘗試要刪除該快照的動作便會回傳 <code class="literal">EBUSY</code> 的錯誤，每個快照可以標記多個不同唯一名稱的 hold，而 <a class="link" href="#zfs-zfs-snapshot" title="19.4.5. 管理快照 (Snapshot)">release</a> 指令則可以移除 hold，這樣才可刪除快照。在磁碟區上快可以製作快照，但只能用來複製或還原，無法獨立掛載。</td></tr><tr><td valign="top"><a id="zfs-term-clone"></a>複本 (Clone)</td><td valign="top">快照也可以做複本，複本是可寫入版本的快照，讓檔案系統可分支成為新的資料集。如同快照，複本一開始不會消耗任何額外空間，隨著新資料寫入到複本會配置新的資料區塊，複本的表面大小 (Apparent size) 才會成長，當在複本檔案系統或磁碟區的資料區塊被覆寫時，在先前資料區塊的參考計數則會減少。建立複本所使用的快照無法被刪除，因為複本會相依該快照，快照為父，複本為子。複本可以被提升 (<span class="emphasis"><em>promoted</em></span>)、反轉相依關係，來讓複本成為父，之前的父變為子，這個操作不需要額外的空間。由於反轉了父與子使用的空間量，所以可能會影響既有的配額 (Quota) 與保留空間 (Reservation)。</td></tr><tr><td valign="top"><a id="zfs-term-checksum"></a>校驗碼 (Checksum)</td><td valign="top">配置每個資料區塊快的同時也會做資料校驗，資料校驗用的演算法是依資料集屬性而有所不同的，請參考 <a class="link" href="#zfs-zfs-set" title="19.4.4. 設定資料集屬性"><code class="command">set</code></a>。每個資料區塊會在讀取的過成便完成校驗，讓 <acronym class="acronym">ZFS</acronym> 可以偵測到隱藏的損壞，若資料不符合預期的校驗碼，<acronym class="acronym">ZFS</acronym> 會嘗試從任何可用的備援來還原資料，例如鏡像 (Mirror) 或 <acronym class="acronym">RAID-Z</acronym>。要檢驗所有資料的校驗碼可以使用清潔 (<a class="link" href="#zfs-term-scrub"><code class="command">Scrub</code></a>)，資料校驗的演算法有：<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">fletcher2</code></p></li><li class="listitem"><p><code class="literal">fletcher4</code></p></li><li class="listitem"><p><code class="literal">sha256</code></p></li></ul></div> <code class="literal">fletcher</code> 演算法最快，而 <code class="literal">sha256</code> 雖較消耗效能，但其有強大的密碼雜湊與較低的衝突率。也可關閉資料校驗，但並不建議。</td></tr><tr><td valign="top"><a id="zfs-term-compression"></a>壓縮 (Compression)</td><td valign="top">每個資料集都有壓縮 (Compression) 屬性，預設是關閉的，這個屬性可以設定使用以下幾個壓縮演算法的其中一個來壓縮寫入到資料集的新資料。壓縮除了減少空間使用量外，常也會增加讀取與寫入的吞吐量，因為會減少讀取與寫入的資料區塊。 <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a id="zfs-term-compression-lz4"></a><span class="emphasis"><em><acronym class="acronym">LZ4</acronym></em></span> - <acronym class="acronym">ZFS</acronym> 儲存池版本 5000 (功能旗標) 後所增加，<acronym class="acronym">LZ4</acronym> 現在是建議的壓縮演算法，在處理可壓縮的資料時 <acronym class="acronym">LZ4</acronym> 壓縮比 <acronym class="acronym">LZJB</acronym> 快將近 50%，在處理不可壓縮的資料時快將近三倍，<acronym class="acronym">LZ4</acronym> 解壓縮也比 <acronym class="acronym">LZJB</acronym> 將近 80%。在現代的 <acronym class="acronym">CPU</acronym> 上，<acronym class="acronym">LZ4</acronym> 經常平均可用 500 MB/s 的速度壓縮，而解壓縮可到達 1.5 GB/s (每個 CPU 核心)。</p></li><li class="listitem"><p><a id="zfs-term-compression-lzjb"></a><span class="emphasis"><em><acronym class="acronym">LZJB</acronym></em></span> - 預設的壓縮演算法。由 Jeff Bonwick 所開發 (<acronym class="acronym">ZFS</acronym> 的創始人之一)。<acronym class="acronym">LZJB</acronym> 與 <acronym class="acronym">GZIP</acronym> 相比，可以較低的 <acronym class="acronym">CPU</acronym> 提供較佳的壓縮功能。在未來預設的壓縮演算法將會更換為 <acronym class="acronym">LZ4</acronym>。</p></li><li class="listitem"><p><a id="zfs-term-compression-gzip"></a><span class="emphasis"><em><acronym class="acronym">GZIP</acronym></em></span> - 在 <acronym class="acronym">ZFS</acronym> 可用的熱門串流壓縮演算法。使用 <acronym class="acronym">GZIP</acronym> 主要的優點之一便是可設定壓縮層級。當設定 <code class="literal">compress</code> 屬性，管理者可以選擇壓縮層級範圍從最低的壓縮層級 <code class="literal">gzip1</code> 到最高的壓縮層級 <code class="literal">gzip9</code>。這讓管理者可以控制要使用多少 <acronym class="acronym">CPU</acronym> 來節省磁碟空間。</p></li><li class="listitem"><p><a id="zfs-term-compression-zle"></a><span class="emphasis"><em><acronym class="acronym">ZLE</acronym></em></span> - 零長度編號是一個特殊的壓縮演算法，它只會壓縮連續的零。這種壓縮演算法只在資料集中含有大量為零的資料區塊時有用。</p></li></ul></div></td></tr><tr><td valign="top"><a id="zfs-term-copies"></a>備份數 (Copies)</td><td valign="top">當設定大於 1 的數值時，<code class="literal">copies</code> 屬性會指示 <acronym class="acronym">ZFS</acronym> 備份每個在檔案系統 (<a class="link" href="#zfs-term-filesystem">File System</a>) 或磁碟區 (<a class="link" href="#zfs-term-volume">Volume</a>) 的資料區塊數份。在重要的資料集上設定這個屬性可以做額外的備援以在資料校驗碼不相符時可做復原。在沒有做備援的儲存池上，備份功能提供只是一種資料的備援方式，備份功能可以復原單一壞軌或其他情況的次要損壞，但無法復原儲存池中整個磁碟損壞所損失的資料。</td></tr><tr><td valign="top"><a id="zfs-term-deduplication"></a>去重複 (Deduplication)</td><td valign="top">校驗碼讓在寫入時可以偵測重複資料區塊，使用去重複，可以增加既有、完全相同的資料區塊參考數來節省儲存空間。要偵測重複的資料區塊需要在記憶體中儲存去重複資料表 (Deduplication table, <acronym class="acronym">DDT</acronym>)，這個資料表中會有唯一的校驗碼清單、這些資料區塊的所在位置以及參考數。當寫入新資料時，便會計算校驗碼然後比對清單中是否有符合的既有資料區塊已在清單。去重複使用了 <acronym class="acronym">SHA256</acronym> 校驗碼演算法來提供一個安全的加密雜湊，去重複功能是可以調校的，若 <code class="literal">dedup</code> 設為 <code class="literal">on</code> 只要符合校驗碼便會認為資料完全相同，若 <code class="literal">dedup</code> 設為 <code class="literal">verify</code> 則會一個一個位元檢查兩個資料區塊的資料來確保資料真的完全相同，若資料不同便會註記與雜湊衝突並會分別儲存兩個資料區塊。由於 <acronym class="acronym">DDT</acronym> 須要儲存每個唯一資料區塊的雜湊，所以會消耗大量的記憶體，一般的經驗法則是每 1 TB 的去重複資料需要使用 5-6 GB 的記憶體。由於要有足夠的 <acronym class="acronym">RAM</acronym> 來儲存整個 <acronym class="acronym">DDT</acronym> 在實務上並不實際，導致在每個新資料區塊寫入前需要從磁碟來讀取 <acronym class="acronym">DDT</acronym> 會對效能有很大的影響，去重複功能可以使用 <acronym class="acronym">L2ARC</acronym> 儲存 <acronym class="acronym">DDT</acronym> 以在快速的系統記憶體及較慢的磁碟之間取得一個平衡點。也可以考慮使用壓縮功能來取代此功能，因為壓縮也能節省相近的空間使用量而不需要大量額外的記憶體。</td></tr><tr><td valign="top"><a id="zfs-term-scrub"></a>清潔 (Scrub)</td><td valign="top"><acronym class="acronym">ZFS</acronym>  有 <code class="command">scrub</code> 來替代 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a> 來做一致性的檢查。<code class="command">scrub</code> 會讀取所有儲存在儲存池中的資料區塊並且根據儲存在 Metadata 中已知良好的校驗碼來檢驗這些資料區塊的校驗碼，定期檢查儲存池中儲存的所有資料可以確保實際使用這些資料前已將所有損壞的資料區塊復原。在不正常的關閉之後並不需要做清潔動作，但建議每三個月至少執行一次。在正常使用讀取時便會檢查每個資料區塊的校驗碼，但清潔動作可以確保那些不常用的資料也會被檢查以避免隱藏的損壞，如此便能增進資料的安全性，特別是對用來保存資料的儲存裝置。<code class="command">scrub</code> 可以使用 <a class="link" href="#zfs-advanced-tuning-scrub_delay"><code class="varname">vfs.zfs.scrub_delay</code></a> 調整相對優先權來避免清潔動作降低儲存池上其他工作的效率。</td></tr><tr><td valign="top"><a id="zfs-term-quota"></a>資料集配額 (Dataset Quota)</td><td valign="top">除了配額及空間保留外，<acronym class="acronym">ZFS</acronym> 提供非常快速且準確的資料集、使用者及群組空間的計算功能，這可讓管理者調整空間配置的方式且可為重要的檔案系統保留空間。 <p><acronym class="acronym">ZFS</acronym> supports different types of
		quotas: the dataset quota, the <a class="link" href="#zfs-term-refquota">reference
		  quota (<acronym class="acronym">refquota</acronym>)</a>, the
		<a class="link" href="#zfs-term-userquota">user
		  quota</a>, and the
		<a class="link" href="#zfs-term-groupquota">group
		  quota</a>.</p> <p>配額會限制資料集及後裔包含資料集的快照、子資料集及子資料集的快照能使用的空間量。</p> <div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">磁碟區上無法設定配額，因為 <code class="literal">volsize</code> 屬性已經被用來做內定的配額。</p></div></td></tr><tr><td valign="top"><a id="zfs-term-refquota"></a>參考配額 (Reference Quota)</td><td valign="top">參考配額可以設定一個硬性限制 (Hard limit) 來限制資料集能使用的空間量，而這個硬性限制只包含了資料集參考的空間，並不含其後裔所使用的空間，如：檔案系統或快照。</td></tr><tr><td valign="top"><a id="zfs-term-userquota"></a>使用者配額 (User Quota)</td><td valign="top">使用者配額在用來限制特定使用者能使用的空間量時非常有用。</td></tr><tr><td valign="top"><a id="zfs-term-groupquota"></a>群組配額 (Group Quota)</td><td valign="top">群組配額可以限制特定群組能使用的空間量。</td></tr><tr><td valign="top"><a id="zfs-term-reservation"></a>資料集保留空間 (Dataset Reservation)</td><td valign="top"><code class="literal">reservation</code> 屬性可以確保對特定資料集及其後裔最小可用的空間量，若在 <code class="filename">storage/home/bob</code> 設定 10 GB 的保留空間且其他資料集嘗試使用所有剩餘的空間時，會保留至少 10 GB 的空間供這個資料集使用。若要製作 <code class="filename">storage/home/bob</code> 的快照，該快照所使用的空間也會被列入保留空間計算。 <a class="link" href="#zfs-term-refreservation"><code class="literal">refreservation</code></a> 屬性也以類似的方式運作，但是他 <span class="emphasis"><em>不包含</em></span> 後裔，例如：快照。 <p>不管那一種保留空間在許多情境皆很有用，例如：要規劃與測試磁碟空間配置在新系統上的適應性，或是確保有足夠的空間供稽查日誌或系統還原程序及檔案使用。</p></td></tr><tr><td valign="top"><a id="zfs-term-refreservation"></a>參考保留空間 (Reference Reservation)</td><td valign="top"><code class="literal">refreservation</code> 屬性可以確保對特定資料集 <span class="emphasis"><em>不包含</em></span> 其後裔最小可用的空間，這代表若在 <code class="filename">storage/home/bob</code> 設定 10 GB 的保留空間且其他資料集嘗試使用所有剩餘的空間時，會保留至少 10 GB 的空間供這個資料集使用。於正常 <a class="link" href="#zfs-term-reservation">reservation</a> 不同的是，由快照及後裔資料集所使用的空間並不會列入保留空間計算。例如，若要製作一個 <code class="filename">storage/home/bob</code> 的快照，在 <code class="literal">refreservation</code> 空間之外必須要有足夠的空間才能成功完成這項操作，主資料集的後裔並不會列入 <code class="literal">refreservation</code> 空間額計算，所以也不會佔用保留空間。</td></tr><tr><td valign="top"><a id="zfs-term-resilver"></a>修復 (Resilver)</td><td valign="top">當有磁碟故障且被更換後，新的磁碟必須回存先前所遺失的資料，會使用分散在其他磁碟上的奇偶校驗資訊來計算並寫入遺失的資料到新的磁碟機的這個程序稱作 <span class="emphasis"><em>修復 (Resilvering)</em></span>。</td></tr><tr><td valign="top"><a id="zfs-term-online"></a>上線 (Online)</td><td valign="top">一個儲存池或 vdev 處於線上 (<code class="literal">Online</code>) 狀態時代表所有該裝置的成員均已連結且正常運作。個別裝置處於線上 (<code class="literal">Online</code>) 狀態時代表功能正常。</td></tr><tr><td valign="top"><a id="zfs-term-offline"></a>離線 (Offline)</td><td valign="top">若有足夠的備援可避免儲存池或 vdev  進入故障 (<a class="link" href="#zfs-term-faulted">Faulted</a>) 狀態，個別裝置若可由管理者設為離線 (<code class="literal">Offline</code>) 狀態，管理者可以選擇要設定那一個磁碟為離線來準備更換或是讓其更容易辨識。</td></tr><tr><td valign="top"><a id="zfs-term-degraded"></a>降級 (Degraded)</td><td valign="top">一個儲存池或 vdev 處於降級 (<code class="literal">Degraded</code>) 狀態代表其有一個或多個磁碟已斷線或故障，此時儲存池仍可以使用，但只要再有其他的裝置故障，儲存池會無法復原。重新連線缺少的裝置或更換故障的磁碟，並在新裝置完成修復 (<a class="link" href="#zfs-term-resilver">Resilver</a>) 程序可讓儲存池返回線上 (<a class="link" href="#zfs-term-online">Online</a>) 狀態。</td></tr><tr><td valign="top"><a id="zfs-term-faulted"></a>故障 (Faulted)</td><td valign="top">一個儲存池或 vdev 處於故障 (<code class="literal">Faulted</code>) 狀態代表無法運作，會無法存取在該裝置上的資料。當在 vdev 中缺少或故障的裝置數超過備援的層級，儲存池或 vdev 會進入故障 (<code class="literal">Faulted</code>) 狀態。若缺少的裝置可以重新連結上，儲存池便會返回線上 (<a class="link" href="#zfs-term-online">Online</a>) 狀態。若沒有足夠的備援可補償故障的磁碟數量便會遺失儲存池中的內容且只能從備份還原。</td></tr></tbody></table></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="filesystems"></a>章 20. 其他檔案系統</h2></div><div><span class="authorgroup">Written
	by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#filesystems-synopsis">20.1. 概述</a></span></dt><dt><span class="sect1"><a href="#filesystems-linux">20.2. <span class="trademark">Linux</span>® 檔案系統</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp78880440">20.2.1. <acronym class="acronym">ext2</acronym></a></span></dt></dl></dd></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="filesystems-synopsis"></a>20.1. 概述</h2></div></div></div><a id="idp78856888" class="indexterm"></a><a id="idp78857528" class="indexterm"></a><p xml:lang="en" lang="en">File systems are an integral part of any operating system.
      They allow users to upload and store files, provide access to
      data, and make hard drives useful.  Different operating systems
      differ in their native file system.  Traditionally, the native
      FreeBSD file system has been the Unix File System
      <acronym class="acronym">UFS</acronym> which has been modernized as
      <acronym class="acronym">UFS2</acronym>.  Since FreeBSD 7.0, the Z File System
      (<acronym class="acronym">ZFS</acronym>) is also available as a native file
      system.  See <a class="xref" href="#zfs" title="章 19. Z 檔案系統 (ZFS)">章 19, <em>Z 檔案系統 (<acronym class="acronym">ZFS</acronym>)</em></a> for more information.</p><p xml:lang="en" lang="en">In addition to its native file systems, FreeBSD supports a
      multitude of other file systems so that data from other
      operating systems can be accessed locally, such as data stored
      on locally attached <acronym class="acronym">USB</acronym> storage devices,
      flash drives, and hard disks.  This includes support for the
      <span class="trademark">Linux</span>® Extended File System (<acronym class="acronym">EXT</acronym>).</p><p xml:lang="en" lang="en">There are different levels of FreeBSD support for the various
      file systems.  Some require a kernel module to be loaded and
      others may require a toolset to be installed.  Some non-native
      file system support is full read-write while others are
      read-only.</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">The difference between native and supported file
	  systems.</p></li><li class="listitem"><p xml:lang="en" lang="en">Which file systems are supported by FreeBSD.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to enable, configure, access, and make use of
	  non-native file systems.</p></li></ul></div><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Understand <span class="trademark">UNIX</span>® and
	  <a class="link" href="#basics" title="章 3. FreeBSD 基礎">FreeBSD basics</a>.</p></li><li class="listitem"><p xml:lang="en" lang="en">Be familiar with the basics of <a class="link" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">kernel configuration and
	    compilation</a>.</p></li><li class="listitem"><p xml:lang="en" lang="en">Feel comfortable <a class="link" href="#ports" title="章 4. 安裝應用程式：套件與 Port">installing
	    software</a> in FreeBSD.</p></li><li class="listitem"><p xml:lang="en" lang="en">Have some familiarity with <a class="link" href="#disks" title="章 17. 儲存設備">disks</a>, storage, and device names in
	  FreeBSD.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="filesystems-linux"></a>20.2. <span class="trademark">Linux</span>® 檔案系統</h2></div></div></div><p xml:lang="en" lang="en">FreeBSD provides built-in support for several <span class="trademark">Linux</span>® file
      systems.  This section demonstrates how to load support for and
      how to mount the supported <span class="trademark">Linux</span>® file systems.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78880440"></a>20.2.1. <acronym class="acronym">ext2</acronym></h3></div></div></div><p xml:lang="en" lang="en">Kernel support for ext2 file systems has
	been available since FreeBSD 2.2.  In FreeBSD 8.x and
	earlier, the code is licensed under the
	<acronym class="acronym">GPL</acronym>.  Since FreeBSD 9.0, the code has
	been rewritten and is now <acronym class="acronym">BSD</acronym>
	licensed.</p><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ext2fs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ext2fs</span>(5)</span></a> driver allows the FreeBSD kernel to both
	read and write to ext2 file systems.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">This driver can also be used to access ext3 and ext4
	  file systems.  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ext2fs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ext2fs</span>(5)</span></a> filesystem has full read
	  and write support for ext4 as of FreeBSD 12.0-RELEASE.
	  Additionally, extended attributes and ACLs are also
	  supported, while journalling and encryption are not.
	  Starting with FreeBSD 12.1-RELEASE, a DTrace provider will
	  be available as well.  Prior versions of FreeBSD can access
	  ext4 in read and write mode using
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/fusefs-ext2/pkg-descr">sysutils/fusefs-ext2</a>.</p></div><p xml:lang="en" lang="en">To access an ext file system, first
	load the kernel loadable module:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload ext2fs</code></strong></pre><p xml:lang="en" lang="en">Then, mount the ext volume by specifying its FreeBSD
	partition name and an existing mount point.  This example
	mounts <code class="filename">/dev/ad1s1</code> on
	<code class="filename">/mnt</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount -t ext2fs <em class="replaceable"><code>/dev/ad1s1</code></em> <em class="replaceable"><code>/mnt</code></em></code></strong></pre></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization"></a>章 21. 虛擬化</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Murray</span> <span class="surname">Stokely</span></span>. </span></div><div><span class="authorgroup">bhyve section by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Allan</span> <span class="surname">Jude</span></span>. </span></div><div><span class="authorgroup">Xen section by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Benedict</span> <span class="surname">Reuschling</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#virtualization-synopsis">21.1. 概述</a></span></dt><dt><span class="sect1"><a href="#virtualization-guest-parallels">21.2. 在 <span class="trademark">Mac OS</span>® X 的 <span class="application">Parallels</span> 安裝 FreeBSD 為客端</a></span></dt><dd><dl><dt><span class="sect2"><a href="#virtualization-guest-parallels-install">21.2.1. 在 Parallels/<span class="trademark">Mac OS</span>® X 安裝 FreeBSD</a></span></dt><dt><span class="sect2"><a href="#virtualization-guest-parallels-configure">21.2.2. 在 <span class="application">Parallels</span> 設定 FreeBSD</a></span></dt></dl></dd><dt><span class="sect1"><a href="#virtualization-guest-virtualpc">21.3. 在 <span class="trademark">Windows</span>® 的 <span class="application">Virtual PC</span> 安裝 FreeBSD 為客端</a></span></dt><dd><dl><dt><span class="sect2"><a href="#virtualization-guest-virtualpc-install">21.3.1. 在 <span class="application">Virtual PC</span> 安裝 FreeBSD</a></span></dt><dt><span class="sect2"><a href="#virtualization-guest-virtualpc-configure">21.3.2. 在 <span class="application">Virtual PC</span> 設定 FreeBSD</a></span></dt></dl></dd><dt><span class="sect1"><a href="#virtualization-guest-vmware">21.4. 在 <span class="trademark">Mac OS</span>® 的 <span class="application">VMware Fusion</span> 安裝 FreeBSD 為客端</a></span></dt><dd><dl><dt><span class="sect2"><a href="#virtualization-guest-vmware-install">21.4.1. 在 <span class="application">VMware Fusion</span> 安裝 FreeBSD</a></span></dt><dt><span class="sect2"><a href="#virtualization-guest-vmware-configure">21.4.2. 在 <span class="application">VMware Fusion</span> 設定 FreeBSD</a></span></dt></dl></dd><dt><span class="sect1"><a href="#virtualization-guest-virtualbox">21.5. 在 <span class="trademark">VirtualBox</span>™ 安裝 FreeBSD 作為客端</a></span></dt><dt><span class="sect1"><a href="#virtualization-host-virtualbox">21.6. 以 FreeBSD 作為主端使用 <span class="trademark">VirtualBox</span>™</a></span></dt><dd><dl><dt><span class="sect2"><a href="#virtualization-virtualbox-install">21.6.1. 安裝 <span class="trademark">VirtualBox</span>™</a></span></dt><dt><span class="sect2"><a href="#virtualization-virtualbox-usb-support">21.6.2. <span class="trademark">VirtualBox</span>™ USB 支援</a></span></dt><dt><span class="sect2"><a href="#virtualization-virtualbox-host-dvd-cd-access">21.6.3. <span class="trademark">VirtualBox</span>™ Host <acronym class="acronym">DVD</acronym>/<acronym class="acronym">CD</acronym> 存取</a></span></dt></dl></dd><dt><span class="sect1"><a href="#virtualization-host-bhyve">21.7. 以 FreeBSD 作為主端安裝 <span class="application">bhyve</span></a></span></dt><dd><dl><dt><span class="sect2"><a href="#virtualization-bhyve-prep">21.7.1. 準備主端</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-freebsd">21.7.2. 建立 FreeBSD 客端</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-linux">21.7.3. 建立 <span class="trademark">Linux</span>® 客端</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-uefi">21.7.4. 使用 <acronym class="acronym">UEFI</acronym> 韌體開機 <span class="application">bhyve</span> 虛擬機器</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-framebuffer">21.7.5. 供 <span class="application">bhyve</span> 客端用的圖型化 <acronym class="acronym">UEFI</acronym> Framebuffer</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-zfs">21.7.6. 在 <span class="application">bhyve</span> 客端使用 <acronym class="acronym">ZFS</acronym></a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-nmdm">21.7.7. 虛擬機器 Console</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-managing">21.7.8. 管理虛擬機器</a></span></dt><dt><span class="sect2"><a href="#virtualization-bhyve-onboot">21.7.9. Persistent 設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#virtualization-host-xen">21.8. 以 FreeBSD 作為主端安裝 <span class="trademark">Xen</span>™</a></span></dt><dd><dl><dt><span class="sect2"><a href="#virtualization-host-xen-requirements">21.8.1. <span class="trademark">Xen</span>™ Dom0 的硬體需求</a></span></dt><dt><span class="sect2"><a href="#virtualization-host-xen-dom0-setup">21.8.2. <span class="trademark">Xen</span>™ Dom0 控制領域安裝</a></span></dt><dt><span class="sect2"><a href="#virtualization-host-xen-domu-setup">21.8.3. <span class="trademark">Xen</span>™ DomU 客端 VM 設置</a></span></dt><dt><span class="sect2"><a href="#virtualization-host-xen-troubleshooting">21.8.4. 疑難排解</a></span></dt><dd><dl><dt><span class="sect3"><a href="#virtualization-host-xen-troubleshooting-host">21.8.4.1. 主端開機疑難排解</a></span></dt><dt><span class="sect3"><a href="#virtualization-host-xen-troubleshooting-guest">21.8.4.2. 客端建立疑難排解</a></span></dt></dl></dd></dl></dd></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="virtualization-synopsis"></a>21.1. 概述</h2></div></div></div><p>虛擬化軟體可以讓同一台機器得以同時執行多種作業系統。在 <acronym class="acronym">PC</acronym> 上的這類軟體系統通常涉及的角色有執行虛擬化軟體的主端 (Host) 作業系統以及數個安裝在其中的客端 (Guest) 作業系統。</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>主端作業系統及客端作業系統的差別。</p></li><li class="listitem"><p>如何在 <span class="trademark">Intel</span>®-based <span class="trademark">Apple</span>® <span class="trademark">Mac</span>® 電腦安裝 FreeBSD 。</p></li><li class="listitem"><p>如何在 <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 使用 <span class="application">Virtual PC</span> 安裝 FreeBSD。</p></li><li class="listitem"><p>如何以 FreeBSD 作為客端安裝在 <span class="application">bhyve</span>。</p></li><li class="listitem"><p>如何調校 FreeBSD 系統來取得虛擬化的最佳效能。</p></li></ul></div><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>了解 <a class="link" href="#basics" title="章 3. FreeBSD 基礎"><span class="trademark">UNIX</span>® 與 FreeBSD 的基礎</a>。</p></li><li class="listitem"><p>知道如何<a class="link" href="#bsdinstall" title="章 2. 安裝 FreeBSD">安裝 FreeBSD</a>。</p></li><li class="listitem"><p>知道如何<a class="link" href="#advanced-networking" title="章 31. 進階網路設定">設定網路連線</a>。</p></li><li class="listitem"><p>知道如何<a class="link" href="#ports" title="章 4. 安裝應用程式：套件與 Port">安裝其他第三方軟體</a>。</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="virtualization-guest-parallels"></a>21.2. 在 <span class="trademark">Mac OS</span>® X 的 <span class="application">Parallels</span> 安裝 FreeBSD 為客端</h2></div></div></div><p><span class="trademark">Mac</span>® 的 <span class="application">Parallels Desktop</span> 是一套商業軟體可在 <span class="trademark">Intel</span>® 為基礎的 <span class="trademark">Apple</span>® <span class="trademark">Mac</span>® 的 <span class="trademark">Mac OS</span>® 10.4.6 或更新版本上執行。 該軟體完全支援使用 FreeBSD 作為客端作業系統。 在 <span class="trademark">Mac OS</span>® X 裝好 <span class="application">Parallels</span> 後，使用者必先完成虛擬機器的設定後才可安裝想使用的客端作業系統。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-parallels-install"></a>21.2.1. 在 Parallels/<span class="trademark">Mac OS</span>® X 安裝 FreeBSD</h3></div></div></div><p>在 <span class="application">Parallels</span> 上安裝 FreeBSD 的第一步是建立供安裝 FreeBSD 使用的新虛擬機器。提示出現後請選擇 <span class="guimenu">Guest OS Type</span> 為 <span class="guimenuitem">FreeBSD</span>：</p><div class="mediaobject"><img src="virtualization/parallels-freebsd1.png" /></div><p>根據您對此虛擬 FreeBSD 作業系統的規畫選擇合理的磁碟及記憶體空間，對大多數在 <span class="application">Parallels</span> 下的 FreeBSD 使用來講 4GB 的磁碟空間與 512MB 的 RAM 便足夠：</p><div class="mediaobject"><img src="virtualization/parallels-freebsd2.png" /></div><div class="mediaobject"><img src="virtualization/parallels-freebsd3.png" /></div><div class="mediaobject"><img src="virtualization/parallels-freebsd4.png" /></div><div class="mediaobject"><img src="virtualization/parallels-freebsd5.png" /></div><p>選擇網路類型以及網路介面：</p><div class="mediaobject"><img src="virtualization/parallels-freebsd6.png" /></div><div class="mediaobject"><img src="virtualization/parallels-freebsd7.png" /></div><p>儲存並完成設定：</p><div class="mediaobject"><img src="virtualization/parallels-freebsd8.png" /></div><div class="mediaobject"><img src="virtualization/parallels-freebsd9.png" /></div><p>在 FreeBSD 虛擬機器新增後，就可以繼續以其安裝 FreeBSD。 安裝方面，比較好的作法是使用官方的 FreeBSD <acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym> 或者是自官方 <acronym class="acronym">FTP</acronym> 站下載的 <acronym class="acronym">ISO</acronym> 映像檔。 複製適合的 <acronym class="acronym">ISO</acronym> 映像檔到 <span class="trademark">Mac</span>® 檔案系統本地端或放入 <acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym> 到 <span class="trademark">Mac</span>® 的 <acronym class="acronym">CD-ROM</acronym> 磁碟機。在 FreeBSD <span class="application">Parallels</span> 視窗的右下角點選磁碟圖示後會出現一個視窗，可用來建立虛擬機器內的 <acronym class="acronym">CD-ROM</acronym> 磁碟機與磁碟上 <acronym class="acronym">ISO</acronym> 檔案或實際 <acronym class="acronym">CD-ROM</acronym> 磁碟機的關聯。</p><div class="mediaobject"><img src="virtualization/parallels-freebsd11.png" /></div><p>建立與 <acronym class="acronym">CD-ROM</acronym> 來源的關聯後，點選重新開機圖示重新開啟 FreeBSD 虛擬機器。<span class="application">Parallels</span> 會重新開機進入一個特殊的 <acronym class="acronym">BIOS</acronym> 畫面並檢查是否有 <acronym class="acronym">CD-ROM</acronym>。</p><div class="mediaobject"><img src="virtualization/parallels-freebsd10.png" /></div><p>在此處會找到 FreeBSD 安裝媒體並開始正常的 FreeBSD 安裝程序。完成安裝，但不要在此時嘗試設定 <span class="application">Xorg</span>。</p><div class="mediaobject"><img src="virtualization/parallels-freebsd12.png" /></div><p>當安裝完成後，重新開機將會進入新安裝的 FreeBSD 虛擬機器。</p><div class="mediaobject"><img src="virtualization/parallels-freebsd13.png" /></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-parallels-configure"></a>21.2.2. 在 <span class="application">Parallels</span> 設定 FreeBSD</h3></div></div></div><p>在成功將 FreeBSD 安裝到 <span class="trademark">Mac OS</span>® X 的 <span class="application">Parallels</span> 後，有數個設定步驟要完成來最佳化系統在虛擬機器上的運作。</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>設定 Boot Loader 變數</strong></p><p>最重要的一個步驟是減少 <code class="option">kern.hz</code> 參數來減少 FreeBSD 在 <span class="application">Parallels</span> 環境下對 CPU 的使用率。加入以下行到 <code class="filename">/boot/loader.conf</code> 來完成這個動作：</p><pre xml:lang="en" class="programlisting" lang="en">kern.hz=100</pre><p>若沒有完成此設定，閒置的 FreeBSD <span class="application">Parallels</span> 客端將會消耗掉單一處理器的 <span class="trademark">iMac</span>® 將近 15% 的 CPU。完成此更改後使用率會減至接近 5%。</p></li><li class="step"><p class="title"><strong>建立新核心設定檔</strong></p><p>所有的 SCSI, FireWire 及 USB 裝置可以從自訂的核心設定檔中移除。<span class="application">Parallels</span> 提供的虛擬網路卡使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ed&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ed</span>(4)</span></a> 驅動程式，所以除了 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ed&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ed</span>(4)</span></a> 以及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=miibus&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">miibus</span>(4)</span></a> 外的所有網路裝置可以自核心中移除。</p></li><li class="step"><p class="title"><strong>設定網路</strong></p><p>最基本的網路設定是使用 DHCP 來讓虛擬機器連線到與主端 <span class="trademark">Mac</span>® 相同的區域網路，這可以透過加入 <code class="literal">ifconfig_ed0="DHCP"</code> 到 <code class="filename">/etc/rc.conf</code> 來完成。更進階的網路設定在 <a class="xref" href="#advanced-networking" title="章 31. 進階網路設定">章 31, <em>進階網路設定</em></a> 中描述。</p></li></ol></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="virtualization-guest-virtualpc"></a>21.3. 在 <span class="trademark">Windows</span>® 的 <span class="application">Virtual PC</span> 安裝 FreeBSD 為客端</h2></div></div></div><p>給 <span class="trademark">Windows</span>® 使用的 <span class="application">Virtual PC</span> 是一套可免費下載的 <span class="trademark">Microsoft</span>® 軟體產品，請參考此網站取得<a class="link" href="http://www.microsoft.com/windows/downloads/virtualpc/sysreq.mspx" target="_top">系統需求</a>。<span class="application">Virtual PC</span> 在 <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 上安裝完成之後，使用者可以設定一台虛擬機器然後安裝想要的客端作業系統。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-virtualpc-install"></a>21.3.1. 在 <span class="application">Virtual PC</span> 安裝 FreeBSD</h3></div></div></div><p>安裝 FreeBSD 到 <span class="application">Virtual PC</span> 的第一個步驟是建立新的虛擬機器來安裝 FreeBSD。當提示畫面出現時，請選擇 <span class="guimenuitem">Create a virtual machine</span>：</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd1.png" /></div><div class="mediaobject"><img src="virtualization/virtualpc-freebsd2.png" /></div><p>當提示畫面出現時，選擇 <span class="guimenuitem">Operating system</span> 為 <span class="guimenuitem">Other</span>：</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd3.png" /></div><p>然後，根據您對此虛擬 FreeBSD 作業系統的規畫選擇合理的磁碟及記憶體空間，對大多數在 <span class="application">Virtual PC</span> 下的 FreeBSD 使用來講 4GB 的磁碟空間與 512MB 的 RAM 便足夠：</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd4.png" /></div><div class="mediaobject"><img src="virtualization/virtualpc-freebsd5.png" /></div><p>儲存並完成設定：</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd6.png" /></div><p>選擇 FreeBSD 虛擬機器然後點選 <span class="guimenu">Settings</span>，接著設定網路類型及網路介面卡：</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd7.png" /></div><div class="mediaobject"><img src="virtualization/virtualpc-freebsd8.png" /></div><p>FreeBSD 虛擬機器建立完成之後，便可安裝 FreeBSD 到該虛擬機器。安裝最好使用官方 FreeBSD <acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym> 或使用自官方 <acronym class="acronym">FTP</acronym> 站下載的 <acronym class="acronym">ISO</acronym> 映像檔。複製適當的 <acronym class="acronym">ISO</acronym> 映像檔到本地 <span class="trademark">Windows</span>® 檔案系統或插入 <acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym> 到 <acronym class="acronym">CD</acronym> 磁碟機，然後雙擊點選 FreeBSD 虛擬機器來開機。接著，點選 <span class="guimenu">CD</span> 並在 <span class="application">Virtual PC</span> 視窗選擇 <span class="guimenu">Capture ISO Image...</span>，這將會顯示一個視窗可以建立虛擬機器中的 <acronym class="acronym">CD-ROM</acronym> 與 <acronym class="acronym">ISO</acronym> 檔或磁碟或實體 <acronym class="acronym">CD-ROM</acronym> 磁碟機之間的關聯。</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd9.png" /></div><div class="mediaobject"><img src="virtualization/virtualpc-freebsd10.png" /></div><p>建立與 <acronym class="acronym">CD-ROM</acronym> 來源的關聯後，點選 <span class="guimenu">Action</span> 及 <span class="guimenu">Reset</span> 重新開機 FreeBSD 虛擬機器。<span class="application">Virtual PC</span> 會重新開始並進入特殊的 <acronym class="acronym">BIOS</acronym> 來做 <acronym class="acronym">CD-ROM</acronym> 的第一次檢查。</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd11.png" /></div><p>在這個情況下會找到 FreeBSD 安裝媒體然後開始正常的 FreeBSD 安裝。接著繼續安裝，但此時請不要嘗試設定 <span class="application">Xorg</span>。</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd12.png" /></div><p>當安裝完成之後，記得退出 <acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym> 或釋放 <acronym class="acronym">ISO</acronym> 映像檔。最後，重新開機進入新安裝的 FreeBSD 虛擬機器。</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd13.png" /></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-virtualpc-configure"></a>21.3.2. 在 <span class="application">Virtual PC</span> 設定 FreeBSD</h3></div></div></div><p>在成功將 FreeBSD 安裝到 <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 的 <span class="application">Virtual PC</span> 後，有數個設定步驟要完成來最佳化系統在虛擬機器上的運作。</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>設定 Boot Loader 變數</strong></p><p>最重要的一個步驟是減少 <code class="option">kern.hz</code>，來減少 FreeBSD 在 <span class="application">Virtual PC</span> 環境下 CPU 的使用量。這可以透過加入下列幾行到 <code class="filename">/boot/loader.conf</code> 來完成：</p><pre xml:lang="en" class="programlisting" lang="en">kern.hz=100</pre><p>若沒有完成此設定，閒置的 FreeBSD <span class="application">Virtual PC</span> 客端 OS 會消耗掉單一處理器的電腦 40% 的 CPU。完成此更改後使用率會減至接近 3%。</p></li><li class="step"><p class="title"><strong>建立新核心設定檔</strong></p><p>所有的 SCSI, FireWire 及 USB 裝置可以從自訂的核心設定檔中移除。<span class="application">Virtual PC</span> 提供的虛擬網路卡使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=de&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">de</span>(4)</span></a> 驅動程式，所以除了 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=de&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">de</span>(4)</span></a> 以及 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=miibus&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">miibus</span>(4)</span></a> 外的所有網路裝置可以自核心中移除。</p></li><li class="step"><p class="title"><strong>設定網路</strong></p><p>最基本的網路設定是使用 DHCP 來讓虛擬機器連線到與主端 <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 相同的區域網路，這可以透過加入 <code class="literal">ifconfig_de0="DHCP"</code> 到 <code class="filename">/etc/rc.conf</code> 來完成。更進階的網路設定在 <a class="xref" href="#advanced-networking" title="章 31. 進階網路設定">章 31, <em>進階網路設定</em></a> 中描述。</p></li></ol></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="virtualization-guest-vmware"></a>21.4. 在 <span class="trademark">Mac OS</span>® 的 <span class="application">VMware Fusion</span> 安裝 FreeBSD 為客端</h2></div></div></div><p><span class="application">VMware Fusion</span> 是一套商業軟體可在 <span class="trademark">Intel</span>® 為基礎的 <span class="trademark">Apple</span>® <span class="trademark">Mac</span>® 的 <span class="trademark">Mac OS</span>® 10.4.9 或更新版本上執行。 該軟體完全支援使用 FreeBSD 作為客端作業系統。 在 <span class="trademark">Mac OS</span>® X 裝好 <span class="application">VMware Fusion</span> 後，使用者必先完成虛擬機器的設定後才可安裝想使用的客端作業系統。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-vmware-install"></a>21.4.1. 在 <span class="application">VMware Fusion</span> 安裝 FreeBSD</h3></div></div></div><p>第一個步驟是啟動 <span class="application">VMware Fusion</span> 載入 Virtual Machine Library，點選 <span class="guimenuitem">New</span> 建立虛擬機器：</p><div class="mediaobject"><img src="virtualization/vmware-freebsd01.png" /></div><p>這個動做會載入 New Virtual Machine Assistant，點選 <span class="guimenuitem">Continue</span> 繼續：</p><div class="mediaobject"><img src="virtualization/vmware-freebsd02.png" /></div><p>選擇 <span class="guimenuitem">Operating System</span> 為 <span class="guimenuitem">Other</span> 以及在 <span class="guimenu">Version</span> 提示出現時選擇 <span class="guimenuitem">FreeBSD</span> 或 <span class="guimenuitem">FreeBSD 64-bit</span>：</p><div class="mediaobject"><img src="virtualization/vmware-freebsd03.png" /></div><p>選擇虛擬機器要使用的名稱以及要儲存目錄位置：</p><div class="mediaobject"><img src="virtualization/vmware-freebsd04.png" /></div><p>選擇虛擬機器的 Virtual Hard Disk 大小：</p><div class="mediaobject"><img src="virtualization/vmware-freebsd05.png" /></div><p>選擇安裝虛擬機器的方式，可從 <acronym class="acronym">ISO</acronym> 映像檔或從 <acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym>：</p><div class="mediaobject"><img src="virtualization/vmware-freebsd06.png" /></div><p>點選 <span class="guimenuitem">Finish</span> 接著虛擬機器會開機：</p><div class="mediaobject"><img src="virtualization/vmware-freebsd07.png" /></div><p>照往常方式安裝 FreeBSD：</p><div class="mediaobject"><img src="virtualization/vmware-freebsd08.png" /></div><p>安裝完成後，可以修改虛擬機器的設定，例如記憶體使用量：</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">虛擬機器的 System Hardware 設定無法在虛擬機器執行時修改。</p></div><div class="mediaobject"><img src="virtualization/vmware-freebsd09.png" /></div><p>虛擬機器要使用的 CPU 數量：</p><div class="mediaobject"><img src="virtualization/vmware-freebsd10.png" /></div><p><acronym class="acronym">CD-ROM</acronym> 裝置的狀態，正常情況 <acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym>/<acronym class="acronym">ISO</acronym> 在不需要時會中斷與虛擬機器的連線。</p><div class="mediaobject"><img src="virtualization/vmware-freebsd11.png" /></div><p>最後一件事是更改虛擬機器連線到網路的方式，要允許除了主端以外的機器連線到虛擬機器，請選擇 <span class="guimenuitem">Connect directly to the physical network (Bridged)</span>。否則會偏好使用 <span class="guimenuitem">Share the host's internet connection (NAT)</span> 來讓虛擬機器可以存取網際網路，但外部網路無法連線到虛擬機器。</p><div class="mediaobject"><img src="virtualization/vmware-freebsd12.png" /></div><p>在修改設定之後，開機進入新安裝的 FreeBSD 虛擬機器。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-vmware-configure"></a>21.4.2. 在 <span class="application">VMware Fusion</span> 設定 FreeBSD</h3></div></div></div><p>在成功將 FreeBSD 安裝到 <span class="trademark">Mac OS</span>® X 的 <span class="application">VMware Fusion</span> 後，有數個設定步驟要完成來最佳化系統在虛擬機器上的運作。</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>設定 Boot Loader 變數</strong></p><p>最重要的一個步驟是減少 <code class="option">kern.hz</code>，來減少 FreeBSD 在 <span class="application">VMware Fusion</span> 環境下 CPU 的使用量。這可以透過加入下列幾行到 <code class="filename">/boot/loader.conf</code> 來完成：</p><pre xml:lang="en" class="programlisting" lang="en">kern.hz=100</pre><p>若沒有完成此設定，閒置的 FreeBSD <span class="application">VMware Fusion</span> 客端將會消耗掉單一處理器的 <span class="trademark">iMac</span>® 將近 15% 的 CPU。完成此更改後使用率會減至接近 5%。</p></li><li class="step"><p class="title"><strong>建立新核心設定檔</strong></p><p>所有的 SCSI, FireWire 及 USB 裝置可以從自訂的核心設定檔中移除。<span class="application">VMware Fusion</span> 提供的虛擬網路卡使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=em&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">em</span>(4)</span></a> 驅動程式，所以除了 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=em&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">em</span>(4)</span></a> 外的所有網路裝置可以自核心中移除。</p></li><li class="step"><p class="title"><strong>設定網路</strong></p><p>最基本的網路設定是使用 DHCP 來讓虛擬機器連線到與主端 <span class="trademark">Mac</span>® 相同的區域網路，這可以透過加入 <code class="literal">ifconfig_em0="DHCP"</code> 到 <code class="filename">/etc/rc.conf</code> 來完成。更進階的網路設定在 <a class="xref" href="#advanced-networking" title="章 31. 進階網路設定">章 31, <em>進階網路設定</em></a> 中描述。</p></li></ol></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="virtualization-guest-virtualbox"></a>21.5. 在 <span class="trademark">VirtualBox</span>™ 安裝 FreeBSD 作為客端</h2></div></div></div><p>在 <span class="application"><span class="trademark">VirtualBox</span>™</span> 中使用 FreeBSD 做為客端系統也可運作的很好，虛擬化軟體可支援最常見的幾個作業系統，這當然也包含 FreeBSD。</p><p><span class="application"><span class="trademark">VirtualBox</span>™</span> guest additions 支援以下功能：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>剪貼簿共享。</p></li><li class="listitem"><p>滑鼠指標整合。</p></li><li class="listitem"><p>主機時間同步。</p></li><li class="listitem"><p>視窗縮放。</p></li><li class="listitem"><p>無痕模式。</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">以下指令均是在 FreeBSD 客端中執行。</p></div><p>首先，在 FreeBSD 客端安裝 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/emulators/virtualbox-ose-additions/pkg-descr">emulators/virtualbox-ose-additions</a> 套件或 Port，以下指令會安裝 Port：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/emulators/virtualbox-ose-additions &amp;&amp; make install clean</code></strong></pre><p>加入下行到 <code class="filename">/etc/rc.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">vboxguest_enable="YES"
vboxservice_enable="YES"</pre><p>若有使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> 或 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a>，便可關閉主機時間同步功能：</p><pre xml:lang="en" class="programlisting" lang="en">vboxservice_flags="--disable-timesync"</pre><p><span class="application">Xorg</span> 會自動辨識 <code class="literal">vboxvideo</code> 驅動程式，也可手動在 <code class="filename">/etc/X11/xorg.conf</code> 中輸入：</p><pre xml:lang="en" class="programlisting" lang="en">Section "Device"
	Identifier "Card0"
	Driver "vboxvideo"
	VendorName "InnoTek Systemberatung GmbH"
	BoardName "VirtualBox Graphics Adapter"
EndSection</pre><p>要使用 <code class="literal">vboxmouse</code> 驅動程式，可調整在 <code class="filename">/etc/X11/xorg.conf</code> 中與滑鼠相關的一節：</p><pre xml:lang="en" class="programlisting" lang="en">Section "InputDevice"
	Identifier "Mouse0"
	Driver "vboxmouse"
EndSection</pre><p><acronym class="acronym">HAL</acronym> 的使用者應建立以下 <code class="filename">/usr/local/etc/hal/fdi/policy/90-vboxguest.fdi</code> 或複製自 <code class="filename">/usr/local/share/hal/fdi/policy/10osvendor/90-vboxguest.fdi</code>：</p><pre xml:lang="en" class="programlisting" lang="en">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!--
# Sun VirtualBox
# Hal driver description for the vboxmouse driver
# $Id: chapter.xml,v 1.33 2012-03-17 04:53:52 eadler Exp $

	Copyright (C) 2008-2009 Sun Microsystems, Inc.

	This file is part of VirtualBox Open Source Edition (OSE, as
	available from http://www.virtualbox.org. This file is free software;
	you can redistribute it and/or modify it under the terms of the GNU
	General Public License (GPL) as published by the Free Software
	Foundation, in version 2 as it comes in the "COPYING" file of the
	VirtualBox OSE distribution. VirtualBox OSE is distributed in the
	hope that it will be useful, but WITHOUT ANY WARRANTY of any kind.

	Please contact Sun Microsystems, Inc., 4150 Network Circle, Santa
	Clara, CA 95054 USA or visit http://www.sun.com if you need
	additional information or have any questions.
--&gt;
&lt;deviceinfo version="0.2"&gt;
  &lt;device&gt;
    &lt;match key="info.subsystem" string="pci"&gt;
      &lt;match key="info.product" string="VirtualBox guest Service"&gt;
        &lt;append key="info.capabilities" type="strlist"&gt;input&lt;/append&gt;
	&lt;append key="info.capabilities" type="strlist"&gt;input.mouse&lt;/append&gt;
        &lt;merge key="input.x11_driver" type="string"&gt;vboxmouse&lt;/merge&gt;
	&lt;merge key="input.device" type="string"&gt;/dev/vboxguest&lt;/merge&gt;
      &lt;/match&gt;
    &lt;/match&gt;
  &lt;/device&gt;
&lt;/deviceinfo&gt;</pre><p xml:lang="en" lang="en">Shared folders for file transfers between host and VM are
      accessible by mounting them using
      <code class="literal">mount_vboxvfs</code>.  A shared folder can be created
      on the host using the VirtualBox GUI or via
      <code class="command">vboxmanage</code>.  For example, to create a shared
      folder called <em class="replaceable"><code>myshare</code></em> under
      <code class="filename"><em class="replaceable"><code>/mnt/bsdboxshare</code></em></code>
      for the VM named <em class="replaceable"><code>BSDBox</code></em>, run:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>vboxmanage sharedfolder add '<em class="replaceable"><code>BSDBox</code></em>' --name <em class="replaceable"><code>myshare</code></em> --hostpath <em class="replaceable"><code>/mnt/bsdboxshare</code></em></code></strong></pre><p xml:lang="en" lang="en">Note that the shared folder name must not contain spaces.
      Mount the shared folder from within the guest system like
      this:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount_vboxvfs -w <em class="replaceable"><code>myshare</code></em> <em class="replaceable"><code>/mnt</code></em></code></strong></pre></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="virtualization-host-virtualbox"></a>21.6. 以 FreeBSD 作為主端使用 <span class="trademark">VirtualBox</span>™</h2></div></div></div><p><span class="application"><span class="trademark">VirtualBox</span>™</span> 是一套積極開發、完整的虛擬化套件，適用大多數作業系統，包含 <span class="trademark">Windows</span>®, <span class="trademark">Mac OS</span>®, <span class="trademark">Linux</span>® 與 FreeBSD，它同樣能夠執行類 <span class="trademark">Windows</span>® 或 <span class="trademark">UNIX</span>® 的客端系統。它是以開源軟體的方式發佈，但閉源元件可獨立在擴充包中使用，這些元件包含對 USB 2.0 裝置的支援。更多資訊可在 <a class="link" href="http://www.virtualbox.org/wiki/Downloads" target="_top"><span class="application"><span class="trademark">VirtualBox</span>™</span> wiki 的 <span class="quote">“<span class="quote">Downloads</span>”</span> 頁面</a>。目前，這些擴充套件並不支援 FreeBSD。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-virtualbox-install"></a>21.6.1. 安裝 <span class="trademark">VirtualBox</span>™</h3></div></div></div><p><span class="application"><span class="trademark">VirtualBox</span>™</span> 可於 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/emulators/virtualbox-ose/pkg-descr">emulators/virtualbox-ose</a> 以 FreeBSD 套件或 Port 的方式取得。要安裝 Port 可使用以下指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/emulators/virtualbox-ose</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>在 Port 的設定選單中 <code class="literal">GuestAdditions</code> 相關程式是最有用的選項之一，這些程式可在客端作業系統提供數個有用的功能，如滑鼠指標整合 (允許滑鼠在主端與客端之間移動，不需要按特殊快速鍵來切換) 與較快的影像繪圖速度，特別是在 <span class="trademark">Windows</span>® 的客端系統。Guest additions 可在客端系統安裝完之後的 <span class="guimenu">Devices</span> 選單找到。</p><p>還有一些設定需要在 <span class="application"><span class="trademark">VirtualBox</span>™</span> 第一次啟動端做修改，Port 會安裝一個核心模組在 <code class="filename">/boot/modules</code>，該模組必須在核心中載入：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload vboxdrv</code></strong></pre><p>要確保該模組在重新開機後會載入，可加入下行到 <code class="filename">/boot/loader.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">vboxdrv_load="YES"</pre><p>要使用可支援橋接或僅限主端 (Host-only) 的網路，可加入下行到 <code class="filename">/etc/rc.conf</code>，然後重新啟動電腦：</p><pre xml:lang="en" class="programlisting" lang="en">vboxnet_enable="YES"</pre><p>在安裝 <span class="application"><span class="trademark">VirtualBox</span>™</span> 的過程中會建立 <code class="systemitem">vboxusers</code> 群組，所有需要存取 <span class="application"><span class="trademark">VirtualBox</span>™</span> 的使用者均需要加入成為此群組的成員，<code class="command">pw</code> 可用來加入新的成員：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pw groupmod vboxusers -m <em class="replaceable"><code>yourusername</code></em></code></strong></pre><p><code class="filename">/dev/vboxnetctl</code> 的預設權限是受限的，需要更改後才可使用橋接網路：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>chown root:vboxusers /dev/vboxnetctl</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chmod 0660 /dev/vboxnetctl</code></strong></pre><p>要永久變更權限，可加入下列幾行到 <code class="filename">/etc/devfs.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">own     vboxnetctl root:vboxusers
perm    vboxnetctl 0660</pre><p>要執行 <span class="application"><span class="trademark">VirtualBox</span>™</span>，可在 <span class="application">Xorg</span> 工作階段輸入：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>VirtualBox</code></strong></pre><p>要取得更多有關設定與使用 <span class="application"><span class="trademark">VirtualBox</span>™</span> 的資訊，請參考 <a class="link" href="http://www.virtualbox.org" target="_top">官方網站</a>。供 FreeBSD 特定的資訊與疑難排解操作指示，可參考 <a class="link" href="http://wiki.FreeBSD.org/VirtualBox" target="_top">FreeBSD wiki 中相關的頁面</a>。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-virtualbox-usb-support"></a>21.6.2. <span class="trademark">VirtualBox</span>™ USB 支援</h3></div></div></div><p xml:lang="en" lang="en"><span class="application"><span class="trademark">VirtualBox</span>™</span> can be configured
	to pass <acronym class="acronym">USB</acronym> devices through to the guest
	operating system.  The host controller of the OSE version is
	limited to emulating <acronym class="acronym">USB</acronym> 1.1 devices until
	the extension pack supporting <acronym class="acronym">USB</acronym> 2.0 and
	3.0 devices becomes available on FreeBSD.</p><p xml:lang="en" lang="en">For <span class="application"><span class="trademark">VirtualBox</span>™</span> to be aware of
	<acronym class="acronym">USB</acronym> devices attached to the machine, the
	user needs to be a member of the <code class="systemitem">operator</code> group.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pw groupmod operator -m <em class="replaceable"><code>yourusername</code></em></code></strong></pre><p xml:lang="en" lang="en">Then, add the following to
       <code class="filename">/etc/devfs.rules</code>, or create this file if
       it does not exist yet:</p><pre xml:lang="en" class="programlisting" lang="en">[system=10]
add path 'usb/*' mode 0660 group operator</pre><p>若服務未執行，請加入下行到 <code class="filename">/etc/rc.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">devfs_system_ruleset="system"</pre><p>然後重新啟動 devfs：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service devfs restart</code></strong></pre><p>重新啟動登作階段與 <span class="application"><span class="trademark">VirtualBox</span>™</span> 來讓這些變更生效，且建立必要的 <acronym class="acronym">USB</acronym> 的過濾器。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-virtualbox-host-dvd-cd-access"></a>21.6.3. <span class="trademark">VirtualBox</span>™ Host <acronym class="acronym">DVD</acronym>/<acronym class="acronym">CD</acronym> 存取</h3></div></div></div><p>透過共享實體磁碟機可讓客端系統能夠存取主端系統的 <acronym class="acronym">DVD</acronym>/<acronym class="acronym">CD</acronym> 磁碟機。在 <span class="trademark">VirtualBox</span>™ 中，這個功能可在虛擬機器設定中的儲存 (Storage) 視窗中設定。若需要，可先建立一個空的 <acronym class="acronym">IDE</acronym> <acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym> 裝置，然後在跳出的選單中選擇要做為虛擬 <acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym> 磁碟機的主端磁碟機，此時會出現一個標籤為 <code class="literal">Passthrough</code> 的核選方塊，勾選這個核選方塊可讓虛擬機器直接使用該硬體，例如，音樂 <acronym class="acronym">CD</acronym> 或燒錄機只會在有勾選此選項時能夠運作。</p><p><span class="application"><span class="trademark">VirtualBox</span>™</span> <acronym class="acronym">DVD</acronym>/<acronym class="acronym">CD</acronym> 功能要能運作需要執行 <acronym class="acronym">HAL</acronym>，因此需在 <code class="filename">/etc/rc.conf</code> 中開啟，若該服務尚未啟動，則啟動它：</p><pre xml:lang="en" class="programlisting" lang="en">hald_enable="YES"</pre><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service hald start</code></strong></pre><p>為了讓使用者能夠使用 <span class="application"><span class="trademark">VirtualBox</span>™</span> <acronym class="acronym">DVD</acronym>/<acronym class="acronym">CD</acronym> 功能，這些使用者需要存取 <code class="filename">/dev/xpt0</code>, <code class="filename">/dev/cd<em class="replaceable"><code>N</code></em></code> 以及 <code class="filename">/dev/pass<em class="replaceable"><code>N</code></em></code>，這通常可讓這些使用者成為 <code class="systemitem">operator</code> 的成員來達成。對這些裝置的權限必須加入下行到 <code class="filename">/etc/devfs.conf</code> 來修正：</p><pre xml:lang="en" class="programlisting" lang="en">perm cd* 0660
perm xpt0 0660
perm pass* 0660</pre><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service devfs restart</code></strong></pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="virtualization-host-bhyve"></a>21.7. 以 FreeBSD 作為主端安裝 <span class="application">bhyve</span></h2></div></div></div><p xml:lang="en" lang="en">The <span class="application">bhyve</span>
      <acronym class="acronym">BSD</acronym>-licensed hypervisor became part of the
      base system with FreeBSD 10.0-RELEASE.  This hypervisor supports a
      number of guests, including FreeBSD, OpenBSD, and many <span class="trademark">Linux</span>®
      distributions.  By default, <span class="application">bhyve</span>
      provides access to serial console and does not emulate a
      graphical console.  Virtualization offload features of newer
      <acronym class="acronym">CPU</acronym>s are used to avoid the legacy methods of
      translating instructions and manually managing memory
      mappings.</p><p xml:lang="en" lang="en">The <span class="application">bhyve</span> design requires a
      processor that supports <span class="trademark">Intel</span>® Extended Page Tables
      (<acronym class="acronym">EPT</acronym>) or <span class="trademark">AMD</span>® Rapid Virtualization Indexing
      (<acronym class="acronym">RVI</acronym>) or Nested Page Tables
      (<acronym class="acronym">NPT</acronym>).  Hosting <span class="trademark">Linux</span>® guests or FreeBSD guests
      with more than one <acronym class="acronym">vCPU</acronym> requires
      <acronym class="acronym">VMX</acronym> unrestricted mode support
      (<acronym class="acronym">UG</acronym>).  Most newer processors, specifically
      the <span class="trademark">Intel</span>® <span class="trademark">Core</span>™ i3/i5/i7 and <span class="trademark">Intel</span>® <span class="trademark">Xeon</span>™
      E3/E5/E7, support these features.  <acronym class="acronym">UG</acronym> support
      was introduced with Intel's Westmere micro-architecture.  For a
      complete list of <span class="trademark">Intel</span>® processors that support
      <acronym class="acronym">EPT</acronym>, refer to <a class="link" href="https://ark.intel.com/content/www/us/en/ark/search/featurefilter.html?productType=873&amp;0_ExtendedPageTables=True" target="_top">https://ark.intel.com/content/www/us/en/ark/search/featurefilter.html?productType=873&amp;0_ExtendedPageTables=True</a>.
      <acronym class="acronym">RVI</acronym> is found on the third generation and
      later of the <span class="trademark">AMD Opteron</span>™ (Barcelona) processors.  The easiest
      way to tell if a processor supports
      <span class="application">bhyve</span> is to run
      <code class="command">dmesg</code> or look in
      <code class="filename">/var/run/dmesg.boot</code> for the
      <code class="literal">POPCNT</code> processor feature flag on the
      <code class="literal">Features2</code> line for <span class="trademark">AMD</span>® processors or
      <code class="literal">EPT</code> and <code class="literal">UG</code> on the
      <code class="literal">VT-x</code> line for <span class="trademark">Intel</span>® processors.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-bhyve-prep"></a>21.7.1. 準備主端</h3></div></div></div><p xml:lang="en" lang="en">The first step to creating a virtual machine in
	<span class="application">bhyve</span> is configuring the host
	system.  First, load the <span class="application">bhyve</span>
	kernel module:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload vmm</code></strong></pre><p xml:lang="en" lang="en">Then, create a <code class="filename">tap</code> interface for the
	network device in the virtual machine to attach to.  In order
	for the network device to participate in the network, also
	create a bridge interface containing the
	<code class="filename">tap</code> interface and the physical interface
	as members.  In this example, the physical interface is
	<em class="replaceable"><code>igb0</code></em>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>tap0</code></em> create</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl net.link.tap.up_on_open=1</code></strong>
net.link.tap.up_on_open: 0 -&gt; 1
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>bridge0</code></em> create</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>bridge0</code></em> addm <em class="replaceable"><code>igb0</code></em> addm <em class="replaceable"><code>tap0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>bridge0</code></em> up</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-bhyve-freebsd"></a>21.7.2. 建立 FreeBSD 客端</h3></div></div></div><p xml:lang="en" lang="en">Create a file to use as the virtual disk for the guest
	machine.  Specify the size and name of the virtual
	disk:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>truncate -s <em class="replaceable"><code>16G</code></em> <em class="replaceable"><code>guest.img</code></em></code></strong></pre><p xml:lang="en" lang="en">Download an installation image of FreeBSD to install:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>fetch <em class="replaceable"><code>ftp://ftp.freebsd.org/pub/FreeBSD/releases/ISO-IMAGES/10.3/FreeBSD-10.3-RELEASE-amd64-bootonly.iso</code></em></code></strong>
FreeBSD-10.3-RELEASE-amd64-bootonly.iso       100% of  230 MB  570 kBps 06m17s</pre><p xml:lang="en" lang="en">FreeBSD comes with an example script for running a virtual
	machine in <span class="application">bhyve</span>.  The script will
	start the virtual machine and run it in a loop, so it will
	automatically restart if it crashes.  The script takes a
	number of options to control the configuration of the machine:
	<code class="option">-c</code> controls the number of virtual CPUs,
	<code class="option">-m</code> limits the amount of memory available to
	the guest, <code class="option">-t</code> defines which
	<code class="filename">tap</code> device to use, <code class="option">-d</code>
	indicates which disk image to use, <code class="option">-i</code> tells
	<span class="application">bhyve</span> to boot from the
	<acronym class="acronym">CD</acronym> image instead of the disk, and
	<code class="option">-I</code> defines which <acronym class="acronym">CD</acronym> image
	to use.  The last parameter is the name of the virtual
	machine, used to track the running machines.  This example
	starts the virtual machine in installation mode:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sh /usr/share/examples/bhyve/vmrun.sh -c <em class="replaceable"><code>1</code></em> -m <em class="replaceable"><code>1024M</code></em> -t <em class="replaceable"><code>tap0</code></em> -d <em class="replaceable"><code>guest.img</code></em> -i -I <em class="replaceable"><code>FreeBSD-10.3-RELEASE-amd64-bootonly.iso</code></em> <em class="replaceable"><code>guestname</code></em></code></strong></pre><p xml:lang="en" lang="en">The virtual machine will boot and start the installer.
	After installing a system in the virtual machine, when the
	system asks about dropping in to a shell at the end of the
	installation, choose <span class="guibutton">Yes</span>.</p><p xml:lang="en" lang="en">Reboot the virtual machine.  While rebooting the virtual
	machine causes <span class="application">bhyve</span> to exit, the
	<code class="filename">vmrun.sh</code> script runs
	<code class="command">bhyve</code> in a loop and will automatically
	restart it.  When this happens, choose the reboot option from
	the boot loader menu in order to escape the loop.  Now the
	guest can be started from the virtual disk:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sh /usr/share/examples/bhyve/vmrun.sh -c <em class="replaceable"><code>4</code></em> -m <em class="replaceable"><code>1024M</code></em> -t <em class="replaceable"><code>tap0</code></em> -d <em class="replaceable"><code>guest.img</code></em> <em class="replaceable"><code>guestname</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-bhyve-linux"></a>21.7.3. 建立 <span class="trademark">Linux</span>® 客端</h3></div></div></div><p xml:lang="en" lang="en">In order to boot operating systems other than FreeBSD, the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/grub2-bhyve/pkg-descr">sysutils/grub2-bhyve</a> port must be first
	installed.</p><p xml:lang="en" lang="en">Next, create a file to use as the virtual disk for the
	guest machine:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>truncate -s <em class="replaceable"><code>16G</code></em> <em class="replaceable"><code>linux.img</code></em></code></strong></pre><p xml:lang="en" lang="en">Starting a virtual machine with
	<span class="application">bhyve</span> is a two step process.  First
	a kernel must be loaded, then the guest can be started.  The
	<span class="trademark">Linux</span>® kernel is loaded with
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/grub2-bhyve/pkg-descr">sysutils/grub2-bhyve</a>.  Create a
	<code class="filename">device.map</code> that
	<span class="application">grub</span> will use to map the virtual
	devices to the files on the host system:</p><pre xml:lang="en" class="programlisting" lang="en">(hd0) ./linux.img
(cd0) ./somelinux.iso</pre><p xml:lang="en" lang="en">Use <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/grub2-bhyve/pkg-descr">sysutils/grub2-bhyve</a> to load the
	<span class="trademark">Linux</span>® kernel from the <acronym class="acronym">ISO</acronym> image:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>grub-bhyve -m device.map -r cd0 -M <em class="replaceable"><code>1024M</code></em> <em class="replaceable"><code>linuxguest</code></em></code></strong></pre><p xml:lang="en" lang="en">This will start grub.  If the installation
	<acronym class="acronym">CD</acronym> contains a
	<code class="filename">grub.cfg</code>, a menu will be displayed.
	If not, the <code class="literal">vmlinuz</code> and
	<code class="literal">initrd</code> files must be located and loaded
	manually:</p><pre xml:lang="en" class="screen" lang="en">grub&gt; <strong class="userinput"><code>ls</code></strong>
(hd0) (cd0) (cd0,msdos1) (host)
grub&gt; <strong class="userinput"><code>ls (cd0)/isolinux</code></strong>
boot.cat boot.msg grub.conf initrd.img isolinux.bin isolinux.cfg memtest
splash.jpg TRANS.TBL vesamenu.c32 vmlinuz
grub&gt; <strong class="userinput"><code>linux (cd0)/isolinux/vmlinuz</code></strong>
grub&gt; <strong class="userinput"><code>initrd (cd0)/isolinux/initrd.img</code></strong>
grub&gt; <strong class="userinput"><code>boot</code></strong></pre><p xml:lang="en" lang="en">Now that the <span class="trademark">Linux</span>® kernel is loaded, the guest can be
	started:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,<em class="replaceable"><code>tap0</code></em> -s 3:0,virtio-blk,<em class="replaceable"><code>./linux.img</code></em> \
    -s 4:0,ahci-cd,<em class="replaceable"><code>./somelinux.iso</code></em> -l com1,stdio -c <em class="replaceable"><code>4</code></em> -m <em class="replaceable"><code>1024M</code></em> <em class="replaceable"><code>linuxguest</code></em></code></strong></pre><p xml:lang="en" lang="en">The system will boot and start the installer.  After
	installing a system in the virtual machine, reboot the virtual
	machine.  This will cause <span class="application">bhyve</span> to
	exit.  The instance of the virtual machine needs to be
	destroyed before it can be started again:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>bhyvectl --destroy --vm=<em class="replaceable"><code>linuxguest</code></em></code></strong></pre><p xml:lang="en" lang="en">Now the guest can be started directly from the virtual
	disk.  Load the kernel:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>grub-bhyve -m device.map -r hd0,msdos1 -M <em class="replaceable"><code>1024M</code></em> <em class="replaceable"><code>linuxguest</code></em></code></strong>
grub&gt; <strong class="userinput"><code>ls</code></strong>
(hd0) (hd0,msdos2) (hd0,msdos1) (cd0) (cd0,msdos1) (host)
(lvm/VolGroup-lv_swap) (lvm/VolGroup-lv_root)
grub&gt; <strong class="userinput"><code>ls (hd0,msdos1)/</code></strong>
lost+found/ grub/ efi/ System.map-2.6.32-431.el6.x86_64 config-2.6.32-431.el6.x
86_64 symvers-2.6.32-431.el6.x86_64.gz vmlinuz-2.6.32-431.el6.x86_64
initramfs-2.6.32-431.el6.x86_64.img
grub&gt; <strong class="userinput"><code>linux (hd0,msdos1)/vmlinuz-2.6.32-431.el6.x86_64 root=/dev/mapper/VolGroup-lv_root</code></strong>
grub&gt; <strong class="userinput"><code>initrd (hd0,msdos1)/initramfs-2.6.32-431.el6.x86_64.img</code></strong>
grub&gt; <strong class="userinput"><code>boot</code></strong></pre><p xml:lang="en" lang="en">Boot the virtual machine:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,<em class="replaceable"><code>tap0</code></em> \
    -s 3:0,virtio-blk,<em class="replaceable"><code>./linux.img</code></em> -l com1,stdio -c <em class="replaceable"><code>4</code></em> -m <em class="replaceable"><code>1024M</code></em> <em class="replaceable"><code>linuxguest</code></em></code></strong></pre><p xml:lang="en" lang="en"><span class="trademark">Linux</span>® will now boot in the virtual machine and
	eventually present you with the login prompt.  Login and use
	the virtual machine.  When you are finished, reboot the
	virtual machine to exit <span class="application">bhyve</span>.
	Destroy the virtual machine instance:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>bhyvectl --destroy --vm=<em class="replaceable"><code>linuxguest</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-bhyve-uefi"></a>21.7.4. 使用 <acronym class="acronym">UEFI</acronym> 韌體開機 <span class="application">bhyve</span> 虛擬機器</h3></div></div></div><p xml:lang="en" lang="en">In addition to <span class="application">bhyveload</span> and
	<span class="application">grub-bhyve</span>, the
	<span class="application">bhyve</span> hypervisor can also boot
	virtual machines using the <acronym class="acronym">UEFI</acronym> userspace
	firmware.  This option may support guest operating systems
	that are not supported by the other loaders.</p><p xml:lang="en" lang="en">In order to make use of the <acronym class="acronym">UEFI</acronym>
	support in <span class="application">bhyve</span>, first obtain the
	<acronym class="acronym">UEFI</acronym> firmware images.  This can be done by
	installing <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/bhyve-firmware/pkg-descr">sysutils/bhyve-firmware</a> port or
	package.</p><p xml:lang="en" lang="en">With the firmware in place, add the flags <code class="option">-l
	  bootrom,<em class="replaceable"><code>/path/to/firmware</code></em></code>
	to your <span class="application">bhyve</span> command line.  The
	actual <span class="application">bhyve</span> command may look like
	this:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>bhyve -AHP -s 0:0,hostbridge -s 1:0,lpc \
-s 2:0,virtio-net,<em class="replaceable"><code>tap1</code></em> -s 3:0,virtio-blk,<em class="replaceable"><code>./disk.img</code></em> \
-s 4:0,ahci-cd,<em class="replaceable"><code>./install.iso</code></em> -c <em class="replaceable"><code>4</code></em> -m <em class="replaceable"><code>1024M</code></em> \
-l bootrom,<em class="replaceable"><code>/usr/local/share/uefi-firmware/BHYVE_UEFI.fd</code></em> \
<em class="replaceable"><code>guest</code></em></code></strong></pre><p xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/bhyve-firmware/pkg-descr">sysutils/bhyve-firmware</a> also contains a
	<acronym class="acronym">CSM</acronym>-enabled firmware, to boot guests with
	no <acronym class="acronym">UEFI</acronym> support in legacy
	<acronym class="acronym">BIOS</acronym> mode:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>bhyve -AHP -s 0:0,hostbridge -s 1:0,lpc \
-s 2:0,virtio-net,<em class="replaceable"><code>tap1</code></em> -s 3:0,virtio-blk,<em class="replaceable"><code>./disk.img</code></em> \
-s 4:0,ahci-cd,<em class="replaceable"><code>./install.iso</code></em> -c <em class="replaceable"><code>4</code></em> -m <em class="replaceable"><code>1024M</code></em> \
-l bootrom,<em class="replaceable"><code>/usr/local/share/uefi-firmware/BHYVE_UEFI_CSM.fd</code></em> \
<em class="replaceable"><code>guest</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-bhyve-framebuffer"></a>21.7.5. 供 <span class="application">bhyve</span> 客端用的圖型化 <acronym class="acronym">UEFI</acronym> Framebuffer</h3></div></div></div><p xml:lang="en" lang="en">The <acronym class="acronym">UEFI</acronym> firmware support is
	particularly useful with predominantly graphical guest
	operating systems such as Microsoft <span class="trademark">Windows</span>®.</p><p xml:lang="en" lang="en">Support for the UEFI-GOP framebuffer may also be enabled
	with the <code class="option">-s
	  29,fbuf,tcp=<em class="replaceable"><code>0.0.0.0:5900</code></em></code>
	flags.  The framebuffer resolution may be configured with
	<code class="option">w=<em class="replaceable"><code>800</code></em></code> and
	<code class="option">h=<em class="replaceable"><code>600</code></em></code>, and
	<span class="application">bhyve</span> can be instructed to wait for
	a <acronym class="acronym">VNC</acronym> connection before booting the guest
	by adding <code class="option">wait</code>.  The framebuffer may be
	accessed from the host or over the network via the
	<acronym class="acronym">VNC</acronym> protocol.</p><p><span class="application">bhyve</span> 指令的結果會如下：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>bhyve -AHP -s 0:0,hostbridge -s 31:0,lpc \
-s 2:0,virtio-net,<em class="replaceable"><code>tap1</code></em> -s 3:0,virtio-blk,<em class="replaceable"><code>./disk.img</code></em> \
-s 4:0,ahci-cd,<em class="replaceable"><code>./install.iso</code></em> -c <em class="replaceable"><code>4</code></em> -m <em class="replaceable"><code>1024M</code></em> \
-s 29,fbuf,tcp=<em class="replaceable"><code>0.0.0.0:5900</code></em>,w=<em class="replaceable"><code>800</code></em>,h=<em class="replaceable"><code>600</code></em>,wait \
-l bootrom,<em class="replaceable"><code>/usr/local/share/uefi-firmware/BHYVE_UEFI.fd</code></em> \
<em class="replaceable"><code>guest</code></em></code></strong></pre><p xml:lang="en" lang="en">Note, in BIOS emulation mode, the framebuffer will cease
	receiving updates once control is passed from firmware to
	guest operating system.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-bhyve-zfs"></a>21.7.6. 在 <span class="application">bhyve</span> 客端使用 <acronym class="acronym">ZFS</acronym></h3></div></div></div><p xml:lang="en" lang="en">If <acronym class="acronym">ZFS</acronym> is available on the host
	machine, using <acronym class="acronym">ZFS</acronym> volumes
	instead of disk image files can provide significant
	performance benefits for the guest <acronym class="acronym">VMs</acronym>.  A
	<acronym class="acronym">ZFS</acronym> volume can be created by:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs create -V<em class="replaceable"><code>16G</code></em> -o volmode=dev <em class="replaceable"><code>zroot/linuxdisk0</code></em></code></strong></pre><p xml:lang="en" lang="en">When starting the <acronym class="acronym">VM</acronym>, specify the
	<acronym class="acronym">ZFS</acronym> volume as the disk drive:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,<em class="replaceable"><code>tap0</code></em> -s3:0,virtio-blk,<em class="replaceable"><code>/dev/zvol/zroot/linuxdisk0</code></em> \
    -l com1,<em class="replaceable"><code>stdio</code></em> -c <em class="replaceable"><code>4</code></em> -m <em class="replaceable"><code>1024M</code></em> <em class="replaceable"><code>linuxguest</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-bhyve-nmdm"></a>21.7.7. 虛擬機器 Console</h3></div></div></div><p xml:lang="en" lang="en">It is advantageous to wrap the
	<span class="application">bhyve</span> console in a session
	management tool such as <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/tmux/pkg-descr">sysutils/tmux</a> or
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/screen/pkg-descr">sysutils/screen</a> in order to detach and
	reattach to the console.  It is also possible to have the
	console of <span class="application">bhyve</span> be a null modem
	device that can be accessed with <code class="command">cu</code>.  To do
	this, load the <code class="filename">nmdm</code> kernel module and
	replace <code class="option">-l com1,stdio</code> with
	<code class="option">-l com1,/dev/nmdm0A</code>.  The
	<code class="filename">/dev/nmdm</code> devices are created
	automatically as needed, where each is a pair, corresponding
	to the two ends of the null modem cable
	(<code class="filename">/dev/nmdm0A</code> and
	<code class="filename">/dev/nmdm0B</code>).  See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=nmdm&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">nmdm</span>(4)</span></a> for more
	information.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload nmdm</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,<em class="replaceable"><code>tap0</code></em> -s 3:0,virtio-blk,<em class="replaceable"><code>./linux.img</code></em> \
    -l com1,<em class="replaceable"><code>/dev/nmdm0A</code></em> -c <em class="replaceable"><code>4</code></em> -m <em class="replaceable"><code>1024M</code></em> <em class="replaceable"><code>linuxguest</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cu -l <em class="replaceable"><code>/dev/nmdm0B</code></em></code></strong>
Connected

Ubuntu 13.10 handbook ttyS0

handbook login:</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-bhyve-managing"></a>21.7.8. 管理虛擬機器</h3></div></div></div><p xml:lang="en" lang="en">A device node is created in <code class="filename">/dev/vmm</code> for each virtual
	machine.  This allows the administrator to easily see a list
	of the running virtual machines:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ls -al /dev/vmm</code></strong>
total 1
dr-xr-xr-x   2 root  wheel    512 Mar 17 12:19 ./
dr-xr-xr-x  14 root  wheel    512 Mar 17 06:38 ../
crw-------   1 root  wheel  0x1a2 Mar 17 12:20 guestname
crw-------   1 root  wheel  0x19f Mar 17 12:19 linuxguest
crw-------   1 root  wheel  0x1a1 Mar 17 12:19 otherguest</pre><p xml:lang="en" lang="en">A specified virtual machine can be destroyed using
	<code class="command">bhyvectl</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>bhyvectl --destroy --vm=<em class="replaceable"><code>guestname</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-bhyve-onboot"></a>21.7.9. Persistent 設定</h3></div></div></div><p xml:lang="en" lang="en">In order to configure the system to start
	<span class="application">bhyve</span> guests at boot time, the
	following configurations must be made in the specified
	files:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p xml:lang="en" class="title" lang="en"><strong><code class="filename">/etc/sysctl.conf</code></strong></p><pre xml:lang="en" class="programlisting" lang="en">net.link.tap.up_on_open=1</pre></li><li class="step"><p xml:lang="en" class="title" lang="en"><strong><code class="filename">/etc/rc.conf</code></strong></p><pre xml:lang="en" class="programlisting" lang="en">cloned_interfaces="<em class="replaceable"><code>bridge0</code></em> <em class="replaceable"><code>tap0</code></em>"
ifconfig_bridge0="addm <em class="replaceable"><code>igb0</code></em> addm <em class="replaceable"><code>tap0</code></em>"
kld_list="nmdm vmm"</pre></li></ol></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="virtualization-host-xen"></a>21.8. 以 FreeBSD 作為主端安裝 <span class="trademark">Xen</span>™</h2></div></div></div><p xml:lang="en" lang="en"><span class="application">Xen</span> is a GPLv2-licensed <a class="link" href="https://en.wikipedia.org/wiki/Hypervisor#Classification" target="_top">type
	1 hypervisor</a> for <span class="trademark">Intel</span>® and <span class="trademark">ARM</span>® architectures.  FreeBSD
      has included <span class="trademark">i386</span>™ and <span class="trademark">AMD</span>® 64-Bit <a class="link" href="https://wiki.xenproject.org/wiki/DomU" target="_top">DomU</a>
      and <a class="link" href="https://en.wikipedia.org/wiki/Amazon_Elastic_Compute_Cloud" target="_top">Amazon
	EC2</a> unprivileged domain (virtual machine) support since
      FreeBSD 8.0 and includes Dom0 control domain (host) support in
      FreeBSD 11.0.  Support for para-virtualized (PV) domains has
      been removed from FreeBSD 11 in favor of hardware virtualized
      (HVM) domains, which provides better performance.</p><p xml:lang="en" lang="en"><span class="trademark">Xen</span>™ is a bare-metal hypervisor, which means that it is the
      first program loaded after the BIOS. A special privileged guest
      called the Domain-0 (<code class="literal">Dom0</code> for short) is then
      started.  The Dom0 uses its special privileges to directly
      access the underlying physical hardware, making it a
      high-performance solution.  It is able to access the disk
      controllers and network adapters directly.  The <span class="trademark">Xen</span>™ management
      tools to manage and control the <span class="trademark">Xen</span>™ hypervisor are also used
      by the Dom0 to create, list, and destroy VMs.  Dom0 provides
      virtual disks and networking for unprivileged domains, often
      called <code class="literal">DomU</code>.  <span class="trademark">Xen</span>™ Dom0 can be compared to
      the service console of other hypervisor solutions, while the
      DomU is where individual guest VMs are run.</p><p xml:lang="en" lang="en"><span class="trademark">Xen</span>™ can migrate VMs between different <span class="trademark">Xen</span>™ servers.  When
      the two xen hosts share the same underlying storage, the
      migration can be done without having to shut the VM down first.
      Instead, the migration is performed live while the DomU is
      running and there is no need to restart it or plan a downtime.
      This is useful in maintenance scenarios or upgrade windows to
      ensure that the services provided by the DomU are still
      provided.  Many more features of <span class="trademark">Xen</span>™ are listed on the <a class="link" href="https://wiki.xenproject.org/wiki/Category:Overview" target="_top">Xen
	Wiki Overview page</a>.  Note that not all features are
      supported on FreeBSD yet.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-host-xen-requirements"></a>21.8.1. <span class="trademark">Xen</span>™ Dom0 的硬體需求</h3></div></div></div><p xml:lang="en" lang="en">To run the <span class="trademark">Xen</span>™ hypervisor on a host, certain hardware
	functionality is required.  Hardware virtualized domains
	require Extended Page Table (<a class="link" href="http://en.wikipedia.org/wiki/Extended_Page_Table" target="_top">EPT</a>)
	and Input/Output Memory Management Unit (<a class="link" href="http://en.wikipedia.org/wiki/List_of_IOMMU-supporting_hardware" target="_top">IOMMU</a>)
	support in the host processor.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">In order to run a FreeBSD <span class="trademark">Xen</span>™ Dom0 the box must be
	  booted using legacy boot (BIOS).</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-host-xen-dom0-setup"></a>21.8.2. <span class="trademark">Xen</span>™ Dom0 控制領域安裝</h3></div></div></div><p xml:lang="en" lang="en">Users of FreeBSD 11 should install the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/emulators/xen-kernel47/pkg-descr">emulators/xen-kernel47</a> and
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/xen-tools47/pkg-descr">sysutils/xen-tools47</a> packages that are
	based on Xen version 4.7.  Systems running on FreeBSD-12.0 or
	newer can use Xen 4.11 provided by
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/emulators/xen-kernel411/pkg-descr">emulators/xen-kernel411</a> and
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/xen-tools411/pkg-descr">sysutils/xen-tools411</a>, respectively.</p><p xml:lang="en" lang="en">Configuration files must be edited to prepare the host
	for the Dom0 integration after the Xen packages are installed.
	An entry to <code class="filename">/etc/sysctl.conf</code> disables the
	limit on how many pages of memory are allowed to be wired.
	Otherwise, DomU VMs with higher memory requirements will not
	run.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>echo 'vm.max_wired=-1' &gt;&gt; /etc/sysctl.conf</code></strong></pre><p xml:lang="en" lang="en">Another memory-related setting involves changing
	<code class="filename">/etc/login.conf</code>, setting the
	<code class="literal">memorylocked</code> option to
	<code class="literal">unlimited</code>.  Otherwise, creating DomU
	domains may fail with <span class="errorname">Cannot allocate
	  memory</span> errors.  After making the change to
	<code class="filename">/etc/login.conf</code>, run
	<code class="command">cap_mkdb</code> to update the capability database.
	See <a class="xref" href="#security-resourcelimits" title="13.13. 限制資源">節 13.13, “限制資源”</a> for
	details.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sed -i '' -e 's/memorylocked=64K/memorylocked=unlimited/' /etc/login.conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cap_mkdb /etc/login.conf</code></strong></pre><p xml:lang="en" lang="en">Add an entry for the <span class="trademark">Xen</span>™ console to
	<code class="filename">/etc/ttys</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>echo 'xc0     "/usr/libexec/getty Pc"         xterm   onifconsole  secure' &gt;&gt; /etc/ttys</code></strong></pre><p xml:lang="en" lang="en">Selecting a <span class="trademark">Xen</span>™ kernel in
	<code class="filename">/boot/loader.conf</code> activates the Dom0.
	<span class="trademark">Xen</span>™ also requires resources like CPU and memory from the
	host machine for itself and other DomU domains.  How much CPU
	and memory depends on the individual requirements and hardware
	capabilities.  In this example, 8 GB of memory and 4
	virtual CPUs are made available for the Dom0. The serial
	console is also activated and logging options are
	defined.</p><p xml:lang="en" lang="en">The following command is used for Xen 4.7 packages:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /boot/loader.conf hw.pci.mcfg=0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /boot/loader.conf if_tap_load="YES"</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /boot/loader.conf xen_kernel="/boot/xen"</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /boot/loader.conf xen_cmdline="dom0_mem=<em class="replaceable"><code>8192M</code></em> dom0_max_vcpus=<em class="replaceable"><code>4</code></em> dom0pvh=1 console=com1,vga com1=115200,8n1 guest_loglvl=all loglvl=all"</code></strong></pre><p xml:lang="en" lang="en">For Xen versions 4.11 and higher, the following command
	should be used instead:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /boot/loader.conf if_tap_load="YES"</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /boot/loader.conf xen_kernel="/boot/xen"</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /boot/loader.conf xen_cmdline="dom0_mem=<em class="replaceable"><code>8192M</code></em> dom0_max_vcpus=<em class="replaceable"><code>4</code></em> dom0=pvh console=com1,vga com1=115200,8n1 guest_loglvl=all loglvl=all"</code></strong></pre><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Log files that <span class="trademark">Xen</span>™ creates for the DomU VMs
	    are stored in <code class="filename">/var/log/xen</code>.  Please
	    be sure to check the contents of that directory if
	    experiencing issues.</p></div><p xml:lang="en" lang="en">Activate the xencommons service during system
	  startup:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysrc xencommons_enable=yes</code></strong></pre><p xml:lang="en" lang="en">These settings are enough to start a Dom0-enabled
	  system.  However, it lacks network functionality for the
	  DomU machines.  To fix that, define a bridged interface with
	  the main NIC of the system which the DomU VMs can use to
	  connect to the network.  Replace
	  <em class="replaceable"><code>em0</code></em> with the host network
	  interface name.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysrc cloned_interfaces="bridge0"</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysrc ifconfig_bridge0="addm <em class="replaceable"><code>em0</code></em> SYNCDHCP"</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysrc ifconfig_<em class="replaceable"><code>em0</code></em>="up"</code></strong></pre><p xml:lang="en" lang="en">Restart the host to load the <span class="trademark">Xen</span>™ kernel and start the
	  Dom0.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>reboot</code></strong></pre><p xml:lang="en" lang="en">After successfully booting the <span class="trademark">Xen</span>™ kernel and logging
	  into the system again, the <span class="trademark">Xen</span>™ management tool
	  <code class="command">xl</code> is used to show information about the
	  domains.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>xl list</code></strong>
Name                                        ID   Mem VCPUs      State   Time(s)
Domain-0                                     0  8192     4     r-----     962.0</pre><p xml:lang="en" lang="en">The output confirms that the Dom0 (called
	  <code class="literal">Domain-0</code>) has the ID <code class="literal">0</code>
	  and is running.  It also has the memory and virtual CPUs
	  that were defined in <code class="filename">/boot/loader.conf</code>
	  earlier.  More information can be found in the <a class="link" href="https://www.xenproject.org/help/documentation.html" target="_top"><span class="trademark">Xen</span>™
	    Documentation</a>.  DomU guest VMs can now be
	  created.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-host-xen-domu-setup"></a>21.8.3. <span class="trademark">Xen</span>™ DomU 客端 VM 設置</h3></div></div></div><p xml:lang="en" lang="en">Unprivileged domains consist of a configuration file and
	  virtual or physical hard disks.  Virtual disk storage for
	  the DomU can be files created by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=truncate&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">truncate</span>(1)</span></a> or ZFS
	  volumes as described in <a class="xref" href="#zfs-zfs-volume" title="19.4.2. 建立與摧毀磁碟區">節 19.4.2, “建立與摧毀磁碟區”</a>.
	  In this example, a 20 GB volume is used.  A VM is
	  created with the ZFS volume, a FreeBSD ISO image, 1 GB of
	  RAM and two virtual CPUs.  The ISO installation file is
	  retrieved with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fetch&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fetch</span>(1)</span></a> and saved locally in a file
	  called <code class="filename">freebsd.iso</code>.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>fetch <em class="replaceable"><code>ftp://ftp.freebsd.org/pub/FreeBSD/releases/ISO-IMAGES/<em class="replaceable"><code>12.0</code></em>/FreeBSD-<em class="replaceable"><code>12.0</code></em>-RELEASE-amd64-bootonly.iso</code></em> -o <em class="replaceable"><code>freebsd.iso</code></em></code></strong></pre><p xml:lang="en" lang="en">A ZFS volume of 20 GB called
	<code class="filename">xendisk0</code> is created to serve as the disk
	space for the VM.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>zfs create -V20G -o volmode=dev zroot/xendisk0</code></strong></pre><p xml:lang="en" lang="en">The new DomU guest VM is defined in a file.  Some specific
	definitions like name, keymap, and VNC connection details are
	also defined.  The following <code class="filename">freebsd.cfg</code>
	contains a minimum DomU configuration for this example:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cat freebsd.cfg</code></strong>
builder = "hvm" <a id="co-xen-builder"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
name = "freebsd" <a id="co-xen-name"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
memory = 1024 <a id="co-xen-memory"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
vcpus = 2 <a id="co-xen-vcpus"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
vif = [ 'mac=00:16:3E:74:34:32,bridge=bridge0' ] <a id="co-xen-vif"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
disk = [
'/dev/zvol/tank/xendisk0,raw,hda,rw', <a id="co-xen-disk"></a><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span>
'/root/freebsd.iso,raw,hdc:cdrom,r' <a id="co-xen-cdrom"></a><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span>
  ]
vnc = 1 <a id="co-xen-vnc"></a><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span>
vnclisten = "0.0.0.0"
serial = "pty"
usbdevice = "tablet"</pre><p xml:lang="en" lang="en">These lines are explained in more detail:</p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-xen-builder"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">This defines what kind of virtualization to use.
	    <code class="literal">hvm</code> refers to hardware-assisted
	    virtualization or hardware virtual machine.  Guest
	    operating systems can run unmodified on CPUs with
	    virtualization extensions, providing nearly the same
	    performance as running on physical hardware.
	    <code class="literal">generic</code> is the default value and
	    creates a PV domain.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-xen-name"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">Name of this virtual machine to distinguish it from
	    others running on the same Dom0.  Required.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-xen-memory"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">Quantity of RAM in megabytes to make available to the
	    VM.  This amount is subtracted from the hypervisor's total
	    available memory, not the memory of the Dom0.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-xen-vcpus"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">Number of virtual CPUs available to the guest VM.  For
	    best performance, do not create guests with more virtual
	    CPUs than the number of physical CPUs on the host.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-xen-vif"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">Virtual network adapter.  This is the bridge connected
	    to the network interface of the host.  The
	    <code class="literal">mac</code> parameter is the MAC address set on
	    the virtual network interface.  This parameter is
	    optional, if no MAC is provided <span class="trademark">Xen</span>™ will generate a
	    random one.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-xen-disk"><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">Full path to the disk, file, or ZFS volume of the disk
	    storage for this VM.  Options and multiple disk
	    definitions are separated by commas.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-xen-cdrom"><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">Defines the Boot medium from which the initial
	    operating system is installed.  In this example, it is the
	    ISO imaged downloaded earlier.  Consult the <span class="trademark">Xen</span>™
	    documentation for other kinds of devices and options to
	    set.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-xen-vnc"><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">Options controlling VNC connectivity to the serial
	    console of the DomU.  In order, these are: active VNC
	    support, define IP address on which to listen, device node
	    for the serial console, and the input method for precise
	    positioning of the mouse and other input methods.
	    <code class="literal">keymap</code> defines which keymap to use, and
	    is <code class="literal">english</code> by default.</p></td></tr></table></div><p xml:lang="en" lang="en">After the file has been created with all the necessary
	options, the DomU is created by passing it to <code class="command">xl
	  create</code> as a parameter.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>xl create freebsd.cfg</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Each time the Dom0 is restarted, the configuration file
	  must be passed to <code class="command">xl create</code> again to
	  re-create the DomU.  By default, only the Dom0 is created
	  after a reboot, not the individual VMs.  The VMs can
	  continue where they left off as they stored the operating
	  system on the virtual disk.  The virtual machine
	  configuration can change over time (for example, when adding
	  more memory).  The virtual machine configuration files must
	  be properly backed up and kept available to be able to
	  re-create the guest VM when needed.</p></div><p xml:lang="en" lang="en">The output of <code class="command">xl list</code> confirms that the
	DomU has been created.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>xl list</code></strong>
Name                                        ID   Mem VCPUs      State   Time(s)
Domain-0                                     0  8192     4     r-----  1653.4
freebsd                                      1  1024     1     -b----   663.9</pre><p xml:lang="en" lang="en">To begin the installation of the base operating system,
	start the VNC client, directing it to the main network address
	of the host or to the IP address defined on the
	<code class="literal">vnclisten</code> line of
	<code class="filename">freebsd.cfg</code>.  After the operating system
	has been installed, shut down the DomU and disconnect the VNC
	viewer.  Edit <code class="filename">freebsd.cfg</code>, removing the
	line with the <code class="literal">cdrom</code> definition or
	commenting it out by inserting a <code class="literal">#</code>
	character at the beginning of the line.  To load this new
	configuration, it is necessary to remove the old DomU with
	<code class="command">xl destroy</code>, passing either the name or the
	id as the parameter.  Afterwards, recreate it using the
	modified <code class="filename">freebsd.cfg</code>.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>xl destroy freebsd</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>xl create freebsd.cfg</code></strong></pre><p xml:lang="en" lang="en">The machine can then be accessed again using the VNC
	viewer.  This time, it will boot from the virtual disk where
	the operating system has been installed and can be used as a
	virtual machine.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-host-xen-troubleshooting"></a>21.8.4. 疑難排解</h3></div></div></div><p xml:lang="en" lang="en">This section contains basic information in order to help
	troubleshoot issues found when using FreeBSD as a <span class="trademark">Xen</span>™ host or
	guest.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-host-xen-troubleshooting-host"></a>21.8.4.1. 主端開機疑難排解</h4></div></div></div><p xml:lang="en" lang="en">Please note that the following troubleshooting tips
	  are intended for <span class="trademark">Xen</span>™ 4.11 or newer.  If you are still
	  using <span class="trademark">Xen</span>™ 4.7 and having issues consider migrating to
	  a newer version of <span class="trademark">Xen</span>™.</p><p xml:lang="en" lang="en">In order to troubleshoot host boot issues you will
	  likely need a serial cable, or a debug USB cable.  Verbose
	  <span class="trademark">Xen</span>™ boot output can be obtained by adding options to the
	  <code class="literal">xen_cmdline</code> option found in
	  <code class="filename">loader.conf</code>.  A couple of relevant
	  debug options are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">iommu=debug</code>: can be used to print
	      additional diagnostic information about the
	      iommu.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">dom0=verbose</code>: can be used to
	      print additional diagnostic information about the
	      dom0 build process.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">sync_console</code>: flag to force
	      synchronous console output.  Useful for debugging to
	      avoid losing messages due to rate limiting.
	      Never use this option in production environments since
	      it can allow malicious guests to perform DoS attacks
	      against <span class="trademark">Xen</span>™ using the console.</p></li></ul></div><p xml:lang="en" lang="en">FreeBSD should also be booted in verbose mode in order
	  to identify any issues.  To activate verbose booting, run
	  this command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /boot/loader.conf boot_verbose="YES"</code></strong></pre><p xml:lang="en" lang="en">If none of these options help solving the problem,
	  please send the serial boot log to
	  <code class="email">&lt;<a xmlns="" class="email" href="mailto:freebsd-xen@FreeBSD.org">freebsd-xen@FreeBSD.org</a>&gt;</code> and
	  <code class="email">&lt;<a xmlns="" class="email" href="mailto:xen-devel@lists.xenproject.org">xen-devel@lists.xenproject.org</a>&gt;</code>
	  for further analysis.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-host-xen-troubleshooting-guest"></a>21.8.4.2. 客端建立疑難排解</h4></div></div></div><p xml:lang="en" lang="en">Issues can also arise when creating guests, the
	  following attempts to provide some help for those trying
	  to diagnose guest creation issues.</p><p xml:lang="en" lang="en">The most common cause of guest creation failures is the
	  <code class="literal">xl</code> command spitting some error and
	  exiting with a return code different than 0.  If the error
	  provided is not enough to help identify the issue, more
	  verbose output can also be obtained from
	  <code class="literal">xl</code> by using the <code class="literal">v</code>
	  option repeatedly.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>xl -vvv create freebsd.cfg</code></strong>
Parsing config from freebsd.cfg
libxl: debug: libxl_create.c:1693:do_domain_create: Domain 0:ao 0x800d750a0: create: how=0x0 callback=0x0 poller=0x800d6f0f0
libxl: debug: libxl_device.c:397:libxl__device_disk_set_backend: Disk vdev=xvda spec.backend=unknown
libxl: debug: libxl_device.c:432:libxl__device_disk_set_backend: Disk vdev=xvda, using backend phy
libxl: debug: libxl_create.c:1018:initiate_domain_create: Domain 1:running bootloader
libxl: debug: libxl_bootloader.c:328:libxl__bootloader_run: Domain 1:not a PV/PVH domain, skipping bootloader
libxl: debug: libxl_event.c:689:libxl__ev_xswatch_deregister: watch w=0x800d96b98: deregister unregistered
domainbuilder: detail: xc_dom_allocate: cmdline="", features=""
domainbuilder: detail: xc_dom_kernel_file: filename="/usr/local/lib/xen/boot/hvmloader"
domainbuilder: detail: xc_dom_malloc_filemap    : 326 kB
libxl: debug: libxl_dom.c:988:libxl__load_hvm_firmware_module: Loading BIOS: /usr/local/share/seabios/bios.bin
...</pre><p xml:lang="en" lang="en">If the verbose output does not help diagnose the issue
	  there are also QEMU and <span class="trademark">Xen</span>™ toolstack logs in
	  <code class="filename">/var/log/xen</code>.  Note that the name of
	  the domain is appended to the log name, so if the domain
	  is named <code class="literal">freebsd</code> you should find a
	  <code class="filename">/var/log/xen/xl-freebsd.log</code> and likely
	  a <code class="filename">/var/log/xen/qemu-dm-freebsd.log</code>.
	  Both log files can contain useful information for debugging.
	  If none of this helps solve the issue, please send the
	  description of the issue you are facing and as much
	  information as possible to
	  <code class="email">&lt;<a xmlns="" class="email" href="mailto:freebsd-xen@FreeBSD.org">freebsd-xen@FreeBSD.org</a>&gt;</code> and
	  <code class="email">&lt;<a xmlns="" class="email" href="mailto:xen-devel@lists.xenproject.org">xen-devel@lists.xenproject.org</a>&gt;</code> in order to
	  get help.</p></div></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="l10n"></a>章 22. 在地化 - <acronym class="acronym">i18n</acronym>/<acronym class="acronym">L10n</acronym> 使用與安裝</h2></div><div><span class="authorgroup">Contributed
	by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Andrey</span> <span class="surname">Chernov</span></span>. </span></div><div><span class="authorgroup">Rewritten
	by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Michael
	C.</span> <span class="surname">Wu</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#l10n-synopsis">22.1. 概述</a></span></dt><dt><span class="sect1"><a href="#using-localization">22.2. 使用語系</a></span></dt><dd><dl><dt><span class="sect2"><a href="#setting-locale">22.2.1. 設定登入 Shell 的語系</a></span></dt><dd><dl><dt><span class="sect3"><a href="#login-class">22.2.1.1. 登入類別 (Login Class) 法</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idp79884344">22.2.1.1.1. 變更登入類別的工具</a></span></dt></dl></dd><dt><span class="sect3"><a href="#startup-file">22.2.1.2. Shell 啟動檔 (Startup File) 法</a></span></dt></dl></dd><dt><span class="sect2"><a href="#setting-console">22.2.2. Console 設定</a></span></dt><dt><span class="sect2"><a href="#idp80000184">22.2.3. Xorg 設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#l10n-compiling">22.3. 尋找 <acronym class="acronym">i18n</acronym> 應用程式</a></span></dt><dt><span class="sect1"><a href="#lang-setup">22.4. 特定語言的語系設定</a></span></dt><dd><dl><dt><span class="sect2"><a href="#ru-localize">22.4.1. 俄語 (KOI8-R 編碼)</a></span></dt><dt><span class="sect2"><a href="#idp80136632">22.4.2. 其他特定語言資源</a></span></dt></dl></dd></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="l10n-synopsis"></a>22.1. 概述</h2></div></div></div><p>FreeBSD 計劃的使用者及貢獻者分佈在世界各地，也因此 FreeBSD 支援多語系，讓使用者可以使用非英文語言來檢視、輸入或處理資料。使用者可以選擇大多數主要語言，包含但不限於以下語言：中文、德文、日文、韓文、法文、俄文及越南文。</p><a id="idp79806520" class="indexterm"></a><a id="idp79807800" class="indexterm"></a><p><code class="literal">國際化</code> (Internationalization) 一詞可以縮寫為 <acronym class="acronym">i18n</acronym>，即  第一個字母到最後一個字母間的字母數量。<acronym class="acronym">L10n</acronym> 也使用同樣的命名規則，但源自 <code class="literal">在地化</code> (Localization)。 <acronym class="acronym">i18n</acronym>/<acronym class="acronym">L10n</acronym> 的方法、協定及應用程式讓使用者可以自己選擇使用的語言。</p><p>本章會討論 FreeBSD 的國際化及在地化功能。在閱讀本章之後，您會了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>語系名稱如何組成。</p></li><li class="listitem"><p>如何設定登入 Shell 的語系。</p></li><li class="listitem"><p>如何設定 Console 給非英文語言的使用者。</p></li><li class="listitem"><p>如果設定 <span class="application">Xorg</span> 使用不同語言。</p></li><li class="listitem"><p>如何找到支援 <acronym class="acronym">i18n</acronym> 的應用程式。</p></li><li class="listitem"><p>那裡可以找到更多設定特定語言的資訊。</p></li></ul></div><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>了解如何 <a class="link" href="#ports" title="章 4. 安裝應用程式：套件與 Port">安裝其他第三方應用程式</a>。</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="using-localization"></a>22.2. 使用語系</h2></div></div></div><a id="idp79819704" class="indexterm"></a><p>語系設定值由三個元件所組成：語言代號、城市代號及編碼。語系名稱組成的方式如下：</p><pre xml:lang="en" class="programlisting" lang="en"><em class="replaceable"><code>LanguageCode</code></em>_<em class="replaceable"><code>CountryCode</code></em>.<em class="replaceable"><code>Encoding</code></em></pre><a id="idp79822264" class="indexterm"></a><a id="idp79822904" class="indexterm"></a><p><em class="replaceable"><code>LanguageCode</code></em> 與 <em class="replaceable"><code>CountryCode</code></em> 用來表示城市及特定語言。<a class="xref" href="#locale-lang-country" title="表格 22.1. 常用語言及城市代碼">表格 22.1, “常用語言及城市代碼”</a> 提供了幾個 <em class="replaceable"><code>LanguageCode</code></em>_<em class="replaceable"><code>CountryCode</code></em> 的範例：</p><div class="table"><a id="locale-lang-country"></a><div class="table-title">表格 22.1. 常用語言及城市代碼</div><div class="table-contents"><table summary="常用語言及城市代碼" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>語言代號_城市代號</th><th>說明</th></tr></thead><tbody><tr><td xml:lang="en" lang="en">en_US</td><td>英文，美國</td></tr><tr><td xml:lang="en" lang="en">ru_RU</td><td>俄文，俄國</td></tr><tr><td xml:lang="en" lang="en">zh_TW</td><td>繁體中文，台灣</td></tr></tbody></table></div></div><br class="table-break" /><p>完整可用的語系清單可用以下指令查詢：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>locale -a | more</code></strong></pre><p>查詢目前使用的語系設定：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>locale</code></strong></pre><a id="idp79852344" class="indexterm"></a><a id="idp79852984" class="indexterm"></a><p>語言特定的字元集如 ISO8859-1, ISO8859-15, KOI8-R 及 CP437 在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=multibyte&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">multibyte</span>(3)</span></a> 有詳細說明。可用的字元集可在 <a class="link" href="http://www.iana.org/assignments/character-sets" target="_top">IANA Registry</a> 查詢。</p><p>某些語言，如中文或日文，無法使用 <acronym class="acronym">ASCII</acronym> 字元表示，會需要使用寬 (Wide) 字元或多位元組 (Multibyte) 字元來擴充的語言編碼。EUC 與 Big5 即是使用寬子元或多位元組字元的例子。舊的應用程式會誤判這些字元為控制字元，新的應用程式則通常可以辨識這些字元，依實作的需要，使用者可能需要開啟寬字元或多位元組字元支援或者使用正確的字元設定來編譯應用程式。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">FreeBSD 使用 Xorg 相容的語系編碼。</p></div><p>本節剩餘的部份將說明各種在 FreeBSD 系統上設定語系的方法。下一節將會探討如何尋找以及編譯使用 <acronym class="acronym">i18n</acronym> 支援的應用程式。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="setting-locale"></a>22.2.1. 設定登入 Shell 的語系</h3></div></div></div><p>語系設定可在使用者的 <code class="filename">~/.login_conf</code> 或使用者的 Shell 的啟動檔設定：<code class="filename">~/.profile</code>, <code class="filename">~/.bashrc</code> 或 <code class="filename">~/.cshrc</code>。</p><p>有兩個環境變數需要設定：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="envar">LANG</code> 用來設定語系<a id="idp79861688" class="indexterm"></a></p></li><li class="listitem"><a id="idp79862712" class="indexterm"></a><p><code class="envar">MM_CHARSET</code> 用來設定應用程式所使用的 <acronym class="acronym">MIME</acronym> 字元集</p></li></ul></div><p>除了使用者的 Shell 設定外，這些變數也應針對特定應用程式設定以及 <span class="application">Xorg</span> 設定。</p><a id="idp79865400" class="indexterm"></a><a id="idp79870136" class="indexterm"></a><p>兩種可以完成所需變數設定的方法有：<a class="link" href="#login-class" title="22.2.1.1. 登入類別 (Login Class) 法">登入類別 (Login class)</a> 法 (較建議) 及 <a class="link" href="#startup-file" title="22.2.1.2. Shell 啟動檔 (Startup File) 法">啟動檔 (Startup file) </a> 法。以下兩節將示範如何使用這兩個方法。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="login-class"></a>22.2.1.1. 登入類別 (Login Class) 法</h4></div></div></div><p>第一種方式，同時也是建議使用的方法，它可以對任何可能的 Shell 設定需要的語系及 MIME 字元集變數。此設定也可由每位使用者自行設定或者由超級管理者為所有使用者設定。</p><p>以下精簡範例示範在一個使用者的家目錄中的 <code class="filename">.login_conf</code> 設定 Latin-1 編碼使用的兩個環境變數：</p><pre xml:lang="en" class="programlisting" lang="en">me:\
	:charset=ISO-8859-1:\
	:lang=de_DE.ISO8859-1:</pre><a id="idp79874744" class="indexterm"></a><p>以下使用者的 <code class="filename">~/.login_conf</code> 範例設定了繁體中文於 BIG-5 編碼使用到的環境變數。有一部份應用程式無法正確處理中文、日文及韓文的語系變數，因此需要額外多做一些設定：</p><pre xml:lang="en" class="programlisting" lang="en">#Users who do not wish to use monetary units or time formats
#of Taiwan can manually change each variable
me:\
	:lang=zh_TW.Big5:\
	:setenv=LC_ALL=zh_TW.Big5,LC_COLLATE=zh_TW.Big5,LC_CTYPE=zh_TW.Big5,LC_MESSAGES=zh_TW.Big5,LC_MONETARY=zh_TW.Big5,LC_NUMERIC=zh_TW.Big5,LC_TIME=zh_TW.Big5:\
	:charset=big5:\
	:xmodifiers="@im=gcin": #Set gcin as the XIM Input Server</pre><p>或者，超級使用者可以設定所有系統使用者的語系。以下在 <code class="filename">/etc/login.conf</code> 中的變數可用來設定語系及 <acronym class="acronym">MIME</acronym> 字元集：</p><pre xml:lang="en" class="programlisting" lang="en"><em class="replaceable"><code>language_name</code></em>|<em class="replaceable"><code>Account Type Description</code></em>:\
	:charset=<em class="replaceable"><code>MIME_charset</code></em>:\
	:lang=<em class="replaceable"><code>locale_name</code></em>:\
	:tc=default:</pre><p>若套用之前的 Latin-1 編碼範例如下：</p><pre xml:lang="en" class="programlisting" lang="en">german|German Users Accounts:\
	:charset=ISO-8859-1:\
	:lang=de_DE.ISO8859-1:\
	:tc=default:</pre><p>請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">login.conf</span>(5)</span></a> 以取得更多有關這些變數的詳細資訊。請注意，它已經含有預先定義的 <em class="replaceable"><code>russian</code></em> class。</p><p>每次編輯 <code class="filename">/etc/login.conf</code> 之後，請記得要執行以下指令來更新登入類別的能力資料庫(Capability database)：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cap_mkdb /etc/login.conf</code></strong></pre><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79884344"></a>22.2.1.1.1. 變更登入類別的工具</h5></div></div></div><a id="idp79884984" class="indexterm"></a><p>除了手動編輯 <code class="filename">/etc/login.conf</code> 之外，尚有需多工具可用來為新建立的使用者設定語系。</p><p>當使用 <code class="command">vipw</code> 來新增使用者時，可指定 <em class="replaceable"><code>language</code></em> 來設定語系：</p><pre xml:lang="en" class="programlisting" lang="en">user:password:1111:11:<em class="replaceable"><code>language</code></em>:0:0:User Name:/home/user:/bin/sh</pre><a id="idp79892920" class="indexterm"></a><a id="idp79893944" class="indexterm"></a><p>當使用 <code class="command">adduser</code> 來新增使用者時，可對所有使用者或指定的使用者事先設定預設的語言。</p><p>若所有新的使用者都使用同樣的語言，可在 <code class="filename">/etc/adduser.conf</code> 設定 <code class="literal">defaultclass=<em class="replaceable"><code>language</code></em></code>。</p><p>要在建立使用者時覆蓋預設的設定，可在出現此提示時輸入需要的語系：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">Enter login class: default []:</code></pre><p>或執行 <code class="command">adduser</code> 時指定語系：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>adduser -class <em class="replaceable"><code>language</code></em></code></strong></pre><a id="idp79457464" class="indexterm"></a><p>若使用 <code class="command">pw</code> 來新增使用者，則可指定語系如下：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pw useradd <em class="replaceable"><code>user_name</code></em> -L <em class="replaceable"><code>language</code></em></code></strong></pre><p xml:lang="en" lang="en">To change the login class of an existing user,
	    <code class="command">chpass</code> can be used.  Invoke it as
	    superuser and provide the username to edit as the
	    argument.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>chpass <em class="replaceable"><code>user_name</code></em></code></strong></pre></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="startup-file"></a>22.2.1.2. Shell 啟動檔 (Startup File) 法</h4></div></div></div><p>第二種方法，較不建議使用，因每一種使用到的 Shell 都需要手動設定，而每一種 Shell 都有不同的設定檔以及語法。例如將一位使用者的 <code class="command">sh</code> shell 設定為德語，需要將下列行加到 <code class="filename">~/.profile</code>，若要設定給使用該 Shell 的所有使用者則必須將下列行加到 <code class="filename">/etc/profile</code> 或 <code class="filename">/usr/share/skel/dot.profile</code>：</p><pre xml:lang="en" class="programlisting" lang="en"><code class="envar">LANG</code>=de_DE.ISO8859-1; export <code class="envar">LANG</code>
<code class="envar">MM_CHARSET</code>=ISO-8859-1; export <code class="envar">MM_CHARSET</code></pre><p>然而，在 <code class="command">csh</code> shell 所使用的設定檔名稱及語法不同。同樣的設定需加入下列行至 <code class="filename">~/.csh.login</code>, <code class="filename">/etc/csh.login</code> 或 <code class="filename">/usr/share/skel/dot.login</code>：</p><pre xml:lang="en" class="programlisting" lang="en">setenv <code class="envar">LANG</code> de_DE.ISO8859-1
setenv <code class="envar">MM_CHARSET</code> ISO-8859-1</pre><p>更複雜一點的情況，<span class="application">Xorg</span> 的 <code class="filename">~/.xinitrc</code> 語系設定會依使用的 Shell 而有所不同。第一個例子是針對 <code class="command">sh</code> shell 而第二個則是針對 <code class="command">csh</code> shell：</p><pre xml:lang="en" class="programlisting" lang="en"><code class="envar">LANG</code>=de_DE.ISO8859-1; export <code class="envar">LANG</code></pre><pre xml:lang="en" class="programlisting" lang="en">setenv <code class="envar">LANG</code> de_DE.ISO8859-1</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="setting-console"></a>22.2.2. Console 設定</h3></div></div></div><p>已有許多語系的字型可在 Console 使用，要查看可用的字型清單，可輸入 <code class="command">ls /usr/share/syscons/fonts</code>。要設定 Console 的字型，可在 <code class="filename">/etc/rc.conf</code> 指定去掉 <code class="filename">.fnt</code> 字尾的字型名稱 <em class="replaceable"><code>font_name</code></em>：</p><pre xml:lang="en" class="programlisting" lang="en">font8x16=<em class="replaceable"><code>font_name</code></em>
font8x14=<em class="replaceable"><code>font_name</code></em>
font8x8=<em class="replaceable"><code>font_name</code></em></pre><a id="idp79925816" class="indexterm"></a><a id="idp79926456" class="indexterm"></a><p>鍵盤對應表 (Keymap) 及螢幕對應表 (Screenmap) 用可加入下行到 <code class="filename">/etc/rc.conf</code> 來設定：</p><pre xml:lang="en" class="programlisting" lang="en">scrnmap=<em class="replaceable"><code>screenmap_name</code></em>
keymap=<em class="replaceable"><code>keymap_name</code></em>
keychange="<em class="replaceable"><code>fkey_number sequence</code></em>"</pre><p>要查看可用的螢幕對應表，可輸入 <code class="command">ls /usr/share/syscons/scrnmaps</code>。在設定螢幕對應表 <em class="replaceable"><code>screenmap_name</code></em> 時請去掉 <code class="filename">.scm</code> 字尾。在 VGA Adapter 的字型字元矩陣擴充位元 8 到位元 9 時會需要使用螢幕對應表與相關的字型對應來解決，因此若螢幕字型使用位元 8 的欄位，字母會移出虛擬繪圖區 (Pseudographics area)。</p><p>要查看可用的鍵盤對應表，可輸入 <code class="command">ls /usr/share/syscons/keymaps</code>。在設定鍵盤對應表 <em class="replaceable"><code>keymap_name</code></em> 時請去掉 <code class="filename">.kbd</code> 字尾。若要不重開機測試鍵盤對應用可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kbdmap&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kbdmap</span>(1)</span></a>。</p><p><code class="literal">keychange</code> 項目用在當功能鍵序列無法定義在鍵盤對應表時，可設定對應選擇終對機類型的功能鍵。</p><p>接下來，在 <code class="filename">/etc/ttys</code> 為所有虛擬終端機項目設定正確的 Console 終端機類型。<a class="xref" href="#locale-charset" title="表格 22.2. 已定義供特定字元集使用的終端機類型">表格 22.2, “已定義供特定字元集使用的終端機類型”</a> 摘要了可用的終端機類型：</p><div class="table"><a id="locale-charset"></a><div class="table-title">表格 22.2. 已定義供特定字元集使用的終端機類型</div><div class="table-contents"><table summary="已定義供特定字元集使用的終端機類型" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>字元集</th><th>終端機類型</th></tr></thead><tbody><tr><td xml:lang="en" lang="en">ISO8859-1 or ISO8859-15</td><td xml:lang="en" lang="en"><code class="literal">cons25l1</code></td></tr><tr><td xml:lang="en" lang="en">ISO8859-2</td><td xml:lang="en" lang="en"><code class="literal">cons25l2</code></td></tr><tr><td xml:lang="en" lang="en">ISO8859-7</td><td xml:lang="en" lang="en"><code class="literal">cons25l7</code></td></tr><tr><td xml:lang="en" lang="en">KOI8-R</td><td xml:lang="en" lang="en"><code class="literal">cons25r</code></td></tr><tr><td xml:lang="en" lang="en">KOI8-U</td><td xml:lang="en" lang="en"><code class="literal">cons25u</code></td></tr><tr><td>CP437 (VGA 預設值)</td><td xml:lang="en" lang="en"><code class="literal">cons25</code></td></tr><tr><td xml:lang="en" lang="en">US-ASCII</td><td xml:lang="en" lang="en"><code class="literal">cons25w</code></td></tr></tbody></table></div></div><br class="table-break" /><a id="idp79978168" class="indexterm"></a><p>對於使用寬字元或多位元組字元的語言，需從 Port 套件集安裝支援該語言的 Console。 可用的 Port 摘要在 <a class="xref" href="#locale-console" title="表格 22.3. Port 套件集中可用的 Console">表格 22.3, “Port 套件集中可用的 Console”</a>。安裝完成之後，請參考 Port 的 <code class="filename">pkg-message</code> 或操作手冊來取得設定及使用說明。</p><div class="table"><a id="locale-console"></a><div class="table-title">表格 22.3. Port 套件集中可用的 Console</div><div class="table-contents"><table summary="Port 套件集中可用的 Console" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>語言</th><th>Port 位置</th></tr></thead><tbody><tr><td>繁體中文 (BIG-5)</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/big5con/pkg-descr">chinese/big5con</a></td></tr><tr><td>中文/日文/韓文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/cce/pkg-descr">chinese/cce</a></td></tr><tr><td>中文/日文/韓文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/zhcon/pkg-descr">chinese/zhcon</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/kon2/pkg-descr">chinese/kon2</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/kon2-14dot/pkg-descr">japanese/kon2-14dot</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/kon2-16dot/pkg-descr">japanese/kon2-16dot</a></td></tr></tbody></table></div></div><br class="table-break" /><p>若在 <code class="filename">/etc/rc.conf</code> 有開啟 <span class="application">moused</span>，可能會需要額外的設定。預設 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syscons&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syscons</span>(4)</span></a> 驅動程式的滑鼠游標會佔用字元集 <code class="literal">0xd0</code>-<code class="literal">0xd3</code> 的範圍，若語言有使用到此範圍，可加入以下行到 <code class="filename">/etc/rc.conf</code> 來移動游標的範圍：</p><pre xml:lang="en" class="programlisting" lang="en">mousechar_start=3</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80000184"></a>22.2.3. Xorg 設定</h3></div></div></div><p><a class="xref" href="#x11" title="章 5. X Window 系統">章 5, <em>X Window 系統</em></a> 會說明如何安裝並設定 <span class="application">Xorg</span>。當要設定 <span class="application">Xorg</span> 在地化時，可從 FreeBSD Port 套件集中取得其他可用的字型及輸入法。應用程式特定的 <acronym class="acronym">i18n</acronym> 設定像是字型與選單，可以在 <code class="filename">~/.Xresources</code> 中調校且可允許使用者在圖型化應用程式選單檢視其所選擇的語言。</p><a id="idp80003000" class="indexterm"></a><p>X 輸入法 (X Input Method, <acronym class="acronym">XIM</acronym>) 協定是 <span class="application">Xorg</span> 針對輸入非英語字元的標準。<a class="xref" href="#locale-xim" title="表格 22.4. 可用的輸入法">表格 22.4, “可用的輸入法”</a> 摘要了在 FreeBSD 套件集中可用的輸入法應用程式。也可使用其他如 Fcitx 及 Uim 應用程式。</p><div class="table"><a id="locale-xim"></a><div class="table-title">表格 22.4. 可用的輸入法</div><div class="table-contents"><table summary="可用的輸入法" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>語言</th><th>輸入法</th></tr></thead><tbody><tr><td>中文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/gcin/pkg-descr">chinese/gcin</a></td></tr><tr><td>中文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/ibus-chewing/pkg-descr">chinese/ibus-chewing</a></td></tr><tr><td>中文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/ibus-pinyin/pkg-descr">chinese/ibus-pinyin</a></td></tr><tr><td>中文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/oxim/pkg-descr">chinese/oxim</a></td></tr><tr><td>中文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/scim-fcitx/pkg-descr">chinese/scim-fcitx</a></td></tr><tr><td>中文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/scim-pinyin/pkg-descr">chinese/scim-pinyin</a></td></tr><tr><td>中文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/scim-tables/pkg-descr">chinese/scim-tables</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/ibus-anthy/pkg-descr">japanese/ibus-anthy</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/ibus-mozc/pkg-descr">japanese/ibus-mozc</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/ibus-skk/pkg-descr">japanese/ibus-skk</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/im-ja/pkg-descr">japanese/im-ja</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/kinput2/pkg-descr">japanese/kinput2</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-anthy/pkg-descr">japanese/scim-anthy</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-canna/pkg-descr">japanese/scim-canna</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-honoka/pkg-descr">japanese/scim-honoka</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-honoka-plugin-romkan/pkg-descr">japanese/scim-honoka-plugin-romkan</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-honoka-plugin-wnn/pkg-descr">japanese/scim-honoka-plugin-wnn</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-prime/pkg-descr">japanese/scim-prime</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-skk/pkg-descr">japanese/scim-skk</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-tables/pkg-descr">japanese/scim-tables</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-tomoe/pkg-descr">japanese/scim-tomoe</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-uim/pkg-descr">japanese/scim-uim</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/skkinput/pkg-descr">japanese/skkinput</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/skkinput3/pkg-descr">japanese/skkinput3</a></td></tr><tr><td>日文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/uim-anthy/pkg-descr">japanese/uim-anthy</a></td></tr><tr><td>韓文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/korean/ibus-hangul/pkg-descr">korean/ibus-hangul</a></td></tr><tr><td>韓文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/korean/imhangul/pkg-descr">korean/imhangul</a></td></tr><tr><td>韓文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/korean/nabi/pkg-descr">korean/nabi</a></td></tr><tr><td>韓文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/korean/scim-hangul/pkg-descr">korean/scim-hangul</a></td></tr><tr><td>韓文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/korean/scim-tables/pkg-descr">korean/scim-tables</a></td></tr><tr><td>越南文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/vietnamese/xvnkb/pkg-descr">vietnamese/xvnkb</a></td></tr><tr><td>越南文</td><td xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/vietnamese/x-unikey/pkg-descr">vietnamese/x-unikey</a></td></tr></tbody></table></div></div><br class="table-break" /></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="l10n-compiling"></a>22.3. 尋找 <acronym class="acronym">i18n</acronym> 應用程式</h2></div></div></div><p><acronym class="acronym">i18n</acronym> 應用程式會使用 <acronym class="acronym">i18n</acronym> 工具包做為程式庫開發。這讓開發人員可以寫一個簡單的檔案並翻譯顯示的選單及文字至各種語言。</p><p><a class="link" href="../../../../ports/index.html" target="_top">FreeBSD Port 套件集</a>中含有許多內建支援寬字元或多位元組字元的應用程式可支援各種語言。該類型的應用程式在名稱上會註明 <code class="literal">i18n</code> 以易於辨識。雖然如此，但不一定支援您所需要的語言。</p><p>有一部份應用程式可以使用指定的字元集來編譯。通常會在 Port 的 <code class="filename">Makefile</code> 中設定，或者傳送參數給 <span class="application">configure</span>。請參考各 FreeBSD Port 原始碼中的 <acronym class="acronym">i18n</acronym> 說明文件以取得更多有關需要的設定值資訊或 Port 的 <code class="filename">Makefile</code> 來了解在編譯時有那些可以使用的編譯選項。</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="lang-setup"></a>22.4. 特定語言的語系設定</h2></div></div></div><p xml:lang="en" lang="en">This section provides configuration examples for localizing
      a FreeBSD system for the Russian language.  It then provides some
      additional resources for localizing other languages.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ru-localize"></a>22.4.1. 俄語 (KOI8-R 編碼)</h3></div><div><span class="authorgroup">Originally
	    contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Andrey</span> <span class="surname">Chernov</span></span>. </span></div></div></div><a id="idp79756728" class="indexterm"></a><p xml:lang="en" lang="en">This section shows the specific settings needed to
	localize a FreeBSD system for the Russian language.  Refer to
	<a class="link" href="#using-localization" title="22.2. 使用語系">Using Localization</a>
	for a more complete description of each type of
	setting.</p><p xml:lang="en" lang="en">To set this locale for the login shell, add the following
	lines to each user's
	<code class="filename">~/.login_conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">me:My Account:\
	:charset=KOI8-R:\
	:lang=ru_RU.KOI8-R:</pre><p xml:lang="en" lang="en">To configure the console, add the following lines to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">keymap="ru.koi8-r"
scrnmap="koi8-r2cp866"
font8x16="cp866b-8x16"
font8x14="cp866-8x14"
font8x8="cp866-8x8"
mousechar_start=3</pre><p xml:lang="en" lang="en">For each <code class="literal">ttyv</code> entry in
	<code class="filename">/etc/ttys</code>, use
	<code class="literal">cons25r</code> as the terminal type.</p><a id="idp80095544" class="indexterm"></a><p xml:lang="en" lang="en">To configure printing, a special output filter is needed
	to convert from KOI8-R to CP866 since most printers with
	Russian characters come with hardware code page CP866.  FreeBSD
	includes a default filter for this purpose,
	<code class="filename">/usr/libexec/lpr/ru/koi2alt</code>.  To use this
	filter, add this entry to
	<code class="filename">/etc/printcap</code>:</p><pre xml:lang="en" class="programlisting" lang="en">lp|Russian local line printer:\
	:sh:of=/usr/libexec/lpr/ru/koi2alt:\
	:lp=/dev/lpt0:sd=/var/spool/output/lpd:lf=/var/log/lpd-errs:</pre><p xml:lang="en" lang="en">Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=printcap&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">printcap</span>(5)</span></a> for a more detailed
	explanation.</p><p xml:lang="en" lang="en">To configure support for Russian filenames in mounted
	<span class="trademark">MS-DOS</span>® file systems, include <code class="option">-L</code> and the
	locale name when adding an entry to
	<code class="filename">/etc/fstab</code>:</p><pre xml:lang="en" class="programlisting" lang="en">/dev/ad0s2      /dos/c  msdos   rw,-Lru_RU.KOI8-R 0 0</pre><p xml:lang="en" lang="en">Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount_msdosfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount_msdosfs</span>(8)</span></a> for more details.</p><p xml:lang="en" lang="en">To configure Russian fonts for
	<span class="application">Xorg</span>, install the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11-fonts/xorg-fonts-cyrillic/pkg-descr">x11-fonts/xorg-fonts-cyrillic</a> package.
	Then, check the <code class="literal">"Files"</code> section in
	<code class="filename">/etc/X11/xorg.conf</code>.  The following line
	must be added <span class="emphasis"><em>before</em></span> any other
	<code class="literal">FontPath</code> entries:</p><pre xml:lang="en" class="programlisting" lang="en">FontPath   "/usr/local/lib/X11/fonts/cyrillic"</pre><p xml:lang="en" lang="en">Additional Cyrillic fonts are available in the Ports
	Collection.</p><p xml:lang="en" lang="en">To activate a Russian keyboard, add the following to the
	<code class="literal">"Keyboard"</code> section of
	<code class="filename">/etc/xorg.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">Option "XkbLayout"   "us,ru"
Option "XkbOptions"  "grp:toggle"</pre><p xml:lang="en" lang="en">Make sure that <code class="literal">XkbDisable</code> is
	commented out in that file.</p><p xml:lang="en" lang="en">For <code class="literal">grp:toggle</code> use
	<span class="keycap"><strong>Right Alt</strong></span>, for
	<code class="literal">grp:ctrl_shift_toggle</code> use <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Shift</strong></span>.
	For <code class="literal">grp:caps_toggle</code> use
	<span class="keycap"><strong>CapsLock</strong></span>.  The old
	<span class="keycap"><strong>CapsLock</strong></span> function is still available in LAT
	mode only using <span class="keycap"><strong>Shift</strong></span>+<span class="keycap"><strong>CapsLock</strong></span>.
	<code class="literal">grp:caps_toggle</code> does not work in
	<span class="application">Xorg</span> for some unknown
	reason.</p><p xml:lang="en" lang="en">If the keyboard has <span class="quote">“<span class="quote"><span class="trademark">Windows</span>®</span>”</span> keys, and
	some non-alphabetical keys are mapped incorrectly, add the
	following line to <code class="filename">/etc/xorg.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">Option "XkbVariant" ",winkeys"</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The Russian XKB keyboard may not work with
	  non-localized applications.  Minimally localized
	  applications should call a <code class="function">XtSetLanguageProc
	    (NULL, NULL, NULL);</code> function early in the
	  program.</p></div><p xml:lang="en" lang="en">See <code class="uri"><a class="uri" href="http://koi8.pp.ru/xwin.html" target="_top">http://koi8.pp.ru/xwin.html</a></code>
	for more instructions on localizing
	<span class="application">Xorg</span> applications.  For more
	general information about KOI8-R encoding, refer to <code class="uri"><a class="uri" href="http://koi8.pp.ru/" target="_top">http://koi8.pp.ru/</a></code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80136632"></a>22.4.2. 其他特定語言資源</h3></div></div></div><p xml:lang="en" lang="en">This section lists some additional resources for
	configuring other locales.</p><a id="idp80137784" class="indexterm"></a><a id="idp80139064" class="indexterm"></a><a id="idp80140344" class="indexterm"></a><a id="idp80141624" class="indexterm"></a><a id="idp80142904" class="indexterm"></a><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en">Traditional Chinese for Taiwan</span></dt><dd><p xml:lang="en" lang="en">The FreeBSD-Taiwan Project has a Chinese HOWTO for FreeBSD
	      at <code class="uri"><a class="uri" href="http://netlab.cse.yzu.edu.tw/~statue/freebsd/zh-tut/" target="_top">http://netlab.cse.yzu.edu.tw/~statue/freebsd/zh-tut/</a></code>.</p></dd><dt><span xml:lang="en" class="term" lang="en">Greek Language Localization</span></dt><dd><p xml:lang="en" lang="en">A complete article on Greek support in FreeBSD
	      is available <a class="link" href="../../../../doc/el_GR.ISO8859-7/articles/greek-language-support/index.html" target="_top">here</a>,
	      in Greek only, as part of the official FreeBSD Greek
	      documentation.</p></dd><dt><span xml:lang="en" class="term" lang="en">Japanese and Korean Language Localization</span></dt><dd><p xml:lang="en" lang="en">For Japanese, refer to <code class="uri"><a class="uri" href="http://www.jp.FreeBSD.org/" target="_top">http://www.jp.FreeBSD.org/</a></code>,
	      and for Korean, refer to <code class="uri"><a class="uri" href="http://www.kr.FreeBSD.org/" target="_top">http://www.kr.FreeBSD.org/</a></code>.</p></dd><dt><span xml:lang="en" class="term" lang="en">Non-English FreeBSD Documentation</span></dt><dd><p xml:lang="en" lang="en">Some FreeBSD contributors have translated parts of the
	      FreeBSD documentation to other languages.  They are
	      available through links on the <a class="link" href="../../../../index.html" target="_top">FreeBSD web
		site</a> or in
	      <code class="filename">/usr/share/doc</code>.</p></dd></dl></div></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-upgrading"></a>章 23. 更新與升級 FreeBSD</h2></div><div><span class="authorgroup">Restructured, reorganized, and parts updated
	  by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Jim</span> <span class="surname">Mock</span></span>. </span></div><div><span class="authorgroup">Original work by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Jordan</span> <span class="surname">Hubbard</span></span>, <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Poul-Henning</span> <span class="surname">Kamp</span></span>, <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">John</span> <span class="surname">Polstra</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Nik</span> <span class="surname">Clayton</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#updating-upgrading-synopsis">23.1. 概述</a></span></dt><dt><span class="sect1"><a href="#updating-upgrading-freebsdupdate">23.2. FreeBSD 更新</a></span></dt><dd><dl><dt><span class="sect2"><a href="#freebsdupdate-config-file">23.2.1. 設定檔</a></span></dt><dt><span class="sect2"><a href="#freebsdupdate-security-patches">23.2.2. 套用安全性修補</a></span></dt><dt><span class="sect2"><a href="#freebsdupdate-upgrade">23.2.3. 執行主要及次要版號升級</a></span></dt><dd><dl><dt><span class="sect3"><a href="#freebsd-update-custom-kernel-9x">23.2.3.1. 在 FreeBSD 9.X 及之後版本自訂核心</a></span></dt><dt><span class="sect3"><a href="#freebsdupdate-portsrebuild">23.2.3.2. 主要版號升級後的套件升級</a></span></dt></dl></dd><dt><span class="sect2"><a href="#freebsdupdate-system-comparison">23.2.4. 比對系統狀態</a></span></dt></dl></dd><dt><span class="sect1"><a href="#updating-upgrading-documentation">23.3. 更新文件集</a></span></dt><dd><dl><dt><span class="sect2"><a href="#updating-installed-documentation">23.3.1. 自原始碼更新說明文件</a></span></dt><dt><span class="sect2"><a href="#doc-ports-install-package">23.3.2. 自 Port 更新說明文件</a></span></dt></dl></dd><dt><span class="sect1"><a href="#current-stable">23.4. 追蹤開發分支</a></span></dt><dd><dl><dt><span class="sect2"><a href="#current">23.4.1. 使用 FreeBSD-CURRENT</a></span></dt><dt><span class="sect2"><a href="#stable">23.4.2. 使用 FreeBSD-STABLE</a></span></dt></dl></dd><dt><span class="sect1"><a href="#makeworld">23.5. 從原始碼更新 FreeBSD</a></span></dt><dd><dl><dt><span class="sect2"><a href="#updating-src-quick-start">23.5.1. 快速開始</a></span></dt><dt><span class="sect2"><a href="#updating-src-preparing">23.5.2. 準備原始碼更新</a></span></dt><dt><span class="sect2"><a href="#updating-src-obtaining-src">23.5.3. 更新原始碼</a></span></dt><dt><span class="sect2"><a href="#updating-src-building">23.5.4. 從原始碼編譯</a></span></dt><dd><dl><dt><span class="sect3"><a href="#updating-src-building-clean-build">23.5.4.1. 執行清除編譯</a></span></dt><dt><span class="sect3"><a href="#updating-src-building-jobs">23.5.4.2. 設定工作數量</a></span></dt><dt><span class="sect3"><a href="#updating-src-building-only-kernel">23.5.4.3. 只編譯核心</a></span></dt><dt><span class="sect3"><a href="#updating-src-building-custom-kernel">23.5.4.4. 編譯自訂核心</a></span></dt></dl></dd><dt><span class="sect2"><a href="#updating-src-installing">23.5.5. 安裝編譯好的程式</a></span></dt><dt><span class="sect2"><a href="#updating-src-completing">23.5.6. 完成更新</a></span></dt><dd><dl><dt><span class="sect3"><a href="#updating-src-completing-merge-mergemaster">23.5.6.1. 使用 mergemaster(8) 合併設定檔案</a></span></dt><dt><span class="sect3"><a href="#updating-src-completing-check-old">23.5.6.2. 檢查過時的檔案與程式庫</a></span></dt><dt><span class="sect3"><a href="#updating-src-completing-restart">23.5.6.3. 更新後重新啟動</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#small-lan">23.6. 多部機器追蹤</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="updating-upgrading-synopsis"></a>23.1. 概述</h2></div></div></div><p>FreeBSD 在每次的發佈之間持續在開發。有些人偏好正式發佈的版本，也有另一群人喜歡使用最新的開發版本。然而，即使是正式發佈的版本也時常會有安全性與其他緊急修復的更新，因此，無論使用哪種版本，FreeBSD 都提供所有必要的工具來讓系統能維持最新的版本，且讓各種版本都能簡單的升級。本章將說明如何追蹤開發版本的系統及讓 FreeBSD 系統維持最新版本的基本工具。</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>如何使用 <span class="application">freebsd-update</span>, <span class="application">Subversion</span> 來維持 FreeBSD 系統為最新版。</p></li><li class="listitem"><p>如何比對已安裝系統與已知原始複本間的狀態。</p></li><li class="listitem"><p>如何使用 <span class="application">Subversion</span> 或說明文件 Port 來維持已安裝的文件為新版。</p></li><li class="listitem"><p>兩種開發分支間的差異：FreeBSD-STABLE 與 FreeBSD-CURRENT。</p></li><li class="listitem"><p>如何重新編譯及重新安裝整個基礎系統 (Base system)。</p></li></ul></div><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>正確的設定網路連線 (<a class="xref" href="#advanced-networking" title="章 31. 進階網路設定">章 31, <em>進階網路設定</em></a>)。</p></li><li class="listitem"><p>了解如何安裝其他第三方軟體 (<a class="xref" href="#ports" title="章 4. 安裝應用程式：套件與 Port">章 4, <em>安裝應用程式：套件與 Port</em></a>)。</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">本章會經常使用 <code class="command">svnlite</code> 來取得與更新 FreeBSD 原始碼。您也可以使用 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/devel/subversion/pkg-descr">devel/subversion</a> Port 或套件。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="updating-upgrading-freebsdupdate"></a>23.2. FreeBSD 更新</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div><div><span class="authorgroup">Based on notes provided by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Colin</span> <span class="surname">Percival</span></span>. </span></div></div></div><a id="idp80209208" class="indexterm"></a><a id="idp80210104" class="indexterm"></a><p>隨時套用安全性更新以及升級到新發佈的作業系統版本對管理一個持續運作的系統是非常重要的任務，FreeBSD 內含可以執行這兩項任務的工具程式，叫做 <code class="command">freebsd-update</code>。</p><p>這個工具程式支援使用 Binary 對 FreeBSD 做安全性與和錯誤更新，不需要手動編譯和安裝修補 (Patch) 或新核心。目前由安全性團隊提供支援的 Binary 更新可用於所有的架構和發行版。支援的發行版清單及各自的支援期限列於 <code class="uri"><a class="uri" href="https://www.FreeBSD.org/security/" target="_top">https://www.FreeBSD.org/security/</a></code>。</p><p>這個工具程式也支援升級作業系統到次要的發佈版以及升級到另一個發佈版分支。在升級到新的發佈版本前，需先查看該版本的發佈公告，因為發行公告中包含了該發行版本的相關重要資訊。發行公告可自 <code class="uri"><a class="uri" href="https://www.FreeBSD.org/releases/" target="_top">https://www.FreeBSD.org/releases/</a></code> 取得。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">如果有使用 <code class="command">crontab</code> 來執行 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=freebsd-update&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">freebsd-update</span>(8)</span></a>，則必須在升級作業系統前先關閉。</p></div><p>本節將說明 <code class="command">freebsd-update</code> 使用的設定檔， 示範如何套用安全性修補及如何升級到主要或次要的作業系統發行版，並討論升級作業系統的需要考量的事項。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-config-file"></a>23.2.1. 設定檔</h3></div></div></div><p><code class="command">freebsd-update</code> 預設的設定檔不需變更即可運作。 部份使用者可能會想要調校位於 <code class="filename">/etc/freebsd-update.conf</code> 的預設設定檔來對程序有更好的控制。該設定檔中的註解均有說明可用的選項，但以下幾個項目可能需要進一步的說明：</p><pre xml:lang="en" class="programlisting" lang="en"># Components of the base system which should be kept updated.
Components world kernel</pre><p>這個參數控制 FreeBSD 要保持最新版本的部份。 預設是更新整個基礎系統 (Base system) 和核心。 可指定個別元件，例如：<code class="literal">src/base</code> 或 <code class="literal">src/sys</code>。 雖然如此，最好的選項是維持預設值，因為更改指定特定項目時需列出每一個需要的項目。時間一久可能會因為原始碼和 Binary 檔案沒有更新而造成慘重的後果。</p><pre xml:lang="en" class="programlisting" lang="en"># Paths which start with anything matching an entry in an IgnorePaths
# statement will be ignored.
IgnorePaths /boot/kernel/linker.hints</pre><p>要保持特定的目錄在更新過程不被更動，例如 <code class="filename">/bin</code> 或 <code class="filename">/sbin</code>，可以將他們的路徑加到此敘述中。 這個選項可以防止 <code class="command">freebsd-update</code> 覆蓋本地的修改。</p><pre xml:lang="en" class="programlisting" lang="en"># Paths which start with anything matching an entry in an UpdateIfUnmodified
# statement will only be updated if the contents of the file have not been
# modified by the user (unless changes are merged; see below).
UpdateIfUnmodified /etc/ /var/ /root/ /.cshrc /.profile</pre><p>這個選項只會更新特定目錄中未修改的設定檔。任何使用者修改的檔案都不會自動更新。 有另一個選項 <code class="literal">KeepModifiedMetadata</code> 可讓 <code class="command">freebsd-update</code> 在合併時儲存使用者做的變更。</p><pre xml:lang="en" class="programlisting" lang="en"># When upgrading to a new FreeBSD release, files which match MergeChanges
# will have any local changes merged into the version from the new release.
MergeChanges /etc/ /var/named/etc/ /boot/device.hints</pre><p>列出 <code class="command">freebsd-update</code> 應嘗試合併的設定檔目錄。 檔案合併程序是指一系列類似 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> 做的 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> 修補動作， 但是選項比較少。 合併的動作包含接受、開啟編輯器，或讓 <code class="command">freebsd-update</code> 中止。 如果有疑慮，請先備份 <code class="filename">/etc</code>，然後再接受合併。 更多關於 <code class="command">mergemaster</code> 的資訊， 參見 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a>。</p><pre xml:lang="en" class="programlisting" lang="en"># Directory in which to store downloaded updates and temporary
# files used by FreeBSD Update.
# WorkDir /var/db/freebsd-update</pre><p>這個目錄是所有修補檔和暫存檔的存放處。當使用者進行版本升級時，這個位置應該要有至少 1GB 的可用磁碟空間。</p><pre xml:lang="en" class="programlisting" lang="en"># When upgrading between releases, should the list of Components be
# read strictly (StrictComponents yes) or merely as a list of components
# which *might* be installed of which FreeBSD Update should figure out
# which actually are installed and upgrade those (StrictComponents no)?
# StrictComponents no</pre><p>當這個選項設定為 <code class="literal">yes</code> 時，<code class="command">freebsd-update</code> 將會假設 <code class="literal">Components</code> 清單已完成，將不會對清單之外的項目做變更。 實際上 <code class="command">freebsd-update</code> 會將嘗試更新每一個屬於 <code class="literal">Components</code> 清單中的檔案。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-security-patches"></a>23.2.2. 套用安全性修補</h3></div></div></div><p>套用 FreeBSD 安全性修補的過程已經被簡化，讓系統管理員可使用 <code class="command">freebsd-update</code> 來保持系統更新。更多有關 FreeBSD 安全性報告的資訊可以參考 <a class="xref" href="#security-advisories" title="13.11. FreeBSD 安全報告">節 13.11, “FreeBSD 安全報告”</a>。</p><p>FreeBSD 安全性修補可以使用以下指令下載並安裝。 第一個指令會偵測是否有可用的修補，如果有，將列出若執行修補後會變更的檔案清單。第二個指令將會套用修補。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update fetch</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre><p>如果更新套用了任何核心修補，系統將會需要重新開機以使用修補過的核心。如果修補套用在任何執行中的 Binary，受影響的應用程式應重新啟動來使用修補過的 Binary 版本。</p><p>加入以下項目至 <code class="filename">/etc/crontab</code> 可設定系統每天自動檢查更新一次：</p><pre xml:lang="en" class="programlisting" lang="en">@daily                                  root    freebsd-update cron</pre><p>如果有新的修補，該程式會會自動下載，但不會執行。<code class="systemitem">root</code> 使用者會收到電子郵件通知複查該修補並手動執行 <code class="command">freebsd-update install</code> 安裝。</p><p>如果有發生任何錯誤，<code class="command">freebsd-update</code> 可以使用以下指令還原最後所做的變更：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update rollback</code></strong>
Uninstalling updates... done.</pre><p>再次強調，若核心或任何核心模組有做過修改應重新啟動系統，以及任何受影響的 Binary 應重新執行。</p><p>只有 <code class="filename">GENERIC</code> 核心可使用 <code class="command">freebsd-update</code> 自動更新。 如果有安裝自訂的核心，在 <code class="command">freebsd-update</code> 完成安裝更新後，需要重新編譯和重新安裝。 預設的核心名稱為 <span class="emphasis"><em>GENERIC</em></span>，可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=uname&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">uname</span>(1)</span></a> 指令來檢查安裝的核心。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">隨時在 <code class="filename">/boot/GENERIC</code> 保留一份 <code class="filename">GENERIC</code> 核心的複本將有助於診斷各種問題及執行版本升級。請參考 <a class="xref" href="#freebsd-update-custom-kernel-9x" title="23.2.3.1. 在 FreeBSD 9.X 及之後版本自訂核心">節 23.2.3.1, “在 FreeBSD 9.X 及之後版本自訂核心”</a> 來了解有關如何取得 <code class="filename">GENERIC</code> 核心的複本說明。</p></div><p>除非在 <code class="filename">/etc/freebsd-update.conf</code> 的預設設定檔被修改，否則 <code class="command">freebsd-update</code> 將會安裝更新後的核心原始碼和其餘的更新，可依平常的方式執行重新編譯與重新安裝核心。</p><p>以 <code class="command">freebsd-update</code> 發行的更新並非總是會更新核心。若核心的原始碼沒有被 <code class="command">freebsd-update install</code> 修改則不需要重新編譯自訂的核心。雖然如此 <code class="command">freebsd-update</code> 總是會更新 <code class="filename">/usr/src/sys/conf/newvers.sh</code>，目前修補的版本如 <code class="command">uname -r</code> 執行結果中的 <code class="literal">-p</code> 數字，便是由該檔取得。即使沒有做任何其他變更，重新編譯自訂核心可讓 <code class="command">uname</code> 準確的回報系統目前的修補版本。當維護多個系統時這會特別有用，因其可讓你快速評估每個系統安裝的更新。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-upgrade"></a>23.2.3. 執行主要及次要版號升級</h3></div></div></div><p>從 FreeBSD 的次要版本升級到另一個版本，例如從 FreeBSD 9.0 到 FreeBSD 9.1, 叫作 <em class="firstterm">次要版本 (Minor version)</em> 更新。 <em class="firstterm">主要版本 (Major version)</em> 更新發生在當 FreeBSD 從一個主要版本升級到主要版本升級到另一個主要版本時，例如從 FreeBSD 9.X 到 FreeBSD 10.X。 兩種更新都可以透過提供 <code class="command">freebsd-update</code> 目標的發佈版本來執行。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">如果系統正在執行自訂的核心，請在開始升級前，確定有保留一份 <code class="filename">GENERIC</code> 核心的複本在 <code class="filename">/boot/GENERIC</code>。 請參考 <a class="xref" href="#freebsd-update-custom-kernel-9x" title="23.2.3.1. 在 FreeBSD 9.X 及之後版本自訂核心">節 23.2.3.1, “在 FreeBSD 9.X 及之後版本自訂核心”</a> 關於如何取得 <code class="filename">GENERIC</code> 核心複本的說明。</p></div><p>在 FreeBSD 9.0 系統執行以下指令，將會把系統升級至 FreeBSD 9.1：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update -r 9.1-RELEASE upgrade</code></strong></pre><p>收到這個指令後，<code class="command">freebsd-update</code> 會開始評估設定檔和目前的系統來收集升級所需的資訊。 螢幕會顯示偵測到或沒偵測到的元件清單。例如：</p><pre xml:lang="en" class="screen" lang="en">Looking up update.FreeBSD.org mirrors... 1 mirrors found.
Fetching metadata signature for 9.0-RELEASE from update1.FreeBSD.org... done.
Fetching metadata index... done.
Inspecting system... done.

The following components of FreeBSD seem to be installed:
kernel/smp src/base src/bin src/contrib src/crypto src/etc src/games
src/gnu src/include src/krb5 src/lib src/libexec src/release src/rescue
src/sbin src/secure src/share src/sys src/tools src/ubin src/usbin
world/base world/info world/lib32 world/manpages

The following components of FreeBSD do not seem to be installed:
kernel/generic world/catpages world/dict world/doc world/games
world/proflibs

Does this look reasonable (y/n)? <strong class="userinput"><code>y</code></strong></pre><p>此時，<code class="command">freebsd-update</code> 將會嘗試下載所有升級需要的檔案。 在某些情況，會詢問使用者一些關於要安裝什麼或要如何繼續。</p><p>當使用自訂核心，上述的步驟將會產生如下的警告：</p><pre xml:lang="en" class="screen" lang="en">WARNING: This system is running a "<em class="replaceable"><code>MYKERNEL</code></em>" kernel, which is not a
kernel configuration distributed as part of FreeBSD 9.0-RELEASE.
This kernel will not be updated: you MUST update the kernel manually
before running "/usr/sbin/freebsd-update install"</pre><p>這時的警告可以安全地忽略，升級過程將會使用更新過的 <code class="filename">GENERIC</code> 核心來進行。</p><p>所有的修補都下載到本地系統之後， 將會開始套用更新。這個過程可能會花點時間，取決於機器的速度和工作量。設定檔將會被合併。 合併的過程中當檔案被合併或是手動合併畫面上出現編輯器時需要使用者操作。 每一個成功合併的結果將會顯示給使用者並繼續程序，失敗或忽略合併將會使程序中斷。使用者可能想要備份 <code class="filename">/etc</code> 並稍後手動合併重要的檔案，例如：<code class="filename">master.passwd</code> 或 <code class="filename">group</code>。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">所有的修補與合併動作會在另一個目錄進行，並不會直接修改。當成功套用所有修補，所有設定檔已合併且過程順利，使用者可使用以下指令將變更安裝到磁碟：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre></div><p>核心與核心模組會先修補，若系統正在執行自訂的核心，使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=nextboot&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">nextboot</span>(8)</span></a> 來設定下次開機使用更新過的 <code class="filename">/boot/GENERIC</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>nextboot -k GENERIC</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">若機器在遠端進行更新，請在使用 <code class="filename">GENERIC</code> 核心重新開機前，請確定該核心含有所有系統所需的驅動程式以正常開機並連線至網路。特別是在執行的自訂核心有使用到由核心模組提供內建功能，請確定將這些模組已暫時使用 <code class="filename">/boot/loader.conf</code> 設定檔載入到 <code class="filename">GENERIC</code> 核心。建議關閉非必須的服務和磁碟與網路掛載直到升級程序完成。</p></div><p>機器現在應使用更新過的核心重新開機：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong></pre><p>一旦系統重新上線，使用以下指令繼續 <code class="command">freebsd-update</code>。 由於程序的狀態已被儲存，<code class="command">freebsd-update</code> 不會重頭開始，但會進行下一個階段並移除所有舊的共用程式庫和目標檔。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">取決於是否有任何程式庫版本編號衝突，也可能只有兩個而不是三個安裝階段。</p></div><p>升級程序現在完成了。如果所做的是主要的版本升級，則需依 <a class="xref" href="#freebsdupdate-portsrebuild" title="23.2.3.2. 主要版號升級後的套件升級">節 23.2.3.2, “主要版號升級後的套件升級”</a> 的說明重新安裝所有的 Port 和套件。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsd-update-custom-kernel-9x"></a>23.2.3.1. 在 FreeBSD 9.X 及之後版本自訂核心</h4></div></div></div><p>在使用 <code class="command">freebsd-update</code> 前，請確定已有 <code class="filename">GENERIC</code> 核心的複本於 <code class="filename">/boot/GENERIC</code>。若只編譯過一次自訂核心，那麼 <code class="filename">/boot/kernel.old</code> 就是 <code class="literal">GENERIC</code> 核心，只需要將該目錄重新命名為 <code class="filename">/boot/kernel</code>。</p><p>若有編譯自訂核心過超過一次，或已經不曉得編譯自訂核心的次數，則需取得與目前作業系統版本相符的 <code class="literal">GENERIC</code> 核心複本。若可直接操作實體系統，則可以從安裝媒體取得 <code class="literal">GENERIC</code> 核心複本：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount /cdrom</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /cdrom/usr/freebsd-dist</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>tar -C/ -xvf kernel.txz boot/kernel/kernel</code></strong></pre><p>或者，可以從原始碼重新編譯 <code class="literal">GENERIC</code> 核心：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make kernel __MAKE_CONF=/dev/null SRCCONF=/dev/null</code></strong></pre><p>這個核心要被 <code class="command">freebsd-update</code> 認做 <code class="literal">GENERIC</code> 核心，<code class="filename">GENERIC</code> 設定檔必須不能做任何修改，也建議在編譯核心時不要使用其他特殊選項。</p><p><code class="command">freebsd-update</code> 僅需要 <code class="filename">/boot/GENERIC</code> 存在便可，因此不須重新開機進入 <code class="filename">GENERIC</code>。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-portsrebuild"></a>23.2.3.2. 主要版號升級後的套件升級</h4></div></div></div><p>一般來說，已安裝的應用程式在次要版本升級仍可沒問題的正常執行。但主要版本升級會採用不同的應用程式 Binary 介面 (Application Binary Interfaces, <acronym class="acronym">ABI</acronym>s)，會導致大部份第三方應用程式無法正常執行。 因此在主要版本升級後，需要升及所有已安裝的套件和 Port，套件可以使用 <code class="command">pkg upgrade</code> 來升級，而 Port 則需使用 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portmaster/pkg-descr">ports-mgmt/portmaster</a> 工具。</p><p>強制升級所有已安裝的套件會使用檔案庫中新版本的套件來取得目前套件，即使該版號沒有增加。由於在升級 FreeBSD 主要版本時會變更 ABI 版本，因此這是必要動作。強制升級可以執行以下指令來完成：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg-static upgrade -f</code></strong></pre><p>重新編譯所有已安裝的應用程式可以執行以下指令來完成：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>portmaster -af</code></strong></pre><p>這個指令會在安裝每個應用程式有可設定選項時顯示設定畫面，並會等待使用者操作該畫面，要避免這種情況並使用預設的設定選項，可在上述指令加上 <code class="option">-G</code> 參數。</p><p>完成軟體升級後，最後需執行 <code class="command">freebsd-update</code> 來完成最後的升級動作：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre><p>若有使用臨時 <code class="filename">GENERIC</code> 核心，便應在此時依據 <a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a> 的說明編譯並安裝新的自訂核心。</p><p>重新開機使用新的 FreeBSD 版本後，升級程序便正式完成。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-system-comparison"></a>23.2.4. 比對系統狀態</h3></div></div></div><p>已安裝的 FreeBSD 版本狀態可以使用 <code class="command">freebsd-update IDS</code> 與另一個已知良好的複本來做比對測試。 這個指令會評估目前版本的系統工具，程式庫和設定檔，可做為內建的入侵偵測系統來使用 (Intrusion Detection System, <acronym class="acronym">IDS</acronym>)。</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">這個指令並非用來取代真正的 <acronym class="acronym">IDS</acronym>，如 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/snort/pkg-descr">security/snort</a>。由於 <code class="command">freebsd-update</code> 儲存在磁碟上，被竄改的可能性是顯而易見的，雖然這個可能性會因使用 <code class="varname">kern.securelevel</code> 以及將 <code class="command">freebsd-update</code> 在不使用時以唯讀儲存而降低，最好的解決方案是能夠與安全的磁碟，如 <acronym class="acronym">DVD</acronym> 或儲存在外部的 <acronym class="acronym">USB</acronym> 磁碟裝置比對系統。替代的方式是使用內建工具的 <acronym class="acronym">IDS</acronym> 功能，在 <a class="xref" href="#security-ids" title="13.2.6. Binary 檢驗">節 13.2.6, “Binary 檢驗”</a> 有詳細說明</p></div><p>要開始比對，需指定輸出的檔案來儲存結果：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update IDS &gt;&gt; outfile.ids</code></strong></pre><p>系統將會開始檢查並且會產生相當長的檔案清單，內容包含發佈版本已知的與目前安裝版本的 <acronym class="acronym">SHA256</acronym> 雜湊值會儲存到指定的輸出檔。</p><p>清單中的項目會相當的多，但輸出的格式可以很簡單的用來分析。例如，要取得與發佈版本不同的檔案清單，可使用以下指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cat outfile.ids | awk '{ print $1 }' | more</code></strong>
/etc/master.passwd
/etc/motd
/etc/passwd
/etc/pf.conf</pre><p>實際的檔案會更多，此範例的輸出已精簡。部份檔案可能本來就會被修改。例如 <code class="filename">/etc/passwd</code> 在新增使用者到系統時會被修改，核心模組也有可能因使用 <code class="command">freebsd-update</code> 更新而有所不同。要排除特定的檔案或目錄可將這些檔案或目錄加入到 <code class="filename">/etc/freebsd-update.conf</code> 中的 <code class="literal">IDSIgnorePaths</code> 選項。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="updating-upgrading-documentation"></a>23.3. 更新文件集</h2></div></div></div><a id="idp80399928" class="indexterm"></a><a id="idp80400568" class="indexterm"></a><p>說明文件是 FreeBSD 作業系統不可或缺的一部份。最新版本的 FreeBSD 文件除了可在 FreeBSD 網站 (<a class="link" href="../../../../doc/" target="_top">https://www.freebsd.org/doc/</a>) 取得，也可很簡單的取得本地的 FreeBSD 網站、使用手冊、<acronym class="acronym">FAQ</acronym> 及文章副本。</p><p>本節將說明如何使用原始碼與 FreeBSD Port 套件集來取得最新版本 FreeBSD 文件本地複本。</p><p>有關編輯與提出修正說明文件的資訊，請參考 FreeBSD 文件計畫入門書 (<a class="link" href="../../../../doc/en_US.ISO8859-1/books/fdp-primer" target="_top">https://www.freebsd.org/doc/en_US.ISO8859-1/books/fdp-primer/</a>)。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-installed-documentation"></a>23.3.1. 自原始碼更新說明文件</h3></div></div></div><p>從原始碼重新編譯 FreeBSD 文件需要一些不屬於 FreeBSD 基礎系統的工具。需要的工具可安裝由 FreeBSD 文件計劃所開發的 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/textproc/docproj/pkg-descr">textproc/docproj</a> 套件或 Port。</p><p>安裝完成之後，可使用 <span class="application">svnlite</span> 來取得乾淨的文件原始碼複本：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>svnlite checkout https://svn.FreeBSD.org/doc/head /usr/doc</code></strong></pre><p>第一次下載文件原始碼需要一些時間，請耐心等候執行完畢。</p><p>往後更新文件原始碼可執行：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>svnlite update /usr/doc</code></strong></pre><p>下載最新的文件原始碼到 <code class="filename">/usr/doc</code> 之後，便完成要更新已安裝文件的準備動作。</p><p>完整更新所有可用的語言可以執行：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/doc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>若只想要更新特定語言，可對 <code class="filename">/usr/doc</code> 中特定語言的子目錄執行 <code class="command">make</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/doc/en_US.ISO8859-1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>另一個更新文件的方式是在 <code class="filename">/usr/doc</code> 或特定的語言子目錄下執行此指令：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>make update</code></strong></pre><p>要指定安裝的輸出格式可使用 <code class="varname">FORMATS</code> 來設定：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/doc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make FORMATS='html html-split' install clean</code></strong></pre><p>有數個選項可更新部份文件或只編譯特定翻譯來簡化更新程序。這些選項可在 <code class="filename">/etc/make.conf</code> 設為系統全域的預設選項，或是透過指令傳送給 <code class="command">make</code>。</p><p>選項有：</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en"><code class="varname">DOC_LANG</code></span></dt><dd><p>要編譯與安裝的語言及編碼清單，例如 <code class="literal">en_US.ISO8859-1</code> 代表英語文件。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="varname">FORMATS</code></span></dt><dd><p>要編譯的輸出格式清單，目前支援 <code class="literal">html</code>, <code class="literal">html-split</code>, <code class="literal">txt</code>, <code class="literal">ps</code> 以及 <code class="literal">pdf</code>。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="varname">DOCDIR</code></span></dt><dd><p>要安裝文件的位置，預設為 <code class="filename">/usr/share/doc</code>。</p></dd></dl></div><p>要取得更多可做為 FreeBSD 系統全域選項的 <code class="command">make</code> 變數，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=make.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">make.conf</span>(5)</span></a>。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="doc-ports-install-package"></a>23.3.2. 自 Port 更新說明文件</h3></div><div><span class="authorgroup">Based on the work of <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><a id="idp80451768" class="indexterm"></a><a id="idp80452664" class="indexterm"></a><p>前一節介紹了由原始碼更新 FreeBSD 文件的方法，本節將說明使用 Port 套件集的替代方法，可由以下方式達成：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>安裝事先編譯好的文件套件，無須在本地編譯任何東西或安裝文件工具集。</p></li><li class="listitem"><p>使用 Port 框架來編譯文件原始碼，可讓取得與編譯文件的步驟更簡單。</p></li></ul></div><p>這個更新 FreeBSD 文件的方法，會使用到一系列由文件工程團隊 <code class="email">&lt;<a xmlns="" class="email" href="mailto:doceng@FreeBSD.org">doceng@FreeBSD.org</a>&gt;</code> 每月更新的文件 Port 與套件。這些套件列於 FreeBSD Port 套件集的 docs 分類下 (<a class="link" href="http://www.freshports.org/docs/" target="_top">http://www.freshports.org/docs/</a>)。</p><p>文件 Port 的組織方式如下：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/misc/freebsd-doc-en/pkg-descr">misc/freebsd-doc-en</a> 套件或 Port 會安裝所有英語的文件。</p></li><li class="listitem"><p><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/misc/freebsd-doc-all/pkg-descr">misc/freebsd-doc-all</a> 套件或 Port 會安裝所有可用語言的文件。</p></li><li class="listitem"><p>每個翻譯語言都有套件與 Port，如 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/misc/freebsd-doc-hu/pkg-descr">misc/freebsd-doc-hu</a> 為匈牙利語文件。</p></li></ul></div><p>當使用 Binary 套件時，會安裝指定語言 FreeBSD 文件的所有可用格式。例如以下指令會安裝最新的匈牙利語文件套件：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install hu-freebsd-doc</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">套件使用的名稱格式與 Port 的名稱不同：<code class="literal"><em class="replaceable"><code>lang</code></em>-freebsd-doc</code>，其中 <em class="replaceable"><code>lang</code></em> 是語言代碼的縮寫，例如 <code class="literal">hu</code> 代表匈牙利語，<code class="literal">zh_cn</code> 代表簡體中文。</p></div><p>要指定文件的格式，需以編譯 Port 來代替安裝套件。例如要編譯並安裝英語文件：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/misc/freebsd-doc-en</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>Port 提供設定選單來指定要編譯與安裝的格式，預設會選擇分頁的 <acronym class="acronym">HTML</acronym> (類似 <code class="uri"><a class="uri" href="http://www.FreeBSD.org" target="_top">http://www.FreeBSD.org</a></code> 使用的格式) 以及 <acronym class="acronym">PDF</acronym>。</p><p>此外，編譯文件 Port 時也可指定數個 <code class="command">make</code> 選項，包括：</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en"><code class="varname">WITH_HTML</code></span></dt><dd><p>編譯一份文件使用一個 HTML 檔的 HTML 格式。格式化後的文件會儲存至名稱為 <code class="filename">article.html</code> 或 <code class="filename">book.html</code> 的檔案。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="varname">WITH_PDF</code></span></dt><dd><p>格式化的文件會儲存至名稱為 <code class="filename">article.pdf</code> 或 <code class="filename">book.pdf</code> 的檔案。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="varname">DOCBASE</code></span></dt><dd><p>指定要安裝文件的位置，預設為 <code class="filename">/usr/local/share/doc/freebsd</code>。</p></dd></dl></div><p>以下範例使用變數來安裝 <acronym class="acronym">PDF</acronym> 的匈牙利語文件到特定目錄：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/misc/freebsd-doc-hu</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make -DWITH_PDF DOCBASE=share/doc/freebsd/hu install clean</code></strong></pre><p>文件套件或 Port 可以依 <a class="xref" href="#ports" title="章 4. 安裝應用程式：套件與 Port">章 4, <em>安裝應用程式：套件與 Port</em></a> 的說明更新。例如以下指令會使用 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portmaster/pkg-descr">ports-mgmt/portmaster</a> 更新已安裝的匈牙利語文件：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>portmaster -PP hu-freebsd-doc</code></strong></pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="current-stable"></a>23.4. 追蹤開發分支</h2></div></div></div><a id="idp80508088" class="indexterm"></a><a id="idp80508728" class="indexterm"></a><p>FreeBSD 有兩個開發分支：FreeBSD-CURRENT 及 FreeBSD-STABLE。</p><p>本節將說明每個分支及其的特定使用者，也會說明如何在各別分支維持系統為最新版。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="current"></a>23.4.1. 使用 FreeBSD-CURRENT</h3></div></div></div><p>FreeBSD-CURRENT 是 FreeBSD 開發的 <span class="quote">“<span class="quote">最前線</span>”</span>，FreeBSD-CURRENT 的使用者需具備較強的技術能力。技術能力較弱的使用者應改追蹤 FreeBSD-STABLE 開發分支。</p><p>FreeBSD-CURRENT 是 FreeBSD 最新的原始碼，其中包括正在進行的開發工作、實驗性的變更以及不一定會在下一個官方發行版出現的過渡機制。 雖然 FreeBSD 開發者每天編譯 FreeBSD-CURRENT 原始碼，但仍可能有短暫時間原始碼是無法編譯的。雖然這些問題會儘快被解決，但是無論 FreeBSD-CURRENT 帶來災難或是新功能，同步原始碼時都要考量這個問題。</p><p>FreeBSD-CURRENT 主要給下以三種族群：</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>致力於開發某一部份原始碼樹的 FreeBSD 社群成員。</p></li><li class="listitem"><p>FreeBSD 社群成員中活耀的測試人員。 他們願意花時間解決問題，對 FreeBSD 的變更及大方向提出專業建議並送交修補。</p></li><li class="listitem"><p>隨時關注的使用者，使用目前原始碼做為參考用途，或是偶爾提供意見或貢獻原始碼。</p></li></ol></div><p><span class="emphasis"><em>不應</em></span>將 FreeBSD-CURRENT 當做下一個發行版前取得新功能的快速途徑，因為尚未發行的功能並未被完整測試，很可能有問題。這也不是一個快速取得問題修正的方式，因為任何已知的問題修正有可能產生新的問題。 使用 FreeBSD-CURRENT 不在 <span class="quote">“<span class="quote">官方支援</span>”</span> 的範圍內。</p><a id="idp80516408" class="indexterm"></a><p>若要追蹤 FreeBSD-CURRENT：</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>加入 <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">freebsd-current</a> 和 <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-head" target="_top">svn-src-head</a> 郵遞論壇。這是 <span class="emphasis"><em>重要</em></span> 的，是為了要了解目前人們對於系統目前狀態的評論並接收有關 FreeBSD-CURRENT 目前狀態的重要公告。</p><p><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-head" target="_top">svn-src-head</a> 郵遞論壇會記錄每一次修改的提交項目，以及可能產生的副作用的相關資訊。</p><p>要加入這兩個郵遞論壇，請前往 <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo" target="_top">http://lists.FreeBSD.org/mailman/listinfo</a> 點選要訂閱的郵遞論壇，並依照網頁指示的步驟操作。要追蹤整個原始碼樹，不單只有 FreeBSD-CURRENT 的變更，可訂閱 <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-all" target="_top">svn-src-all</a> 郵遞論壇。</p></li><li class="listitem"><p>同步 FreeBSD-CURRENT 原始碼。 通常會使用 <a class="link" href="#svn" title="A.3. 使用 Subversion">svnlite</a> 自列於 <a class="xref" href="#svn-mirrors" title="A.3.6. Subversion 鏡像站">節 A.3.6, “<span class="application">Subversion</span> 鏡像站”</a> 中的其中一個 Subversion 鏡像站的 <code class="literal">head</code> 分支中取出 -CURRENT 的程式碼。</p></li><li class="listitem"><p>考量到檔案庫的大小，部份使用者選擇只同步他們有興趣或貢獻修補的部份原始碼。然而， 計劃要從原始碼編譯整個作業系統的使用者須下載 <span class="emphasis"><em>全部</em></span> 的 FreeBSD-CURRENT，不可只有選擇的部份。</p><p>編譯 FreeBSD-CURRENT <a id="idp80529720" class="indexterm"></a> 前，請仔細地閱讀 <code class="filename">/usr/src/Makefile</code> 並依照 <a class="xref" href="#makeworld" title="23.5. 從原始碼更新 FreeBSD">節 23.5, “從原始碼更新 FreeBSD”</a> 的指示操作。 閱讀 <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">FreeBSD-CURRENT 郵遞論壇</a> 以及 <code class="filename">/usr/src/UPDATING</code> 來了解升級的相關資訊，有時會含有升級下一個發行版的必要資訊。</p></li><li class="listitem"><p>要活躍！我們非常鼓勵 FreeBSD-CURRENT 的使用者發表他們對加強哪些功能或是修復哪些錯誤的建議。 如果您在建議時能附上相關程式碼的話，是最好的。</p></li></ol></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="stable"></a>23.4.2. 使用 FreeBSD-STABLE</h3></div></div></div><p>FreeBSD-STABLE 是一個開發分支，會在主要的版本更新後產生，進入這個分支的步伐會比較緩慢，而且通常會假定已經在 FreeBSD-CURRENT 中做過測試，所以問題會比較少，但這<span class="emphasis"><em>仍然</em></span>是一個開發分支，在任何時間點，FreeBSD-STABLE 中的原始碼不能保証能供一般使用，它只是另一個開發支線，並不是供最終使用者使用的資源，若沒有任何資源可以做測試的使用者應改使用最新版本的 FreeBSD 發佈版。</p><p>對於那些有興趣追蹤或為 FreeBSD 開發流程提供一些貢獻的人，特別是針對下一個主要發佈版的 FreeBSD，應該考慮追蹤 FreeBSD-STABLE。</p><p>雖然 FreeBSD-STABLE 分支應該已經做過編譯並執行過，但這仍然無法保証不會出任何問題。由於使用 FreeBSD-STABLE 的人比 FreeBSD-CURRENT 更多，因此不可避免的，有時仍會在 FreeBSD-STABLE 中發現未在 FreeBSD-CURRENT 中出現的問題與特殊狀況。基於這個原因，任何人都不應盲目的追蹤 FreeBSD-STABLE，特別重要的是 <span class="emphasis"><em>不</em></span> 要將任何產線上的伺服器更新成未經開發或測試環境中測試過的 FreeBSD-STABLE。</p><p>若要追蹤 FreeBSD-STABLE：</p><a id="idp80536888" class="indexterm"></a><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>加入 <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-stable" target="_top">freebsd-stable</a> 郵遞論壇來隨時了解 FreeBSD-STABLE 可能需要的編譯相依項目或任何需要特別注意的問題，當有一些有爭議的修復或更新時，開發人員也會在郵遞論壇中公告，如果有使用者對所提出的更改有任何的疑慮，可讓使用者有機會能反應問題。</p><p>加入要追蹤的分支所相關的 <span class="application">svn</span> 郵遞論壇，例如，在追蹤 9-STABLE 分支的使用者會加入 <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-9" target="_top">svn-src-stable-9</a> 郵遞論壇，該郵遞論壇會記錄每次變更的提交記錄，以及有關可能出現的副作用的任何相關訊息。</p><p>要加入這些郵遞論壇，請前往 <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo" target="_top">http://lists.FreeBSD.org/mailman/listinfo</a> 點選要訂閱的郵遞論壇，並依照網頁指示的步驟操作。要追蹤整個原始碼樹的變更，可訂閱 <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-all" target="_top">svn-src-all</a> 郵遞論壇。</p></li><li class="listitem"><p>要安裝新的 FreeBSD-STABLE 系統，可安裝在 <a class="link" href="#mirrors" title="附錄 A. 取得 FreeBSD">FreeBSD 鏡像站</a> 中最近的 FreeBSD-STABLE 發佈版或使用每月使用 FreeBSD-STABLE 所編譯的快照 (Snapshot)，請參考 <a class="link" href="../../../../snapshots/" target="_top">www.freebsd.org/snapshots</a> 取得更多有關快照的資訊。</p><p>要編譯或升級已有的 FreeBSD 系統到 FreeBSD-STABLE 可使用 <a class="link" href="#svn" title="A.3. 使用 Subversion">svn</a> <a id="idp80544440" class="indexterm"></a> 來取出欲升級的分支程式碼，可用分支的名稱如：<code class="literal">stable/9</code> 會列在 <a class="link" href="../../../../releng/" target="_top">www.freebsd.org/releng</a>。</p></li><li class="listitem"><p>編譯 FreeBSD-STABLE <a id="idp80546872" class="indexterm"></a> 前，請仔細地閱讀 <code class="filename">/usr/src/Makefile</code> 並依照 <a class="xref" href="#makeworld" title="23.5. 從原始碼更新 FreeBSD">節 23.5, “從原始碼更新 FreeBSD”</a> 的指示操作。 閱讀 <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-stable" target="_top">FreeBSD-STABLE 郵遞論壇</a> 以及 <code class="filename">/usr/src/UPDATING</code> 來了解升級的相關資訊，有時會含有升級下一個發行版的必要資訊。</p></li></ol></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="makeworld"></a>23.5. 從原始碼更新 FreeBSD</h2></div></div></div><p>從編譯原始碼來更新 FreeBSD 比起用 Binary 更新有幾項優點，在編譯程式碼時可以自訂選項來充分運用特定硬體，部份基礎系統可以使用非預設的設定值編譯，或是在不需要或不想要的時候跳過編譯。使用編譯的程序來更新系統比起安裝 Binary 來更新會耗時許多，但能夠完整自訂一個量身定做版本的 FreeBSD。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-quick-start"></a>23.5.1. 快速開始</h3></div></div></div><p>這是從原始碼編譯來更新 FreeBSD 的標準步驟快速的參考，稍後的章節會更詳細的說明這個程序。</p><div class="procedure"><ul class="procedure"><li class="step"><p class="title"><strong>更新並編譯</strong></p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>svnlite update /usr/src</code></strong>  <a id="updating-src-qs-svnup"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
<span class="emphasis"><em>check <code class="filename">/usr/src/UPDATING</code></em></span>  <a id="updating-src-qs-review-updating"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>          <a id="updating-src-qs-cd"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>make -j<em class="replaceable"><code>4</code></em> buildworld</code></strong>  <a id="updating-src-qs-buildworld"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>make -j<em class="replaceable"><code>4</code></em> kernel</code></strong>      <a id="updating-src-qs-kernel"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong>      <a id="updating-src-qs-reboot"></a><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>          <a id="updating-src-qs-cd2"></a><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>make installworld</code></strong>    <a id="updating-src-qs-installworld"></a><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>mergemaster -Ui</code></strong>      <a id="updating-src-qs-mergemaster"></a><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong>      <a id="updating-src-qs-shutdown"></a><span><img src="./imagelib/callouts/10.png" alt="10" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-svnup"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>取得最新版本的原始碼，請參考 <a class="xref" href="#updating-src-obtaining-src" title="23.5.3. 更新原始碼">節 23.5.3, “更新原始碼”</a> 來了解更多取得與更新原始碼的資訊。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-review-updating"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>檢查 <code class="filename">/usr/src/UPDATING</code> 看是否有任後在原始碼編譯之前或之後需要手動操作的步驟。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-cd"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>前往原始碼目錄。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-buildworld"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>編譯世界 (World)，即除了核心 (Kernel) 外的所有東西。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-kernel"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>編譯並安裝核心，此動作等同於 <code class="command">make buildkernel installkernel</code>。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-reboot"><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>重新啟動系統以使用新的核心。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-cd2"><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span></a> </p></td><td valign="top" align="left"><p>前往原始碼目錄。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-installworld"><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span></a> </p></td><td valign="top" align="left"><p>安裝世界。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-mergemaster"><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span></a> </p></td><td valign="top" align="left"><p>更新與合併在 <code class="filename">/etc/</code> 中的設定檔案。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-shutdown"><span><img src="./imagelib/callouts/10.png" alt="10" border="0" /></span></a> </p></td><td valign="top" align="left"><p>重新啟動系統以使用新編譯好的世界與核心。</p></td></tr></table></div></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-preparing"></a>23.5.2. 準備原始碼更新</h3></div></div></div><p>閱讀 <code class="filename">/usr/src/UPDATING</code>，從原始碼編譯之前與之後任何需要手動操作步驟會在此檔案中說明。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-obtaining-src"></a>23.5.3. 更新原始碼</h3></div></div></div><p>FreeBSD 的原始碼位於 <code class="filename">/usr/src/</code>，較建議透過 <span class="application">Subversion</span> 版本控制系統來更新這份原始碼，要確認原始碼已在版本控制系統的管控下可：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>svnlite info /usr/src</code></strong>
Path: /usr/src
Working Copy Root Path: /usr/src
...</pre><p>此結果代表 <code class="filename">/usr/src/</code> 已在版本控制系統的管控下並且可以使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=svnlite&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">svnlite</span>(1)</span></a> 來更新：</p><a id="synching"></a><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>svnlite update /usr/src</code></strong></pre><p>若該目錄最近沒有更新過，可能會需要一些時間來完成更新動作。在更新完成之後，原始碼便為最新版本，並可開始依下一章節的說明來編譯程序。</p><div xmlns="" class="note"><h3 class="admontitle"><a xmlns="http://www.w3.org/1999/xhtml" id="updating-src-obtaining-src-checkout"></a>取得原始碼: </h3><p xmlns="http://www.w3.org/1999/xhtml">若輸出結果顯示 <code class="literal">'/usr/src' is not a working copy</code> 代表有缺少檔案或原始碼是採用其他方式安裝，若是如此，便需重新取出 (checkout) 原始碼。</p><div xmlns="http://www.w3.org/1999/xhtml" class="table"><a id="updating-src-obtaining-src-repopath"></a><div class="table-title">表格 23.1. FreeBSD 版本與檔案庫路徑</div><div class="table-contents"><table summary="FreeBSD 版本與檔案庫路徑" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th><code class="command">uname -r</code> 的輸出結果</th><th>檔案庫路徑</th><th>說明</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><code class="literal"><em class="replaceable"><code>X.Y</code></em>-RELEASE</code></td><td><code class="literal">base/releng/</code><em class="replaceable"><code>X.Y</code></em></td><td>發佈版本加上關鍵的安全性與錯誤修正，較建議大多數使用者使用這個分支。</td></tr><tr><td xml:lang="en" lang="en"><a id="STABLE"></a><code class="literal"><em class="replaceable"><code>X.Y</code></em>-STABLE</code></td><td xml:lang="en" lang="en"><code class="literal">base/stable/</code><em class="replaceable"><code>X</code></em></td><td>
		  <p>發佈版本加上所有在該分支上其他開發中的程式，<span class="emphasis"><em>STABLE</em></span> 代表不會更改應用程式 Binary 介面 (Applications Binary Interface, <acronym class="acronym">ABI</acronym>)，所以在先前版本所編譯的軟體仍可以正常運作，舉例來說，被編譯在 FreeBSD 10.1 可執行的軟體在編譯完 FreeBSD 10-STABLE 之後仍可以執行。</p>

		  <p>STABLE 分支偶爾也會有錯誤或無法相容的問題會影響使用者，雖然這些問題通常會很快的被修正。</p>
		</td></tr><tr><td xml:lang="en" lang="en"><code class="literal"><em class="replaceable"><code>X</code></em>-CURRENT</code></td><td xml:lang="en" lang="en"><code class="literal">base/head/</code></td><td>最新未發佈的 FreeBSD 開發版本，CURRENT 分支可能會有重大錯誤或不相容的問題，只建議進階的使用者使用。</td></tr></tbody></table></div></div><br xmlns="http://www.w3.org/1999/xhtml" class="table-break" /><p xmlns="http://www.w3.org/1999/xhtml">查看 FreeBSD 目前使用的版本可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=uname&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">uname</span>(1)</span></a>：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>uname -r</code></strong>
10.3-RELEASE</pre><p xmlns="http://www.w3.org/1999/xhtml">根據 <a class="xref" href="#updating-src-obtaining-src-repopath" title="表格 23.1. FreeBSD 版本與檔案庫路徑">表格 23.1, “FreeBSD 版本與檔案庫路徑”</a>，要更新 <code class="literal">10.3-RELEASE</code> 需使用的原始碼檔案庫路徑為 <code class="literal">base/releng/10.3</code>，在取出 (checkout) 原始碼時便要使用這個路徑：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mv /usr/src /usr/src.bak</code></strong>  <a id="updating-src-obtaining-src-mv"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>svnlite checkout https://svn.freebsd.org/base/<em class="replaceable"><code>releng/10.3</code></em> /usr/src</code></strong>  <a id="updating-src-obtaining-src-checkout-cmd"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></pre><div xmlns="http://www.w3.org/1999/xhtml" class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-obtaining-src-mv"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>將舊的目錄移到其他地方，若沒有在這個目錄做過任何本地修改，可直接刪除這個目錄。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-obtaining-src-checkout-cmd"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>將從 <a class="xref" href="#updating-src-obtaining-src-repopath" title="表格 23.1. FreeBSD 版本與檔案庫路徑">表格 23.1, “FreeBSD 版本與檔案庫路徑”</a> 查到的路徑加到檔案庫 <acronym class="acronym">URL</acronym> 之後。第三個參數用來存放本地系統原始碼的目標目錄。</p></td></tr></table></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-building"></a>23.5.4. 從原始碼編譯</h3></div></div></div><p>編譯世界 (<span class="emphasis"><em>world</em></span>) 即編譯整個作業系統除了核心 (Kernel)，要先做這個動作以便提供最新的工具來編譯核心，接著便可編譯核心：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make buildworld</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make buildkernel</code></strong></pre><p>編譯完的程式會寫入至 <code class="filename">/usr/obj</code>。</p><p>以上這些均為基本的步驟，用來控制編譯的其他選項在以下章節會說明。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-building-clean-build"></a>23.5.4.1. 執行清除編譯</h4></div></div></div><p>部份 FreeBSD 編譯系統版本會保留先前編譯的程式於暫存的物件目錄 <code class="filename">/usr/obj</code>，避免重新編譯那些尚未更動過的程式碼可加速後續的編譯動作，若要強制重新編譯所有東西可在開始編譯前使用 <code class="buildtarget">cleanworld</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>make cleanworld</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-building-jobs"></a>23.5.4.2. 設定工作數量</h4></div></div></div><p>在多核處理器上增加編譯工作的數量可增加編譯速度，可使用 <code class="command">sysctl hw.ncpu</code> 來查看有多少核心，不同處理器使用不同版本的 FreeBSD 編譯系統，所以唯一能了解不同工作數量對編譯速度影響的方式便是測試。在一開始可考慮選擇一個介於 1/2 到 2 倍核心數之間的數值，工作的數量可使用 <code class="option">-j</code> 來指定。</p><div class="example"><a id="updating-src-building-jobs-example"></a><div class="example-title">範例 23.1. 增加編譯工作數</div><div class="example-contents"><p>使用四個工作來編譯世界與核心：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>make -j4 buildworld buildkernel</code></strong></pre></div></div><br class="example-break" /></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-building-only-kernel"></a>23.5.4.3. 只編譯核心</h4></div></div></div><p>若原始碼有更動，便須執行 <code class="buildtarget">buildworld</code>，完成之後，便可隨時執行 <code class="buildtarget">buildkernel</code> 來編譯核心，若要只編譯核心可：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make buildkernel</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-building-custom-kernel"></a>23.5.4.4. 編譯自訂核心</h4></div></div></div><p>標準的 FreeBSD 核心是以一個名為 <code class="filename">GENERIC</code> 的<span class="emphasis"><em>核心設定檔 (Kernel config file)</em></span>為基礎，<code class="filename">GENERIC</code> 核心中內含了所有最常用的裝置驅動程式與選項，有時這個檔案對編譯自訂核心也非常有用，可根據其來加入或移除裝置驅動程式或選項來滿足特定需求。</p><p>例如，要開發一個 <acronym class="acronym">RAM</acronym> 受到嚴重限制的小型嵌入式電腦，便可移除不需要的裝置驅動程式或選項來縮小核心。</p><p>核心設定檔位於 <code class="filename">/usr/src/sys/<em class="replaceable"><code>arch</code></em>/conf/</code>，其中使用的 <em class="replaceable"><code>arch</code></em> 即為 <code class="command">uname -m</code> 輸出的結果，大部份的電腦為 <code class="literal">amd64</code>，那其設定檔目錄則為 <code class="filename">/usr/src/sys/<em class="replaceable"><code>amd64</code></em>/conf/</code>。</p><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="filename">/usr/src</code> 可以被刪除或重建，所以較建議將自訂核心設定檔放在另一個目錄，如 <code class="filename">/root</code>，並將核心設定檔以連結放至 <code class="filename">conf</code> 目錄，若該目錄被刪除或覆寫，便可重新建立一個新的核心設定的連結。</p></div><p>自訂設定檔可由複製 <code class="filename">GENERIC</code> 設定檔來建立，在此範例，新的自訂核心要用在儲存伺服器，所以將其命名為 <code class="filename">STORAGESERVER</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cp /usr/src/sys/amd64/conf/GENERIC /root/STORAGESERVER</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/amd64/conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /root/STORAGESERVER .</code></strong></pre><p>接著編譯 <code class="filename">/root/STORAGESERVER</code>，要加入或移除裝置或選項可見 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=config&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">config</span>(5)</span></a>。</p><p>自訂核心要在指令列設定 <code class="varname">KERNCONF</code> 為核心設定檔來編譯：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>make buildkernel KERNCONF=STORAGESERVER</code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-installing"></a>23.5.5. 安裝編譯好的程式</h3></div></div></div><p>在完成 <code class="buildtarget">buildworld</code> 與 <code class="buildtarget">buildkernel</code> 兩個步驟之後，便可安裝新的核心與世界：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installkernel</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installworld</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong></pre><p>若使用自訂核心，則同樣須設定 <code class="varname">KERNCONF</code> 來使用新的自訂核心：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installkernel KERNCONF=STORAGESERVER</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installworld</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-completing"></a>23.5.6. 完成更新</h3></div></div></div><p>還有最後一些的工作要做來完成更新，任何修改過的設定檔要與新版本的設定檔合併、移除找到的過時程式庫，然後重新啟動系統。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-completing-merge-mergemaster"></a>23.5.6.1. 使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> 合併設定檔案</h4></div></div></div><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> 可簡單的將修改過的系統設定檔與新版設定檔合併。</p><p>使用 <code class="option">-Ui</code>，<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> 會自動更新那些未被使用者修改過的設定檔並安裝尚不存在的檔案：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mergemaster -Ui</code></strong></pre><p>若檔案需要手動合併，會有互動式介面可讓使用者選擇要保留那一邊的檔案，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> 取得更多資訊。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-completing-check-old"></a>23.5.6.2. 檢查過時的檔案與程式庫</h4></div></div></div><p>部份廢棄的檔案或目錄可以在更新之後保留，可使用以下指令找出這些檔案：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>make check-old</code></strong></pre><p>並用以下指令刪除：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>make delete-old</code></strong></pre><p>部份廢棄的程式庫也可以保留下來，可使用以下指令來偵測這些程式庫：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>make check-old-libs</code></strong></pre><p>並使用以下指令刪除</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>make delete-old-libs</code></strong></pre><p>那些仍使用舊程式庫的程式將在刪除程式庫之後無法正常運作，而這些程式須要在刪除舊程式庫之後重新編譯或更換。</p><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml">當確認所有舊檔案或目錄可安全的刪除時，要避免刪除每一個檔案時均需按下 <span class="keycap"><strong>y</strong></span> 與 <span class="keycap"><strong>Enter</strong></span> 鍵可在指令設定 <code class="varname">BATCH_DELETE_OLD_FILES</code>，例如：</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>make BATCH_DELETE_OLD_FILES=yes delete-old-libs</code></strong></pre></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-completing-restart"></a>23.5.6.3. 更新後重新啟動</h4></div></div></div><p>更新之後的最後一個步驟便是重新啟動電腦，來讓所有的變更生效：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong></pre></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="small-lan"></a>23.6. 多部機器追蹤</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Mike</span> <span class="surname">Meyer</span></span>. </span></div></div></div><a id="idp80780472" class="indexterm"></a><p>當有多部主機需要追蹤相同的原始碼樹，要在每一部主機的系統下載原始碼與重新編譯所有的東西會耗費不少磁碟空間、網路頻寬與 <acronym class="acronym">CPU</acronym> 運算，要解決這個問題的方法是先在一部主機上做完大部份的工作，而其餘的主機透過 <acronym class="acronym">NFS</acronym> 掛載使用編譯完的成果。本節會介紹如何做這件事。要取得更多有關使用 <acronym class="acronym">NFS</acronym> 的資訊請參考 <a class="xref" href="#network-nfs" title="29.3. 網路檔案系統 (NFS)">節 29.3, “網路檔案系統 (NFS)”</a>。</p><p>首先，要先確認要執行同一組 Binary 的一群主機，這群主機又稱作 <em class="firstterm">建置集 (Build set)</em>，其中每部主機可以有自己的自訂核心，但會執行相同的 Userland binary。建置集中需挑選一部做為<em class="firstterm">建置主機 (Build machine)</em>，這部主機將會拿來編譯 World 與核心 (Kernel)，理想情況下，要挑選一部速度較快、有足夠的 <acronym class="acronym">CPU</acronym> 能夠執行 <code class="command">make buildworld</code> 與 <code class="command">make buildkernel</code> 的主機。</p><p>再挑選一部主機做為<em class="firstterm">測試主機 (Test machine)</em>，這部主機,要在將系統更新上正式運作的環境前做測試，這<span class="emphasis"><em>必須</em></span>一部能夠承受服務停止一段時間的主機，它也可是同時是建置主機，但不是一定要。</p><p>所有在此建置集中的主機需要透過 <acronym class="acronym">NFS</acronym> 掛載在建置主機上的 <code class="filename">/usr/obj</code> 與 <code class="filename">/usr/src</code>。在有多個建置集時，<code class="filename">/usr/src</code> 也應放在其中一部建置主機，然後由其他主機使用 <acronym class="acronym">NFS</acronym> 掛載。</p><p>確保在建置集中的所有主機的 <code class="filename">/etc/make.conf</code> 及 <code class="filename">/etc/src.conf</code> 與建置主機一致，這是由於建置主機必須編譯整個基礎系統 (Base system) 給所有建置集中的主機安裝。此外，每一部建置主機應在 <code class="filename">/etc/make.conf</code> 使用 <code class="varname">KERNCONF</code> 設定其核心名稱，且建置主機應列出所有要編譯的核心名稱在 <code class="varname">KERNCONF</code>，並且把自己要用的核心放在第一個。建置主機也必須有每部主機的核心設定檔在其 <code class="filename">/usr/src/sys/<em class="replaceable"><code>arch</code></em>/conf</code>。</p><p>在建置主機上，編譯核心與 World 如 <a class="xref" href="#makeworld" title="23.5. 從原始碼更新 FreeBSD">節 23.5, “從原始碼更新 FreeBSD”</a> 所述，但不要在建置主機上安裝所有編譯好的東西，而是要將編譯好的核心安裝到測試主機，在測試主機透過 <acronym class="acronym">NFS</acronym> 掛載 <code class="filename">/usr/src</code> 及 <code class="filename">/usr/obj</code>。然後執行 <code class="command">shutdown now</code> 進入單使用者模式來安裝新的核心與 World 並如同往常執行 <code class="command">mergemaster</code>。完成之後，重新開機回到正常的多使用者模式運作。</p><p>在測試主機上檢驗完所有東西皆運作正常之後，使用相同的程序將編譯好的結果安裝到在建置集中的其他主機。</p><p>同樣的方法也可用在 Port 樹，第一個步驟是透過 <acronym class="acronym">NFS</acronym> 共享 <code class="filename">/usr/ports</code> 給所有在建置集中的主機。要設定 <code class="filename">/etc/make.conf</code> 使用共享的 distfiles，可設定 <code class="varname">DISTDIR</code> 為由 <acronym class="acronym">NFS</acronym> 掛載對應到的使用者 <code class="systemitem">root</code> 可寫入的通用共享目錄。每一台主機應設定 <code class="varname">WRKDIRPREFIX</code> 到一個本地的編譯目錄，若 Port 要在本地編譯。或者，若建置系統要編譯並散佈套件到建置集中的主機可在建置系統上設定 <code class="varname">PACKAGES</code> 到一個類似 <code class="varname">DISTDIR</code> 的目錄。</p></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="dtrace"></a>章 24. DTrace</h2></div><div><span class="authorgroup">Written
	by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#dtrace-synopsis">24.1. 概述</a></span></dt><dt><span class="sect1"><a href="#dtrace-implementation">24.2. 實作差異</a></span></dt><dt><span class="sect1"><a href="#dtrace-enable">24.3. 開啟 DTrace 支援</a></span></dt><dt><span class="sect1"><a href="#dtrace-using">24.4. 使用 DTrace</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dtrace-synopsis"></a>24.1. 概述</h2></div></div></div><a id="idp80809016" class="indexterm"></a><a id="idp80809656" class="indexterm"></a><p xml:lang="en" lang="en">DTrace, also known as Dynamic Tracing, was developed by
      <span class="trademark">Sun</span>™ as a tool for locating performance bottlenecks in
      production and pre-production systems.  In addition to
      diagnosing performance problems, DTrace can be used to help
      investigate and debug unexpected behavior in both the FreeBSD
      kernel and in userland programs.</p><p xml:lang="en" lang="en">DTrace is a remarkable profiling tool, with an impressive
      array of features for diagnosing system issues.  It may also be
      used to run pre-written scripts to take advantage of its
      capabilities.  Users can author their own utilities using the
      DTrace D Language, allowing them to customize their profiling
      based on specific needs.</p><p xml:lang="en" lang="en">The FreeBSD implementation provides full support for kernel
      DTrace and experimental support for userland DTrace.
      Userland DTrace allows users to perform function boundary
      tracing for userland programs using the <code class="literal">pid</code>
      provider, and to insert static probes into userland programs for
      later tracing.  Some ports, such as
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/databases/postgres-server/pkg-descr">databases/postgres-server</a> and
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/lang/php56/pkg-descr">lang/php56</a> have a DTrace option to enable
      static probes.  FreeBSD 10.0-RELEASE has reasonably good userland
      DTrace support, but it is not considered production ready.  In
      particular, it is possible to crash traced programs.</p><p xml:lang="en" lang="en">The official guide to DTrace is maintained by the Illumos
      project at <code class="uri"><a class="uri" href="http://dtrace.org/guide" target="_top">DTrace
	Guide</a></code>.</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">What DTrace is and what features it provides.</p></li><li class="listitem"><p xml:lang="en" lang="en">Differences between the <span class="trademark">Solaris</span>™ DTrace
	  implementation and the one provided by FreeBSD.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to enable and use DTrace on FreeBSD.</p></li></ul></div><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>了解 <span class="trademark">UNIX</span>® 及 FreeBSD 基礎 (<a class="xref" href="#basics" title="章 3. FreeBSD 基礎">章 3, <em>FreeBSD 基礎</em></a>)。</p></li><li class="listitem"><p xml:lang="en" lang="en">Have some familiarity with security and how it pertains
	  to FreeBSD (<a class="xref" href="#security" title="章 13. 安全性">章 13, <em>安全性</em></a>).</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dtrace-implementation"></a>24.2. 實作差異</h2></div></div></div><p xml:lang="en" lang="en">While the DTrace in FreeBSD is similar to that found in
      <span class="trademark">Solaris</span>™, differences do exist.  The primary difference is that
      in FreeBSD, DTrace is implemented as a set of kernel modules and
      DTrace can not be used until the modules are loaded.  To load
      all of the necessary modules:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload dtraceall</code></strong></pre><p xml:lang="en" lang="en">Beginning with FreeBSD 10.0-RELEASE, the modules are
      automatically loaded when <code class="command">dtrace</code> is
      run.</p><p xml:lang="en" lang="en">FreeBSD uses the <code class="literal">DDB_CTF</code> kernel option to
      enable support for loading <acronym class="acronym">CTF</acronym> data from
      kernel modules and the kernel itself.  <acronym class="acronym">CTF</acronym> is
      the <span class="trademark">Solaris</span>™ Compact C Type Format which encapsulates a reduced
      form of debugging information similar to
      <acronym class="acronym">DWARF</acronym> and the venerable stabs.
      <acronym class="acronym">CTF</acronym> data is added to binaries by the
      <code class="command">ctfconvert</code> and <code class="command">ctfmerge</code>
      build tools.  The <code class="command">ctfconvert</code> utility parses
      <acronym class="acronym">DWARF</acronym> <acronym class="acronym">ELF</acronym> debug sections
      created by the compiler and <code class="command">ctfmerge</code> merges
      <acronym class="acronym">CTF</acronym> <acronym class="acronym">ELF</acronym> sections from
      objects into either executables or shared libraries.</p><p xml:lang="en" lang="en">Some different providers exist for FreeBSD than for <span class="trademark">Solaris</span>™.
      Most notable is the <code class="literal">dtmalloc</code> provider, which
      allows tracing <code class="function">malloc()</code> by type in the FreeBSD
      kernel.  Some of the providers found in <span class="trademark">Solaris</span>™, such as
      <code class="literal">cpc</code> and <code class="literal">mib</code>, are not
      present in FreeBSD.  These may appear in future versions of FreeBSD.
      Moreover, some of the providers available in both operating
      systems are not compatible, in the sense that their probes have
      different argument types.  Thus, <acronym class="acronym">D</acronym> scripts
      written on <span class="trademark">Solaris</span>™ may or may not work unmodified on FreeBSD, and
      vice versa.</p><p xml:lang="en" lang="en">Due to security differences, only <code class="systemitem">root</code> may use DTrace on FreeBSD.
      <span class="trademark">Solaris</span>™ has a few low level security checks which do not yet
      exist in FreeBSD.  As such, the
      <code class="filename">/dev/dtrace/dtrace</code> is strictly limited to
      <code class="systemitem">root</code>.</p><p xml:lang="en" lang="en">DTrace falls under the Common Development and Distribution
      License (<acronym class="acronym">CDDL</acronym>) license.  To view this license
      on FreeBSD, see
      <code class="filename">/usr/src/cddl/contrib/opensolaris/OPENSOLARIS.LICENSE</code>
      or view it online at <code class="uri"><a class="uri" href="http://opensource.org/licenses/CDDL-1.0" target="_top">http://opensource.org/licenses/CDDL-1.0</a></code>.
      While a FreeBSD kernel with DTrace support is
      <acronym class="acronym">BSD</acronym> licensed, the <acronym class="acronym">CDDL</acronym> is
      used when the modules are distributed in binary form or the
      binaries are loaded.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dtrace-enable"></a>24.3. 開啟 DTrace 支援</h2></div></div></div><p xml:lang="en" lang="en">In FreeBSD 9.2 and 10.0, DTrace support is built into the
      <code class="filename">GENERIC</code> kernel.  Users of earlier versions
      of FreeBSD or who prefer to statically compile in DTrace support
      should add the following lines to a custom kernel configuration
      file and recompile the kernel using the instructions in <a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a>:</p><pre xml:lang="en" class="programlisting" lang="en">options         KDTRACE_HOOKS
options         DDB_CTF
makeoptions	DEBUG=-g
makeoptions	WITH_CTF=1</pre><p xml:lang="en" lang="en">Users of the AMD64 architecture should also add this
      line:</p><pre xml:lang="en" class="programlisting" lang="en">options         KDTRACE_FRAME</pre><p xml:lang="en" lang="en">This option provides support for <acronym class="acronym">FBT</acronym>.
      While DTrace will work without this option, there will be
      limited support for function boundary tracing.</p><p xml:lang="en" lang="en">Once the FreeBSD system has rebooted into the new kernel, or
      the DTrace kernel modules have been loaded using
      <code class="command">kldload dtraceall</code>, the system will need
      support for the Korn shell as the DTrace
      Toolkit has several utilities written in <code class="command">ksh</code>.
      Make sure that the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/shells/ksh93/pkg-descr">shells/ksh93</a> package or
      port is installed.  It is also possible to run these tools under
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/shells/pdksh/pkg-descr">shells/pdksh</a> or
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/shells/mksh/pkg-descr">shells/mksh</a>.</p><p xml:lang="en" lang="en">Finally, install the current DTrace Toolkit,
      a collection of ready-made scripts
      for collecting system information.  There are scripts to check
      open files, memory, <acronym class="acronym">CPU</acronym> usage, and a lot
      more.  FreeBSD 10
      installs a few of these scripts into
      <code class="filename">/usr/share/dtrace</code>.  On other FreeBSD versions,
      or to install the full
      DTrace Toolkit, use the
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/DTraceToolkit/pkg-descr">sysutils/DTraceToolkit</a> package or
      port.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The scripts found in
	<code class="filename">/usr/share/dtrace</code> have been specifically
	ported to FreeBSD.  Not all of the scripts found in the DTrace
	Toolkit will work as-is on FreeBSD and some scripts may require
	some effort in order for them to work on FreeBSD.</p></div><p xml:lang="en" lang="en">The DTrace Toolkit includes many scripts in the special
      language of DTrace.  This language is called the D language
      and it is very similar to C++.  An in depth discussion of the
      language is beyond the scope of this document.  It is
      covered extensively in the <code class="uri"><a class="uri" href="http://www.dtrace.org/guide" target="_top">Illumos Dynamic
	Tracing Guide</a></code>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dtrace-using"></a>24.4. 使用 DTrace</h2></div></div></div><p xml:lang="en" lang="en">DTrace scripts consist of a list of one or more
      <em class="firstterm">probes</em>, or instrumentation points, where
      each probe is associated with an action.  Whenever the condition
      for a probe is met, the associated action is executed.  For
      example, an action may occur when a file is opened, a process is
      started, or a line of code is executed.  The action might be to
      log some information or to modify context variables.  The
      reading and writing of context variables allows probes to share
      information and to cooperatively analyze the correlation of
      different events.</p><p xml:lang="en" lang="en">To view all probes, the administrator can execute the
      following command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>dtrace -l | more</code></strong></pre><p xml:lang="en" lang="en">Each probe has an <code class="literal">ID</code>, a
      <code class="literal">PROVIDER</code> (dtrace or fbt), a
      <code class="literal">MODULE</code>, and a
      <code class="literal">FUNCTION NAME</code>.    Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dtrace&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dtrace</span>(1)</span></a> for
      more information about this command.</p><p xml:lang="en" lang="en">The examples in this section provide an overview of how to
      use two of the fully supported scripts from the
      DTrace Toolkit: the
      <code class="filename">hotkernel</code> and
      <code class="filename">procsystime</code> scripts.</p><p xml:lang="en" lang="en">The <code class="filename">hotkernel</code> script is designed to
      identify which function is using the most kernel time.  It will
      produce output similar to the following:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/share/dtrace/toolkit</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>./hotkernel</code></strong>
Sampling... Hit Ctrl-C to end.</pre><p xml:lang="en" lang="en">As instructed, use the
      <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span> key combination to stop the process.  Upon
      termination, the script will display a list of kernel functions
      and timing information, sorting the output in increasing order
      of time:</p><pre xml:lang="en" class="screen" lang="en">kernel`_thread_lock_flags                                   2   0.0%
0xc1097063                                                  2   0.0%
kernel`sched_userret                                        2   0.0%
kernel`kern_select                                          2   0.0%
kernel`generic_copyin                                       3   0.0%
kernel`_mtx_assert                                          3   0.0%
kernel`vm_fault                                             3   0.0%
kernel`sopoll_generic                                       3   0.0%
kernel`fixup_filename                                       4   0.0%
kernel`_isitmyx                                             4   0.0%
kernel`find_instance                                        4   0.0%
kernel`_mtx_unlock_flags                                    5   0.0%
kernel`syscall                                              5   0.0%
kernel`DELAY                                                5   0.0%
0xc108a253                                                  6   0.0%
kernel`witness_lock                                         7   0.0%
kernel`read_aux_data_no_wait                                7   0.0%
kernel`Xint0x80_syscall                                     7   0.0%
kernel`witness_checkorder                                   7   0.0%
kernel`sse2_pagezero                                        8   0.0%
kernel`strncmp                                              9   0.0%
kernel`spinlock_exit                                       10   0.0%
kernel`_mtx_lock_flags                                     11   0.0%
kernel`witness_unlock                                      15   0.0%
kernel`sched_idletd                                       137   0.3%
0xc10981a5                                              42139  99.3%</pre><p xml:lang="en" lang="en">This script will also work with kernel modules.  To use this
      feature, run the script with <code class="option">-m</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>./hotkernel -m</code></strong>
Sampling... Hit Ctrl-C to end.
^C
MODULE                                                  COUNT   PCNT
0xc107882e                                                  1   0.0%
0xc10e6aa4                                                  1   0.0%
0xc1076983                                                  1   0.0%
0xc109708a                                                  1   0.0%
0xc1075a5d                                                  1   0.0%
0xc1077325                                                  1   0.0%
0xc108a245                                                  1   0.0%
0xc107730d                                                  1   0.0%
0xc1097063                                                  2   0.0%
0xc108a253                                                 73   0.0%
kernel                                                    874   0.4%
0xc10981a5                                             213781  99.6%</pre><p xml:lang="en" lang="en">The <code class="filename">procsystime</code> script captures and
      prints the system call time usage for a given process
      <acronym class="acronym">ID</acronym> (<acronym class="acronym">PID</acronym>) or process name.
      In the following example, a new instance of
      <code class="filename">/bin/csh</code> was spawned.  Then,
      <code class="filename">procsystime</code> was executed and remained
      waiting while a few commands were typed on the other incarnation
      of <code class="command">csh</code>.  These are the results of this
      test:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>./procsystime -n csh</code></strong>
Tracing... Hit Ctrl-C to end...
^C

Elapsed Times for processes csh,

         SYSCALL          TIME (ns)
          getpid               6131
       sigreturn               8121
           close              19127
           fcntl              19959
             dup              26955
         setpgid              28070
            stat              31899
       setitimer              40938
           wait4              62717
       sigaction              67372
     sigprocmask             119091
    gettimeofday             183710
           write             263242
          execve             492547
           ioctl             770073
           vfork            3258923
      sigsuspend            6985124
            read         3988049784</pre><p xml:lang="en" lang="en">As shown, the <code class="function">read()</code> system call used
      the most time in nanoseconds while the
      <code class="function">getpid()</code> system call used the least amount
      of time.</p></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="usb-device-mode"></a>章 25. USB Device Mode / USB OTG</h2></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#usb-device-mode-synopsis">25.1. 概述</a></span></dt><dt><span class="sect1"><a href="#usb-device-mode-terminals">25.2. <acronym class="acronym">USB</acronym> 虛擬序列埠</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp80971576">25.2.1. 設定 USB 裝置模式序列埠</a></span></dt><dt><span class="sect2"><a href="#idp80983224">25.2.2. 自 FreeBSD 連線到 USB 裝置模式序列埠</a></span></dt><dt><span class="sect2"><a href="#idp80986424">25.2.3. 自 macOS 連線到 USB 裝置模式序列埠</a></span></dt><dt><span class="sect2"><a href="#idp80992824">25.2.4. 自 Linux 連線到 USB 裝置模式序列埠</a></span></dt><dt><span class="sect2"><a href="#idp80995128">25.2.5. 自 Microsoft Windows 10 連線到 USB 裝置模式序列埠</a></span></dt></dl></dd><dt><span class="sect1"><a href="#usb-device-mode-network">25.3. <acronym class="acronym">USB</acronym> 裝置模式網路介面</a></span></dt><dt><span class="sect1"><a href="#usb-device-mode-storage">25.4. <acronym class="acronym">USB</acronym> 虛擬儲存裝置</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp81016120">25.4.1. 使用 cfumass 啟動 Script 設定 USB 大容量儲存目標</a></span></dt><dt><span class="sect2"><a href="#idp81037880">25.4.2. 使用其他方式設定 USB 大容量存儲目標</a></span></dt></dl></dd></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="usb-device-mode-synopsis"></a>25.1. 概述</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Edward Tomasz</span> <span class="surname">Napierala</span></span>. </span></div></div></div><p xml:lang="en" lang="en">This chapter covers the use of USB Device Mode and USB On
      The Go (<acronym class="acronym">USB OTG</acronym>) in FreeBSD.  This includes
      virtual serial consoles, virtual network interfaces, and
      virtual USB drives.</p><p xml:lang="en" lang="en">When running on hardware that supports USB device mode
      or <acronym class="acronym">USB OTG</acronym>, like that built into
      many embedded boards, the FreeBSD <acronym class="acronym">USB</acronym> stack
      can run in <span class="emphasis"><em>device mode</em></span>.  Device mode
      makes it possible for the computer to present itself as
      different kinds of <acronym class="acronym">USB</acronym> device classes,
      including serial ports, network adapters, and mass storage,
      or a combination thereof.  A <acronym class="acronym">USB</acronym> host like
      a laptop or desktop computer is able to access them just like
      physical <acronym class="acronym">USB</acronym> devices.  Device mode is
      sometimes called the <span class="quote">“<span class="quote">USB gadget mode</span>”</span>.</p><p xml:lang="en" lang="en">There are two basic ways the hardware can provide the
      device mode functionality: with a separate "client port", which
      only supports the device mode, and with a USB OTG port, which
      can provide both device and host mode.  For
      <acronym class="acronym">USB OTG</acronym> ports, the <acronym class="acronym">USB</acronym>
      stack switches between host-side and device-side automatically,
      depending on what is connected to the port.  Connecting a
      <acronym class="acronym">USB</acronym> device like a memory stick to the
      port causes FreeBSD to switch to host mode.  Connecting a
      <acronym class="acronym">USB</acronym> host like a computer causes FreeBSD to
      switch to device mode.  Single purpose "client ports" always
      work in device mode.</p><p xml:lang="en" lang="en">What FreeBSD presents to the <acronym class="acronym">USB</acronym> host
      depends on the <code class="varname">hw.usb.template</code> sysctl.  Some
      templates provide a single device, such as a serial terminal;
      others provide multiple ones, which can all be used at the same
      time.  An example is the template 10, which provides a mass
      storage device, a serial console, and a network interface.
      See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=usb_template&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">usb_template</span>(4)</span></a> for the list of available
      values.</p><p xml:lang="en" lang="en">Note that in some cases, depending on the hardware and the
      hosts operating system, for the host to notice the configuration
      change, it must be either physically disconnected and
      reconnected, or forced to rescan the <acronym class="acronym">USB</acronym>
      bus in a system-specific way.  When FreeBSD is running on the host,
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=usbconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">usbconfig</span>(8)</span></a> <code class="command">reset</code> can be used.
      This also must be done after loading
      <code class="filename">usb_template.ko</code> if the
      <acronym class="acronym">USB</acronym> host was already connected to the
      <acronym class="acronym">USB</acronym> <acronym class="acronym">OTG</acronym> socket.</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">How to set up USB Device Mode functionality on
	  FreeBSD.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to configure the virtual serial port on
	  FreeBSD.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to connect to the virtual serial port
	  from various operating systems.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to configure FreeBSD to provide a virtual
	  <acronym class="acronym">USB</acronym> network interface.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to configure FreeBSD to provide a virtual
	  <acronym class="acronym">USB</acronym> storage device.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="usb-device-mode-terminals"></a>25.2. <acronym class="acronym">USB</acronym> 虛擬序列埠</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80971576"></a>25.2.1. 設定 USB 裝置模式序列埠</h3></div></div></div><p xml:lang="en" lang="en">Virtual serial port support is provided by templates
	number 3, 8, and 10.  Note that template 3 works with
	Microsoft Windows 10 without the need for special drivers
	and INF files.  Other host operating systems work with all
	three templates.  Both <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=usb_template&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">usb_template</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=umodem&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">umodem</span>(4)</span></a>
	kernel modules must be loaded.</p><p xml:lang="en" lang="en">To enable USB device mode serial ports, add those lines
	to <code class="filename">/etc/ttys</code>:</p><pre xml:lang="en" class="screen" lang="en">ttyU0	"/usr/libexec/getty 3wire"	vt100	onifconsole secure
ttyU1	"/usr/libexec/getty 3wire"	vt100	onifconsole secure</pre><p>然後加入這些行到 <code class="filename">/etc/devd.conf</code>：</p><pre xml:lang="en" class="screen" lang="en">notify 100 {
	match "system"		"DEVFS";
	match "subsystem"	"CDEV";
	match "type"		"CREATE";
	match "cdev"		"ttyU[0-9]+";
	action "/sbin/init q";
};</pre><p xml:lang="en" lang="en">Reload the configuration if
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a> is already running:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service devd restart</code></strong></pre><p xml:lang="en" lang="en">Make sure the necessary modules are loaded and the
	correct template is set at boot by adding
	those lines to <code class="filename">/boot/loader.conf</code>,
	creating it if it does not already exist:</p><pre xml:lang="en" class="screen" lang="en">umodem_load="YES"
hw.usb.template=3</pre><p xml:lang="en" lang="en">To load the module and set the template without rebooting
	use:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload umodem</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.usb.template=3</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80983224"></a>25.2.2. 自 FreeBSD 連線到 USB 裝置模式序列埠</h3></div></div></div><p xml:lang="en" lang="en">To connect to a board configured to provide USB device
	mode serial ports, connect the USB host, such as a laptop, to
	the boards USB OTG or USB client port.  Use
	<code class="command">pstat -t</code> on the host to list the terminal
	lines.  Near the end of the list you should see a USB serial
	port, eg "ttyU0".  To open the connection, use:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cu -l /dev/ttyU0</code></strong></pre><p xml:lang="en" lang="en">After pressing the Enter key a few times you will see
	a login prompt.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80986424"></a>25.2.3. 自 macOS 連線到 USB 裝置模式序列埠</h3></div></div></div><p xml:lang="en" lang="en">To connect to a board configured to provide USB device
	mode serial ports, connect the USB host, such as a laptop,
	to the boards USB OTG or USB client port.  To open the
	connection, use:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cu -l /dev/cu.usbmodemFreeBSD1</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80992824"></a>25.2.4. 自 Linux 連線到 USB 裝置模式序列埠</h3></div></div></div><p xml:lang="en" lang="en">To connect to a board configured to provide USB device
	mode serial ports, connect the USB host, such as a laptop,
	to the boards USB OTG or USB client port.  To open the
	connection, use:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>minicom -D /dev/ttyACM0</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80995128"></a>25.2.5. 自 Microsoft Windows 10 連線到 USB 裝置模式序列埠</h3></div></div></div><p xml:lang="en" lang="en">To connect to a board configured to provide USB device
	mode serial ports, connect the USB host, such as a laptop,
	to the boards USB OTG or USB client port.  To open a
	connection you will need a serial terminal program, such as
	<span class="application">PuTTY</span>.  To check the COM port name
	used by Windows, run Device Manager, expand "Ports (COM &amp;
	LPT)".  You will see a name similar to "USB Serial Device
	(COM4)".  Run serial terminal program of your choice, for
	example <span class="application">PuTTY</span>.  In the
	<span class="application">PuTTY</span> dialog set "Connection type"
	to "Serial", type the COMx obtained from Device Manager in the
	"Serial line" dialog box and click Open.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="usb-device-mode-network"></a>25.3. <acronym class="acronym">USB</acronym> 裝置模式網路介面</h2></div></div></div><p xml:lang="en" lang="en">Virtual network interfaces support is provided by templates
      number 1, 8, and 10.  Note that none of them works with
      Microsoft Windows.  Other host operating systems work with all
      three templates.  Both <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=usb_template&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">usb_template</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=if_cdce&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">if_cdce</span>(4)</span></a>
      kernel modules must be loaded.</p><p xml:lang="en" lang="en">Make sure the necessary modules are loaded and the correct
      template is set at boot by adding
      those lines to <code class="filename">/boot/loader.conf</code>, creating
      it if it does not already exist:</p><pre xml:lang="en" class="screen" lang="en">if_cdce_load="YES"
hw.usb.template=1</pre><p xml:lang="en" lang="en">To load the module and set the template without rebooting
      use:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload if_cdce</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.usb.template=1</code></strong></pre></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="usb-device-mode-storage"></a>25.4. <acronym class="acronym">USB</acronym> 虛擬儲存裝置</h2></div></div></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cfumass&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cfumass</span>(4)</span></a> 驅動程式是一個在 FreeBSD 12.0 之後才可用的 <acronym class="acronym">USB</acronym> 裝置模式驅動程式。</p></div><p xml:lang="en" lang="en">Mass Storage target is provided by templates 0 and 10.
      Both <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=usb_template&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">usb_template</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cfumass&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cfumass</span>(4)</span></a> kernel modules
      must be loaded.  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cfumass&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cfumass</span>(4)</span></a> interfaces to the CTL
      subsystem, the same one that is used for
      <acronym class="acronym">iSCSI</acronym> or Fibre Channel targets.
      On the host side, <acronym class="acronym">USB</acronym> Mass Storage
      initiators can only access a single <acronym class="acronym">LUN</acronym>,
      <acronym class="acronym">LUN</acronym> 0.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81016120"></a>25.4.1. 使用 cfumass 啟動 Script 設定 USB 大容量儲存目標</h3></div></div></div><p xml:lang="en" lang="en">The simplest way to set up a read-only USB storage target
	is to use the <code class="filename">cfumass</code> rc script.  To
	configure it this way, copy the files to be presented to the
	USB host machine into the <code class="literal">/var/cfumass</code>
	directory, and add this line to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">cfumass_enable="YES"</pre><p xml:lang="en" lang="en">To configure the target without restarting,
	run this command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service cfumass start</code></strong></pre><p xml:lang="en" lang="en">Differently from serial and network functionality, the
	template should not be set to 0 or 10 in
	<code class="filename">/boot/loader.conf</code>.  This is because the
	LUN must be set up before setting the template.  The cfumass
	startup script sets the correct template number automatically
	when started.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81037880"></a>25.4.2. 使用其他方式設定 USB 大容量存儲目標</h3></div></div></div><p xml:lang="en" lang="en">The rest of this chapter provides detailed description of
	setting the target without using the cfumass rc file.  This is
	necessary if eg one wants to provide a writeable LUN.</p><p xml:lang="en" lang="en"><acronym class="acronym">USB</acronym> Mass Storage does not require the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> daemon to be running, although it can be used if
	desired.  This is different from <acronym class="acronym">iSCSI</acronym>.
	Thus, there are two ways to configure the target:
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctladm&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctladm</span>(8)</span></a>, or <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a>.  Both require the
	<code class="filename">cfumass.ko</code> kernel module to be loaded.
	The module can be loaded manually:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload cfumass</code></strong></pre><p xml:lang="en" lang="en">If <code class="filename">cfumass.ko</code> has not been built into
	the kernel, <code class="filename">/boot/loader.conf</code> can be set
	to load the module at boot:</p><pre xml:lang="en" class="programlisting" lang="en">cfumass_load="YES"</pre><p xml:lang="en" lang="en">A <acronym class="acronym">LUN</acronym> can be created without the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> daemon:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ctladm create -b block -o file=/data/target0</code></strong></pre><p xml:lang="en" lang="en">This presents the contents of the image file
	<code class="filename">/data/target0</code> as a <acronym class="acronym">LUN</acronym>
	to the <acronym class="acronym">USB</acronym> host.  The file must exist
	before executing the command.  To configure the
	<acronym class="acronym">LUN</acronym> at system startup, add the command to
	<code class="filename">/etc/rc.local</code>.</p><p xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> can also be used to manage
	<acronym class="acronym">LUN</acronym>s.  Create
	<code class="filename">/etc/ctl.conf</code>, add a line to
	<code class="filename">/etc/rc.conf</code> to make sure <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> is
	automatically started at boot, and then start the
	daemon.</p><p xml:lang="en" lang="en">This is an example of a simple
	<code class="filename">/etc/ctl.conf</code> configuration file.  Refer
	to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctl.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctl.conf</span>(5)</span></a> for a more complete description of the
	options.</p><pre xml:lang="en" class="programlisting" lang="en">target naa.50015178f369f092 {
	lun 0 {
		path /data/target0
		size 4G
	}
}</pre><p xml:lang="en" lang="en">The example creates a single target with a single
	<acronym class="acronym">LUN</acronym>.  The
	<code class="literal">naa.50015178f369f092</code> is a device identifier
	composed of 32 random hexadecimal digits.  The
	<code class="literal">path</code> line defines the full path to a file
	or zvol backing the <acronym class="acronym">LUN</acronym>.  That file must
	exist before starting <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a>.  The second line is
	optional and specifies the size of the
	<acronym class="acronym">LUN</acronym>.</p><p xml:lang="en" lang="en">To make sure the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> daemon is started at
	boot, add this line to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">ctld_enable="YES"</pre><p xml:lang="en" lang="en">To start <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> now, run this command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service ctld start</code></strong></pre><p>當 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> Daemon 啟動後，它會讀取 <code class="filename">/etc/ctl.conf</code>，若這個檔案在 Daemon 啟動之後才做修改，要重新載入變更的內容才能立即生效：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service ctld reload</code></strong></pre></div></div></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-communication"></a>部 IV. 網路通訊</h1></div></div></div><div class="partintro"><div xmlns=""></div><p>FreeBSD 是一種廣泛的被使用在高效能的網路伺服器中的作業系統，這些章節包含了：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>序列通訊</p></li><li class="listitem"><p><acronym class="acronym">PPP</acronym> 和在乙太網路使用 <acronym class="acronym">PPP</acronym></p></li><li class="listitem"><p>電子郵件</p></li><li class="listitem"><p>執行網路伺服器</p></li><li class="listitem"><p>防火牆</p></li><li class="listitem"><p>其他的進階網路主題</p></li></ul></div><p>這些章節是讓您在需要查資料的時候翻閱用的。 您不需要依照特定的順序來讀，也不需要將這些章節全部讀過之後才將 FreeBSD 用在網路環境下。</p><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="chapter"><a href="#serialcomms">26. 序列通訊</a></span></dt><dd><dl><dt><span class="sect1"><a href="#serial-synopsis">26.1. 概述</a></span></dt><dt><span class="sect1"><a href="#serial">26.2. 序列術語與硬體</a></span></dt><dd><dl><dt><span class="sect2"><a href="#term-cables-null">26.2.1. 序列線與埠</a></span></dt><dt><span class="sect2"><a href="#serial-hw-config">26.2.2. 序列埠設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#term">26.3. 終端機</a></span></dt><dd><dl><dt><span class="sect2"><a href="#term-config">26.3.1. 終端機設定</a></span></dt><dt><span class="sect2"><a href="#term-debug">26.3.2. 連線疑難排解</a></span></dt></dl></dd><dt><span class="sect1"><a href="#dialup">26.4. 撥入服務</a></span></dt><dd><dl><dt><span class="sect2"><a href="#dialup-ttys">26.4.1. 數據機設定</a></span></dt><dt><span class="sect2"><a href="#idp81703992">26.4.2. 疑難排解</a></span></dt></dl></dd><dt><span class="sect1"><a href="#dialout">26.5. 撥出服務</a></span></dt><dd><dl><dt><span class="sect2"><a href="#hayes-unsupported">26.5.1. 使用 Stock Hayes 數據機</a></span></dt><dt><span class="sect2"><a href="#direct-at">26.5.2. 使用 <code class="literal">AT</code> 指令</a></span></dt><dt><span class="sect2"><a href="#gt-failure">26.5.3. <code class="literal">@</code> 符號無法運作</a></span></dt><dt><span class="sect2"><a href="#dial-command-line">26.5.4. 從指令列撥號</a></span></dt><dt><span class="sect2"><a href="#set-bps">26.5.5. 設定 <acronym class="acronym">bps</acronym> 率</a></span></dt><dt><span class="sect2"><a href="#terminal-server">26.5.6. 透過終端伺服器存取多個主機</a></span></dt><dt><span class="sect2"><a href="#tip-multiline">26.5.7. 在 <code class="command">tip</code> 使用超過一行</a></span></dt><dt><span class="sect2"><a href="#multi-controlp">26.5.8. 使用強制字元</a></span></dt><dt><span class="sect2"><a href="#uppercase">26.5.9. 大寫字元</a></span></dt><dt><span class="sect2"><a href="#tip-filetransfer">26.5.10. 使用 <code class="command">tip</code> 傳輸檔案</a></span></dt><dt><span class="sect2"><a href="#zmodem-tip">26.5.11. 在 <span class="application">zmodem</span> 使用 <code class="command">tip</code>?</a></span></dt></dl></dd><dt><span class="sect1"><a href="#serialconsole-setup">26.6. 設定序列 Console</a></span></dt><dd><dl><dt><span class="sect2"><a href="#serialconsole-howto-fast">26.6.1. 快速序列 Console 設定</a></span></dt><dt><span class="sect2"><a href="#serialconsole-howto">26.6.2. 深入序列 Console 設定</a></span></dt><dt><span class="sect2"><a href="#idp82032696">26.6.3. 設定使用更快的序列埠速度</a></span></dt><dt><span class="sect2"><a href="#serialconsole-ddb">26.6.4. 從序列線路 (Serial Line) 進入 DDB 除錯程式</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ppp-and-slip">27. <acronym class="acronym">PPP</acronym></a></span></dt><dd><dl><dt><span class="sect1"><a href="#ppp-and-slip-synopsis">27.1. 概述</a></span></dt><dt><span class="sect1"><a href="#userppp">27.2. 設定 <acronym class="acronym">PPP</acronym></a></span></dt><dd><dl><dt><span class="sect2"><a href="#userppp-staticIP">27.2.1. 基礎設定</a></span></dt><dt><span class="sect2"><a href="#idp82200248">27.2.2. 進階設定</a></span></dt><dd><dl><dt><span class="sect3"><a href="#userppp-PAPnCHAP">27.2.2.1. PAP 與 CHAP 認證</a></span></dt><dt><span class="sect3"><a href="#userppp-nat">27.2.2.2. 使用 <acronym class="acronym">PPP</acronym> 網路位址轉譯功能</a></span></dt></dl></dd><dt><span class="sect2"><a href="#userppp-final">27.2.3. 最終系統設定</a></span></dt><dt><span class="sect2"><a href="#idp82282808">27.2.4. 使用 <code class="command">ppp</code></a></span></dt><dt><span class="sect2"><a href="#userppp-mgetty">27.2.5. 設定撥入服務</a></span></dt></dl></dd><dt><span class="sect1"><a href="#ppp-troubleshoot">27.3. <acronym class="acronym">PPP</acronym> 連線疑難排解</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp82359736">27.3.1. 檢查裝置節點</a></span></dt><dt><span class="sect2"><a href="#idp82387256">27.3.2. 手動連線</a></span></dt><dt><span class="sect2"><a href="#idp82444856">27.3.3. 除錯</a></span></dt></dl></dd><dt><span class="sect1"><a href="#pppoe">27.4. 在乙太網路使用 <acronym class="acronym">PPP</acronym> (PPPoE)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp82493624">27.4.1. 使用 PPPoE 服務標籤</a></span></dt><dt><span class="sect2"><a href="#ppp-3com">27.4.2. 在 <span class="trademark">3Com</span>® <span class="trademark">HomeConnect</span>® ADSL Modem Dual Link 使用 PPPoE</a></span></dt></dl></dd><dt><span class="sect1"><a href="#pppoa">27.5. 在 ATM 使用 <span class="application">PPP</span> (PPPoA)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp82532408">27.5.1. 使用 mpd</a></span></dt><dt><span class="sect2"><a href="#idp82577720">27.5.2. 使用 pptpclient</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#mail">28. 電子郵件</a></span></dt><dd><dl><dt><span class="sect1"><a href="#mail-synopsis">28.1. 概述</a></span></dt><dt><span class="sect1"><a href="#mail-using">28.2. 郵件組成</a></span></dt><dt><span class="sect1"><a href="#sendmail">28.3. <span class="application">Sendmail</span> 設定檔</a></span></dt><dt><span class="sect1"><a href="#mail-changingmta">28.4. 更改郵件傳輸代理程式</a></span></dt><dd><dl><dt><span class="sect2"><a href="#mail-disable-sendmail">28.4.1. 關閉 <span class="application">Sendmail</span></a></span></dt><dt><span class="sect2"><a href="#idp82840376">28.4.2. 替換預設的 <acronym class="acronym">MTA</acronym></a></span></dt></dl></dd><dt><span class="sect1"><a href="#mail-trouble">28.5. 疑難排解</a></span></dt><dt><span class="sect1"><a href="#mail-advanced">28.6. 進階主題</a></span></dt><dd><dl><dt><span class="sect2"><a href="#mail-config">28.6.1. 基礎設定</a></span></dt><dt><span class="sect2"><a href="#mail-domain">28.6.2. 網域中的郵件</a></span></dt></dl></dd><dt><span class="sect1"><a href="#outgoing-only">28.7. 寄件設定</a></span></dt><dt><span class="sect1"><a href="#SMTP-dialup">28.8. 在撥號連線使用郵件</a></span></dt><dt><span class="sect1"><a href="#SMTP-Auth">28.9. SMTP 認證</a></span></dt><dt><span class="sect1"><a href="#mail-agents">28.10. 郵件使用者代理程式</a></span></dt><dd><dl><dt><span class="sect2"><a href="#mail-command">28.10.1. <code class="command">mail</code></a></span></dt><dt><span class="sect2"><a href="#mutt-command">28.10.2. <span class="application">mutt</span></a></span></dt><dt><span class="sect2"><a href="#alpine-command">28.10.3. <span class="application">alpine</span></a></span></dt></dl></dd><dt><span class="sect1"><a href="#mail-fetchmail">28.11. 使用 <span class="application">fetchmail</span></a></span></dt><dt><span class="sect1"><a href="#mail-procmail">28.12. 使用 <span class="application">procmail</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#network-servers">29. 網路伺服器</a></span></dt><dd><dl><dt><span class="sect1"><a href="#network-servers-synopsis">29.1. 概述</a></span></dt><dt><span class="sect1"><a href="#network-inetd">29.2. <span class="application">inetd</span> 超級伺服器</a></span></dt><dd><dl><dt><span class="sect2"><a href="#network-inetd-conf">29.2.1. 設定檔</a></span></dt><dt><span class="sect2"><a href="#network-inetd-cmdline">29.2.2. 指令列選項</a></span></dt><dt><span class="sect2"><a href="#network-inetd-security">29.2.3. 安全注意事項</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-nfs">29.3. 網路檔案系統 (NFS)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#network-configuring-nfs">29.3.1. 設定伺服器</a></span></dt><dt><span class="sect2"><a href="#idp83702456">29.3.2. 設定客戶端</a></span></dt><dt><span class="sect2"><a href="#idp83728824">29.3.3. 鎖定</a></span></dt><dt><span class="sect2"><a href="#network-amd">29.3.4. 使用 amd(8) 自動掛載</a></span></dt><dt><span class="sect2"><a href="#network-autofs">29.3.5. 使用 autofs(5) 自動掛載</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-nis">29.4. 網路資訊系統 (<acronym class="acronym">NIS</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp83887672">29.4.1. <acronym class="acronym">NIS</acronym> 術語與程序</a></span></dt><dt><span class="sect2"><a href="#idp83921080">29.4.2. 主機類型</a></span></dt><dt><span class="sect2"><a href="#idp83955640">29.4.3. 規劃注意事項</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp83975608">29.4.3.1. 選擇 <acronym class="acronym">NIS</acronym> 網域名稱</a></span></dt><dt><span class="sect3"><a href="#idp83999928">29.4.3.2. 實體伺服器需求</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp84004152">29.4.4. 設定 <acronym class="acronym">NIS</acronym> Master 伺服器</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp84030904">29.4.4.1. 初始化 <acronym class="acronym">NIS</acronym> 對應表</a></span></dt><dt><span class="sect3"><a href="#idp84066616">29.4.4.2. 新增使用者</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp84086200">29.4.5. 設定 <acronym class="acronym">NIS</acronym> Slave 伺服器</a></span></dt><dt><span class="sect2"><a href="#idp84109752">29.4.6. 設定 <acronym class="acronym">NIS</acronym> 客戶端</a></span></dt><dt><span class="sect2"><a href="#idp84135992">29.4.7. <acronym class="acronym">NIS</acronym> 安全性</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp84167480">29.4.7.1. 阻擋部份使用者</a></span></dt></dl></dd><dt><span class="sect2"><a href="#network-netgroups">29.4.8. 使用 Netgroups</a></span></dt><dt><span class="sect2"><a href="#idp84315448">29.4.9. 密碼格式</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-ldap">29.5. 輕量級目錄存取協定 (<acronym class="acronym">LDAP</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp84339512">29.5.1. <acronym class="acronym">LDAP</acronym> 術語與結構</a></span></dt><dt><span class="sect2"><a href="#ldap-config">29.5.2. 設定 <acronym class="acronym">LDAP</acronym> 伺服器</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-dhcp">29.6. 動態主機設置協定 (<acronym class="acronym">DHCP</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp84500408">29.6.1. 設定 <acronym class="acronym">DHCP</acronym> 客戶端</a></span></dt><dt><span class="sect2"><a href="#network-dhcp-server">29.6.2. 安裝並設定 <acronym class="acronym">DHCP</acronym> 伺服器</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-dns">29.7. 網域名稱系統 (<acronym class="acronym">DNS</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp84649144">29.7.1. 要架設名稱伺服器的原因</a></span></dt><dt><span class="sect2"><a href="#idp84689336">29.7.2. <acronym class="acronym">DNS</acronym> 伺服器設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-apache">29.8. Apache HTTP 伺服器</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp84719672">29.8.1. 設定並啟動 Apache</a></span></dt><dt><span class="sect2"><a href="#idp84790072">29.8.2. 虛擬主機</a></span></dt><dt><span class="sect2"><a href="#idp84804792">29.8.3. Apache 模組</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp84809272">29.8.3.1. <code class="filename">mod_ssl</code></a></span></dt><dt><span class="sect3"><a href="#idp84815928">29.8.3.2. <code class="filename">mod_perl</code></a></span></dt><dt><span class="sect3"><a href="#idp84837944">29.8.3.3. <code class="filename">mod_php</code></a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp84876856">29.8.4. 動態網站</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp84880696">29.8.4.1. Django</a></span></dt><dt><span class="sect3"><a href="#idp84894904">29.8.4.2. Ruby on Rails</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#network-ftp">29.9. 檔案傳輸協定 (<acronym class="acronym">FTP</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp84905144">29.9.1. 設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-samba">29.10. <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 用戶端檔案與列印服務 (Samba)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp84980024">29.10.1. 伺服器設定</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp84997304">29.10.1.1. 全域設定</a></span></dt><dt><span class="sect3"><a href="#idp85025080">29.10.1.2. 安全性設定</a></span></dt><dt><span class="sect3"><a href="#idp85035448">29.10.1.3. <span class="application">Samba</span> 使用者</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp85044920">29.10.2. 啟動 <span class="application">Samba</span></a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-ntp">29.11. NTP 時間校對</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp85065656">29.11.1. <acronym class="acronym">NTP</acronym> 設定</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp85070136">29.11.1.1. <code class="filename">/etc/ntp.conf</code> 檔</a></span></dt><dt><span class="sect3"><a href="#idp85106488">29.11.1.2. 在 <code class="filename">/etc/rc.conf</code> 中的 NTP 設定項目</a></span></dt><dt><span class="sect3"><a href="#idp85130424">29.11.1.3. <span class="application">Ntpd</span> 與無權限的 <code class="literal">ntpd</code> 使用者</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp85163832">29.11.2. 在 <acronym class="acronym">PPP</acronym> 連線使用 <acronym class="acronym">NTP</acronym></a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-iscsi">29.12. <acronym class="acronym">iSCSI</acronym> Initiator 與 Target 設定</a></span></dt><dd><dl><dt><span class="sect2"><a href="#network-iscsi-target">29.12.1. 設定 <acronym class="acronym">iSCSI</acronym> Target</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp85232952">29.12.1.1. 認證</a></span></dt></dl></dd><dt><span class="sect2"><a href="#network-iscsi-initiator">29.12.2. 設定 <acronym class="acronym">iSCSI</acronym> Initiator</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp85255992">29.12.2.1. 不使用設定檔連線到 Target</a></span></dt><dt><span class="sect3"><a href="#idp84854584">29.12.2.2. 使用設定檔連線到 Target</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="#firewalls">30. 防火牆</a></span></dt><dd><dl><dt><span class="sect1"><a href="#firewalls-intro">30.1. 概述</a></span></dt><dt><span class="sect1"><a href="#firewalls-concepts">30.2. 防火牆概念</a></span></dt><dt><span class="sect1"><a href="#firewalls-pf">30.3. PF</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp85400120">30.3.1. 開啟 <span class="application">PF</span></a></span></dt><dt><span class="sect2"><a href="#pf-tutorial">30.3.2. <span class="application">PF</span> 規則集</a></span></dt><dd><dl><dt><span class="sect3"><a href="#pftut-gateway">30.3.2.1. 使用 NAT 的簡單通訊閘</a></span></dt><dt><span class="sect3"><a href="#pftut-ftp">30.3.2.2. 建立 <acronym class="acronym">FTP</acronym> Proxy</a></span></dt><dt><span class="sect3"><a href="#pftut-icmp">30.3.2.3. 管理 <acronym class="acronym">ICMP</acronym></a></span></dt><dd><dl><dt><span class="sect4"><a href="#pftut-pathmtudisc">30.3.2.3.1. Path <acronym class="acronym">MTU</acronym> Discovery</a></span></dt></dl></dd><dt><span class="sect3"><a href="#pftut-tables">30.3.2.4. 使用 Tables</a></span></dt><dt><span class="sect3"><a href="#pftut-overload">30.3.2.5. 使用 Overload Tables 保護 <acronym class="acronym">SSH</acronym></a></span></dt><dt><span class="sect3"><a href="#pftut-spamd">30.3.2.6. <acronym class="acronym">SPAM</acronym> 防護</a></span></dt><dt><span class="sect3"><a href="#pftut-hygiene">30.3.2.7. 網路保健</a></span></dt><dt><span class="sect3"><a href="#pftut-unrouteables">30.3.2.8. 處理不可路由 (Non-Routable) 的位址</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp85974712">30.3.3. 開啟 <span class="application">ALTQ</span></a></span></dt></dl></dd><dt><span class="sect1"><a href="#firewalls-ipfw">30.4. <span class="application">IPFW</span></a></span></dt><dd><dl><dt><span class="sect2"><a href="#firewalls-ipfw-enable">30.4.1. 開啟 <span class="application">IPFW</span></a></span></dt><dt><span class="sect2"><a href="#firewalls-ipfw-rules">30.4.2. <span class="application">IPFW</span> 規則語法</a></span></dt><dt><span class="sect2"><a href="#idp86162488">30.4.3. 範例規則集</a></span></dt><dt><span class="sect2"><a href="#in-kernel-nat">30.4.4. 核心內 <acronym class="acronym">NAT</acronym></a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp86353464">30.4.4.1. Port 重新導向</a></span></dt><dt><span class="sect3"><a href="#idp86373432">30.4.4.2. 位址重新導向</a></span></dt><dt><span class="sect3"><a href="#idp86405432">30.4.4.3. Userspace <acronym class="acronym">NAT</acronym></a></span></dt></dl></dd><dt><span class="sect2"><a href="#firewalls-ipfw-cmd">30.4.5. <span class="application">IPFW</span> 指令</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp86450872">30.4.5.1. 記錄防火牆訊息</a></span></dt><dt><span class="sect3"><a href="#firewalls-ipfw-rules-script">30.4.5.2. 建立規則 Script</a></span></dt></dl></dd><dt><span class="sect2"><a href="#firewalls-ipfw-kernelconfig">30.4.6. <span class="application">IPFW</span> 核心選項</a></span></dt></dl></dd><dt><span class="sect1"><a href="#firewalls-ipf">30.5. IPFILTER (IPF)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp86558264">30.5.1. 開啟 <span class="application">IPF</span></a></span></dt><dt><span class="sect2"><a href="#idp86596152">30.5.2. <span class="application">IPF</span> 規則語法</a></span></dt><dt><span class="sect2"><a href="#idp86691256">30.5.3. 範例規則集</a></span></dt><dt><span class="sect2"><a href="#idp86740536">30.5.4. 設定 <acronym class="acronym">NAT</acronym></a></span></dt><dt><span class="sect2"><a href="#idp86838968">30.5.5. 檢視 <span class="application">IPF</span> 統計資訊</a></span></dt><dt><span class="sect2"><a href="#idp86533304">30.5.6. <span class="application">IPF</span> 日誌</a></span></dt></dl></dd><dt><span class="sect1"><a href="#firewalls-blacklistd">30.6. Blacklistd</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp86916152">30.6.1. 開啟 Blacklistd</a></span></dt><dt><span class="sect2"><a href="#idp86954680">30.6.2. 建立 Blacklistd 規則集</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp86957368">30.6.2.1. 本地規則</a></span></dt><dt><span class="sect3"><a href="#idp87002040">30.6.2.2. 遠端規則</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp87020088">30.6.3. Blacklistd 客戶端設定</a></span></dt><dt><span class="sect2"><a href="#idp87027768">30.6.4. Blacklistd 管理</a></span></dt><dt><span class="sect2"><a href="#idp87040696">30.6.5. 從封鎖清單移除主機</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#advanced-networking">31. 進階網路設定</a></span></dt><dd><dl><dt><span class="sect1"><a href="#advanced-networking-synopsis">31.1. 概述</a></span></dt><dt><span class="sect1"><a href="#network-routing">31.2. 通訊閘與路由</a></span></dt><dd><dl><dt><span class="sect2"><a href="#network-routing-default">31.2.1. 路由基礎概念</a></span></dt><dt><span class="sect2"><a href="#network-static-routes">31.2.2. 設定路由器使用靜態路由</a></span></dt><dt><span class="sect2"><a href="#network-routing-troubleshooting">31.2.3. 疑難排解</a></span></dt><dt><span class="sect2"><a href="#network-routing-multicast">31.2.4. 群播 (Multicast) 注意事項</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-wireless">31.3. 無線網路</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp87243320">31.3.1. 無線網路基礎</a></span></dt><dt><span class="sect2"><a href="#network-wireless-quick-start">31.3.2. 快速開始</a></span></dt><dt><span class="sect2"><a href="#network-wireless-basic">31.3.3. 基礎設定</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp87286712">31.3.3.1. 核心設定</a></span></dt><dt><span class="sect3"><a href="#idp87329208">31.3.3.2. 設定正確的區域</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp87336632">31.3.4. 主從式 (Infrastructure)</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp87338552">31.3.4.1. FreeBSD 客戶端</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idp87339192">31.3.4.1.1. 如何尋找存取點</a></span></dt><dt><span class="sect4"><a href="#idp87386168">31.3.4.1.2. 基礎設定</a></span></dt><dd><dl><dt><span class="sect5"><a href="#idp87388728">31.3.4.1.2.1. 選擇存取點</a></span></dt><dt><span class="sect5"><a href="#idp87404088">31.3.4.1.2.2. 認證</a></span></dt><dt><span class="sect5"><a href="#idp87419064">31.3.4.1.2.3. 使用 <acronym class="acronym">DHCP</acronym> 取得 <acronym class="acronym">IP</acronym> 位址</a></span></dt><dt><span class="sect5"><a href="#idp87434296">31.3.4.1.2.4. 靜態 <acronym class="acronym">IP</acronym> 位址</a></span></dt></dl></dd><dt><span class="sect4"><a href="#network-wireless-wpa">31.3.4.1.3. <acronym class="acronym">WPA</acronym></a></span></dt><dd><dl><dt><span class="sect5"><a href="#network-wireless-wpa-wpa-psk">31.3.4.1.3.1. <acronym class="acronym">WPA-PSK</acronym></a></span></dt><dt><span class="sect5"><a href="#network-wireless-wpa-eap-tls">31.3.4.1.3.2. <acronym class="acronym">WPA</acronym> 加上 <acronym class="acronym">EAP-TLS</acronym></a></span></dt><dt><span class="sect5"><a href="#network-wireless-wpa-eap-ttls">31.3.4.1.3.3. <acronym class="acronym">WPA</acronym> 加上 <acronym class="acronym">EAP-TTLS</acronym></a></span></dt><dt><span class="sect5"><a href="#network-wireless-wpa-eap-peap">31.3.4.1.3.4. <acronym class="acronym">WPA</acronym> 加上 <acronym class="acronym">EAP-PEAP</acronym></a></span></dt></dl></dd><dt><span class="sect4"><a href="#network-wireless-wep">31.3.4.1.4. <acronym class="acronym">WEP</acronym></a></span></dt></dl></dd></dl></dd><dt><span class="sect2"><a href="#idp87783736">31.3.5. 對等式 (Ad-hoc)</a></span></dt><dt><span class="sect2"><a href="#network-wireless-ap">31.3.6. FreeBSD 主機存取點</a></span></dt><dd><dl><dt><span class="sect3"><a href="#network-wireless-ap-basic">31.3.6.1. 基礎設定</a></span></dt><dt><span class="sect3"><a href="#idp87848120">31.3.6.2. 無認證或加密的 Host-based 存取點</a></span></dt><dt><span class="sect3"><a href="#network-wireless-ap-wpa">31.3.6.3. <acronym class="acronym">WPA2</acronym> Host-based 存取點</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idp87893176">31.3.6.3.1. <acronym class="acronym">WPA2-PSK</acronym></a></span></dt></dl></dd><dt><span class="sect3"><a href="#idp87945912">31.3.6.4. <acronym class="acronym">WEP</acronym> Host-based 存取點</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp87997240">31.3.7. 同時使用有線及無線連線</a></span></dt><dt><span class="sect2"><a href="#idp88000696">31.3.8. 疑難排解</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-usb-tethering">31.4. USB 網路共享</a></span></dt><dt><span class="sect1"><a href="#network-bluetooth">31.5. 藍牙</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp88042936">31.5.1. 載入藍牙支援</a></span></dt><dt><span class="sect2"><a href="#idp88083384">31.5.2. 尋找其他藍牙裝置</a></span></dt><dt><span class="sect2"><a href="#idp88114104">31.5.3. 裝置配對</a></span></dt><dt><span class="sect2"><a href="#idp88148792">31.5.4. 使用 <acronym class="acronym">PPP</acronym> Profile 存取網路</a></span></dt><dt><span class="sect2"><a href="#idp88180920">31.5.5. 藍牙通訊協定</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp88182200">31.5.5.1. Logical Link Control and Adaptation Protocol
	  (<acronym class="acronym">L2CAP</acronym>)</a></span></dt><dt><span class="sect3"><a href="#idp88217400">31.5.5.2. Radio Frequency Communication
	  (<acronym class="acronym">RFCOMM</acronym>)</a></span></dt><dt><span class="sect3"><a href="#idp88236344">31.5.5.3. Service Discovery Protocol
	  (<acronym class="acronym">SDP</acronym>)</a></span></dt><dt><span class="sect3"><a href="#idp88296120">31.5.5.4. <acronym class="acronym">OBEX</acronym> Object Push
	  (<acronym class="acronym">OPUSH</acronym>)</a></span></dt><dt><span class="sect3"><a href="#idp88329528">31.5.5.5. Serial Port Profile (<acronym class="acronym">SPP</acronym>)</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp88339128">31.5.6. 疑難排解</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-bridging">31.6. 橋接</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp88386232">31.6.1. 開啟橋接</a></span></dt><dt><span class="sect2"><a href="#idp88423480">31.6.2. 開啟 Spanning Tree</a></span></dt><dt><span class="sect2"><a href="#idp88441912">31.6.3. 橋接介面參數</a></span></dt><dt><span class="sect2"><a href="#idp88489272">31.6.4. <acronym class="acronym">SNMP</acronym> 監視</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-aggregation">31.7. Link Aggregation 與容錯移轉</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp88574520">31.7.1. 設定範例</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-diskless">31.8. <acronym class="acronym">PXE</acronym> 無磁碟作業</a></span></dt><dd><dl><dt><span class="sect2"><a href="#network-pxe-nfs">31.8.1. 設定 <acronym class="acronym">PXE</acronym> 環境</a></span></dt><dt><span class="sect2"><a href="#network-pxe-setting-up-dhcp">31.8.2. 設定 <acronym class="acronym">DHCP</acronym> 伺服器</a></span></dt><dt><span class="sect2"><a href="#idp88879032">31.8.3. <acronym class="acronym">PXE</acronym> 問題除錯</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-ipv6">31.9. <acronym class="acronym">IPv6</acronym></a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp89022008">31.9.1. <acronym class="acronym">IPv6</acronym> 位址的背景知識</a></span></dt><dt><span class="sect2"><a href="#idp89099448">31.9.2. 設定 <acronym class="acronym">IPv6</acronym></a></span></dt><dt><span class="sect2"><a href="#idp89107896">31.9.3. 連線到 Provider</a></span></dt><dt><span class="sect2"><a href="#idp89142840">31.9.4. Router Advertisement 與 Host Auto Configuration</a></span></dt><dt><span class="sect2"><a href="#idp89166392">31.9.5. <acronym class="acronym">IPv6</acronym> 與 <acronym class="acronym">IPv6</acronym> 位址對應表</a></span></dt></dl></dd><dt><span class="sect1"><a href="#carp">31.10. 共用位址備援協定 (<acronym class="acronym">CARP</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#carp-10x">31.10.1. 使用 <acronym class="acronym">CARP</acronym> 於 FreeBSD 10 及之後版本</a></span></dt><dt><span class="sect2"><a href="#carp-9x">31.10.2. 使用 <acronym class="acronym">CARP</acronym> 於 FreeBSD 9 及先前版本</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-vlan">31.11. VLANs</a></span></dt></dl></dd></dl></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialcomms"></a>章 26. 序列通訊</h2></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#serial-synopsis">26.1. 概述</a></span></dt><dt><span class="sect1"><a href="#serial">26.2. 序列術語與硬體</a></span></dt><dd><dl><dt><span class="sect2"><a href="#term-cables-null">26.2.1. 序列線與埠</a></span></dt><dt><span class="sect2"><a href="#serial-hw-config">26.2.2. 序列埠設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#term">26.3. 終端機</a></span></dt><dd><dl><dt><span class="sect2"><a href="#term-config">26.3.1. 終端機設定</a></span></dt><dt><span class="sect2"><a href="#term-debug">26.3.2. 連線疑難排解</a></span></dt></dl></dd><dt><span class="sect1"><a href="#dialup">26.4. 撥入服務</a></span></dt><dd><dl><dt><span class="sect2"><a href="#dialup-ttys">26.4.1. 數據機設定</a></span></dt><dt><span class="sect2"><a href="#idp81703992">26.4.2. 疑難排解</a></span></dt></dl></dd><dt><span class="sect1"><a href="#dialout">26.5. 撥出服務</a></span></dt><dd><dl><dt><span class="sect2"><a href="#hayes-unsupported">26.5.1. 使用 Stock Hayes 數據機</a></span></dt><dt><span class="sect2"><a href="#direct-at">26.5.2. 使用 <code class="literal">AT</code> 指令</a></span></dt><dt><span class="sect2"><a href="#gt-failure">26.5.3. <code class="literal">@</code> 符號無法運作</a></span></dt><dt><span class="sect2"><a href="#dial-command-line">26.5.4. 從指令列撥號</a></span></dt><dt><span class="sect2"><a href="#set-bps">26.5.5. 設定 <acronym class="acronym">bps</acronym> 率</a></span></dt><dt><span class="sect2"><a href="#terminal-server">26.5.6. 透過終端伺服器存取多個主機</a></span></dt><dt><span class="sect2"><a href="#tip-multiline">26.5.7. 在 <code class="command">tip</code> 使用超過一行</a></span></dt><dt><span class="sect2"><a href="#multi-controlp">26.5.8. 使用強制字元</a></span></dt><dt><span class="sect2"><a href="#uppercase">26.5.9. 大寫字元</a></span></dt><dt><span class="sect2"><a href="#tip-filetransfer">26.5.10. 使用 <code class="command">tip</code> 傳輸檔案</a></span></dt><dt><span class="sect2"><a href="#zmodem-tip">26.5.11. 在 <span class="application">zmodem</span> 使用 <code class="command">tip</code>?</a></span></dt></dl></dd><dt><span class="sect1"><a href="#serialconsole-setup">26.6. 設定序列 Console</a></span></dt><dd><dl><dt><span class="sect2"><a href="#serialconsole-howto-fast">26.6.1. 快速序列 Console 設定</a></span></dt><dt><span class="sect2"><a href="#serialconsole-howto">26.6.2. 深入序列 Console 設定</a></span></dt><dt><span class="sect2"><a href="#idp82032696">26.6.3. 設定使用更快的序列埠速度</a></span></dt><dt><span class="sect2"><a href="#serialconsole-ddb">26.6.4. 從序列線路 (Serial Line) 進入 DDB 除錯程式</a></span></dt></dl></dd></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="serial-synopsis"></a>26.1. 概述</h2></div></div></div><a id="idp81084344" class="indexterm"></a><p><span class="trademark">UNIX</span>® 從最早的第一台 <span class="trademark">UNIX</span>® 仰賴序列線路來讓使用者輸入與輸出以來一直都支援序列通訊，雖與每秒 10 個字元的序列印表機及鍵盤組成的終端機時代比起已改變很多。本章將說明幾種可在 FreeBSD 使用的序列通訊方式。</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>如何連線終端機到 FreeBSD 系統。</p></li><li class="listitem"><p>如何使用數據機撥號給遠端主機。</p></li><li class="listitem"><p>如何允許遠端使用者透過數據機來登入 FreeBSD 系統。</p></li><li class="listitem"><p>如何從序列 Console 啟動 FreeBSD 系統。</p></li></ul></div><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>了解如何 <a class="link" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">設定並安裝自訂核心</a>。</p></li><li class="listitem"><p>了解 <a class="link" href="#basics" title="章 3. FreeBSD 基礎"> FreeBSD 的權限與程序</a>。</p></li><li class="listitem"><p>能夠取得要在 FreeBSD 使用的序列硬體的技術手冊。</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="serial"></a>26.2. 序列術語與硬體</h2></div></div></div><p xml:lang="en" lang="en">The following terms are often used in serial
      communications:</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en"><acronym class="acronym">bps</acronym></span></dt><dd><p xml:lang="en" lang="en">Bits per
	    Second<a id="idp81138360" class="indexterm"></a>
	    (<acronym class="acronym">bps</acronym>) is the rate at which data is
	    transmitted.</p></dd><dt><span xml:lang="en" class="term" lang="en"><acronym class="acronym">DTE</acronym></span></dt><dd><p xml:lang="en" lang="en">Data Terminal
	    Equipment<a id="idp81141304" class="indexterm"></a>
	    (<acronym class="acronym">DTE</acronym>) is one of two endpoints in a
	    serial communication.  An example would be a
	    computer.</p></dd><dt><span xml:lang="en" class="term" lang="en"><acronym class="acronym">DCE</acronym></span></dt><dd><p xml:lang="en" lang="en">Data Communications
	    Equipment<a id="idp81160632" class="indexterm"></a>
	    (<acronym class="acronym">DTE</acronym>) is the other endpoint in a
	    serial communication.  Typically, it is a modem or serial
	    terminal.</p></dd><dt><span xml:lang="en" class="term" lang="en"><acronym class="acronym">RS-232</acronym></span></dt><dd><p xml:lang="en" lang="en">The original standard which defined hardware serial
	    communications.  It has since been renamed to
	    <acronym class="acronym">TIA-232</acronym>.</p></dd></dl></div><p xml:lang="en" lang="en">When referring to communication data rates, this section
      does not use the term <em class="firstterm">baud</em>.  Baud refers
      to the number of electrical state transitions made in a period
      of time, while <acronym class="acronym">bps</acronym> is the correct term to
      use.</p><p xml:lang="en" lang="en">To connect a serial terminal to a FreeBSD system, a serial port
      on the computer and the proper cable to connect to the serial
      device are needed.  Users who are already familiar with serial
      hardware and cabling can safely skip this section.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="term-cables-null"></a>26.2.1. 序列線與埠</h3></div></div></div><p xml:lang="en" lang="en">There are several different kinds of serial cables.  The
	two most common types are null-modem cables and standard
	<acronym class="acronym">RS-232</acronym> cables.  The documentation for the
	hardware should describe the type of cable required.</p><p xml:lang="en" lang="en">These two types of cables differ in how the wires are
	connected to the connector.  Each wire represents a signal,
	with the defined signals summarized in <a class="xref" href="#serialcomms-signal-names" title="表格 26.1. RS-232C 信號名稱">表格 26.1, “<acronym class="acronym">RS-232C</acronym> 信號名稱”</a>.  A standard serial
	cable passes all of the <acronym class="acronym">RS-232C</acronym> signals
	straight through.  For example, the <span class="quote">“<span class="quote">Transmitted
	  Data</span>”</span> pin on one end of the cable goes to the
	<span class="quote">“<span class="quote">Transmitted Data</span>”</span> pin on the other end.  This is
	the type of cable used to connect a modem to the FreeBSD system,
	and is also appropriate for some terminals.</p><p xml:lang="en" lang="en">A null-modem cable switches the <span class="quote">“<span class="quote">Transmitted
	  Data</span>”</span> pin of the connector on one end with the
	<span class="quote">“<span class="quote">Received Data</span>”</span> pin on the other end.  The
	connector can be either a <acronym class="acronym">DB-25</acronym> or a
	<acronym class="acronym">DB-9</acronym>.</p><p xml:lang="en" lang="en">A null-modem cable can be constructed using the pin
	connections summarized in <a class="xref" href="#nullmodem-db25" title="表格 26.2. DB-25 對 DB-25 Null-Modem 線">表格 26.2, “DB-25 對 DB-25 Null-Modem 線”</a>,
	<a class="xref" href="#nullmodem-db9" title="表格 26.3. DB-9 對 DB-9 Null-Modem 線">表格 26.3, “DB-9 對 DB-9 Null-Modem 線”</a>, and <a class="xref" href="#nullmodem-db9-25" title="表格 26.4. DB-9 對 DB-25 Null-Modem 線">表格 26.4, “DB-9 對 DB-25 Null-Modem 線”</a>.  While the standard calls for
	a straight-through pin 1 to pin 1 <span class="quote">“<span class="quote">Protective
	  Ground</span>”</span> line, it is often omitted.  Some terminals
	work using only pins 2, 3, and 7, while others require
	different configurations.  When in doubt, refer to the
	documentation for the hardware.</p><a id="idp81174200" class="indexterm"></a><div class="table"><a id="serialcomms-signal-names"></a><div class="table-title">表格 26.1. <acronym class="acronym">RS-232C</acronym> 信號名稱</div><div class="table-contents"><table summary="RS-232C 信號名稱" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th align="left">縮寫</th><th xml:lang="en" align="left" lang="en">Names</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><acronym class="acronym">RD</acronym></td><td xml:lang="en" lang="en">Received Data</td></tr><tr><td xml:lang="en" lang="en"><acronym class="acronym">TD</acronym></td><td xml:lang="en" lang="en">Transmitted Data</td></tr><tr><td xml:lang="en" lang="en"><acronym class="acronym">DTR</acronym></td><td xml:lang="en" lang="en">Data Terminal Ready</td></tr><tr><td xml:lang="en" lang="en"><acronym class="acronym">DSR</acronym></td><td xml:lang="en" lang="en">Data Set Ready</td></tr><tr><td xml:lang="en" lang="en"><acronym class="acronym">DCD</acronym></td><td xml:lang="en" lang="en">Data Carrier Detect</td></tr><tr><td xml:lang="en" lang="en"><acronym class="acronym">SG</acronym></td><td xml:lang="en" lang="en">Signal Ground</td></tr><tr><td xml:lang="en" lang="en"><acronym class="acronym">RTS</acronym></td><td xml:lang="en" lang="en">Request to Send</td></tr><tr><td xml:lang="en" lang="en"><acronym class="acronym">CTS</acronym></td><td xml:lang="en" lang="en">Clear to Send</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="nullmodem-db25"></a><div class="table-title">表格 26.2. DB-25 對 DB-25 Null-Modem 線</div><div class="table-contents"><table summary="DB-25 對 DB-25 Null-Modem 線" width="100%" border="0"><colgroup><col /><col /><col /><col /><col /></colgroup><thead><tr><th align="left">信號</th><th align="left">針腳 #</th><th> </th><th align="left">針腳 #</th><th align="left">信號</th></tr></thead><tbody><tr><td xml:lang="en" lang="en">SG</td><td xml:lang="en" lang="en">7</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">7</td><td xml:lang="en" lang="en">SG</td></tr><tr><td xml:lang="en" lang="en">TD</td><td xml:lang="en" lang="en">2</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">3</td><td xml:lang="en" lang="en">RD</td></tr><tr><td xml:lang="en" lang="en">RD</td><td xml:lang="en" lang="en">3</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">2</td><td xml:lang="en" lang="en">TD</td></tr><tr><td xml:lang="en" lang="en">RTS</td><td xml:lang="en" lang="en">4</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">5</td><td xml:lang="en" lang="en">CTS</td></tr><tr><td xml:lang="en" lang="en">CTS</td><td xml:lang="en" lang="en">5</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">4</td><td xml:lang="en" lang="en">RTS</td></tr><tr><td xml:lang="en" lang="en">DTR</td><td xml:lang="en" lang="en">20</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">6</td><td xml:lang="en" lang="en">DSR</td></tr><tr><td xml:lang="en" lang="en">DTR</td><td xml:lang="en" lang="en">20</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">8</td><td xml:lang="en" lang="en">DCD</td></tr><tr><td xml:lang="en" lang="en">DSR</td><td xml:lang="en" lang="en">6</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">20</td><td xml:lang="en" lang="en">DTR</td></tr><tr><td xml:lang="en" lang="en">DCD</td><td xml:lang="en" lang="en">8</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">20</td><td xml:lang="en" lang="en">DTR</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="nullmodem-db9"></a><div class="table-title">表格 26.3. DB-9 對 DB-9 Null-Modem 線</div><div class="table-contents"><table summary="DB-9 對 DB-9 Null-Modem 線" width="100%" border="0"><colgroup><col /><col /><col /><col /><col /></colgroup><thead><tr><th align="left">信號</th><th align="left">針腳 #</th><th> </th><th align="left">針腳 #</th><th align="left">信號</th></tr></thead><tbody><tr><td xml:lang="en" lang="en">RD</td><td xml:lang="en" lang="en">2</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">3</td><td xml:lang="en" lang="en">TD</td></tr><tr><td xml:lang="en" lang="en">TD</td><td xml:lang="en" lang="en">3</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">2</td><td xml:lang="en" lang="en">RD</td></tr><tr><td xml:lang="en" lang="en">DTR</td><td xml:lang="en" lang="en">4</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">6</td><td xml:lang="en" lang="en">DSR</td></tr><tr><td xml:lang="en" lang="en">DTR</td><td xml:lang="en" lang="en">4</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">1</td><td xml:lang="en" lang="en">DCD</td></tr><tr><td xml:lang="en" lang="en">SG</td><td xml:lang="en" lang="en">5</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">5</td><td xml:lang="en" lang="en">SG</td></tr><tr><td xml:lang="en" lang="en">DSR</td><td xml:lang="en" lang="en">6</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">4</td><td xml:lang="en" lang="en">DTR</td></tr><tr><td xml:lang="en" lang="en">DCD</td><td xml:lang="en" lang="en">1</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">4</td><td xml:lang="en" lang="en">DTR</td></tr><tr><td xml:lang="en" lang="en">RTS</td><td xml:lang="en" lang="en">7</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">8</td><td xml:lang="en" lang="en">CTS</td></tr><tr><td xml:lang="en" lang="en">CTS</td><td xml:lang="en" lang="en">8</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">7</td><td xml:lang="en" lang="en">RTS</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="nullmodem-db9-25"></a><div class="table-title">表格 26.4. DB-9 對 DB-25 Null-Modem 線</div><div class="table-contents"><table summary="DB-9 對 DB-25 Null-Modem 線" width="100%" border="0"><colgroup><col /><col /><col /><col /><col /></colgroup><thead><tr><th align="left">信號</th><th align="left">針腳 #</th><th> </th><th align="left">針腳 #</th><th align="left">信號</th></tr></thead><tbody><tr><td xml:lang="en" lang="en">RD</td><td xml:lang="en" lang="en">2</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">2</td><td xml:lang="en" lang="en">TD</td></tr><tr><td xml:lang="en" lang="en">TD</td><td xml:lang="en" lang="en">3</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">3</td><td xml:lang="en" lang="en">RD</td></tr><tr><td xml:lang="en" lang="en">DTR</td><td xml:lang="en" lang="en">4</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">6</td><td xml:lang="en" lang="en">DSR</td></tr><tr><td xml:lang="en" lang="en">DTR</td><td xml:lang="en" lang="en">4</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">8</td><td xml:lang="en" lang="en">DCD</td></tr><tr><td xml:lang="en" lang="en">SG</td><td xml:lang="en" lang="en">5</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">7</td><td xml:lang="en" lang="en">SG</td></tr><tr><td xml:lang="en" lang="en">DSR</td><td xml:lang="en" lang="en">6</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">20</td><td xml:lang="en" lang="en">DTR</td></tr><tr><td xml:lang="en" lang="en">DCD</td><td xml:lang="en" lang="en">1</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">20</td><td xml:lang="en" lang="en">DTR</td></tr><tr><td xml:lang="en" lang="en">RTS</td><td xml:lang="en" lang="en">7</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">5</td><td xml:lang="en" lang="en">CTS</td></tr><tr><td xml:lang="en" lang="en">CTS</td><td xml:lang="en" lang="en">8</td><td xml:lang="en" lang="en">connects to</td><td xml:lang="en" lang="en">4</td><td xml:lang="en" lang="en">RTS</td></tr></tbody></table></div></div><br class="table-break" /><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">When one pin at one end connects to a pair of pins at
	  the other end, it is usually implemented with one short wire
	  between the pair of pins in their connector and a long wire
	  to the other single pin.</p></div><p xml:lang="en" lang="en">Serial ports are the devices through which data is
	transferred between the FreeBSD host computer and the terminal.
	Several kinds of serial ports exist.  Before purchasing or
	constructing a cable, make sure it will fit the ports on the
	terminal and on the FreeBSD system.</p><p xml:lang="en" lang="en">Most terminals have <acronym class="acronym">DB-25</acronym> ports.
	Personal computers may have <acronym class="acronym">DB-25</acronym> or
	<acronym class="acronym">DB-9</acronym> ports.  A multiport serial card may
	have <acronym class="acronym">RJ-12</acronym> or <acronym class="acronym">RJ-45/</acronym>
	ports.  See the documentation that accompanied the hardware
	for specifications on the kind of port or visually verify the
	type of port.</p><p xml:lang="en" lang="en">In FreeBSD, each serial port is accessed through an entry in
	<code class="filename">/dev</code>.  There are two different kinds of
	entries:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Call-in ports are named
	    <code class="filename">/dev/ttyu<em class="replaceable"><code>N</code></em></code>
	    where <em class="replaceable"><code>N</code></em> is the port number,
	    starting from zero.  If a terminal is connected to the
	    first serial port (<code class="filename">COM1</code>), use
	    <code class="filename">/dev/ttyu0</code> to refer to the terminal.
	    If the terminal is on the second serial port
	    (<code class="filename">COM2</code>), use
	    <code class="filename">/dev/ttyu1</code>, and so forth.  Generally,
	    the call-in port is used for terminals.  Call-in ports
	    require that the serial line assert the <span class="quote">“<span class="quote">Data
	      Carrier Detect</span>”</span> signal to work correctly.</p></li><li class="listitem"><p xml:lang="en" lang="en">Call-out ports are named
	    <code class="filename">/dev/cuau<em class="replaceable"><code>N</code></em></code>
	    on FreeBSD versions 8.X and higher and
	    <code class="filename">/dev/cuad<em class="replaceable"><code>N</code></em></code>
	    on FreeBSD versions 7.X and lower.  Call-out ports are
	    usually not used for terminals, but are used for modems.
	    The call-out port can be used if the serial cable or the
	    terminal does not support the <span class="quote">“<span class="quote">Data Carrier
	      Detect</span>”</span> signal.</p></li></ul></div><p xml:lang="en" lang="en">FreeBSD also provides initialization devices
	(<code class="filename">/dev/ttyu<em class="replaceable"><code>N</code></em>.init</code>
	and
	<code class="filename">/dev/cuau<em class="replaceable"><code>N</code></em>.init</code>
	or
	<code class="filename">/dev/cuad<em class="replaceable"><code>N</code></em>.init</code>)
	and locking devices
	(<code class="filename">/dev/ttyu<em class="replaceable"><code>N</code></em>.lock</code>
	and
	<code class="filename">/dev/cuau<em class="replaceable"><code>N</code></em>.lock</code>
	or
	<code class="filename">/dev/cuad<em class="replaceable"><code>N</code></em>.lock</code>).
	The initialization devices are used to initialize
	communications port parameters each time a port is opened,
	such as <code class="literal">crtscts</code> for modems which use
	<code class="literal">RTS/CTS</code> signaling for flow control.  The
	locking devices are used to lock flags on ports to prevent
	users or programs changing certain parameters.  Refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=termios&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">termios</span>(4)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sio&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sio</span>(4)</span></a>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=stty&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">stty</span>(1)</span></a> for information
	on terminal settings, locking and initializing devices, and
	setting terminal options, respectively.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serial-hw-config"></a>26.2.2. 序列埠設定</h3></div></div></div><p xml:lang="en" lang="en">By default, FreeBSD supports four serial ports which are
	commonly known as <code class="filename">COM1</code>,
	<code class="filename">COM2</code>, <code class="filename">COM3</code>, and
	<code class="filename">COM4</code>.  FreeBSD also supports dumb multi-port
	serial interface cards, such as the BocaBoard 1008 and 2016,
	as well as more intelligent multi-port cards such as those
	made by Digiboard.  However, the default kernel only looks for
	the standard <code class="filename">COM</code> ports.</p><p xml:lang="en" lang="en">To see if the system recognizes the serial ports, look for
	system boot messages that start with
	<code class="literal">uart</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>grep uart /var/run/dmesg.boot</code></strong></pre><p xml:lang="en" lang="en">If the system does not recognize all of the needed serial
	ports, additional entries can be added to
	<code class="filename">/boot/device.hints</code>.  This file already
	contains <code class="literal">hint.uart.0.*</code> entries for
	<code class="filename">COM1</code> and <code class="literal">hint.uart.1.*</code>
	entries for <code class="filename">COM2</code>.  When adding a port
	entry for <code class="filename">COM3</code> use
	<code class="literal">0x3E8</code>, and for <code class="filename">COM4</code>
	use <code class="literal">0x2E8</code>.  Common <acronym class="acronym">IRQ</acronym>
	addresses are <code class="literal">5</code> for
	<code class="filename">COM3</code> and <code class="literal">9</code> for
	<code class="filename">COM4</code>.</p><a id="idp81465016" class="indexterm"></a><a id="idp81465784" class="indexterm"></a><p xml:lang="en" lang="en">To determine the default set of terminal
	<acronym class="acronym">I/O</acronym> settings used by the port, specify its
	device name.  This example determines the settings for the
	call-in port on <code class="filename">COM2</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>stty -a -f /dev/<em class="replaceable"><code>ttyu1</code></em></code></strong></pre><p xml:lang="en" lang="en">System-wide initialization of serial devices is controlled
	by <code class="filename">/etc/rc.d/serial</code>.  This file affects
	the default settings of serial devices.  To change the
	settings for a device, use <code class="command">stty</code>.  By
	default, the changed settings are in effect until the device
	is closed and when the device is reopened, it goes back to the
	default set.  To permanently change the default set, open and
	adjust the settings of the initialization device.  For
	example, to turn on <code class="option">CLOCAL</code> mode, 8 bit
	communication, and <code class="option">XON/XOFF</code> flow control for
	<code class="filename">ttyu5</code>, type:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>stty -f /dev/ttyu5.init clocal cs8 ixon ixoff</code></strong></pre><a id="idp81472696" class="indexterm"></a><p xml:lang="en" lang="en">To prevent certain settings from being changed by an
	application, make adjustments to the locking device.  For
	example, to lock the speed of <code class="filename">ttyu5</code> to
	57600 bps, type:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>stty -f /dev/ttyu5.lock 57600</code></strong></pre><p xml:lang="en" lang="en">Now, any application that opens <code class="filename">ttyu5</code>
	and tries to change the speed of the port will be stuck with
	57600 bps.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="term"></a>26.3. 終端機</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Sean</span> <span class="surname">Kelly</span></span>. </span></div></div></div><a id="idp81485112" class="indexterm"></a><p xml:lang="en" lang="en">Terminals provide a convenient and low-cost way to access
      a FreeBSD system when not at the computer's console or on a
      connected network.  This section describes how to use terminals
      with FreeBSD.</p><p xml:lang="en" lang="en">The original <span class="trademark">UNIX</span>® systems did not have consoles.  Instead,
      users logged in and ran programs through terminals that were
      connected to the computer's serial ports.</p><p xml:lang="en" lang="en">The ability to establish a login session on a serial port
      still exists in nearly every <span class="trademark">UNIX</span>®-like operating system
      today, including FreeBSD.  By using a terminal attached to an
      unused serial port, a user can log in and run any text program
      that can normally be run on the console or in an
      <code class="command">xterm</code> window.</p><p xml:lang="en" lang="en">Many terminals can be attached to a FreeBSD system.  An older
      spare computer can be used as a terminal wired into a more
      powerful computer running FreeBSD.  This can turn what might
      otherwise be a single-user computer into a powerful
      multiple-user system.</p><p xml:lang="en" lang="en">FreeBSD supports three types of terminals:</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en">Dumb terminals</span></dt><dd><p xml:lang="en" lang="en">Dumb terminals are specialized hardware that connect
	    to computers over serial lines.  They are called
	    <span class="quote">“<span class="quote">dumb</span>”</span> because they have only enough
	    computational power to display, send, and receive text.
	    No programs can be run on these devices.  Instead, dumb
	    terminals connect to a computer that runs the needed
	    programs.</p><p xml:lang="en" lang="en">There are hundreds of kinds of dumb terminals made by
	    many manufacturers, and just about any kind will work with
	    FreeBSD.  Some high-end terminals can even display graphics,
	    but only certain software packages can take advantage of
	    these advanced features.</p><p xml:lang="en" lang="en">Dumb terminals are popular in work environments where
	    workers do not need access to graphical
	    applications.</p></dd><dt><span xml:lang="en" class="term" lang="en">Computers Acting as Terminals</span></dt><dd><p xml:lang="en" lang="en">Since a dumb terminal has just enough ability to
	    display, send, and receive text, any spare computer can
	    be a dumb terminal.  All that is needed is the proper
	    cable and some <em class="firstterm">terminal emulation</em>
	    software to run on the computer.</p><p xml:lang="en" lang="en">This configuration can be useful.  For example, if one
	    user is busy working at the FreeBSD system's console, another
	    user can do some text-only work at the same time from a
	    less powerful personal computer hooked up as a terminal to
	    the FreeBSD system.</p><p xml:lang="en" lang="en">There are at least two utilities in the base-system of
	    FreeBSD that can be used to work through a serial connection:
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cu&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cu</span>(1)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tip&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tip</span>(1)</span></a>.</p><p xml:lang="en" lang="en">For example, to connect from a client system that runs
	    FreeBSD to the serial connection of another system:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cu -l /dev/cuau<em class="replaceable"><code>N</code></em></code></strong></pre><p xml:lang="en" lang="en">Ports are numbered starting from zero.  This means that
	    <code class="filename">COM1</code> is
	    <code class="filename">/dev/cuau0</code>.</p><p xml:lang="en" lang="en">Additional programs are available through the Ports
	    Collection, such as
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/comms/minicom/pkg-descr">comms/minicom</a>.</p></dd><dt><span xml:lang="en" class="term" lang="en">X Terminals</span></dt><dd><p xml:lang="en" lang="en">X terminals are the most sophisticated kind of
	    terminal available.  Instead of connecting to a serial
	    port, they usually connect to a network like Ethernet.
	    Instead of being relegated to text-only applications, they
	    can display any <span class="application">Xorg</span>
	    application.</p><p xml:lang="en" lang="en">This chapter does not cover the setup, configuration,
	    or use of X terminals.</p></dd></dl></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="term-config"></a>26.3.1. 終端機設定</h3></div></div></div><p xml:lang="en" lang="en">This section describes how to configure a FreeBSD system to
	enable a login session on a serial terminal.  It assumes that
	the system recognizes the serial port to which the terminal is
	connected and that the terminal is connected with the correct
	cable.</p><p xml:lang="en" lang="en">In FreeBSD, <code class="command">init</code> reads
	<code class="filename">/etc/ttys</code> and starts a
	<code class="command">getty</code> process on the available terminals.
	The <code class="command">getty</code> process is responsible for
	reading a login name and starting the <code class="command">login</code>
	program.  The ports on the FreeBSD system which allow logins are
	listed in <code class="filename">/etc/ttys</code>.  For example, the
	first virtual console, <code class="filename">ttyv0</code>, has an
	entry in this file, allowing logins on the console.  This file
	also contains entries for the other virtual consoles, serial
	ports, and pseudo-ttys.  For a hardwired terminal, the serial
	port's <code class="filename">/dev</code> entry is listed without the
	<code class="literal">/dev</code> part.  For example,
	<code class="filename">/dev/ttyv0</code> is listed as
	<code class="literal">ttyv0</code>.</p><p xml:lang="en" lang="en">The default <code class="filename">/etc/ttys</code> configures
	support for the first four serial ports,
	<code class="filename">ttyu0</code> through
	<code class="filename">ttyu3</code>:</p><pre xml:lang="en" class="programlisting" lang="en">ttyu0   "/usr/libexec/getty std.9600"   dialup  off secure
ttyu1   "/usr/libexec/getty std.9600"   dialup  off secure
ttyu2   "/usr/libexec/getty std.9600"   dialup  off secure
ttyu3   "/usr/libexec/getty std.9600"   dialup  off secure</pre><p xml:lang="en" lang="en">When attaching a terminal to one of those ports, modify
	the default entry to set the required speed and terminal type,
	to turn the device <code class="literal">on</code> and, if needed, to
	change the port's <code class="literal">secure</code> setting.  If the
	terminal is connected to another port, add an entry for the
	port.</p><p xml:lang="en" lang="en"><a class="xref" href="#ex-etc-ttys" title="範例 26.1. 設定終端機項目">範例 26.1, “設定終端機項目”</a> configures two terminals in
	<code class="filename">/etc/ttys</code>.  The first entry configures a
	Wyse-50 connected to <code class="filename">COM2</code>.  The second
	entry configures an old computer running
	<span class="application">Procomm</span> terminal software emulating
	a VT-100 terminal.  The computer is connected to the sixth
	serial port on a multi-port serial card.</p><div class="example"><a id="ex-etc-ttys"></a><div class="example-title">範例 26.1. 設定終端機項目</div><div class="example-contents"><pre xml:lang="en" class="programlisting" lang="en">ttyu1<a id="co-ttys-line1col1"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>  "/usr/libexec/getty std.38400"<a id="co-ttys-line1col2"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>  wy50<a id="co-ttys-line1col3"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>  on<a id="co-ttys-line1col4"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>  insecure<a id="co-ttys-line1col5"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
ttyu5   "/usr/libexec/getty std.19200"  vt100  on insecure</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttys-line1col1"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The first field specifies the device name of the
	      serial terminal.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttys-line1col2"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The second field tells <code class="command">getty</code> to
	      initialize and open the line, set the line speed, prompt
	      for a user name, and then execute the
	      <code class="command">login</code> program.  The optional
	      <em class="firstterm">getty type</em> configures
	      characteristics on the terminal line, like
	      <acronym class="acronym">bps</acronym> rate and parity.  The available
	      getty types are listed in
	      <code class="filename">/etc/gettytab</code>.  In almost all
	      cases, the getty types that start with
	      <code class="literal">std</code> will work for hardwired terminals
	      as these entries ignore parity.  There is a
	      <code class="literal">std</code> entry for each
	      <acronym class="acronym">bps</acronym> rate from 110 to 115200.  Refer
	      to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gettytab&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gettytab</span>(5)</span></a> for more information.</p><p xml:lang="en" lang="en">When setting the getty type, make sure to match the
	      communications settings used by the terminal.  For this
	      example, the Wyse-50 uses no parity and connects at
	      38400 bps.  The computer uses no parity and
	      connects at 19200 bps.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttys-line1col3"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The third field is the type of terminal.  For
	      dial-up ports, <code class="literal">unknown</code> or
	      <code class="literal">dialup</code> is typically used since users
	      may dial up with practically any type of terminal or
	      software.  Since the terminal type does not change for
	      hardwired terminals, a real terminal type from
	      <code class="filename">/etc/termcap</code> can be specified.  For
	      this example, the Wyse-50 uses the real terminal type
	      while the computer running
	      <span class="application">Procomm</span> is set to emulate a
	      VT-100.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttys-line1col4"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The fourth field specifies if the port should be
	      enabled.  To enable logins on this port, this field must
	      be set to <code class="literal">on</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttys-line1col5"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The final field is used to specify whether the port
	      is secure.  Marking a port as <code class="literal">secure</code>
	      means that it is trusted enough to allow <code class="systemitem">root</code> to login from that
	      port.  Insecure ports do not allow <code class="systemitem">root</code> logins.  On an
	      insecure port, users must login from unprivileged
	      accounts and then use <code class="command">su</code> or a similar
	      mechanism to gain superuser privileges, as described in
	      <a class="xref" href="#users-superuser" title="3.3.1.3. 超級使用者帳號">節 3.3.1.3, “超級使用者帳號”</a>.  For security
	      reasons, it is recommended to change this setting to
	      <code class="literal">insecure</code>.</p></td></tr></table></div></div></div><br class="example-break" /><p xml:lang="en" lang="en">After making any changes to
	<code class="filename">/etc/ttys</code>, send a SIGHUP (hangup) signal
	to the <code class="command">init</code> process to force it to re-read
	its configuration file:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kill -HUP 1</code></strong></pre><p xml:lang="en" lang="en">Since <code class="command">init</code> is always the first process
	run on a system, it always has a process <acronym class="acronym">ID</acronym>
	of <code class="literal">1</code>.</p><p xml:lang="en" lang="en">If everything is set up correctly, all cables are in
	place, and the terminals are powered up, a
	<code class="command">getty</code> process should now be running on each
	terminal and login prompts should be available on each
	terminal.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="term-debug"></a>26.3.2. 連線疑難排解</h3></div></div></div><p xml:lang="en" lang="en">Even with the most meticulous attention to detail,
	something could still go wrong while setting up a terminal.
	Here is a list of common symptoms and some suggested
	fixes.</p><p xml:lang="en" lang="en">If no login prompt appears, make sure the terminal is
	plugged in and powered up.  If it is a personal computer
	acting as a terminal, make sure it is running terminal
	emulation software on the correct serial port.</p><p xml:lang="en" lang="en">Make sure the cable is connected firmly to both the
	terminal and the FreeBSD computer.  Make sure it is the right
	kind of cable.</p><p xml:lang="en" lang="en">Make sure the terminal and FreeBSD agree on the
	<acronym class="acronym">bps</acronym> rate and parity settings.  For a video
	display terminal, make sure the contrast and brightness
	controls are turned up.  If it is a printing terminal, make
	sure paper and ink are in good supply.</p><p xml:lang="en" lang="en">Use <code class="command">ps</code> to make sure that a
	<code class="command">getty</code> process is running and serving the
	terminal.  For example, the following listing shows that a
	<code class="command">getty</code> is running on the second serial port,
	<code class="filename">ttyu1</code>, and is using the
	<code class="literal">std.38400</code> entry in
	<code class="filename">/etc/gettytab</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ps -axww|grep ttyu</code></strong>
22189  d1  Is+    0:00.03 /usr/libexec/getty std.38400 ttyu1</pre><p xml:lang="en" lang="en">If no <code class="command">getty</code> process is running, make
	sure the port is enabled in <code class="filename">/etc/ttys</code>.
	Remember to run <code class="command">kill -HUP 1</code> after modifying
	<code class="filename">/etc/ttys</code>.</p><p xml:lang="en" lang="en">If the <code class="command">getty</code> process is running but the
	terminal still does not display a login prompt, or if it
	displays a prompt but will not accept typed input, the
	terminal or cable may not support hardware handshaking.  Try
	changing the entry in <code class="filename">/etc/ttys</code> from
	<code class="literal">std.38400</code> to
	<code class="literal">3wire.38400</code>, then run <code class="command">kill -HUP
	  1</code> after modifying <code class="filename">/etc/ttys</code>.
	The <code class="literal">3wire</code> entry is similar to
	<code class="literal">std</code>, but ignores hardware handshaking.  The
	baud rate may need to be reduced or software flow control
	enabled when using <code class="literal">3wire</code> to prevent buffer
	overflows.</p><p xml:lang="en" lang="en">If garbage appears instead of a login prompt, make sure
	the terminal and FreeBSD agree on the <acronym class="acronym">bps</acronym> rate
	and parity settings.  Check the <code class="command">getty</code>
	processes to make sure the correct
	<em class="replaceable"><code>getty</code></em> type is in use.  If not, edit
	<code class="filename">/etc/ttys</code> and run <code class="command">kill
	  -HUP 1</code>.</p><p xml:lang="en" lang="en">If characters appear doubled and the password appears when
	typed, switch the terminal, or the terminal emulation
	software, from <span class="quote">“<span class="quote">half duplex</span>”</span> or <span class="quote">“<span class="quote">local
	  echo</span>”</span> to <span class="quote">“<span class="quote">full duplex.</span>”</span></p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dialup"></a>26.4. 撥入服務</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Guy</span> <span class="surname">Helmer</span></span>. </span></div><div><span class="authorgroup">Additions by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Sean</span> <span class="surname">Kelly</span></span>. </span></div></div></div><a id="idp81607992" class="indexterm"></a><p xml:lang="en" lang="en">Configuring a FreeBSD system for dial-in service is similar to
      configuring terminals, except that modems are used instead of
      terminal devices.  FreeBSD supports both external and internal
      modems.</p><p xml:lang="en" lang="en">External modems are more convenient because they often can
      be configured via parameters stored in non-volatile
      <acronym class="acronym">RAM</acronym> and they usually provide lighted
      indicators that display the state of important
      <acronym class="acronym">RS-232</acronym> signals, indicating whether the modem
      is operating properly.</p><p xml:lang="en" lang="en">Internal modems usually lack non-volatile
      <acronym class="acronym">RAM</acronym>, so their configuration may be limited to
      setting <acronym class="acronym">DIP</acronym> switches.  If the internal modem
      has any signal indicator lights, they are difficult to view when
      the system's cover is in place.</p><a id="idp81611832" class="indexterm"></a><p xml:lang="en" lang="en">When using an external modem, a proper cable is needed.  A
      standard <acronym class="acronym">RS-232C</acronym> serial cable should
      suffice.</p><p xml:lang="en" lang="en">FreeBSD needs the <acronym class="acronym">RTS</acronym> and
      <acronym class="acronym">CTS</acronym> signals for flow control at speeds above
      2400 bps, the <acronym class="acronym">CD</acronym> signal to detect when a
      call has been answered or the line has been hung up, and the
      <acronym class="acronym">DTR</acronym> signal to reset the modem after a session
      is complete.  Some cables are wired without all of the needed
      signals, so if a login session does not go away when the line
      hangs up, there may be a problem with the cable.  Refer to <a class="xref" href="#term-cables-null" title="26.2.1. 序列線與埠">節 26.2.1, “序列線與埠”</a> for more information about these
      signals.</p><p xml:lang="en" lang="en">Like other <span class="trademark">UNIX</span>®-like operating systems, FreeBSD uses the
      hardware signals to find out when a call has been answered or a
      line has been hung up and to hangup and reset the modem after a
      call.  FreeBSD avoids sending commands to the modem or watching for
      status reports from the modem.</p><p xml:lang="en" lang="en">FreeBSD supports the <acronym class="acronym">NS8250</acronym>,
      <acronym class="acronym">NS16450</acronym>, <acronym class="acronym">NS16550</acronym>, and
      <acronym class="acronym">NS16550A</acronym>-based <acronym class="acronym">RS-232C</acronym>
      (<acronym class="acronym">CCITT</acronym> V.24) communications interfaces.  The
      8250 and 16450 devices have single-character buffers.  The 16550
      device provides a 16-character buffer, which allows for better
      system performance.  Bugs in plain 16550 devices prevent the use
      of the 16-character buffer, so use 16550A devices if possible.
      Because single-character-buffer devices require more work by the
      operating system than the 16-character-buffer devices,
      16550A-based serial interface cards are preferred.  If the
      system has many active serial ports or will have a heavy load,
      16550A-based cards are better for low-error-rate
      communications.</p><p xml:lang="en" lang="en">The rest of this section demonstrates how to configure a
      modem to receive incoming connections, how to communicate with
      the modem, and offers some troubleshooting tips.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="dialup-ttys"></a>26.4.1. 數據機設定</h3></div></div></div><a id="idp81645624" class="indexterm"></a><p xml:lang="en" lang="en">As with terminals, <code class="command">init</code> spawns a
	<code class="command">getty</code> process for each configured serial
	port used for dial-in connections.  When a user dials the
	modem's line and the modems connect, the <span class="quote">“<span class="quote">Carrier
	  Detect</span>”</span> signal is reported by the modem.  The kernel
	notices that the carrier has been detected and instructs
	<code class="command">getty</code> to open the port and display a
	<code class="prompt">login:</code> prompt at the specified initial line
	speed.  In a typical configuration, if garbage characters are
	received, usually due to the modem's connection speed being
	different than the configured speed, <code class="command">getty</code>
	tries adjusting the line speeds until it receives reasonable
	characters.  After the user enters their login name,
	<code class="command">getty</code> executes <code class="command">login</code>,
	which completes the login process by asking for the user's
	password and then starting the user's shell.</p><a id="idp81654072" class="indexterm"></a><p xml:lang="en" lang="en">There are two schools of thought regarding dial-up modems.
	One configuration method is to set the modems and systems so
	that no matter at what speed a remote user dials in, the
	dial-in <acronym class="acronym">RS-232</acronym> interface runs at a locked
	speed.  The benefit of this configuration is that the remote
	user always sees a system login prompt immediately.  The
	downside is that the system does not know what a user's true
	data rate is, so full-screen programs like
	<span class="application">Emacs</span> will not adjust their
	screen-painting methods to make their response better for
	slower connections.</p><p xml:lang="en" lang="en">The second method is to configure the
	<acronym class="acronym">RS-232</acronym> interface to vary its speed based on
	the remote user's connection speed.  Because
	<code class="command">getty</code> does not understand any particular
	modem's connection speed reporting, it gives a
	<code class="prompt">login:</code> message at an initial speed and
	watches the characters that come back in response.  If the
	user sees junk, they should press <span class="keycap"><strong>Enter</strong></span> until
	they see a recognizable prompt.  If the data rates do not
	match, <code class="command">getty</code> sees anything the user types
	as junk, tries the next speed, and gives the
	<code class="prompt">login:</code> prompt again.  This procedure normally
	only takes a keystroke or two before the user sees a good
	prompt.  This login sequence does not look as clean as the
	locked-speed method, but a user on a low-speed connection
	should receive better interactive response from full-screen
	programs.</p><p xml:lang="en" lang="en">When locking a modem's data communications rate at a
	particular speed, no changes to
	<code class="filename">/etc/gettytab</code> should be needed.  However,
	for a matching-speed configuration, additional entries may be
	required in order to define the speeds to use for the modem.
	This example configures a 14.4 Kbps modem with a top
	interface speed of 19.2 Kbps using 8-bit, no parity
	connections.  It configures <code class="command">getty</code> to start
	the communications rate for a V.32bis connection at
	19.2 Kbps, then cycles through 9600 bps,
	2400 bps, 1200 bps, 300 bps, and back to
	19.2 Kbps.  Communications rate cycling is implemented
	with the <code class="literal">nx=</code> (next table) capability.  Each
	line uses a <code class="literal">tc=</code> (table continuation) entry
	to pick up the rest of the settings for a particular data
	rate.</p><pre xml:lang="en" class="programlisting" lang="en">#
# Additions for a V.32bis Modem
#
um|V300|High Speed Modem at 300,8-bit:\
        :nx=V19200:tc=std.300:
un|V1200|High Speed Modem at 1200,8-bit:\
        :nx=V300:tc=std.1200:
uo|V2400|High Speed Modem at 2400,8-bit:\
        :nx=V1200:tc=std.2400:
up|V9600|High Speed Modem at 9600,8-bit:\
        :nx=V2400:tc=std.9600:
uq|V19200|High Speed Modem at 19200,8-bit:\
        :nx=V9600:tc=std.19200:</pre><p xml:lang="en" lang="en">For a 28.8 Kbps modem, or to take advantage of
	compression on a 14.4 Kbps modem, use a higher
	communications rate, as seen in this example:</p><pre xml:lang="en" class="programlisting" lang="en">#
# Additions for a V.32bis or V.34 Modem
# Starting at 57.6 Kbps
#
vm|VH300|Very High Speed Modem at 300,8-bit:\
        :nx=VH57600:tc=std.300:
vn|VH1200|Very High Speed Modem at 1200,8-bit:\
        :nx=VH300:tc=std.1200:
vo|VH2400|Very High Speed Modem at 2400,8-bit:\
        :nx=VH1200:tc=std.2400:
vp|VH9600|Very High Speed Modem at 9600,8-bit:\
        :nx=VH2400:tc=std.9600:
vq|VH57600|Very High Speed Modem at 57600,8-bit:\
        :nx=VH9600:tc=std.57600:</pre><p xml:lang="en" lang="en">For a slow <acronym class="acronym">CPU</acronym> or a heavily loaded
	system without 16550A-based serial ports, this configuration
	may produce <span class="errorname">sio</span>
	<span class="quote">“<span class="quote">silo</span>”</span> errors at 57.6 Kbps.</p><a id="idp81664440" class="indexterm"></a><p xml:lang="en" lang="en">The configuration of <code class="filename">/etc/ttys</code> is
	similar to <a class="xref" href="#ex-etc-ttys" title="範例 26.1. 設定終端機項目">範例 26.1, “設定終端機項目”</a>, but a different
	argument is passed to <code class="command">getty</code> and
	<code class="literal">dialup</code> is used for the terminal type.
	Replace <em class="replaceable"><code>xxx</code></em> with the process
	<code class="command">init</code> will run on the device:</p><pre xml:lang="en" class="programlisting" lang="en">ttyu0   "/usr/libexec/getty <em class="replaceable"><code>xxx</code></em>"   dialup on</pre><p xml:lang="en" lang="en">The <code class="literal">dialup</code> terminal type can be
	changed.  For example, setting <code class="literal">vt102</code> as the
	default terminal type allows users to use
	<acronym class="acronym">VT102</acronym> emulation on their remote
	systems.</p><p xml:lang="en" lang="en">For a locked-speed configuration, specify the speed with
	a valid type listed in <code class="filename">/etc/gettytab</code>.
	This example is for a modem whose port speed is locked at
	19.2 Kbps:</p><pre xml:lang="en" class="programlisting" lang="en">ttyu0   "/usr/libexec/getty std.<em class="replaceable"><code>19200</code></em>"   dialup on</pre><p xml:lang="en" lang="en">In a matching-speed configuration, the entry needs to
	reference the appropriate beginning <span class="quote">“<span class="quote">auto-baud</span>”</span>
	entry in <code class="filename">/etc/gettytab</code>.  To continue the
	example for a matching-speed modem that starts at
	19.2 Kbps, use this entry:</p><pre xml:lang="en" class="programlisting" lang="en">ttyu0   "/usr/libexec/getty V19200"   dialup on</pre><p xml:lang="en" lang="en">After editing <code class="filename">/etc/ttys</code>, wait until
	the modem is properly configured and connected before
	signaling <code class="command">init</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kill -HUP 1</code></strong></pre><a id="idp81684920" class="indexterm"></a><p xml:lang="en" lang="en">High-speed modems, like <acronym class="acronym">V.32</acronym>,
	<acronym class="acronym">V.32bis</acronym>, and <acronym class="acronym">V.34</acronym>
	modems, use hardware (<code class="literal">RTS/CTS</code>) flow
	control.  Use <code class="command">stty</code> to set the hardware flow
	control flag for the modem port.  This example sets the
	<code class="varname">crtscts</code> flag on <code class="filename">COM2</code>'s
	dial-in and dial-out initialization devices:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>stty -f /dev/ttyu1.init crtscts</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>stty -f /dev/cuau1.init crtscts</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81703992"></a>26.4.2. 疑難排解</h3></div></div></div><p xml:lang="en" lang="en">This section provides a few tips for troubleshooting a
	dial-up modem that will not connect to a FreeBSD system.</p><p xml:lang="en" lang="en">Hook up the modem to the FreeBSD system and boot the system.
	If the modem has status indication lights, watch to see
	whether the modem's <acronym class="acronym">DTR</acronym> indicator lights
	when the <code class="prompt">login:</code> prompt appears on the
	system's console.  If it lights up, that should mean that FreeBSD
	has started a <code class="command">getty</code> process on the
	appropriate communications port and is waiting for the modem
	to accept a call.</p><p xml:lang="en" lang="en">If the <acronym class="acronym">DTR</acronym> indicator does not light,
	login to the FreeBSD system through the console and type
	<code class="command">ps ax</code> to see if FreeBSD is running a
	<code class="command">getty</code> process on the correct port:</p><pre xml:lang="en" class="screen" lang="en">  114 ??  I      0:00.10 /usr/libexec/getty V19200 <em class="replaceable"><code>ttyu0</code></em></pre><p xml:lang="en" lang="en">If the second column contains a <code class="literal">d0</code>
	instead of a <code class="literal">??</code> and the modem has not
	accepted a call yet, this means that <code class="command">getty</code>
	has completed its open on the communications port.  This could
	indicate a problem with the cabling or a misconfigured modem
	because <code class="command">getty</code> should not be able to open
	the communications port until the carrier detect signal has
	been asserted by the modem.</p><p xml:lang="en" lang="en">If no <code class="command">getty</code> processes are waiting to
	open the port, double-check that the entry for the port is
	correct in <code class="filename">/etc/ttys</code>.  Also, check
	<code class="filename">/var/log/messages</code> to see if there are
	any log messages from <code class="command">init</code> or
	<code class="command">getty</code>.</p><p xml:lang="en" lang="en">Next, try dialing into the system.  Be sure to use 8 bits,
	no parity, and 1 stop bit on the remote system.  If a prompt
	does not appear right away, or the prompt shows garbage, try
	pressing <span class="keycap"><strong>Enter</strong></span> about once per second.  If
	there is still no <code class="prompt">login:</code> prompt,
	try sending a <code class="command">BREAK</code>.  When using a
	high-speed modem, try dialing again after locking the
	dialing modem's interface speed.</p><p xml:lang="en" lang="en">If there is still no <code class="prompt">login:</code> prompt, check
	<code class="filename">/etc/gettytab</code> again and double-check
	that:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">The initial capability name specified in the entry in
	    <code class="filename">/etc/ttys</code> matches the name of a
	    capability in <code class="filename">/etc/gettytab</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en">Each <code class="literal">nx=</code> entry matches another
	    <code class="filename">gettytab</code> capability name.</p></li><li class="listitem"><p xml:lang="en" lang="en">Each <code class="literal">tc=</code> entry matches another
	    <code class="filename">gettytab</code> capability name.</p></li></ul></div><p xml:lang="en" lang="en">If the modem on the FreeBSD system will not answer, make
	sure that the modem is configured to answer the phone when
	<acronym class="acronym">DTR</acronym> is asserted.  If the modem seems to be
	configured correctly, verify that the
	<acronym class="acronym">DTR</acronym> line is asserted by checking the
	modem's indicator lights.</p><p xml:lang="en" lang="en">If it still does not work, try sending an email
	to the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions" target="_top">FreeBSD general questions mailing list</a> describing the modem and the
	problem.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dialout"></a>26.5. 撥出服務</h2></div></div></div><a id="idp81754424" class="indexterm"></a><p xml:lang="en" lang="en">The following are tips for getting the host to connect over
      the modem to another computer.  This is appropriate for
      establishing a terminal session with a remote host.</p><p xml:lang="en" lang="en">This kind of connection can be helpful to get a file on the
      Internet if there are problems using PPP.  If PPP is not
      working, use the terminal session to FTP the needed file.  Then
      use zmodem to transfer it to the machine.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="hayes-unsupported"></a>26.5.1. 使用 Stock Hayes 數據機</h3></div></div></div><p xml:lang="en" lang="en">A generic Hayes dialer is built into
	<code class="command">tip</code>.  Use <code class="literal">at=hayes</code> in
	<code class="filename">/etc/remote</code>.</p><p xml:lang="en" lang="en">The Hayes driver is not smart enough to recognize some of
	the advanced features of newer modems messages like
	<code class="literal">BUSY</code>, <code class="literal">NO DIALTONE</code>, or
	<code class="literal">CONNECT 115200</code>.  Turn those messages off
	when using <code class="command">tip</code> with
	<code class="command">ATX0&amp;W</code>.</p><p xml:lang="en" lang="en">The dial timeout for <code class="command">tip</code> is 60
	seconds.  The modem should use something less, or else
	<code class="command">tip</code> will think there is a communication
	problem.  Try <code class="command">ATS7=45&amp;W</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="direct-at"></a>26.5.2. 使用 <code class="literal">AT</code> 指令</h3></div></div></div><a id="idp81768120" class="indexterm"></a><p xml:lang="en" lang="en">Create a <span class="quote">“<span class="quote">direct</span>”</span> entry in
	<code class="filename">/etc/remote</code>.  For example, if the modem
	is hooked up to the first serial port,
	<code class="filename">/dev/cuau0</code>, use the following
	line:</p><pre xml:lang="en" class="programlisting" lang="en">cuau0:dv=/dev/cuau0:br#19200:pa=none</pre><p xml:lang="en" lang="en">Use the highest <acronym class="acronym">bps</acronym> rate the modem
	supports in the <code class="literal">br</code> capability.  Then, type
	<code class="command">tip cuau0</code> to connect to the modem.</p><p xml:lang="en" lang="en">Or, use <code class="command">cu</code> as <code class="systemitem">root</code> with the following
	      command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cu -l<em class="replaceable"><code>line</code></em> -s<em class="replaceable"><code>speed</code></em></code></strong></pre><p xml:lang="en" lang="en"><em class="replaceable"><code>line</code></em> is the serial port, such
	as <code class="filename">/dev/cuau0</code>, and
	<em class="replaceable"><code>speed</code></em> is the speed, such as
	<code class="literal">57600</code>.  When finished entering the AT
	commands, type <code class="command">~.</code> to exit.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="gt-failure"></a>26.5.3. <code class="literal">@</code> 符號無法運作</h3></div></div></div><p xml:lang="en" lang="en">The <code class="literal">@</code> sign in the phone number
	capability tells <code class="command">tip</code> to look in
	<code class="filename">/etc/phones</code> for a phone number.  But, the
	<code class="literal">@</code> sign is also a special character in
	capability files like <code class="filename">/etc/remote</code>, so it
	needs to be escaped with a backslash:</p><pre xml:lang="en" class="programlisting" lang="en">pn=\@</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="dial-command-line"></a>26.5.4. 從指令列撥號</h3></div></div></div><p xml:lang="en" lang="en">Put a <span class="quote">“<span class="quote">generic</span>”</span> entry in
	<code class="filename">/etc/remote</code>.  For example:</p><pre xml:lang="en" class="programlisting" lang="en">tip115200|Dial any phone number at 115200 bps:\
        :dv=/dev/cuau0:br#115200:at=hayes:pa=none:du:
tip57600|Dial any phone number at 57600 bps:\
        :dv=/dev/cuau0:br#57600:at=hayes:pa=none:du:</pre><p xml:lang="en" lang="en">This should now work:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>tip -115200 5551234</code></strong></pre><p xml:lang="en" lang="en">Users who prefer <code class="command">cu</code> over
	<code class="command">tip</code>, can use a generic
	<code class="literal">cu</code> entry:</p><pre xml:lang="en" class="programlisting" lang="en">cu115200|Use cu to dial any number at 115200bps:\
        :dv=/dev/cuau1:br#57600:at=hayes:pa=none:du:</pre><p xml:lang="en" lang="en">and type:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cu 5551234 -s 115200</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="set-bps"></a>26.5.5. 設定 <acronym class="acronym">bps</acronym> 率</h3></div></div></div><p xml:lang="en" lang="en">Put in an entry for <code class="literal">tip1200</code> or
	<code class="literal">cu1200</code>, but go ahead and use whatever
	<acronym class="acronym">bps</acronym> rate is appropriate with the
	<code class="literal">br</code> capability.
	<code class="command">tip</code> thinks a good default is 1200 bps
	which is why it looks for a <code class="literal">tip1200</code> entry.
	1200 bps does not have to be used, though.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="terminal-server"></a>26.5.6. 透過終端伺服器存取多個主機</h3></div></div></div><p xml:lang="en" lang="en">Rather than waiting until connected and typing
	<code class="command">CONNECT <em class="replaceable"><code>host</code></em></code>
	each time, use <code class="command">tip</code>'s <code class="literal">cm</code>
	capability.  For example, these entries in
	<code class="filename">/etc/remote</code> will let you type
	<code class="command">tip pain</code> or <code class="command">tip muffin</code>
	to connect to the hosts <code class="systemitem">pain</code> or
	<code class="systemitem">muffin</code>, and <code class="command">tip
	  deep13</code> to connect to the terminal server.</p><pre xml:lang="en" class="programlisting" lang="en">pain|pain.deep13.com|Forrester's machine:\
        :cm=CONNECT pain\n:tc=deep13:
muffin|muffin.deep13.com|Frank's machine:\
        :cm=CONNECT muffin\n:tc=deep13:
deep13:Gizmonics Institute terminal server:\
        :dv=/dev/cuau2:br#38400:at=hayes:du:pa=none:pn=5551234:</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="tip-multiline"></a>26.5.7. 在 <code class="command">tip</code> 使用超過一行</h3></div></div></div><p xml:lang="en" lang="en">This is often a problem where a university has several
	modem lines and several thousand students trying to use
	them.</p><p xml:lang="en" lang="en">Make an entry in <code class="filename">/etc/remote</code> and use
	<code class="literal">@</code> for the <code class="literal">pn</code>
	capability:</p><pre xml:lang="en" class="programlisting" lang="en">big-university:\
        :pn=\@:tc=dialout
dialout:\
        :dv=/dev/cuau3:br#9600:at=courier:du:pa=none:</pre><p xml:lang="en" lang="en">Then, list the phone numbers in
	<code class="filename">/etc/phones</code>:</p><pre xml:lang="en" class="programlisting" lang="en">big-university 5551111
big-university 5551112
big-university 5551113
big-university 5551114</pre><p xml:lang="en" lang="en"><code class="command">tip</code> will try each number in the listed
	order, then give up.  To keep retrying, run
	<code class="command">tip</code> in a <code class="literal">while</code>
	loop.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="multi-controlp"></a>26.5.8. 使用強制字元</h3></div></div></div><p xml:lang="en" lang="en"><span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>P</strong></span> is the default <span class="quote">“<span class="quote">force</span>”</span> character,
	used to tell <code class="command">tip</code> that the next character is
	literal data.  The force character can be set to any other
	character with the <code class="command">~s</code> escape, which means
	<span class="quote">“<span class="quote">set a variable.</span>”</span></p><p xml:lang="en" lang="en">Type
	<code class="command">~sforce=<em class="replaceable"><code>single-char</code></em></code>
	followed by a newline.  <em class="replaceable"><code>single-char</code></em>
	is any single character.  If
	<em class="replaceable"><code>single-char</code></em> is left out, then the
	force character is the null character, which is accessed by
	typing
	<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>2</strong></span>
	or <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Space</strong></span>.  A pretty good value for
	<em class="replaceable"><code>single-char</code></em> is
	<span class="keycap"><strong>Shift</strong></span>+<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>6</strong></span>, which is only used on some terminal
	servers.</p><p xml:lang="en" lang="en">To change the force character, specify the following in
	<code class="filename">~/.tiprc</code>:</p><pre xml:lang="en" class="programlisting" lang="en">force=<em class="replaceable"><code>single-char</code></em></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="uppercase"></a>26.5.9. 大寫字元</h3></div></div></div><p xml:lang="en" lang="en">This happens when
	<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>A</strong></span> is pressed, which is <code class="command">tip</code>'s
	<span class="quote">“<span class="quote">raise character</span>”</span>, specially designed for people
	with broken caps-lock keys.  Use <code class="command">~s</code> to set
	<code class="literal">raisechar</code> to something reasonable.  It can
	be set to be the same as the force character, if neither
	feature is used.</p><p xml:lang="en" lang="en">Here is a sample <code class="filename">~/.tiprc</code> for
	<span class="application">Emacs</span> users who need to type
	<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>2</strong></span> and <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>A</strong></span>:</p><pre xml:lang="en" class="programlisting" lang="en">force=^^
raisechar=^^</pre><p xml:lang="en" lang="en">The <code class="literal">^^</code> is
	<span class="keycap"><strong>Shift</strong></span>+<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>6</strong></span>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="tip-filetransfer"></a>26.5.10. 使用 <code class="command">tip</code> 傳輸檔案</h3></div></div></div><p xml:lang="en" lang="en">When talking to another <span class="trademark">UNIX</span>®-like operating system,
	files can be sent and received using <code class="command">~p</code>
	(put) and <code class="command">~t</code> (take).  These commands run
	<code class="command">cat</code> and <code class="command">echo</code> on the
	remote system to accept and send files.  The syntax is:</p><div xml:lang="en" class="cmdsynopsis" lang="en"><p><code class="command">~p</code>  local-file  [remote-file]</p></div><div xml:lang="en" class="cmdsynopsis" lang="en"><p><code class="command">~t</code>  remote-file  [local-file]</p></div><p xml:lang="en" lang="en">There is no error checking, so another protocol, like
	zmodem, should probably be used.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zmodem-tip"></a>26.5.11. 在 <span class="application">zmodem</span> 使用 <code class="command">tip</code>?</h3></div></div></div><p xml:lang="en" lang="en">To receive files, start the sending program on the remote
	end.  Then, type <code class="command">~C rz</code> to begin receiving
	them locally.</p><p xml:lang="en" lang="en">To send files, start the receiving program on the remote
	end.  Then, type <code class="command">~C sz
	<em class="replaceable"><code>files</code></em></code> to send them to the
	remote system.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="serialconsole-setup"></a>26.6. 設定序列 Console</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Kazutaka</span> <span class="surname">YOKOTA</span></span>. </span></div><div><span class="authorgroup">Based on a document by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Bill</span> <span class="surname">Paul</span></span>. </span></div></div></div><a id="idp81889080" class="indexterm"></a><p xml:lang="en" lang="en">FreeBSD has the ability to boot a system with a dumb
      terminal on a serial port as a console.  This configuration is
      useful for system administrators who wish to install FreeBSD on
      machines that have no keyboard or monitor attached, and
      developers who want to debug the kernel or device
      drivers.</p><p xml:lang="en" lang="en">As described in <a class="xref" href="#boot" title="章 12. FreeBSD 開機程序">章 12, <em>FreeBSD 開機程序</em></a>, FreeBSD employs a three
      stage bootstrap.  The first two stages are in the boot block
      code which is stored at the beginning of the FreeBSD slice on the
      boot disk.  The boot block then loads and runs the boot loader
      as the third stage code.</p><p xml:lang="en" lang="en">In order to set up booting from a serial console, the boot
      block code, the boot loader code, and the kernel need to be
      configured.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-howto-fast"></a>26.6.1. 快速序列 Console 設定</h3></div></div></div><p xml:lang="en" lang="en">This section provides a fast overview of setting up the
	serial console.  This procedure can be used when the dumb
	terminal is connected to <code class="filename">COM1</code>.</p><div class="procedure"><a id="idp81893304"></a><div class="procedure-title">過程 26.1. Configuring a Serial Console on
	  <code class="filename">COM1</code></div><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">Connect the serial cable to
	    <code class="filename">COM1</code> and the controlling
	    terminal.</p></li><li class="step"><p xml:lang="en" lang="en">To configure boot messages to display on the serial
	    console, issue the following command as the
	    superuser:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> sysrc -f /boot/loader.conf console=comconsole</pre></li><li class="step"><p xml:lang="en" lang="en">Edit <code class="filename">/etc/ttys</code> and change
	    <code class="literal">off</code> to <code class="literal">on</code> and
	    <code class="literal">dialup</code> to <code class="literal">vt100</code> for
	    the <code class="filename">ttyu0</code> entry.  Otherwise, a
	    password will not be required to connect via the serial
	    console, resulting in a potential security hole.</p></li><li class="step"><p xml:lang="en" lang="en">Reboot the system to see if the changes took
	    effect.</p></li></ol></div><p xml:lang="en" lang="en">If a different configuration is required, see the next
	section for a more in-depth configuration explanation.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-howto"></a>26.6.2. 深入序列 Console 設定</h3></div></div></div><p xml:lang="en" lang="en">This section provides a more detailed explanation of the
	steps needed to setup a serial console in FreeBSD.</p><div class="procedure"><a id="idp81903544"></a><div class="procedure-title">過程 26.2. Configuring a Serial Console</div><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">Prepare a serial cable.</p><a id="idp81905080" class="indexterm"></a><p xml:lang="en" lang="en">Use either a null-modem cable or a standard serial
	    cable and a null-modem adapter.  See <a class="xref" href="#term-cables-null" title="26.2.1. 序列線與埠">節 26.2.1, “序列線與埠”</a> for a discussion on serial
	    cables.</p></li><li class="step"><p xml:lang="en" lang="en">Unplug the keyboard.</p><p xml:lang="en" lang="en">Many systems probe for the keyboard during the
	    Power-On Self-Test (<acronym class="acronym">POST</acronym>) and will
	    generate an error if the keyboard is not detected.  Some
	    machines will refuse to boot until the keyboard is plugged
	    in.</p><p xml:lang="en" lang="en">If the computer complains about the error, but boots
	    anyway, no further configuration is needed.</p><p xml:lang="en" lang="en">If the computer refuses to boot without a keyboard
	    attached, configure the <acronym class="acronym">BIOS</acronym> so that it
	    ignores this error.  Consult the motherboard's manual for
	    details on how to do this.</p><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Try setting the keyboard to <span class="quote">“<span class="quote">Not
		installed</span>”</span> in the <acronym class="acronym">BIOS</acronym>.
	      This setting tells the <acronym class="acronym">BIOS</acronym> not to
	      probe for a keyboard at power-on so it should not
	      complain if the keyboard is absent.  If that option is
	      not present in the <acronym class="acronym">BIOS</acronym>, look for an
	      <span class="quote">“<span class="quote">Halt on Error</span>”</span> option instead.  Setting
	      this to <span class="quote">“<span class="quote">All but Keyboard</span>”</span> or to <span class="quote">“<span class="quote">No
		Errors</span>”</span> will have the same effect.</p></div><p xml:lang="en" lang="en">If the system has a <span class="trademark">PS/2</span>® mouse, unplug it as well.
	    <span class="trademark">PS/2</span>® mice share some hardware with the keyboard and
	    leaving the mouse plugged in can fool the keyboard probe
	    into thinking the keyboard is still there.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">While most systems will boot without a keyboard,
	      quite a few will not boot without a graphics adapter.
	      Some systems can be configured to  boot with no graphics
	      adapter by changing the <span class="quote">“<span class="quote">graphics adapter</span>”</span>
	      setting in the <acronym class="acronym">BIOS</acronym> configuration to
	      <span class="quote">“<span class="quote">Not installed</span>”</span>.  Other systems do not
	      support this option and will refuse to boot if there is
	      no display hardware in the system.  With these machines,
	      leave some kind of graphics card plugged in, even if it
	      is just a junky mono board.  A monitor does not need to
	      be attached.</p></div></li><li class="step"><p xml:lang="en" lang="en">Plug a dumb terminal, an old computer with a modem
	    program, or the serial port on another <span class="trademark">UNIX</span>® box into the
	    serial port.</p></li><li class="step"><p xml:lang="en" lang="en">Add the appropriate <code class="literal">hint.sio.*</code>
	    entries to <code class="filename">/boot/device.hints</code> for the
	    serial port.  Some multi-port cards also require kernel
	    configuration options.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sio&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sio</span>(4)</span></a> for the
	    required options and device hints for each supported
	    serial port.</p></li><li class="step"><p xml:lang="en" lang="en">Create <code class="filename">boot.config</code> in the root
	    directory of the <code class="literal">a</code> partition on the
	    boot drive.</p><p xml:lang="en" lang="en">This file instructs the boot block code how to boot
	    the system.  In order to activate the serial console, one
	    or more of the following options are needed.  When using
	    multiple options, include them all on the same
	    line:</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en"><code class="option">-h</code></span></dt><dd><p xml:lang="en" lang="en">Toggles between the internal and serial
		  consoles.  Use this to switch console devices.  For
		  instance, to boot from the internal (video) console,
		  use <code class="option">-h</code> to direct the boot loader
		  and the kernel to use the serial port as its console
		  device.  Alternatively, to boot from the serial
		  port, use <code class="option">-h</code> to tell the boot
		  loader and the kernel to use the video display as
		  the console instead.</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="option">-D</code></span></dt><dd><p xml:lang="en" lang="en">Toggles between the single and dual console
		  configurations.  In the single configuration, the
		  console will be either the internal console (video
		  display) or the serial port, depending on the state
		  of <code class="option">-h</code>.  In the dual console
		  configuration, both the video display  and the
		  serial port will become the console at the same
		  time, regardless of the state of
		  <code class="option">-h</code>.  However, the dual console
		  configuration takes effect only while the boot
		  block is running.  Once the boot loader gets
		  control, the console specified by
		  <code class="option">-h</code> becomes the only
		  console.</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="option">-P</code></span></dt><dd><p xml:lang="en" lang="en">Makes the boot block probe the keyboard.  If no
		  keyboard is found, the <code class="option">-D</code> and
		  <code class="option">-h</code> options are automatically
		  set.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Due to space constraints in the current
		    version of the boot blocks, <code class="option">-P</code> is
		    capable of detecting extended keyboards only.
		    Keyboards with less than 101 keys and without F11
		    and F12 keys may not be detected.  Keyboards on
		    some laptops may not be properly found because of
		    this limitation.  If this is the case, do not use
		    <code class="option">-P</code>.</p></div></dd></dl></div><p xml:lang="en" lang="en">Use either <code class="option">-P</code> to select the console
	    automatically or <code class="option">-h</code> to activate the
	    serial console.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=boot&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">boot</span>(8)</span></a> and
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=boot.config&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">boot.config</span>(5)</span></a> for more details.</p><p xml:lang="en" lang="en">The options, except for <code class="option">-P</code>, are
	    passed to the boot loader.  The boot loader will
	    determine whether the internal video or the serial port
	    should become the console by examining the state of
	    <code class="option">-h</code>.  This means that if
	    <code class="option">-D</code> is specified but <code class="option">-h</code>
	    is not specified in <code class="filename">/boot.config</code>, the
	    serial port can be used as the console only during the
	    boot block as the boot loader will use the internal video
	    display as the console.</p></li><li class="step"><p xml:lang="en" lang="en">Boot the machine.</p><p xml:lang="en" lang="en">When FreeBSD starts, the boot blocks echo the contents of
	    <code class="filename">/boot.config</code> to the console.  For
	    example:</p><pre xml:lang="en" class="screen" lang="en">/boot.config: -P
Keyboard: no</pre><p xml:lang="en" lang="en">The second line appears only if <code class="option">-P</code> is
	    in <code class="filename">/boot.config</code> and indicates the
	    presence or absence of the keyboard.  These messages go
	    to either the serial or internal console, or both,
	    depending on the option in
	    <code class="filename">/boot.config</code>:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th xml:lang="en" align="left" lang="en">Options</th><th xml:lang="en" align="left" lang="en">Message goes to</th></tr></thead><tbody><tr><td xml:lang="en" lang="en">none</td><td xml:lang="en" lang="en">internal console</td></tr><tr><td xml:lang="en" lang="en"><code class="option">-h</code></td><td xml:lang="en" lang="en">serial console</td></tr><tr><td xml:lang="en" lang="en"><code class="option">-D</code></td><td xml:lang="en" lang="en">serial and internal consoles</td></tr><tr><td xml:lang="en" lang="en"><code class="option">-Dh</code></td><td xml:lang="en" lang="en">serial and internal consoles</td></tr><tr><td xml:lang="en" lang="en"><code class="option">-P</code>, keyboard present</td><td xml:lang="en" lang="en">internal console</td></tr><tr><td xml:lang="en" lang="en"><code class="option">-P</code>, keyboard absent</td><td xml:lang="en" lang="en">serial console</td></tr></tbody></table></div><p xml:lang="en" lang="en">After the message, there will be a small pause before
	    the boot blocks continue loading the boot loader and
	    before any further messages are printed to the console.
	    Under normal circumstances, there is no need to interrupt
	    the boot blocks, but one can do so in order to make sure
	    things are set up correctly.</p><p xml:lang="en" lang="en">Press any key, other than <span class="keycap"><strong>Enter</strong></span>, at
	    the console to interrupt the boot process.  The boot
	    blocks will then prompt for further action:</p><pre xml:lang="en" class="screen" lang="en">&gt;&gt; FreeBSD/i386 BOOT
Default: 0:ad(0,a)/boot/loader
boot:</pre><p xml:lang="en" lang="en">Verify that the above message appears on either the
	    serial or internal console, or both, according to the
	    options in <code class="filename">/boot.config</code>.  If the
	    message appears in the correct console, press
	    <span class="keycap"><strong>Enter</strong></span> to continue the boot
	    process.</p><p xml:lang="en" lang="en">If there is no prompt on the serial terminal,
	    something is wrong with the settings.  Enter
	    <code class="option">-h</code> then <span class="keycap"><strong>Enter</strong></span> or
	    <span class="keycap"><strong>Return</strong></span> to tell the boot block (and then
	    the boot loader and the kernel) to choose the serial port
	    for the console.  Once the system is up, go back and check
	    what went wrong.</p></li></ol></div><p xml:lang="en" lang="en">During the third stage of the boot process, one can still
	switch between the internal console and the serial console by
	setting appropriate environment variables in the boot loader.
	See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a> for more
	information.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">This line in <code class="filename">/boot/loader.conf</code> or
	  <code class="filename">/boot/loader.conf.local</code> configures the
	  boot loader and the kernel to send their boot messages to
	  the serial console, regardless of the options in
	  <code class="filename">/boot.config</code>:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="programlisting" lang="en">console="comconsole"</pre><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">That line should be the first line of
	  <code class="filename">/boot/loader.conf</code> so that boot messages
	  are displayed on the serial console as early as
	  possible.</p><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">If that line does not exist, or if it is set to
	  <code class="literal">console="vidconsole"</code>, the boot loader and
	  the kernel will use whichever console is indicated by
	  <code class="option">-h</code> in the boot block.  See
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader.conf</span>(5)</span></a> for more information.</p><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">At the moment, the boot loader has no option
	  equivalent to <code class="option">-P</code> in the boot block, and
	  there is no provision to automatically select the internal
	  console and the serial console based on the presence of the
	  keyboard.</p></div><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">While it is not required, it is possible to provide a
	  <code class="command">login</code> prompt over the serial line.  To
	  configure this, edit the entry for the serial port in
	  <code class="filename">/etc/ttys</code> using the instructions in
	  <a class="xref" href="#term-config" title="26.3.1. 終端機設定">節 26.3.1, “終端機設定”</a>.  If the speed of the serial
	  port has been changed, change <code class="literal">std.9600</code> to
	  match the new setting.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82032696"></a>26.6.3. 設定使用更快的序列埠速度</h3></div></div></div><p xml:lang="en" lang="en">By default, the serial port settings are 9600 baud, 8
	bits, no parity, and 1 stop bit.  To change the default
	console speed, use one of the following options:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Edit <code class="filename">/etc/make.conf</code> and set
	    <code class="varname">BOOT_COMCONSOLE_SPEED</code> to the new
	    console speed.  Then, recompile and install the boot
	    blocks and the boot loader:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /sys/boot</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make clean</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong></pre><p xml:lang="en" lang="en">If the serial console is configured in some other way
	    than by booting with <code class="option">-h</code>, or if the serial
	    console used by the kernel is different from the one used
	    by the boot blocks, add the following option, with the
	    desired speed, to a custom kernel configuration file and
	    compile a new kernel:</p><pre xml:lang="en" class="programlisting" lang="en">options CONSPEED=<em class="replaceable"><code>19200</code></em></pre></li><li class="listitem"><p xml:lang="en" lang="en">Add the
	    <code class="option">-S<em class="replaceable"><code>19200</code></em></code> boot
	    option to <code class="filename">/boot.config</code>, replacing
	    <em class="replaceable"><code>19200</code></em> with the speed to
	    use.</p></li><li class="listitem"><p xml:lang="en" lang="en">Add the following options to
	    <code class="filename">/boot/loader.conf</code>.  Replace
	    <em class="replaceable"><code>115200</code></em> with the speed to
	    use.</p><pre xml:lang="en" class="programlisting" lang="en">boot_multicons="YES"
boot_serial="YES"
comconsole_speed="<em class="replaceable"><code>115200</code></em>"
console="comconsole,vidconsole"</pre></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-ddb"></a>26.6.4. 從序列線路 (Serial Line) 進入 DDB 除錯程式</h3></div></div></div><p xml:lang="en" lang="en">To configure the ability to drop into the kernel debugger
	from the serial console, add the following options to a custom
	kernel configuration file and compile the kernel using the
	instructions in <a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a>.  Note that
	while this is useful for remote diagnostics, it is also
	dangerous if a spurious BREAK is generated on the serial port.
	Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ddb&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ddb</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ddb&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ddb</span>(8)</span></a> for more information
	about the kernel debugger.</p><pre xml:lang="en" class="programlisting" lang="en">options BREAK_TO_DEBUGGER
options DDB</pre></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ppp-and-slip"></a>章 27. <acronym class="acronym">PPP</acronym></h2></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#ppp-and-slip-synopsis">27.1. 概述</a></span></dt><dt><span class="sect1"><a href="#userppp">27.2. 設定 <acronym class="acronym">PPP</acronym></a></span></dt><dd><dl><dt><span class="sect2"><a href="#userppp-staticIP">27.2.1. 基礎設定</a></span></dt><dt><span class="sect2"><a href="#idp82200248">27.2.2. 進階設定</a></span></dt><dd><dl><dt><span class="sect3"><a href="#userppp-PAPnCHAP">27.2.2.1. PAP 與 CHAP 認證</a></span></dt><dt><span class="sect3"><a href="#userppp-nat">27.2.2.2. 使用 <acronym class="acronym">PPP</acronym> 網路位址轉譯功能</a></span></dt></dl></dd><dt><span class="sect2"><a href="#userppp-final">27.2.3. 最終系統設定</a></span></dt><dt><span class="sect2"><a href="#idp82282808">27.2.4. 使用 <code class="command">ppp</code></a></span></dt><dt><span class="sect2"><a href="#userppp-mgetty">27.2.5. 設定撥入服務</a></span></dt></dl></dd><dt><span class="sect1"><a href="#ppp-troubleshoot">27.3. <acronym class="acronym">PPP</acronym> 連線疑難排解</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp82359736">27.3.1. 檢查裝置節點</a></span></dt><dt><span class="sect2"><a href="#idp82387256">27.3.2. 手動連線</a></span></dt><dt><span class="sect2"><a href="#idp82444856">27.3.3. 除錯</a></span></dt></dl></dd><dt><span class="sect1"><a href="#pppoe">27.4. 在乙太網路使用 <acronym class="acronym">PPP</acronym> (PPPoE)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp82493624">27.4.1. 使用 PPPoE 服務標籤</a></span></dt><dt><span class="sect2"><a href="#ppp-3com">27.4.2. 在 <span class="trademark">3Com</span>® <span class="trademark">HomeConnect</span>® ADSL Modem Dual Link 使用 PPPoE</a></span></dt></dl></dd><dt><span class="sect1"><a href="#pppoa">27.5. 在 ATM 使用 <span class="application">PPP</span> (PPPoA)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp82532408">27.5.1. 使用 mpd</a></span></dt><dt><span class="sect2"><a href="#idp82577720">27.5.2. 使用 pptpclient</a></span></dt></dl></dd></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ppp-and-slip-synopsis"></a>27.1. 概述</h2></div></div></div><a id="ppp-ppp" class="indexterm"></a><p>FreeBSD 支援點對點 (Point-to-Point, <acronym class="acronym">PPP</acronym>) 通訊協定，可透過撥號數據機用來建立網路或網際網路連線。本章將說明如何設定在 FreeBSD 中以數據機為基礎的通訊服務。</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>如何設定、使用 <acronym class="acronym">PPP</acronym> 連線及排除問題。</p></li><li class="listitem"><p>如何設定在乙太網路 (Ethernet) 上的 <acronym class="acronym">PPP</acronym> (<acronym class="acronym">PPPoE</acronym>)。</p></li><li class="listitem"><p>如何設定在 <acronym class="acronym">ATM</acronym> 上的 <acronym class="acronym">PPP</acronym> (<acronym class="acronym">PPPoA</acronym>)。</p></li></ul></div><a id="idp82059704" class="indexterm"></a><a id="idp82060728" class="indexterm"></a><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>熟悉基本網路術語。</p></li><li class="listitem"><p>了解撥號連線及 <acronym class="acronym">PPP</acronym> 的基礎及目的。</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="userppp"></a>27.2. 設定 <acronym class="acronym">PPP</acronym></h2></div></div></div><p xml:lang="en" lang="en">FreeBSD provides built-in support for managing dial-up
      <acronym class="acronym">PPP</acronym> connections using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>.  The
      default FreeBSD kernel provides support for
      <code class="filename">tun</code> which is used to interact with a
      modem hardware.  Configuration is performed by editing at least
      one configuration file, and configuration files containing
      examples are provided.  Finally, <code class="command">ppp</code> is
      used to start and manage connections.</p><p xml:lang="en" lang="en">In order to use a <acronym class="acronym">PPP</acronym> connection, the
      following items are needed:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">A dial-up account with an Internet Service Provider
	  (<acronym class="acronym">ISP</acronym>).</p></li><li class="listitem"><p xml:lang="en" lang="en">A dial-up modem.</p></li><li class="listitem"><p xml:lang="en" lang="en">The dial-up number for the
	  <acronym class="acronym">ISP</acronym>.</p></li><li class="listitem"><p xml:lang="en" lang="en">The login name and password assigned by the
	  <acronym class="acronym">ISP</acronym>.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <acronym class="acronym">IP</acronym> address of one or more
	  <acronym class="acronym">DNS</acronym> servers.  Normally, the
	  <acronym class="acronym">ISP</acronym> provides these addresses.  If it did
	  not, FreeBSD can be configured to use
	  <acronym class="acronym">DNS</acronym> negotiation.</p></li></ul></div><p xml:lang="en" lang="en">If any of the required information is missing, contact
      the <acronym class="acronym">ISP</acronym>.</p><p xml:lang="en" lang="en">The following information may be supplied by the
      <acronym class="acronym">ISP</acronym>, but is not necessary:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">The <acronym class="acronym">IP</acronym> address of the default
	  gateway.  If this information is unknown, the
	  <acronym class="acronym">ISP</acronym> will automatically provide the
	  correct value during connection setup.  When configuring
	  <acronym class="acronym">PPP</acronym> on FreeBSD, this address is referred to
	  as <code class="literal">HISADDR</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en">The subnet mask.  If the <acronym class="acronym">ISP</acronym> has not
	  provided one, <code class="systemitem">255.255.255.255</code> will be used
	  in the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> configuration file.</p></li><li class="listitem"><a id="ppp-static-ip" class="indexterm"></a><p xml:lang="en" lang="en">If the <acronym class="acronym">ISP</acronym> has assigned a static
	  <acronym class="acronym">IP</acronym> address and hostname, it should be
	  input into the configuration file.  Otherwise, this
	  information will be automatically provided during
	  connection setup.</p></li></ul></div><p xml:lang="en" lang="en">The rest of this section demonstrates how to configure FreeBSD
      for common <acronym class="acronym">PPP</acronym> connection scenarios.  The
      required configuration file is
      <code class="filename">/etc/ppp/ppp.conf</code> and additional files and
      examples are available in
      <code class="filename">/usr/share/examples/ppp/</code>.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Throughout this section, many of the file examples
	display line numbers.  These line numbers have been added to
	make it easier to follow the discussion and are not meant to
	be placed in the actual file.</p><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">When editing a configuration file, proper indentation is
	important.  Lines that end in a <code class="literal">:</code> start in
	the first column (beginning of the line) while all other lines
	should be indented as shown using spaces or tabs.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="userppp-staticIP"></a>27.2.1. 基礎設定</h3></div></div></div><a id="idp82116280" class="indexterm"></a><p xml:lang="en" lang="en">In order to configure a <acronym class="acronym">PPP</acronym> connection,
	first edit <code class="filename">/etc/ppp/ppp.conf</code> with the
	dial-in information for the <acronym class="acronym">ISP</acronym>.  This file
	is described as follows:</p><pre xml:lang="en" class="programlisting" lang="en">1     default:
2       set log Phase Chat LCP IPCP CCP tun command
3       ident user-ppp VERSION
4       set device /dev/cuau0
5       set speed 115200
6       set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \
7                 \"\" AT OK-AT-OK ATE1Q0 OK \\dATDT\\T TIMEOUT 40 CONNECT"
8       set timeout 180
9       enable dns
10
11    provider:
12      set phone "(123) 456 7890"
13      set authname foo
14      set authkey bar
15      set timeout 300
16      set ifaddr <em class="replaceable"><code>x.x.x.x</code></em>/0 <em class="replaceable"><code>y.y.y.y</code></em>/0 255.255.255.255 0.0.0.0
17      add default HISADDR</pre><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en">Line 1:</span></dt><dd><p xml:lang="en" lang="en">Identifies the <code class="literal">default</code> entry.
		  Commands in this entry (lines 2 through 9) are
		  executed automatically when <code class="command">ppp</code>
		  is run.</p></dd><dt><span xml:lang="en" class="term" lang="en">Line 2:</span></dt><dd><p xml:lang="en" lang="en">Enables verbose logging parameters for testing
		  the connection.  Once the configuration is working
		  satisfactorily, this line should be reduced
		  to:</p><pre xml:lang="en" class="programlisting" lang="en">set log phase tun</pre></dd><dt><span xml:lang="en" class="term" lang="en">Line 3:</span></dt><dd><p xml:lang="en" lang="en">Displays the version of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> to the
		  <acronym class="acronym">PPP</acronym> software running on the other
		  side of the  connection.</p></dd><dt><span xml:lang="en" class="term" lang="en">Line 4:</span></dt><dd><p xml:lang="en" lang="en">Identifies the device to which the modem is
		  connected, where  <code class="filename">COM1</code> is
		  <code class="filename">/dev/cuau0</code> and
		  <code class="filename">COM2</code> is
		  <code class="filename">/dev/cuau1</code>.</p></dd><dt><span xml:lang="en" class="term" lang="en">Line 5:</span></dt><dd><p xml:lang="en" lang="en">Sets the connection speed.  If
		  <code class="literal">115200</code> does not work on an older
		  modem, try <code class="literal">38400</code> instead.</p></dd><dt><span xml:lang="en" class="term" lang="en">Lines 6 &amp; 7:</span></dt><dd><p xml:lang="en" lang="en">The dial string written as an expect-send
		  syntax.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chat&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chat</span>(8)</span></a> for more
		  information.</p><p xml:lang="en" lang="en">Note that this command continues onto the next
		  line for readability.  Any command in
		  <code class="filename">ppp.conf</code> may do this if the
		  last character on the line is
		  <code class="literal">\</code>.</p></dd><dt><span xml:lang="en" class="term" lang="en">Line 8:</span></dt><dd><p xml:lang="en" lang="en">Sets the idle timeout for the link in
		  seconds.</p></dd><dt><span xml:lang="en" class="term" lang="en">Line 9:</span></dt><dd><p xml:lang="en" lang="en">Instructs the peer to confirm the
		  <acronym class="acronym">DNS</acronym> settings.  If the local
		  network is running its own <acronym class="acronym">DNS</acronym>
		  server, this line should be commented out, by adding
		  a <code class="literal">#</code> at the beginning of the line,
		  or removed.</p></dd><dt><span xml:lang="en" class="term" lang="en">Line 10:</span></dt><dd><p xml:lang="en" lang="en">A blank line for readability.  Blank lines are
		  ignored by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>.</p></dd><dt><span xml:lang="en" class="term" lang="en">Line 11:</span></dt><dd><p xml:lang="en" lang="en">Identifies an entry called
		  <code class="literal">provider</code>.  This could be changed
		  to the name of the <acronym class="acronym">ISP</acronym> so that
		  <code class="option">load
		    <em class="replaceable"><code>ISP</code></em></code> can be
		  used to start the connection.</p></dd><dt><span xml:lang="en" class="term" lang="en">Line 12:</span></dt><dd><p xml:lang="en" lang="en">Use the phone number for the
		  <acronym class="acronym">ISP</acronym>.  Multiple phone numbers may
		  be specified using the colon (<code class="literal">:</code>)
		  or pipe character (<code class="literal">|</code>) as a
		  separator.  To rotate through the numbers, use a
		  colon.  To always attempt to dial the first number
		  first and only use the other numbers if the first
		  number fails, use the pipe character.  Always
		  enclose the entire set of phone numbers between
		  quotation marks (<code class="literal">"</code>) to prevent
		  dialing failures.</p></dd><dt><span xml:lang="en" class="term" lang="en">Lines 13 &amp; 14:</span></dt><dd><p xml:lang="en" lang="en">Use the user name and password for the
		  <acronym class="acronym">ISP</acronym>.</p></dd><dt><span xml:lang="en" class="term" lang="en">Line 15:</span></dt><dd><p xml:lang="en" lang="en">Sets the default idle timeout in seconds for the
		  connection.  In this example, the connection will be
		  closed automatically after 300 seconds of
		  inactivity.  To prevent a timeout, set this value to
		  zero.</p></dd><dt><span xml:lang="en" class="term" lang="en">Line 16:</span></dt><dd><p xml:lang="en" lang="en">Sets the interface addresses.  The values used
		  depend upon whether a static <acronym class="acronym">IP</acronym>
		  address has been obtained from the
		  <acronym class="acronym">ISP</acronym> or if it  instead negotiates
		  a dynamic <acronym class="acronym">IP</acronym> address during
		  connection.</p><p xml:lang="en" lang="en">If the  <acronym class="acronym">ISP</acronym> has allocated a
		  static <acronym class="acronym">IP</acronym> address and default
		  gateway, replace <em class="replaceable"><code>x.x.x.x</code></em>
		  with the static  <acronym class="acronym">IP</acronym> address and
		  replace <em class="replaceable"><code>y.y.y.y</code></em> with the
		  <acronym class="acronym">IP</acronym> address of the default
		  gateway.  If the <acronym class="acronym">ISP</acronym> has only
		  provided a static <acronym class="acronym">IP</acronym> address
		  without a gateway address, replace
		  <em class="replaceable"><code>y.y.y.y</code></em> with <code class="systemitem">10.0.0.2/0</code>.</p><p xml:lang="en" lang="en">If the <acronym class="acronym">IP</acronym> address changes
		  whenever a connection is made, change this line to
		  the following value.  This tells <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> to use
		  the <acronym class="acronym">IP</acronym> Configuration Protocol
		  (<acronym class="acronym">IPCP</acronym>) to negotiate a dynamic
		  <acronym class="acronym">IP</acronym> address:</p><pre xml:lang="en" class="programlisting" lang="en">set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.255 0.0.0.0</pre></dd><dt><span xml:lang="en" class="term" lang="en">Line 17:</span></dt><dd><p xml:lang="en" lang="en">Keep this line as-is as it adds a default route
		  to the gateway.  The <code class="literal">HISADDR</code> will
		  automatically be replaced with the gateway address
		  specified on line 16.  It is important that this
		  line appears after line 16.</p></dd></dl></div><p xml:lang="en" lang="en">Depending upon whether <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> is started
	    manually or automatically, a
	    <code class="filename">/etc/ppp/ppp.linkup</code> may also need to
	    be created which contains the following lines.  This file
	    is required when running <code class="command">ppp</code> in
	    <code class="option">-auto</code> mode.  This file is used after the
	    connection has been established.  At this point, the
	    <acronym class="acronym">IP</acronym> address will have been assigned and
	    it is now be possible to add the routing table entries.
	    When creating this file, make sure that
	    <em class="replaceable"><code>provider</code></em> matches the value
	    demonstrated in line 11 of
	    <code class="filename">ppp.conf</code>.</p><pre xml:lang="en" class="programlisting" lang="en">provider:
      add default HISADDR</pre><p xml:lang="en" lang="en">This file is also needed when the default gateway
	  address is <span class="quote">“<span class="quote">guessed</span>”</span> in a static
	  <acronym class="acronym">IP</acronym> address configuration.  In this case,
	  remove line 17 from <code class="filename">ppp.conf</code> and
	  create <code class="filename">/etc/ppp/ppp.linkup</code> with the
	  above two lines.  More examples for this file can be found
	  in <code class="filename">/usr/share/examples/ppp/</code>.</p><p xml:lang="en" lang="en">By default, <code class="command">ppp</code> must be
	  run as <code class="systemitem">root</code>.
	  To change this default, add the account of the user
	  who should run <code class="command">ppp</code> to the <code class="systemitem">network</code> group in
	  <code class="filename">/etc/group</code>.</p><p xml:lang="en" lang="en">Then, give the user access to one or more entries in
	  <code class="filename">/etc/ppp/ppp.conf</code> with
	  <code class="command">allow</code>.  For example, to give
	  <code class="systemitem">fred</code> and
	  <code class="systemitem">mary</code>
	  permission to only the <code class="literal">provider:</code> entry,
	  add this line to the <code class="literal">provider:</code>
	  section:</p><pre xml:lang="en" class="programlisting" lang="en">allow users <em class="replaceable"><code>fred mary</code></em></pre><p xml:lang="en" lang="en">To give the specified users access to all entries, put
	  that line in the <code class="literal">default</code> section
	  instead.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82200248"></a>27.2.2. 進階設定</h3></div></div></div><a id="idp82200888" class="indexterm"></a><a id="idp82201784" class="indexterm"></a><a id="idp82202680" class="indexterm"></a><p xml:lang="en" lang="en">It is possible to configure PPP to supply DNS and
	    NetBIOS nameserver addresses on demand.</p><p xml:lang="en" lang="en">To enable these extensions with
	    <acronym class="acronym">PPP</acronym> version 1.x, the following lines
	    might be added to the relevant section of
	    <code class="filename">/etc/ppp/ppp.conf</code>.</p><pre xml:lang="en" class="programlisting" lang="en">enable msext
set ns 203.14.100.1 203.14.100.2
set nbns 203.14.100.5</pre><p xml:lang="en" lang="en">And for <acronym class="acronym">PPP</acronym> version 2 and
	    above:</p><pre xml:lang="en" class="programlisting" lang="en">accept dns
set dns 203.14.100.1 203.14.100.2
set nbns 203.14.100.5</pre><p xml:lang="en" lang="en">This will tell the clients the primary and secondary
	    name server addresses, and a NetBIOS nameserver
	    host.</p><p xml:lang="en" lang="en">In version 2 and above, if the <code class="literal">set
	      dns</code> line is omitted,
	    <acronym class="acronym">PPP</acronym> will use the values found in
	    <code class="filename">/etc/resolv.conf</code>.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="userppp-PAPnCHAP"></a>27.2.2.1. PAP 與 CHAP 認證</h4></div></div></div><a id="idp82210872" class="indexterm"></a><a id="idp82211512" class="indexterm"></a><p xml:lang="en" lang="en">Some <acronym class="acronym">ISP</acronym>s set their system up so
	    that the authentication part of the connection is done
	    using either of the PAP or CHAP authentication mechanisms.
	    If this is the case, the <acronym class="acronym">ISP</acronym> will not
	    give a <code class="prompt">login:</code> prompt at connection, but
	    will start talking <acronym class="acronym">PPP</acronym>
	    immediately.</p><p xml:lang="en" lang="en">PAP is less secure than CHAP, but security is not
	    normally an issue here as passwords, although being sent
	    as plain text with PAP, are being transmitted down a
	    serial line only.  There is not much room for crackers
	    to <span class="quote">“<span class="quote">eavesdrop</span>”</span>.</p><p xml:lang="en" lang="en">The following
	    alterations must be made:</p><pre xml:lang="en" class="programlisting" lang="en">13      set authname <em class="replaceable"><code>MyUserName</code></em>
14      set authkey <em class="replaceable"><code>MyPassword</code></em>
15      set login</pre><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en">Line 13:</span></dt><dd><p xml:lang="en" lang="en">This line specifies the PAP/CHAP user name.
		  Insert the correct value for
		  <em class="replaceable"><code>MyUserName</code></em>.</p></dd><dt><span xml:lang="en" class="term" lang="en">Line 14:</span></dt><dd><p xml:lang="en" lang="en">This line specifies the PAP/CHAP
		  password<a id="idp82224824" class="indexterm"></a>.
		  Insert the correct value for
		  <em class="replaceable"><code>MyPassword</code></em>.  You may
		  want to add an additional line, such as:</p><pre xml:lang="en" class="programlisting" lang="en">16      accept PAP</pre><p>或</p><pre xml:lang="en" class="programlisting" lang="en">16      accept CHAP</pre><p xml:lang="en" lang="en">to make it obvious that this is the intention,
		  but PAP and CHAP are both accepted by
		  default.</p></dd><dt><span xml:lang="en" class="term" lang="en">Line 15:</span></dt><dd><p xml:lang="en" lang="en">The <acronym class="acronym">ISP</acronym> will not normally
		  require a login to the server when using PAP or
		  CHAP.  Therefore, disable the <span class="quote">“<span class="quote">set
		    login</span>”</span> string.</p></dd></dl></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="userppp-nat"></a>27.2.2.2. 使用 <acronym class="acronym">PPP</acronym> 網路位址轉譯功能</h4></div></div></div><a id="idp82244408" class="indexterm"></a><p xml:lang="en" lang="en">PPP has ability to use internal NAT without kernel
	  diverting capabilities.  This functionality may be enabled
	  by the following line in
	  <code class="filename">/etc/ppp/ppp.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">nat enable yes</pre><p xml:lang="en" lang="en">Alternatively, NAT may be enabled by command-line
	  option <code class="literal">-nat</code>.  There is also
	  <code class="filename">/etc/rc.conf</code> knob named
	  <code class="literal">ppp_nat</code>, which is enabled by
	  default.</p><p xml:lang="en" lang="en">When using this feature, it may be useful to include
	  the following <code class="filename">/etc/ppp/ppp.conf</code> options
	  to enable incoming connections forwarding:</p><pre xml:lang="en" class="programlisting" lang="en">nat port tcp 10.0.0.2:ftp ftp
nat port tcp 10.0.0.2:http http</pre><p xml:lang="en" lang="en">or do not trust the outside at all</p><pre xml:lang="en" class="programlisting" lang="en">nat deny_incoming yes</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="userppp-final"></a>27.2.3. 最終系統設定</h3></div></div></div><a id="idp82256312" class="indexterm"></a><p xml:lang="en" lang="en">While <code class="command">ppp</code> is now configured,
	  some edits still need to be made to
	  <code class="filename">/etc/rc.conf</code>.</p><p xml:lang="en" lang="en">Working from the top down in this file, make sure the
	  <code class="literal">hostname=</code> line is set:</p><pre xml:lang="en" class="programlisting" lang="en">hostname="foo.example.com"</pre><p xml:lang="en" lang="en">If the <acronym class="acronym">ISP</acronym> has supplied a static
	  <acronym class="acronym">IP</acronym> address and name, use this name as the
	  host name.</p><p xml:lang="en" lang="en">Look for the <code class="literal">network_interfaces</code>
	  variable.  To configure the system to dial the
	  <acronym class="acronym">ISP</acronym> on demand, make sure the
	  <code class="filename">tun0</code> device is added to the list,
	  otherwise remove it.</p><pre xml:lang="en" class="programlisting" lang="en">network_interfaces="lo0 tun0"
ifconfig_tun0=</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The <code class="literal">ifconfig_tun0</code> variable should
	    be empty, and a file called
	    <code class="filename">/etc/start_if.tun0</code> should be created.
	    This file should contain the line:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="programlisting" lang="en">ppp -auto mysystem</pre><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">This script is executed at network configuration time,
	    starting the ppp daemon in automatic mode.  If this
	    machine acts as a gateway, consider including
	    <code class="option">-alias</code>.  Refer to the manual page for
	    further details.</p></div><p xml:lang="en" lang="en">Make sure that the router program is set to
	  <code class="literal">NO</code> with the following line in
	  <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">router_enable="NO"</pre><a id="idp82272696" class="indexterm"></a><p xml:lang="en" lang="en">It is important that the <code class="command">routed</code>
	  daemon is not started, as <code class="command">routed</code> tends
	  to delete the default routing table entries created by
	  <code class="command">ppp</code>.</p><p xml:lang="en" lang="en">It is probably a good idea to ensure that the
	  <code class="literal">sendmail_flags</code> line does not include the
	  <code class="option">-q</code> option, otherwise
	  <code class="command">sendmail</code> will attempt to do a network
	  lookup every now and then, possibly causing your machine
	  to dial out.  You may try:</p><pre xml:lang="en" class="programlisting" lang="en">sendmail_flags="-bd"</pre><a id="idp82277688" class="indexterm"></a><p xml:lang="en" lang="en">The downside is that <code class="command">sendmail</code> is
	  forced to re-examine the mail queue whenever the ppp link.
	  To automate this, include <code class="command">!bg</code> in
	  <code class="filename">ppp.linkup</code>:</p><pre xml:lang="en" class="programlisting" lang="en">1     provider:
2       delete ALL
3       add 0 0 HISADDR
4       !bg sendmail -bd -q30m</pre><a id="idp82280888" class="indexterm"></a><p xml:lang="en" lang="en">An alternative is to set up a
	  <span class="quote">“<span class="quote">dfilter</span>”</span> to block SMTP traffic.  Refer to the
	  sample files for further details.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82282808"></a>27.2.4. 使用 <code class="command">ppp</code></h3></div></div></div><p xml:lang="en" lang="en">All that is left is to reboot the machine.  After
	  rebooting, either type:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ppp</code></strong></pre><p xml:lang="en" lang="en">and then <code class="command">dial provider</code> to start the
	  <acronym class="acronym">PPP</acronym> session, or, to configure
	  <code class="command">ppp</code> to establish sessions automatically
	  when there is outbound traffic and
	  <code class="filename">start_if.tun0</code> does not exist,
	  type:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ppp -auto provider</code></strong></pre><p xml:lang="en" lang="en">It is possible to talk to the <code class="command">ppp</code>
	    program while it is running in the background, but only
	    if a suitable diagnostic port has been set up.  To do
	    this, add the following line to the configuration:</p><pre xml:lang="en" class="programlisting" lang="en">set server /var/run/ppp-tun<em class="replaceable"><code>%d</code></em> DiagnosticPassword 0177</pre><p xml:lang="en" lang="en">This will tell PPP to listen to the specified
	  <span class="trademark">UNIX</span>® domain socket, asking clients for the specified
	  password before allowing access.  The
	  <code class="literal">%d</code> in the name is replaced with the
	  <code class="filename">tun</code> device number that is in
	  use.</p><p xml:lang="en" lang="en">Once a socket has been set up, the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pppctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pppctl</span>(8)</span></a>
	  program may be used in scripts that wish to manipulate
	  the running program.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="userppp-mgetty"></a>27.2.5. 設定撥入服務</h3></div></div></div><a id="idp82318648" class="indexterm"></a><a id="idp82319672" class="indexterm"></a><a id="idp82320568" class="indexterm"></a><p xml:lang="en" lang="en"><a class="xref" href="#dialup" title="26.4. 撥入服務">節 26.4, “撥入服務”</a> provides a good description
	    on enabling dial-up services using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=getty&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">getty</span>(8)</span></a>.</p><p xml:lang="en" lang="en">An alternative to <code class="command">getty</code> is
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/comms/mgetty+sendfax/pkg-descr">comms/mgetty+sendfax</a>
	    port), a smarter version of <code class="command">getty</code>
	    designed with dial-up lines in mind.</p><p xml:lang="en" lang="en">The advantages of using <code class="command">mgetty</code> is
	    that it actively <span class="emphasis"><em>talks</em></span> to modems,
	    meaning if port is turned off in
	    <code class="filename">/etc/ttys</code> then the modem will not
	    answer the phone.</p><p xml:lang="en" lang="en">Later versions of <code class="command">mgetty</code> (from
	    0.99beta onwards) also support the automatic detection of
	    <acronym class="acronym">PPP</acronym> streams, allowing clients
	    scriptless access to the server.</p><p xml:lang="en" lang="en">Refer to <a class="link" href="http://mgetty.greenie.net/doc/mgetty_toc.html" target="_top">http://mgetty.greenie.net/doc/mgetty_toc.html</a>
	    for more information on <code class="command">mgetty</code>.</p><p xml:lang="en" lang="en">By default the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/comms/mgetty+sendfax/pkg-descr">comms/mgetty+sendfax</a>
	    port comes with the <code class="literal">AUTO_PPP</code> option
	    enabled allowing <code class="command">mgetty</code> to detect the
	    LCP phase of <acronym class="acronym">PPP</acronym> connections and
	    automatically spawn off a ppp shell.  However, since the
	    default login/password sequence does not occur it is
	    necessary to authenticate users using either PAP or
	    CHAP.</p><p xml:lang="en" lang="en">This section assumes the user has successfully
	    compiled, and installed the
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/comms/mgetty+sendfax/pkg-descr">comms/mgetty+sendfax</a> port on his
	    system.</p><p xml:lang="en" lang="en">Ensure that
	    <code class="filename">/usr/local/etc/mgetty+sendfax/login.config</code>
	    has the following:</p><pre xml:lang="en" class="programlisting" lang="en">/AutoPPP/ -     - /etc/ppp/ppp-pap-dialup</pre><p xml:lang="en" lang="en">This tells <code class="command">mgetty</code> to run
	    <code class="filename">ppp-pap-dialup</code> for detected
	    <acronym class="acronym">PPP</acronym> connections.</p><p xml:lang="en" lang="en">Create an executable file called
	    <code class="filename">/etc/ppp/ppp-pap-dialup</code> containing
	    the following:</p><pre xml:lang="en" class="programlisting" lang="en">#!/bin/sh
exec /usr/sbin/ppp -direct pap$IDENT</pre><p xml:lang="en" lang="en">For each dial-up line enabled in
	    <code class="filename">/etc/ttys</code>, create a corresponding
	    entry in <code class="filename">/etc/ppp/ppp.conf</code>.  This
	    will happily co-exist with the definitions we created
	    above.</p><pre xml:lang="en" class="programlisting" lang="en">pap:
  enable pap
  set ifaddr 203.14.100.1 203.14.100.20-203.14.100.40
  enable proxy</pre><p xml:lang="en" lang="en">Each user logging in with this method will need to
	    have a username/password in
	    <code class="filename">/etc/ppp/ppp.secret</code>, or
	    alternatively add the following option to authenticate
	    users via PAP from
	    <code class="filename">/etc/passwd</code>.</p><pre xml:lang="en" class="programlisting" lang="en">enable passwdauth</pre><p xml:lang="en" lang="en">To assign some users a static <acronym class="acronym">IP</acronym>
	    number, specify the number as the third argument in
	    <code class="filename">/etc/ppp/ppp.secret</code>.  See
	    <code class="filename">/usr/share/examples/ppp/ppp.secret.sample</code>
	    for examples.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ppp-troubleshoot"></a>27.3. <acronym class="acronym">PPP</acronym> 連線疑難排解</h2></div></div></div><a id="idp82355512" class="indexterm"></a><p xml:lang="en" lang="en">This section covers a few issues which may arise when
      using <acronym class="acronym">PPP</acronym> over a modem connection.  Some
      <acronym class="acronym">ISP</acronym>s present the
      <code class="literal">ssword</code> prompt while others present
      <code class="literal">password</code>.  If the <code class="command">ppp</code>
      script is not written accordingly, the login attempt will
      fail.  The most common way to debug <code class="command">ppp</code>
      connections is by connecting manually as described in this
      section.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82359736"></a>27.3.1. 檢查裝置節點</h3></div></div></div><p xml:lang="en" lang="en">When using a custom kernel, make sure to include the
	following line in the kernel configuration file:</p><pre xml:lang="en" class="programlisting" lang="en">device   uart</pre><p xml:lang="en" lang="en">The <code class="filename">uart</code> device is already
	included in the <code class="literal">GENERIC</code> kernel, so no
	additional steps are necessary in this case.  Just
	check the <code class="command">dmesg</code> output for the modem
	device with:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>dmesg | grep uart</code></strong></pre><p xml:lang="en" lang="en">This should display some pertinent output about the
	<code class="filename">uart</code> devices.  These are the COM
	ports we need.  If the modem acts like a standard serial port,
	it should be listed on <code class="filename">uart1</code>, or
	<code class="filename">COM2</code>.  If so, a kernel rebuild is not
	required.  When matching up, if the modem is on
	<code class="filename">uart1</code>, the modem device would be
	<code class="filename">/dev/cuau1</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82387256"></a>27.3.2. 手動連線</h3></div></div></div><p xml:lang="en" lang="en">Connecting to the Internet by manually controlling
	<code class="command">ppp</code> is quick, easy, and a great way to
	debug a connection or just get information on how the
	<acronym class="acronym">ISP</acronym> treats <code class="command">ppp</code> client
	connections.  Lets start <span class="application">PPP</span> from
	the command line.  Note that in all of our examples we will
	use <span class="emphasis"><em>example</em></span> as the hostname of the
	machine running <span class="application">PPP</span>.  To start
	<code class="command">ppp</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ppp</code></strong></pre><pre xml:lang="en" class="screen" lang="en">ppp ON example&gt; <strong class="userinput"><code>set device /dev/cuau1</code></strong></pre><p xml:lang="en" lang="en">This second command sets the modem device to
	<code class="filename">cuau1</code>.</p><pre xml:lang="en" class="screen" lang="en">ppp ON example&gt; <strong class="userinput"><code>set speed 115200</code></strong></pre><p xml:lang="en" lang="en">This sets the connection speed to
	115,200 <acronym class="acronym">kbps</acronym>.</p><pre xml:lang="en" class="screen" lang="en">ppp ON example&gt; <strong class="userinput"><code>enable dns</code></strong></pre><p xml:lang="en" lang="en">This tells <code class="command">ppp</code> to configure the
	resolver and add the nameserver lines to
	<code class="filename">/etc/resolv.conf</code>.  If
	<code class="command">ppp</code> cannot determine the hostname, it can
	manually be set later.</p><pre xml:lang="en" class="screen" lang="en">ppp ON example&gt; <strong class="userinput"><code>term</code></strong></pre><p xml:lang="en" lang="en">This switches to <span class="quote">“<span class="quote">terminal</span>”</span> mode in order to
	manually control the modem.</p><pre xml:lang="en" class="programlisting" lang="en">deflink: Entering terminal mode on <code class="filename">/dev/cuau1</code>
type '~h' for help</pre><pre xml:lang="en" class="screen" lang="en"><strong class="userinput"><code>at</code></strong>
OK
<strong class="userinput"><code>atdt<em class="replaceable"><code>123456789</code></em></code></strong></pre><p xml:lang="en" lang="en">Use <code class="command">at</code> to initialize the modem, then
	use <code class="command">atdt</code> and the number for the
	<acronym class="acronym">ISP</acronym> to begin the dial in process.</p><pre xml:lang="en" class="screen" lang="en">CONNECT</pre><p xml:lang="en" lang="en">Confirmation of the connection, if we are going to have
	any connection problems, unrelated to hardware, here is where
	we will attempt to resolve them.</p><pre xml:lang="en" class="screen" lang="en">ISP Login:<strong class="userinput"><code>myusername</code></strong></pre><p xml:lang="en" lang="en">At this prompt, return the prompt with the username that
	was provided by the <acronym class="acronym">ISP</acronym>.</p><pre xml:lang="en" class="screen" lang="en">ISP Pass:<strong class="userinput"><code>mypassword</code></strong></pre><p xml:lang="en" lang="en">At this prompt, reply with the password that was provided
	by the <acronym class="acronym">ISP</acronym>.  Just like logging into FreeBSD,
	the password will not echo.</p><pre xml:lang="en" class="screen" lang="en">Shell or PPP:<strong class="userinput"><code>ppp</code></strong></pre><p xml:lang="en" lang="en">Depending on the <acronym class="acronym">ISP</acronym>, this prompt
	might not appear.  If it does, it is asking whether to use a
	shell on the provider or to start
	<code class="command">ppp</code>.  In this example,
	<code class="command">ppp</code> was selected in order to establish an
	Internet connection.</p><pre xml:lang="en" class="screen" lang="en">Ppp ON example&gt;</pre><p xml:lang="en" lang="en">Notice that in this example the first <code class="option">p</code>
	has been capitalized.  This shows that we have successfully
	connected to the <acronym class="acronym">ISP</acronym>.</p><pre xml:lang="en" class="screen" lang="en">PPp ON example&gt;</pre><p xml:lang="en" lang="en">We have successfully authenticated with our
	<acronym class="acronym">ISP</acronym> and are waiting for the assigned
	<acronym class="acronym">IP</acronym> address.</p><pre xml:lang="en" class="screen" lang="en">PPP ON example&gt;</pre><p xml:lang="en" lang="en">We have made an agreement on an <acronym class="acronym">IP</acronym>
	address and successfully completed our connection.</p><pre xml:lang="en" class="screen" lang="en">PPP ON example&gt;<strong class="userinput"><code>add default HISADDR</code></strong></pre><p xml:lang="en" lang="en">Here we add our default route, we need to do this before
	we can talk to the outside world as currently the only
	established connection is with the peer.  If this fails due to
	existing routes, put a bang character
	<code class="literal">!</code> in front of the <code class="option">add</code>.
	Alternatively, set this before making the actual
	connection and it will negotiate a new route
	accordingly.</p><p xml:lang="en" lang="en">If everything went good we should now have an active
	connection to the Internet, which could be thrown into the
	background using <span class="keycap"><strong>CTRL</strong></span>+<span class="keycap"><strong>z</strong></span> If <code class="command">PPP</code>
	returns to <code class="command">ppp</code> then the connection has bee
	lost.  This is good to know because it shows the connection
	status.  Capital P's represent a connection to the
	<acronym class="acronym">ISP</acronym> and lowercase p's show that the
	connection has been lost.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82444856"></a>27.3.3. 除錯</h3></div></div></div><p xml:lang="en" lang="en">If a connection cannot be established, turn hardware
	  flow <acronym class="acronym">CTS/RTS</acronym> to off using <code class="option">set
	    ctsrts off</code>.  This is mainly the case when
	  connected to some <span class="application">PPP</span>-capable
	  terminal servers, where <span class="application">PPP</span> hangs
	  when it tries to write data to the communication link, and
	  waits for a Clear To Send (<acronym class="acronym">CTS</acronym>) signal
	  which may never come.  When using this option, include
	  <code class="option">set accmap</code> as it may be required to defeat
	  hardware dependent on passing certain characters from end to
	  end, most of the time XON/XOFF.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> for
	  more information on this option and how it is used.</p><p xml:lang="en" lang="en">An older modem may need <code class="option">set parity
	    even</code>.  Parity is set at none be default, but is
	  used for error checking with a large increase in traffic,
	  on older modems.</p><p xml:lang="en" lang="en"><span class="application">PPP</span> may not return to the
	  command mode, which is usually a negotiation error where the
	  <acronym class="acronym">ISP</acronym> is waiting for negotiating to begin.
	  At this point, using  <code class="command">~p</code> will force ppp
	  to start sending the configuration information.</p><p xml:lang="en" lang="en">If a login prompt never appears, <acronym class="acronym">PAP</acronym>
	  or <acronym class="acronym">CHAP</acronym> authentication is most likely
	  required.  To use <acronym class="acronym">PAP</acronym> or
	  <acronym class="acronym">CHAP</acronym>, add the following options to
	  <span class="application">PPP</span> before going into terminal
	  mode:</p><pre xml:lang="en" class="screen" lang="en">ppp ON example&gt; <strong class="userinput"><code>set authname <em class="replaceable"><code>myusername</code></em></code></strong></pre><p xml:lang="en" lang="en">Where <em class="replaceable"><code>myusername</code></em> should be
	  replaced with the username that was assigned by the
	  <acronym class="acronym">ISP</acronym>.</p><pre xml:lang="en" class="screen" lang="en">ppp ON example&gt; <strong class="userinput"><code>set authkey <em class="replaceable"><code>mypassword</code></em></code></strong></pre><p xml:lang="en" lang="en">Where <em class="replaceable"><code>mypassword</code></em> should be
	  replaced with the password that was assigned by the
	  <acronym class="acronym">ISP</acronym>.</p><p xml:lang="en" lang="en">If a connection is established, but cannot seem to find
	  any domain name,  try to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a> an
	  <acronym class="acronym">IP</acronym> address.  If there is 100 percent
	  (100%) packet loss, it is likely that a default route was
	  not assigned.  Double check that <code class="option">add default
	    HISADDR</code> was set during the connection.  If a
	  connection can be made to a remote <acronym class="acronym">IP</acronym>
	  address, it is possible that a resolver address has not been
	  added to <code class="filename">/etc/resolv.conf</code>.  This file
	  should look like:</p><pre xml:lang="en" class="programlisting" lang="en">domain <em class="replaceable"><code>example.com</code></em>
nameserver <em class="replaceable"><code>x.x.x.x</code></em>
nameserver <em class="replaceable"><code>y.y.y.y</code></em></pre><p xml:lang="en" lang="en">Where <em class="replaceable"><code>x.x.x.x</code></em> and
	  <em class="replaceable"><code>y.y.y.y</code></em> should be replaced with
	  the <acronym class="acronym">IP</acronym> address of the
	  <acronym class="acronym">ISP</acronym>'s DNS servers.</p><p xml:lang="en" lang="en">To configure <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslog&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslog</span>(3)</span></a> to provide logging for the
	  <span class="application">PPP</span> connection, make sure this
	  line exists in <code class="filename">/etc/syslog.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">!ppp
*.*     /var/log/ppp.log</pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="pppoe"></a>27.4. 在乙太網路使用 <acronym class="acronym">PPP</acronym> (PPPoE)</h2></div></div></div><a id="idp82469304" class="indexterm"></a><p xml:lang="en" lang="en">This section describes how to set up <acronym class="acronym">PPP</acronym>
      over Ethernet (<acronym class="acronym">PPPoE</acronym>).</p><p xml:lang="en" lang="en">Here is an example of a working
      <code class="filename">ppp.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">default:
  set log Phase tun command # you can add more detailed logging if you wish
  set ifaddr 10.0.0.1/0 10.0.0.2/0

name_of_service_provider:
  set device PPPoE:<em class="replaceable"><code>xl1</code></em> # replace xl1 with your Ethernet device
  set authname YOURLOGINNAME
  set authkey YOURPASSWORD
  set dial
  set login
  add default HISADDR</pre><p xml:lang="en" lang="en">As <code class="systemitem">root</code>,
	run:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ppp -ddial name_of_service_provider</code></strong></pre><p xml:lang="en" lang="en">Add the following to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">ppp_enable="YES"
ppp_mode="ddial"
ppp_nat="YES"	# if you want to enable nat for your local network, otherwise NO
ppp_profile="name_of_service_provider"</pre><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82493624"></a>27.4.1. 使用 PPPoE 服務標籤</h3></div></div></div><p xml:lang="en" lang="en">Sometimes it will be necessary to use a service tag to
	establish the connection.  Service tags are used to
	distinguish between different PPPoE servers attached to a
	given network.</p><p xml:lang="en" lang="en">Any required service tag information should be in the
	documentation provided by the <acronym class="acronym">ISP</acronym>.</p><p xml:lang="en" lang="en">As a last resort, one could try installing the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/rr-pppoe/pkg-descr">net/rr-pppoe</a> package or port.  Bear in mind
	however, this may de-program your modem and render it useless,
	so think twice before doing it.  Simply install the program
	shipped with the modem.  Then, access the
	<span class="guimenu">System</span> menu from the program.  The name of
	the profile should be listed there.  It is usually
	<span class="emphasis"><em>ISP</em></span>.</p><p xml:lang="en" lang="en">The profile name (service tag) will be used in the PPPoE
	configuration entry in <code class="filename">ppp.conf</code> as the
	provider part for <code class="command">set device</code>.  Refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> for full details.  It should look like
	this:</p><pre xml:lang="en" class="programlisting" lang="en">set device PPPoE:<em class="replaceable"><code>xl1</code></em>:<em class="replaceable"><code>ISP</code></em></pre><p xml:lang="en" lang="en">Do not forget to change <em class="replaceable"><code>xl1</code></em> to
	the proper device for the Ethernet card.</p><p xml:lang="en" lang="en">Do not forget to change <em class="replaceable"><code>ISP</code></em> to
	the profile.</p><p xml:lang="en" lang="en">For additional information, refer to <a class="link" href="http://renaud.waldura.com/doc/freebsd/pppoe/" target="_top">Cheaper
	  Broadband with FreeBSD on DSL</a> by Renaud Waldura.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ppp-3com"></a>27.4.2. 在 <span class="trademark">3Com</span>® <span class="trademark">HomeConnect</span>® ADSL Modem Dual Link 使用 PPPoE</h3></div></div></div><p xml:lang="en" lang="en">This modem does not follow the PPPoE specification defined
	in <a class="link" href="http://www.faqs.org/rfcs/rfc2516.html" target="_top">RFC
	  2516</a>.</p><p xml:lang="en" lang="en">In order to make FreeBSD capable of communicating with this
	device, a sysctl must be set.  This can be done automatically
	at boot time by updating
	<code class="filename">/etc/sysctl.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">net.graph.nonstandard_pppoe=1</pre><p xml:lang="en" lang="en">or can be done immediately with the command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysctl net.graph.nonstandard_pppoe=1</code></strong></pre><p xml:lang="en" lang="en">Unfortunately, because this is a system-wide setting, it
	is not possible to talk to a normal PPPoE client or server and
	a <span class="trademark">3Com</span>® <span class="trademark">HomeConnect</span>® ADSL Modem at the
	same time.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="pppoa"></a>27.5. 在 ATM 使用 <span class="application">PPP</span> (PPPoA)</h2></div></div></div><a id="idp82528696" class="indexterm"></a><a id="idp82530360" class="indexterm"></a><p xml:lang="en" lang="en">The following describes how to set up PPP over
      <acronym class="acronym">ATM</acronym> (PPPoA).  PPPoA is a popular choice among
      European DSL providers.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82532408"></a>27.5.1. 使用 mpd</h3></div></div></div><p xml:lang="en" lang="en">The <span class="application">mpd</span> application can be used
	to connect to a variety of services, in particular PPTP
	services.  It can be installed using the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/mpd5/pkg-descr">net/mpd5</a> package or port.  Many ADSL modems
	require that a PPTP tunnel is created between the modem and
	computer.</p><p xml:lang="en" lang="en">Once installed, configure <span class="application">mpd</span>
	to suit the provider's settings.  The port places a set of
	sample configuration files which are well documented in
	<code class="filename">/usr/local/etc/mpd/</code>.  A complete guide to
	configure <span class="application">mpd</span> is available in HTML
	format in <code class="filename">/usr/ports/share/doc/mpd/</code>.
	Here is a sample configuration for connecting to an ADSL
	service with <span class="application">mpd</span>.  The
	configuration is spread over two files, first the
	<code class="filename">mpd.conf</code>:</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">This example <code class="filename">mpd.conf</code> only works
	  with <span class="application">mpd</span> 4.x.</p></div><pre xml:lang="en" class="programlisting" lang="en">default:
    load adsl

adsl:
    new -i ng0 adsl adsl
    set bundle authname <em class="replaceable"><code>username</code></em> <a id="co-mpd-ex-user"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
    set bundle password <em class="replaceable"><code>password</code></em> <a id="co-mpd-ex-pass"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
    set bundle disable multilink

    set link no pap acfcomp protocomp
    set link disable chap
    set link accept chap
    set link keep-alive 30 10

    set ipcp no vjcomp
    set ipcp ranges 0.0.0.0/0 0.0.0.0/0

    set iface route default
    set iface disable on-demand
    set iface enable proxy-arp
    set iface idle 0

    open</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-mpd-ex-user"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The username used to authenticate with your
	  <acronym class="acronym">ISP</acronym>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-mpd-ex-pass"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The password used to authenticate with your
	  <acronym class="acronym">ISP</acronym>.</p></td></tr></table></div><p xml:lang="en" lang="en">Information about the link, or links, to establish is found
      in <code class="filename">mpd.links</code>.  An example
      <code class="filename">mpd.links</code> to accompany the above example
      is given beneath:</p><pre xml:lang="en" class="programlisting" lang="en">adsl:
    set link type pptp
    set pptp mode active
    set pptp enable originate outcall
    set pptp self <em class="replaceable"><code>10.0.0.1</code></em> <a id="co-mpd-ex-self"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
    set pptp peer <em class="replaceable"><code>10.0.0.138</code></em> <a id="co-mpd-ex-peer"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-mpd-ex-self"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The <acronym class="acronym">IP</acronym> address of FreeBSD computer
	  running <span class="application">mpd</span>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-mpd-ex-peer"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The <acronym class="acronym">IP</acronym> address of the ADSL modem.
	  The Alcatel <span class="trademark">SpeedTouch</span>™ Home defaults to <code class="systemitem">10.0.0.138</code>.</p></td></tr></table></div><p xml:lang="en" lang="en">It is possible to initialize the connection easily by
      issuing the following command as
      <code class="systemitem">root</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mpd -b <em class="replaceable"><code>adsl</code></em></code></strong></pre><p xml:lang="en" lang="en">To view the status of the connection:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>ng0</code></em></code></strong>
ng0: flags=88d1&lt;UP,POINTOPOINT,RUNNING,NOARP,SIMPLEX,MULTICAST&gt; mtu 1500
     inet 216.136.204.117 --&gt; 204.152.186.171 netmask 0xffffffff</pre><p xml:lang="en" lang="en">Using <span class="application">mpd</span> is the recommended
      way to connect to an ADSL service with FreeBSD.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82577720"></a>27.5.2. 使用 pptpclient</h3></div></div></div><p xml:lang="en" lang="en">It is also possible to use FreeBSD to connect to other
      PPPoA services using <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/pptpclient/pkg-descr">net/pptpclient</a>.</p><p xml:lang="en" lang="en">To use <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/pptpclient/pkg-descr">net/pptpclient</a>
      to connect to a DSL service, install the port or package, then
      edit <code class="filename">/etc/ppp/ppp.conf</code>.  An example section
      of <code class="filename">ppp.conf</code> is given below.  For further
      information on <code class="filename">ppp.conf</code> options consult
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>.</p><pre xml:lang="en" class="programlisting" lang="en">adsl:
 set log phase chat lcp ipcp ccp tun command
 set timeout 0
 enable dns
 set authname <em class="replaceable"><code>username</code></em> <a id="co-pptp-ex-user"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
 set authkey <em class="replaceable"><code>password</code></em> <a id="co-pptp-ex-pass"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
 set ifaddr 0 0
 add default HISADDR</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-pptp-ex-user"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The username for the DSL provider.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-pptp-ex-pass"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The password for your account.</p></td></tr></table></div><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Since the account's password is added to
	<code class="filename">ppp.conf</code>in plain text form, make sure
	nobody can read the contents of this file:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>chown root:wheel /etc/ppp/ppp.conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chmod 600 /etc/ppp/ppp.conf</code></strong></pre></div><p xml:lang="en" lang="en">This will open a tunnel for a <acronym class="acronym">PPP</acronym>
	session to the DSL router.  Ethernet DSL modems have a
	preconfigured LAN <acronym class="acronym">IP</acronym> address to connect to.
	In the case of the Alcatel <span class="trademark">SpeedTouch</span>™ Home, this address is
	<code class="systemitem">10.0.0.138</code>.  The
	router's documentation should list the address the device
	uses.  To open the tunnel and start a <acronym class="acronym">PPP</acronym>
	session:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pptp <em class="replaceable"><code>address</code></em> <em class="replaceable"><code>adsl</code></em></code></strong></pre><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">If an ampersand (<span class="quote">“<span class="quote">&amp;</span>”</span>) is added
	  to the end of this command,
	  <span class="application">pptp</span> will return the
	  prompt.</p></div><p xml:lang="en" lang="en">A <code class="filename">tun</code> virtual tunnel device
	will be created for interaction between the
	<span class="application">pptp</span> and
	<span class="application">ppp</span> processes.  Once the
	prompt is returned, or the
	<span class="application">pptp</span> process has confirmed a
	connection, examine the tunnel:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>tun0</code></em></code></strong>
tun0: flags=8051&lt;UP,POINTOPOINT,RUNNING,MULTICAST&gt; mtu 1500
        inet 216.136.204.21 --&gt; 204.152.186.171 netmask 0xffffff00
	Opened by PID 918</pre><p xml:lang="en" lang="en">If the connection fails, check the configuration of
	the router, which is usually accessible using
	a web browser.  Also, examine the output of
	<code class="command">pptp</code> and the contents of the
	log file,
	<code class="filename">/var/log/ppp.log</code> for clues.</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mail"></a>章 28. 電子郵件</h2></div><div><span class="authorgroup">Original
	work by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Bill</span> <span class="surname">Lloyd</span></span>. </span></div><div><span class="authorgroup">Rewritten
	by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Jim</span> <span class="surname">Mock</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#mail-synopsis">28.1. 概述</a></span></dt><dt><span class="sect1"><a href="#mail-using">28.2. 郵件組成</a></span></dt><dt><span class="sect1"><a href="#sendmail">28.3. <span class="application">Sendmail</span> 設定檔</a></span></dt><dt><span class="sect1"><a href="#mail-changingmta">28.4. 更改郵件傳輸代理程式</a></span></dt><dd><dl><dt><span class="sect2"><a href="#mail-disable-sendmail">28.4.1. 關閉 <span class="application">Sendmail</span></a></span></dt><dt><span class="sect2"><a href="#idp82840376">28.4.2. 替換預設的 <acronym class="acronym">MTA</acronym></a></span></dt></dl></dd><dt><span class="sect1"><a href="#mail-trouble">28.5. 疑難排解</a></span></dt><dt><span class="sect1"><a href="#mail-advanced">28.6. 進階主題</a></span></dt><dd><dl><dt><span class="sect2"><a href="#mail-config">28.6.1. 基礎設定</a></span></dt><dt><span class="sect2"><a href="#mail-domain">28.6.2. 網域中的郵件</a></span></dt></dl></dd><dt><span class="sect1"><a href="#outgoing-only">28.7. 寄件設定</a></span></dt><dt><span class="sect1"><a href="#SMTP-dialup">28.8. 在撥號連線使用郵件</a></span></dt><dt><span class="sect1"><a href="#SMTP-Auth">28.9. SMTP 認證</a></span></dt><dt><span class="sect1"><a href="#mail-agents">28.10. 郵件使用者代理程式</a></span></dt><dd><dl><dt><span class="sect2"><a href="#mail-command">28.10.1. <code class="command">mail</code></a></span></dt><dt><span class="sect2"><a href="#mutt-command">28.10.2. <span class="application">mutt</span></a></span></dt><dt><span class="sect2"><a href="#alpine-command">28.10.3. <span class="application">alpine</span></a></span></dt></dl></dd><dt><span class="sect1"><a href="#mail-fetchmail">28.11. 使用 <span class="application">fetchmail</span></a></span></dt><dt><span class="sect1"><a href="#mail-procmail">28.12. 使用 <span class="application">procmail</span></a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mail-synopsis"></a>28.1. 概述</h2></div></div></div><a id="idp82610360" class="indexterm"></a><p><span class="quote">“<span class="quote">電子郵件</span>”</span> 或稱 email，是現今使用最廣泛的溝通方式之一。本章主要介紹如何在 FreeBSD 上執行郵件伺服器，以及如何使用 FreeBSD 收發信件，若欲瞭解細節請參閱 <a class="xref" href="#bibliography" title="附錄 B. 參考書目">附錄 B, <em>參考書目</em></a> 內的參考書籍。</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>哪些軟體元件與收發電子郵件有關。</p></li><li class="listitem"><p>FreeBSD 內的 <span class="application">Sendmail</span> 設定檔在哪。</p></li><li class="listitem"><p>遠端信箱 (Mailbox) 與本機信箱的差異。</p></li><li class="listitem"><p>如何阻擋垃圾郵件寄件者 (Spammer) 非法使用郵件伺服器作為中繼站。</p></li><li class="listitem"><p>如何安裝與設定其他的郵件傳輸代理程式 (Mail Transfer Agent) 來取代 <span class="application">Sendmail</span>。</p></li><li class="listitem"><p>如何排除常見的郵件伺服器問題。</p></li><li class="listitem"><p>如何設定系統只能寄送郵件。</p></li><li class="listitem"><p>如何在撥號連線上使用郵件。</p></li><li class="listitem"><p>如何設定 SMTP 認証來增加安全性。</p></li><li class="listitem"><p>如何安裝並使用郵件使用者代理程式 (Mail User Agent) 如 <span class="application">mutt</span> 來寄發與接收電子郵件。</p></li><li class="listitem"><p>如何從遠端的 <acronym class="acronym">POP</acronym> 或 <acronym class="acronym">IMAP</acronym> 伺服器下載郵件。</p></li><li class="listitem"><p>如何自動套用過濾器及規則在收到的電子郵件上。</p></li></ul></div><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>正確的設定網路連線 (<a class="xref" href="#advanced-networking" title="章 31. 進階網路設定">章 31, <em>進階網路設定</em></a>)。</p></li><li class="listitem"><p>正確的設定郵件主機的 <acronym class="acronym">DNS</acronym> 資訊 (<a class="xref" href="#network-servers" title="章 29. 網路伺服器">章 29, <em>網路伺服器</em></a>)。</p></li><li class="listitem"><p>了解如何安裝其他第三方軟體 (<a class="xref" href="#ports" title="章 4. 安裝應用程式：套件與 Port">章 4, <em>安裝應用程式：套件與 Port</em></a>)。</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mail-using"></a>28.2. 郵件組成</h2></div></div></div><a id="idp82633528" class="indexterm"></a><a id="idp82634168" class="indexterm"></a><a id="idp82647096" class="indexterm"></a><a id="idp82647736" class="indexterm"></a><a id="idp82649144" class="indexterm"></a><a id="idp82650552" class="indexterm"></a><a id="idp82651960" class="indexterm"></a><a id="idp82653368" class="indexterm"></a><a id="idp82654648" class="indexterm"></a><a id="idp82659384" class="indexterm"></a><p xml:lang="en" lang="en">There are five major parts involved in an email exchange:
      the Mail User Agent (<acronym class="acronym">MUA</acronym>), the Mail Transfer
      Agent (<acronym class="acronym">MTA</acronym>), a mail host, a remote or local
      mailbox, and <acronym class="acronym">DNS</acronym>.  This section provides an
      overview of these components.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">郵件使用者代理程式 (Mail User Agent, <acronym class="acronym">MUA</acronym>)</span></dt><dd><p xml:lang="en" lang="en">The Mail User Agent (<acronym class="acronym">MUA</acronym>) is an
	    application which is used to compose, send, and receive
	    emails.  This application can be a command line program,
	    such as the built-in <code class="command">mail</code> utility or a
	    third-party application from the Ports Collection, such as
	    <span class="application">mutt</span>,
	    <span class="application">alpine</span>, or
	    <span class="application">elm</span>.  Dozens of graphical
	    programs are also available in the Ports Collection,
	    including <span class="application">Claws Mail</span>,
	    <span class="application">Evolution</span>, and
	    <span class="application">Thunderbird</span>.  Some
	    organizations provide a web mail program which can be
	    accessed through a web browser.  More information about
	    installing and using a <acronym class="acronym">MUA</acronym> on FreeBSD can
	    be found in <a class="xref" href="#mail-agents" title="28.10. 郵件使用者代理程式">節 28.10, “郵件使用者代理程式”</a>.</p></dd><dt><span class="term">郵件傳輸代理程式 (Mail Transfer Agent, <acronym class="acronym">MTA</acronym>)</span></dt><dd><p xml:lang="en" lang="en">The Mail Transfer Agent (<acronym class="acronym">MTA</acronym>) is
	    responsible for receiving incoming mail and delivering
	    outgoing mail.  FreeBSD ships with
	    <span class="application">Sendmail</span> as the default
	    <acronym class="acronym">MTA</acronym>, but it also supports numerous
	    other mail server daemons, including
	    <span class="application">Exim</span>,
	    <span class="application">Postfix</span>, and
	    <span class="application">qmail</span>.
	    <span class="application">Sendmail</span> configuration is
	    described in <a class="xref" href="#sendmail" title="28.3. Sendmail 設定檔">節 28.3, “<span class="application">Sendmail</span> 設定檔”</a>.  If another
	    <acronym class="acronym">MTA</acronym> is installed using the Ports
	    Collection, refer to its post-installation message for
	    FreeBSD-specific configuration details and the application's
	    website for more general configuration
	    instructions.</p></dd><dt><span class="term">郵件主機 (Mail Host) 與郵件信箱 (Mailbox)</span></dt><dd><p xml:lang="en" lang="en">The mail host is a server that is responsible for
	    delivering and receiving mail for a host or a network.
	    The mail host collects all mail sent to the domain and
	    stores it either in the default <code class="filename">mbox</code>
	    or the alternative Maildir format, depending on the
	    configuration.  Once mail has been stored, it may either
	    be read locally using a <acronym class="acronym">MUA</acronym> or remotely
	    accessed and collected using protocols such as
	    <acronym class="acronym">POP</acronym> or <acronym class="acronym">IMAP</acronym>.  If
	    mail is read locally, a <acronym class="acronym">POP</acronym> or
	    <acronym class="acronym">IMAP</acronym> server does not need to be
	    installed.</p><p xml:lang="en" lang="en">To access mailboxes remotely, a <acronym class="acronym">POP</acronym>
	    or <acronym class="acronym">IMAP</acronym> server is required as these
	    protocols allow users to connect to their mailboxes from
	    remote locations.  <acronym class="acronym">IMAP</acronym> offers several
	    advantages over <acronym class="acronym">POP</acronym>.  These include the
	    ability to store a copy of messages on a remote server
	    after they are downloaded and concurrent updates.
	    <acronym class="acronym">IMAP</acronym> can be useful over low-speed links
	    as it allows users to fetch the structure of messages
	    without downloading them.  It can also perform tasks such
	    as searching on the server in order to minimize data
	    transfer between clients and servers.</p><p xml:lang="en" lang="en">Several <acronym class="acronym">POP</acronym> and
	    <acronym class="acronym">IMAP</acronym> servers are available in the Ports
	    Collection.  These include
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/qpopper/pkg-descr">mail/qpopper</a>,
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/imap-uw/pkg-descr">mail/imap-uw</a>,
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/courier-imap/pkg-descr">mail/courier-imap</a>, and
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/dovecot2/pkg-descr">mail/dovecot2</a>.</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">It should be noted that both <acronym class="acronym">POP</acronym>
	      and <acronym class="acronym">IMAP</acronym> transmit information,
	      including username and password credentials, in
	      clear-text.  To secure the transmission of information
	      across these protocols, consider tunneling sessions over
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> (<a class="xref" href="#security-ssh-tunneling" title="13.8.1.2. SSH 通道">節 13.8.1.2, “<acronym class="acronym">SSH</acronym> 通道”</a>)
	      or using <acronym class="acronym">SSL</acronym> (<a class="xref" href="#openssl" title="13.6. OpenSSL">節 13.6, “OpenSSL”</a>).</p></div></dd><dt><span class="term">網域名稱系統 (<acronym class="acronym">DNS</acronym>)</span></dt><dd><p xml:lang="en" lang="en">The Domain Name System (<acronym class="acronym">DNS</acronym>) and
	    its daemon <code class="command">named</code> play a large role in
	    the delivery of email.  In order to deliver mail from one
	    site to another, the <acronym class="acronym">MTA</acronym> will look up
	    the remote site in <acronym class="acronym">DNS</acronym> to determine
	    which host will receive mail for the destination.  This
	    process also occurs when mail is sent from a remote host
	    to the <acronym class="acronym">MTA</acronym>.</p><p xml:lang="en" lang="en">In addition to mapping hostnames to
	    <acronym class="acronym">IP</acronym> addresses, <acronym class="acronym">DNS</acronym> is
	    responsible for storing information specific to mail
	    delivery, known as Mail eXchanger
	    <acronym class="acronym">MX</acronym> records.  The <acronym class="acronym">MX</acronym>
	    record specifies which hosts will receive mail for a
	    particular domain.</p><p xml:lang="en" lang="en">To view the <acronym class="acronym">MX</acronym> records for a
	    domain, specify the type of record.   Refer to
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=host&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">host</span>(1)</span></a>, for more details about this command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>host -t mx FreeBSD.org</code></strong>
FreeBSD.org mail is handled by 10 mx1.FreeBSD.org</pre><p xml:lang="en" lang="en">Refer to <a class="xref" href="#network-dns" title="29.7. 網域名稱系統 (DNS)">節 29.7, “網域名稱系統 (<acronym class="acronym">DNS</acronym>)”</a> for more
	    information about <acronym class="acronym">DNS</acronym> and its
	    configuration.</p></dd></dl></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="sendmail"></a>28.3. <span class="application">Sendmail</span> 設定檔</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Christopher</span> <span class="surname">Shumway</span></span>. </span></div></div></div><a id="idp82700472" class="indexterm"></a><p xml:lang="en" lang="en"><span class="application">Sendmail</span> is the default
      <acronym class="acronym">MTA</acronym> installed with FreeBSD.  It accepts mail
      from <acronym class="acronym">MUA</acronym>s and delivers it to the appropriate
      mail host, as defined by its configuration.
      <span class="application">Sendmail</span> can also accept network
      connections and deliver mail to local mailboxes or to another
      program.</p><p xml:lang="en" lang="en">The configuration files for
      <span class="application">Sendmail</span> are located in
      <code class="filename">/etc/mail</code>.  This section describes these
      files in more detail.</p><a id="idp82704696" class="indexterm"></a><a id="idp82705720" class="indexterm"></a><a id="idp82706744" class="indexterm"></a><a id="idp82707768" class="indexterm"></a><a id="idp82708792" class="indexterm"></a><a id="idp82709816" class="indexterm"></a><a id="idp82710840" class="indexterm"></a><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en"><code class="filename">/etc/mail/access</code></span></dt><dd><p xml:lang="en" lang="en">This access database file defines which hosts or
	    <acronym class="acronym">IP</acronym> addresses have access to the local
	    mail server and what kind of access they have.  Hosts
	    listed as <code class="option">OK</code>, which is the default
	    option, are allowed to send mail to this host as long as
	    the mail's final destination is the local machine.  Hosts
	    listed as <code class="option">REJECT</code> are rejected for all
	    mail connections.  Hosts listed as <code class="option">RELAY</code>
	    are allowed to send mail for any destination using this
	    mail server.  Hosts listed as <code class="option">ERROR</code> will
	    have their mail returned with the specified mail error.
	    If a host is listed as <code class="option">SKIP</code>,
	    <span class="application">Sendmail</span> will abort the current
	    search for this entry without accepting or rejecting the
	    mail.  Hosts listed as <code class="option">QUARANTINE</code> will
	    have their messages held and will receive the specified
	    text as the reason for the hold.</p><p xml:lang="en" lang="en">Examples of using these options for both
	    <acronym class="acronym">IPv4</acronym> and <acronym class="acronym">IPv6</acronym>
	    addresses can be found in the FreeBSD sample configuration,
	    <code class="filename">/etc/mail/access.sample</code>:</p><pre xml:lang="en" class="programlisting" lang="en"># <span class="phrase">$FreeBSD$</span>
#
# Mail relay access control list.  Default is to reject mail unless the
# destination is local, or listed in /etc/mail/local-host-names
#
## Examples (commented out for safety)
#From:cyberspammer.com          ERROR:"550 We don't accept mail from spammers"
#From:okay.cyberspammer.com     OK
#Connect:sendmail.org           RELAY
#To:sendmail.org                RELAY
#Connect:128.32                 RELAY
#Connect:128.32.2               SKIP
#Connect:IPv6:1:2:3:4:5:6:7     RELAY
#Connect:suspicious.example.com QUARANTINE:Mail from suspicious host
#Connect:[127.0.0.3]            OK
#Connect:[IPv6:1:2:3:4:5:6:7:8] OK</pre><p xml:lang="en" lang="en">To configure the access database, use the format shown
	    in the sample to make entries in
	    <code class="filename">/etc/mail/access</code>, but do not put a
	    comment symbol (<code class="literal">#</code>) in front of the
	    entries.  Create an entry for each host or network whose
	    access should be configured.  Mail senders that match the
	    left side of the table are affected by the action on the
	    right side of the table.</p><p xml:lang="en" lang="en">Whenever this file is updated, update its database and
	    restart <span class="application">Sendmail</span>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>makemap hash /etc/mail/access &lt; /etc/mail/access</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service sendmail restart</code></strong></pre></dd><dt><span xml:lang="en" class="term" lang="en"><code class="filename">/etc/mail/aliases</code></span></dt><dd><p xml:lang="en" lang="en">This database file contains a list of virtual
	    mailboxes that are expanded to users, files, programs, or
	    other aliases.  Here are a few entries to illustrate the
	    file format:</p><pre xml:lang="en" class="programlisting" lang="en">root: localuser
ftp-bugs: joe,eric,paul
bit.bucket:  /dev/null
procmail: "|/usr/local/bin/procmail"</pre><p xml:lang="en" lang="en">The mailbox name on the left side of the colon is
	    expanded to the target(s) on the right.  The first entry
	    expands the <code class="systemitem">root</code>
	    mailbox  to the <code class="systemitem">localuser</code> mailbox, which
	    is then looked up in the
	    <code class="filename">/etc/mail/aliases</code> database.  If no
	    match is found, the message is delivered to <code class="systemitem">localuser</code>.  The second
	    entry shows a mail list.  Mail to <code class="systemitem">ftp-bugs</code> is expanded to
	    the three local mailboxes <code class="systemitem">joe</code>, <code class="systemitem">eric</code>, and <code class="systemitem">paul</code>.  A remote mailbox
	    could be specified as
	    <em class="replaceable"><code>user@example.com</code></em>.  The third
	    entry shows how to write mail to a file, in this case
	    <code class="filename">/dev/null</code>.  The last entry
	    demonstrates how to send mail to a program,
	    <code class="filename">/usr/local/bin/procmail</code>, through a
	    <span class="trademark">UNIX</span>® pipe.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=aliases&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">aliases</span>(5)</span></a> for more
	    information about the format of this file.</p><p xml:lang="en" lang="en">Whenever this file is updated, run
	    <code class="command">newaliases</code> to update and initialize the
	    aliases database.</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="filename">/etc/mail/sendmail.cf</code></span></dt><dd><p xml:lang="en" lang="en">This is the master configuration file for
	    <span class="application">Sendmail</span>.  It controls the
	    overall behavior of <span class="application">Sendmail</span>,
	    including everything from rewriting email addresses to
	    printing rejection messages to remote mail servers.
	    Accordingly, this configuration file is quite complex.
	    Fortunately, this file rarely needs to be changed for
	    standard mail servers.</p><p xml:lang="en" lang="en">The master <span class="application">Sendmail</span>
	    configuration file can be built from <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=m4&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">m4</span>(1)</span></a> macros
	    that define the features and behavior of
	    <span class="application">Sendmail</span>.  Refer to
	    <code class="filename">/usr/src/contrib/sendmail/cf/README</code>
	    for some of the details.</p><p xml:lang="en" lang="en">Whenever changes to this file are made,
	    <span class="application">Sendmail</span> needs to be restarted
	    for the changes to take effect.</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="filename">/etc/mail/virtusertable</code></span></dt><dd><p xml:lang="en" lang="en">This database file maps mail addresses for virtual
	    domains and users to real mailboxes.  These mailboxes can
	    be local, remote, aliases defined in
	    <code class="filename">/etc/mail/aliases</code>, or files.  This
	    allows multiple virtual domains to be hosted on one
	    machine.</p><p xml:lang="en" lang="en">FreeBSD provides a sample configuration file in
	    <code class="filename">/etc/mail/virtusertable.sample</code> to
	    further demonstrate its format.  The following example
	    demonstrates how to create custom entries using that
	    format:</p><pre xml:lang="en" class="programlisting" lang="en">root@example.com                root
postmaster@example.com          postmaster@noc.example.net
@example.com                    joe</pre><p xml:lang="en" lang="en">This file is processed in a first match order.   When
	    an email address matches the address on the left, it is
	    mapped to the local mailbox listed on the right.  The
	    format of the first entry in this example maps a specific
	    email address to a local mailbox, whereas the format of
	    the second entry maps a specific email address to a remote
	    mailbox.  Finally, any email address from
	    <code class="literal">example.com</code> which has not matched any
	    of the previous entries will match the last mapping and be
	    sent to the local mailbox <code class="literal">joe</code>.  When
	    creating custom entries, use this format and add them to
	    <code class="filename">/etc/mail/virtusertable</code>.  Whenever
	    this file is edited, update its database and restart
	    <span class="application">Sendmail</span>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>makemap hash /etc/mail/virtusertable &lt; /etc/mail/virtusertable</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service sendmail restart</code></strong></pre></dd><dt><span xml:lang="en" class="term" lang="en"><code class="filename">/etc/mail/relay-domains</code></span></dt><dd><p xml:lang="en" lang="en">In a default FreeBSD installation,
	    <span class="application">Sendmail</span> is configured to only
	    send mail from the host it is running on.  For example, if
	    a <acronym class="acronym">POP</acronym> server is available, users will
	    be able to check mail from remote locations but they will
	    not be able to send outgoing emails from outside
	    locations.  Typically, a few moments after the attempt, an
	    email will be sent from <code class="literal">MAILER-DAEMON</code>
	    with a <span class="errorname">5.7 Relaying Denied</span>
	    message.</p><p xml:lang="en" lang="en">The most straightforward solution is to add the
	    <acronym class="acronym">ISP</acronym>'s <acronym class="acronym">FQDN</acronym> to
	    <code class="filename">/etc/mail/relay-domains</code>.  If multiple
	    addresses are needed, add them one per
	    line:</p><pre xml:lang="en" class="programlisting" lang="en">your.isp.example.com
other.isp.example.net
users-isp.example.org
www.example.org</pre><p xml:lang="en" lang="en">After creating or editing this file, restart
	    <span class="application">Sendmail</span> with
	    <code class="command">service sendmail restart</code>.</p><p xml:lang="en" lang="en">Now any mail sent through the system by any host in
	    this list, provided the user has an account on the system,
	    will succeed.  This allows users to send mail from the
	    system remotely without opening the system up to relaying
	    <acronym class="acronym">SPAM</acronym> from the Internet.</p></dd></dl></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mail-changingmta"></a>28.4. 更改郵件傳輸代理程式</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Andrew</span> <span class="surname">Boothman</span></span>. </span></div><div><span class="authorgroup">Information taken from emails written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Gregory</span> <span class="surname">Neil Shapiro</span></span>. </span></div></div></div><a id="idp82823608" class="indexterm"></a><p xml:lang="en" lang="en">FreeBSD comes with <span class="application">Sendmail</span> already
      installed as the <acronym class="acronym">MTA</acronym> which is in charge of
      outgoing and incoming mail.  However, the system administrator
      can change the system's <acronym class="acronym">MTA</acronym>.  A wide choice
      of alternative <acronym class="acronym">MTA</acronym>s is available from the
      <code class="literal">mail</code> category of the FreeBSD Ports
      Collection.</p><p xml:lang="en" lang="en">Once a new <acronym class="acronym">MTA</acronym> is installed, configure
      and test the new software before replacing
      <span class="application">Sendmail</span>.  Refer to the documentation
      of the new <acronym class="acronym">MTA</acronym> for information on how to
      configure the software.</p><p xml:lang="en" lang="en">Once the new <acronym class="acronym">MTA</acronym> is working, use the
      instructions in this section to disable
      <span class="application">Sendmail</span> and configure FreeBSD to use
      the replacement <acronym class="acronym">MTA</acronym>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mail-disable-sendmail"></a>28.4.1. 關閉 <span class="application">Sendmail</span></h3></div></div></div><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">If <span class="application">Sendmail</span>'s outgoing mail
	  service is disabled, it is important that it is replaced
	  with an alternative mail delivery system.  Otherwise, system
	  functions such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">periodic</span>(8)</span></a> will be unable to deliver
	  their results by email.  Many parts of the system expect a
	  functional <acronym class="acronym">MTA</acronym>.  If applications continue
	  to use <span class="application">Sendmail</span>'s binaries to try
	  to send email after they are disabled, mail could go into an
	  inactive <span class="application">Sendmail</span> queue and
	  never be delivered.</p></div><p xml:lang="en" lang="en">In order to completely disable
	<span class="application">Sendmail</span>, add or edit the following
	lines in <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">sendmail_enable="NO"
sendmail_submit_enable="NO"
sendmail_outbound_enable="NO"
sendmail_msp_queue_enable="NO"</pre><p xml:lang="en" lang="en">To only disable <span class="application">Sendmail</span>'s
	incoming mail service, use only this entry in
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">sendmail_enable="NO"</pre><p xml:lang="en" lang="en">More information on <span class="application">Sendmail</span>'s
	startup options is available in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.sendmail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.sendmail</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82840376"></a>28.4.2. 替換預設的 <acronym class="acronym">MTA</acronym></h3></div></div></div><p xml:lang="en" lang="en">When a new <acronym class="acronym">MTA</acronym> is installed using the
	Ports Collection, its startup script is also installed and
	startup instructions are mentioned in its package message.
	Before starting the new <acronym class="acronym">MTA</acronym>, stop the
	running <span class="application">Sendmail</span> processes.  This
	example stops all of these services, then starts the
	<span class="application">Postfix</span> service:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service sendmail stop</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service postfix start</code></strong></pre><p xml:lang="en" lang="en">To start the replacement <acronym class="acronym">MTA</acronym> at system
	boot, add its configuration line to
	<code class="filename">/etc/rc.conf</code>.  This entry enables the
	Postfix <acronym class="acronym">MTA</acronym>:</p><pre xml:lang="en" class="programlisting" lang="en">postfix_enable="YES"</pre><p xml:lang="en" lang="en">Some extra configuration is needed as
	<span class="application">Sendmail</span> is so ubiquitous that some
	software assumes it is already installed and configured.
	Check <code class="filename">/etc/periodic.conf</code> and make sure
	that these values are set to <code class="literal">NO</code>.  If this
	file does not exist, create it with these entries:</p><pre xml:lang="en" class="programlisting" lang="en">daily_clean_hoststat_enable="NO"
daily_status_mail_rejects_enable="NO"
daily_status_include_submit_mailq="NO"
daily_submit_queuerun="NO"</pre><p xml:lang="en" lang="en">Some alternative <acronym class="acronym">MTA</acronym>s provide their own
	compatible implementations of the
	<span class="application">Sendmail</span> command-line interface in
	order to facilitate using them as drop-in replacements for
	<span class="application">Sendmail</span>.  However, some
	<acronym class="acronym">MUA</acronym>s may try to execute standard
	<span class="application">Sendmail</span> binaries instead of the
	new <acronym class="acronym">MTA</acronym>'s binaries.  FreeBSD uses
	<code class="filename">/etc/mail/mailer.conf</code> to map the expected
	<span class="application">Sendmail</span> binaries to the location
	of the new binaries.  More information about this mapping can
	be found in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mailwrapper&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mailwrapper</span>(8)</span></a>.</p><p xml:lang="en" lang="en">The default <code class="filename">/etc/mail/mailer.conf</code>
	looks like this:</p><pre xml:lang="en" class="programlisting" lang="en"># <span class="phrase">$FreeBSD$</span>
#
# Execute the "real" sendmail program, named /usr/libexec/sendmail/sendmail
#
sendmail        /usr/libexec/sendmail/sendmail
send-mail       /usr/libexec/sendmail/sendmail
mailq           /usr/libexec/sendmail/sendmail
newaliases      /usr/libexec/sendmail/sendmail
hoststat        /usr/libexec/sendmail/sendmail
purgestat       /usr/libexec/sendmail/sendmail</pre><p xml:lang="en" lang="en">When any of the commands listed on the left are run, the
	system actually executes the associated command shown on the
	right.  This system makes it easy to change what binaries are
	executed when these default binaries are invoked.</p><p xml:lang="en" lang="en">Some <acronym class="acronym">MTA</acronym>s, when installed using the
	Ports Collection, will prompt to update this file for the new
	binaries.  For example, <span class="application">Postfix</span>
	will update the file like this:</p><pre xml:lang="en" class="programlisting" lang="en">#
# Execute the Postfix sendmail program, named /usr/local/sbin/sendmail
#
sendmail        /usr/local/sbin/sendmail
send-mail       /usr/local/sbin/sendmail
mailq           /usr/local/sbin/sendmail
newaliases      /usr/local/sbin/sendmail</pre><p xml:lang="en" lang="en">If the installation of the <acronym class="acronym">MTA</acronym> does
	not automatically update
	<code class="filename">/etc/mail/mailer.conf</code>, edit this file in
	a text editor so that it points to the new binaries.  This
	example points to the binaries installed by
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/ssmtp/pkg-descr">mail/ssmtp</a>:</p><pre xml:lang="en" class="programlisting" lang="en">sendmail        /usr/local/sbin/ssmtp
send-mail       /usr/local/sbin/ssmtp
mailq           /usr/local/sbin/ssmtp
newaliases      /usr/local/sbin/ssmtp
hoststat        /usr/bin/true
purgestat       /usr/bin/true</pre><p xml:lang="en" lang="en">Once everything is configured, it is recommended to reboot
	the system.  Rebooting provides the opportunity to ensure that
	the system is correctly configured to start the new
	<acronym class="acronym">MTA</acronym> automatically on boot.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mail-trouble"></a>28.5. 疑難排解</h2></div></div></div><a id="idp82895160" class="indexterm"></a><div class="qandaset"><a id="idp82896440"></a><dl><dt>28.5.1. <a href="#idp82900792">Why do I have to use the FQDN for hosts on my
	    site?</a></dt><dt>28.5.2. <a href="#idp82913336">How can I run a mail server on a dial-up PPP
	    host?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%" /><col /></colgroup><tbody><tr class="question"><td align="left" valign="top"><a id="idp82900792"></a><a id="idp82901048"></a><p><strong>28.5.1.</strong></p></td><td align="left" valign="top"><p xml:lang="en" lang="en">Why do I have to use the FQDN for hosts on my
	    site?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p xml:lang="en" lang="en">The host may actually be in a different domain.  For
	    example, in order for a host in <code class="systemitem">foo.bar.edu</code> to reach a
	    host called <code class="systemitem">mumble</code> in the
	    <code class="systemitem">bar.edu</code>
	    domain, refer to it by the Fully-Qualified Domain Name
	    <acronym class="acronym">FQDN</acronym>, <code class="systemitem">mumble.bar.edu</code>,
	    instead of just <code class="systemitem">mumble</code>.</p><p xml:lang="en" lang="en">This is because the version of
	    <span class="application">BIND</span><a id="idp82906040" class="indexterm"></a> which ships with FreeBSD
	    no longer provides default abbreviations for non-FQDNs
	    other than the local domain.  An unqualified host such as
	    <code class="systemitem">mumble</code> must either be found as
	    <code class="systemitem">mumble.foo.bar.edu</code>, or
	    it will be searched for in the root domain.</p><p xml:lang="en" lang="en">In older versions of <span class="application">BIND</span>,
	    the search continued across <code class="systemitem">mumble.bar.edu</code>, and
	    <code class="systemitem">mumble.edu</code>.
	    RFC 1535 details why this is considered bad practice or
	    even a security hole.</p><p xml:lang="en" lang="en">As a good workaround, place the line:</p><pre xml:lang="en" class="programlisting" lang="en">search foo.bar.edu bar.edu</pre><p xml:lang="en" lang="en">instead of the previous:</p><pre xml:lang="en" class="programlisting" lang="en">domain foo.bar.edu</pre><p xml:lang="en" lang="en">into <code class="filename">/etc/resolv.conf</code>.  However,
	    make sure that the search order does not go beyond the
	    <span class="quote">“<span class="quote">boundary between local and public
	      administration</span>”</span>, as RFC 1535 calls it.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp82913336"></a><a id="idp82913592"></a><p><strong>28.5.2.</strong></p></td><td align="left" valign="top"><p xml:lang="en" lang="en">How can I run a mail server on a dial-up PPP
	    host?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p xml:lang="en" lang="en">Connect to a FreeBSD mail gateway on the LAN.  The PPP
	    connection is non-dedicated.</p><p xml:lang="en" lang="en">One way to do this is to get a full-time Internet
	    server to provide secondary
	    <acronym class="acronym">MX</acronym>
	    <a id="idp82916024" class="indexterm"></a>
	    services for the domain.  In this example, the domain is
	    <code class="systemitem">example.com</code>
	    and the ISP has configured
	    <code class="systemitem">example.net</code>
	    to provide secondary <acronym class="acronym">MX</acronym> services to the
	    domain:</p><pre xml:lang="en" class="programlisting" lang="en">example.com.          MX        10      example.com.
                      MX        20      example.net.</pre><p xml:lang="en" lang="en">Only one host should be specified as the final
	    recipient.  For <span class="application">Sendmail</span>, add
	    <code class="literal">Cw example.com</code> in
	    <code class="filename">/etc/mail/sendmail.cf</code> on <code class="systemitem">example.com</code>.</p><p xml:lang="en" lang="en">When the sending <acronym class="acronym">MTA</acronym> attempts
	    to deliver mail, it will try to connect to the system,
	    <code class="systemitem">example.com</code>,
	    over the PPP link.  This will time out if the destination
	    is offline.  The <acronym class="acronym">MTA</acronym> will automatically
	    deliver it to the secondary <acronym class="acronym">MX</acronym> site at
	    the Internet Service Provider (<acronym class="acronym">ISP</acronym>),
	    <code class="systemitem">example.net</code>.
	    The secondary <acronym class="acronym">MX</acronym> site will periodically
	    try to connect to the primary <acronym class="acronym">MX</acronym> host,
	    <code class="systemitem">example.com</code>.</p><p xml:lang="en" lang="en">Use something like this as a login script:</p><pre xml:lang="en" class="programlisting" lang="en">#!/bin/sh
# Put me in /usr/local/bin/pppmyisp
( sleep 60 ; /usr/sbin/sendmail -q ) &amp;
/usr/sbin/ppp -direct pppmyisp</pre><p xml:lang="en" lang="en">When creating a separate login script for users,
	    instead use <code class="command">sendmail -qRexample.com</code> in
	    the script above.  This will force all mail in the queue
	    for
	    <code class="systemitem">example.com</code>
	    to be processed immediately.</p><p xml:lang="en" lang="en">A further refinement of the situation can be seen from
	    this example from the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-isp" target="_top">FreeBSD Internet service provider's mailing list</a>:</p><pre xml:lang="en" class="programlisting" lang="en">&gt; we provide the secondary MX for a customer. The customer connects to
&gt; our services several times a day automatically to get the mails to
&gt; his primary MX (We do not call his site when a mail for his domains
&gt; arrived). Our sendmail sends the mailqueue every 30 minutes. At the
&gt; moment he has to stay 30 minutes online to be sure that all mail is
&gt; gone to the primary MX.
&gt;
&gt; Is there a command that would initiate sendmail to send all the mails
&gt; now? The user has not root-privileges on our machine of course.

In the <span class="quote">“<span class="quote">privacy flags</span>”</span> section of sendmail.cf, there is a
definition Opgoaway,restrictqrun

Remove restrictqrun to allow non-root users to start the queue processing.
You might also like to rearrange the MXs. We are the 1st MX for our
customers like this, and we have defined:

# If we are the best MX for a host, try directly instead of generating
# local config error.
OwTrue

That way a remote site will deliver straight to you, without trying
the customer connection.  You then send to your customer.  Only works for
<span class="quote">“<span class="quote">hosts</span>”</span>, so you need to get your customer to name their mail
machine <span class="quote">“<span class="quote">customer.com</span>”</span> as well as
<span class="quote">“<span class="quote">hostname.customer.com</span>”</span> in the DNS.  Just put an A record in
the DNS for <span class="quote">“<span class="quote">customer.com</span>”</span>.</pre></td></tr></tbody></table></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mail-advanced"></a>28.6. 進階主題</h2></div></div></div><p xml:lang="en" lang="en">This section covers more involved topics such as mail
      configuration and setting up mail for an entire domain.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mail-config"></a>28.6.1. 基礎設定</h3></div></div></div><a id="idp82946104" class="indexterm"></a><p xml:lang="en" lang="en">Out of the box, one can send email to external hosts as
	long as <code class="filename">/etc/resolv.conf</code> is configured or
	the network has access to a configured <acronym class="acronym">DNS</acronym>
	server.  To have email delivered to the <acronym class="acronym">MTA</acronym>
	on the FreeBSD host, do one of the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Run a <acronym class="acronym">DNS</acronym> server for the
	    domain.</p></li><li class="listitem"><p xml:lang="en" lang="en">Get mail delivered directly to the
	    <acronym class="acronym">FQDN</acronym> for the machine.</p></li></ul></div><a id="idp82951992" class="indexterm"></a><p xml:lang="en" lang="en">In order to have mail delivered directly to a host, it
	must have a permanent static IP address, not a dynamic IP
	address.  If the system is behind a firewall, it must be
	configured to allow SMTP traffic.  To receive mail directly at
	a host, one of these two must be configured:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Make sure that the lowest-numbered
	    <acronym class="acronym">MX</acronym><a id="idp82970680" class="indexterm"></a> record in
	    <acronym class="acronym">DNS</acronym> points to the host's static IP
	    address.</p></li><li class="listitem"><p xml:lang="en" lang="en">Make sure there is no <acronym class="acronym">MX</acronym> entry in
	    the <acronym class="acronym">DNS</acronym> for the host.</p></li></ul></div><p xml:lang="en" lang="en">Either of the above will allow mail to be received
	directly at the host.</p><p xml:lang="en" lang="en">Try this:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>hostname</code></strong>
example.FreeBSD.org
<code class="prompt">#</code> <strong class="userinput"><code>host example.FreeBSD.org</code></strong>
example.FreeBSD.org has address 204.216.27.XX</pre><p xml:lang="en" lang="en">In this example, mail sent directly to
	<code class="email">&lt;yourlogin@example.FreeBSD.org&gt;</code>
	should work without problems, assuming
	<span class="application">Sendmail</span> is running correctly on
	<code class="systemitem">example.FreeBSD.org</code>.</p><p xml:lang="en" lang="en">For this example:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>host example.FreeBSD.org</code></strong>
example.FreeBSD.org has address 204.216.27.XX
example.FreeBSD.org mail is handled (pri=10) by nevdull.FreeBSD.org</pre><p xml:lang="en" lang="en">All mail sent to <code class="systemitem">example.FreeBSD.org</code> will
	be collected on <code class="systemitem">hub</code> under the same
	username instead of being sent directly to your host.</p><p xml:lang="en" lang="en">The above information is handled by the
	<acronym class="acronym">DNS</acronym> server.  The <acronym class="acronym">DNS</acronym>
	record that carries mail routing information is the
	<acronym class="acronym">MX</acronym> entry.  If no <acronym class="acronym">MX</acronym>
	record exists, mail will be delivered directly to the host by
	way of its IP address.</p><p xml:lang="en" lang="en">The <acronym class="acronym">MX</acronym> entry for <code class="systemitem">freefall.FreeBSD.org</code> at
	one time looked like this:</p><pre xml:lang="en" class="programlisting" lang="en">freefall		MX	30	mail.crl.net
freefall		MX	40	agora.rdrop.com
freefall		MX	10	freefall.FreeBSD.org
freefall		MX	20	who.cdrom.com</pre><p xml:lang="en" lang="en"><code class="systemitem">freefall</code> had many
	<acronym class="acronym">MX</acronym> entries.  The lowest
	<acronym class="acronym">MX</acronym> number is the host that receives mail
	directly, if available.  If it is not accessible for some
	reason, the next lower-numbered host will accept messages
	temporarily, and pass it along when a lower-numbered host
	becomes available.</p><p xml:lang="en" lang="en">Alternate <acronym class="acronym">MX</acronym> sites should have separate
	Internet connections in order to be most useful.  Your
	<acronym class="acronym">ISP</acronym> can provide this service.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mail-domain"></a>28.6.2. 網域中的郵件</h3></div></div></div><p xml:lang="en" lang="en">When configuring a <acronym class="acronym">MTA</acronym> for a network,
	any mail sent to hosts in its domain should be diverted to the
	<acronym class="acronym">MTA</acronym> so that users can receive their mail on
	the master mail server.</p><a id="idp82990904" class="indexterm"></a><p xml:lang="en" lang="en">To make life easiest, a user account with the same
	<span class="emphasis"><em>username</em></span> should exist on both the
	<acronym class="acronym">MTA</acronym> and the system with the
	<acronym class="acronym">MUA</acronym>.  Use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=adduser&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">adduser</span>(8)</span></a> to create the
	user accounts.</p><p xml:lang="en" lang="en">The <acronym class="acronym">MTA</acronym> must be the designated mail
	exchanger for each workstation on the network.  This is done
	in the<acronym class="acronym">DNS</acronym> configuration with an
	<acronym class="acronym">MX</acronym> record:</p><pre xml:lang="en" class="programlisting" lang="en">example.FreeBSD.org	A	204.216.27.XX		; Workstation
			MX	10 nevdull.FreeBSD.org	; Mailhost</pre><p xml:lang="en" lang="en">This will redirect mail for the workstation to the
	<acronym class="acronym">MTA</acronym> no matter where the A record points.
	The mail is sent to the <acronym class="acronym">MX</acronym> host.</p><p xml:lang="en" lang="en">This must be configured on a <acronym class="acronym">DNS</acronym>
	server.  If the network does not run its own
	<acronym class="acronym">DNS</acronym> server, talk to the
	<acronym class="acronym">ISP</acronym> or <acronym class="acronym">DNS</acronym>
	provider.</p><p xml:lang="en" lang="en">The following is an example of virtual email hosting.
	Consider a customer with the domain <code class="systemitem">customer1.org</code>, where all
	the mail for <code class="systemitem">customer1.org</code> should be
	sent to <code class="systemitem">mail.myhost.com</code>.  The
	<acronym class="acronym">DNS</acronym> entry should look like this:</p><pre xml:lang="en" class="programlisting" lang="en">customer1.org		MX	10	mail.myhost.com</pre><p xml:lang="en" lang="en">An <code class="literal">A</code>&gt; record is
	<span class="emphasis"><em>not</em></span> needed for <code class="systemitem">customer1.org</code> in order to
	only handle email for that domain.  However, running
	<code class="command">ping</code> against <code class="systemitem">customer1.org</code> will not
	work unless an <code class="literal">A</code> record exists for
	it.</p><p xml:lang="en" lang="en">Tell the <acronym class="acronym">MTA</acronym> which domains and/or
	hostnames it should accept mail for.  Either of the following
	will work for <span class="application">Sendmail</span>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Add the hosts to
	    <code class="filename">/etc/mail/local-host-names</code> when
	    using the <code class="literal">FEATURE(use_cw_file)</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en">Add a <code class="literal">Cwyour.host.com</code> line to
	    <code class="filename">/etc/sendmail.cf</code>.</p></li></ul></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="outgoing-only"></a>28.7. 寄件設定</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Bill</span> <span class="surname">Moran</span></span>. </span></div></div></div><p xml:lang="en" lang="en">There are many instances where one may only want to send
      mail through a relay.  Some examples are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">The computer is a desktop machine that needs to use
	  programs such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mail&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mail</span>(1)</span></a>, using the
	  <acronym class="acronym">ISP</acronym>'s mail relay.</p></li><li class="listitem"><p xml:lang="en" lang="en">The computer is a server that does not handle mail
	  locally, but needs to pass off all mail to a relay for
	  processing.</p></li></ul></div><p xml:lang="en" lang="en">While any <acronym class="acronym">MTA</acronym> is capable of filling
      this particular niche, it can be difficult to properly configure
      a full-featured <acronym class="acronym">MTA</acronym> just to handle offloading
      mail.  Programs such as <span class="application">Sendmail</span> and
      <span class="application">Postfix</span> are overkill for this
      use.</p><p xml:lang="en" lang="en">Additionally, a typical Internet access service agreement
      may forbid one from running a <span class="quote">“<span class="quote">mail server</span>”</span>.</p><p xml:lang="en" lang="en">The easiest way to fulfill those needs is to install the
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/ssmtp/pkg-descr">mail/ssmtp</a> port:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/mail/ssmtp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install replace clean</code></strong></pre><p xml:lang="en" lang="en">Once installed, <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/ssmtp/pkg-descr">mail/ssmtp</a> can be
      configured with
      <code class="filename">/usr/local/etc/ssmtp/ssmtp.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">root=yourrealemail@example.com
mailhub=mail.example.com
rewriteDomain=example.com
hostname=_HOSTNAME_</pre><p xml:lang="en" lang="en">Use the real email address for <code class="systemitem">root</code>.  Enter the
      <acronym class="acronym">ISP</acronym>'s outgoing mail relay in place of
      <code class="systemitem">mail.example.com</code>.
      Some <acronym class="acronym">ISP</acronym>s call this the <span class="quote">“<span class="quote">outgoing mail
	server</span>”</span> or <span class="quote">“<span class="quote">SMTP server</span>”</span>.</p><p xml:lang="en" lang="en">Make sure to disable <span class="application">Sendmail</span>,
      including the outgoing mail service.  See <a class="xref" href="#mail-disable-sendmail" title="28.4.1. 關閉 Sendmail">節 28.4.1, “關閉 <span class="application">Sendmail</span>”</a> for details.</p><p xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/ssmtp/pkg-descr">mail/ssmtp</a> has some other options
      available.  Refer to the examples in
      <code class="filename">/usr/local/etc/ssmtp</code> or the manual page
      of <span class="application">ssmtp</span> for more information.</p><p xml:lang="en" lang="en">Setting up <span class="application">ssmtp</span> in this manner
      allows any software on the computer that needs to send mail to
      function properly, while not violating the
      <acronym class="acronym">ISP</acronym>'s usage policy or allowing the computer
      to be hijacked for spamming.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="SMTP-dialup"></a>28.8. 在撥號連線使用郵件</h2></div></div></div><p xml:lang="en" lang="en">When using a static IP address, one should not need to
      adjust the default configuration.  Set the hostname to the
      assigned Internet name and <span class="application">Sendmail</span>
      will do the rest.</p><p xml:lang="en" lang="en">When using a dynamically assigned IP address and a dialup
      PPP connection to the Internet, one usually has a mailbox on the
      <acronym class="acronym">ISP</acronym>'s mail server.  In this example, the
      <acronym class="acronym">ISP</acronym>'s domain is <code class="systemitem">example.net</code>, the user name
      is <code class="systemitem">user</code>, the hostname
      is <code class="systemitem">bsd.home</code>, and
      the <acronym class="acronym">ISP</acronym> has allowed <code class="systemitem">relay.example.net</code> as a mail
      relay.</p><p xml:lang="en" lang="en">In order to retrieve mail from the <acronym class="acronym">ISP</acronym>'s
      mailbox, install a retrieval agent from the Ports Collection.
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/fetchmail/pkg-descr">mail/fetchmail</a> is a good choice as it
      supports many different protocols.  Usually, the
      <acronym class="acronym">ISP</acronym> will provide <acronym class="acronym">POP</acronym>.
      When using user <acronym class="acronym">PPP</acronym>, email can be
      automatically fetched when an Internet connection is established
      with the following entry in
      <code class="filename">/etc/ppp/ppp.linkup</code>:</p><pre xml:lang="en" class="programlisting" lang="en">MYADDR:
!bg su user -c fetchmail</pre><p xml:lang="en" lang="en">When using <span class="application">Sendmail</span> to deliver
      mail to non-local accounts, configure
      <span class="application">Sendmail</span> to process the mail queue as
      soon as the Internet connection is established.  To do this, add
      this line after the above <code class="command">fetchmail</code> entry in
      <code class="filename">/etc/ppp/ppp.linkup</code>:</p><pre xml:lang="en" class="programlisting" lang="en">  !bg su user -c "sendmail -q"</pre><p xml:lang="en" lang="en">In this example, there is an account for
      <code class="systemitem">user</code> on <code class="systemitem">bsd.home</code>.  In the home
      directory of <code class="systemitem">user</code> on
      <code class="systemitem">bsd.home</code>, create a
      <code class="filename">.fetchmailrc</code> which contains this
      line:</p><pre xml:lang="en" class="programlisting" lang="en">poll example.net protocol pop3 fetchall pass MySecret</pre><p xml:lang="en" lang="en">This file should not be readable by anyone except
      <code class="systemitem">user</code> as it contains
      the password <code class="literal">MySecret</code>.</p><p xml:lang="en" lang="en">In order to send mail with the correct
      <code class="literal">from:</code> header, configure
      <span class="application">Sendmail</span> to use
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:user@example.net">user@example.net</a>&gt;</code> rather than <code class="email">&lt;user@bsd.home&gt;</code> and to send all mail via
      <code class="systemitem">relay.example.net</code>,
      allowing quicker mail transmission.</p><p xml:lang="en" lang="en">The following <code class="filename">.mc</code> should
      suffice:</p><pre xml:lang="en" class="programlisting" lang="en">VERSIONID(`bsd.home.mc version 1.0')
OSTYPE(bsd4.4)dnl
FEATURE(nouucp)dnl
MAILER(local)dnl
MAILER(smtp)dnl
Cwlocalhost
Cwbsd.home
MASQUERADE_AS(`example.net')dnl
FEATURE(allmasquerade)dnl
FEATURE(masquerade_envelope)dnl
FEATURE(nocanonify)dnl
FEATURE(nodns)dnl
define(`SMART_HOST', `relay.example.net')
Dmbsd.home
define(`confDOMAIN_NAME',`bsd.home')dnl
define(`confDELIVERY_MODE',`deferred')dnl</pre><p xml:lang="en" lang="en">Refer to the previous section for details of how to convert
      this file into the <code class="filename">sendmail.cf</code> format.  Do
      not forget to restart <span class="application">Sendmail</span> after
      updating <code class="filename">sendmail.cf</code>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="SMTP-Auth"></a>28.9. SMTP 認證</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">James</span> <span class="surname">Gorham</span></span>. </span></div></div></div><p xml:lang="en" lang="en">Configuring <acronym class="acronym">SMTP</acronym> authentication on the
      <acronym class="acronym">MTA</acronym> provides a number of benefits.
      <acronym class="acronym">SMTP</acronym> authentication adds a layer
      of security to <span class="application">Sendmail</span>, and provides
      mobile users who switch hosts the ability to use the same
      <acronym class="acronym">MTA</acronym> without the need to reconfigure their
      mail client's settings each time.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">Install <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/cyrus-sasl2/pkg-descr">security/cyrus-sasl2</a>
	  from the Ports Collection.  This port supports a number of
	  compile-time options.  For the SMTP authentication method
	  demonstrated in this example, make sure that
	  <code class="option">LOGIN</code> is not disabled.</p></li><li class="step"><p xml:lang="en" lang="en">After installing
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/cyrus-sasl2/pkg-descr">security/cyrus-sasl2</a>, edit
	  <code class="filename">/usr/local/lib/sasl2/Sendmail.conf</code>,
	  or create it if it does not exist, and add the following
	  line:</p><pre xml:lang="en" class="programlisting" lang="en">pwcheck_method: saslauthd</pre></li><li class="step"><p xml:lang="en" lang="en">Next, install
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/cyrus-sasl2-saslauthd/pkg-descr">security/cyrus-sasl2-saslauthd</a> and add
	  the following line to
	  <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">saslauthd_enable="YES"</pre><p xml:lang="en" lang="en">Finally, start the saslauthd daemon:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service saslauthd start</code></strong></pre><p xml:lang="en" lang="en">This daemon serves as a broker for
	  <span class="application">Sendmail</span> to authenticate against
	  the FreeBSD <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(5)</span></a> database.  This saves the trouble of
	  creating a new set of usernames and passwords for each user
	  that needs to use <acronym class="acronym">SMTP</acronym> authentication,
	  and keeps the login and mail password the same.</p></li><li class="step"><p xml:lang="en" lang="en">Next, edit <code class="filename">/etc/make.conf</code> and add
	  the following lines:</p><pre xml:lang="en" class="programlisting" lang="en">SENDMAIL_CFLAGS=-I/usr/local/include/sasl -DSASL
SENDMAIL_LDFLAGS=-L/usr/local/lib
SENDMAIL_LDADD=-lsasl2</pre><p xml:lang="en" lang="en">These lines provide <span class="application">Sendmail</span>
	  the proper configuration options for linking to
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/cyrus-sasl2/pkg-descr">cyrus-sasl2</a> at compile time.  Make sure
	  that <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/cyrus-sasl2/pkg-descr">cyrus-sasl2</a> has been installed
	  before recompiling
	  <span class="application">Sendmail</span>.</p></li><li class="step"><p xml:lang="en" lang="en">Recompile <span class="application">Sendmail</span> by
	  executing the following commands:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/lib/libsmutil</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make cleandir &amp;&amp; make obj &amp;&amp; make</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/lib/libsm</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make cleandir &amp;&amp; make obj &amp;&amp; make</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/usr.sbin/sendmail</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make cleandir &amp;&amp; make obj &amp;&amp; make &amp;&amp; make install</code></strong></pre><p xml:lang="en" lang="en">This compile should not have any problems if
	  <code class="filename">/usr/src</code> has not changed extensively
	  and the shared libraries it needs are available.</p></li><li class="step"><p xml:lang="en" lang="en">After <span class="application">Sendmail</span> has been
	  compiled and reinstalled, edit
	  <code class="filename">/etc/mail/freebsd.mc</code> or the local
	  <code class="filename">.mc</code>.  Many administrators choose
	  to use the output from <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostname&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostname</span>(1)</span></a> as the name of
	  <code class="filename">.mc</code> for uniqueness.  Add these
	  lines:</p><pre xml:lang="en" class="programlisting" lang="en">dnl set SASL options
TRUST_AUTH_MECH(`GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN')dnl
define(`confAUTH_MECHANISMS', `GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN')dnl</pre><p xml:lang="en" lang="en">These options configure the different methods available
	  to <span class="application">Sendmail</span> for authenticating
	  users.  To use a method other than
	  <span class="application">pwcheck</span>, refer to the
	  <span class="application">Sendmail</span> documentation.</p></li><li class="step"><p xml:lang="en" lang="en">Finally, run <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> while in
	  <code class="filename">/etc/mail</code>.  That will run the new
	  <code class="filename">.mc</code> and create a
	  <code class="filename">.cf</code> named either
	  <code class="filename">freebsd.cf</code> or the name used for the
	  local <code class="filename">.mc</code>.  Then, run <code class="command">make
	    install restart</code>, which will copy the file to
	  <code class="filename">sendmail.cf</code>, and properly restart
	  <span class="application">Sendmail</span>.  For more information
	  about this process, refer to
	  <code class="filename">/etc/mail/Makefile</code>.</p></li></ol></div><p xml:lang="en" lang="en">To test the configuration, use a <acronym class="acronym">MUA</acronym> to
      send a test message.  For further investigation, set the
      <code class="option">LogLevel</code> of <span class="application">Sendmail</span>
      to <code class="literal">13</code> and watch
      <code class="filename">/var/log/maillog</code> for any errors.</p><p xml:lang="en" lang="en">For more information, refer to <a class="link" href="http://www.sendmail.org/~ca/email/auth.html" target="_top">
	<acronym class="acronym">SMTP</acronym> authentication</a>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mail-agents"></a>28.10. 郵件使用者代理程式</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Marc</span> <span class="surname">Silver</span></span>. </span></div></div></div><a id="idp83165880" class="indexterm"></a><p xml:lang="en" lang="en">A <acronym class="acronym">MUA</acronym> is an application that is used to
      send and receive email.  As email <span class="quote">“<span class="quote">evolves</span>”</span> and
      becomes more complex, <acronym class="acronym">MUA</acronym>s are becoming
      increasingly powerful and provide users increased functionality
      and flexibility.  The <code class="literal">mail</code> category of the
      FreeBSD Ports Collection contains numerous <acronym class="acronym">MUA</acronym>s.
      These include graphical email clients such as
      <span class="application">Evolution</span> or
      <span class="application">Balsa</span> and console based clients such
      as <span class="application">mutt</span> or
      <span class="application">alpine</span>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mail-command"></a>28.10.1. <code class="command">mail</code></h3></div></div></div><p xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mail&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mail</span>(1)</span></a> is the default
	<acronym class="acronym">MUA</acronym> installed with FreeBSD.  It is a console
	based <acronym class="acronym">MUA</acronym> that offers the basic
	functionality required to send and receive text-based email.
	It provides limited attachment support and can only access
	local mailboxes.</p><p xml:lang="en" lang="en">Although <code class="command">mail</code> does not natively support
	interaction with <acronym class="acronym">POP</acronym> or
	<acronym class="acronym">IMAP</acronym> servers, these mailboxes may be
	downloaded to a local <code class="filename">mbox</code> using an
	application such as
	<span class="application">fetchmail</span>.</p><p xml:lang="en" lang="en">In order to send and receive email, run
	<code class="command">mail</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>mail</code></strong></pre><p xml:lang="en" lang="en">The contents of the user's mailbox in
	<code class="filename">/var/mail</code> are automatically read by
	<code class="command">mail</code>.  Should the mailbox be empty, the
	utility exits with a message indicating that no mail could
	be found.  If mail exists, the application interface starts,
	and a list of messages will be displayed.  Messages are
	automatically numbered, as can be seen in the following
	example:</p><pre xml:lang="en" class="screen" lang="en">Mail version 8.1 6/6/93.  Type ? for help.
"/var/mail/marcs": 3 messages 3 new
&gt;N  1 root@localhost        Mon Mar  8 14:05  14/510   "test"
 N  2 root@localhost        Mon Mar  8 14:05  14/509   "user account"
 N  3 root@localhost        Mon Mar  8 14:05  14/509   "sample"</pre><p xml:lang="en" lang="en">Messages can now be read by typing <span class="keycap"><strong>t</strong></span>
	followed by the message number.  This example reads the first
	email:</p><pre xml:lang="en" class="screen" lang="en">&amp; <strong class="userinput"><code>t 1</code></strong>
Message 1:
From root@localhost  Mon Mar  8 14:05:52 2004
X-Original-To: marcs@localhost
Delivered-To: marcs@localhost
To: marcs@localhost
Subject: test
Date: Mon,  8 Mar 2004 14:05:52 +0200 (SAST)
From: root@localhost (Charlie Root)

This is a test message, please reply if you receive it.</pre><p xml:lang="en" lang="en">As seen in this example, the message will be displayed
	with full headers.  To display the list of messages again,
	press <span class="keycap"><strong>h</strong></span>.</p><p xml:lang="en" lang="en">If the email requires a reply, press either
	<span class="keycap"><strong>R</strong></span> or <span class="keycap"><strong>r</strong></span>
	<code class="command">mail</code> keys.  <span class="keycap"><strong>R</strong></span> instructs
	<code class="command">mail</code> to reply only to the sender of the
	email, while <span class="keycap"><strong>r</strong></span> replies to all other
	recipients of the message.  These commands can be suffixed
	with the mail number of the message to reply to.  After typing
	the response, the end of the message should be marked by a
	single <span class="keycap"><strong>.</strong></span> on its own line.  An example can be
	seen below:</p><pre xml:lang="en" class="screen" lang="en">&amp; <strong class="userinput"><code>R 1</code></strong>
To: root@localhost
Subject: Re: test

<strong class="userinput"><code>Thank you, I did get your email.
.</code></strong>
EOT</pre><p xml:lang="en" lang="en">In order to send a new email, press <span class="keycap"><strong>m</strong></span>,
	followed by the recipient email address.  Multiple recipients
	may be specified by separating each address with the
	<span class="keycap"><strong>,</strong></span> delimiter.  The subject of the message may
	then be entered, followed by the message contents.  The end of
	the message should be specified by putting a single
	<span class="keycap"><strong>.</strong></span> on its own line.</p><pre xml:lang="en" class="screen" lang="en">&amp; <strong class="userinput"><code>mail root@localhost</code></strong>
Subject: <strong class="userinput"><code>I mastered mail

Now I can send and receive email using mail ... :)
.</code></strong>
EOT</pre><p xml:lang="en" lang="en">While using <code class="command">mail</code>, press
	<span class="keycap"><strong>?</strong></span> to display help at any time.  Refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mail&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mail</span>(1)</span></a> for more help on how to use
	<code class="command">mail</code>.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mail&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mail</span>(1)</span></a> was not designed to handle attachments and
	  thus deals with them poorly.  Newer <acronym class="acronym">MUA</acronym>s
	  handle attachments in a more intelligent way.  Users who
	  prefer to use <code class="command">mail</code> may find the
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/converters/mpack/pkg-descr">converters/mpack</a> port to be of
	  considerable use.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mutt-command"></a>28.10.2. <span class="application">mutt</span></h3></div></div></div><p xml:lang="en" lang="en"><span class="application">mutt</span> is a powerful
	<acronym class="acronym">MUA</acronym>, with many features, including:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">The ability to thread messages.</p></li><li class="listitem"><p xml:lang="en" lang="en">PGP support for digital signing and encryption of
	    email.</p></li><li class="listitem"><p xml:lang="en" lang="en">MIME support.</p></li><li class="listitem"><p xml:lang="en" lang="en">Maildir support.</p></li><li class="listitem"><p xml:lang="en" lang="en">Highly customizable.</p></li></ul></div><p xml:lang="en" lang="en">Refer to <code class="uri"><a class="uri" href="http://www.mutt.org" target="_top">http://www.mutt.org</a></code>
	for more information on
	<span class="application">mutt</span>.</p><p xml:lang="en" lang="en"><span class="application">mutt</span> may be installed using the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/mutt/pkg-descr">mail/mutt</a> port.  After the port has been
	installed, <span class="application">mutt</span> can be started by
	issuing the following command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>mutt</code></strong></pre><p xml:lang="en" lang="en"><span class="application">mutt</span> will automatically read
	and display the contents of the user mailbox in
	<code class="filename">/var/mail</code>.  If no mails are found,
	<span class="application">mutt</span> will wait for commands from
	the user.  The example below shows
	<span class="application">mutt</span> displaying a list of
	messages:</p><div class="mediaobject"><img src="mail/mutt1.png" /></div><p xml:lang="en" lang="en">To read an email, select it using the cursor keys and
	press <span class="keycap"><strong>Enter</strong></span>.  An example of
	<span class="application">mutt</span> displaying email can be seen
	below:</p><div class="mediaobject"><img src="mail/mutt2.png" /></div><p xml:lang="en" lang="en">Similar to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mail&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mail</span>(1)</span></a>, <span class="application">mutt</span>
	can be used to reply only to the sender of the message as well
	as to all recipients.  To reply only to the sender of the
	email, press <span class="keycap"><strong>r</strong></span>.  To send a group reply
	to the original sender as well as all the message recipients,
	press <span class="keycap"><strong>g</strong></span>.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">By default, <span class="application">mutt</span> uses the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vi&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vi</span>(1)</span></a> editor for creating and replying to emails.  Each
	  user can customize this by creating or editing the
	  <code class="filename">.muttrc</code> in their home directory and
	  setting the <code class="literal">editor</code> variable or by setting
	  the <code class="envar">EDITOR</code> environment variable.  Refer to
	  <code class="uri"><a class="uri" href="http://www.mutt.org/" target="_top">http://www.mutt.org/</a></code>
	  for more information about configuring
	  <span class="application">mutt</span>.</p></div><p xml:lang="en" lang="en">To compose a new mail message, press
	<span class="keycap"><strong>m</strong></span>.  After a valid subject has been given,
	<span class="application">mutt</span> will start <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vi&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vi</span>(1)</span></a> so the
	email can be written.  Once the contents of the email are
	complete, save and quit from <code class="command">vi</code>.
	<span class="application">mutt</span> will resume, displaying a
	summary screen of the mail that is to be delivered.  In
	order to send the mail, press <span class="keycap"><strong>y</strong></span>.  An example
	of the summary screen can be seen below:</p><div class="mediaobject"><img src="mail/mutt3.png" /></div><p xml:lang="en" lang="en"><span class="application">mutt</span> contains extensive help
	which can be accessed from most of the menus by pressing
	<span class="keycap"><strong>?</strong></span>.  The top line also displays the keyboard
	shortcuts where appropriate.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="alpine-command"></a>28.10.3. <span class="application">alpine</span></h3></div></div></div><p xml:lang="en" lang="en"><span class="application">alpine</span> is aimed at a beginner
	user, but also includes some advanced features.</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><span class="application">alpine</span> has had several remote
	  vulnerabilities discovered in the past, which allowed remote
	  attackers to execute arbitrary code as users on the local
	  system, by the action of sending a specially-prepared email.
	  While <span class="emphasis"><em>known</em></span> problems have been fixed,
	  <span class="application">alpine</span> code is written in an
	  insecure style and the FreeBSD Security Officer believes there
	  are likely to be other undiscovered vulnerabilities.  Users
	  install <span class="application">alpine</span> at their own
	  risk.</p></div><p xml:lang="en" lang="en">The current version of <span class="application">alpine</span>
	may be installed using the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/alpine/pkg-descr">mail/alpine</a>
	port.  Once the port has installed,
	<span class="application">alpine</span> can be started by issuing
	the following command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>alpine</code></strong></pre><p xml:lang="en" lang="en">The first time <span class="application">alpine</span>
	runs, it displays a greeting page with a brief introduction,
	as well as a request from the
	<span class="application">alpine</span> development team to send
	an anonymous email message allowing them to judge how many
	users are using their client.  To send this anonymous message,
	press <span class="keycap"><strong>Enter</strong></span>.  Alternatively, press
	<span class="keycap"><strong>E</strong></span> to exit the greeting without sending an
	anonymous message.  An example of the greeting page is
	shown below:</p><div class="mediaobject"><img src="mail/pine1.png" /></div><p xml:lang="en" lang="en">The main menu is then presented, which can be navigated
	using the cursor keys.  This main menu provides shortcuts for
	the composing new mails, browsing mail directories, and
	administering address book entries.  Below the main menu,
	relevant keyboard shortcuts to perform functions specific to
	the task at hand are shown.</p><p xml:lang="en" lang="en">The default directory opened by
	<span class="application">alpine</span> is
	<code class="filename">inbox</code>.  To view the message index, press
	<span class="keycap"><strong>I</strong></span>, or select the
	<span class="guimenuitem">MESSAGE INDEX</span> option shown
	below:</p><div class="mediaobject"><img src="mail/pine2.png" /></div><p xml:lang="en" lang="en">The message index shows messages in the current directory
	and can be navigated by using the cursor keys.  Highlighted
	messages can be read by pressing
	<span class="keycap"><strong>Enter</strong></span>.</p><div class="mediaobject"><img src="mail/pine3.png" /></div><p xml:lang="en" lang="en">In the screenshot below, a sample message is displayed by
	<span class="application">alpine</span>.  Contextual keyboard
	shortcuts are displayed at the bottom of the screen.  An
	example of one of a shortcut is <span class="keycap"><strong>r</strong></span>, which
	tells the <acronym class="acronym">MUA</acronym> to reply to the current
	message being displayed.</p><div class="mediaobject"><img src="mail/pine4.png" /></div><p xml:lang="en" lang="en">Replying to an email in <span class="application">alpine</span>
	is done using the <span class="application">pico</span> editor,
	which is installed by default with
	<span class="application">alpine</span>.
	<span class="application">pico</span> makes it easy to navigate the
	message and is easier for novice users to use than <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vi&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vi</span>(1)</span></a>
	or <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mail&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mail</span>(1)</span></a>.  Once the reply is complete, the message can
	be sent by pressing <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>X</strong></span>.  <span class="application">alpine</span> will ask for
	confirmation before sending the message.</p><div class="mediaobject"><img src="mail/pine5.png" /></div><p xml:lang="en" lang="en"><span class="application">alpine</span> can be customized using
	the <span class="guimenuitem">SETUP</span> option from the main
	menu.  Consult <code class="uri"><a class="uri" href="http://www.washington.edu/alpine/" target="_top">http://www.washington.edu/alpine/</a></code>
	for more information.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mail-fetchmail"></a>28.11. 使用 <span class="application">fetchmail</span></h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Marc</span> <span class="surname">Silver</span></span>. </span></div></div></div><a id="idp83300024" class="indexterm"></a><p xml:lang="en" lang="en"><span class="application">fetchmail</span> is a full-featured
      <acronym class="acronym">IMAP</acronym> and <acronym class="acronym">POP</acronym> client.  It
      allows users to automatically download mail from remote
      <acronym class="acronym">IMAP</acronym> and <acronym class="acronym">POP</acronym> servers and
      save it into local mailboxes where it can be accessed more
      easily.  <span class="application">fetchmail</span> can be installed
      using the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/fetchmail/pkg-descr">mail/fetchmail</a> port, and offers
      various features, including:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Support for the <acronym class="acronym">POP3</acronym>,
	  <acronym class="acronym">APOP</acronym>, <acronym class="acronym">KPOP</acronym>,
	  <acronym class="acronym">IMAP</acronym>, <acronym class="acronym">ETRN</acronym> and
	  <acronym class="acronym">ODMR</acronym> protocols.</p></li><li class="listitem"><p xml:lang="en" lang="en">Ability to forward mail using <acronym class="acronym">SMTP</acronym>,
	  which allows filtering, forwarding, and aliasing to function
	  normally.</p></li><li class="listitem"><p xml:lang="en" lang="en">May be run in daemon mode to check periodically for new
	  messages.</p></li><li class="listitem"><p xml:lang="en" lang="en">Can retrieve multiple mailboxes and forward them, based
	  on configuration, to different local users.</p></li></ul></div><p xml:lang="en" lang="en">This section explains some of the basic features of
      <span class="application">fetchmail</span>.  This utility requires a
      <code class="filename">.fetchmailrc</code> configuration in the user's
      home directory in order to run correctly.  This file includes
      server information as well as login credentials.  Due to the
      sensitive nature of the contents of this file, it is advisable
      to make it readable only by the user, with the following
      command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>chmod 600 .fetchmailrc</code></strong></pre><p xml:lang="en" lang="en">The following <code class="filename">.fetchmailrc</code> serves as an
      example for downloading a single user mailbox using
      <acronym class="acronym">POP</acronym>.  It tells
      <span class="application">fetchmail</span> to connect to
      <code class="systemitem">example.com</code> using
      a username of <code class="systemitem">joesoap</code>
      and a password of <code class="literal">XXX</code>.  This example assumes
      that the user <code class="systemitem">joesoap</code>
      exists on the local system.</p><pre xml:lang="en" class="programlisting" lang="en">poll example.com protocol pop3 username "joesoap" password "XXX"</pre><p xml:lang="en" lang="en">The next example connects to multiple <acronym class="acronym">POP</acronym>
      and <acronym class="acronym">IMAP</acronym> servers and redirects to different
      local usernames where applicable:</p><pre xml:lang="en" class="programlisting" lang="en">poll example.com proto pop3:
user "joesoap", with password "XXX", is "jsoap" here;
user "andrea", with password "XXXX";
poll example2.net proto imap:
user "john", with password "XXXXX", is "myth" here;</pre><p xml:lang="en" lang="en"><span class="application">fetchmail</span> can be run in daemon
      mode by running it with <code class="option">-d</code>, followed by the
      interval (in seconds) that <span class="application">fetchmail</span>
      should poll servers listed in <code class="filename">.fetchmailrc</code>.
      The following example configures
      <span class="application">fetchmail</span> to poll every 600
      seconds:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>fetchmail -d 600</code></strong></pre><p xml:lang="en" lang="en">More information on <span class="application">fetchmail</span> can
      be found at <code class="uri"><a class="uri" href="http://www.fetchmail.info/" target="_top">http://www.fetchmail.info/</a></code>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mail-procmail"></a>28.12. 使用 <span class="application">procmail</span></h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Marc</span> <span class="surname">Silver</span></span>. </span></div></div></div><a id="idp83352120" class="indexterm"></a><p xml:lang="en" lang="en"><span class="application">procmail</span> is a powerful
      application used to filter incoming mail.  It allows users to
      define <span class="quote">“<span class="quote">rules</span>”</span> which can be matched to incoming
      mails to perform specific functions or to reroute mail to
      alternative mailboxes or email addresses.
      <span class="application">procmail</span> can be installed using the
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/procmail/pkg-descr">mail/procmail</a> port.  Once installed, it can
      be directly integrated into most <acronym class="acronym">MTA</acronym>s.
      Consult the <acronym class="acronym">MTA</acronym> documentation for more
      information.  Alternatively, <span class="application">procmail</span>
      can be integrated by adding the following line to a
      <code class="filename">.forward</code> in the home directory of the
      user:</p><pre xml:lang="en" class="programlisting" lang="en">"|exec /usr/local/bin/procmail || exit 75"</pre><p xml:lang="en" lang="en">The following section displays some basic
      <span class="application">procmail</span> rules, as well as brief
      descriptions of what they do.  Rules must be inserted into a
      <code class="filename">.procmailrc</code>, which must reside in the
      user's home directory.</p><p xml:lang="en" lang="en">The majority of these rules can be found in
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=procmailex&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">procmailex</span>(5)</span></a>.</p><p xml:lang="en" lang="en">To forward all mail from <code class="email">&lt;<a xmlns="" class="email" href="mailto:user@example.com">user@example.com</a>&gt;</code> to
      an external address of <code class="email">&lt;goodmail@example2.com&gt;</code>:</p><pre xml:lang="en" class="programlisting" lang="en">:0
* ^From.*user@example.com
! goodmail@example2.com</pre><p xml:lang="en" lang="en">To forward all mails shorter than 1000 bytes to an external
      address of <code class="email">&lt;goodmail@example2.com&gt;</code>:</p><pre xml:lang="en" class="programlisting" lang="en">:0
* &lt; 1000
! goodmail@example2.com</pre><p xml:lang="en" lang="en">To send all mail sent to
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:alternate@example.com">alternate@example.com</a>&gt;</code> to a mailbox called
      <code class="filename">alternate</code>:</p><pre xml:lang="en" class="programlisting" lang="en">:0
* ^TOalternate@example.com
alternate</pre><p xml:lang="en" lang="en">To send all mail with a subject of <span class="quote">“<span class="quote">Spam</span>”</span> to
      <code class="filename">/dev/null</code>:</p><pre xml:lang="en" class="programlisting" lang="en">:0
^Subject:.*Spam
/dev/null</pre><p xml:lang="en" lang="en">A useful recipe that parses incoming <code class="systemitem">FreeBSD.org</code> mailing lists and
      places each list in its own mailbox:</p><pre xml:lang="en" class="programlisting" lang="en">:0
* ^Sender:.owner-freebsd-\/[^@]+@FreeBSD.ORG
{
	LISTNAME=${MATCH}
	:0
	* LISTNAME??^\/[^@]+
	FreeBSD-${MATCH}
}</pre></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-servers"></a>章 29. 網路伺服器</h2></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#network-servers-synopsis">29.1. 概述</a></span></dt><dt><span class="sect1"><a href="#network-inetd">29.2. <span class="application">inetd</span> 超級伺服器</a></span></dt><dd><dl><dt><span class="sect2"><a href="#network-inetd-conf">29.2.1. 設定檔</a></span></dt><dt><span class="sect2"><a href="#network-inetd-cmdline">29.2.2. 指令列選項</a></span></dt><dt><span class="sect2"><a href="#network-inetd-security">29.2.3. 安全注意事項</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-nfs">29.3. 網路檔案系統 (NFS)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#network-configuring-nfs">29.3.1. 設定伺服器</a></span></dt><dt><span class="sect2"><a href="#idp83702456">29.3.2. 設定客戶端</a></span></dt><dt><span class="sect2"><a href="#idp83728824">29.3.3. 鎖定</a></span></dt><dt><span class="sect2"><a href="#network-amd">29.3.4. 使用 amd(8) 自動掛載</a></span></dt><dt><span class="sect2"><a href="#network-autofs">29.3.5. 使用 autofs(5) 自動掛載</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-nis">29.4. 網路資訊系統 (<acronym class="acronym">NIS</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp83887672">29.4.1. <acronym class="acronym">NIS</acronym> 術語與程序</a></span></dt><dt><span class="sect2"><a href="#idp83921080">29.4.2. 主機類型</a></span></dt><dt><span class="sect2"><a href="#idp83955640">29.4.3. 規劃注意事項</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp83975608">29.4.3.1. 選擇 <acronym class="acronym">NIS</acronym> 網域名稱</a></span></dt><dt><span class="sect3"><a href="#idp83999928">29.4.3.2. 實體伺服器需求</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp84004152">29.4.4. 設定 <acronym class="acronym">NIS</acronym> Master 伺服器</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp84030904">29.4.4.1. 初始化 <acronym class="acronym">NIS</acronym> 對應表</a></span></dt><dt><span class="sect3"><a href="#idp84066616">29.4.4.2. 新增使用者</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp84086200">29.4.5. 設定 <acronym class="acronym">NIS</acronym> Slave 伺服器</a></span></dt><dt><span class="sect2"><a href="#idp84109752">29.4.6. 設定 <acronym class="acronym">NIS</acronym> 客戶端</a></span></dt><dt><span class="sect2"><a href="#idp84135992">29.4.7. <acronym class="acronym">NIS</acronym> 安全性</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp84167480">29.4.7.1. 阻擋部份使用者</a></span></dt></dl></dd><dt><span class="sect2"><a href="#network-netgroups">29.4.8. 使用 Netgroups</a></span></dt><dt><span class="sect2"><a href="#idp84315448">29.4.9. 密碼格式</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-ldap">29.5. 輕量級目錄存取協定 (<acronym class="acronym">LDAP</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp84339512">29.5.1. <acronym class="acronym">LDAP</acronym> 術語與結構</a></span></dt><dt><span class="sect2"><a href="#ldap-config">29.5.2. 設定 <acronym class="acronym">LDAP</acronym> 伺服器</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-dhcp">29.6. 動態主機設置協定 (<acronym class="acronym">DHCP</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp84500408">29.6.1. 設定 <acronym class="acronym">DHCP</acronym> 客戶端</a></span></dt><dt><span class="sect2"><a href="#network-dhcp-server">29.6.2. 安裝並設定 <acronym class="acronym">DHCP</acronym> 伺服器</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-dns">29.7. 網域名稱系統 (<acronym class="acronym">DNS</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp84649144">29.7.1. 要架設名稱伺服器的原因</a></span></dt><dt><span class="sect2"><a href="#idp84689336">29.7.2. <acronym class="acronym">DNS</acronym> 伺服器設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-apache">29.8. Apache HTTP 伺服器</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp84719672">29.8.1. 設定並啟動 Apache</a></span></dt><dt><span class="sect2"><a href="#idp84790072">29.8.2. 虛擬主機</a></span></dt><dt><span class="sect2"><a href="#idp84804792">29.8.3. Apache 模組</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp84809272">29.8.3.1. <code class="filename">mod_ssl</code></a></span></dt><dt><span class="sect3"><a href="#idp84815928">29.8.3.2. <code class="filename">mod_perl</code></a></span></dt><dt><span class="sect3"><a href="#idp84837944">29.8.3.3. <code class="filename">mod_php</code></a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp84876856">29.8.4. 動態網站</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp84880696">29.8.4.1. Django</a></span></dt><dt><span class="sect3"><a href="#idp84894904">29.8.4.2. Ruby on Rails</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#network-ftp">29.9. 檔案傳輸協定 (<acronym class="acronym">FTP</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp84905144">29.9.1. 設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-samba">29.10. <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 用戶端檔案與列印服務 (Samba)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp84980024">29.10.1. 伺服器設定</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp84997304">29.10.1.1. 全域設定</a></span></dt><dt><span class="sect3"><a href="#idp85025080">29.10.1.2. 安全性設定</a></span></dt><dt><span class="sect3"><a href="#idp85035448">29.10.1.3. <span class="application">Samba</span> 使用者</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp85044920">29.10.2. 啟動 <span class="application">Samba</span></a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-ntp">29.11. NTP 時間校對</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp85065656">29.11.1. <acronym class="acronym">NTP</acronym> 設定</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp85070136">29.11.1.1. <code class="filename">/etc/ntp.conf</code> 檔</a></span></dt><dt><span class="sect3"><a href="#idp85106488">29.11.1.2. 在 <code class="filename">/etc/rc.conf</code> 中的 NTP 設定項目</a></span></dt><dt><span class="sect3"><a href="#idp85130424">29.11.1.3. <span class="application">Ntpd</span> 與無權限的 <code class="literal">ntpd</code> 使用者</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp85163832">29.11.2. 在 <acronym class="acronym">PPP</acronym> 連線使用 <acronym class="acronym">NTP</acronym></a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-iscsi">29.12. <acronym class="acronym">iSCSI</acronym> Initiator 與 Target 設定</a></span></dt><dd><dl><dt><span class="sect2"><a href="#network-iscsi-target">29.12.1. 設定 <acronym class="acronym">iSCSI</acronym> Target</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp85232952">29.12.1.1. 認證</a></span></dt></dl></dd><dt><span class="sect2"><a href="#network-iscsi-initiator">29.12.2. 設定 <acronym class="acronym">iSCSI</acronym> Initiator</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp85255992">29.12.2.1. 不使用設定檔連線到 Target</a></span></dt><dt><span class="sect3"><a href="#idp84854584">29.12.2.2. 使用設定檔連線到 Target</a></span></dt></dl></dd></dl></dd></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-servers-synopsis"></a>29.1. 概述</h2></div></div></div><p>本章節涵蓋一些在 <span class="trademark">UNIX</span>® 系統常用的網路服務，包含安裝、設定、測試及維護各種不同類型的網路服務。本章會提供範例設定檔以供參考。</p><p>讀完本章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>如何管理 <span class="application">inetd</span> Daemon。</p></li><li class="listitem"><p>如何設定網路檔案系統 (Network File System, <acronym class="acronym">NFS</acronym>)。</p></li><li class="listitem"><p>如何設定網路資訊伺服器 (Network Information Server, <acronym class="acronym">NIS</acronym>) 來集中管理及共用使用者帳號。</p></li><li class="listitem"><p>如何設定 FreeBSD 成為 <acronym class="acronym">LDAP</acronym> 伺服器或客戶端</p></li><li class="listitem"><p>如何設定使用 <acronym class="acronym">DHCP</acronym> 自動網路設定。</p></li><li class="listitem"><p>如何設定網域名稱伺服器 (Domain Name Server, <acronym class="acronym">DNS</acronym>)。</p></li><li class="listitem"><p>如何設定 <span class="application">Apache</span> <acronym class="acronym">HTTP</acronym> 伺服器。</p></li><li class="listitem"><p>如何設定檔案傳輸協定 (File Transfer Protocol, <acronym class="acronym">FTP</acronym>) 伺服器。</p></li><li class="listitem"><p>如何設定 <span class="application">Samba</span> 檔案與列印伺服器供 <span class="trademark">Windows</span>® 客戶端使用。</p></li><li class="listitem"><p>如何同步時間與日期，並使用網路時間協定 (Network Time Protocol, <acronym class="acronym">NTP</acronym>) 設定時間伺服器。</p></li><li class="listitem"><p>如何設定 <acronym class="acronym">iSCSI</acronym>。</p></li></ul></div><p>本章假設您有以下基礎知識：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">/etc/rc</code> Script。</p></li><li class="listitem"><p>網路術語。</p></li><li class="listitem"><p>安裝其他第三方軟體 (<a class="xref" href="#ports" title="章 4. 安裝應用程式：套件與 Port">章 4, <em>安裝應用程式：套件與 Port</em></a>)。</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-inetd"></a>29.2. <span class="application">inetd</span> 超級伺服器</h2></div></div></div><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> daemon is sometimes referred to as a
      Super-Server because it manages connections for many services.
      Instead of starting multiple applications, only the
      <span class="application">inetd</span> service needs to be started.
      When a connection is received for a service that is managed by
      <span class="application">inetd</span>, it determines which program
      the connection is destined for, spawns a process for that
      program, and delegates the program a socket.  Using
      <span class="application">inetd</span> for services that are not
      heavily used can reduce system load, when compared to running
      each daemon individually in stand-alone mode.</p><p xml:lang="en" lang="en">Primarily, <span class="application">inetd</span> is used to
      spawn other daemons, but several trivial protocols are handled
      internally, such as <span class="application">chargen</span>,
      <span class="application">auth</span>,
      <span class="application">time</span>,
      <span class="application">echo</span>,
      <span class="application">discard</span>, and
      <span class="application">daytime</span>.</p><p xml:lang="en" lang="en">This section covers the basics of configuring
      <span class="application">inetd</span>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-conf"></a>29.2.1. 設定檔</h3></div></div></div><p xml:lang="en" lang="en">Configuration of <span class="application">inetd</span> is
	done by editing <code class="filename">/etc/inetd.conf</code>.  Each
	line of this configuration file represents an application
	which can be started by <span class="application">inetd</span>.  By
	default, every line starts with a comment
	(<code class="literal">#</code>), meaning that
	<span class="application">inetd</span> is not listening for any
	applications.  To configure <span class="application">inetd</span>
	to listen for an application's connections, remove the
	<code class="literal">#</code> at the beginning of the line for that
	application.</p><p xml:lang="en" lang="en">After saving your edits, configure
	<span class="application">inetd</span> to start at system boot by
	editing <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">inetd_enable="YES"</pre><p xml:lang="en" lang="en">To start  <span class="application">inetd</span> now, so that it
	listens for the service you configured, type:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service inetd start</code></strong></pre><p xml:lang="en" lang="en">Once <span class="application">inetd</span> is started, it needs
	to be notified whenever a modification is made to
	<code class="filename">/etc/inetd.conf</code>:</p><div class="example"><a id="network-inetd-reread"></a><div class="example-title">範例 29.1. 重新庫入 <span class="application">inetd</span> 設定檔</div><div class="example-contents"><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service inetd reload</code></strong></pre></div></div><br class="example-break" /><p xml:lang="en" lang="en">Typically, the default entry for an application does not
	need to be edited beyond removing the <code class="literal">#</code>.
	In some situations, it may be appropriate to edit the default
	entry.</p><p xml:lang="en" lang="en">As an example, this is the default entry for <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ftpd</span>(8)</span></a>
	over IPv4:</p><pre xml:lang="en" class="programlisting" lang="en">ftp     stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -l</pre><p xml:lang="en" lang="en">The seven columns in an entry are as follows:</p><pre xml:lang="en" class="programlisting" lang="en">service-name
socket-type
protocol
{wait|nowait}[/max-child[/max-connections-per-ip-per-minute[/max-child-per-ip]]]
user[:group][/login-class]
server-program
server-program-arguments</pre><p xml:lang="en" lang="en">where:</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en">service-name</span></dt><dd><p xml:lang="en" lang="en">The service name of the daemon to start.  It must
	      correspond to a service listed in
	      <code class="filename">/etc/services</code>.  This determines
	      which port <span class="application">inetd</span> listens on
	      for incoming connections to that service.  When using a
	      custom service, it must first be added to
	      <code class="filename">/etc/services</code>.</p></dd><dt><span xml:lang="en" class="term" lang="en">socket-type</span></dt><dd><p xml:lang="en" lang="en">Either <code class="literal">stream</code>,
	      <code class="literal">dgram</code>, <code class="literal">raw</code>, or
	      <code class="literal">seqpacket</code>.  Use
	      <code class="literal">stream</code> for TCP connections and
	      <code class="literal">dgram</code> for
	      <acronym class="acronym">UDP</acronym> services.</p></dd><dt><span xml:lang="en" class="term" lang="en">protocol</span></dt><dd><p xml:lang="en" lang="en">Use one of the following protocol names:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th xml:lang="en" lang="en">Protocol Name</th><th xml:lang="en" lang="en">Explanation</th></tr></thead><tbody><tr><td xml:lang="en" lang="en">tcp or tcp4</td><td xml:lang="en" lang="en">TCP IPv4</td></tr><tr><td xml:lang="en" lang="en">udp or udp4</td><td xml:lang="en" lang="en"><acronym class="acronym">UDP</acronym> IPv4</td></tr><tr><td xml:lang="en" lang="en">tcp6</td><td xml:lang="en" lang="en">TCP IPv6</td></tr><tr><td xml:lang="en" lang="en">udp6</td><td xml:lang="en" lang="en"><acronym class="acronym">UDP</acronym> IPv6</td></tr><tr><td xml:lang="en" lang="en">tcp46</td><td xml:lang="en" lang="en">Both TCP IPv4 and IPv6</td></tr><tr><td xml:lang="en" lang="en">udp46</td><td xml:lang="en" lang="en">Both <acronym class="acronym">UDP</acronym> IPv4 and
		      IPv6</td></tr></tbody></table></div></dd><dt><span xml:lang="en" class="term" lang="en">{wait|nowait}[/max-child[/max-connections-per-ip-per-minute[/max-child-per-ip]]]</span></dt><dd><p xml:lang="en" lang="en">In this field, <code class="option">wait</code> or
	      <code class="option">nowait</code> must be specified.
	      <code class="option">max-child</code>,
	      <code class="option">max-connections-per-ip-per-minute</code> and
	      <code class="option">max-child-per-ip</code> are optional.</p><p xml:lang="en" lang="en"><code class="option">wait|nowait</code> indicates whether or
	      not the service is able to handle its own socket.
	      <code class="option">dgram</code> socket types must use
	      <code class="option">wait</code> while
	      <code class="option">stream</code> daemons, which are usually
	      multi-threaded, should use <code class="option">nowait</code>.
	      <code class="option">wait</code> usually hands off multiple sockets
	      to a single daemon, while <code class="option">nowait</code> spawns
	      a child daemon for each new socket.</p><p xml:lang="en" lang="en">The maximum number of child daemons
	      <span class="application">inetd</span> may spawn is set by
	      <code class="option">max-child</code>.  For example, to limit ten
	      instances of the daemon, place a <code class="literal">/10</code>
	      after <code class="option">nowait</code>.  Specifying
	      <code class="literal">/0</code> allows an unlimited number of
	      children.</p><p xml:lang="en" lang="en"><code class="option">max-connections-per-ip-per-minute</code>
	      limits the number of connections from any particular
	      <acronym class="acronym">IP</acronym> address per minute.  Once the
	      limit  is reached, further connections from this IP
	      address will be dropped until the end of the minute.
	      For example, a value of <code class="literal">/10</code> would
	      limit any particular <acronym class="acronym">IP</acronym> address to
	      ten connection attempts per minute.
	      <code class="option">max-child-per-ip</code> limits the number of
	      child processes that can be started on behalf on any
	      single <acronym class="acronym">IP</acronym> address at any moment.
	      These options can limit excessive resource consumption
	      and help to prevent Denial of Service attacks.</p><p xml:lang="en" lang="en">An example can be seen in the default settings for
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fingerd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fingerd</span>(8)</span></a>:</p><pre xml:lang="en" class="programlisting" lang="en">finger stream  tcp     nowait/3/10 nobody /usr/libexec/fingerd fingerd -k -s</pre></dd><dt><span xml:lang="en" class="term" lang="en">user</span></dt><dd><p xml:lang="en" lang="en">The username the daemon
	      will run as.  Daemons typically run as
	      <code class="systemitem">root</code>,
	      <code class="systemitem">daemon</code>, or
	      <code class="systemitem">nobody</code>.</p></dd><dt><span xml:lang="en" class="term" lang="en">server-program</span></dt><dd><p xml:lang="en" lang="en">The full path to the daemon.  If the daemon is a
	      service provided by <span class="application">inetd</span>
	      internally, use <code class="option">internal</code>.</p></dd><dt><span xml:lang="en" class="term" lang="en">server-program-arguments</span></dt><dd><p xml:lang="en" lang="en">Used to specify any command arguments to be passed
	      to the daemon on invocation.  If the daemon is an
	      internal service, use
	      <code class="option">internal</code>.</p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-cmdline"></a>29.2.2. 指令列選項</h3></div></div></div><p xml:lang="en" lang="en">Like most server daemons, <span class="application">inetd</span>
	has a number of options that can be used to modify its
	behavior.  By default, <span class="application">inetd</span> is
	started with <code class="literal">-wW -C 60</code>.  These options
	enable TCP wrappers for all services, including internal
	services, and prevent any <acronym class="acronym">IP</acronym> address from
	requesting any service more than 60 times per minute.</p><p xml:lang="en" lang="en">To change the default options which are passed to
	<span class="application">inetd</span>, add an entry for
	<code class="literal">inetd_flags</code> in
	<code class="filename">/etc/rc.conf</code>.  If
	<span class="application">inetd</span> is already running, restart
	it with <code class="command">service inetd restart</code>.</p><p xml:lang="en" lang="en">The available rate limiting options are:</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en">-c maximum</span></dt><dd><p xml:lang="en" lang="en">Specify the default maximum number of simultaneous
	      invocations of each service, where the default is
	      unlimited.  May be overridden on a per-service basis by
	      using <code class="option">max-child</code> in
	      <code class="filename">/etc/inetd.conf</code>.</p></dd><dt><span xml:lang="en" class="term" lang="en">-C rate</span></dt><dd><p xml:lang="en" lang="en">Specify the default maximum number of times a
	      service can be invoked from a single
	      <acronym class="acronym">IP</acronym> address per minute.  May be
	      overridden on a per-service basis by using
	      <code class="option">max-connections-per-ip-per-minute</code> in
	      <code class="filename">/etc/inetd.conf</code>.</p></dd><dt><span xml:lang="en" class="term" lang="en">-R rate</span></dt><dd><p xml:lang="en" lang="en">Specify the maximum number of times a service can be
	      invoked in one minute, where the default is
	      <code class="literal">256</code>.  A rate of <code class="literal">0</code>
	      allows an unlimited number.</p></dd><dt><span xml:lang="en" class="term" lang="en">-s maximum</span></dt><dd><p xml:lang="en" lang="en">Specify the maximum number of times a service can be
	      invoked from a single <acronym class="acronym">IP</acronym> address at
	      any one time, where the default is unlimited.  May be
	      overridden on a per-service basis by using
	      <code class="option">max-child-per-ip</code> in
	      <code class="filename">/etc/inetd.conf</code>.</p></dd></dl></div><p xml:lang="en" lang="en">Additional options are available.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a>
	for the full list of options.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-security"></a>29.2.3. 安全注意事項</h3></div></div></div><p xml:lang="en" lang="en">Many of the daemons which can be managed by
	<span class="application">inetd</span> are not security-conscious.
	Some daemons, such as <span class="application">fingerd</span>, can
	provide information that may be useful to an attacker.  Only
	enable the services which are needed and monitor the system
	for excessive connection attempts.
	<code class="literal">max-connections-per-ip-per-minute</code>,
	<code class="literal">max-child</code> and
	<code class="literal">max-child-per-ip</code> can be used to limit such
	attacks.</p><p xml:lang="en" lang="en">By default, TCP wrappers is enabled.  Consult
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hosts_access&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hosts_access</span>(5)</span></a> for more information on placing TCP
	restrictions on various
	<span class="application">inetd</span> invoked daemons.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-nfs"></a>29.3. 網路檔案系統 (NFS)</h2></div><div><span class="authorgroup">Reorganized and enhanced by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Bill</span> <span class="surname">Swingle</span></span>. </span></div></div></div><a id="idp83601720" class="indexterm"></a><p xml:lang="en" lang="en">FreeBSD supports the Network File System
      (<acronym class="acronym">NFS</acronym>), which allows a server to share
      directories and files with clients over a network.  With
      <acronym class="acronym">NFS</acronym>, users and programs can access files on
      remote systems as if they were stored locally.</p><p xml:lang="en" lang="en"><acronym class="acronym">NFS</acronym> has many practical uses.  Some of
      the more common uses include:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Data that would otherwise be duplicated on each client
	  can be kept in a single location and accessed by clients
	  on the network.</p></li><li class="listitem"><p xml:lang="en" lang="en">Several clients may need access to the
	  <code class="filename">/usr/ports/distfiles</code> directory.
	  Sharing that directory allows for quick access to the
	  source files without having to download them to each
	  client.</p></li><li class="listitem"><p xml:lang="en" lang="en">On large networks, it is often more convenient to
	  configure a central <acronym class="acronym">NFS</acronym> server on which
	  all user home directories are stored.  Users can log into
	  a client anywhere on the network and have access to their
	  home directories.</p></li><li class="listitem"><p xml:lang="en" lang="en">Administration of <acronym class="acronym">NFS</acronym> exports is
	  simplified.  For example, there is only one file system
	  where security or backup policies must be set.</p></li><li class="listitem"><p xml:lang="en" lang="en">Removable media storage devices can be used by other
	  machines on the network.  This reduces the number of devices
	  throughout the network and provides a centralized location
	  to manage their security.  It is often more convenient to
	  install software on multiple machines from a centralized
	  installation media.</p></li></ul></div><p xml:lang="en" lang="en"><acronym class="acronym">NFS</acronym> consists of a server and one or more
      clients.  The client remotely accesses the data that is stored
      on the server machine.  In order for this to function properly,
      a few processes have to be configured and running.</p><p xml:lang="en" lang="en">These daemons must be running on the server:</p><a id="idp83628216" class="indexterm"></a><a id="idp83629496" class="indexterm"></a><a id="idp83630776" class="indexterm"></a><a id="idp83631800" class="indexterm"></a><a id="idp83632824" class="indexterm"></a><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th xml:lang="en" lang="en">Daemon</th><th>說明</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><span class="application">nfsd</span></td><td xml:lang="en" lang="en">The <acronym class="acronym">NFS</acronym> daemon which services
		requests from <acronym class="acronym">NFS</acronym> clients.</td></tr><tr><td xml:lang="en" lang="en"><span class="application">mountd</span></td><td xml:lang="en" lang="en">The <acronym class="acronym">NFS</acronym> mount daemon which
		carries out requests received from
		<span class="application">nfsd</span>.</td></tr><tr><td xml:lang="en" lang="en"><span class="application">rpcbind</span></td><td xml:lang="en" lang="en"> This daemon allows <acronym class="acronym">NFS</acronym>
		clients to discover which port the
		<acronym class="acronym">NFS</acronym> server is using.</td></tr></tbody></table></div><p xml:lang="en" lang="en">Running <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=nfsiod&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">nfsiod</span>(8)</span></a> on the client can improve
	performance, but is not required.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-configuring-nfs"></a>29.3.1. 設定伺服器</h3></div></div></div><a id="idp83663160" class="indexterm"></a><p xml:lang="en" lang="en">The file systems which the <acronym class="acronym">NFS</acronym> server
	will share are specified in <code class="filename">/etc/exports</code>.
	Each line in this file specifies a file system to be exported,
	which clients have access to that file system, and any access
	options.  When adding entries to this file, each exported file
	system, its properties, and allowed hosts must occur on a
	single line.  If no clients are listed in the entry, then any
	client on the network can mount that file system.</p><a id="idp83665720" class="indexterm"></a><p xml:lang="en" lang="en">The following <code class="filename">/etc/exports</code> entries
	demonstrate how to export file systems.  The examples can be
	modified to match the file systems and client names on the
	reader's network.  There are many options that can be used in
	this file, but only a few will be mentioned here.  See
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=exports&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">exports</span>(5)</span></a> for the full list of options.</p><p xml:lang="en" lang="en">This example shows how to export
	<code class="filename">/cdrom</code> to three hosts named
	<em class="replaceable"><code>alpha</code></em>,
	<em class="replaceable"><code>bravo</code></em>, and
	<em class="replaceable"><code>charlie</code></em>:</p><pre xml:lang="en" class="programlisting" lang="en">/cdrom -ro <em class="replaceable"><code>alpha</code></em> <em class="replaceable"><code>bravo</code></em> <em class="replaceable"><code>charlie</code></em></pre><p xml:lang="en" lang="en">The <code class="literal">-ro</code> flag makes the file system
	read-only, preventing clients from making any changes to the
	exported file system.  This example assumes that the host
	names are either in <acronym class="acronym">DNS</acronym> or in
	<code class="filename">/etc/hosts</code>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hosts&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hosts</span>(5)</span></a> if
	the network does not have a <acronym class="acronym">DNS</acronym>
	server.</p><p xml:lang="en" lang="en">The next example exports <code class="filename">/home</code> to
	three clients by <acronym class="acronym">IP</acronym> address.  This can be
	useful for networks without <acronym class="acronym">DNS</acronym> or
	<code class="filename">/etc/hosts</code> entries.  The
	<code class="literal">-alldirs</code> flag allows subdirectories to be
	mount points.  In other words, it will not automatically mount
	the subdirectories, but will permit the client to mount the
	directories that are required as needed.</p><pre xml:lang="en" class="programlisting" lang="en">/usr/home  -alldirs  10.0.0.2 10.0.0.3 10.0.0.4</pre><p xml:lang="en" lang="en">This next example exports <code class="filename">/a</code> so that
	two clients from different domains may access that file
	system.  The <code class="option">-maproot=root</code> allows <code class="systemitem">root</code> on the remote system to
	write data on the exported file system as <code class="systemitem">root</code>.  If
	<code class="literal">-maproot=root</code> is not specified, the
	client's <code class="systemitem">root</code> user
	will be mapped to the server's <code class="systemitem">nobody</code> account and will be
	subject to the access limitations defined for <code class="systemitem">nobody</code>.</p><pre xml:lang="en" class="programlisting" lang="en">/a  -maproot=root  host.example.com box.example.org</pre><p xml:lang="en" lang="en">A client can only be specified once per file system.  For
	example, if <code class="filename">/usr</code> is a single file system,
	these entries would be invalid as both entries specify the
	same host:</p><pre xml:lang="en" class="programlisting" lang="en"># Invalid when /usr is one file system
/usr/src   client
/usr/ports client</pre><p xml:lang="en" lang="en">The correct format for this situation is to use one
	entry:</p><pre xml:lang="en" class="programlisting" lang="en">/usr/src /usr/ports  client</pre><p xml:lang="en" lang="en">The following is an example of a valid export list, where
	<code class="filename">/usr</code> and <code class="filename">/exports</code>
	are local file systems:</p><pre xml:lang="en" class="programlisting" lang="en"># Export src and ports to client01 and client02, but only
# client01 has root privileges on it
/usr/src /usr/ports -maproot=root    client01
/usr/src /usr/ports               client02
# The client machines have root and can mount anywhere
# on /exports. Anyone in the world can mount /exports/obj read-only
/exports -alldirs -maproot=root      client01 client02
/exports/obj -ro</pre><p xml:lang="en" lang="en">To enable the processes required by the
	<acronym class="acronym">NFS</acronym> server at boot time, add these options
	to <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">rpcbind_enable="YES"
nfs_server_enable="YES"
mountd_flags="-r"</pre><p xml:lang="en" lang="en">The server can be started now by running this
	command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service nfsd start</code></strong></pre><p xml:lang="en" lang="en">Whenever the <acronym class="acronym">NFS</acronym> server is started,
	<span class="application">mountd</span> also starts automatically.
	However, <span class="application">mountd</span> only reads
	<code class="filename">/etc/exports</code> when it is started.  To make
	subsequent <code class="filename">/etc/exports</code> edits take effect
	immediately, force <span class="application">mountd</span> to reread
	it:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service mountd reload</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp83702456"></a>29.3.2. 設定客戶端</h3></div></div></div><p xml:lang="en" lang="en">To enable <acronym class="acronym">NFS</acronym> clients, set this option
	in each client's <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">nfs_client_enable="YES"</pre><p xml:lang="en" lang="en">Then, run this command on each <acronym class="acronym">NFS</acronym>
	client:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service nfsclient start</code></strong></pre><p xml:lang="en" lang="en">The client now has everything it needs to mount a remote
	file system.  In these examples, the server's name is
	<code class="systemitem">server</code> and the client's name is
	<code class="systemitem">client</code>.  To mount
	<code class="filename">/home</code> on
	<code class="systemitem">server</code> to the
	<code class="filename">/mnt</code> mount point on
	<code class="systemitem">client</code>:</p><a id="idp83722040" class="indexterm"></a><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount server:/home /mnt</code></strong></pre><p xml:lang="en" lang="en">The files and directories in
	<code class="filename">/home</code> will now be available on
	<code class="systemitem">client</code>, in the
	<code class="filename">/mnt</code> directory.</p><p xml:lang="en" lang="en">To mount a remote file system each time the client boots,
	add it to <code class="filename">/etc/fstab</code>:</p><pre xml:lang="en" class="programlisting" lang="en">server:/home	/mnt	nfs	rw	0	0</pre><p xml:lang="en" lang="en">Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a> for a description of all available
	options.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp83728824"></a>29.3.3. 鎖定</h3></div></div></div><p xml:lang="en" lang="en">Some applications require file locking to operate
	correctly.  To enable locking, add these lines to
	<code class="filename">/etc/rc.conf</code> on both the client and
	server:</p><pre xml:lang="en" class="programlisting" lang="en">rpc_lockd_enable="YES"
rpc_statd_enable="YES"</pre><p xml:lang="en" lang="en">Then start the applications:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service lockd start</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service statd start</code></strong></pre><p xml:lang="en" lang="en">If locking is not required on the server, the
	<acronym class="acronym">NFS</acronym> client can be configured to lock
	locally by including <code class="option">-L</code> when running
	<span class="application">mount</span>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount_nfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount_nfs</span>(8)</span></a>
	for further details.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-amd"></a>29.3.4. 使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=amd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">amd</span>(8)</span></a> 自動掛載</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Wylie</span> <span class="surname">Stilwell</span></span>. </span></div><div><span class="authorgroup">Rewritten by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Chern</span> <span class="surname">Lee</span></span>. </span></div></div></div><a id="idp83746616" class="indexterm"></a><a id="idp83747256" class="indexterm"></a><p xml:lang="en" lang="en">The automatic mounter daemon,
	<span class="application">amd</span>, automatically mounts a remote
	file system whenever a file or directory within that file
	system is accessed.  File systems that are inactive for a
	period of time will be automatically unmounted by
	<span class="application">amd</span>.</p><p xml:lang="en" lang="en">This daemon provides an alternative to modifying
	<code class="filename">/etc/fstab</code> to list every client.  It
	operates by attaching itself as an  <acronym class="acronym">NFS</acronym>
	server to the <code class="filename">/host</code> and
	<code class="filename">/net</code> directories.  When a file is
	accessed within one of these directories,
	<span class="application">amd</span> looks up the corresponding
	remote mount and automatically mounts it.
	<code class="filename">/net</code> is used to mount an exported file
	system from an <acronym class="acronym">IP</acronym> address while
	<code class="filename">/host</code> is used to mount an export from a
	remote hostname.  For instance, an attempt to access a file
	within <code class="filename">/host/foobar/usr</code> would tell
	<span class="application">amd</span> to mount the
	<code class="filename">/usr</code> export on the host
	<code class="systemitem">foobar</code>.</p><div class="example"><a id="idp83754552"></a><div class="example-title">範例 29.2. 使用 <span class="application">amd</span> 掛載 Export</div><div class="example-contents"><p xml:lang="en" lang="en">In this example, <code class="command">showmount -e</code> shows
	  the exported file systems that can be mounted from the
	  <acronym class="acronym">NFS</acronym> server,
	  <code class="systemitem">foobar</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>showmount -e foobar</code></strong>
Exports list on foobar:
/usr                               10.10.10.0
/a                                 10.10.10.0
<code class="prompt">%</code> <strong class="userinput"><code>cd /host/foobar/usr</code></strong></pre></div></div><br class="example-break" /><p xml:lang="en" lang="en">The output from <code class="command">showmount</code> shows
	<code class="filename">/usr</code> as an export.  When changing
	directories to <code class="filename">/host/foobar/usr</code>,
	<span class="application">amd</span> intercepts the request and
	attempts to resolve the hostname
	<code class="systemitem">foobar</code>.  If successful,
	<span class="application">amd</span> automatically mounts the
	desired export.</p><p xml:lang="en" lang="en">To enable <span class="application">amd</span> at boot time, add
	this line to <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">amd_enable="YES"</pre><p xml:lang="en" lang="en">To start <span class="application">amd</span> now:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service amd start</code></strong></pre><p xml:lang="en" lang="en">Custom flags can be passed to
	<span class="application">amd</span> from the
	<code class="varname">amd_flags</code> environment variable.  By
	default, <code class="varname">amd_flags</code> is set to:</p><pre xml:lang="en" class="programlisting" lang="en">amd_flags="-a /.amd_mnt -l syslog /host /etc/amd.map /net /etc/amd.map"</pre><p xml:lang="en" lang="en">The default options with which exports are mounted are
	defined in <code class="filename">/etc/amd.map</code>.  Some of the
	more advanced features of <span class="application">amd</span> are
	defined in <code class="filename">/etc/amd.conf</code>.</p><p xml:lang="en" lang="en">Consult <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=amd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">amd</span>(8)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=amd.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">amd.conf</span>(5)</span></a> for more
	information.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-autofs"></a>29.3.5. 使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> 自動掛載</h3></div></div></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> automount facility is supported
	  starting with FreeBSD 10.1-RELEASE.  To use the
	  automounter functionality in older versions of FreeBSD, use
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=amd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">amd</span>(8)</span></a> instead.  This chapter only describes the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> automounter.</p></div><a id="idp83792952" class="indexterm"></a><a id="idp83793592" class="indexterm"></a><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> facility is a common name for several
	components that, together, allow for automatic mounting of
	remote and local filesystems whenever a file or directory
	within that file system is accessed.  It consists of the
	kernel component, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a>, and several userspace
	applications: <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automount</span>(8)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automountd</span>(8)</span></a> and
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autounmountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autounmountd</span>(8)</span></a>.  It serves as an alternative for
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=amd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">amd</span>(8)</span></a> from previous FreeBSD releases.  Amd is still
	provided for backward compatibility purposes, as the two use
	different map format; the one used by autofs is the same as
	with other SVR4 automounters, such as the ones in Solaris,
	MacOS X, and Linux.</p><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> virtual filesystem is mounted on
	specified mountpoints by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automount</span>(8)</span></a>, usually invoked
	during boot.</p><p xml:lang="en" lang="en">Whenever a process attempts to access file within the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> mountpoint, the kernel will notify
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automountd</span>(8)</span></a> daemon and pause the triggering process.
	The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automountd</span>(8)</span></a> daemon will handle kernel requests by
	finding the proper map and mounting the filesystem according
	to it, then signal the kernel to release blocked process.  The
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autounmountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autounmountd</span>(8)</span></a> daemon automatically unmounts automounted
	filesystems after some time, unless they are still being
	used.</p><p xml:lang="en" lang="en">The primary autofs configuration file is
	<code class="filename">/etc/auto_master</code>.  It assigns individual
	maps to top-level mounts.  For an explanation of
	<code class="filename">auto_master</code> and the map syntax, refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=auto_master&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">auto_master</span>(5)</span></a>.</p><p xml:lang="en" lang="en">There is a special automounter map mounted on
	<code class="filename">/net</code>.  When a file is accessed within
	this directory, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> looks up the corresponding
	remote mount and automatically mounts it.  For instance, an
	attempt to access a file within
	<code class="filename">/net/foobar/usr</code> would tell
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automountd</span>(8)</span></a> to mount the <code class="filename">/usr</code> export from the host
	<code class="systemitem">foobar</code>.</p><div class="example"><a id="idp83819320"></a><div class="example-title">範例 29.3. 使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> 掛載 Export</div><div class="example-contents"><p xml:lang="en" lang="en">In this example, <code class="command">showmount -e</code> shows
	  the exported file systems that can be mounted from the
	  <acronym class="acronym">NFS</acronym> server,
	  <code class="systemitem">foobar</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>showmount -e foobar</code></strong>
Exports list on foobar:
/usr                               10.10.10.0
/a                                 10.10.10.0
<code class="prompt">%</code> <strong class="userinput"><code>cd /net/foobar/usr</code></strong></pre></div></div><br class="example-break" /><p xml:lang="en" lang="en">The output from <code class="command">showmount</code> shows
	<code class="filename">/usr</code> as an export.
	When changing directories to <code class="filename">/host/foobar/usr</code>,
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automountd</span>(8)</span></a> intercepts the request and attempts to
	resolve the hostname <code class="systemitem">foobar</code>.  If successful,
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automountd</span>(8)</span></a> automatically mounts the source
	export.</p><p xml:lang="en" lang="en">To enable <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> at boot time, add this line to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">autofs_enable="YES"</pre><p xml:lang="en" lang="en">Then <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> can be started by running:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service automount start</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service automountd start</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service autounmountd start</code></strong></pre><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> map format is the same as in other
	operating systems.  Information about this format from other
	sources can be useful, like the <a class="link" href="http://web.archive.org/web/20160813071113/http://images.apple.com/business/docs/Autofs.pdf" target="_top">Mac
	  OS X document</a>.</p><p xml:lang="en" lang="en">Consult the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automount</span>(8)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automountd</span>(8)</span></a>,
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autounmountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autounmountd</span>(8)</span></a>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=auto_master&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">auto_master</span>(5)</span></a> manual pages for
	more information.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-nis"></a>29.4. 網路資訊系統 (<acronym class="acronym">NIS</acronym>)</h2></div></div></div><a id="idp83857720" class="indexterm"></a><a id="idp83858360" class="indexterm"></a><a id="idp83859000" class="indexterm"></a><a id="idp83871928" class="indexterm"></a><a id="idp83872568" class="indexterm"></a><a id="idp83873208" class="indexterm"></a><a id="idp83873848" class="indexterm"></a><a id="idp83874488" class="indexterm"></a><p xml:lang="en" lang="en">Network Information System (<acronym class="acronym">NIS</acronym>) is
      designed to centralize administration of <span class="trademark">UNIX</span>®-like systems
      such as <span class="trademark">Solaris</span>™, HP-UX, <span class="trademark">AIX</span>®, Linux, NetBSD, OpenBSD, and
      FreeBSD.  <acronym class="acronym">NIS</acronym> was originally known as Yellow
      Pages but the name was changed due to trademark issues.   This
      is the reason why <acronym class="acronym">NIS</acronym> commands begin with
      <code class="literal">yp</code>.</p><a id="idp83883448" class="indexterm"></a><p xml:lang="en" lang="en"><acronym class="acronym">NIS</acronym> is a Remote Procedure Call
      (<acronym class="acronym">RPC</acronym>)-based client/server system that allows
      a group of machines within an <acronym class="acronym">NIS</acronym> domain to
      share a common set of configuration files.  This permits a
      system administrator to set up <acronym class="acronym">NIS</acronym> client
      systems with only minimal configuration data and to add, remove,
      or modify configuration data from a single location.</p><p xml:lang="en" lang="en">FreeBSD uses version 2 of the <acronym class="acronym">NIS</acronym>
      protocol.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp83887672"></a>29.4.1. <acronym class="acronym">NIS</acronym> 術語與程序</h3></div></div></div><p xml:lang="en" lang="en">Table 28.1 summarizes the terms and important processes
	used by <acronym class="acronym">NIS</acronym>:</p><a id="idp83889464" class="indexterm"></a><a id="idp83890488" class="indexterm"></a><div class="table"><a id="idp83891512"></a><div class="table-title">表格 29.1. <acronym class="acronym">NIS</acronym> 術語</div><div class="table-contents"><table summary="NIS 術語" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>術語</th><th>說明</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><acronym class="acronym">NIS</acronym> domain name</td><td xml:lang="en" lang="en"><acronym class="acronym">NIS</acronym> servers and clients share
		an <acronym class="acronym">NIS</acronym> domain name.  Typically,
		this name does not have anything to do with
		<acronym class="acronym">DNS</acronym>.</td></tr><tr><td xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rpcbind&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rpcbind</span>(8)</span></a></td><td xml:lang="en" lang="en">This service enables <acronym class="acronym">RPC</acronym> and
		must be running in order to run an
		<acronym class="acronym">NIS</acronym> server or act as an
		<acronym class="acronym">NIS</acronym> client.</td></tr><tr><td xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypbind&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypbind</span>(8)</span></a></td><td xml:lang="en" lang="en">This service binds an <acronym class="acronym">NIS</acronym>
		client to its <acronym class="acronym">NIS</acronym> server.  It will
		take the <acronym class="acronym">NIS</acronym> domain name and use
		<acronym class="acronym">RPC</acronym> to connect to the server.  It
		is the core of client/server communication in an
		<acronym class="acronym">NIS</acronym> environment.  If this service
		is not running on a client machine, it will not be
		able to access the <acronym class="acronym">NIS</acronym>
		server.</td></tr><tr><td xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a></td><td xml:lang="en" lang="en">This is the process for the
		<acronym class="acronym">NIS</acronym> server.  If this service stops
		running, the server will no longer be able to respond
		to <acronym class="acronym">NIS</acronym> requests so hopefully, there
		is a slave server to take over.  Some non-FreeBSD clients
		will not try to reconnect using a slave server and the
		<span class="application">ypbind</span> process may need to
		be restarted on these
		clients.</td></tr><tr><td xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rpc.yppasswdd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rpc.yppasswdd</span>(8)</span></a></td><td xml:lang="en" lang="en">This process only runs on
		<acronym class="acronym">NIS</acronym> master servers.  This daemon
		allows <acronym class="acronym">NIS</acronym> clients to change their
		<acronym class="acronym">NIS</acronym> passwords.  If this daemon is
		not running, users will have to login to the
		<acronym class="acronym">NIS</acronym> master server and change their
		passwords there.</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp83921080"></a>29.4.2. 主機類型</h3></div></div></div><a id="idp83921720" class="indexterm"></a><a id="idp83922872" class="indexterm"></a><a id="idp83924024" class="indexterm"></a><p xml:lang="en" lang="en">There are three types of hosts in an
	<acronym class="acronym">NIS</acronym> environment:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><acronym class="acronym">NIS</acronym> master server</p><p xml:lang="en" lang="en">This server acts as a central repository for host
	    configuration information and maintains the
	    authoritative copy of the files used by all of the
	    <acronym class="acronym">NIS</acronym> clients.  The
	    <code class="filename">passwd</code>, <code class="filename">group</code>,
	    and other various files used by <acronym class="acronym">NIS</acronym>
	    clients are stored on the master server.  While it is
	    possible for one machine to be an <acronym class="acronym">NIS</acronym>
	    master server for more than one <acronym class="acronym">NIS</acronym>
	    domain, this type of configuration will not be covered in
	    this chapter as it assumes a relatively small-scale
	    <acronym class="acronym">NIS</acronym> environment.</p></li><li class="listitem"><p xml:lang="en" lang="en"><acronym class="acronym">NIS</acronym> slave servers</p><p xml:lang="en" lang="en"><acronym class="acronym">NIS</acronym> slave servers maintain copies
	    of the <acronym class="acronym">NIS</acronym> master's data files in
	    order to provide redundancy.  Slave servers also help to
	    balance the load of the master server as
	    <acronym class="acronym">NIS</acronym> clients always attach to the
	    <acronym class="acronym">NIS</acronym> server which responds
	    first.</p></li><li class="listitem"><p xml:lang="en" lang="en"><acronym class="acronym">NIS</acronym> clients</p><p xml:lang="en" lang="en"><acronym class="acronym">NIS</acronym> clients authenticate
	    against the <acronym class="acronym">NIS</acronym> server during log
	    on.</p></li></ul></div><p xml:lang="en" lang="en">Information in many files can be shared using
	<acronym class="acronym">NIS</acronym>.  The
	<code class="filename">master.passwd</code>,
	<code class="filename">group</code>, and <code class="filename">hosts</code>
	files are commonly shared via <acronym class="acronym">NIS</acronym>.
	Whenever a process on a client needs information that would
	normally be found in these files locally, it makes a query to
	the <acronym class="acronym">NIS</acronym> server that it is bound to
	instead.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp83955640"></a>29.4.3. 規劃注意事項</h3></div></div></div><p xml:lang="en" lang="en">This section describes a sample <acronym class="acronym">NIS</acronym>
	environment which consists of 15 FreeBSD machines with no
	centralized point of administration.  Each machine has its own
	<code class="filename">/etc/passwd</code> and
	<code class="filename">/etc/master.passwd</code>.  These files are kept
	in sync with each other only through manual intervention.
	Currently, when a user is added to the lab, the process must
	be repeated on all 15 machines.</p><p xml:lang="en" lang="en">The configuration of the lab will be as follows:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th xml:lang="en" lang="en">Machine name</th><th><acronym class="acronym">IP</acronym> 位址</th><th xml:lang="en" lang="en">Machine role</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><code class="systemitem">ellington</code></td><td xml:lang="en" lang="en"><code class="systemitem">10.0.0.2</code></td><td xml:lang="en" lang="en"><acronym class="acronym">NIS</acronym> master</td></tr><tr><td xml:lang="en" lang="en"><code class="systemitem">coltrane</code></td><td xml:lang="en" lang="en"><code class="systemitem">10.0.0.3</code></td><td xml:lang="en" lang="en"><acronym class="acronym">NIS</acronym> slave</td></tr><tr><td xml:lang="en" lang="en"><code class="systemitem">basie</code></td><td xml:lang="en" lang="en"><code class="systemitem">10.0.0.4</code></td><td xml:lang="en" lang="en">Faculty workstation</td></tr><tr><td xml:lang="en" lang="en"><code class="systemitem">bird</code></td><td xml:lang="en" lang="en"><code class="systemitem">10.0.0.5</code></td><td xml:lang="en" lang="en">Client machine</td></tr><tr><td xml:lang="en" lang="en"><code class="systemitem">cli[1-11]</code></td><td xml:lang="en" lang="en">
		<code class="systemitem">10.0.0.[6-17]</code></td><td xml:lang="en" lang="en">Other client machines</td></tr></tbody></table></div><p xml:lang="en" lang="en">If this is the first time an <acronym class="acronym">NIS</acronym>
	scheme is being developed, it should be thoroughly planned
	ahead of time.  Regardless of network size, several decisions
	need to be made as part of the planning process.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp83975608"></a>29.4.3.1. 選擇 <acronym class="acronym">NIS</acronym> 網域名稱</h4></div></div></div><a id="idp83976632" class="indexterm"></a><p xml:lang="en" lang="en">When a client broadcasts its requests for info, it
	  includes the name of the <acronym class="acronym">NIS</acronym> domain that
	  it is part of.  This is how multiple servers on one network
	  can tell which server should answer which request.  Think of
	  the <acronym class="acronym">NIS</acronym> domain name as the name for a
	  group of hosts.</p><p xml:lang="en" lang="en">Some organizations choose to use their Internet domain
	  name for their <acronym class="acronym">NIS</acronym> domain name.  This is
	  not recommended as it can cause confusion when trying to
	  debug network problems.  The <acronym class="acronym">NIS</acronym> domain
	  name should be unique within the network and it is helpful
	  if it describes the group of machines it represents.  For
	  example, the Art department at Acme Inc. might be in the
	  <span class="quote">“<span class="quote">acme-art</span>”</span> <acronym class="acronym">NIS</acronym> domain.  This
	  example will use the domain name
	  <code class="literal">test-domain</code>.</p><p xml:lang="en" lang="en">However, some non-FreeBSD operating systems require the
	  <acronym class="acronym">NIS</acronym> domain name to be the same as the
	  Internet domain name.  If one or more machines on the
	  network have this restriction, the Internet domain name
	  <span class="emphasis"><em>must</em></span> be used as the
	  <acronym class="acronym">NIS</acronym> domain name.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp83999928"></a>29.4.3.2. 實體伺服器需求</h4></div></div></div><p xml:lang="en" lang="en">There are several things to keep in mind when choosing a
	  machine to use as a <acronym class="acronym">NIS</acronym> server.  Since
	  <acronym class="acronym">NIS</acronym> clients depend upon the availability
	  of the server, choose a machine that is not rebooted
	  frequently.  The <acronym class="acronym">NIS</acronym> server should
	  ideally be a stand alone machine whose sole purpose is to be
	  an <acronym class="acronym">NIS</acronym> server.  If the network is not
	  heavily used, it is acceptable to put the
	  <acronym class="acronym">NIS</acronym> server on a machine running other
	  services.  However, if the <acronym class="acronym">NIS</acronym> server
	  becomes unavailable, it will adversely affect all
	  <acronym class="acronym">NIS</acronym> clients.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84004152"></a>29.4.4. 設定 <acronym class="acronym">NIS</acronym> Master 伺服器</h3></div></div></div><p xml:lang="en" lang="en">The canonical copies of all <acronym class="acronym">NIS</acronym> files
	are stored on the master server.  The databases used to store
	the information are called <acronym class="acronym">NIS</acronym> maps.  In
	FreeBSD, these maps are stored in
	<code class="filename">/var/yp/[domainname]</code> where
	<code class="filename">[domainname]</code> is the name of the
	<acronym class="acronym">NIS</acronym> domain.  Since multiple domains are
	supported, it is possible to have several directories, one for
	each domain.  Each domain will have its own independent set of
	maps.</p><p xml:lang="en" lang="en"><acronym class="acronym">NIS</acronym> master and slave servers handle all
	<acronym class="acronym">NIS</acronym> requests through <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a>.  This
	daemon is responsible for receiving incoming requests from
	<acronym class="acronym">NIS</acronym> clients, translating the requested
	domain and map name to a path to the corresponding database
	file, and transmitting data from the database back to the
	client.</p><a id="idp84009912" class="indexterm"></a><p xml:lang="en" lang="en">Setting up a master <acronym class="acronym">NIS</acronym> server can be
	relatively straight forward, depending on environmental needs.
	Since FreeBSD provides built-in <acronym class="acronym">NIS</acronym> support,
	it only needs to be enabled by adding the following lines to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">nisdomainname="test-domain"	<a id="network-nis-co-domainname"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
nis_server_enable="YES"		<a id="network-nis-co-server"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
nis_yppasswdd_enable="YES"	<a id="network-nis-co-yppasswdd"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#network-nis-co-domainname"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">This line sets the <acronym class="acronym">NIS</acronym> domain name
	    to <code class="literal">test-domain</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#network-nis-co-server"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">This automates the start up of the
	    <acronym class="acronym">NIS</acronym> server processes when the system
	    boots.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#network-nis-co-yppasswdd"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">This enables the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rpc.yppasswdd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rpc.yppasswdd</span>(8)</span></a> daemon so that
	    users can change their <acronym class="acronym">NIS</acronym> password
	    from a client machine.</p></td></tr></table></div><p xml:lang="en" lang="en">Care must be taken in a multi-server domain where the
	server machines are also <acronym class="acronym">NIS</acronym> clients.  It
	is generally a good idea to force the servers to bind to
	themselves rather than allowing them to broadcast bind
	requests and possibly become bound to each other.  Strange
	failure modes can result if one server goes down and others
	are dependent upon it.  Eventually, all the clients will time
	out and attempt to bind to other servers, but the delay
	involved can be considerable and the failure mode is still
	present since the servers might bind to each other all over
	again.</p><p xml:lang="en" lang="en">A server that is also a client can be forced to bind to a
	particular server by adding these additional lines to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">nis_client_enable="YES" # run client stuff as well
nis_client_flags="-S <em class="replaceable"><code>NIS domain</code></em>,<em class="replaceable"><code>server</code></em>"</pre><p xml:lang="en" lang="en">After saving the edits, type
	<code class="command">/etc/netstart</code> to restart the network and
	apply the values defined in <code class="filename">/etc/rc.conf</code>.
	Before initializing the <acronym class="acronym">NIS</acronym> maps, start
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service ypserv start</code></strong></pre><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84030904"></a>29.4.4.1. 初始化 <acronym class="acronym">NIS</acronym> 對應表</h4></div></div></div><a id="idp84048312" class="indexterm"></a><p xml:lang="en" lang="en"><acronym class="acronym">NIS</acronym> maps are generated from the
	  configuration files in <code class="filename">/etc</code> on the
	  <acronym class="acronym">NIS</acronym> master, with one exception:
	  <code class="filename">/etc/master.passwd</code>.  This is to prevent
	  the propagation of passwords to all the servers in the
	  <acronym class="acronym">NIS</acronym> domain.  Therefore, before the
	  <acronym class="acronym">NIS</acronym> maps are initialized, configure the
	  primary password files:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cp /etc/master.passwd /var/yp/master.passwd</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /var/yp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>vi master.passwd</code></strong></pre><p xml:lang="en" lang="en">It is advisable to remove all entries for system
	  accounts as well as any user accounts that do not need to be
	  propagated to the <acronym class="acronym">NIS</acronym> clients, such as
	  the <code class="systemitem">root</code> and any
	  other administrative accounts.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Ensure that the
	    <code class="filename">/var/yp/master.passwd</code> is neither
	    group or world readable by setting its permissions to
	    <code class="literal">600</code>.</p></div><p xml:lang="en" lang="en">After completing this task, initialize the
	  <acronym class="acronym">NIS</acronym> maps.  FreeBSD includes the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypinit&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypinit</span>(8)</span></a> script to do this.  When generating maps
	  for the master server, include <code class="option">-m</code> and
	  specify the <acronym class="acronym">NIS</acronym> domain name:</p><pre xml:lang="en" class="screen" lang="en">ellington<code class="prompt">#</code> <strong class="userinput"><code>ypinit -m test-domain</code></strong>
Server Type: MASTER Domain: test-domain
Creating an YP server will require that you answer a few questions.
Questions will all be asked at the beginning of the procedure.
Do you want this procedure to quit on non-fatal errors? [y/n: n] <strong class="userinput"><code>n</code></strong>
Ok, please remember to go back and redo manually whatever fails.
If not, something might not work.
At this point, we have to construct a list of this domains YP servers.
rod.darktech.org is already known as master server.
Please continue to add any slave servers, one per line. When you are
done with the list, type a &lt;control D&gt;.
master server   :  ellington
next host to add:  <strong class="userinput"><code>coltrane</code></strong>
next host to add:  <strong class="userinput"><code>^D</code></strong>
The current list of NIS servers looks like this:
ellington
coltrane
Is this correct?  [y/n: y] <strong class="userinput"><code>y</code></strong>

[..output from map generation..]

NIS Map update completed.
ellington has been setup as an YP master server without any errors.</pre><p xml:lang="en" lang="en">This will create <code class="filename">/var/yp/Makefile</code>
	  from <code class="filename">/var/yp/Makefile.dist</code>.  By
	  default, this file assumes that the environment has a
	  single <acronym class="acronym">NIS</acronym> server with only FreeBSD clients.
	  Since <code class="literal">test-domain</code> has a slave server,
	  edit this line in <code class="filename">/var/yp/Makefile</code> so
	  that it begins with a  comment
	  (<code class="literal">#</code>):</p><pre xml:lang="en" class="programlisting" lang="en">NOPUSH = "True"</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84066616"></a>29.4.4.2. 新增使用者</h4></div></div></div><p xml:lang="en" lang="en">Every time a new user is created, the user account must
	  be added to the master <acronym class="acronym">NIS</acronym> server and the
	  <acronym class="acronym">NIS</acronym> maps rebuilt.  Until this occurs, the
	  new user will not be able to login anywhere except on the
	  <acronym class="acronym">NIS</acronym> master.  For example, to add the new
	  user <code class="systemitem">jsmith</code> to the
	  <code class="literal">test-domain</code> domain, run these commands on
	  the master server:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pw useradd jsmith</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /var/yp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make test-domain</code></strong></pre><p xml:lang="en" lang="en">The user could also be added using <code class="command">adduser
	    jsmith</code> instead of <code class="command">pw useradd
	    smith</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84086200"></a>29.4.5. 設定 <acronym class="acronym">NIS</acronym> Slave 伺服器</h3></div></div></div><a id="idp84087224" class="indexterm"></a><p xml:lang="en" lang="en">To set up an <acronym class="acronym">NIS</acronym> slave server, log on
	to the slave server and edit <code class="filename">/etc/rc.conf</code>
	as for the master server.  Do not generate any
	<acronym class="acronym">NIS</acronym> maps, as these already exist on the
	master server.  When running <code class="command">ypinit</code> on the
	slave server, use <code class="option">-s</code> (for slave) instead of
	<code class="option">-m</code> (for master).  This option requires the
	name of the <acronym class="acronym">NIS</acronym> master in addition to the
	domain name, as  seen in this example:</p><pre xml:lang="en" class="screen" lang="en">coltrane<code class="prompt">#</code> <strong class="userinput"><code>ypinit -s ellington test-domain</code></strong>

Server Type: SLAVE Domain: test-domain Master: ellington

Creating an YP server will require that you answer a few questions.
Questions will all be asked at the beginning of the procedure.

Do you want this procedure to quit on non-fatal errors? [y/n: n]  <strong class="userinput"><code>n</code></strong>

Ok, please remember to go back and redo manually whatever fails.
If not, something might not work.
There will be no further questions. The remainder of the procedure
should take a few minutes, to copy the databases from ellington.
Transferring netgroup...
ypxfr: Exiting: Map successfully transferred
Transferring netgroup.byuser...
ypxfr: Exiting: Map successfully transferred
Transferring netgroup.byhost...
ypxfr: Exiting: Map successfully transferred
Transferring master.passwd.byuid...
ypxfr: Exiting: Map successfully transferred
Transferring passwd.byuid...
ypxfr: Exiting: Map successfully transferred
Transferring passwd.byname...
ypxfr: Exiting: Map successfully transferred
Transferring group.bygid...
ypxfr: Exiting: Map successfully transferred
Transferring group.byname...
ypxfr: Exiting: Map successfully transferred
Transferring services.byname...
ypxfr: Exiting: Map successfully transferred
Transferring rpc.bynumber...
ypxfr: Exiting: Map successfully transferred
Transferring rpc.byname...
ypxfr: Exiting: Map successfully transferred
Transferring protocols.byname...
ypxfr: Exiting: Map successfully transferred
Transferring master.passwd.byname...
ypxfr: Exiting: Map successfully transferred
Transferring networks.byname...
ypxfr: Exiting: Map successfully transferred
Transferring networks.byaddr...
ypxfr: Exiting: Map successfully transferred
Transferring netid.byname...
ypxfr: Exiting: Map successfully transferred
Transferring hosts.byaddr...
ypxfr: Exiting: Map successfully transferred
Transferring protocols.bynumber...
ypxfr: Exiting: Map successfully transferred
Transferring ypservers...
ypxfr: Exiting: Map successfully transferred
Transferring hosts.byname...
ypxfr: Exiting: Map successfully transferred

coltrane has been setup as an YP slave server without any errors.
Remember to update map ypservers on ellington.</pre><p xml:lang="en" lang="en">This will generate a directory on the slave server called
	<code class="filename">/var/yp/test-domain</code> which contains copies
	of the <acronym class="acronym">NIS</acronym> master server's maps.  Adding
	these <code class="filename">/etc/crontab</code> entries on each slave
	server will force the slaves to sync their maps with the maps
	on the master server:</p><pre xml:lang="en" class="programlisting" lang="en">20      *       *       *       *       root   /usr/libexec/ypxfr passwd.byname
21      *       *       *       *       root   /usr/libexec/ypxfr passwd.byuid</pre><p xml:lang="en" lang="en">These entries are not mandatory because the master server
	automatically attempts to push any map changes to its slaves.
	However, since clients may depend upon the slave server to
	provide correct password information, it is recommended to
	force frequent password map updates.  This is especially
	important on busy networks where map updates might not always
	complete.</p><p xml:lang="en" lang="en">To finish the configuration, run
	<code class="command">/etc/netstart</code> on the slave server in order
	to start the <acronym class="acronym">NIS</acronym> services.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84109752"></a>29.4.6. 設定 <acronym class="acronym">NIS</acronym> 客戶端</h3></div></div></div><p xml:lang="en" lang="en">An <acronym class="acronym">NIS</acronym> client binds to an
	<acronym class="acronym">NIS</acronym> server using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypbind&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypbind</span>(8)</span></a>.  This
	daemon broadcasts RPC requests on the local network.  These
	requests specify the domain name configured on the client.  If
	an <acronym class="acronym">NIS</acronym> server in the same domain receives
	one of the broadcasts, it will respond to
	<span class="application">ypbind</span>, which will record the
	server's address.  If there are several servers available,
	the client will use the address of the first server to respond
	and will direct all of its <acronym class="acronym">NIS</acronym> requests to
	that server.  The client will automatically
	<span class="application">ping</span> the server on a regular basis
	to make sure it is still available.  If it fails to receive a
	reply within a reasonable amount of time,
	<span class="application">ypbind</span> will mark the domain as
	unbound and begin broadcasting again in the hopes of locating
	another server.</p><a id="idp84114744" class="indexterm"></a><p xml:lang="en" lang="en">To configure a FreeBSD machine to be an
	<acronym class="acronym">NIS</acronym> client:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">Edit <code class="filename">/etc/rc.conf</code> and add the
	    following lines in order to set the
	    <acronym class="acronym">NIS</acronym> domain name and start
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypbind&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypbind</span>(8)</span></a> during network startup:</p><pre xml:lang="en" class="programlisting" lang="en">nisdomainname="test-domain"
nis_client_enable="YES"</pre></li><li class="step"><p xml:lang="en" lang="en">To import all possible password entries from the
	    <acronym class="acronym">NIS</acronym> server, use
	    <code class="command">vipw</code> to remove all user accounts
	    except one from <code class="filename">/etc/master.passwd</code>.
	    When removing the accounts, keep in mind that at least one
	    local account should remain and this account should be a
	    member of <code class="systemitem">wheel</code>.  If there is a
	    problem with <acronym class="acronym">NIS</acronym>, this local account
	    can be used to log in remotely, become the superuser, and
	    fix the problem.  Before saving the edits, add the
	    following line to the end of the file:</p><pre xml:lang="en" class="programlisting" lang="en">+:::::::::</pre><p xml:lang="en" lang="en">This line configures the client to provide anyone with
	    a valid account in the <acronym class="acronym">NIS</acronym> server's
	    password maps an account on the client.  There are many
	    ways to configure the <acronym class="acronym">NIS</acronym> client by
	    modifying this line.  One method is described in <a class="xref" href="#network-netgroups" title="29.4.8. 使用 Netgroups">節 29.4.8, “使用 Netgroups”</a>.  For more detailed
	    reading, refer to the book
	    <code class="literal">Managing NFS and NIS</code>, published by
	    O'Reilly Media.</p></li><li class="step"><p xml:lang="en" lang="en">To import all possible group entries from the
	    <acronym class="acronym">NIS</acronym> server, add this line to
	    <code class="filename">/etc/group</code>:</p><pre xml:lang="en" class="programlisting" lang="en">+:*::</pre></li></ol></div><p xml:lang="en" lang="en">To start the <acronym class="acronym">NIS</acronym> client immediately,
	execute the following commands as the superuser:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>/etc/netstart</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service ypbind start</code></strong></pre><p xml:lang="en" lang="en">After completing these steps, running
	<code class="command">ypcat passwd</code> on the client should show
	the server's <code class="filename">passwd</code> map.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84135992"></a>29.4.7. <acronym class="acronym">NIS</acronym> 安全性</h3></div></div></div><p xml:lang="en" lang="en">Since <acronym class="acronym">RPC</acronym> is a broadcast-based service,
	any system running <span class="application">ypbind</span> within
	the same domain can retrieve the contents of the
	<acronym class="acronym">NIS</acronym> maps.  To prevent unauthorized
	transactions, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a> supports a feature called
	<span class="quote">“<span class="quote">securenets</span>”</span> which can be used to restrict access
	to a given set of hosts.  By default, this information is
	stored in <code class="filename">/var/yp/securenets</code>, unless
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a> is started with <code class="option">-p</code> and an
	alternate path.  This file contains entries that consist of a
	network specification and a network mask separated by white
	space.  Lines starting with <code class="literal">#</code> are
	considered to be comments.  A sample
	<code class="filename">securenets</code> might look like this:</p><pre xml:lang="en" class="programlisting" lang="en"># allow connections from local host -- mandatory
127.0.0.1     255.255.255.255
# allow connections from any host
# on the 192.168.128.0 network
192.168.128.0 255.255.255.0
# allow connections from any host
# between 10.0.0.0 to 10.0.15.255
# this includes the machines in the testlab
10.0.0.0      255.255.240.0</pre><p xml:lang="en" lang="en">If <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a> receives a request from an address that
	matches one of these rules, it will process the request
	normally.  If the address fails to match a rule, the request
	will be ignored and a warning message will be logged.  If the
	<code class="filename">securenets</code> does not exist,
	<code class="command">ypserv</code> will allow connections from any
	host.</p><p xml:lang="en" lang="en"><a class="xref" href="#tcpwrappers" title="13.4. TCP Wrapper">節 13.4, “TCP Wrapper”</a> is an alternate mechanism
	for providing access control instead of
	<code class="filename">securenets</code>.  While either access control
	mechanism adds some security, they are both vulnerable to
	<span class="quote">“<span class="quote"><acronym class="acronym">IP</acronym> spoofing</span>”</span> attacks.  All
	<acronym class="acronym">NIS</acronym>-related traffic should be blocked at
	the firewall.</p><p xml:lang="en" lang="en">Servers using <code class="filename">securenets</code>
	may fail to serve legitimate <acronym class="acronym">NIS</acronym> clients
	with archaic TCP/IP implementations.  Some of these
	implementations set all host bits to zero when doing
	broadcasts or fail to observe the subnet mask when
	calculating the broadcast address.  While some of these
	problems can be fixed by changing the client configuration,
	other problems may force the retirement of these client
	systems or the abandonment of
	<code class="filename">securenets</code>.</p><a id="idp84164792" class="indexterm"></a><p xml:lang="en" lang="en">The use of <span class="application">TCP Wrapper</span>
	increases the latency of the <acronym class="acronym">NIS</acronym> server.
	The additional delay may be long enough to cause timeouts in
	client programs, especially in busy networks with slow
	<acronym class="acronym">NIS</acronym> servers.  If one or more clients suffer
	from latency, convert those clients into
	<acronym class="acronym">NIS</acronym> slave servers and force them to bind to
	themselves.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84167480"></a>29.4.7.1. 阻擋部份使用者</h4></div></div></div><p xml:lang="en" lang="en">In this example, the <code class="systemitem">basie</code>
	  system is a faculty workstation within the
	  <acronym class="acronym">NIS</acronym> domain.  The
	  <code class="filename">passwd</code> map on the master
	  <acronym class="acronym">NIS</acronym> server contains accounts for both
	  faculty and students.  This section demonstrates how to
	  allow faculty logins on this system while refusing student
	  logins.</p><p xml:lang="en" lang="en">To prevent specified users from logging on to a system,
	  even if they are present in the <acronym class="acronym">NIS</acronym>
	  database, use <code class="command">vipw</code> to add
	  <code class="literal">-<em class="replaceable"><code>username</code></em></code> with
	  the correct number of colons towards the end of
	  <code class="filename">/etc/master.passwd</code> on the client,
	  where <em class="replaceable"><code>username</code></em> is the username of
	  a user to bar from logging in.  The line with the blocked
	  user must be before the <code class="literal">+</code> line that
	  allows <acronym class="acronym">NIS</acronym> users.  In this example,
	  <code class="systemitem">bill</code> is barred
	  from logging on to <code class="systemitem">basie</code>:</p><pre xml:lang="en" class="screen" lang="en">basie<code class="prompt">#</code> <strong class="userinput"><code>cat /etc/master.passwd</code></strong>
root:[password]:0:0::0:0:The super-user:/root:/bin/csh
toor:[password]:0:0::0:0:The other super-user:/root:/bin/sh
daemon:*:1:1::0:0:Owner of many system processes:/root:/usr/sbin/nologin
operator:*:2:5::0:0:System &amp;:/:/usr/sbin/nologin
bin:*:3:7::0:0:Binaries Commands and Source,,,:/:/usr/sbin/nologin
tty:*:4:65533::0:0:Tty Sandbox:/:/usr/sbin/nologin
kmem:*:5:65533::0:0:KMem Sandbox:/:/usr/sbin/nologin
games:*:7:13::0:0:Games pseudo-user:/usr/games:/usr/sbin/nologin
news:*:8:8::0:0:News Subsystem:/:/usr/sbin/nologin
man:*:9:9::0:0:Mister Man Pages:/usr/share/man:/usr/sbin/nologin
bind:*:53:53::0:0:Bind Sandbox:/:/usr/sbin/nologin
uucp:*:66:66::0:0:UUCP pseudo-user:/var/spool/uucppublic:/usr/libexec/uucp/uucico
xten:*:67:67::0:0:X-10 daemon:/usr/local/xten:/usr/sbin/nologin
pop:*:68:6::0:0:Post Office Owner:/nonexistent:/usr/sbin/nologin
nobody:*:65534:65534::0:0:Unprivileged user:/nonexistent:/usr/sbin/nologin
-bill:::::::::
+:::::::::

basie<code class="prompt">#</code></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-netgroups"></a>29.4.8. 使用 Netgroups</h3></div></div></div><a id="idp84177336" class="indexterm"></a><p xml:lang="en" lang="en">Barring specified users from logging on to individual
	systems becomes unscaleable on larger networks and quickly
	loses the main benefit of <acronym class="acronym">NIS</acronym>:
	<span class="emphasis"><em>centralized</em></span> administration.</p><p xml:lang="en" lang="en">Netgroups were developed to handle large, complex networks
	with hundreds of users and machines.  Their use is comparable
	to <span class="trademark">UNIX</span>® groups, where the main difference is the lack of a
	numeric ID and the ability to define a netgroup by including
	both user accounts and other netgroups.</p><p xml:lang="en" lang="en">To expand on the example used in this chapter, the
	<acronym class="acronym">NIS</acronym> domain will be extended to add the
	users and systems shown in Tables 28.2 and 28.3:</p><div class="table"><a id="idp84185400"></a><div class="table-title">表格 29.2. 其他使用者</div><div class="table-contents"><table summary="其他使用者" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>使用者名稱</th><th>說明</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><code class="systemitem">alpha</code>,
		<code class="systemitem">beta</code></td><td xml:lang="en" lang="en">IT department employees</td></tr><tr><td xml:lang="en" lang="en"><code class="systemitem">charlie</code>, <code class="systemitem">delta</code></td><td xml:lang="en" lang="en">IT department apprentices</td></tr><tr><td xml:lang="en" lang="en"><code class="systemitem">echo</code>,
		<code class="systemitem">foxtrott</code>,
		<code class="systemitem">golf</code>,
		...</td><td xml:lang="en" lang="en">employees</td></tr><tr><td xml:lang="en" lang="en"><code class="systemitem">able</code>,
		<code class="systemitem">baker</code>,
		...</td><td xml:lang="en" lang="en">interns</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="idp84198328"></a><div class="table-title">表格 29.3. 其他系統</div><div class="table-contents"><table summary="其他系統" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>機器名稱</th><th>說明</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><code class="systemitem">war</code>,
		<code class="systemitem">death</code>,
		<code class="systemitem">famine</code>,
		<code class="systemitem">pollution</code></td><td xml:lang="en" lang="en">Only IT employees are allowed to log onto these
		servers.</td></tr><tr><td xml:lang="en" lang="en"><code class="systemitem">pride</code>,
		<code class="systemitem">greed</code>,
		<code class="systemitem">envy</code>,
		<code class="systemitem">wrath</code>,
		<code class="systemitem">lust</code>,
		<code class="systemitem">sloth</code></td><td xml:lang="en" lang="en">All members of the IT department are allowed to
		login onto these servers.</td></tr><tr><td xml:lang="en" lang="en"><code class="systemitem">one</code>,
		<code class="systemitem">two</code>,
		<code class="systemitem">three</code>,
		<code class="systemitem">four</code>,
		...</td><td xml:lang="en" lang="en">Ordinary workstations used by
		employees.</td></tr><tr><td xml:lang="en" lang="en"><code class="systemitem">trashcan</code></td><td xml:lang="en" lang="en">A very old machine without any critical data.
		Even interns are allowed to use this system.</td></tr></tbody></table></div></div><br class="table-break" /><p xml:lang="en" lang="en">When using netgroups to configure this scenario, each user
	is assigned to one or more netgroups and logins are then
	allowed or forbidden for all members of the netgroup.  When
	adding a new machine, login restrictions must be defined for
	all netgroups.  When a new user is added, the account must be
	added to one or more netgroups.  If the
	<acronym class="acronym">NIS</acronym> setup is planned carefully, only one
	central configuration file needs modification to grant or deny
	access to machines.</p><p xml:lang="en" lang="en">The first step is the initialization of the
	<acronym class="acronym">NIS</acronym> <code class="literal">netgroup</code> map.  In
	FreeBSD, this map is not created by default.  On the
	<acronym class="acronym">NIS</acronym> master server, use an editor to create
	a map named <code class="filename">/var/yp/netgroup</code>.</p><p xml:lang="en" lang="en">This example creates four netgroups to represent IT
	employees, IT apprentices, employees, and interns:</p><pre xml:lang="en" class="programlisting" lang="en">IT_EMP  (,alpha,test-domain)    (,beta,test-domain)
IT_APP  (,charlie,test-domain)  (,delta,test-domain)
USERS   (,echo,test-domain)     (,foxtrott,test-domain) \
        (,golf,test-domain)
INTERNS (,able,test-domain)     (,baker,test-domain)</pre><p xml:lang="en" lang="en">Each entry configures a netgroup.  The first column in an
	entry is the name of the netgroup.  Each set of brackets
	represents  either a group of one or more users or the name of
	another netgroup.  When specifying a user, the three
	comma-delimited fields inside each group represent:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p xml:lang="en" lang="en">The name of the host(s) where the other fields
	    representing the user are valid.  If a hostname is not
	    specified, the entry is valid on all hosts.</p></li><li class="listitem"><p xml:lang="en" lang="en">The name of the account that belongs to this
	    netgroup.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <acronym class="acronym">NIS</acronym> domain for the account.
	    Accounts may be imported from other <acronym class="acronym">NIS</acronym>
	    domains into a netgroup.</p></li></ol></div><p xml:lang="en" lang="en">If a group contains multiple users, separate each user
	with  whitespace.  Additionally, each field may contain
	wildcards.  See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=netgroup&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">netgroup</span>(5)</span></a> for details.</p><a id="idp84255288" class="indexterm"></a><p xml:lang="en" lang="en">Netgroup names longer than 8 characters should not be
	used.  The names are case sensitive and using capital letters
	for netgroup names is an easy way to distinguish between user,
	machine and netgroup names.</p><p xml:lang="en" lang="en">Some non-FreeBSD <acronym class="acronym">NIS</acronym> clients cannot
	handle netgroups containing more than 15 entries.  This
	limit may be circumvented by creating several sub-netgroups
	with 15 users or fewer and a real netgroup consisting of the
	sub-netgroups, as seen in this example:</p><pre xml:lang="en" class="programlisting" lang="en">BIGGRP1  (,joe1,domain)  (,joe2,domain)  (,joe3,domain) [...]
BIGGRP2  (,joe16,domain)  (,joe17,domain) [...]
BIGGRP3  (,joe31,domain)  (,joe32,domain)
BIGGROUP  BIGGRP1 BIGGRP2 BIGGRP3</pre><p xml:lang="en" lang="en">Repeat this process if more than 225 (15 times 15) users
	exist within a single netgroup.</p><p xml:lang="en" lang="en">To activate and distribute the new
	<acronym class="acronym">NIS</acronym> map:</p><pre xml:lang="en" class="screen" lang="en">ellington<code class="prompt">#</code> <strong class="userinput"><code>cd /var/yp</code></strong>
ellington<code class="prompt">#</code> <strong class="userinput"><code>make</code></strong></pre><p xml:lang="en" lang="en">This will generate the three <acronym class="acronym">NIS</acronym> maps
	<code class="filename">netgroup</code>,
	<code class="filename">netgroup.byhost</code> and
	<code class="filename">netgroup.byuser</code>.  Use the map key option
	of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypcat&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypcat</span>(1)</span></a> to check if the new <acronym class="acronym">NIS</acronym>
	maps are available:</p><pre xml:lang="en" class="screen" lang="en">ellington<code class="prompt">%</code> <strong class="userinput"><code>ypcat -k netgroup</code></strong>
ellington<code class="prompt">%</code> <strong class="userinput"><code>ypcat -k netgroup.byhost</code></strong>
ellington<code class="prompt">%</code> <strong class="userinput"><code>ypcat -k netgroup.byuser</code></strong></pre><p xml:lang="en" lang="en">The output of the first command should resemble the
	contents of <code class="filename">/var/yp/netgroup</code>.  The second
	command only produces output if host-specific netgroups were
	created.  The third command is used to get the list of
	netgroups for a user.</p><p xml:lang="en" lang="en">To configure a client, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vipw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vipw</span>(8)</span></a> to specify the
	name  of the netgroup.  For example, on the server named
	<code class="systemitem">war</code>,  replace this line:</p><pre xml:lang="en" class="programlisting" lang="en">+:::::::::</pre><p xml:lang="en" lang="en">with</p><pre xml:lang="en" class="programlisting" lang="en">+@IT_EMP:::::::::</pre><p xml:lang="en" lang="en">This specifies that only the users defined in the netgroup
	<code class="literal">IT_EMP</code> will be imported into this system's
	password database and only those users are allowed to login to
	this system.</p><p xml:lang="en" lang="en">This configuration also applies to the
	<code class="literal">~</code> function of the shell and all routines
	which convert between user names and numerical user IDs.  In
	other words,
	<code class="command">cd ~<em class="replaceable"><code>user</code></em></code> will
	not work, <code class="command">ls -l</code> will show the numerical ID
	instead of the username, and <code class="command">find . -user joe
	  -print</code> will fail with the message
	<span class="errorname">No such user</span>.  To fix this, import all
	user entries without allowing them to login into the servers.
	This can be achieved by adding an extra line:</p><pre xml:lang="en" class="programlisting" lang="en">+:::::::::/usr/sbin/nologin</pre><p xml:lang="en" lang="en">This line configures the client to import all entries but
	to replace the shell in those entries with
	<code class="filename">/usr/sbin/nologin</code>.</p><p xml:lang="en" lang="en">Make sure that extra line is placed
	<span class="emphasis"><em>after</em></span>
	<code class="literal">+@IT_EMP:::::::::</code>.  Otherwise, all user
	accounts imported from <acronym class="acronym">NIS</acronym> will have
	<code class="filename">/usr/sbin/nologin</code> as their login
	shell and no one will be able to login to the system.</p><p xml:lang="en" lang="en">To configure the less important servers, replace the old
	<code class="literal">+:::::::::</code> on the servers with these
	lines:</p><pre xml:lang="en" class="programlisting" lang="en">+@IT_EMP:::::::::
+@IT_APP:::::::::
+:::::::::/usr/sbin/nologin</pre><p xml:lang="en" lang="en">The corresponding lines for the workstations
	would be:</p><pre xml:lang="en" class="programlisting" lang="en">+@IT_EMP:::::::::
+@USERS:::::::::
+:::::::::/usr/sbin/nologin</pre><p xml:lang="en" lang="en">NIS supports the creation of netgroups from other
	netgroups which can be useful if the policy regarding user
	access changes.  One possibility is the creation of role-based
	netgroups.  For example, one might create a netgroup called
	<code class="literal">BIGSRV</code> to define the login restrictions for
	the important servers, another netgroup called
	<code class="literal">SMALLSRV</code> for the less important servers,
	and a third netgroup called <code class="literal">USERBOX</code> for the
	workstations.  Each of these netgroups contains the netgroups
	that are allowed to login onto these machines.  The new
	entries for the <acronym class="acronym">NIS</acronym>
	<code class="literal">netgroup</code> map would look like this:</p><pre xml:lang="en" class="programlisting" lang="en">BIGSRV    IT_EMP  IT_APP
SMALLSRV  IT_EMP  IT_APP  ITINTERN
USERBOX   IT_EMP  ITINTERN USERS</pre><p xml:lang="en" lang="en">This method of defining login restrictions works
	reasonably well when it is possible to define groups of
	machines with identical restrictions.  Unfortunately, this is
	the exception and not the rule.  Most of the time, the ability
	to define login restrictions on a per-machine basis is
	required.</p><p xml:lang="en" lang="en">Machine-specific netgroup definitions are another
	possibility to deal with the policy changes.  In this
	scenario, the <code class="filename">/etc/master.passwd</code> of each
	system contains two lines starting with <span class="quote">“<span class="quote">+</span>”</span>.
	The first line adds a netgroup with the accounts allowed to
	login onto this machine and the second line adds all other
	accounts with <code class="filename">/usr/sbin/nologin</code> as shell.
	It is recommended to use the <span class="quote">“<span class="quote">ALL-CAPS</span>”</span> version
	of the hostname as the name of the netgroup:</p><pre xml:lang="en" class="programlisting" lang="en">+@<em class="replaceable"><code>BOXNAME</code></em>:::::::::
+:::::::::/usr/sbin/nologin</pre><p xml:lang="en" lang="en">Once this task is completed on all the machines, there is
	no longer a need to modify the local versions of
	<code class="filename">/etc/master.passwd</code> ever again.  All
	further changes can be handled by modifying the
	<acronym class="acronym">NIS</acronym> map.  Here is an example of a possible
	<code class="literal">netgroup</code> map for this scenario:</p><pre xml:lang="en" class="programlisting" lang="en"># Define groups of users first
IT_EMP    (,alpha,test-domain)    (,beta,test-domain)
IT_APP    (,charlie,test-domain)  (,delta,test-domain)
DEPT1     (,echo,test-domain)     (,foxtrott,test-domain)
DEPT2     (,golf,test-domain)     (,hotel,test-domain)
DEPT3     (,india,test-domain)    (,juliet,test-domain)
ITINTERN  (,kilo,test-domain)     (,lima,test-domain)
D_INTERNS (,able,test-domain)     (,baker,test-domain)
#
# Now, define some groups based on roles
USERS     DEPT1   DEPT2     DEPT3
BIGSRV    IT_EMP  IT_APP
SMALLSRV  IT_EMP  IT_APP    ITINTERN
USERBOX   IT_EMP  ITINTERN  USERS
#
# And a groups for a special tasks
# Allow echo and golf to access our anti-virus-machine
SECURITY  IT_EMP  (,echo,test-domain)  (,golf,test-domain)
#
# machine-based netgroups
# Our main servers
WAR       BIGSRV
FAMINE    BIGSRV
# User india needs access to this server
POLLUTION  BIGSRV  (,india,test-domain)
#
# This one is really important and needs more access restrictions
DEATH     IT_EMP
#
# The anti-virus-machine mentioned above
ONE       SECURITY
#
# Restrict a machine to a single user
TWO       (,hotel,test-domain)
# [...more groups to follow]</pre><p xml:lang="en" lang="en">It may not always be advisable
	to use machine-based netgroups.  When deploying a couple of
	dozen or hundreds of systems,
	role-based netgroups instead of machine-based netgroups may be
	used to keep the size of the <acronym class="acronym">NIS</acronym> map within
	reasonable limits.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84315448"></a>29.4.9. 密碼格式</h3></div></div></div><a id="idp84316088" class="indexterm"></a><p xml:lang="en" lang="en"><acronym class="acronym">NIS</acronym> requires that all hosts within an
	<acronym class="acronym">NIS</acronym> domain use the same format for
	encrypting passwords.  If users have trouble authenticating on
	an <acronym class="acronym">NIS</acronym> client, it may be due to a differing
	password format.  In a heterogeneous network, the format must
	be supported by all operating systems, where
	<acronym class="acronym">DES</acronym> is the lowest common standard.</p><p xml:lang="en" lang="en">To check which format a server or client is using, look
	at this section of
	<code class="filename">/etc/login.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">default:\
	:passwd_format=des:\
	:copyright=/etc/COPYRIGHT:\
	[Further entries elided]</pre><p xml:lang="en" lang="en">In this example, the system is using the
	<acronym class="acronym">DES</acronym> format.  Other possible values are
	<code class="literal">blf</code> for Blowfish and <code class="literal">md5</code>
	for MD5 encrypted passwords.</p><p xml:lang="en" lang="en">If the format on a host needs to be edited to match the
	one  being used in the <acronym class="acronym">NIS</acronym> domain, the
	login capability database must be rebuilt after saving the
	change:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cap_mkdb /etc/login.conf</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The format of passwords for existing user accounts will
	  not be updated until each user changes their password
	  <span class="emphasis"><em>after</em></span> the login capability database is
	  rebuilt.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-ldap"></a>29.5. 輕量級目錄存取協定 (<acronym class="acronym">LDAP</acronym>)</h2></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div><div><span class="authorgroup">Updates by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Rocky</span> <span class="surname">Hotas</span></span>. </span></div></div></div><a id="idp84336440" class="indexterm"></a><p>輕量級目錄存取協定 (Lightweight Directory Access Protocol, <acronym class="acronym">LDAP</acronym>) 是一個利用分散式目錄資訊服務來做到存取、修改與認証物件的應用層通訊協定，可以想像成是一本可以儲存數個階層、同質資訊的電話簿或記錄簿。它用在 Active Directory 及 <span class="application">OpenLDAP</span> 網路，允許使用者利用一個帳號來存取數個階層的內部資訊，例如：電子郵件認証、取得員工聯絡資訊及內部網站的認証皆可使用 <acronym class="acronym">LDAP</acronym> 伺服器資料庫中的單一使用者帳號來存取。</p><p>本章節將介紹在 FreeBSD 系統上如何快速的設定一個 <acronym class="acronym">LDAP</acronym> 伺服器。本章節假設管理者已做好規劃，這包含：要儲存何種類型的資訊、這些資訊要來做什麼、那些使用者擁有存取這些資訊的權限以及如何確保這些資訊不會被未經授權存取。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84339512"></a>29.5.1. <acronym class="acronym">LDAP</acronym> 術語與結構</h3></div></div></div><p><acronym class="acronym">LDAP</acronym> 使用了數個術語在開始設置之前必須先了解。所有的目錄項目由一群屬性 (<em class="firstterm">attributes</em>) 所組成，每個屬性集皆有一個獨特的辨識碼稱為辨識名稱 (<em class="firstterm">Distinguished Name</em>, <acronym class="acronym">DN</acronym>)，這個辨識碼會由數個其他的屬性，如：常用或相對辨識名稱 (<em class="firstterm">Relative Distinguished Name</em>, <acronym class="acronym">RDN</acronym>) 所組成，這就像目錄有絕對路徑與相對路徑，可以把 <acronym class="acronym">DN</acronym> 當做絕對路徑，<acronym class="acronym">RDN</acronym> 當做相對路徑。</p><p><acronym class="acronym">LDAP</acronym> 項目的例子如下。這個例子會搜尋指定使用者帳號 (<code class="literal">uid</code>)、組織單位 (<code class="literal">ou</code>) 及組織的項目 (<code class="literal">o</code>)：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>ldapsearch -xb "uid=<em class="replaceable"><code>trhodes</code></em>,ou=<em class="replaceable"><code>users</code></em>,o=<em class="replaceable"><code>example.com</code></em>"</code></strong>
# extended LDIF
#
# LDAPv3
# base &lt;uid=trhodes,ou=users,o=example.com&gt; with scope subtree
# filter: (objectclass=*)
# requesting: ALL
#

# trhodes, users, example.com
dn: uid=trhodes,ou=users,o=example.com
mail: trhodes@example.com
cn: Tom Rhodes
uid: trhodes
telephoneNumber: (123) 456-7890

# search result
search: 2
result: 0 Success

# numResponses: 2
# numEntries: 1</pre><p>這個範例項目會顯示 <code class="literal">dn</code>, <code class="literal">mail</code>, <code class="literal">cn</code>, <code class="literal">uid</code> 以及 <code class="literal">telephoneNumber</code> 屬性的數值。而 <acronym class="acronym">cn</acronym> 屬性則是 <acronym class="acronym">RDN</acronym>。</p><p>更多有關 <acronym class="acronym">LDAP</acronym> 以及其術語的資訊可在 <code class="uri"><a class="uri" href="http://www.openldap.org/doc/admin24/intro.html" target="_top">http://www.openldap.org/doc/admin24/intro.html</a></code> 找到。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ldap-config"></a>29.5.2. 設定 <acronym class="acronym">LDAP</acronym> 伺服器</h3></div></div></div><a id="idp84369848" class="indexterm"></a><p xml:lang="en" lang="en">FreeBSD does not provide a built-in <acronym class="acronym">LDAP</acronym>
	server.  Begin the configuration by installing <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/openldap-server/pkg-descr">net/openldap-server</a> package or
	port:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install openldap-server</code></strong></pre><p xml:lang="en" lang="en">There is a large set of default options enabled in the
	<a class="link" href="../../../../doc/en_US.ISO8859-1/articles/linux-users/software.html" target="_top">
	  package</a>.  Review them by running
	<code class="command">pkg info openldap-server</code>.  If they are not
	sufficient (for example if SQL support is needed), please
	consider recompiling the port using the appropriate <a class="link" href="../../../../doc/en_US.ISO8859-1/books/handbook/ports-using.html" target="_top">framework</a>.</p><p>安裝程序會建立目錄 <code class="filename">/var/db/openldap-data</code> 來儲存資料，同時需要建立儲存憑證的目錄：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /usr/local/etc/openldap/private</code></strong></pre><p>下一個階段是設定憑証機構 (Certificate authority)。以下指令必須在 <code class="filename">/usr/local/etc/openldap/private</code> 下執行，這很重要是由於檔案權限須要被限制且其他使用者不應有這些檔案的存取權限，更多有關憑証的詳細資訊以及相關的參數可在 <a class="xref" href="#openssl" title="13.6. OpenSSL">節 13.6, “OpenSSL”</a> 中找到。要建立憑証授權，需先輸人這個指令並依提示作業：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>openssl req -days <em class="replaceable"><code>365</code></em> -nodes -new -x509 -keyout ca.key -out ../ca.crt</code></strong></pre><p>提示輸入的項目<span class="emphasis"><em>除了</em></span>通用名稱 (<code class="literal">Common Name</code>) 外其他是可以一樣的，這個項目必須使用與系統主機名稱 <span class="emphasis"><em>不同</em></span> 的名稱。若這是一個自行簽署的憑証 (Self signed certificate)，則在憑証機構 <code class="literal">CA</code> 的前面加上主機名稱。</p><p>接下來的工作是建立一個憑証簽署的請求及私鑰。請輸入以下指令然後依提示操作：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>openssl req -days <em class="replaceable"><code>365</code></em> -nodes -new -keyout server.key -out server.csr</code></strong></pre><p>在憑証產生程序的過程中請確認 <code class="literal">Common Name</code> 屬性設定正確。Certificate Signing Request 必須經過 Certificate Authority 簽署後才會成為有效的憑証：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>openssl x509 -req -days <em class="replaceable"><code>365</code></em> -in server.csr -out ../server.crt -CA ../ca.crt -CAkey ca.key -CAcreateserial</code></strong></pre><p>在憑証產生程序的最後一步是產生並簽署用戶憑証：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>openssl req -days <em class="replaceable"><code>365</code></em> -nodes -new -keyout client.key -out client.csr</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>openssl x509 -req -days 3650 -in client.csr -out ../client.crt -CA ../ca.crt -CAkey ca.key</code></strong></pre><p>記得當提示時要使用同樣的 <code class="literal">Common Name</code> 屬性。完成之後，請確認執行的指令產生了 8 個新檔案。</p><p xml:lang="en" lang="en">The daemon running the OpenLDAP server is
	<code class="filename">slapd</code>.  Its configuration is performed
	through <code class="filename">slapd.ldif</code>: the old
	<code class="filename">slapd.conf</code> has been deprecated by
	OpenLDAP.</p><p xml:lang="en" lang="en"><a class="link" href="http://www.openldap.org/doc/admin24/slapdconf2.html" target="_top">Configuration
	  examples</a> for <code class="filename">slapd.ldif</code> are
	available and can also be found in
	<code class="filename">/usr/local/etc/openldap/slapd.ldif.sample</code>.
	Options are documented in slapd-config(5).  Each section
	of <code class="filename">slapd.ldif</code>, like all the other LDAP
	attribute sets, is uniquely identified through a DN.  Be sure
	that no blank lines are left between the
	<code class="literal">dn:</code> statement and the desired end of the
	section.  In the following example, TLS will be used to
	implement a secure channel.  The first section represents the
	global configuration:</p><pre xml:lang="en" class="programlisting" lang="en">#
# See slapd-config(5) for details on configuration options.
# This file should NOT be world readable.
#
dn: cn=config
objectClass: olcGlobal
cn: config
#
#
# Define global ACLs to disable default read access.
#
olcArgsFile: /var/run/openldap/slapd.args
olcPidFile: /var/run/openldap/slapd.pid
olcTLSCertificateFile: /usr/local/etc/openldap/server.crt
olcTLSCertificateKeyFile: /usr/local/etc/openldap/private/server.key
olcTLSCACertificateFile: /usr/local/etc/openldap/ca.crt
#olcTLSCipherSuite: HIGH
olcTLSProtocolMin: 3.1
olcTLSVerifyClient: never</pre><p xml:lang="en" lang="en">The Certificate Authority, server certificate and server
	private key files must be specified here.  It is recommended
	to let the clients choose the security cipher and omit option
	<code class="literal">olcTLSCipherSuite</code> (incompatible with TLS
	clients other than <code class="filename">openssl</code>).  Option
	<code class="literal">olcTLSProtocolMin</code> lets the server require a
	minimum security level: it is recommended.  While
	verification is mandatory for the server, it is not for the
	client: <code class="literal">olcTLSVerifyClient: never</code>.</p><p xml:lang="en" lang="en">The second section is about the backend modules and can be
	configured as follows:</p><pre xml:lang="en" class="programlisting" lang="en">#
# Load dynamic backend modules:
#
dn: cn=module,cn=config
objectClass: olcModuleList
cn: module
olcModulepath:	/usr/local/libexec/openldap
olcModuleload:	back_mdb.la
#olcModuleload:	back_bdb.la
#olcModuleload:	back_hdb.la
#olcModuleload:	back_ldap.la
#olcModuleload:	back_passwd.la
#olcModuleload:	back_shell.la</pre><p xml:lang="en" lang="en">The third section is devoted to load the needed
	<code class="literal">ldif</code> schemas to be used by the databases:
	they are essential.</p><pre xml:lang="en" class="programlisting" lang="en">dn: cn=schema,cn=config
objectClass: olcSchemaConfig
cn: schema

include: file:///usr/local/etc/openldap/schema/core.ldif
include: file:///usr/local/etc/openldap/schema/cosine.ldif
include: file:///usr/local/etc/openldap/schema/inetorgperson.ldif
include: file:///usr/local/etc/openldap/schema/nis.ldif</pre><p xml:lang="en" lang="en">Next, the frontend configuration section:</p><pre xml:lang="en" class="programlisting" lang="en"># Frontend settings
#
dn: olcDatabase={-1}frontend,cn=config
objectClass: olcDatabaseConfig
objectClass: olcFrontendConfig
olcDatabase: {-1}frontend
olcAccess: to * by * read
#
# Sample global access control policy:
#	Root DSE: allow anyone to read it
#	Subschema (sub)entry DSE: allow anyone to read it
#	Other DSEs:
#		Allow self write access
#		Allow authenticated users read access
#		Allow anonymous users to authenticate
#
#olcAccess: to dn.base="" by * read
#olcAccess: to dn.base="cn=Subschema" by * read
#olcAccess: to *
#	by self write
#	by users read
#	by anonymous auth
#
# if no access controls are present, the default policy
# allows anyone and everyone to read anything but restricts
# updates to rootdn.  (e.g., "access to * by * read")
#
# rootdn can always read and write EVERYTHING!
#
olcPasswordHash: {SSHA}
# {SSHA} is already the default for olcPasswordHash</pre><p xml:lang="en" lang="en">Another section is devoted to the <span class="emphasis"><em>configuration
	  backend</em></span>, the only way to later access the
	OpenLDAP server configuration is as a global
	super-user.</p><pre xml:lang="en" class="programlisting" lang="en">dn: olcDatabase={0}config,cn=config
objectClass: olcDatabaseConfig
olcDatabase: {0}config
olcAccess: to * by * none
olcRootPW: {SSHA}iae+lrQZILpiUdf16Z9KmDmSwT77Dj4U</pre><p xml:lang="en" lang="en">The default administrator username is
	<code class="literal">cn=config</code>.  Type
	<code class="filename">slappasswd</code> in a shell, choose a password
	and use its hash in <code class="literal">olcRootPW</code>.  If this
	option is not specified now, before
	<code class="filename">slapd.ldif</code> is imported, no one will be
	later able to modify the
	<span class="emphasis"><em>global configuration</em></span> section.</p><p xml:lang="en" lang="en">The last section is about the database backend:</p><pre xml:lang="en" class="programlisting" lang="en">#######################################################################
# LMDB database definitions
#######################################################################
#
dn: olcDatabase=mdb,cn=config
objectClass: olcDatabaseConfig
objectClass: olcMdbConfig
olcDatabase: mdb
olcDbMaxSize: 1073741824
olcSuffix: dc=domain,dc=example
olcRootDN: cn=mdbadmin,dc=domain,dc=example
# Cleartext passwords, especially for the rootdn, should
# be avoided.  See slappasswd(8) and slapd-config(5) for details.
# Use of strong authentication encouraged.
olcRootPW: {SSHA}X2wHvIWDk6G76CQyCMS1vDCvtICWgn0+
# The database directory MUST exist prior to running slapd AND
# should only be accessible by the slapd and slap tools.
# Mode 700 recommended.
olcDbDirectory:	/var/db/openldap-data
# Indices to maintain
olcDbIndex: objectClass eq</pre><p xml:lang="en" lang="en">This database hosts the <span class="emphasis"><em>actual
	  contents</em></span> of the <acronym class="acronym">LDAP</acronym>
	directory.  Types other than <code class="literal">mdb</code> are
	available.  Its super-user, not to be confused with the global
	one, is configured here: a (possibly custom) username in
	<code class="literal">olcRootDN</code> and the password hash in
	<code class="literal">olcRootPW</code>; <code class="filename">slappasswd</code>
	can be used as before.</p><p xml:lang="en" lang="en">This <a class="link" href="http://www.openldap.org/devel/gitweb.cgi?p=openldap.git;a=tree;f=tests/data/regressions/its8444;h=8a5e808e63b0de3d2bdaf2cf34fecca8577ca7fd;hb=HEAD" target="_top">repository</a>
	contains four examples of <code class="filename">slapd.ldif</code>.  To
	convert an existing <code class="filename">slapd.conf</code> into
	<code class="filename">slapd.ldif</code>, refer to <a class="link" href="http://www.openldap.org/doc/admin24/slapdconf2.html" target="_top">this
	  page</a> (please note that this may introduce some
	unuseful options).</p><p xml:lang="en" lang="en">When the configuration is completed,
	<code class="filename">slapd.ldif</code> must be placed in an empty
	directory.  It is recommended to create it as:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /usr/local/etc/openldap/slapd.d/</code></strong></pre><p>匯入設定資料庫：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>/usr/local/sbin/slapadd -n0 -F /usr/local/etc/openldap/slapd.d/ -l /usr/local/etc/openldap/slapd.ldif</code></strong></pre><p xml:lang="en" lang="en">Start the <code class="filename">slapd</code> daemon:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>/usr/local/libexec/slapd -F /usr/local/etc/openldap/slapd.d/</code></strong></pre><p xml:lang="en" lang="en">Option <code class="literal">-d</code> can be used for debugging,
	as specified in slapd(8).  To verify that the server is
	running and working:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ldapsearch -x -b '' -s base '(objectclass=*)' namingContexts</code></strong>
# extended LDIF
#
# LDAPv3
# base &lt;&gt; with scope baseObject
# filter: (objectclass=*)
# requesting: namingContexts
#

#
dn:
namingContexts: dc=domain,dc=example

# search result
search: 2
result: 0 Success

# numResponses: 2
# numEntries: 1</pre><p xml:lang="en" lang="en">The server must still be trusted.  If that has never been
	done before, follow these instructions.  Install the OpenSSL
	package or port:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install openssl</code></strong></pre><p xml:lang="en" lang="en">From the directory where <code class="filename">ca.crt</code> is
	stored (in this example,
	<code class="filename">/usr/local/etc/openldap</code>), run:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>c_rehash .</code></strong></pre><p xml:lang="en" lang="en">Both the CA and the server certificate are now correctly
	recognized in their respective roles.  To verify this, run
	this command from the <code class="filename">server.crt</code>
	directory:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>openssl verify -verbose -CApath . server.crt</code></strong></pre><p xml:lang="en" lang="en">If <code class="filename">slapd</code> was running, restart it.  As
	stated in <code class="filename">/usr/local/etc/rc.d/slapd</code>, to
	properly run <code class="filename">slapd</code> at boot the
	following lines must be added to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">lapd_enable="YES"
slapd_flags='-h "ldapi://%2fvar%2frun%2fopenldap%2fldapi/
ldap://0.0.0.0/"'
slapd_sockets="/var/run/openldap/ldapi"
slapd_cn_config="YES"</pre><p xml:lang="en" lang="en"><code class="filename">slapd</code> does not provide debugging at
	boot.  Check <code class="filename">/var/log/debug.log</code>,
	<code class="filename">dmesg -a</code> and
	<code class="filename">/var/log/messages</code> for this
	purpose.</p><p xml:lang="en" lang="en">The following example adds the group
	<code class="literal">team</code> and the user <code class="literal">john</code>
	to the <code class="systemitem">domain.example</code>
	<acronym class="acronym">LDAP</acronym> database, which is still empty.
	First, create the file
	<code class="filename">domain.ldif</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cat domain.ldif</code></strong>
dn: dc=domain,dc=example
objectClass: dcObject
objectClass: organization
o: domain.example
dc: domain

dn: ou=groups,dc=domain,dc=example
objectClass: top
objectClass: organizationalunit
ou: groups

dn: ou=users,dc=domain,dc=example
objectClass: top
objectClass: organizationalunit
ou: users

dn: cn=team,ou=groups,dc=domain,dc=example
objectClass: top
objectClass: posixGroup
cn: team
gidNumber: 10001

dn: uid=john,ou=users,dc=domain,dc=example
objectClass: top
objectClass: account
objectClass: posixAccount
objectClass: shadowAccount
cn: John McUser
uid: john
uidNumber: 10001
gidNumber: 10001
homeDirectory: /home/john/
loginShell: /usr/bin/bash
userPassword: secret</pre><p xml:lang="en" lang="en">See the OpenLDAP documentation for more details.  Use
	<code class="filename">slappasswd</code> to replace the plain text
	password <code class="literal">secret</code> with a hash in
	<code class="literal">userPassword</code>.  The path specified as
	<code class="literal">loginShell</code> must exist in all the systems
	where <code class="literal">john</code> is allowed to login.  Finally,
	use the <code class="literal">mdb</code> administrator to modify the
	database:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ldapadd -W -D "cn=mdbadmin,dc=domain,dc=example" -f domain.ldif</code></strong></pre><p xml:lang="en" lang="en">Modifications to the <span class="emphasis"><em>global
	  configuration</em></span> section can only be performed by
	the global super-user.  For example, assume that the option
	<code class="literal">olcTLSCipherSuite: HIGH:MEDIUM:SSLv3</code> was
	initially specified and must now be deleted.  First, create a
	file that contains the following:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cat <em class="replaceable"><code>global_mod</code></em></code></strong>
dn: cn=config
changetype: modify
delete: olcTLSCipherSuite</pre><p xml:lang="en" lang="en">Then, apply the modifications:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ldapmodify -f global_mod -x -D "cn=config" -W</code></strong></pre><p xml:lang="en" lang="en">When asked, provide the password chosen in the
	<span class="emphasis"><em>configuration backend</em></span> section.  The
	username is not required: here, <code class="literal">cn=config</code>
	represents the DN of the database section to be modified.
	Alternatively, use <code class="literal">ldapmodify</code> to delete a
	single line of the database, <code class="literal">ldapdelete</code> to
	delete a whole entry.</p><p xml:lang="en" lang="en">If something goes wrong, or if the global super-user
	cannot access the configuration backend, it is possible to
	delete and re-write the whole configuration:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>rm -rf /usr/local/etc/openldap/slapd.d/</code></strong></pre><p xml:lang="en" lang="en"><code class="filename">slapd.ldif</code> can then be edited and
	imported again.  Please, follow this procedure only when no
	other solution is available.</p><p xml:lang="en" lang="en">This is the configuration of the server only.  The same
	machine can also host an LDAP client, with its own separate
	configuration.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-dhcp"></a>29.6. 動態主機設置協定 (<acronym class="acronym">DHCP</acronym>)</h2></div></div></div><a id="idp84490040" class="indexterm"></a><a id="idp84491448" class="indexterm"></a><p>動態主機設置協定 (Dynamic Host Configuration Protocol, <acronym class="acronym">DHCP</acronym>) 可分配必要的位置資訊給一個連線到網路的系統以在該網路通訊。FreeBSD 內含 OpenBSD 版本的 <code class="command">dhclient</code>，可用來做為客戶端來取得位置資訊。FreeBSD 預設並不會安裝 <acronym class="acronym">DHCP</acronym> 伺服器，但在 FreeBSD Port 套件集中有許多可用的伺服器。有關 <acronym class="acronym">DHCP</acronym> 通訊協定的完整說明位於 <a class="link" href="http://www.freesoft.org/CIE/RFC/2131/" target="_top">RFC 2131</a>，相關資源也可至 <a class="link" href="http://www.isc.org/downloads/dhcp/" target="_top">isc.org/downloads/dhcp/</a> 取得。</p><p>本節將介紹如何使用內建的 <acronym class="acronym">DHCP</acronym> 客戶端，接著會介紹如何安裝並設定一個 <acronym class="acronym">DHCP</acronym> 伺服器。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">在 FreeBSD 中，<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a> 裝置同時會被 <acronym class="acronym">DHCP</acronym> 伺服器與 <acronym class="acronym">DHCP</acronym> 客戶端所使用。這個裝置會在 <code class="filename">GENERIC</code> 核心中被引用並隨著 FreeBSD 安裝。想要建立自訂核心的使用者若要使用 <acronym class="acronym">DHCP</acronym> 則須保留這個裝置。</p><p xmlns="http://www.w3.org/1999/xhtml">另外要注意 <code class="filename">bpf</code> 也會讓有權限的使用者在該系統上可執行網路封包監聽程式。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84500408"></a>29.6.1. 設定 <acronym class="acronym">DHCP</acronym> 客戶端</h3></div></div></div><p><acronym class="acronym">DHCP</acronym> 客戶端內含在 FreeBSD 安裝程式當中，這讓在新安裝的系統上設定自動從 <acronym class="acronym">DHCP</acronym> 伺服器接收網路位置資訊變的更簡單。請參考 <a class="xref" href="#bsdinstall-post" title="2.8. 安裝後注意事項">節 2.8, “安裝後注意事項”</a> 取得網路設置的範例。</p><a id="idp84502968" class="indexterm"></a><p>當 <code class="command">dhclient</code> 在客戶端機器上執行時，它便會開始廣播請求取得設置資訊。預設這些請求會使用 <acronym class="acronym">UDP</acronym> 埠號 68。而伺服器則會在 <acronym class="acronym">UDP</acronym> 埠號 67 來回覆，將 <acronym class="acronym">IP</acronym> 位址與其他相關的網路資訊，如：子網路遮罩、預設閘道及 <acronym class="acronym">DNS</acronym> 伺服器位址告訴客戶端，詳細的清單可在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dhcp-options&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dhcp-options</span>(5)</span></a> 找到。</p><p>預設當 FreeBSD 系統開機時，其 <acronym class="acronym">DHCP</acronym> 客戶端會在背景執行或稱非同步 (<em class="firstterm">Asynchronously</em>) 執行，在完成 <acronym class="acronym">DHCP</acronym> 程序的同時其他啟動 Script 會繼續執行，來加速系統啟動。</p><p>背景 <acronym class="acronym">DHCP</acronym> 在 <acronym class="acronym">DHCP</acronym> 伺服器可以快速的回應客戶端請求時可運作的很好。然而 <acronym class="acronym">DHCP</acronym> 在某些系統可能需要較長的時間才能完成，若網路服務嘗試在 <acronym class="acronym">DHCP</acronym> 尚未分配網路位置資訊前執行則會失敗。使用同步 (<em class="firstterm">Synchronous</em>) 模式執行 <acronym class="acronym">DHCP</acronym> 可避免這個問題，因為同步模式會暫停啟動直到 <acronym class="acronym">DHCP</acronym> 已設置完成。</p><p>在 <code class="filename">/etc/rc.conf</code> 中的這行用來設定採用背景 (非同步模式)：</p><pre xml:lang="en" class="programlisting" lang="en">ifconfig_<em class="replaceable"><code>fxp0</code></em>="DHCP"</pre><p>若系統已經在安裝時設定使用 <acronym class="acronym">DHCP</acronym>，這行可能會已存在。替換在例子中的 <em class="replaceable"><code>fxp0</code></em> 為實際要動態設置的網路介面名稱，如 <a class="xref" href="#config-network-setup" title="11.5. 設定網路介面卡">節 11.5, “設定網路介面卡”</a> 中的說明。</p><p>要改設定系統採用同步模式，在啟動時暫停等候 <acronym class="acronym">DHCP</acronym> 完成，使用 <span class="quote">“<span class="quote"><code class="literal">SYNCDHCP</code></span>”</span>：</p><pre xml:lang="en" class="programlisting" lang="en">ifconfig_<em class="replaceable"><code>fxp0</code></em>="SYNCDHCP"</pre><p>尚有其他可用的客戶端選項，請在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> 搜尋 <code class="literal">dhclient</code> 來取得詳細資訊。</p><a id="idp84522680" class="indexterm"></a><p><acronym class="acronym">DHCP</acronym> 客戶端會使用到以下檔案：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><code class="filename">/etc/dhclient.conf</code></p><p><code class="command">dhclient</code> 用到的設定檔。通常這個檔案只會有註解，因為預設便適用大多數客戶端。這個設定檔在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dhclient.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dhclient.conf</span>(5)</span></a> 中有說明。</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="filename">/sbin/dhclient</code></p><p>有關指令本身的更多資訊可於 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dhclient&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dhclient</span>(8)</span></a> 找到。</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="filename">/sbin/dhclient-script</code></p><p>FreeBSD 特定的 <acronym class="acronym">DHCP</acronym> 客戶端設定 Script。在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dhclient-script&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dhclient-script</span>(8)</span></a> 中有說明，但應不須做任何修改便可正常運作。</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="filename">/var/db/dhclient.leases.<em class="replaceable"><code>interface</code></em></code></p><p><acronym class="acronym">DHCP</acronym> 客戶端會在這個檔案中儲存有效租約的資料，寫入的格式類似日誌，在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dhclient.leases&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dhclient.leases</span>(5)</span></a> 有說明。</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-dhcp-server"></a>29.6.2. 安裝並設定 <acronym class="acronym">DHCP</acronym> 伺服器</h3></div></div></div><p>本節將示範如何設定 FreeBSD 系統成為 <acronym class="acronym">DHCP</acronym> 伺服器，使用 Internet Systems Consortium (<acronym class="acronym">ISC</acronym>) 所實作的 <acronym class="acronym">DHCP</acronym> 伺服器，這個伺服器及其文件可使用 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/isc-dhcp43-server/pkg-descr">net/isc-dhcp43-server</a> 套件或 Port 安裝。</p><a id="idp84558648" class="indexterm"></a><a id="idp84560056" class="indexterm"></a><p><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/isc-dhcp43-server/pkg-descr">net/isc-dhcp43-server</a> 的安裝程式會安裝一份範例設定檔，複製 <code class="filename">/usr/local/etc/dhcpd.conf.example</code> 到 <code class="filename">/usr/local/etc/dhcpd.conf</code> 並在這個新檔案做編輯。</p><a id="idp84563000" class="indexterm"></a><p>這個設定檔內容包括了子網路及主機的宣告，用來定義要提供給 <acronym class="acronym">DHCP</acronym> 客戶端的資訊。如以下行設定：</p><pre xml:lang="en" class="programlisting" lang="en">option domain-name "example.org";<a id="domain-name"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
option domain-name-servers ns1.example.org;<a id="domain-name-servers"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
option subnet-mask 255.255.255.0;<a id="subnet-mask"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>

default-lease-time 600;<a id="default-lease-time"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
max-lease-time 72400;<a id="max-lease-time"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
ddns-update-style none;<a id="ddns-update-style"></a><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span>

subnet 10.254.239.0 netmask 255.255.255.224 {
  range 10.254.239.10 10.254.239.20;<a id="range"></a><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span>
  option routers rtr-239-0-1.example.org, rtr-239-0-2.example.org;<a id="routers"></a><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span>
}

host fantasia {
  hardware ethernet 08:00:07:26:c0:a5;<a id="hardware"></a><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span>
  fixed-address fantasia.fugue.com;<a id="fixed-address"></a><span><img src="./imagelib/callouts/10.png" alt="10" border="0" /></span>
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#domain-name"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>這個選項指定了要提供給客戶端的預設搜尋網域。請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=resolv.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">resolv.conf</span>(5)</span></a> 取得更多資訊。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#domain-name-servers"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>這個選項指定了客戶端應使用的 <acronym class="acronym">DNS</acronym> 伺服器清單 (以逗號分隔)。如範例中所示，可使用伺服器的完整網域名稱 (Fully Qualified Domain Names, <acronym class="acronym">FQDN</acronym>) 或伺服器的 <acronym class="acronym">IP</acronym> 位址。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#subnet-mask"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>要提供給客戶端的子網路遮罩。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#default-lease-time"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>預設租約到期時間 (秒)。客戶端可以自行設定覆蓋這個數值。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#max-lease-time"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>一個租約最多允許的時間長度 (秒)。若客戶端請求更長的租約，仍會發出租約，但最多只會在 <code class="literal">max-lease-time</code> 內有效。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ddns-update-style"><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>預設的 <code class="option">none</code> 會關閉動態 DNS 更新。更改此值為 <code class="option">interim</code> 可讓 <acronym class="acronym">DHCP</acronym> 伺服器每當發出一個租約便通知 <acronym class="acronym">DNS</acronym> 伺服器更新，如此一來 <acronym class="acronym">DNS</acronym> 伺服器便知道網路中該電腦的 <acronym class="acronym">IP</acronym> 位址。不要更改此預設值，除非 <acronym class="acronym">DNS</acronym> 伺服器已設定為支援動態 <acronym class="acronym">DNS</acronym>。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#range"><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span></a> </p></td><td valign="top" align="left"><p>此行會建立一個可用 <acronym class="acronym">IP</acronym> 位址的儲存池來保留這些要分配給 <acronym class="acronym">DHCP</acronym> 客戶端的位址。位址範圍必須在前一行所指定的網路或子網路中有效。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#routers"><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span></a> </p></td><td valign="top" align="left"><p>宣告在開始的 <code class="literal">{</code> 括號之前所指定的網路或子網路中有效的預設通訊閘。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#hardware"><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span></a> </p></td><td valign="top" align="left"><p>指定客戶端的硬體 <acronym class="acronym">MAC</acronym> 位址，好讓 <acronym class="acronym">DHCP</acronym> 伺服器在客戶端發出請求時可以辨識客戶端。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#fixed-address"><span><img src="./imagelib/callouts/10.png" alt="10" border="0" /></span></a> </p></td><td valign="top" align="left"><p>指定這個主機應分配相同的 <acronym class="acronym">IP</acronym> 位址。在此處用主機名稱是正確的，由於 <acronym class="acronym">DHCP</acronym> 伺服器會在回傳租約資訊前先解析主機名稱。</p></td></tr></table></div><p>此設定檔還支援其他選項，請參考隨伺服器一併安裝的  dhcpd.conf(5) 來取得詳細資訊與範例。</p><p>完成 <code class="filename">dhcpd.conf</code> 的設定之後，在 <code class="filename">/etc/rc.conf</code> 啟動 <acronym class="acronym">DHCP</acronym> 伺服器：</p><pre xml:lang="en" class="programlisting" lang="en">dhcpd_enable="YES"
dhcpd_ifaces="dc0"</pre><p>替換 <code class="literal">dc0</code> 為 <acronym class="acronym">DHCP</acronym> 伺服器要傾聽 <acronym class="acronym">DHCP</acronym> 客戶端請求的網路介面 (多個介面可以空白分隔)。</p><p>執行以下指令來啟動伺服器：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service isc-dhcpd start</code></strong></pre><p>往後任何對伺服器設定的變更會需要使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=service&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">service</span>(8)</span></a> 中止 <span class="application">dhcpd</span> 服務然後啟動。</p><p><acronym class="acronym">DHCP</acronym> 伺服器會使用到以下檔案。注意，操作手冊會與伺服器軟體一同安裝。</p><a id="idp84603320" class="indexterm"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><code class="filename">/usr/local/sbin/dhcpd</code></p><p>更多有關 <span class="application">dhcpd</span> 伺服器的資訊可在 dhcpd(8) 找到。</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="filename">/usr/local/etc/dhcpd.conf</code></p><p>伺服器設定檔需要含有所有要提供給客戶端的資訊以及有關伺服器運作的資訊。在 dhcpd.conf(5) 有此設定檔的說明。</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="filename">/var/db/dhcpd.leases</code></p><p><acronym class="acronym">DHCP</acronym> 伺服器會儲存一份已發出租約的資料於這個檔案，寫入的格式類似日誌。參考 dhcpd.leases(5) 會有更完整的說明。</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="filename">/usr/local/sbin/dhcrelay</code></p><p>這個 Daemon 會用在更進階的環境中，在一個 <acronym class="acronym">DHCP</acronym> 伺服器要轉發來自客戶端的請求到另一個網路的另一個 <acronym class="acronym">DHCP</acronym> 伺服器的環境。若需要使用此功能，請安裝 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/isc-dhcp43-relay/pkg-descr">net/isc-dhcp43-relay</a> 套件或 Port，安裝會包含 dhcrelay(8)，裡面有提供更詳細的資訊。</p></li></ul></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-dns"></a>29.7. 網域名稱系統 (<acronym class="acronym">DNS</acronym>)</h2></div></div></div><a id="idp84626616" class="indexterm"></a><p>網域名稱系統 (Domain Name System, <acronym class="acronym">DNS</acronym>) 是一種協定用來轉換網域名稱為 <acronym class="acronym">IP</acronym> 位址，反之亦然。<acronym class="acronym">DNS</acronym> 會協調網際網路上有權的根節點 (Authoritative root)、最上層網域 (Top Level Domain, <acronym class="acronym">TLD</acronym>) 及其他小規模名稱伺服器來取得結果，而這些伺服器可管理與快取個自的網域資訊。要在系統上做 <acronym class="acronym">DNS</acronym> 查詢並不需要架設一個名稱伺服器。</p><a id="idp84355128" class="indexterm"></a><a id="idp84355768" class="indexterm"></a><a id="idp84356664" class="indexterm"></a><p>以下表格會說明一些與 <acronym class="acronym">DNS</acronym> 有關的術語：</p><div class="table"><a id="idp84358072"></a><div class="table-title">表格 29.4. <acronym class="acronym">DNS</acronym> 術語</div><div class="table-contents"><table summary="DNS 術語" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>術語</th><th>定義</th></tr></thead><tbody><tr><td>正向 <acronym class="acronym">DNS</acronym> (Forward <acronym class="acronym">DNS</acronym>)</td><td>將主機名稱對應 <acronym class="acronym">IP</acronym> 位址的動作。</td></tr><tr><td>源頭 (Origin)</td><td>代表某個轄區檔案中所涵蓋的網域。</td></tr><tr><td>解析器 (Resolver)</td><td>主機向名稱伺服器查詢轄區資訊的系統程序。</td></tr><tr><td>反向 <acronym class="acronym">DNS</acronym> (Reverse <acronym class="acronym">DNS</acronym>)</td><td>將 <acronym class="acronym">IP</acronym> 對應主機名稱的動作。</td></tr><tr><td>根轄區 (Root zone)</td><td>網際網路轄區階層的最開始，所有的轄區會在根轄區之下，類似在檔案系統中所有的檔案會在根目錄底下。</td></tr><tr><td>轄區 (Zone)</td><td>獨立的網域、子網域或或由相同授權 (Authority) 管理的部分 <acronym class="acronym">DNS</acronym>。</td></tr></tbody></table></div></div><br class="table-break" /><a id="idp84638392" class="indexterm"></a><p>轄區範例：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="systemitem">.</code> 是一般在文件中表達根轄區的方式。</p></li><li class="listitem"><p><code class="systemitem">org.</code> 是一個在根轄區底下的最上層網域 (Top Level Domain , <acronym class="acronym">TLD</acronym>)。</p></li><li class="listitem"><p><code class="systemitem">example.org.</code> 是一個在 <code class="systemitem">org.</code> <acronym class="acronym">TLD</acronym> 底下的轄區。</p></li><li class="listitem"><p><code class="systemitem">1.168.192.in-addr.arpa</code> 是一個轄區用來代表所有在 <code class="systemitem">192.168.1.*</code> <acronym class="acronym">IP</acronym> 位址空間底下的 <acronym class="acronym">IP</acronym> 位址。</p></li></ul></div><p>如您所見，更詳細的主機名稱會加在左方，例如 <code class="systemitem">example.org.</code> 比 <code class="systemitem">org.</code> 更具體，如同 <code class="systemitem">org.</code> 比根轄區更具體，主機名稱每一部份的架構很像檔案系統：<code class="filename">/dev</code> 目錄在根目錄底下，以此類推。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84649144"></a>29.7.1. 要架設名稱伺服器的原因</h3></div></div></div><p>名稱伺服器通常有兩種形式：有權的 (Authoritative) 名稱伺服器與快取 (或稱解析) 名稱伺服器。</p><p>以下情況會需要一台有權的名稱伺服器：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>想要提供 <acronym class="acronym">DNS</acronym> 資訊給全世界，做為官方回覆查詢。</p></li><li class="listitem"><p>已經註冊了一個網域，例如 <code class="systemitem">example.org</code>，且要將 <acronym class="acronym">IP</acronym> 位址分配到主機名稱下。</p></li><li class="listitem"><p>一段 <acronym class="acronym">IP</acronym> 位址範圍需要反向 <acronym class="acronym">DNS</acronym> 項目 (<acronym class="acronym">IP</acronym> 轉主機名稱)。</p></li><li class="listitem"><p>要有一台備援或次要名稱伺服器用來回覆查詢。</p></li></ul></div><p>以下情況會需要一台快取名稱伺服器：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>比起查詢外部的名稱伺服器本地 <acronym class="acronym">DNS</acronym> 伺服器可以快取並更快的回應。</p></li></ul></div><p>當查詢 <code class="systemitem">www.FreeBSD.org</code> 時，解析程式通常會查詢上游 <acronym class="acronym">ISP</acronym> 的名稱伺服器然後接收其回覆，使用本地、快取 <acronym class="acronym">DNS</acronym> 伺服器，只需要由快取 <acronym class="acronym">DNS</acronym> 伺服器對外部做一次查詢，其他的查詢則不需要再向區域網路之外查詢，因為這些資訊已經在本地被快取了。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84689336"></a>29.7.2. <acronym class="acronym">DNS</acronym> 伺服器設定</h3></div></div></div><p><span class="application">Unbound</span> 由 FreeBSD 基礎系統提供，預設只會提供本機的 <acronym class="acronym">DNS</acronym> 解析，雖然基礎系統的套件可被設定提供本機以外的解析服務，但要解決這樣的需求仍建議安裝 FreeBSD Port 套件集中的 <span class="application">Unbound</span>。</p><p>要開啟 <span class="application">Unbound</span> 可加入下行到 <code class="filename">/etc/rc.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">local_unbound_enable="YES"</pre><p>任何已存在於 <code class="filename">/etc/resolv.conf</code> 中的名稱伺服器會在新的 <span class="application">Unbound</span> 設定中被設為追隨者 (Forwarder)。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">若任一個列在清單中的名稱伺服器不支援 <acronym class="acronym">DNSSEC</acronym>，則本地的 <acronym class="acronym">DNS</acronym> 解析便會失敗，請確認有測試每一台名稱伺服器並移除所有測試失敗的項目。以下指令會顯示出信認樹或在 <code class="systemitem">192.168.1.1</code> 上執行失敗的名稱伺服器：</p></div><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>drill -S FreeBSD.org @<em class="replaceable"><code>192.168.1.1</code></em></code></strong></pre><p>確認完每一台名稱伺服器都支援 <acronym class="acronym">DNSSEC</acronym> 後啟動 <span class="application">Unbound</span>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service local_unbound onestart</code></strong></pre><p>這將會更新 <code class="filename">/etc/resolv.conf</code> 來讓查詢已用 <acronym class="acronym">DNSSEC</acronym> 確保安全的網域現在可以運作，例如，執行以下指令來檢驗 FreeBSD.org <acronym class="acronym">DNSSEC</acronym> 信任樹：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>drill -S FreeBSD.org</code></strong>
;; Number of trusted keys: 1
;; Chasing: freebsd.org. A

DNSSEC Trust tree:
freebsd.org. (A)
|---freebsd.org. (DNSKEY keytag: 36786 alg: 8 flags: 256)
    |---freebsd.org. (DNSKEY keytag: 32659 alg: 8 flags: 257)
    |---freebsd.org. (DS keytag: 32659 digest type: 2)
        |---org. (DNSKEY keytag: 49587 alg: 7 flags: 256)
            |---org. (DNSKEY keytag: 9795 alg: 7 flags: 257)
            |---org. (DNSKEY keytag: 21366 alg: 7 flags: 257)
            |---org. (DS keytag: 21366 digest type: 1)
            |   |---. (DNSKEY keytag: 40926 alg: 8 flags: 256)
            |       |---. (DNSKEY keytag: 19036 alg: 8 flags: 257)
            |---org. (DS keytag: 21366 digest type: 2)
                |---. (DNSKEY keytag: 40926 alg: 8 flags: 256)
                    |---. (DNSKEY keytag: 19036 alg: 8 flags: 257)
;; Chase successful</pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-apache"></a>29.8. Apache HTTP 伺服器</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Murray</span> <span class="surname">Stokely</span></span>. </span></div></div></div><a id="idp84714808" class="indexterm"></a><a id="idp84715832" class="indexterm"></a><p>開放源碼的 <span class="application">Apache HTTP Server</span> 是目前最廣泛被使用的網頁伺服器，FreeBSD 預設並不會安裝這個網頁伺服器，但可從 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/apache24/pkg-descr">www/apache24</a> 套件或 Port 安裝。</p><p>本節將會摘要如何設定並啟動在 FreeBSD 上 2.<em class="replaceable"><code>x</code></em> 版的 <span class="application">Apache HTTP Server</span>，要取得有關 <span class="application">Apache</span> 更詳細的資訊及其設定項目請參考 <a class="link" href="http://httpd.apache.org/" target="_top">httpd.apache.org</a>。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84719672"></a>29.8.1. 設定並啟動 Apache</h3></div></div></div><a id="idp84720312" class="indexterm"></a><p>在 FreeBSD 中，主 <span class="application">Apache HTTP Server</span> 設定檔會安裝於 <code class="filename">/usr/local/etc/apache2<em class="replaceable"><code>x</code></em>/httpd.conf</code>，其中 <em class="replaceable"><code>x</code></em> 代表版號，這份 <acronym class="acronym">ASCII</acronym> 文字檔中以 <code class="literal">#</code> 做為行首的是註解，而最常需修改的項目有：</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en"><code class="literal">ServerRoot "/usr/local"</code></span></dt><dd><p>指定該 <span class="application">Apache</span> 的預設安裝路徑，Binary 檔會儲存在伺服器根目錄 (Server root) 下的 <code class="filename">bin</code> 與 <code class="filename">sbin</code> 子目錄，而設定檔會儲存在 <code class="filename">etc/apache2<em class="replaceable"><code>x</code></em></code> 子目錄。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="literal">ServerAdmin you@example.com</code></span></dt><dd><p>更改此項目為您要接收問題回報的電子郵件位址，這個位址也會顯示在一些伺服器產生的頁面上，如：錯誤頁面。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="literal">ServerName
	      www.example.com:80</code></span></dt><dd><p>讓管理者可以設定伺服器要回傳給客戶端的主機名稱 (Hostname)，例如，<code class="systemitem">www</code> 可以更改為實際的主機名稱，若系統並未有註冊的 <acronym class="acronym">DNS</acronym> 名稱，則可改輸入其 <acronym class="acronym">IP</acronym> 位址，若伺服器需要傾聽其他埠號，可更改 <code class="literal">80</code> 為其他埠號。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="literal">DocumentRoot
	    "/usr/local/www/apache2<em class="replaceable"><code>x</code></em>/data"</code></span></dt><dd><p>提供文件的目錄，預設所有的請求均會到此目錄，但可以使用符號連結與別名來指向其他地方。</p></dd></dl></div><p>在對 <span class="application">Apache</span> 設定檔做變更之前，建議先做備份，在 <span class="application">Apache</span> 設定完成之後，儲存讓檔案並使用 <code class="command">apachectl</code> 檢驗設定，執行 <code class="command">apachectl configtest</code> 的結果應回傳 <code class="literal">Syntax OK</code>。</p><a id="idp84758456" class="indexterm"></a><p>要在系統啟動時執行 <span class="application">Apache</span>，可加入下行到 <code class="filename">/etc/rc.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">apache<em class="replaceable"><code>24</code></em>_enable="YES"</pre><p>若 <span class="application">Apache</span> 要使用非預設的選項啟動，可加入下行到 <code class="filename">/etc/rc.conf</code> 來指定所需的旗標參數：</p><pre xml:lang="en" class="programlisting" lang="en">apache<em class="replaceable"><code>24</code></em>_flags=""</pre><p>若 <span class="application">apachectl</span> 未回報設定錯，則可啟動 <code class="command">httpd</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service apache<em class="replaceable"><code>24</code></em> start</code></strong></pre><p><code class="command">httpd</code> 服務可以透過在網頁瀏覽器中輸入 <code class="literal">http://<em class="replaceable"><code>localhost</code></em></code> 來測試，將 <em class="replaceable"><code>localhost</code></em> 更改為執行 <code class="command">httpd</code> 那台主機的完整網域名稱 (Fully-qualified domain name)。預設會顯示的網頁為 <code class="filename">/usr/local/www/apache<em class="replaceable"><code>24</code></em>/data/index.html</code>。</p><p>後續若有在 <code class="command">httpd</code> 執行中時修改 <span class="application">Apache</span> 設定檔可使用以下指令來測試是否有誤：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service apache<em class="replaceable"><code>24</code></em> configtest</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">注意，<code class="literal">configtest</code> 並非採用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> 標準，不應預期其可在所有的啟動 Script 中正常運作。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84790072"></a>29.8.2. 虛擬主機</h3></div></div></div><p>虛擬主機允許在一個 <span class="application">Apache</span> 伺服器執行多個網站，虛擬主機可以是以 IP 為主 (<em class="firstterm">IP-based</em>) 或以名稱為主 (<em class="firstterm">name-based</em>)。以 <acronym class="acronym">IP</acronym> 為主的虛擬主機中的每一個網站要使用不同的 <acronym class="acronym">IP</acronym> 位址。以名稱為主的虛擬主機會使用客戶端的 HTTP/1.1 標頭來判斷主機名稱，這可讓不同的網站共用相同的 <acronym class="acronym">IP</acronym> 位址。</p><p>要設定 <span class="application">Apache</span> 使用以名稱為主的虛擬主機可在每一個網站加入 <code class="literal">VirtualHost</code> 區塊，例如，有一個名稱為 <code class="systemitem">www.domain.tld</code> 的主機擁有一個 <code class="systemitem">www.someotherdomain.tld</code> 的虛擬網域，可加入以下項目到 <code class="filename">httpd.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">&lt;VirtualHost *&gt;
    ServerName <em class="replaceable"><code>www.domain.tld</code></em>
    DocumentRoot <em class="replaceable"><code>/www/domain.tld</code></em>
&lt;/VirtualHost&gt;

&lt;VirtualHost *&gt;
    ServerName <em class="replaceable"><code>www.someotherdomain.tld</code></em>
    DocumentRoot <em class="replaceable"><code>/www/someotherdomain.tld</code></em>
&lt;/VirtualHost&gt;</pre><p>每一個虛擬主機均需更改其 <code class="literal">ServerName</code> 與 <code class="literal">DocumentRoot</code> 的值為實際要使用的值。</p><p>更多有關設定虛擬主機的資訊，可參考 <span class="application">Apache</span> 官方說明文件於：<code class="uri"><a class="uri" href="http://httpd.apache.org/docs/vhosts/" target="_top">http://httpd.apache.org/docs/vhosts/</a></code>。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84804792"></a>29.8.3. Apache 模組</h3></div></div></div><a id="idp84805432" class="indexterm"></a><p><span class="application">Apache</span> 使用模組 (Module) 來擴充伺服器所提供的功能。請參考 <code class="uri"><a class="uri" href="http://httpd.apache.org/docs/current/mod/" target="_top">http://httpd.apache.org/docs/current/mod/</a></code> 來取得可用模組的完整清單與設定詳細資訊。</p><p>在 FreeBSD 中有些模組可以隨著 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/apache24/pkg-descr">www/apache24</a> Port 編譯，只要在 <code class="filename">/usr/ports/www/apache24</code> 輸入 <code class="command">make config</code> 便可查看有那一些模組是預設開啟的，若模組未與 Port 一併編譯，FreeBSD Port 套件集也提供了一個簡單的方式可安裝各種模組，本節將介紹最常使用的三個模組。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84809272"></a>29.8.3.1. <code class="filename">mod_ssl</code></h4></div></div></div><a id="idp84810168" class="indexterm"></a><a id="idp84811448" class="indexterm"></a><a id="idp84812088" class="indexterm"></a><p><code class="filename">mod_ssl</code> 模組利用了 <span class="application">OpenSSL</span> 透過 Secure Sockets Layer (<acronym class="acronym">SSLv3</acronym>) 與 Transport Layer Security (<acronym class="acronym">TLSv1</acronym>) 通訊協定來提供強大的加密，這個模組提供了向受信認的憑証簽署機構申請簽章憑証所需的任何東西，讓 FreeBSD 上能夠執行安全的網頁伺服器。</p><p>在 FreeBSD 中 <code class="filename">mod_ssl</code> 模組預設在套件與 Port 均是開啟的，可用的設定項目在 <code class="uri"><a class="uri" href="http://httpd.apache.org/docs/current/mod/mod_ssl.html" target="_top">http://httpd.apache.org/docs/current/mod/mod_ssl.html</a></code> 會說明。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84815928"></a>29.8.3.2. <code class="filename">mod_perl</code></h4></div></div></div><a id="idp84816824" class="indexterm"></a><p><code class="filename">mod_perl</code> 模組讓您可以使用 <span class="application">Perl</span> 撰寫 <span class="application">Apache</span> 模組，除此之外，嵌入到伺服器的直譯器可避免啟動外部直譯器的額外開銷與 <span class="application">Perl</span> 耗費的啟動時間。</p><p><code class="filename">mod_perl</code> 可以使用 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/mod_perl2/pkg-descr">www/mod_perl2</a> 套件或 Port 安裝，有關使用此模組的說明文件可在 <code class="uri"><a class="uri" href="http://perl.apache.org/docs/2.0/index.html" target="_top">http://perl.apache.org/docs/2.0/index.html</a></code> 中找到。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84837944"></a>29.8.3.3. <code class="filename">mod_php</code></h4></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp84841656" class="indexterm"></a><p><em class="firstterm">PHP: Hypertext Preprocessor</em> (<acronym class="acronym">PHP</acronym>) 是一般用途的腳本 (Script) 語言，特別適用於網站開發，能夠嵌入在 <acronym class="acronym">HTML</acronym> 當中，它的語法參考自 <span class="application">C</span>, <span class="trademark">Java</span>™ 及 <span class="application">Perl</span>，目的在讓網頁開發人員能快速的寫出動態網頁。</p><p>要在 <span class="application">Apache</span> 網頁伺服器上加入對 <acronym class="acronym">PHP</acronym>5 的支援，可安裝 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/mod_php56/pkg-descr">www/mod_php56</a> 套件或 Port，這會安裝並設定支援動態 <acronym class="acronym">PHP</acronym> 應用程式所需的模組。安裝過程會自動加入下行到 <code class="filename">/usr/local/etc/apache2<em class="replaceable"><code>4</code></em>/httpd.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">LoadModule php5_module        libexec/apache24/libphp5.so</pre><p>接著，執行 graceful 重新啟動來載入 <acronym class="acronym">PHP</acronym> 模組：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>apachectl graceful</code></strong></pre><p>由 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/mod_php56/pkg-descr">www/mod_php56</a> 所提供的 <acronym class="acronym">PHP</acronym> 支援是有限的，若需要額外的支援可以使用 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/lang/php56-extensions/pkg-descr">lang/php56-extensions</a> Port 來安裝，該 Port 提供了選單介面來選擇可用的 <acronym class="acronym">PHP</acronym> 擴充套件。</p><p>或者，可以找到適當的 Port 來安裝各別的擴充套件，例如，要增加 <acronym class="acronym">PHP</acronym> 對 <span class="application">MySQL</span> 資料庫伺服器的支援可安裝 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/databases/php56-mysql/pkg-descr">databases/php56-mysql</a>。</p><p>在安裝完擴充套件之後，必須重新載入 <span class="application">Apache</span> 伺服器來使用新的設定值：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>apachectl graceful</code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84876856"></a>29.8.4. 動態網站</h3></div></div></div><a id="idp84877496" class="indexterm"></a><p>除了 <span class="application">mod_perl</span> 與 <span class="application">mod_php</span> 外，也有其他語言可用來建立動態網頁內容，這包含了 <span class="application">Django</span> 與 <span class="application">Ruby on Rails</span>。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84880696"></a>29.8.4.1. Django</h4></div></div></div><a id="idp84881464" class="indexterm"></a><a id="idp84882104" class="indexterm"></a><p><span class="application">Django</span> 是以 BSD 授權的框架 (Framework)，指在讓開發人員能快速的寫出高效、優雅的網頁應用程式。它提供了物件關聯對應器 (Object-relational mapper)，所以各種資料型態可當做 <span class="application">Python</span> 的物件來開發，且提供了豐富的動態資料庫存取 <acronym class="acronym">API</acronym> 給這些物件，讓開發人員不再需要寫 <acronym class="acronym">SQL</acronym>。它也同時提供了可擴充的樣板系統，來讓應用程式的邏輯與 <acronym class="acronym">HTML</acronym> 呈現能夠被拆開。</p><p>Django 需要 <code class="filename">mod_python</code>，以及一個 <acronym class="acronym">SQL</acronym> 資料庫引擎才能運作。在 FreeBSD 中的 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/py-django/pkg-descr">www/py-django</a> Port 會自動安裝 <code class="filename">mod_python</code> 以及對 <span class="application">PostgreSQL</span>, <span class="application">MySQL</span> 或 <span class="application">SQLite</span> 資料庫的支援，預設為 <span class="application">SQLite</span>，要更改資料庫引擎可在 <code class="filename">/usr/ports/www/py-django</code> 輸入 <code class="command">make config</code> 然後再安裝該 Port。</p><p><span class="application">Django</span> 安裝完成之後，應用程式會需要一個專案目錄並搭配 <span class="application">Apache</span> 設定才能使用內嵌的 <span class="application">Python</span> 直譯器，此直譯器會用來呼叫網站上指定 <acronym class="acronym">URL</acronym> 的應用程式。</p><p>要設定 <span class="application">Apache</span> 傳遞某個 <acronym class="acronym">URL</acronym> 請求到網站應用程式，可加入下行到 <code class="filename">httpd.conf</code> 來指定專案目錄的完整路徑：</p><pre xml:lang="en" class="programlisting" lang="en">&lt;Location "/"&gt;
    SetHandler python-program
    PythonPath "['<em class="replaceable"><code>/dir/to/the/django/packages/</code></em>'] + sys.path"
    PythonHandler django.core.handlers.modpython
    SetEnv DJANGO_SETTINGS_MODULE mysite.settings
    PythonAutoReload On
    PythonDebug On
&lt;/Location&gt;</pre><p>請參考 <code class="uri"><a class="uri" href="https://docs.djangoproject.com" target="_top">https://docs.djangoproject.com</a></code> 來取得如何使用 <span class="application">Django</span> 的更多資訊。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84894904"></a>29.8.4.2. Ruby on Rails</h4></div></div></div><a id="idp84895672" class="indexterm"></a><p><span class="application">Ruby on Rails</span> 是另外一套開放源碼的網站框架 (Framework)，提供了完整的開發堆疊，這使得網頁開發人員可以更有生產力且能夠快速的寫出強大的應用程式，在 FreeBSD 它可以使用 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/rubygem-rails/pkg-descr">www/rubygem-rails</a> 套件或 Port 安裝。</p><p>請參考 <code class="uri"><a class="uri" href="http://guides.rubyonrails.org" target="_top">http://guides.rubyonrails.org</a></code> 來取得更多有關如何使用 <span class="application">Ruby on Rails</span> 的資訊。</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-ftp"></a>29.9. 檔案傳輸協定 (<acronym class="acronym">FTP</acronym>)</h2></div></div></div><a id="idp84900408" class="indexterm"></a><p>檔案傳輸協定 (File Transfer Protocol, <acronym class="acronym">FTP</acronym>) 提供了使用一個簡單的方式能夠將檔案傳輸到與接收自 <acronym class="acronym">FTP</acronym> 伺服器，FreeBSD 內建了 <acronym class="acronym">FTP</acronym> 伺服器軟體 <span class="application">ftpd</span> 在基礎系統 (Base system) 中。</p><p>FreeBSD 提供了多個設定檔來控制對 <acronym class="acronym">FTP</acronym> 伺服器的存取，本節將摘要這些檔案的設定方式，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ftpd</span>(8)</span></a> 來取得更多有關內建 <acronym class="acronym">FTP</acronym> 伺服器的詳細資訊。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84905144"></a>29.9.1. 設定</h3></div></div></div><p>最重要的一個設定步驟便是決定那些帳號能夠存取 <acronym class="acronym">FTP</acronym> 伺服器，FreeBSD 系統有數個系統帳號，這些帳號不應該能夠擁有 <acronym class="acronym">FTP</acronym> 存取權，不允許存取 <acronym class="acronym">FTP</acronym> 的使用者清單可在 <code class="filename">/etc/ftpusers</code> 找到，預設該檔案內會有所有的系統帳號，其他不應允許存取 <acronym class="acronym">FTP</acronym> 的使用者也可在此加入。</p><p>在某些情況可能會布望限制某些使用者的存取，而不是完全避免這些使用者使用 <acronym class="acronym">FTP</acronym>，這可以透過建立 <code class="filename">/etc/ftpchroot</code> 來完成，詳如 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ftpchroot&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ftpchroot</span>(5)</span></a> 所述，這個檔案會列出受到 <acronym class="acronym">FTP</acronym> 存取限制的使用者與群組。</p><a id="idp84914488" class="indexterm"></a><p>要在伺服器上開啟匿名 <acronym class="acronym">FTP</acronym> 存取權，可在 FreeBSD 系統上建立一個名稱為 <code class="systemitem">ftp</code> 使用者，使用者將能夠使用 <code class="systemitem">ftp</code> 或 <code class="systemitem">anonymous</code> 使用者名稱來登入 <acronym class="acronym">FTP</acronym> 伺服器，當提示輸入密碼時，輸入任何值都會被接受，但是慣例上應使用電子郵件位址來當做密碼。當匿名使用者登入時 <acronym class="acronym">FTP</acronym> 伺服器會呼叫 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chroot&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chroot</span>(2)</span></a> 來限制使用者只能存取 <code class="systemitem">ftp</code> 使用者的家目錄。</p><p>要設定顯示給 <acronym class="acronym">FTP</acronym> 客戶端的歡迎訊息有兩個文字檔可以建立，<code class="filename">/etc/ftpwelcome</code> 的內容會在收到登入提示前顯示給使用者看，登入成功能後，則會顯示 <code class="filename">/etc/ftpmotd</code> 的內容。注意，這個檔案的路徑是相對於登入環境的，所以 <code class="filename">~ftp/etc/ftpmotd</code> 的內容只會對匿名使用者顯示。</p><p>設定完 <acronym class="acronym">FTP</acronym> 伺服器之後，在 <code class="filename">/etc/rc.conf</code> 設定適當的變數來在開機時啟動該服務：</p><pre xml:lang="en" class="programlisting" lang="en">ftpd_enable="YES"</pre><p>要立即啟動服務可：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service ftpd start</code></strong></pre><p>要測試到 <acronym class="acronym">FTP</acronym> 伺服器的連線可輸入：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>ftp localhost</code></strong></pre><a id="idp84947768" class="indexterm"></a><a id="idp84948408" class="indexterm"></a><p><span class="application">ftpd</span> daemon 會使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslog&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslog</span>(3)</span></a> 來記錄訊息，預設，系統記錄 Daemon 會寫入有關 <acronym class="acronym">FTP</acronym> 的訊息到 <code class="filename">/var/log/xferlog</code>，<acronym class="acronym">FTP</acronym> 記錄的位置可以透過更改 <code class="filename">/etc/syslog.conf</code> 中下行來做修改：</p><pre xml:lang="en" class="programlisting" lang="en">ftp.info      /var/log/xferlog</pre><a id="idp84957112" class="indexterm"></a><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">要注意啟動匿名 <acronym class="acronym">FTP</acronym> 伺服器可能的潛藏問題，尤其是要讓匿名使用者上傳檔案時要再次確認，因為這可能讓該 <acronym class="acronym">FTP</acronym> 站變成用來交換未授權商業軟體的交流平台或者更糟的狀況。若真的需要匿名 <acronym class="acronym">FTP</acronym> 上傳，那麼請檢查權限設定，讓這些檔案在尚未被管理者審查前不能夠被其他匿名使用者讀取。</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-samba"></a>29.10. <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 用戶端檔案與列印服務 (Samba)</h2></div></div></div><a id="idp84962616" class="indexterm"></a><a id="idp84963256" class="indexterm"></a><a id="idp84963896" class="indexterm"></a><a id="idp84965176" class="indexterm"></a><p><span class="application">Samba</span> 是熱門的開放源碼軟體套件，使用 <acronym class="acronym">SMB/CIFS</acronym> 通訊協定提供檔案與列印服務，此通訊協定內建於 <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 系統，在非 <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 的系統可透過安裝 <span class="application">Samba</span> 客戶端程式庫來支援此協定。此通訊協定讓客戶端可以存取共享的資料與印表機，這些共享的資源可掛載到一個本機的磁碟機，而共享的印表機則可以當做本機的印表機使用。</p><p>在 FreeBSD 上，可以使用 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/samba48/pkg-descr">net/samba48</a> Port 或套件來安裝 <span class="application">Samba</span> 客戶端程式庫，這個客戶端提供了讓 FreeBSD 系統能存取 <acronym class="acronym">SMB/CIFS</acronym> 在 <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 網路中共享的資源。</p><p>FreeBSD 系統也可以透過安裝 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/samba48/pkg-descr">net/samba48</a> Port 或套件來設定成 <span class="application">Samba</span> 伺服器，這讓管理者可以在 FreeBSD 系統上建立 <acronym class="acronym">SMB</acronym>/<acronym class="acronym">CIFS</acronym> 的共享資源，讓執行 <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 或 <span class="application">Samba</span> 客戶端程式庫的客戶端能夠存取。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84980024"></a>29.10.1. 伺服器設定</h3></div></div></div><p><span class="application">Samba</span> 的設定位於 <code class="filename">/usr/local/etc/smb4.conf</code>，必須先設定這個檔案才可使用 <span class="application">Samba</span>。</p><p>要共享目錄與印表機給在工作群組中的 <span class="trademark">Windows</span>® 客戶端的簡易 <code class="filename">smb4.conf</code> 範例如下。對於涉及 LDAP 或 Active Directory 的複雜安裝，可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=samba-tool&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">samba-tool</span>(8)</span></a> 來建立初始的 <code class="filename">smb4.conf</code>。</p><pre xml:lang="en" class="programlisting" lang="en">[global]
workgroup = WORKGROUP
server string = Samba Server Version %v
netbios name = ExampleMachine
wins support = Yes
security = user
passdb backend = tdbsam

# Example: share /usr/src accessible only to 'developer' user
[src]
path = /usr/src
valid users = developer
writable  = yes
browsable = yes
read only = no
guest ok = no
public = no
create mask = 0666
directory mask = 0755</pre><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84997304"></a>29.10.1.1. 全域設定</h4></div></div></div><p>在 <code class="filename">/usr/local/etc/smb4.conf</code> 中加入用來描述網路環境的設定有：</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en"><code class="literal">workgroup</code></span></dt><dd><p>要提供的工作群組名稱。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="literal">netbios name</code></span></dt><dd><p><span class="application">Samba</span> 伺服器已知的 NetBIOS 名稱，預設為主機的 <acronym class="acronym">DNS</acronym> 名稱第一節。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="literal">server string</code></span></dt><dd><p>會顯示於 <code class="command">net view</code> 輸出結果以及其他會尋找伺服器描述文字並顯示的網路工具的文字。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="literal">wins support</code></span></dt><dd><p>不論 <span class="application">Samba</span> 是否要作為 <acronym class="acronym">WINS</acronym> 伺服器，請不要在網路上開啟超過一台伺服器的 <acronym class="acronym">WINS</acronym> 功能。</p></dd></dl></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85025080"></a>29.10.1.2. 安全性設定</h4></div></div></div><p>在 <code class="filename">/usr/local/etc/smb4.conf</code> 中最重要的設定便是安全性模式以及後端密碼格式，以下項目管控的選項有：</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en"><code class="literal">security</code></span></dt><dd><p>最常見的設定為 <code class="literal">security = share</code> 以及 <code class="literal">security = user</code>，若客戶端使用的使用者名稱與在 FreeBSD 主機上使用的使用者名稱相同，則應該使用使用者 (user) 層級的安全性，這是預設的安全性原則且它會要求客戶端在存取共享資源前先登入。</p><p>安全性為共享 (share) 層級時，客戶端存取共享資源不需要先使用有效的使用者名稱與密碼登入伺服器，在是在舊版 <span class="application">Samba</span> 所採用的預設安全性模式。</p></dd><dt><span xml:lang="en" class="term" lang="en"><code class="literal">passdb backend</code></span></dt><dd><a id="idp85031224" class="indexterm"></a><a id="idp85031864" class="indexterm"></a><a id="idp85032504" class="indexterm"></a><p><span class="application">Samba</span> 支援數種不同的後端認証模式，客戶端可以使用 LDAP, NIS+, SQL 資料庫或修改過的密碼檔來認証，建議的認証方式是 <code class="literal">tdbsam</code>，適用於簡易的網路環境且在此處說明，對於較大或更複雜的網路則較建議使用 <code class="literal">ldapsam</code>，而 <code class="literal">smbpasswd</code> 是舊版的預設值，現在已廢棄不使用。</p></dd></dl></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85035448"></a>29.10.1.3. <span class="application">Samba</span> 使用者</h4></div></div></div><p>FreeBSD 使用者帳號必須對應 <code class="literal">SambaSAMAccount</code> 資料庫， 才能讓 <span class="trademark">Windows</span>® 客戶端存取共享資源，要對應既有的 FreeBSD 使用者帳號可使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pdbedit&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pdbedit</span>(8)</span></a>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pdbedit -a <em class="replaceable"><code>username</code></em></code></strong></pre><p>本節只會提到一些最常用的設定，請參考 <a class="link" href="http://www.samba.org/samba/docs/man/Samba-HOWTO-Collection/" target="_top">官方 Samba HOWTO</a> 來取得有關可用設定選項的額外資訊。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85044920"></a>29.10.2. 啟動 <span class="application">Samba</span></h3></div></div></div><p>要在開機時啟動 <span class="application">Samba</span>，可加入下行到 <code class="filename">/etc/rc.conf</code>：</p><pre xml:lang="en" class="programlisting" lang="en">samba_server_enable="YES"</pre><p>要立即啟動 <span class="application">Samba</span>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service samba_server start</code></strong>
Performing sanity check on Samba configuration: OK
Starting nmbd.
Starting smbd.</pre><p><span class="application">Samba</span> 由三個獨立的 Daemon 所組成，<span class="application">nmbd</span> 與 <span class="application">smbd</span> daemon 可透過 <code class="varname">samba_enable</code> 來啟動，若同時也需要 winbind 名稱解析服務則需額外設定：</p><pre xml:lang="en" class="programlisting" lang="en">winbindd_enable="YES"</pre><p><span class="application">Samba</span> 可以隨時停止，要停止可輸入：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service samba_server stop</code></strong></pre><p><span class="application">Samba</span> 是一套擁有能整合 <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 網路功能的複雜軟體套件，除了在此處說明的基礎設定，要取得更多的功能資訊，請參考 <code class="uri"><a class="uri" href="http://www.samba.org" target="_top">http://www.samba.org</a></code>。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-ntp"></a>29.11. NTP 時間校對</h2></div></div></div><a id="idp85056824" class="indexterm"></a><p>隨著使用時間，電腦的時鐘會逐漸偏移，這對需要網路上電腦有相同準確度時間的許多網路服務來說是一個大問題。準確的時間同樣能確保檔案時間戳記的一致性。網路時間協定 (Network Time Protocol, <acronym class="acronym">NTP</acronym>) 是一種在網路上可以確保時間準確的方式。</p><p>FreeBSD 內含 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> 可設定來查詢其他 <acronym class="acronym">NTP</acronym> 伺服器來同步電腦的時間或提供時間服務給其他在網路上的電腦。</p><p>本節將會介紹如何設定 FreeBSD 上的 <span class="application">ntpd</span>，更進一步的說明文件可於 <code class="filename">/usr/share/doc/ntp/</code> 找到 HTML 格式的版本。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85065656"></a>29.11.1. <acronym class="acronym">NTP</acronym> 設定</h3></div></div></div><a id="idp85066552" class="indexterm"></a><p>在 FreeBSD，內建的 <span class="application">ntpd</span> 可用來同步系統的時間，<span class="application">Ntpd</span> 要使用 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> 中的變數以及下一節會詳細說明的 <code class="filename">/etc/ntp.conf</code> 來設定。</p><p xml:lang="en" lang="en"><span class="application">Ntpd</span> communicates with its network
        peers using UDP packets.  Any firewalls between your machine and
	its NTP peers must be configured to allow UDP packets in and out
	on port 123.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85070136"></a>29.11.1.1. <code class="filename">/etc/ntp.conf</code> 檔</h4></div></div></div><a id="idp85071032" class="indexterm"></a><p xml:lang="en" lang="en"><span class="application">Ntpd</span> reads
	  <code class="filename">/etc/ntp.conf</code>
	  to determine which <acronym class="acronym">NTP</acronym> servers to query.
	  Choosing several <acronym class="acronym">NTP</acronym> servers is recommended
	    in case one of the servers becomes unreachable or its clock proves
	    unreliable.  As <span class="application">ntpd</span> receives responses,
	    it favors reliable servers over the less reliable ones.  The servers
	    which are queried can be local to the network, provided by an
	    <acronym class="acronym">ISP</acronym>, or selected from an <a class="link" href="http://support.ntp.org/bin/view/Servers/WebHome" target="_top">
	      online list of publicly accessible <acronym class="acronym">NTP</acronym>
	      servers</a>.
	    When choosing a public <acronym class="acronym">NTP</acronym> server, select one
	    that is geographically close and review its usage policy.  The
	    <code class="literal">pool</code> configuration keyword selects one or more
	    servers from a pool of servers.  An <a class="link" href="http://support.ntp.org/bin/view/Servers/NTPPoolServers" target="_top">
	      online list of publicly accessible <acronym class="acronym">NTP</acronym>
	      pools</a>
	    is available, organized by geographic area.  In addition, FreeBSD
	    provides a project-sponsored pool,
	    <code class="literal">0.freebsd.pool.ntp.org</code>.</p><div class="example"><a id="idp85090360"></a><div class="example-title">範例 29.4. <code class="filename">/etc/ntp.conf</code> 範例</div><div class="example-contents"><p xml:lang="en" lang="en">This is a simple example of an <code class="filename">ntp.conf</code>
	    file.  It can safely be used as-is; it contains the recommended
	    <code class="literal">restrict</code> options for operation on a
	    publicly-accessible network connection.</p><pre xml:lang="en" class="programlisting" lang="en">
# Disallow ntpq control/query access.  Allow peers to be added only
# based on pool and server statements in this file.
restrict default limited kod nomodify notrap noquery nopeer
restrict source  limited kod nomodify notrap noquery

# Allow unrestricted access from localhost for queries and control.
restrict 127.0.0.1
restrict ::1

# Add a specific server.
server ntplocal.example.com iburst

# Add FreeBSD pool servers until 3-6 good servers are available.
tos minclock 3 maxclock 6
pool 0.freebsd.pool.ntp.org iburst

# Use a local leap-seconds file.
leapfile "/var/db/ntpd.leap-seconds.list"</pre></div></div><br class="example-break" /><p>這個檔案的格式在 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ntp.conf</span>(5)</span></a> 有詳細說明，以下的說明僅快速的帶過以上範例檔有用到的一些關鍵字。</p><p xml:lang="en" lang="en">By default, an <acronym class="acronym">NTP</acronym> server is accessible
	  to any network host.  The <code class="literal">restrict</code> keyword
	  controls which systems can access the server.  Multiple
	  <code class="literal">restrict</code> entries are supported, each one
	  refining the restrictions given in previous statements.  The
	  values shown in the example grant the local system full query
	  and control access, while allowing remote systems only the
	  ability to query the time.  For more details, refer to the
	  <code class="literal">Access Control Support</code> subsection of
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ntp.conf</span>(5)</span></a>.</p><p xml:lang="en" lang="en">The <code class="literal">server</code> keyword specifies a single
	  server to query.  The file can contain multiple server keywords,
	  with one server listed on each line.  The <code class="literal">pool</code>
	  keyword specifies a pool of servers.
	  <span class="application">Ntpd</span> will add one or more
	  servers from this pool as needed to reach the number of peers
	  specified using the <code class="literal">tos minclock</code> value.  The
	  <code class="literal">iburst</code> keyword directs
	  <span class="application">ntpd</span> to perform a burst of eight quick
	  packet exchanges with a server when contact is first established,
	  to help quickly synchronize system time.</p><p xml:lang="en" lang="en">The <code class="literal">leapfile</code> keyword specifies the location
	  of a file containing information about leap seconds.  The file is
	  updated automatically by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">periodic</span>(8)</span></a>.  The file location
	  specified by this keyword must match the location set in the
	  <code class="literal">ntp_db_leapfile</code> variable in
	  <code class="filename">/etc/rc.conf</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85106488"></a>29.11.1.2. 在 <code class="filename">/etc/rc.conf</code> 中的 NTP 設定項目</h4></div></div></div><a id="idp85107512" class="indexterm"></a><p>設定 <code class="literal">ntpd_enable="YES"</code> 可讓開機時會啟動 <span class="application">ntpd</span>。將 <code class="literal">ntpd_enable=YES</code> 加到 <code class="filename">/etc/rc.conf</code> 之後，可輸入以下指令讓 <span class="application">ntpd</span> 不需重新開機立即啟動：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service ntpd start</code></strong></pre><p xml:lang="en" lang="en">Only <code class="literal">ntpd_enable</code> must be set to use ntpd.
	The <code class="filename">rc.conf</code> variables listed below may also be
	set as needed.</p><p xml:lang="en" lang="en">Set <code class="literal">ntpd_sync_on_start=YES</code> to allow
	  <span class="application">ntpd</span> to step the clock any amount, one
	  time at startup.  Normally <span class="application">ntpd</span> will
	  log an error message and exit if the clock is off by more than
	  1000 seconds.  This option is especially useful on systems without
	  a battery-backed realtime clock.</p><p xml:lang="en" lang="en">Set <code class="literal">ntpd_oomprotect=YES</code> to protect the
	  <span class="application">ntpd</span> daemon from being killed by
	  the system attempting to recover from an Out Of Memory
	  (<acronym class="acronym">OOM</acronym>) condition.</p><p xml:lang="en" lang="en">Set <code class="literal">ntpd_config=</code> to the location of
	  an alternate <code class="filename">ntp.conf</code> file.</p><p xml:lang="en" lang="en">Set <code class="literal">ntpd_flags=</code> to contain any other
	  <span class="application">ntpd</span> flags as needed, but avoid using
	  these flags which are managed internally by
	  <code class="filename">/etc/rc.d/ntpd</code>:
	  </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">
	      <code class="literal">-p</code> (pid file location)</p></li><li class="listitem"><p xml:lang="en" lang="en">
	      <code class="literal">-c</code> (set <code class="literal">ntpd_config=</code>
	      instead)</p></li></ul></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85130424"></a>29.11.1.3. <span class="application">Ntpd</span> 與無權限的 <code class="literal">ntpd</code> 使用者</h4></div></div></div><p xml:lang="en" lang="en"><span class="application">Ntpd</span> on FreeBSD can start and
	  run as an unpriveleged user.  Doing so requires the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_ntpd&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_ntpd</span>(4)</span></a> policy module.  The
	  <code class="filename">/etc/rc.d/ntpd</code> startup script first
	  examines the NTP configuration.  If possible, it loads the
	  <code class="literal">mac_ntpd</code> module, then starts
	  <span class="application">ntpd</span> as unpriveleged user
	  <code class="literal">ntpd</code> (user id 123).
	  To avoid problems with file and directory access, the startup
	  script will not automatically start
	  <span class="application">ntpd</span> as <code class="literal">ntpd</code>
	  when the configuration contains any file-related options.</p><p xml:lang="en" lang="en">The presence of any of the following in
	  <code class="literal">ntpd_flags</code> requires manual configuration
	  as described below to run as the <code class="literal">ntpd</code> user:
	  </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">-f or --driftfile</p></li><li class="listitem"><p xml:lang="en" lang="en">-i or --jaildir</p></li><li class="listitem"><p xml:lang="en" lang="en">-k or --keyfile</p></li><li class="listitem"><p xml:lang="en" lang="en">-l or --logfile</p></li><li class="listitem"><p xml:lang="en" lang="en">-s or --statsdir</p></li></ul></div><p xml:lang="en" lang="en">The presence of any of the following keywords in
	  <code class="filename">ntp.conf</code> requires manual configuration
	  as described below to run as the <code class="literal">ntpd</code> user:
	  </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">crypto</p></li><li class="listitem"><p xml:lang="en" lang="en">driftfile</p></li><li class="listitem"><p xml:lang="en" lang="en">key</p></li><li class="listitem"><p xml:lang="en" lang="en">logdir</p></li><li class="listitem"><p xml:lang="en" lang="en">statsdir</p></li></ul></div><p xml:lang="en" lang="en">To manually configure <span class="application">ntpd</span>
	  to run as user <code class="literal">ntpd</code> you must:
	  </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: none; "><li class="listitem" style="list-style-type: none"><p xml:lang="en" lang="en">Ensure that the <code class="literal">ntpd</code>
	      user has access to all the files and directories specified
	      in the configuration.</p></li><li class="listitem" style="list-style-type: none"><p xml:lang="en" lang="en">Arrange for the <code class="literal">mac_ntpd</code>
	      module to be loaded or compiled into the kernel.  See
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_ntpd&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_ntpd</span>(4)</span></a> for details.</p></li><li class="listitem" style="list-style-type: none"><p xml:lang="en" lang="en">Set <code class="literal">ntpd_user="ntpd"</code> in
	      <code class="filename">/etc/rc.conf</code></p></li></ul></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85163832"></a>29.11.2. 在 <acronym class="acronym">PPP</acronym> 連線使用 <acronym class="acronym">NTP</acronym></h3></div></div></div><p><span class="application">ntpd</span> 並不需要永久的網際網路連線才能正常運作，若有一個 <acronym class="acronym">PPP</acronym> 連線是設定成需要時撥號，那麼便需要避免 <acronym class="acronym">NTP</acronym> 的流量觸發撥號或是保持連線不中斷，這可在 <code class="filename">/etc/ppp/ppp.conf</code> 使用 <code class="literal">filter</code> 項目設定，例如：</p><pre xml:lang="en" class="programlisting" lang="en">set filter dial 0 deny udp src eq 123
# Prevent NTP traffic from initiating dial out
set filter dial 1 permit 0 0
set filter alive 0 deny udp src eq 123
# Prevent incoming NTP traffic from keeping the connection open
set filter alive 1 deny udp dst eq 123
# Prevent outgoing NTP traffic from keeping the connection open
set filter alive 2 permit 0/0 0/0</pre><p>要取得更詳細的資訊，請參考於 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> 的 <code class="literal">PACKET FILTERING</code> 小節以及在 <code class="filename">/usr/share/examples/ppp/</code> 中的範例。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">部份網際網路存取提供商會封鎖較小編號的埠，這會讓 NTP 無法運作，因為回應永遠無到傳送到該主機。</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-iscsi"></a>29.12. <acronym class="acronym">iSCSI</acronym> Initiator 與 Target 設定</h2></div></div></div><p xml:lang="en" lang="en"><acronym class="acronym">iSCSI</acronym> is a way to share storage over a
      network.  Unlike <acronym class="acronym">NFS</acronym>, which works at the file
      system level, <acronym class="acronym">iSCSI</acronym> works at the block device
      level.</p><p xml:lang="en" lang="en">In <acronym class="acronym">iSCSI</acronym> terminology, the system that
      shares the storage is known as the <span class="emphasis"><em>target</em></span>.
      The storage can be a physical disk, or an area representing
      multiple disks or a portion of a physical disk.  For example, if
      the disk(s) are formatted with <acronym class="acronym">ZFS</acronym>, a zvol
      can be created to use as the <acronym class="acronym">iSCSI</acronym>
      storage.</p><p xml:lang="en" lang="en">The clients which access the <acronym class="acronym">iSCSI</acronym>
      storage are called <span class="emphasis"><em>initiators</em></span>.  To
      initiators, the storage available through
      <acronym class="acronym">iSCSI</acronym> appears as a raw, unformatted disk
      known as a <acronym class="acronym">LUN</acronym>.  Device nodes for the disk
      appear in <code class="filename">/dev/</code> and the device must be
      separately formatted and mounted.</p><p xml:lang="en" lang="en">FreeBSD provides a native,
      kernel-based <acronym class="acronym">iSCSI</acronym> target and initiator.
      This section describes how to configure a FreeBSD system as a
      target or an initiator.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-iscsi-target"></a>29.12.1. 設定 <acronym class="acronym">iSCSI</acronym> Target</h3></div></div></div><p xml:lang="en" lang="en">To configure an <acronym class="acronym">iSCSI</acronym> target, create
	the <code class="filename">/etc/ctl.conf</code> configuration file, add
	a line to <code class="filename">/etc/rc.conf</code> to make sure the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> daemon is automatically started at boot, and then
	start the daemon.</p><p xml:lang="en" lang="en">The following is an example of a simple
	<code class="filename">/etc/ctl.conf</code> configuration file.  Refer
	to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctl.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctl.conf</span>(5)</span></a> for a more complete description of this
	file's available options.</p><pre xml:lang="en" class="programlisting" lang="en">portal-group pg0 {
	discovery-auth-group no-authentication
	listen 0.0.0.0
	listen [::]
}

target iqn.2012-06.com.example:target0 {
	auth-group no-authentication
	portal-group pg0

	lun 0 {
		path /data/target0-0
		size 4G
	}
}</pre><p xml:lang="en" lang="en">The first entry defines the <code class="literal">pg0</code> portal
	group.  Portal groups define which network addresses the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> daemon will listen on.  The
	<code class="literal">discovery-auth-group no-authentication</code>
	entry indicates that any initiator is allowed to perform
	<acronym class="acronym">iSCSI</acronym> target discovery without
	authentication.  Lines three and four configure <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a>
	to listen on all <acronym class="acronym">IPv4</acronym>
	(<code class="literal">listen 0.0.0.0</code>) and
	<acronym class="acronym">IPv6</acronym> (<code class="literal">listen [::]</code>)
	addresses on the default port of 3260.</p><p xml:lang="en" lang="en">It is not necessary to define a portal group as there is a
	built-in portal group called <code class="literal">default</code>.  In
	this case, the difference between <code class="literal">default</code>
	and <code class="literal">pg0</code> is that with
	<code class="literal">default</code>, target discovery is always denied,
	while with <code class="literal">pg0</code>, it is always
	allowed.</p><p xml:lang="en" lang="en">The second entry defines a single target.  Target has two
	possible meanings: a machine serving <acronym class="acronym">iSCSI</acronym>
	or a named group of <acronym class="acronym">LUNs</acronym>.  This example
	uses the latter meaning, where
	<code class="literal">iqn.2012-06.com.example:target0</code> is the
	target name.  This target name is suitable for testing
	purposes.  For actual use, change
	<code class="literal">com.example</code> to the real domain name,
	reversed.  The <code class="literal">2012-06</code> represents the year
	and month of acquiring control of that domain name, and
	<code class="literal">target0</code> can be any value.  Any number of
	targets can be defined in this configuration file.</p><p xml:lang="en" lang="en">The <code class="literal">auth-group no-authentication</code> line
	allows all initiators to connect to the specified target and
	<code class="literal">portal-group pg0</code> makes the target reachable
	through the <code class="literal">pg0</code> portal group.</p><p xml:lang="en" lang="en">The next section defines the <acronym class="acronym">LUN</acronym>.  To
	the initiator, each <acronym class="acronym">LUN</acronym> will be visible as
	a separate disk device.  Multiple <acronym class="acronym">LUNs</acronym> can
	be defined for each target.  Each <acronym class="acronym">LUN</acronym> is
	identified by a number, where <acronym class="acronym">LUN</acronym> 0 is
	mandatory.  The <code class="literal">path /data/target0-0</code> line
	defines the full path to a file or zvol backing the
	<acronym class="acronym">LUN</acronym>.  That path must exist before starting
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a>.  The second line is optional and specifies the
	size of the <acronym class="acronym">LUN</acronym>.</p><p xml:lang="en" lang="en">Next, to make sure the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> daemon is started at
	boot, add this line to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">ctld_enable="YES"</pre><p xml:lang="en" lang="en">To start <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> now, run this command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service ctld start</code></strong></pre><p xml:lang="en" lang="en">As the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> daemon is started, it reads
	<code class="filename">/etc/ctl.conf</code>.  If this file is edited
	after the daemon starts, use this command so that the changes
	take effect immediately:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service ctld reload</code></strong></pre><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85232952"></a>29.12.1.1. 認證</h4></div></div></div><p xml:lang="en" lang="en">The previous example is inherently insecure as it uses
	  no authentication, granting anyone full access to all
	  targets.  To require a username and password to access
	  targets, modify the configuration as follows:</p><pre xml:lang="en" class="programlisting" lang="en">auth-group ag0 {
	chap username1 secretsecret
	chap username2 anothersecret
}

portal-group pg0 {
	discovery-auth-group no-authentication
	listen 0.0.0.0
	listen [::]
}

target iqn.2012-06.com.example:target0 {
	auth-group ag0
	portal-group pg0
	lun 0 {
		path /data/target0-0
		size 4G
	}
}</pre><p xml:lang="en" lang="en">The <code class="literal">auth-group</code> section defines
	  username and password pairs.  An initiator trying to connect
	  to <code class="literal">iqn.2012-06.com.example:target0</code> must
	  first specify a defined username and secret.  However,
	  target discovery is still permitted without authentication.
	  To require target discovery authentication, set
	  <code class="literal">discovery-auth-group</code> to a defined
	  <code class="literal">auth-group</code> name instead of
	  <code class="literal">no-authentication</code>.</p><p xml:lang="en" lang="en">It is common to define a single exported target for
	  every initiator.  As a shorthand for the syntax above, the
	  username and password can be specified directly in the
	  target entry:</p><pre xml:lang="en" class="programlisting" lang="en">target iqn.2012-06.com.example:target0 {
	portal-group pg0
	chap username1 secretsecret

	lun 0 {
		path /data/target0-0
		size 4G
	}
}</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-iscsi-initiator"></a>29.12.2. 設定 <acronym class="acronym">iSCSI</acronym> Initiator</h3></div></div></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The <acronym class="acronym">iSCSI</acronym> initiator described in this
	  section is supported starting with FreeBSD 10.0-RELEASE.  To
	  use the <acronym class="acronym">iSCSI</acronym> initiator available in
	  older versions, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=iscontrol&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">iscontrol</span>(8)</span></a>.</p></div><p xml:lang="en" lang="en">The <acronym class="acronym">iSCSI</acronym> initiator requires that the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=iscsid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">iscsid</span>(8)</span></a> daemon is running.  This daemon does not use a
	configuration file.  To start it automatically at boot, add
	this line to <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">iscsid_enable="YES"</pre><p xml:lang="en" lang="en">To start <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=iscsid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">iscsid</span>(8)</span></a> now, run this command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service iscsid start</code></strong></pre><p xml:lang="en" lang="en">Connecting to a target can be done with or without an
	<code class="filename">/etc/iscsi.conf</code> configuration file.  This
	section demonstrates both types of connections.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85255992"></a>29.12.2.1. 不使用設定檔連線到 Target</h4></div></div></div><p xml:lang="en" lang="en">To connect an initiator to a single target, specify the
	  <acronym class="acronym">IP</acronym> address of the portal and the name of
	  the target:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>iscsictl -A -p <em class="replaceable"><code>10.10.10.10</code></em> -t <em class="replaceable"><code>iqn.2012-06.com.example:target0</code></em></code></strong></pre><p xml:lang="en" lang="en">To verify if the connection succeeded, run
	  <code class="command">iscsictl</code> without any arguments.  The
	  output should look similar to this:</p><pre xml:lang="en" class="programlisting" lang="en">Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Connected: da0</pre><p xml:lang="en" lang="en">In this example, the <acronym class="acronym">iSCSI</acronym> session
	  was successfully established, with
	  <code class="filename">/dev/da0</code> representing the attached
	  <acronym class="acronym">LUN</acronym>.  If the
	  <code class="literal">iqn.2012-06.com.example:target0</code> target
	  exports more than one <acronym class="acronym">LUN</acronym>, multiple
	  device nodes will be shown in that section of the
	  output:</p><pre xml:lang="en" class="screen" lang="en">Connected: da0 da1 da2.</pre><p xml:lang="en" lang="en">Any errors will be reported in the output, as well as
	  the system logs.  For example, this message usually means
	  that the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=iscsid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">iscsid</span>(8)</span></a> daemon is not running:</p><pre xml:lang="en" class="programlisting" lang="en">Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Waiting for iscsid(8)</pre><p xml:lang="en" lang="en">The following message suggests a networking problem,
	  such as a wrong <acronym class="acronym">IP</acronym> address or
	  port:</p><pre xml:lang="en" class="programlisting" lang="en">Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.11     Connection refused</pre><p xml:lang="en" lang="en">This message means that the specified target name is
	  wrong:</p><pre xml:lang="en" class="programlisting" lang="en">Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Not found</pre><p xml:lang="en" lang="en">This message means that the target requires
	  authentication:</p><pre xml:lang="en" class="programlisting" lang="en">Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Authentication failed</pre><p xml:lang="en" lang="en">To specify a <acronym class="acronym">CHAP</acronym> username and
	  secret, use this syntax:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>iscsictl -A -p <em class="replaceable"><code>10.10.10.10</code></em> -t <em class="replaceable"><code>iqn.2012-06.com.example:target0</code></em> -u <em class="replaceable"><code>user</code></em> -s <em class="replaceable"><code>secretsecret</code></em></code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84854584"></a>29.12.2.2. 使用設定檔連線到 Target</h4></div></div></div><p xml:lang="en" lang="en">To connect using a configuration file, create
	  <code class="filename">/etc/iscsi.conf</code> with contents like
	  this:</p><pre xml:lang="en" class="programlisting" lang="en">t0 {
	TargetAddress   = 10.10.10.10
	TargetName      = iqn.2012-06.com.example:target0
	AuthMethod      = CHAP
	chapIName       = user
	chapSecret      = secretsecret
}</pre><p xml:lang="en" lang="en">The <code class="literal">t0</code> specifies a nickname for the
	  configuration file section.  It will be used by the
	  initiator to specify which configuration to use.  The other
	  lines specify the parameters to use during connection.  The
	  <code class="literal">TargetAddress</code> and
	  <code class="literal">TargetName</code> are mandatory, whereas the
	  other options are optional.  In this example, the
	  <acronym class="acronym">CHAP</acronym> username and secret are
	  shown.</p><p xml:lang="en" lang="en">To connect to the defined target, specify the
	  nickname:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>iscsictl -An <em class="replaceable"><code>t0</code></em></code></strong></pre><p xml:lang="en" lang="en">Alternately, to connect to all targets defined in the
	  configuration file, use:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>iscsictl -Aa</code></strong></pre><p xml:lang="en" lang="en">To make the initiator automatically connect to all
	  targets in <code class="filename">/etc/iscsi.conf</code>, add the
	  following to <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">iscsictl_enable="YES"
iscsictl_flags="-Aa"</pre></div></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="firewalls"></a>章 30. 防火牆</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Joseph J.</span> <span class="surname">Barbish</span></span>. </span></div><div><span class="authorgroup">Converted to SGML and updated by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Brad</span> <span class="surname">Davis</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#firewalls-intro">30.1. 概述</a></span></dt><dt><span class="sect1"><a href="#firewalls-concepts">30.2. 防火牆概念</a></span></dt><dt><span class="sect1"><a href="#firewalls-pf">30.3. PF</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp85400120">30.3.1. 開啟 <span class="application">PF</span></a></span></dt><dt><span class="sect2"><a href="#pf-tutorial">30.3.2. <span class="application">PF</span> 規則集</a></span></dt><dd><dl><dt><span class="sect3"><a href="#pftut-gateway">30.3.2.1. 使用 NAT 的簡單通訊閘</a></span></dt><dt><span class="sect3"><a href="#pftut-ftp">30.3.2.2. 建立 <acronym class="acronym">FTP</acronym> Proxy</a></span></dt><dt><span class="sect3"><a href="#pftut-icmp">30.3.2.3. 管理 <acronym class="acronym">ICMP</acronym></a></span></dt><dd><dl><dt><span class="sect4"><a href="#pftut-pathmtudisc">30.3.2.3.1. Path <acronym class="acronym">MTU</acronym> Discovery</a></span></dt></dl></dd><dt><span class="sect3"><a href="#pftut-tables">30.3.2.4. 使用 Tables</a></span></dt><dt><span class="sect3"><a href="#pftut-overload">30.3.2.5. 使用 Overload Tables 保護 <acronym class="acronym">SSH</acronym></a></span></dt><dt><span class="sect3"><a href="#pftut-spamd">30.3.2.6. <acronym class="acronym">SPAM</acronym> 防護</a></span></dt><dt><span class="sect3"><a href="#pftut-hygiene">30.3.2.7. 網路保健</a></span></dt><dt><span class="sect3"><a href="#pftut-unrouteables">30.3.2.8. 處理不可路由 (Non-Routable) 的位址</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp85974712">30.3.3. 開啟 <span class="application">ALTQ</span></a></span></dt></dl></dd><dt><span class="sect1"><a href="#firewalls-ipfw">30.4. <span class="application">IPFW</span></a></span></dt><dd><dl><dt><span class="sect2"><a href="#firewalls-ipfw-enable">30.4.1. 開啟 <span class="application">IPFW</span></a></span></dt><dt><span class="sect2"><a href="#firewalls-ipfw-rules">30.4.2. <span class="application">IPFW</span> 規則語法</a></span></dt><dt><span class="sect2"><a href="#idp86162488">30.4.3. 範例規則集</a></span></dt><dt><span class="sect2"><a href="#in-kernel-nat">30.4.4. 核心內 <acronym class="acronym">NAT</acronym></a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp86353464">30.4.4.1. Port 重新導向</a></span></dt><dt><span class="sect3"><a href="#idp86373432">30.4.4.2. 位址重新導向</a></span></dt><dt><span class="sect3"><a href="#idp86405432">30.4.4.3. Userspace <acronym class="acronym">NAT</acronym></a></span></dt></dl></dd><dt><span class="sect2"><a href="#firewalls-ipfw-cmd">30.4.5. <span class="application">IPFW</span> 指令</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp86450872">30.4.5.1. 記錄防火牆訊息</a></span></dt><dt><span class="sect3"><a href="#firewalls-ipfw-rules-script">30.4.5.2. 建立規則 Script</a></span></dt></dl></dd><dt><span class="sect2"><a href="#firewalls-ipfw-kernelconfig">30.4.6. <span class="application">IPFW</span> 核心選項</a></span></dt></dl></dd><dt><span class="sect1"><a href="#firewalls-ipf">30.5. IPFILTER (IPF)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp86558264">30.5.1. 開啟 <span class="application">IPF</span></a></span></dt><dt><span class="sect2"><a href="#idp86596152">30.5.2. <span class="application">IPF</span> 規則語法</a></span></dt><dt><span class="sect2"><a href="#idp86691256">30.5.3. 範例規則集</a></span></dt><dt><span class="sect2"><a href="#idp86740536">30.5.4. 設定 <acronym class="acronym">NAT</acronym></a></span></dt><dt><span class="sect2"><a href="#idp86838968">30.5.5. 檢視 <span class="application">IPF</span> 統計資訊</a></span></dt><dt><span class="sect2"><a href="#idp86533304">30.5.6. <span class="application">IPF</span> 日誌</a></span></dt></dl></dd><dt><span class="sect1"><a href="#firewalls-blacklistd">30.6. Blacklistd</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp86916152">30.6.1. 開啟 Blacklistd</a></span></dt><dt><span class="sect2"><a href="#idp86954680">30.6.2. 建立 Blacklistd 規則集</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp86957368">30.6.2.1. 本地規則</a></span></dt><dt><span class="sect3"><a href="#idp87002040">30.6.2.2. 遠端規則</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp87020088">30.6.3. Blacklistd 客戶端設定</a></span></dt><dt><span class="sect2"><a href="#idp87027768">30.6.4. Blacklistd 管理</a></span></dt><dt><span class="sect2"><a href="#idp87040696">30.6.5. 從封鎖清單移除主機</a></span></dt></dl></dd></dl></div><a id="idp85296696" class="indexterm"></a><a id="idp85297208" class="indexterm"></a><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="firewalls-intro"></a>30.1. 概述</h2></div></div></div><p>防火牆能夠過濾透過系統內送 (Incoming) 與外發 (Outgoing) 的流量，防火牆可使用一組或多組 <span class="quote">“<span class="quote">規則 (Rules)</span>”</span> 來檢查網路連線中進出的網路封包(Network packets)，並且能允許或阻擋其通過。 而防火牆規則可以檢查封包中一個或數個特徵，例如通訊協定類型、來源或目的主機位址，以及來源及目地的連接埠 (Port)。</p><p>防火牆可以加強主機或網路的安全性，它可以用來完成下列事情：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>保護並隔離內部網路的應用程式、服務與主機，避免來自網際網路不必要的存取。</p></li><li class="listitem"><p>限制或者禁止內部網路的主機存取網際網路服務。</p></li><li class="listitem"><p>支援網路位址轉譯 (Network address translation, <acronym class="acronym">NAT</acronym>)，可允許內部網路使用私有 <acronym class="acronym">IP</acronym> 位址並共用一個連線使用一個 <acronym class="acronym">IP</acronym> 位址連到網際網路或者自動分配一個共用池當中的公開位址。</p></li></ul></div><p>FreeBSD 有三種內建於基礎系統的防火牆：<span class="application">PF</span>, <span class="application">IPFW</span> 與 <span class="application">IPFILTER</span> 即 <span class="application">IPF</span>。FreeBSD 也提供了兩種流量限制程式 (Traffic shaper) 來控制頻寬的用量：<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=altq&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">altq</span>(4)</span></a> 與 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dummynet&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dummynet</span>(4)</span></a>，<span class="application">ALTQ</span> 一般配合 <span class="application">PF</span> 使用，而 <span class="application">dummynet</span> 會配合 <span class="application">IPFW</span>。每一種防火牆都會使用規則來管制來自與送往 FreeBSD 的封包，儘管它們用不同的方式運作且有不同的規則語法。</p><p>FreeBSD 提供多個防火牆是為了滿足不同的需求與各種使用者的偏好，每位使用者應評估那一種防火牆最能滿足其需求。</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>如何定義封包過濾規則。</p></li><li class="listitem"><p>FreeBSD 內建防火牆之間的差異。</p></li><li class="listitem"><p>如何使用與設定 <span class="application">PF</span> 防火牆。</p></li><li class="listitem"><p>如何使用與設定 <span class="application">IPFW</span> 防火牆。</p></li><li class="listitem"><p>如何使用與設定 <span class="application">IPFILTER</span> 防火牆。</p></li></ul></div><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>了解 FreeBSD 基礎及網路概念。</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">由於所有防火牆均是以監控所選封包的控制欄位值為基礎運作，所以防火牆規則集的建立者必須很明白 <acronym class="acronym">TCP/IP</acronym> 是如何運作的，在封包的控制欄位中會有那些數值，這些數值會被如何用在一般的連線階段，要了解更多相關資訊，可參考 <a class="link" href="http://www.ipprimer.com" target="_top">Daryl's TCP/IP Primer</a>。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="firewalls-concepts"></a>30.2. 防火牆概念</h2></div></div></div><a id="idp85335992" class="indexterm"></a><p>一個規則集 (Ruleset) 中會有一群根據封包內的資料來判斷通過或封鎖的規則，主機間雙向的封包交換構成一個連線階段的對話，防火牆規則集會同時處理接收自網際網路的封包以及由系統所產生的回應封包，每一個 <acronym class="acronym">TCP/IP</acronym> 服務都會預先定義其通訊協定以及要傾聽的埠，要送往指定服務的封包會誕生在來源位址，使用一個不需特殊權限的埠並傳送給目標位址上特定服務的埠，所有上述過程中的參數均可用來當做建立規則的篩選條件，來允許或封鎖服務。</p><p>要查詢一個不清楚的埠號，可參考 <code class="filename">/etc/services</code>，或者至 <code class="uri"><a class="uri" href="http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers" target="_top">http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers</a></code> 查詢埠號來找出特定埠號的用途。</p><p>查看這個連結來了解有 <code class="uri"><a class="uri" href="http://web.archive.org/web/20150803024617/http://www.sans.org/security-resources/idfaq/oddports.php" target="_top">那些埠號會被木馬程式使用</a></code>。</p><p>FTP 有兩個模式：主動 (Active) 模式與被動 (Passive) 模式，兩者的差異在於取得資料通道的方式，被動模式會較安全，由於資料通道會取自 FTP 連線請求者。想要取得 FTP 與兩種模式更進一步的說明，詳見 <code class="uri"><a class="uri" href="http://www.slacksite.com/other/ftp.html" target="_top">http://www.slacksite.com/other/ftp.html</a></code>。</p><p>防火牆規則集可以為排除式 (<span class="quote">“<span class="quote">exclusive</span>”</span>) 或者內含式 (<span class="quote">“<span class="quote">inclusive</span>”</span>)，一個排除式的防火牆會允許所有的連線通過除了符合規則集的連線，內含式的防火牆則會反過來只允許符合規則集的連線並封鎖其他任何的連線。</p><p>內含式的防火牆對於外發的流量有較好的控制，使其成為提供網際網路服務的系統的最佳選擇，它同時可以控制可存取私有網路的網際網路連線，所有不符合該規則的連線會被封鎖並記錄。一般來說，內含式的防火牆會比排除式的防火牆安全，因為內含式的防火牆可以明顯的減少不必要連線所造成風險。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">除非另有說明，否則所有在此章節的範例規則集均為內含式防火牆規則集。</p></div><p>使用具狀態防火牆 (<span class="quote">“<span class="quote">Stateful firewall</span>”</span>) 可以更進一步加強安全性，這種類型的防火牆可持續追蹤連線，只允許與現有連線相符的封包或符合允許條件的新連線通過。</p><p>狀態過濾技術 (Stateful filtering) 將所有的流量當做是一個由雙向封包交換所組成的連線階段，當在符合的規則上指定狀態 (State) 時，防火牆會自動產生內部規則來處理該連線階段中每個預期會通過的封包，這種防火牆有足夠的比對能力可以辨別是否為同一個連線階段的封包，任何不符合連線階段樣板的封包都會被自動拒絕。</p><p>當連線階段結束時，該規則將會動態狀態表 (Dynamic state table) 中移除。</p><p>Stateful filtering 讓管理者可以專注於封鎖/傳遞新的連線階段，若新的連線階段通過，那麼該連線階段後續的封包將會自動允許通過，且任何假冒的封包會自動被拒絕。若新的連線階最被封鎖，將不允許其任何後續的封包。Stateful filtering 提供了進階的比對能力，能夠抵禦不同種類由攻擊者發動的 flood 攻擊。</p><p><acronym class="acronym">NAT</acronym> 代表 <span class="emphasis"><em>Network Address Translation</em></span> 即網路位址轉譯，<acronym class="acronym">NAT</acronym> 功能讓在防火牆之後的私有 LAN 可以共用一個 ISP 分配的 IP 位址 (甚至是動態分配的)，NAT 每一台在該 LAN 中的電腦均可連線網際網路，而不需要支付 ISP 多個網路帳號或 IP 位址的額外費用。</p><p><acronym class="acronym">NAT</acronym> 在當封包要外送到防火牆之外的網際網路時，會自動轉譯每一台電腦在私有 LAN 的 IP 位址成為一個公有 IP 位址，它也同樣會對回傳的封包做反向轉譯。</p><p>根據 RFC1918，會保留以下範圍的 IP 位址做為私有網路使用，永遠不會被傳送到網際網路，因此可供 NAT 使用：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">10.0.0.0/8</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">172.16.0.0/12</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">192.168.0.0/16</code>.</p></li></ul></div><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">在使用防火牆規則時要<span class="emphasis"><em>非常小心</em></span>，有一些設定<span class="emphasis"><em>會將管理者鎖在伺服器之外</em></span>，保險起見的方式是在本機的 Console 做初次的防火牆設定，不要直接由遠端透過 <span class="application">ssh</span> 來設定防火牆。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="firewalls-pf"></a>30.3. PF</h2></div><div><span class="authorgroup">Revised and updated by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">John</span> <span class="surname">Ferrell</span></span>. </span></div></div></div><a id="idp85386040" class="indexterm"></a><p>自 FreeBSD 5.3 開始，基礎系統便有內建 OpenBSD's <span class="application">PF</span> 防火牆的移植版本，<span class="application">PF</span> 是一套完整、多功能的防火牆，並可選擇開啟 <span class="application">ALTQ</span> (Alternate Queuing) 的支援來提供 Quality of Service (<acronym class="acronym">QoS</acronym>) 機制。</p><p>OpenBSD 計劃有維護一份官方參考文件於 <a class="link" href="http://www.openbsd.org/faq/pf/" target="_top">PF FAQ</a> ，Peter Hansteen 有維一份詳盡的 <span class="application">PF</span> 教學於 <a class="link" href="http://home.nuug.no/~peter/pf/" target="_top">http://home.nuug.no/~peter/pf/</a>。</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">When reading the <a class="link" href="http://www.openbsd.org/faq/pf/" target="_top">PF FAQ</a>,
	keep in mind that FreeBSD's version of
	<span class="application">PF</span> has diverged substantially from
	the upstream OpenBSD version over the years.  Not all features
	work the same way on FreeBSD as they do in OpenBSD and vice
	versa.</p></div><p>要詢問有關設定與執行 <span class="application">PF</span> 防火牆的問題可至 <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pf" target="_top">FreeBSD packet filter 郵遞論壇</a>，在詢問問題之前請先查看該郵遞論壇的封存資料，因您的問題可能已有解答。</p><p xml:lang="en" lang="en">This section of the Handbook focuses on
      <span class="application">PF</span> as it pertains to FreeBSD.  It
      demonstrates how to enable <span class="application">PF</span> and
      <span class="application">ALTQ</span>.  It also provides several
      examples for creating rulesets on a FreeBSD system.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85400120"></a>30.3.1. 開啟 <span class="application">PF</span></h3></div></div></div><p xml:lang="en" lang="en">To use <span class="application">PF</span>, its kernel
	module must be first loaded.  This section describes the
	entries that can be added to <code class="filename">/etc/rc.conf</code>
	to enable <span class="application">PF</span>.</p><p xml:lang="en" lang="en">Start by adding <code class="literal">pf_enable=yes</code> to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysrc pf_enable=yes</code></strong></pre><p xml:lang="en" lang="en">Additional options, described in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pfctl</span>(8)</span></a>, can be
	passed to <span class="application">PF</span> when it is started.
	Add or change this entry in <code class="filename">/etc/rc.conf</code>
	and specify any required flags between the two quotes
	(<code class="literal">""</code>):</p><pre xml:lang="en" class="programlisting" lang="en">pf_flags=""                     # additional flags for pfctl startup</pre><p xml:lang="en" lang="en"><span class="application">PF</span> will not start if it cannot
	find its ruleset configuration file.  By default, FreeBSD does
	not ship with a ruleset and there is no
	<code class="filename">/etc/pf.conf</code>.  Example rulesets can be
	found in <code class="filename">/usr/share/examples/pf/</code>.  If a
	custom ruleset has been saved somewhere else, add a line to
	<code class="filename">/etc/rc.conf</code> which specifies the full
	path to the file:</p><pre xml:lang="en" class="programlisting" lang="en">pf_rules="<em class="replaceable"><code>/path/to/pf.conf</code></em>"</pre><p xml:lang="en" lang="en">Logging support for <span class="application">PF</span> is
	provided by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pflog&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pflog</span>(4)</span></a>.  To enable logging support, add
	<code class="literal">pflog_enable=yes</code> to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysrc pflog_enable=yes</code></strong></pre><p xml:lang="en" lang="en">The following lines can also be added to change the
	default location of the log file or to specify any additional
	flags to pass to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pflog&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pflog</span>(4)</span></a> when it is started:</p><pre xml:lang="en" class="programlisting" lang="en">pflog_logfile="/var/log/pflog"  # where pflogd should store the logfile
pflog_flags=""                  # additional flags for pflogd startup</pre><p xml:lang="en" lang="en">Finally, if there is a <acronym class="acronym">LAN</acronym> behind the
	firewall and packets need to be forwarded for the computers on
	the <acronym class="acronym">LAN</acronym>, or <acronym class="acronym">NAT</acronym> is
	required, enable the following option:</p><pre xml:lang="en" class="programlisting" lang="en">gateway_enable="YES"            # Enable as LAN gateway</pre><p xml:lang="en" lang="en">After saving the needed edits,
	<span class="application">PF</span> can be started with logging
	support by typing:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service pf start</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service pflog start</code></strong></pre><p xml:lang="en" lang="en">By default, <span class="application">PF</span> reads its
	configuration rules from <code class="filename">/etc/pf.conf</code> and
	modifies, drops, or passes packets according to the rules or
	definitions specified in this file.  The FreeBSD installation
	includes several sample files located in
	<code class="filename">/usr/share/examples/pf/</code>.  Refer to the
	<a class="link" href="http://www.openbsd.org/faq/pf/" target="_top">PF
	  FAQ</a> for complete coverage
	of <span class="application">PF</span> rulesets.</p><p xml:lang="en" lang="en">To control <span class="application">PF</span>, use
	<code class="command">pfctl</code>.  <a class="xref" href="#pfctl" title="表格 30.1. 有用的 pfctl 選項">表格 30.1, “有用的 <code class="command">pfctl</code> 選項”</a> summarizes
	some useful options to this command.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pfctl</span>(8)</span></a>
	for a description of all available options:</p><div class="table"><a id="pfctl"></a><div class="table-title">表格 30.1. 有用的 <code class="command">pfctl</code> 選項</div><div class="table-contents"><table summary="有用的 pfctl 選項" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>指令</th><th>用途</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><code class="command">pfctl
		  -e</code></td><td xml:lang="en" lang="en">Enable <span class="application">PF</span>.</td></tr><tr><td xml:lang="en" lang="en"><code class="command">pfctl
		  -d</code></td><td xml:lang="en" lang="en">Disable <span class="application">PF</span>.</td></tr><tr><td xml:lang="en" lang="en"><code class="command">pfctl -F all
		  -f /etc/pf.conf</code></td><td xml:lang="en" lang="en">Flush all <acronym class="acronym">NAT</acronym>, filter, state,
		and table rules and reload
		<code class="filename">/etc/pf.conf</code>.</td></tr><tr><td xml:lang="en" lang="en"><code class="command">pfctl -s [ rules | nat |
		  states ]</code></td><td xml:lang="en" lang="en">Report on the filter rules,
		<acronym class="acronym">NAT</acronym> rules, or state
		table.</td></tr><tr><td xml:lang="en" lang="en"><code class="command">pfctl -vnf
		  /etc/pf.conf</code></td><td xml:lang="en" lang="en">Check <code class="filename">/etc/pf.conf</code> for
		errors, but do not load ruleset.</td></tr></tbody></table></div></div><br class="table-break" /><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/sudo/pkg-descr">security/sudo</a> is useful for running
	  commands like <code class="command">pfctl</code> that require elevated
	  privileges.  It can be installed from the Ports
	  Collection.</p></div><p xml:lang="en" lang="en">To keep an eye on the traffic that passes through the
	<span class="application">PF</span> firewall, consider installing
	the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/pftop/pkg-descr">sysutils/pftop</a> package or port.  Once
	installed, <span class="application">pftop</span> can be run to
	view a running snapshot of traffic in a format which is
	similar to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pf-tutorial"></a>30.3.2. <span class="application">PF</span> 規則集</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Peter</span> <span class="othername">N. M.</span> <span class="surname">Hansteen</span></span>. </span></div></div></div><p xml:lang="en" lang="en">This section demonstrates how to create a customized
	ruleset.  It starts with the simplest of rulesets and builds
	upon its concepts using several examples to demonstrate
	real-world usage of <span class="application">PF</span>'s many
	features.</p><p xml:lang="en" lang="en">The simplest possible ruleset is for a single machine
	that does not run any services and which needs access to one
	network, which may be the Internet.  To create this minimal
	ruleset, edit <code class="filename">/etc/pf.conf</code> so it looks
	like this:</p><pre xml:lang="en" class="programlisting" lang="en">block in all
pass out all keep state</pre><p xml:lang="en" lang="en">The first rule denies all incoming traffic by default.
	The second rule allows connections created by this system to
	pass out, while retaining state information on those
	connections.  This state information allows return traffic for
	those connections to pass back and should only be used on
	machines that can be trusted.  The ruleset can be loaded
	with:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pfctl -e ; pfctl -f /etc/pf.conf</code></strong></pre><p xml:lang="en" lang="en">In addition to keeping state,
	<span class="application">PF</span> provides
	<em class="firstterm">lists</em> and
	<em class="firstterm">macros</em> which can be defined for use
	when creating rules.  Macros can include lists and need to be
	defined before use.  As an example, insert these lines at the
	very top of the ruleset:</p><pre xml:lang="en" class="programlisting" lang="en">tcp_services = "{ ssh, smtp, domain, www, pop3, auth, pop3s }"
udp_services = "{ domain }"</pre><p xml:lang="en" lang="en"><span class="application">PF</span> understands port names as
	well as port numbers, as long as the names are listed in
	<code class="filename">/etc/services</code>.  This example creates two
	macros.  The first is a list of seven
	<acronym class="acronym">TCP</acronym> port names and the second is one
	<acronym class="acronym">UDP</acronym> port name.  Once defined, macros can be
	used in rules.  In this example, all traffic is blocked except
	for the  connections initiated by this system for the seven
	specified <acronym class="acronym">TCP</acronym> services and the one
	specified <acronym class="acronym">UDP</acronym> service:</p><pre xml:lang="en" class="programlisting" lang="en">tcp_services = "{ ssh, smtp, domain, www, pop3, auth, pop3s }"
udp_services = "{ domain }"
block all
pass out proto tcp to any port $tcp_services keep state
pass proto udp to any port $udp_services keep state</pre><p xml:lang="en" lang="en">Even though <acronym class="acronym">UDP</acronym> is considered to be a
	stateless protocol, <span class="application">PF</span> is able to
	track some state information.  For example, when a
	<acronym class="acronym">UDP</acronym> request is passed which asks a name
	server about a domain name, <span class="application">PF</span> will
	watch for the response to pass it back.</p><p xml:lang="en" lang="en">Whenever an edit is made to a ruleset, the new rules must
	be loaded so they can be used:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pfctl -f /etc/pf.conf</code></strong></pre><p xml:lang="en" lang="en">If there are no syntax errors, <code class="command">pfctl</code>
	will not output any messages during the rule load.  Rules can
	also be tested before attempting to load them:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pfctl -nf /etc/pf.conf</code></strong></pre><p xml:lang="en" lang="en">Including <code class="option">-n</code> causes the rules to be
	interpreted only, but not loaded.  This provides an
	opportunity to correct any errors.  At all times, the last
	valid ruleset loaded will be enforced until either
	<span class="application">PF</span> is disabled or a new ruleset is
	loaded.</p><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Adding <code class="option">-v</code> to a <code class="command">pfctl</code>
	  ruleset verify or load will display the fully parsed rules
	  exactly the way they will be loaded.  This is extremely
	  useful when debugging rules.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pftut-gateway"></a>30.3.2.1. 使用 NAT 的簡單通訊閘</h4></div></div></div><p xml:lang="en" lang="en">This section demonstrates how to configure a FreeBSD system
	  running <span class="application">PF</span> to act as a gateway
	  for at least one other machine.  The gateway needs at least
	  two network interfaces, each connected to a separate
	  network.  In this example, <code class="filename">xl1</code> is
	  connected to the Internet and <code class="filename">xl0</code> is
	  connected to the internal network.</p><p xml:lang="en" lang="en">First, enable the gateway to let the machine
	  forward the network traffic it receives on one interface to
	  another interface.  This <span class="application">sysctl</span>
	  setting will forward <acronym class="acronym">IPv4</acronym> packets:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysctl net.inet.ip.forwarding=1</code></strong></pre><p xml:lang="en" lang="en">To forward <acronym class="acronym">IPv6</acronym> traffic, use:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysctl net.inet6.ip6.forwarding=1</code></strong></pre><p xml:lang="en" lang="en">To enable these settings at system boot, use
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysrc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysrc</span>(8)</span></a> to add them to
	  <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysrc gateway_enable=yes</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysrc ipv6_gateway_enable=yes</code></strong></pre><p xml:lang="en" lang="en">Verify with <code class="command">ifconfig</code> that both of the
	  interfaces are up and running.</p><p xml:lang="en" lang="en">Next, create the <span class="application">PF</span> rules to
	  allow the gateway to pass traffic.  While the following rule
	  allows stateful traffic to pass from the Internet  to hosts
	  on the network, the <code class="literal">to</code> keyword does not
	  guarantee passage all the way from source to
	  destination:</p><pre xml:lang="en" class="programlisting" lang="en">pass in on xl1 from xl1:network to xl0:network port $ports keep state</pre><p xml:lang="en" lang="en">That rule only lets the traffic pass in to the gateway
	  on the internal interface.  To let the packets go further, a
	  matching rule is needed:</p><pre xml:lang="en" class="programlisting" lang="en">pass out on xl0 from xl1:network to xl0:network port $ports keep state</pre><p xml:lang="en" lang="en">While these two rules will work, rules this specific are
	  rarely needed.  For a busy network admin, a readable ruleset
	  is a safer ruleset.  The remainder of this section
	  demonstrates how to keep the rules as simple as possible for
	  readability.  For example, those two rules could be
	  replaced with one rule:</p><pre xml:lang="en" class="programlisting" lang="en">pass from xl1:network to any port $ports keep state</pre><p xml:lang="en" lang="en">The <code class="literal">interface:network</code> notation can be
	  replaced with a macro to make the ruleset even more
	  readable.  For example, a <code class="literal">$localnet</code> macro
	  could be defined as the network directly attached to the
	  internal interface (<code class="literal">$xl1:network</code>).
	  Alternatively, the definition of
	  <code class="literal">$localnet</code> could be changed to an
	  <span class="emphasis"><em>IP address/netmask</em></span> notation to denote
	  a network, such as <code class="literal">192.168.100.1/24</code> for a
	  subnet of private addresses.</p><p xml:lang="en" lang="en">If required, <code class="literal">$localnet</code> could even be
	  defined as a list of networks.  Whatever the specific needs,
	  a sensible <code class="literal">$localnet</code> definition could be
	  used in a typical pass rule as follows:</p><pre xml:lang="en" class="programlisting" lang="en">pass from $localnet to any port $ports keep state</pre><p xml:lang="en" lang="en">The following sample ruleset allows all traffic
	  initiated by machines on the internal network.  It first
	  defines two macros to represent the external and internal
	  3COM interfaces of the gateway.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">For dialup users, the external interface will use
	    <code class="filename">tun0</code>.  For an
	    <acronym class="acronym">ADSL</acronym> connection, specifically those
	    using <acronym class="acronym">PPP</acronym> over Ethernet
	    (<acronym class="acronym">PPPoE</acronym>), the correct external
	    interface is <code class="filename">tun0</code>, not the physical
	    Ethernet interface.</p></div><pre xml:lang="en" class="programlisting" lang="en">ext_if = "xl0"	# macro for external interface - use tun0 for PPPoE
int_if = "xl1"	# macro for internal interface
localnet = $int_if:network
# ext_if IP address could be dynamic, hence ($ext_if)
nat on $ext_if from $localnet to any -&gt; ($ext_if)
block all
pass from { lo0, $localnet } to any keep state</pre><p xml:lang="en" lang="en">This ruleset introduces the <code class="literal">nat</code> rule
	  which is used to handle the network address translation from
	  the non-routable addresses inside the internal network to
	  the <acronym class="acronym">IP</acronym> address assigned to the external
	  interface.  The parentheses surrounding the last part of the
	  nat rule <code class="literal">($ext_if)</code> is included when the
	  <acronym class="acronym">IP</acronym> address of the external interface is
	  dynamically assigned.  It ensures that network traffic runs
	  without serious interruptions even if the external
	  <acronym class="acronym">IP</acronym> address changes.</p><p xml:lang="en" lang="en">Note that this ruleset probably allows more traffic to
	  pass out of the network than is needed.  One reasonable
	  setup could create this macro:</p><pre xml:lang="en" class="programlisting" lang="en">client_out = "{ ftp-data, ftp, ssh, domain, pop3, auth, nntp, http, \
    https, cvspserver, 2628, 5999, 8000, 8080 }"</pre><p xml:lang="en" lang="en">to use in the main pass rule:</p><pre xml:lang="en" class="programlisting" lang="en">pass inet proto tcp from $localnet to any port $client_out \
    flags S/SA keep state</pre><p xml:lang="en" lang="en">A few other pass rules may be needed.  This one enables
	  <acronym class="acronym">SSH</acronym> on the external interface:</p><pre xml:lang="en" class="programlisting" lang="en">pass in inet proto tcp to $ext_if port ssh</pre><p xml:lang="en" lang="en">This macro definition and rule allows
	  <acronym class="acronym">DNS</acronym> and <acronym class="acronym">NTP</acronym> for
	  internal clients:</p><pre xml:lang="en" class="programlisting" lang="en">udp_services = "{ domain, ntp }"
pass quick inet proto { tcp, udp } to any port $udp_services keep state</pre><p xml:lang="en" lang="en">Note the <code class="literal">quick</code> keyword in this rule.
	  Since the ruleset consists of several rules, it is important
	  to understand the relationships between the rules in a
	  ruleset.  Rules are evaluated from top to bottom, in the
	  sequence they are written.  For each packet or connection
	  evaluated by <span class="application">PF</span>,
	  <span class="emphasis"><em>the last matching rule</em></span> in the ruleset
	  is the one which is applied.  However, when a packet matches
	  a rule which contains the <code class="literal">quick</code> keyword,
	  the rule processing stops and the packet is treated
	  according to that rule.  This is very useful when an
	  exception to the general rules is needed.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pftut-ftp"></a>30.3.2.2. 建立 <acronym class="acronym">FTP</acronym> Proxy</h4></div></div></div><p xml:lang="en" lang="en">Configuring working <acronym class="acronym">FTP</acronym> rules can be
	  problematic due to the nature of the <acronym class="acronym">FTP</acronym>
	  protocol.  <acronym class="acronym">FTP</acronym> pre-dates firewalls by
	  several decades and is insecure in its design.  The most
	  common points against using <acronym class="acronym">FTP</acronym>
	  include:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Passwords are transferred in the clear.</p></li><li class="listitem"><p xml:lang="en" lang="en">The protocol demands the use of at least two
	      <acronym class="acronym">TCP</acronym> connections (control and data) on
	      separate ports.</p></li><li class="listitem"><p xml:lang="en" lang="en">When a session is established, data is communicated
	      using randomly selected ports.</p></li></ul></div><p xml:lang="en" lang="en">All of these points present security challenges, even
	  before considering any potential security weaknesses in
	  client or server software.  More secure alternatives for
	  file transfer exist, such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sftp&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sftp</span>(1)</span></a> or <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a>,
	  which both feature authentication and data transfer over
	  encrypted connections..</p><p xml:lang="en" lang="en">For those situations when <acronym class="acronym">FTP</acronym> is
	  required, <span class="application">PF</span> provides
	  redirection of <acronym class="acronym">FTP</acronym> traffic to a small
	  proxy program called <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ftp-proxy</span>(8)</span></a>, which is included in
	  the base system of FreeBSD.  The role of the proxy is to
	  dynamically insert and delete rules in the ruleset, using a
	  set of anchors, to correctly handle
	  <acronym class="acronym">FTP</acronym> traffic.</p><p xml:lang="en" lang="en">To enable the <acronym class="acronym">FTP</acronym> proxy, add this
	  line to <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">ftpproxy_enable="YES"</pre><p xml:lang="en" lang="en">Then start the proxy by running <code class="command">service
	    ftp-proxy start</code>.</p><p xml:lang="en" lang="en">For a basic configuration, three elements need to be
	  added to <code class="filename">/etc/pf.conf</code>.  First, the
	  anchors which the proxy will use to insert the rules it
	  generates for the <acronym class="acronym">FTP</acronym> sessions:</p><pre xml:lang="en" class="programlisting" lang="en">nat-anchor "ftp-proxy/*"
rdr-anchor "ftp-proxy/*"</pre><p xml:lang="en" lang="en">Second, a pass rule is needed to allow
	  <acronym class="acronym">FTP</acronym> traffic in to the proxy.</p><p xml:lang="en" lang="en">Third, redirection and <acronym class="acronym">NAT</acronym> rules need
	  to be defined before the filtering rules.  Insert this
	  <code class="literal">rdr</code> rule immediately after the
	  <code class="literal">nat</code> rule:</p><pre xml:lang="en" class="programlisting" lang="en">rdr pass on $int_if proto tcp from any to any port ftp -&gt; 127.0.0.1 port 8021</pre><p xml:lang="en" lang="en">Finally, allow the redirected traffic to pass:</p><pre xml:lang="en" class="programlisting" lang="en">pass out proto tcp from $proxy to any port ftp</pre><p xml:lang="en" lang="en">where <code class="literal">$proxy</code> expands to the address
	  the proxy daemon is bound to.</p><p xml:lang="en" lang="en">Save <code class="filename">/etc/pf.conf</code>, load the new
	  rules, and verify from a client that <acronym class="acronym">FTP</acronym>
	  connections are working:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pfctl -f /etc/pf.conf</code></strong></pre><p xml:lang="en" lang="en">This example covers a basic setup where the clients in
	  the local network need to contact <acronym class="acronym">FTP</acronym>
	  servers elsewhere.  This basic configuration should
	  work well with most combinations of <acronym class="acronym">FTP</acronym>
	  clients and servers.  As shown in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ftp-proxy</span>(8)</span></a>, the
	  proxy's behavior can be changed in various ways by adding
	  options to the <code class="literal">ftpproxy_flags=</code> line.
	  Some clients or servers may have specific quirks that must
	  be compensated for in the configuration, or there may be a
	  need to integrate the proxy in specific ways such as
	  assigning <acronym class="acronym">FTP</acronym> traffic to a specific
	  queue.</p><p xml:lang="en" lang="en">For ways to run an <acronym class="acronym">FTP</acronym> server
	  protected by <span class="application">PF</span> and
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ftp-proxy</span>(8)</span></a>, configure a separate
	  <code class="command">ftp-proxy</code> in reverse mode, using
	  <code class="option">-R</code>, on a separate port with its own
	  redirecting pass rule.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pftut-icmp"></a>30.3.2.3. 管理 <acronym class="acronym">ICMP</acronym></h4></div></div></div><p xml:lang="en" lang="en">Many of the tools used for debugging or troubleshooting
	  a <acronym class="acronym">TCP/IP</acronym> network rely on the Internet
	  Control Message Protocol (<acronym class="acronym">ICMP</acronym>), which
	  was designed specifically with debugging in mind.</p><p xml:lang="en" lang="en">The <acronym class="acronym">ICMP</acronym> protocol sends and receives
	  <span class="emphasis"><em>control messages</em></span> between hosts and
	  gateways, mainly to provide feedback to a sender about any
	  unusual or difficult conditions enroute to the target host.
	  Routers use <acronym class="acronym">ICMP</acronym> to negotiate packet
	  sizes and other transmission parameters in a process often
	  referred to as <span class="emphasis"><em>path <acronym class="acronym">MTU</acronym>
	    discovery</em></span>.</p><p xml:lang="en" lang="en">From a firewall perspective, some
	  <acronym class="acronym">ICMP</acronym> control messages are vulnerable to
	  known attack vectors.  Also, letting all diagnostic traffic
	  pass unconditionally makes debugging easier, but it also
	  makes it easier for others to extract information about the
	  network.  For these reasons, the following rule may not be
	  optimal:</p><pre xml:lang="en" class="programlisting" lang="en">pass inet proto icmp from any to any</pre><p xml:lang="en" lang="en">One solution is to let all <acronym class="acronym">ICMP</acronym>
	  traffic from the local network through while stopping all
	  probes from outside the network:</p><pre xml:lang="en" class="programlisting" lang="en">pass inet proto icmp from $localnet to any keep state
pass inet proto icmp from any to $ext_if keep state</pre><p xml:lang="en" lang="en">Additional options are available which demonstrate some
	  of <span class="application">PF</span>'s flexibility.  For
	  example, rather than allowing all <acronym class="acronym">ICMP</acronym>
	  messages, one can specify the messages used by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a>
	  and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=traceroute&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">traceroute</span>(8)</span></a>.  Start by defining a macro for that
	  type of message:</p><pre xml:lang="en" class="programlisting" lang="en">icmp_types = "echoreq"</pre><p xml:lang="en" lang="en">and a rule which uses the macro:</p><pre xml:lang="en" class="programlisting" lang="en">pass inet proto icmp all icmp-type $icmp_types keep state</pre><p xml:lang="en" lang="en">If other types of <acronym class="acronym">ICMP</acronym> packets are
	  needed, expand <code class="literal">icmp_types</code> to a list of
	  those packet types.  Type <code class="command">more
	    /usr/src/sbin/pfctl/pfctl_parser.c</code> to see
	  the list of <acronym class="acronym">ICMP</acronym> message types supported
	  by <span class="application">PF</span>.  Refer to <a class="link" href="http://www.iana.org/assignments/icmp-parameters/icmp-parameters.xhtml" target="_top">http://www.iana.org/assignments/icmp-parameters/icmp-parameters.xhtml</a>
	  for an explanation of each message type.</p><p xml:lang="en" lang="en">Since Unix <code class="command">traceroute</code> uses
	  <acronym class="acronym">UDP</acronym> by default, another rule is needed to
	  allow Unix <code class="command">traceroute</code>:</p><pre xml:lang="en" class="programlisting" lang="en"># allow out the default range for traceroute(8):
pass out on $ext_if inet proto udp from any to any port 33433 &gt;&lt; 33626 keep state</pre><p xml:lang="en" lang="en">Since <code class="command">TRACERT.EXE</code> on Microsoft
	  Windows systems uses <acronym class="acronym">ICMP</acronym> echo request
	  messages, only the first rule is needed to allow network
	  traces from those systems.  Unix
	  <code class="command">traceroute</code> can be instructed to use other
	  protocols as well, and will use <acronym class="acronym">ICMP</acronym> echo
	  request messages if <code class="option">-I</code> is used.  Check the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=traceroute&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">traceroute</span>(8)</span></a> man page for details.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pftut-pathmtudisc"></a>30.3.2.3.1. Path <acronym class="acronym">MTU</acronym> Discovery</h5></div></div></div><p xml:lang="en" lang="en">Internet protocols are designed to be device
	    independent, and one consequence of device independence is
	    that the optimal packet size for a given connection cannot
	    always be predicted reliably.  The main constraint on
	    packet size is the <em class="firstterm">Maximum Transmission
	      Unit</em> (<acronym class="acronym">MTU</acronym>) which sets the
	    upper limit on the packet size for an interface.  Type
	    <code class="command">ifconfig</code> to view the
	    <acronym class="acronym">MTU</acronym>s for a system's network
	    interfaces.</p><p xml:lang="en" lang="en"><acronym class="acronym">TCP/IP</acronym> uses a process known as path
	    <acronym class="acronym">MTU</acronym> discovery to determine the right
	    packet size for a connection.  This process sends packets
	    of varying sizes with the <span class="quote">“<span class="quote">Do not fragment</span>”</span>
	    flag set, expecting an <acronym class="acronym">ICMP</acronym> return
	    packet of <span class="quote">“<span class="quote">type 3, code 4</span>”</span> when the upper
	    limit has been reached.  Type 3 means <span class="quote">“<span class="quote">destination
	      unreachable</span>”</span>, and code 4 is short for
	    <span class="quote">“<span class="quote">fragmentation needed, but the do-not-fragment flag
	      is set</span>”</span>.  To allow path MTU discovery in order
	    to support connections to other <acronym class="acronym">MTU</acronym>s,
	    add the <code class="literal">destination unreachable</code> type to
	    the <code class="literal">icmp_types</code> macro:</p><pre xml:lang="en" class="programlisting" lang="en">icmp_types = "{ echoreq, unreach }"</pre><p xml:lang="en" lang="en">Since the pass rule already uses that macro, it does
	    not need to be modified to support the new
	    <acronym class="acronym">ICMP</acronym> type:</p><pre xml:lang="en" class="programlisting" lang="en">pass inet proto icmp all icmp-type $icmp_types keep state</pre><p xml:lang="en" lang="en"><span class="application">PF</span> allows filtering on all
	    variations of <acronym class="acronym">ICMP</acronym> types and codes.
	    The list of possible types and codes are documented in
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=icmp&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">icmp</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=icmp6&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">icmp6</span>(4)</span></a>.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pftut-tables"></a>30.3.2.4. 使用 Tables</h4></div></div></div><p xml:lang="en" lang="en">Some types of data are relevant to filtering and
	  redirection at a given time, but their definition is too
	  long to be included in the ruleset file.
	  <span class="application">PF</span> supports the use of tables,
	  which are defined lists that can be manipulated without
	  needing to reload the entire ruleset, and which can provide
	  fast lookups.  Table names are always enclosed within
	  <code class="literal">&lt; &gt;</code>, like this:</p><pre xml:lang="en" class="programlisting" lang="en">table &lt;clients&gt; { 192.168.2.0/24, !192.168.2.5 }</pre><p xml:lang="en" lang="en">In this example, the <code class="literal">192.168.2.0/24</code>
	  network is part of the table, except for the address
	  <code class="literal">192.168.2.5</code>, which is excluded using the
	  <code class="literal">!</code> operator.  It is also possible to load
	  tables from files where each item is on a separate line, as
	  seen in this example
	  <code class="filename">/etc/clients</code>:</p><pre xml:lang="en" class="programlisting" lang="en">192.168.2.0/24
!192.168.2.5</pre><p xml:lang="en" lang="en">To refer to the file, define the table like this:</p><pre xml:lang="en" class="programlisting" lang="en">table &lt;clients&gt; persist file "/etc/clients"</pre><p xml:lang="en" lang="en">Once the table is defined, it can be referenced by a
	  rule:</p><pre xml:lang="en" class="programlisting" lang="en">pass inet proto tcp from &lt;clients&gt; to any port $client_out flags S/SA keep state</pre><p xml:lang="en" lang="en">A table's contents can be manipulated live, using
	  <code class="command">pfctl</code>.  This example adds another network
	  to the table:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pfctl -t clients -T add 192.168.1.0/16</code></strong></pre><p xml:lang="en" lang="en">Note that any changes made this way will take affect
	  now, making them ideal for testing, but will not survive a
	  power failure or reboot.  To make the changes permanent,
	  modify the definition of the table in the ruleset or edit
	  the file that the table refers to.  One can maintain the
	  on-disk copy of the table using a <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> job which
	  dumps the table's contents to disk at regular intervals,
	  using a command such as <code class="command">pfctl -t clients -T show
	    &gt;/etc/clients</code>.  Alternatively,
	  <code class="filename">/etc/clients</code> can be updated with the
	  in-memory table contents:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pfctl -t clients -T replace -f /etc/clients</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pftut-overload"></a>30.3.2.5. 使用 Overload Tables 保護 <acronym class="acronym">SSH</acronym></h4></div></div></div><p xml:lang="en" lang="en">Those who run <acronym class="acronym">SSH</acronym> on an external
	  interface have probably seen something like this in the
	  authentication logs:</p><pre xml:lang="en" class="programlisting" lang="en">Sep 26 03:12:34 skapet sshd[25771]: Failed password for root from 200.72.41.31 port 40992 ssh2
Sep 26 03:12:34 skapet sshd[5279]: Failed password for root from 200.72.41.31 port 40992 ssh2
Sep 26 03:12:35 skapet sshd[5279]: Received disconnect from 200.72.41.31: 11: Bye Bye
Sep 26 03:12:44 skapet sshd[29635]: Invalid user admin from 200.72.41.31
Sep 26 03:12:44 skapet sshd[24703]: input_userauth_request: invalid user admin
Sep 26 03:12:44 skapet sshd[24703]: Failed password for invalid user admin from 200.72.41.31 port 41484 ssh2</pre><p xml:lang="en" lang="en">This is indicative of a brute force attack where
	  somebody or some program is trying to discover the user name
	  and password which will let them into the system.</p><p xml:lang="en" lang="en">If external <acronym class="acronym">SSH</acronym> access is needed for
	  legitimate users, changing the default port used by
	  <acronym class="acronym">SSH</acronym> can offer some protection.  However,
	  <span class="application">PF</span> provides a more elegant
	  solution.  Pass rules can contain limits on what connecting
	  hosts can do and violators can be banished to a table of
	  addresses which are denied some or all access.  It is even
	  possible to drop all existing connections from machines
	  which overreach the limits.</p><p xml:lang="en" lang="en">To configure this, create this table in the tables
	  section of the ruleset:</p><pre xml:lang="en" class="programlisting" lang="en">table &lt;bruteforce&gt; persist</pre><p xml:lang="en" lang="en">Then, somewhere early in the ruleset, add rules to block
	  brute access while allowing legitimate access:</p><pre xml:lang="en" class="programlisting" lang="en">block quick from &lt;bruteforce&gt;
pass inet proto tcp from any to $localnet port $tcp_services \
    flags S/SA keep state \
    (max-src-conn <em class="replaceable"><code>100</code></em>, max-src-conn-rate <em class="replaceable"><code>15/5</code></em>, \
    overload &lt;bruteforce&gt; flush global)</pre><p xml:lang="en" lang="en">The part in parentheses defines the limits and the
	  numbers should be changed to meet local requirements.  It
	  can be read as follows:</p><p xml:lang="en" lang="en"><code class="literal">max-src-conn</code> is the number of
	  simultaneous connections allowed from one host.</p><p xml:lang="en" lang="en"><code class="literal">max-src-conn-rate</code> is the rate of new
	  connections allowed from any single host
	  (<em class="replaceable"><code>15</code></em>) per number of seconds
	  (<em class="replaceable"><code>5</code></em>).</p><p xml:lang="en" lang="en"><code class="literal">overload &lt;bruteforce&gt;</code> means
	  that any host which exceeds these limits gets its address
	  added to the <code class="literal">bruteforce</code> table.  The
	  ruleset blocks all traffic from addresses in the
	  <code class="literal">bruteforce</code> table.</p><p xml:lang="en" lang="en">Finally, <code class="literal">flush global</code> says that when
	  a host reaches the limit, that all
	  (<code class="literal">global</code>) of that host's connections will
	  be terminated (<code class="literal">flush</code>).</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">These rules will <span class="emphasis"><em>not</em></span> block slow
	    bruteforcers, as described in <a class="link" href="http://home.nuug.no/~peter/hailmary2013/" target="_top">http://home.nuug.no/~peter/hailmary2013/</a>.</p></div><p xml:lang="en" lang="en">This example ruleset is intended mainly as an
	  illustration.  For example, if a generous number of
	  connections in general are wanted, but the desire is to be
	  more restrictive when it comes to
	  <span class="application">ssh</span>, supplement the rule above
	  with something like the one below, early on in the rule
	  set:</p><pre xml:lang="en" class="programlisting" lang="en">pass quick proto { tcp, udp } from any to any port ssh \
    flags S/SA keep state \
    (max-src-conn 15, max-src-conn-rate 5/3, \
    overload &lt;bruteforce&gt; flush global)</pre><div xmlns="" class="note"><h3 class="admontitle">It May Not be Necessary to Block All
	    Overloaders: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">It is worth noting that the overload mechanism is a
	    general technique which does not apply exclusively to
	    <acronym class="acronym">SSH</acronym>, and it is not always optimal to
	    entirely block all traffic from offenders.</p><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">For example, an overload rule could be used to
	    protect a mail service or a web service, and the overload
	    table could be used in a rule to assign offenders to a
	    queue with a minimal bandwidth allocation or to redirect
	    to a specific web page.</p></div><p xml:lang="en" lang="en">Over time, tables will be filled by overload rules and
	  their size will grow incrementally, taking up more memory.
	  Sometimes an <acronym class="acronym">IP</acronym> address that is blocked
	  is a dynamically assigned one, which has since been assigned
	  to a host who has a legitimate reason to communicate with
	  hosts in the local network.</p><p xml:lang="en" lang="en">For situations like these,
	  <span class="application">pfctl</span> provides the ability to
	  expire table entries.  For example, this command will remove
	  <code class="literal">&lt;bruteforce&gt;</code> table entries which
	  have not been referenced for <code class="literal">86400</code>
	  seconds:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pfctl -t bruteforce -T expire 86400</code></strong></pre><p xml:lang="en" lang="en">Similar functionality is provided by
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/expiretable/pkg-descr">security/expiretable</a>, which removes table
	  entries which have not been accessed for a specified period
	  of time.</p><p xml:lang="en" lang="en">Once installed, <span class="application">expiretable</span>
	  can be run to remove <code class="literal">&lt;bruteforce&gt;</code>
	  table entries older than a specified age.  This example
	  removes all entries older than 24 hours:</p><pre xml:lang="en" class="programlisting" lang="en">/usr/local/sbin/expiretable -v -d -t 24h bruteforce</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pftut-spamd"></a>30.3.2.6. <acronym class="acronym">SPAM</acronym> 防護</h4></div></div></div><p xml:lang="en" lang="en">Not to be confused with the
	  <span class="application">spamd</span> daemon which comes bundled
	  with <span class="application">spamassassin</span>,
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/spamd/pkg-descr">mail/spamd</a> can be configured with
	  <span class="application">PF</span> to provide an outer defense
	  against <acronym class="acronym">SPAM</acronym>.  This
	  <span class="application">spamd</span> hooks into the
	  <span class="application">PF</span> configuration using a set of
	  redirections.</p><p xml:lang="en" lang="en">Spammers tend to send a large number of messages, and
	  <acronym class="acronym">SPAM</acronym> is mainly sent from a few spammer
	  friendly networks and a large number of hijacked machines,
	  both of which are reported to
	  <em class="firstterm">blacklists</em> fairly quickly.</p><p xml:lang="en" lang="en">When an <acronym class="acronym">SMTP</acronym> connection from an
	  address in a blacklist is received,
	  <span class="application">spamd</span> presents its banner and
	  immediately switches to a mode where it answers
	  <acronym class="acronym">SMTP</acronym> traffic one byte at a time.  This
	  technique, which is intended to waste as much time as
	  possible on the spammer's end, is called
	  <em class="firstterm">tarpitting</em>.  The specific
	  implementation which uses one byte <acronym class="acronym">SMTP</acronym>
	  replies is often referred to as
	  <em class="firstterm">stuttering</em>.</p><p xml:lang="en" lang="en">This example demonstrates the basic procedure for
	  setting up <span class="application">spamd</span> with
	  automatically updated blacklists.  Refer to the man pages
	  which are installed with <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/spamd/pkg-descr">mail/spamd</a> for
	  more information.</p><div class="procedure"><a id="idp85346616"></a><div class="procedure-title">過程 30.1. Configuring <span class="application">spamd</span></div><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">Install the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/spamd/pkg-descr">mail/spamd</a> package
	      or port.  To use <span class="application">spamd</span>'s
	      greylisting features, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fdescfs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fdescfs</span>(5)</span></a> must be mounted at
	      <code class="filename">/dev/fd</code>.  Add the following line to
	      <code class="filename">/etc/fstab</code>:</p><pre xml:lang="en" class="programlisting" lang="en"> fdescfs /dev/fd fdescfs rw 0 0</pre><p xml:lang="en" lang="en">Then, mount the filesystem:</p><pre xml:lang="en" class="programlisting" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount fdescfs</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">Next, edit the <span class="application">PF</span> ruleset
	      to include:</p><pre xml:lang="en" class="programlisting" lang="en">table &lt;spamd&gt; persist
table &lt;spamd-white&gt; persist
rdr pass on $ext_if inet proto tcp from &lt;spamd&gt; to \
    { $ext_if, $localnet } port smtp -&gt; 127.0.0.1 port 8025
rdr pass on $ext_if inet proto tcp from !&lt;spamd-white&gt; to \
    { $ext_if, $localnet } port smtp -&gt; 127.0.0.1 port 8025</pre><p xml:lang="en" lang="en">The two tables <code class="literal">&lt;spamd&gt;</code> and
	      <code class="literal">&lt;spamd-white&gt;</code> are essential.
	      <acronym class="acronym">SMTP</acronym> traffic from an address listed
	      in <code class="literal">&lt;spamd&gt;</code> but not in
	      <code class="literal">&lt;spamd-white&gt;</code> is redirected to
	      the <span class="application">spamd</span> daemon listening at
	      port 8025.</p></li><li class="step"><p xml:lang="en" lang="en">The next step is to configure
	      <span class="application">spamd</span> in
	      <code class="filename">/usr/local/etc/spamd.conf</code> and to
	      add some <code class="filename">rc.conf</code> parameters.</p><p xml:lang="en" lang="en">The installation of <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/spamd/pkg-descr">mail/spamd</a>
	      includes a sample configuration file
	      (<code class="filename">/usr/local/etc/spamd.conf.sample</code>)
	      and a man page for <code class="filename">spamd.conf</code>.
	      Refer to these for additional configuration options
	      beyond those shown in this example.</p><p xml:lang="en" lang="en">One of the first lines in the configuration file
	      that does not begin with a <code class="literal">#</code> comment
	      sign contains the block which defines the
	      <code class="literal">all</code> list, which specifies the lists
	      to use:</p><pre xml:lang="en" class="programlisting" lang="en">all:\
    :traplist:whitelist:</pre><p xml:lang="en" lang="en">This entry adds the desired blacklists, separated by
	      colons (<code class="literal">:</code>).  To use a whitelist to
	      subtract addresses from a blacklist, add the name of the
	      whitelist <span class="emphasis"><em>immediately</em></span> after the
	      name of that blacklist.  For example:
	      <code class="literal">:blacklist:whitelist:</code>.</p><p xml:lang="en" lang="en">This is followed by the specified blacklist's
	      definition:</p><pre xml:lang="en" class="programlisting" lang="en">traplist:\
    :black:\
    :msg="SPAM. Your address %A has sent spam within the last 24 hours":\
    :method=http:\
    :file=www.openbsd.org/spamd/traplist.gz</pre><p xml:lang="en" lang="en">where the first line is the name of the blacklist
	      and the second line specifies the list type.  The
	      <code class="literal">msg</code> field contains the message to
	      display to blacklisted senders during the
	      <acronym class="acronym">SMTP</acronym> dialogue.  The
	      <code class="literal">method</code> field specifies how
	      <span class="application">spamd-setup</span> fetches the list
	      data; supported methods are <code class="literal">http</code>,
	      <code class="literal">ftp</code>, from a
	      <code class="literal">file</code> in a mounted file system, and
	      via <code class="literal">exec</code> of an external program.
	      Finally, the <code class="literal">file</code> field specifies
	      the name of the file <span class="application">spamd</span>
	      expects to receive.</p><p xml:lang="en" lang="en">The definition of the specified whitelist is
	      similar, but omits the <code class="literal">msg</code> field
	      since a message is not needed:</p><pre xml:lang="en" class="programlisting" lang="en">whitelist:\
    :white:\
    :method=file:\
    :file=/var/mail/whitelist.txt</pre><div xmlns="" class="tip"><h3 class="admontitle">Choose Data Sources with Care: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Using all the blacklists in the sample
		<code class="filename">spamd.conf</code> will blacklist large
		blocks of the Internet.  Administrators need to edit
		the file to create an optimal configuration which uses
		applicable data sources and, when necessary, uses
		custom lists.</p></div><p xml:lang="en" lang="en">Next, add this entry to
	      <code class="filename">/etc/rc.conf</code>.  Additional flags are
	      described in the man page specified by the
	      comment:</p><pre xml:lang="en" class="programlisting" lang="en">spamd_flags="-v" # use "" and see spamd-setup(8) for flags</pre><p xml:lang="en" lang="en">When finished, reload the ruleset, start
	      <span class="application">spamd</span> by typing
	      <code class="command">service obspamd start</code>, and complete
	      the configuration using <code class="command">spamd-setup</code>.
	      Finally, create a <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> job which calls
	      <code class="command">spamd-setup</code> to update the tables at
	      reasonable intervals.</p></li></ol></div><p xml:lang="en" lang="en">On a typical gateway in front of a mail server, hosts
	  will soon start getting trapped within a few seconds to
	  several minutes.</p><p xml:lang="en" lang="en"><span class="application">PF</span> also supports
	  <em class="firstterm">greylisting</em>, which temporarily
	  rejects messages from unknown hosts with
	  <em class="replaceable"><code>45n</code></em> codes.  Messages from
	  greylisted hosts which try again within a reasonable time
	  are let through.  Traffic from senders which are set up to
	  behave within the limits set by RFC 1123 and RFC 2821 are
	  immediately let through.</p><p xml:lang="en" lang="en">More information about greylisting as a technique can be
	  found at the <a class="link" href="http://www.greylisting.org/" target="_top">greylisting.org</a>
	  web site.  The most amazing thing about greylisting, apart
	  from its simplicity, is that it still works.  Spammers and
	  malware writers have been very slow to adapt to bypass this
	  technique.</p><p xml:lang="en" lang="en">The basic procedure for configuring greylisting is as
	  follows:</p><div class="procedure"><a id="idp85446840"></a><div class="procedure-title">過程 30.2. Configuring Greylisting</div><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">Make sure that <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fdescfs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fdescfs</span>(5)</span></a> is mounted as
	      described in Step 1 of the previous Procedure.</p></li><li class="step"><p xml:lang="en" lang="en">To run <span class="application">spamd</span> in
	      greylisting mode, add this line to
	      <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">spamd_grey="YES"  # use spamd greylisting if YES</pre><p xml:lang="en" lang="en">Refer to the <span class="application">spamd</span> man
	      page for descriptions of additional related
	      parameters.</p></li><li class="step"><p xml:lang="en" lang="en">To complete the greylisting setup:</p><pre xml:lang="en" class="programlisting" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service obspamd restart</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service obspamlogd start</code></strong></pre></li></ol></div><p xml:lang="en" lang="en">Behind the scenes, the <span class="application">spamdb</span>
	  database tool and the <span class="application">spamlogd</span>
	  whitelist updater perform essential functions for the
	  greylisting feature.  <span class="application">spamdb</span> is
	  the administrator's main interface to managing the black,
	  grey, and white lists via the contents of the
	  <code class="filename">/var/db/spamdb</code> database.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pftut-hygiene"></a>30.3.2.7. 網路保健</h4></div></div></div><p xml:lang="en" lang="en">This section describes how
	  <code class="literal">block-policy</code>, <code class="literal">scrub</code>,
	  and <code class="literal">antispoof</code> can be used to make the
	  ruleset behave sanely.</p><p xml:lang="en" lang="en">The <code class="literal">block-policy</code> is an option which
	  can be set in the <code class="literal">options</code> part of the
	  ruleset, which precedes the redirection and filtering rules.
	  This option determines which feedback, if any,
	  <span class="application">PF</span> sends to hosts that are
	  blocked by a rule.  The option has two possible values:
	  <code class="literal">drop</code> drops blocked packets with no
	  feedback, and <code class="literal">return</code> returns a status
	  code such as
	  <code class="computeroutput">Connection refused</code>.</p><p xml:lang="en" lang="en">If not set, the default policy is
	  <code class="literal">drop</code>.  To change the
	  <code class="literal">block-policy</code>, specify the desired
	  value:</p><pre xml:lang="en" class="programlisting" lang="en">set block-policy return</pre><p xml:lang="en" lang="en">In <span class="application">PF</span>,
	  <code class="literal">scrub</code> is a keyword which enables network
	  packet normalization.  This process reassembles fragmented
	  packets and drops TCP packets that have invalid flag
	  combinations.  Enabling <code class="literal">scrub</code> provides a
	  measure of protection against certain kinds of attacks
	  based on incorrect handling of packet fragments.  A number
	  of options are available, but the simplest form is suitable
	  for most configurations:</p><pre xml:lang="en" class="programlisting" lang="en">scrub in all</pre><p xml:lang="en" lang="en">Some services, such as <acronym class="acronym">NFS</acronym>, require
	  specific fragment handling options.  Refer to <a class="link" href="https://home.nuug.no/~peter/pf/en/scrub.html" target="_top">https://home.nuug.no/~peter/pf/en/scrub.html</a>
	  for more information.</p><p xml:lang="en" lang="en">This example reassembles fragments, clears the
	  <span class="quote">“<span class="quote">do not fragment</span>”</span> bit, and sets the maximum
	  segment size to 1440 bytes:</p><pre xml:lang="en" class="programlisting" lang="en">scrub in all fragment reassemble no-df max-mss 1440</pre><p xml:lang="en" lang="en">The <code class="literal">antispoof</code> mechanism protects
	  against activity from spoofed or forged
	  <acronym class="acronym">IP</acronym> addresses, mainly by blocking packets
	  appearing on interfaces and in directions which are
	  logically not possible.</p><p xml:lang="en" lang="en">These rules weed out spoofed traffic coming in from the
	  rest of the world as well as any spoofed packets which
	  originate in the local network:</p><pre xml:lang="en" class="programlisting" lang="en">antispoof for $ext_if
antispoof for $int_if</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pftut-unrouteables"></a>30.3.2.8. 處理不可路由 (Non-Routable) 的位址</h4></div></div></div><p xml:lang="en" lang="en">Even with a properly configured gateway to handle
	  network address translation, one may have to compensate for
	  other people's misconfigurations.  A common misconfiguration
	  is to let traffic with non-routable addresses out to the
	  Internet.  Since traffic from non-routeable addresses can
	  play a part in several <acronym class="acronym">DoS</acronym> attack
	  techniques, consider explicitly blocking traffic from
	  non-routeable addresses from entering the network through
	  the external interface.</p><p xml:lang="en" lang="en">In this example, a macro containing non-routable
	  addresses is defined, then used in blocking rules.  Traffic
	  to and from these addresses is quietly dropped on the
	  gateway's external
	  interface.</p><pre xml:lang="en" class="programlisting" lang="en">martians = "{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, \
	      10.0.0.0/8, 169.254.0.0/16, 192.0.2.0/24, \
	      0.0.0.0/8, 240.0.0.0/4 }"

block drop in quick on $ext_if from $martians to any
block drop out quick on $ext_if from any to $martians</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85974712"></a>30.3.3. 開啟 <span class="application">ALTQ</span></h3></div></div></div><p xml:lang="en" lang="en">On FreeBSD, <span class="application">ALTQ</span> can be used with
	<span class="application">PF</span> to provide Quality of Service
	(<acronym class="acronym">QOS</acronym>).  Once
	<span class="application">ALTQ</span> is enabled, queues can be
	defined in the ruleset which determine the processing priority
	of outbound packets.</p><p xml:lang="en" lang="en">Before enabling <span class="application">ALTQ</span>, refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=altq&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">altq</span>(4)</span></a> to determine if the drivers for the network cards
	installed on the system support it.</p><p xml:lang="en" lang="en"><span class="application">ALTQ</span> is not available as a
	loadable kernel module.  If the system's interfaces support
	<span class="application">ALTQ</span>, create a custom kernel using
	the instructions in <a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a>.  The
	following kernel options are available.  The first is needed
	to enable <span class="application">ALTQ</span>.  At least one of
	the other options is necessary to specify the queueing
	scheduler algorithm:</p><pre xml:lang="en" class="programlisting" lang="en">options         ALTQ
options         ALTQ_CBQ        # Class Based Queuing (CBQ)
options         ALTQ_RED        # Random Early Detection (RED)
options         ALTQ_RIO        # RED In/Out
options         ALTQ_HFSC       # Hierarchical Packet Scheduler (HFSC)
options         ALTQ_PRIQ       # Priority Queuing (PRIQ)</pre><p xml:lang="en" lang="en">The following scheduler algorithms are available:</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en">CBQ</span></dt><dd><p xml:lang="en" lang="en">Class Based Queuing (<acronym class="acronym">CBQ</acronym>) is
	      used to divide a connection's bandwidth into different
	      classes or queues to prioritize traffic based on filter
	      rules.</p></dd><dt><span xml:lang="en" class="term" lang="en">RED</span></dt><dd><p xml:lang="en" lang="en">Random Early Detection (<acronym class="acronym">RED</acronym>) is
	      used to avoid network congestion by measuring the length
	      of the queue and comparing it to the minimum and maximum
	      thresholds for the queue.  When the queue is over the
	      maximum, all new packets are randomly dropped.</p></dd><dt><span xml:lang="en" class="term" lang="en">RIO</span></dt><dd><p xml:lang="en" lang="en">In Random Early Detection In and Out
	      (<acronym class="acronym">RIO</acronym>) mode, <acronym class="acronym">RED</acronym>
	      maintains multiple average queue lengths and multiple
	      threshold values, one for each
	      <acronym class="acronym">QOS</acronym> level.</p></dd><dt><span xml:lang="en" class="term" lang="en">HFSC</span></dt><dd><p xml:lang="en" lang="en">Hierarchical Fair Service Curve Packet Scheduler
	      (<acronym class="acronym">HFSC</acronym>) is described in <code class="uri"><a class="uri" href="http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html" target="_top">http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html</a></code>.</p></dd><dt><span xml:lang="en" class="term" lang="en">PRIQ</span></dt><dd><p xml:lang="en" lang="en">Priority Queuing (<acronym class="acronym">PRIQ</acronym>) always
	      passes traffic that is in a higher queue first.</p></dd></dl></div><p xml:lang="en" lang="en">More information about the scheduling
	algorithms and example rulesets are available at the <code class="uri"><a class="uri" href="https://web.archive.org/web/20151109213426/http://www.openbsd.org/faq/pf/queueing.html" target="_top">OpenBSD's web archive</a></code>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="firewalls-ipfw"></a>30.4. <span class="application">IPFW</span></h2></div></div></div><a id="idp86030008" class="indexterm"></a><p><span class="application">IPFW</span> 是一套專為 FreeBSD 所寫的具狀態防火牆 (Stateful firewall)，它同時支援 <acronym class="acronym">IPv4</acronym> 與 <acronym class="acronym">IPv6</acronym>，它由數個元件組成：核心防火牆過濾規則處理器與其整合的封包計帳設施、記錄設施、<acronym class="acronym">NAT</acronym>、<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dummynet&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dummynet</span>(4)</span></a> 流量限制程式、轉送設施、橋接設施以及 ipstealth 設施。</p><p>FreeBSD 提供一個範本規則集於 <code class="filename">/etc/rc.firewall</code>，其定義了幾個常見情境會使用的防火牆類型來協助初學的使用者撰寫合適的規則集。<span class="application">IPFW</span> 提供了強大的語法讓進階的使用者可以用來自訂符合環境安全性要求的規則集。</p><p>本節將介紹如何開啟 <span class="application">IPFW</span>、規則語法的概要以及示範幾種常見情境所使用的規則集。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="firewalls-ipfw-enable"></a>30.4.1. 開啟 <span class="application">IPFW</span></h3></div></div></div><a id="idp86041144" class="indexterm"></a><p xml:lang="en" lang="en"><span class="application">IPFW</span> is included in the basic
	FreeBSD install as a kernel loadable module, meaning that a
	custom kernel is not needed in order to enable
	<span class="application">IPFW</span>.</p><p xml:lang="en" lang="en">For those users who wish to statically compile
	<span class="application">IPFW</span> support into a custom kernel,
	see <a class="xref" href="#firewalls-ipfw-kernelconfig" title="30.4.6. IPFW 核心選項">節 30.4.6, “<span class="application">IPFW</span> 核心選項”</a>.</p><p xml:lang="en" lang="en">To configure the system to enable
	<span class="application">IPFW</span> at boot time, add
	<code class="literal">firewall_enable="YES"</code> to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysrc firewall_enable="YES"</code></strong></pre><p xml:lang="en" lang="en">To use one of the default firewall types provided by FreeBSD,
	add another line which specifies the type:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysrc firewall_type="open"</code></strong></pre><p xml:lang="en" lang="en">The available types are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">open</code>: passes all traffic.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">client</code>: protects only this
	    machine.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">simple</code>: protects the whole
	    network.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">closed</code>: entirely disables IP
	    traffic except for the loopback interface.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">workstation</code>: protects only this
	    machine using stateful rules.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">UNKNOWN</code>: disables the loading of
	    firewall rules.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="filename"><em class="replaceable"><code>filename</code></em></code>:
	    full path of the file containing the firewall
	    ruleset.</p></li></ul></div><p xml:lang="en" lang="en">If <code class="literal">firewall_type</code> is set to either
	<code class="literal">client</code> or <code class="literal">simple</code>,
	modify the default rules found in
	<code class="filename">/etc/rc.firewall</code> to fit the
	configuration of the system.</p><p xml:lang="en" lang="en">Note that the <code class="literal">filename</code> type is used to
	load a custom ruleset.</p><p xml:lang="en" lang="en">An alternate way to load a custom ruleset is to set the
	<code class="literal">firewall_script</code> variable to the absolute
	path of an <span class="emphasis"><em>executable script</em></span> that
	includes <span class="application">IPFW</span> commands.    The
	examples used in this section assume that the
	<code class="literal">firewall_script</code> is set to
	<code class="filename">/etc/ipfw.rules</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysrc firewall_script="/etc/ipfw.rules"</code></strong></pre><p xml:lang="en" lang="en">To enable logging through <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a>, include this
	line:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysrc firewall_logging="YES"</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Only firewall rules with the <code class="option">log</code> option will
	  be logged.  The default rules do not include this option and it
	  must be manually added.  Therefore it is advisable that the default
	  ruleset is edited for logging.  In addition, log rotation may be
	  desired if the logs are stored in a separate file.</p></div><p xml:lang="en" lang="en">There is no <code class="filename">/etc/rc.conf</code> variable to
	set logging limits.  To limit the number of times a rule is
	logged per connection attempt, specify the number using this
	line in <code class="filename">/etc/sysctl.conf</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>echo "net.inet.ip.fw.verbose_limit=<em class="replaceable"><code>5</code></em>" &gt;&gt; /etc/sysctl.conf</code></strong></pre><p xml:lang="en" lang="en">To enable logging through a dedicated interface named
	<code class="literal">ipfw0</code>, add this line to
	<code class="filename">/etc/rc.conf</code> instead:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysrc firewall_logif="YES"</code></strong></pre><p xml:lang="en" lang="en">Then use <span class="application">tcpdump</span> to see what is
	being logged:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>tcpdump -t -n -i ipfw0</code></strong></pre><div xmlns="" class="tip"><h3 class="admontitle">提示: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">There is no overhead due to logging unless
	  <span class="application">tcpdump</span> is attached.</p></div><p xml:lang="en" lang="en">After saving the needed edits, start the firewall.  To
	enable logging limits now, also set the
	<code class="command">sysctl</code> value specified above:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service ipfw start</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl net.inet.ip.fw.verbose_limit=<em class="replaceable"><code>5</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="firewalls-ipfw-rules"></a>30.4.2. <span class="application">IPFW</span> 規則語法</h3></div></div></div><a id="idp86092856" class="indexterm"></a><p xml:lang="en" lang="en">When a packet enters the <span class="application">IPFW</span>
	firewall, it is compared against the first rule in the ruleset
	and progresses one rule at a time, moving from top to bottom
	in sequence.  When the packet matches the selection parameters
	of a rule, the rule's action is executed and the search of the
	ruleset terminates for that packet.  This is referred to as
	<span class="quote">“<span class="quote">first match wins</span>”</span>.  If the packet does not match
	any of the rules, it gets caught by the mandatory
	<span class="application">IPFW</span> default rule number 65535,
	which denies all packets and silently discards them.  However,
	if the packet matches a rule that contains the
	<code class="literal">count</code>, <code class="literal">skipto</code>, or
	<code class="literal">tee</code> keywords, the search continues.  Refer
	to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a> for details on how these keywords affect rule
	processing.</p><a id="idp86101944" class="indexterm"></a><p xml:lang="en" lang="en">When creating an
	<span class="application">IPFW</span> rule, keywords must be
	written in the following order.  Some keywords are mandatory
	while other keywords are optional.  The words shown in
	uppercase represent a variable and the words shown in
	lowercase must precede the variable that follows it.  The
	<code class="literal">#</code> symbol is used to mark the start of a
	comment and may appear at the end of a rule or on its own
	line.  Blank lines are ignored.</p><p xml:lang="en" lang="en"><em class="replaceable"><code>CMD RULE_NUMBER set SET_NUMBER ACTION log
	  LOG_AMOUNT PROTO from SRC SRC_PORT to DST DST_PORT
	  OPTIONS</code></em></p><p xml:lang="en" lang="en">This section provides an overview of these keywords and
	their options.  It is not an exhaustive list of every possible
	option.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a> for a complete description of
	the rule syntax that can be used when creating
	<span class="application">IPFW</span> rules.</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en">CMD</span></dt><dd><p xml:lang="en" lang="en">Every rule must start with
	      <em class="parameter"><code>ipfw add</code></em>.</p></dd><dt><span xml:lang="en" class="term" lang="en">RULE_NUMBER</span></dt><dd><p xml:lang="en" lang="en">Each rule is associated with a number from
	      <code class="literal">1</code> to
	      <code class="literal">65534</code>.  The number is used to
	      indicate the order of rule processing.  Multiple rules
	      can have the same number, in which case they are applied
	      according to the order in which they have been
	      added.</p></dd><dt><span xml:lang="en" class="term" lang="en">SET_NUMBER</span></dt><dd><p xml:lang="en" lang="en">Each rule is associated with a set number from
	      <code class="literal">0</code> to <code class="literal">31</code>.
	      Sets can be individually disabled or enabled, making it
	      possible to quickly add or delete a set of rules.  If a
	      SET_NUMBER is not specified, the rule will be added to
	      set <code class="literal">0</code>.</p></dd><dt><span xml:lang="en" class="term" lang="en">ACTION</span></dt><dd><p xml:lang="en" lang="en">A rule can be associated with one of the following
	      actions.  The specified action will be executed when the
	      packet matches the selection criterion of the
	      rule.</p><p xml:lang="en" lang="en"><em class="parameter"><code>allow | accept | pass |
		permit</code></em>: these keywords are equivalent and
	      allow packets that match the rule.</p><p xml:lang="en" lang="en"><em class="parameter"><code>check-state</code></em>: checks the
	      packet against the dynamic state table.  If a match is
	      found, execute the action associated with the rule which
	      generated this dynamic rule, otherwise move to the next
	      rule.  A <code class="literal">check-state</code> rule does not
	      have selection criterion.  If no
	      <code class="literal">check-state</code> rule is present in the
	      ruleset, the dynamic rules table is checked at the first
	      <code class="literal">keep-state</code> or
	      <code class="literal">limit</code> rule.</p><p xml:lang="en" lang="en"><em class="parameter"><code>count</code></em>: updates counters for
	      all packets that match the rule.  The search continues
	      with the next rule.</p><p xml:lang="en" lang="en"><em class="parameter"><code>deny | drop</code></em>: either word
	      silently discards packets that match this rule.</p><p xml:lang="en" lang="en">Additional actions are available.  Refer to
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a> for details.</p></dd><dt><span xml:lang="en" class="term" lang="en">LOG_AMOUNT</span></dt><dd><p xml:lang="en" lang="en">When a packet matches a rule with the
	      <code class="literal">log</code> keyword, a message will be logged
	      to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a> with a facility name of
	      <code class="literal">SECURITY</code>.  Logging only occurs if the
	      number of packets logged for that particular rule does
	      not exceed a specified LOG_AMOUNT.  If no
	      LOG_AMOUNT is specified, the limit is taken from the
	      value of
	      <code class="varname">net.inet.ip.fw.verbose_limit</code>.  A
	      value of zero removes the logging limit.  Once the limit
	      is reached, logging can be re-enabled by clearing the
	      logging counter or the packet counter for that rule,
	      using <code class="command">ipfw resetlog</code>.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Logging is done after all other packet matching
		conditions have been met, and before performing the
		final action on the packet.  The administrator decides
		which rules to enable logging on.</p></div></dd><dt><span xml:lang="en" class="term" lang="en">PROTO</span></dt><dd><p xml:lang="en" lang="en">This optional value can be used to specify any
	      protocol name or number found in
	      <code class="filename">/etc/protocols</code>.</p></dd><dt><span xml:lang="en" class="term" lang="en">SRC</span></dt><dd><p xml:lang="en" lang="en">The <code class="literal">from</code> keyword must be followed
	      by the source address or a keyword that represents the
	      source address.  An address can be represented by
	      <code class="literal">any</code>, <code class="literal">me</code> (any
	      address configured on an interface on this system),
	      <code class="literal">me6</code>, (any <acronym class="acronym">IPv6</acronym>
	      address configured on an interface on this system), or
	      <code class="literal">table</code> followed by the number of a
	      lookup table which contains a list of addresses.  When
	      specifying an <acronym class="acronym">IP</acronym> address, it can be
	      optionally followed by its <acronym class="acronym">CIDR</acronym> mask
	      or subnet mask.  For example,
	      <code class="literal">1.2.3.4/25</code> or
	      <code class="literal">1.2.3.4:255.255.255.128</code>.</p></dd><dt><span xml:lang="en" class="term" lang="en">SRC_PORT</span></dt><dd><p xml:lang="en" lang="en">An optional source port can be specified using the
	      port number or name from
	      <code class="filename">/etc/services</code>.</p></dd><dt><span xml:lang="en" class="term" lang="en">DST</span></dt><dd><p xml:lang="en" lang="en">The <code class="literal">to</code> keyword must be followed
	      by the destination address or a keyword that represents
	      the destination address.  The same keywords and
	      addresses described in the SRC section can be used to
	      describe the destination.</p></dd><dt><span xml:lang="en" class="term" lang="en">DST_PORT</span></dt><dd><p xml:lang="en" lang="en">An optional destination port can be specified using
	      the port number or name from
	      <code class="filename">/etc/services</code>.</p></dd><dt><span xml:lang="en" class="term" lang="en">OPTIONS</span></dt><dd><p xml:lang="en" lang="en">Several keywords can follow the source and
	      destination.  As the name suggests, OPTIONS are
	      optional.  Commonly used options include
	      <code class="literal">in</code> or <code class="literal">out</code>, which
	      specify the direction of packet flow,
	      <code class="literal">icmptypes</code> followed by the type of
	      <acronym class="acronym">ICMP</acronym> message, and
	      <code class="literal">keep-state</code>.</p><p xml:lang="en" lang="en">When a <em class="parameter"><code>keep-state</code></em> rule is
	      matched, the firewall will create a dynamic rule which
	      matches bidirectional traffic between the source and
	      destination addresses and ports using the same
	      protocol.</p><p xml:lang="en" lang="en">The dynamic rules facility is vulnerable to resource
	      depletion from a SYN-flood attack which would open a
	      huge number of dynamic rules.  To counter this type of
	      attack with  <span class="application">IPFW</span>, use
	      <code class="literal">limit</code>.  This option limits the number
	      of simultaneous sessions by checking the open dynamic
	      rules, counting the number of times this rule and
	      <acronym class="acronym">IP</acronym> address combination occurred.  If
	      this count is greater than the value specified by
	      <code class="literal">limit</code>, the packet is
	      discarded.</p><p xml:lang="en" lang="en">Dozens of OPTIONS are available.  Refer to
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a> for a description of each available
	      option.</p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86162488"></a>30.4.3. 範例規則集</h3></div></div></div><p xml:lang="en" lang="en">This section demonstrates how to create an example
	stateful firewall ruleset script named
	<code class="filename">/etc/ipfw.rules</code>.  In this example, all
	connection rules use <code class="literal">in</code> or
	<code class="literal">out</code> to clarify the direction.  They also
	use <code class="literal">via</code>
	<em class="replaceable"><code>interface-name</code></em> to specify
	the interface the packet is traveling over.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">When first creating or testing a firewall ruleset,
	  consider temporarily setting this tunable:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="programlisting" lang="en">net.inet.ip.fw.default_to_accept="1"</pre><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">This sets the default policy of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a> to be more
	  permissive than the default <code class="literal">deny ip from any to
	    any</code>, making it slightly more difficult to get
	  locked out of the system right after a reboot.</p></div><p xml:lang="en" lang="en">The firewall script begins by indicating that it is a
	Bourne shell script and flushes any existing rules.  It then
	creates the <code class="literal">cmd</code> variable so that
	<code class="literal">ipfw add</code> does not have to be typed at the
	beginning of every rule.  It also defines the
	<code class="literal">pif</code> variable which represents the name of
	the interface that is attached to the Internet.</p><pre xml:lang="en" class="programlisting" lang="en">#!/bin/sh
# Flush out the list before we begin.
ipfw -q -f flush

# Set rules command prefix
cmd="ipfw -q add"
pif="dc0"     # interface name of NIC attached to Internet</pre><p xml:lang="en" lang="en">The first two rules allow all traffic on the trusted
	internal interface and on the loopback interface:</p><pre xml:lang="en" class="programlisting" lang="en"># Change xl0 to LAN NIC interface name
$cmd 00005 allow all from any to any via xl0

# No restrictions on Loopback Interface
$cmd 00010 allow all from any to any via lo0</pre><p xml:lang="en" lang="en">The next rule allows the packet through if it matches an
	existing entry in the dynamic rules table:</p><pre xml:lang="en" class="programlisting" lang="en">$cmd 00101 check-state</pre><p xml:lang="en" lang="en">The next set of rules defines which stateful connections
	internal systems can create to hosts on the Internet:</p><pre xml:lang="en" class="programlisting" lang="en"># Allow access to public DNS
# Replace x.x.x.x with the IP address of a public DNS server
# and repeat for each DNS server in /etc/resolv.conf
$cmd 00110 allow tcp from any to x.x.x.x 53 out via $pif setup keep-state
$cmd 00111 allow udp from any to x.x.x.x 53 out via $pif keep-state

# Allow access to ISP's DHCP server for cable/DSL configurations.
# Use the first rule and check log for IP address.
# Then, uncomment the second rule, input the IP address, and delete the first rule
$cmd 00120 allow log udp from any to any 67 out via $pif keep-state
#$cmd 00120 allow udp from any to x.x.x.x 67 out via $pif keep-state

# Allow outbound HTTP and HTTPS connections
$cmd 00200 allow tcp from any to any 80 out via $pif setup keep-state
$cmd 00220 allow tcp from any to any 443 out via $pif setup keep-state

# Allow outbound email connections
$cmd 00230 allow tcp from any to any 25 out via $pif setup keep-state
$cmd 00231 allow tcp from any to any 110 out via $pif setup keep-state

# Allow outbound ping
$cmd 00250 allow icmp from any to any out via $pif keep-state

# Allow outbound NTP
$cmd 00260 allow udp from any to any 123 out via $pif keep-state

# Allow outbound SSH
$cmd 00280 allow tcp from any to any 22 out via $pif setup keep-state

# deny and log all other outbound connections
$cmd 00299 deny log all from any to any out via $pif</pre><p xml:lang="en" lang="en">The next set of rules controls connections from Internet
	hosts to the internal network.  It starts by denying packets
	typically associated with attacks and then explicitly allows
	specific types of connections.  All the authorized services
	that originate from the Internet use <code class="literal">limit</code>
	to prevent flooding.</p><pre xml:lang="en" class="programlisting" lang="en"># Deny all inbound traffic from non-routable reserved address spaces
$cmd 00300 deny all from 192.168.0.0/16 to any in via $pif     #RFC 1918 private IP
$cmd 00301 deny all from 172.16.0.0/12 to any in via $pif      #RFC 1918 private IP
$cmd 00302 deny all from 10.0.0.0/8 to any in via $pif         #RFC 1918 private IP
$cmd 00303 deny all from 127.0.0.0/8 to any in via $pif        #loopback
$cmd 00304 deny all from 0.0.0.0/8 to any in via $pif          #loopback
$cmd 00305 deny all from 169.254.0.0/16 to any in via $pif     #DHCP auto-config
$cmd 00306 deny all from 192.0.2.0/24 to any in via $pif       #reserved for docs
$cmd 00307 deny all from 204.152.64.0/23 to any in via $pif    #Sun cluster interconnect
$cmd 00308 deny all from 224.0.0.0/3 to any in via $pif        #Class D &amp; E multicast

# Deny public pings
$cmd 00310 deny icmp from any to any in via $pif

# Deny ident
$cmd 00315 deny tcp from any to any 113 in via $pif

# Deny all Netbios services.
$cmd 00320 deny tcp from any to any 137 in via $pif
$cmd 00321 deny tcp from any to any 138 in via $pif
$cmd 00322 deny tcp from any to any 139 in via $pif
$cmd 00323 deny tcp from any to any 81 in via $pif

# Deny fragments
$cmd 00330 deny all from any to any frag in via $pif

# Deny ACK packets that did not match the dynamic rule table
$cmd 00332 deny tcp from any to any established in via $pif

# Allow traffic from ISP's DHCP server.
# Replace x.x.x.x with the same IP address used in rule 00120.
#$cmd 00360 allow udp from any to x.x.x.x 67 in via $pif keep-state

# Allow HTTP connections to internal web server
$cmd 00400 allow tcp from any to me 80 in via $pif setup limit src-addr 2

# Allow inbound SSH connections
$cmd 00410 allow tcp from any to me 22 in via $pif setup limit src-addr 2

# Reject and log all other incoming connections
$cmd 00499 deny log all from any to any in via $pif</pre><p xml:lang="en" lang="en">The last rule logs all packets that do not match any of
	the rules in the ruleset:</p><pre xml:lang="en" class="programlisting" lang="en"># Everything else is denied and logged
$cmd 00999 deny log all from any to any</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="in-kernel-nat"></a>30.4.4. 核心內 <acronym class="acronym">NAT</acronym></h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Chern</span> <span class="surname">Lee</span></span>. </span></div><div><span class="authorgroup">Rewritten and updated by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Dries</span> <span class="surname">Michiels</span></span>. </span></div></div></div><a id="idp86252344" class="indexterm"></a><p xml:lang="en" lang="en">FreeBSD's <span class="application">IPFW</span> firewall has two
	implementations of <acronym class="acronym">NAT</acronym>: one being the
	userland <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> daemon, and the more recent
	<span class="application">IPFW</span>'s built-in
	<acronym class="acronym">NAT</acronym> facility also known as in-kernel
	<acronym class="acronym">NAT</acronym>.  Both work in conjunction with
	<span class="application">IPFW</span> to provide network address
	translation.  This can be used to provide an Internet
	Connection Sharing solution so that several internal computers
	can connect to the Internet using a single public
	<acronym class="acronym">IP</acronym> address.</p><p xml:lang="en" lang="en">To do this, the FreeBSD machine connected to the Internet
	must act as a gateway.  This system must have two
	<acronym class="acronym">NIC</acronym>s, where one is connected to the
	Internet and the other is connected to the internal
	<acronym class="acronym">LAN</acronym>.  Each machine connected to the
	<acronym class="acronym">LAN</acronym> should be assigned an
	<acronym class="acronym">IP</acronym> address in the private network space, as
	defined by <a class="link" href="https://www.ietf.org/rfc/rfc1918.txt" target="_top">RFC
	1918</a>.</p><p xml:lang="en" lang="en">Some additional configuration is needed in order to enable
	the in-kernel <acronym class="acronym">NAT</acronym> function of
	<span class="application">IPFW</span>.  To enable in-kernel
	<acronym class="acronym">NAT</acronym> support at boot time, the following
	must be set in <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">gateway_enable="YES"
firewall_enable="YES"
firewall_nat_enable="YES"</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">When <code class="literal">firewall_enable</code> is not set,
	  but <code class="literal">firewall_nat_enable</code> is, it will have
	  no effect and do nothing, because the in-kernel
	  <acronym class="acronym">NAT</acronym> implementation is only compatible
	  with <span class="application">IPFW</span>.</p></div><p xml:lang="en" lang="en">When the ruleset contains stateful rules, the positioning
	of the <acronym class="acronym">NAT</acronym> rule is critical and the
	<code class="literal">skipto</code> action is used.  The
	<code class="literal">skipto</code> action requires a rule number so
	that it knows which rule to jump to.  Furthermore, because
	of the architecture of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=libalias&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">libalias</span>(3)</span></a>, a library implemented
	as a kernel module used for the in-kernel
	<acronym class="acronym">NAT</acronym> facility of
	<span class="application">IPFW</span>, it is necessary to disable
	TCP segmentation offloading, or in short
	<acronym class="acronym">TSO</acronym>.  <acronym class="acronym">TSO</acronym> can be
	disabled on a per network interface basis by using
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> or on a system wide basis using
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.  To disable <acronym class="acronym">TSO</acronym> system
	wide, the following must be set in
	<code class="filename">/etc/sysctl.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">net.inet.tcp.tso="0"</pre><p xml:lang="en" lang="en">The example below builds upon the firewall ruleset
	shown in the previous section.  It adds some additional
	entries and modifies some existing rules in order to configure
	the firewall for in-kernel <acronym class="acronym">NAT</acronym>.  It starts
	by adding some additional variables which represent the rule
	number to skip to, the <code class="literal">keep-state</code> option,
	and a list of <acronym class="acronym">TCP</acronym> ports which will be used
	to reduce the number of rules.</p><pre xml:lang="en" class="programlisting" lang="en">#!/bin/sh
ipfw -q -f flush
cmd="ipfw -q add"
skip="skipto 1000"
pif=dc0
ks="keep-state"
good_tcpo="22,25,37,53,80,443,110"</pre><p xml:lang="en" lang="en">A <acronym class="acronym">NAT</acronym> instance will also be
	configured.  With in-kernel <acronym class="acronym">NAT</acronym> it is
	possible to have multiple <acronym class="acronym">NAT</acronym> instances
	each with their own configuration.  Although, for this example
	only one <acronym class="acronym">NAT</acronym> instance is needed;
	<acronym class="acronym">NAT</acronym> instance number 1.  The configuration
	takes a few arguments and flags such as: <code class="option">if</code>
	which indicates the public interface,
	<code class="option">same_ports</code> which takes care that alliased
	ports and local port numbers are mapped the same,
	<code class="option">unreg_only</code> will result in only unregistered
	(private) address spaces to be processed by the
	<acronym class="acronym">NAT</acronym> instance, and <code class="option">reset</code>
	which will help to keep a functioning <acronym class="acronym">NAT</acronym>
	instance even when the public <acronym class="acronym">IP</acronym> address of
	the <span class="application">IPFW</span> machine changes.  For all
	possible options that can be passed to a single
	<acronym class="acronym">NAT</acronym> instance configuration consult
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a>.  Furthermore, because of the nature of a
	stateful <acronym class="acronym">NAT</acronym>ing firewall, it is neseccary
	to allow translated packets to be reinjected in the firewall
	for further processing, this can be achieved by disabling
	<code class="option">one_pass</code> behavior at the start of the
	firewall script.</p><pre xml:lang="en" class="programlisting" lang="en">ipfw disable one_pass
ipfw -q nat 1 config if $pif same_ports unreg_only reset</pre><p xml:lang="en" lang="en">The inbound <acronym class="acronym">NAT</acronym> rule is inserted
	<span class="emphasis"><em>after</em></span> the two rules which allow all
	traffic on the trusted and loopback interfaces and after the
	reassamble rule but <span class="emphasis"><em>before</em></span> the
	<code class="literal">check-state</code> rule.  It is important that the
	rule number selected for this <acronym class="acronym">NAT</acronym> rule, in
	this example <code class="literal">100</code>, is higher than the first
	three rules and lower than the <code class="literal">check-state</code>
	rule.  Furthermore, because of the behavior of in-kernel
	<acronym class="acronym">NAT</acronym> it is advised to place a reassamble
	rule just before the first <acronym class="acronym">NAT</acronym> rule and
	after the rules that allow traffic on trusted interface.
	Normally, <acronym class="acronym">IP</acronym> fragmentation should not
	happen, but when dealing with <acronym class="acronym">IPSEC/ESP/GRE</acronym>
	tunneling traffic it might and the reassmabling of fragments
	is necessary before handing the complete packet over to the
	in-kernel <acronym class="acronym">NAT</acronym> engine.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The reassemble rule was not needed with userland
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> because the internal workings of the
	  <span class="application">IPFW</span> <code class="literal">divert</code>
	  action already takes care of this automatically as also
	  stated in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a>.</p><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The current <acronym class="acronym">NAT</acronym> instance number and
	  <acronym class="acronym">NAT</acronym> rule number does not match with the
	  default <acronym class="acronym">NAT</acronym> instance number and rule
	  number created by <code class="filename">rc.firewall</code> which is
	  a script to set up the baked-in default firewall rulesets
	  present in FreeBSD.</p></div><pre xml:lang="en" class="programlisting" lang="en">$cmd 005 allow all from any to any via xl0  # exclude LAN traffic
$cmd 010 allow all from any to any via lo0  # exclude loopback traffic
$cmd 099 reass all from any to any in       # reassamble inbound packets
$cmd 100 nat 1 ip from any to any in via $pif # NAT any inbound packets
# Allow the packet through if it has an existing entry in the dynamic rules table
$cmd 101 check-state</pre><p xml:lang="en" lang="en">The outbound rules are modified to replace the
	<code class="literal">allow</code> action with the
	<code class="literal">$skip</code> variable, indicating that rule
	processing will continue at rule <code class="literal">1000</code>.  The
	seven <code class="literal">tcp</code> rules have been replaced by rule
	<code class="literal">125</code> as the
	<code class="literal">$good_tcpo</code> variable contains the
	seven allowed outbound ports.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Remember that <span class="application">IPFW</span>'s
	  firewall performance is largely determined by the number of
	  rules present in the ruleset.</p></div><pre xml:lang="en" class="programlisting" lang="en"># Authorized outbound packets
$cmd 120 $skip udp from any to x.x.x.x 53 out via $pif $ks
$cmd 121 $skip udp from any to x.x.x.x 67 out via $pif $ks
$cmd 125 $skip tcp from any to any $good_tcpo out via $pif setup $ks
$cmd 130 $skip icmp from any to any out via $pif $ks</pre><p xml:lang="en" lang="en">The inbound rules remain the same, except for the very
	last rule which removes the <code class="literal">via $pif</code> in
	order to catch both inbound and outbound rules.  The
	<acronym class="acronym">NAT</acronym> rule must follow this last outbound
	rule, must have a higher number than that last rule, and the
	rule number must be referenced by the
	<code class="literal">skipto</code> action.  In this ruleset, rule
	number <code class="literal">1000</code> handles passing all packets to
	our configured instance for <acronym class="acronym">NAT</acronym> processing.
	The next rule allows any packet which has undergone
	<acronym class="acronym">NAT</acronym> processing to pass.</p><pre xml:lang="en" class="programlisting" lang="en">$cmd 999 deny log all from any to any
$cmd 1000 nat 1 ip from any to any out via $pif # skipto location for outbound stateful rules
$cmd 1001 allow ip from any to any</pre><p xml:lang="en" lang="en">In this example, rules <code class="literal">100</code>,
	<code class="literal">101</code>, <code class="literal">125</code>,
	<code class="literal">1000</code>, and <code class="literal">1001</code> control
	the address translation of the outbound and inbound packets so
	that the entries in the dynamic state table always register
	the private <acronym class="acronym">LAN</acronym> <acronym class="acronym">IP</acronym>
	address.</p><p xml:lang="en" lang="en">Consider an internal web browser which initializes a new
	outbound <acronym class="acronym">HTTP</acronym> session over port 80.  When
	the first outbound packet enters the firewall, it does not
	match rule <code class="literal">100</code> because it is headed out
	rather than in.  It passes rule <code class="literal">101</code> because
	this is the first packet and it has not been posted to the
	dynamic state table yet.  The packet finally matches rule
	<code class="literal">125</code> as it is outbound on an allowed port
	and has a source <acronym class="acronym">IP</acronym> address from the
	internal <acronym class="acronym">LAN</acronym>.  On matching this rule, two
	actions take place.  First, the <code class="literal">keep-state</code>
	action adds an entry to the dynamic state table and the
	specified action, <code class="literal">skipto rule 1000</code>, is
	executed.  Next, the packet undergoes <acronym class="acronym">NAT</acronym>
	and is sent out to the Internet.  This packet makes its way to
	the destination web server, where a response packet is
	generated and sent back.  This new packet enters the top of
	the ruleset.  It matches rule <code class="literal">100</code> and has
	its destination <acronym class="acronym">IP</acronym> address mapped back to
	the original internal address.  It then is processed by the
	<code class="literal">check-state</code> rule, is found in the table as
	an existing session, and is released to the
	<acronym class="acronym">LAN</acronym>.</p><p xml:lang="en" lang="en">On the inbound side, the ruleset has to deny bad packets
	and allow only authorized services.  A packet which matches an
	inbound rule is posted to the dynamic state table and the
	packet is released to the <acronym class="acronym">LAN</acronym>.  The packet
	generated as a response is recognized by the
	<code class="literal">check-state</code> rule as belonging to an
	existing session.  It is then sent to rule
	<code class="literal">1000</code> to undergo
	<acronym class="acronym">NAT</acronym> before being released to the outbound
	interface.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Transition from userland <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> to in-kernel
	  <acronym class="acronym">NAT</acronym> might seem seamless at first but
	  there is small catch.  When using the GENERIC kernel,
	  <span class="application">IPFW</span> will load the
	  <code class="filename">libalias.ko</code>
	  kernel module, when <code class="literal">firewall_nat_enable</code>
	  is enabled in <code class="filename">rc.conf</code>.  Although, the
	  loaded module only provides basic <acronym class="acronym">NAT</acronym>
	  functionality, whereas the userland implementation
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> has all functionality available without any
	  extra configuration from its userland library.  All
	  functionality refers to the following kernel modules that
	  can additionally be loaded when needed besides the standard
	  <code class="filename">libalias.ko</code> kernel module:
	  <code class="filename">alias_cuseeme.ko</code>,
	  <code class="filename">alias_ftp.ko</code>,
	  <code class="filename">alias_bbt.ko</code>,
	  <code class="filename">skinny.ko</code>, <code class="filename">irc.ko</code>,
	  <code class="filename">alias_pptp.ko</code> and
	  <code class="filename">alias_smedia.ko</code> using the
	  <code class="literal">kld_list</code> directive in
	  <code class="filename">rc.conf</code> to mimic the full functionality
	  of the userland implementation.  If a custom kernel is used,
	  the full functionality of the userland library can be
	  compiled in, in the kernel, using the <code class="option">option
	  LIBALIAS</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86353464"></a>30.4.4.1. Port 重新導向</h4></div></div></div><p xml:lang="en" lang="en">The drawback with <acronym class="acronym">NAT</acronym> in general is
	  that the <acronym class="acronym">LAN</acronym> clients are not accessible
	  from the Internet.  Clients on the <acronym class="acronym">LAN</acronym>
	  can make outgoing connections to the world but cannot
	  receive incoming ones.  This presents a problem if trying to
	  run Internet services on one of the <acronym class="acronym">LAN</acronym>
	  client machines.  A simple way around this is to redirect
	  selected Internet ports on the <acronym class="acronym">NAT</acronym>
	  providing machine to a <acronym class="acronym">LAN</acronym> client.</p><p xml:lang="en" lang="en">For example, an <acronym class="acronym">IRC</acronym> server runs on
	  client <code class="systemitem">A</code> and a web server runs on
	  client <code class="systemitem">B</code>.  For this to work
	  properly, connections received on ports 6667
	  (<acronym class="acronym">IRC</acronym>) and 80 (<acronym class="acronym">HTTP</acronym>)
	  must be redirected to the respective machines.</p><p xml:lang="en" lang="en">With in-kernel <acronym class="acronym">NAT</acronym> all configuration
	  is done in the <acronym class="acronym">NAT</acronym> instance
	  configuration.  For a full list of options that an in-kernel
	  <acronym class="acronym">NAT</acronym> instance can use, consult
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a>.  The <span class="application">IPFW</span> syntax
	  follows the syntax of <span class="application">natd</span>.  The
	  syntax for <code class="option">redirect_port</code> is as
	  follows:</p><pre xml:lang="en" class="programlisting" lang="en">redirect_port proto targetIP:targetPORT[-targetPORT]
  [aliasIP:]aliasPORT[-aliasPORT]
  [remoteIP[:remotePORT[-remotePORT]]]</pre><p xml:lang="en" lang="en">To configure the above example setup, the arguments
	should be:</p><pre xml:lang="en" class="programlisting" lang="en">redirect_port tcp 192.168.0.2:6667 6667
redirect_port tcp 192.168.0.3:80 80</pre><p xml:lang="en" lang="en">After adding these arguments to the configuration of
	  <acronym class="acronym">NAT</acronym> instance 1 in the above ruleset, the
	  <acronym class="acronym">TCP</acronym> ports will be port forwarded to the
	  <acronym class="acronym">LAN</acronym> client machines running the
	  <acronym class="acronym">IRC</acronym> and <acronym class="acronym">HTTP</acronym>
	  services.</p><pre xml:lang="en" class="programlisting" lang="en">ipfw -q nat 1 config if $pif same_ports unreg_only reset \
  redirect_port tcp 192.168.0.2:6667 6667 \
  redirect_port tcp 192.1683.0.3:80 80</pre><p xml:lang="en" lang="en">Port ranges over individual ports can be indicated with
	  <code class="option">redirect_port</code>.  For example,
	  <em class="replaceable"><code>tcp 192.168.0.2:2000-3000
	  2000-3000</code></em> would redirect all connections
	  received on ports 2000 to 3000 to ports 2000 to 3000 on
	  client <code class="systemitem">A</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86373432"></a>30.4.4.2. 位址重新導向</h4></div></div></div><p xml:lang="en" lang="en">Address redirection is useful if more than one
	  <acronym class="acronym">IP</acronym> address is available.  Each
	  <acronym class="acronym">LAN</acronym> client can be assigned its own
	  external <acronym class="acronym">IP</acronym> address by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a>,
	  which will then rewrite outgoing packets from the
	  <acronym class="acronym">LAN</acronym> clients with the proper external
	  <acronym class="acronym">IP</acronym> address and redirects all traffic
	  incoming on that particular <acronym class="acronym">IP</acronym> address
	  back to the specific <acronym class="acronym">LAN</acronym> client.  This is
	  also known as static <acronym class="acronym">NAT</acronym>.  For example,
	  if <acronym class="acronym">IP</acronym> addresses <code class="systemitem">128.1.1.1</code>, <code class="systemitem">128.1.1.2</code>, and <code class="systemitem">128.1.1.3</code> are available,
	  <code class="systemitem">128.1.1.1</code> can be
	  used as the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a> machine's external
	  <acronym class="acronym">IP</acronym> address, while <code class="systemitem">128.1.1.2</code> and <code class="systemitem">128.1.1.3</code> are forwarded
	  back to <acronym class="acronym">LAN</acronym> clients
	  <code class="systemitem">A</code> and
	  <code class="systemitem">B</code>.</p><p xml:lang="en" lang="en">The <code class="option">redirect_address</code> syntax is as
	  below, where <code class="literal">localIP</code> is the internal
	  <acronym class="acronym">IP</acronym> address of the <acronym class="acronym">LAN</acronym>
	  client, and <code class="literal">publicIP</code> the external
	  <acronym class="acronym">IP</acronym> address corresponding to the
	  <acronym class="acronym">LAN</acronym> client.</p><pre xml:lang="en" class="programlisting" lang="en">redirect_address localIP publicIP</pre><p xml:lang="en" lang="en">In the example, the arguments would read:</p><pre xml:lang="en" class="programlisting" lang="en">redirect_address 192.168.0.2 128.1.1.2
redirect_address 192.168.0.3 128.1.1.3</pre><p xml:lang="en" lang="en">Like <code class="option">redirect_port</code>, these arguments
	  are placed in a <acronym class="acronym">NAT</acronym> instance
	  configuration.  With address redirection, there is no
	  need for port redirection, as all data received on a
	  particular <acronym class="acronym">IP</acronym> address is
	  redirected.</p><p xml:lang="en" lang="en">The external <acronym class="acronym">IP</acronym> addresses on the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a> machine must be active and aliased to the
	  external interface.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> for
	  details.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86405432"></a>30.4.4.3. Userspace <acronym class="acronym">NAT</acronym></h4></div></div></div><p xml:lang="en" lang="en">Let us start with a statement: the userspace
	  <acronym class="acronym">NAT</acronym> implementation: <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a>, has
	  more overhead than in-kernel <acronym class="acronym">NAT</acronym>. For
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> to translate packets, the packets have to be
	  copied from the kernel to userspace and back which brings in
	  extra overhead that is not present with in-kernel
	  <acronym class="acronym">NAT</acronym>.</p><p>要在開機時啟動 Userspace 的 <acronym class="acronym">NAT</acronym> daemon <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> 需在 <code class="filename">/etc/rc.conf</code> 中做以下最小設定，其中 <code class="option">natd_interface</code> 要設成連接到網際網路的 <acronym class="acronym">NIC</acronym> 名稱，<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> script of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> 會自動檢查是否有使用動態 <acronym class="acronym">IP</acronym> 位址，並且自行設定並處理。</p><pre xml:lang="en" class="programlisting" lang="en">gateway_enable="YES"
natd_enable="YES"
natd_interface="rl0"</pre><p xml:lang="en" lang="en">In general, the above ruleset as explained for in-kernel
	  <acronym class="acronym">NAT</acronym> can also be used together with
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a>.  The only exceptions are the configuration of
	  the in-kernel <acronym class="acronym">NAT</acronym> instance <code class="literal">(ipfw
	  -q nat 1 config ...)</code> not being applicable any
	  more, rule number 100 and 1000 will have to change sligthly
	  as below, and reassemble rule 99 is not needed anymore
	  as the <code class="option">divert</code> action is used which covers
	  fragmentation.</p><pre xml:lang="en" class="programlisting" lang="en">$cmd 100 divert natd ip from any to any in via $pif
$cmd 1000 divert natd ip from any to any out via $pif</pre><p xml:lang="en" lang="en">To configure port or address redirection, a similar
	  syntax as with in-kernel <acronym class="acronym">NAT</acronym> is used.
	  Although, now, instead of specifying the configuration in
	  our ruleset script like with in-kernel
	  <acronym class="acronym">NAT</acronym>, configuration of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> is
	  best done in a configuration file.  To do this, an extra
	  flag must be passed via <code class="filename">/etc/rc.conf</code>
	  which specifies the path of the configuration file.</p><pre xml:lang="en" class="programlisting" lang="en">natd_flags="-f /etc/natd.conf"</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The specified file must contain a list of
	    configuration options, one per line.  For more information
	    about the configuration file and possible variables,
	    consult <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a>.  Below are two example
	    entries, one per line:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="programlisting" lang="en">redirect_port tcp 192.168.0.2:6667 6667
redirect_address 192.168.0.3 128.1.1.3</pre></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="firewalls-ipfw-cmd"></a>30.4.5. <span class="application">IPFW</span> 指令</h3></div></div></div><a id="idp86432696" class="indexterm"></a><p xml:lang="en" lang="en"><code class="command">ipfw</code> can be used to make manual,
	single rule additions or deletions to the active firewall
	while it is running.  The problem with using this method is
	that all the changes are lost when the system reboots.  It is
	recommended to instead write all the rules in a file and to
	use that file to load the rules at boot time and to replace
	the currently running firewall rules whenever that file
	changes.</p><p xml:lang="en" lang="en"><code class="command">ipfw</code> is a useful way to display the
	running firewall rules to the console screen.  The
	<span class="application">IPFW</span> accounting facility
	dynamically creates a counter for each rule that counts each
	packet that matches the rule.  During the process of testing a
	rule, listing the rule with its counter is one way to
	determine if the rule is functioning as expected.</p><p xml:lang="en" lang="en">To list all the running rules in sequence:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ipfw list</code></strong></pre><p xml:lang="en" lang="en">To list all the running rules with a time stamp of when
	the last time the rule was matched:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ipfw -t list</code></strong></pre><p xml:lang="en" lang="en">The next example lists accounting information and the
	packet count for matched rules along with the rules
	themselves.  The first column is the rule number, followed by
	the number of matched packets and bytes, followed by the rule
	itself.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ipfw -a list</code></strong></pre><p xml:lang="en" lang="en">To list dynamic rules in addition to static rules:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ipfw -d list</code></strong></pre><p xml:lang="en" lang="en">To also show the expired dynamic rules:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ipfw -d -e list</code></strong></pre><p xml:lang="en" lang="en">To zero the counters:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ipfw zero</code></strong></pre><p xml:lang="en" lang="en">To zero the counters for just the rule with number
	<em class="replaceable"><code>NUM</code></em>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ipfw zero <em class="replaceable"><code>NUM</code></em></code></strong></pre><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86450872"></a>30.4.5.1. 記錄防火牆訊息</h4></div></div></div><a id="idp86451512" class="indexterm"></a><p xml:lang="en" lang="en">Even with the logging facility enabled,
	  <span class="application">IPFW</span> will not generate any rule
	  logging on its own.  The firewall administrator decides
	  which rules in the ruleset will be logged, and adds the
	  <code class="literal">log</code> keyword to those rules.  Normally
	  only deny rules are logged.  It is customary to duplicate
	  the <span class="quote">“<span class="quote">ipfw default deny everything</span>”</span> rule with
	  the <code class="literal">log</code> keyword included as the last rule
	  in the ruleset.  This way, it is possible to see all the
	  packets that did not match any of the rules in the
	  ruleset.</p><p xml:lang="en" lang="en">Logging is a two edged sword.  If one is not careful,
	  an over abundance of log data or a DoS attack can fill the
	  disk with log files.  Log messages are not only written to
	  <span class="application">syslogd</span>, but also are displayed
	  on the root console screen and soon become annoying.</p><p xml:lang="en" lang="en">The <code class="literal">IPFIREWALL_VERBOSE_LIMIT=5</code>
	  kernel option limits the number of consecutive messages
	  sent to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a>, concerning the packet matching of a
	  given rule.  When this option is enabled in the kernel, the
	  number of consecutive messages concerning a particular rule
	  is capped at the number specified.  There is nothing to be
	  gained from 200 identical log messages.  With this option
	  set to five,
	  five consecutive messages concerning a particular rule
	  would be logged to <span class="application">syslogd</span> and
	  the remainder identical consecutive messages would be
	  counted and posted to <span class="application">syslogd</span>
	  with a phrase like the following:</p><pre xml:lang="en" class="programlisting" lang="en">last message repeated 45 times</pre><p xml:lang="en" lang="en">All logged packets messages are written by default to
	  <code class="filename">/var/log/security</code>, which is
	  defined in <code class="filename">/etc/syslog.conf</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="firewalls-ipfw-rules-script"></a>30.4.5.2. 建立規則 Script</h4></div></div></div><p xml:lang="en" lang="en">Most experienced <span class="application">IPFW</span> users
	  create a file containing the rules and code them in a manner
	  compatible with running them as a script.  The major benefit
	  of doing this is the firewall rules can be refreshed in mass
	  without the need of rebooting the system to activate them.
	  This method is convenient in testing new rules as the
	  procedure can be executed as many times as needed.  Being a
	  script, symbolic substitution can be used for frequently
	  used values to be substituted into multiple rules.</p><p xml:lang="en" lang="en">This example script is compatible with the syntax used
	  by the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a>,  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=csh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">csh</span>(1)</span></a>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tcsh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tcsh</span>(1)</span></a> shells.
	  Symbolic substitution fields are prefixed with a dollar sign
	  ($).  Symbolic fields do not have the $
	  prefix.  The value to populate the symbolic field must be
	  enclosed in double quotes ("").</p><p xml:lang="en" lang="en">Start the rules file like this:</p><pre xml:lang="en" class="programlisting" lang="en">############### start of example ipfw rules script #############
#
ipfw -q -f flush       # Delete all rules
# Set defaults
oif="tun0"             # out interface
odns="192.0.2.11"      # ISP's DNS server IP address
cmd="ipfw -q add "     # build rule prefix
ks="keep-state"        # just too lazy to key this each time
$cmd 00500 check-state
$cmd 00502 deny all from any to any frag
$cmd 00501 deny tcp from any to any established
$cmd 00600 allow tcp from any to any 80 out via $oif setup $ks
$cmd 00610 allow tcp from any to $odns 53 out via $oif setup $ks
$cmd 00611 allow udp from any to $odns 53 out via $oif $ks
################### End of example ipfw rules script ############</pre><p xml:lang="en" lang="en">The rules are not important as the focus of this example
	  is how the symbolic substitution fields are
	  populated.</p><p xml:lang="en" lang="en">If the above example was in
	  <code class="filename">/etc/ipfw.rules</code>, the rules could be
	  reloaded by the following command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sh /etc/ipfw.rules</code></strong></pre><p xml:lang="en" lang="en"><code class="filename">/etc/ipfw.rules</code> can be located
	  anywhere and the file can have any name.</p><p xml:lang="en" lang="en">The same thing could be accomplished by running these
	  commands by hand:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ipfw -q -f flush</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ipfw -q add check-state</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ipfw -q add deny all from any to any frag</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ipfw -q add deny tcp from any to any established</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ipfw -q add allow tcp from any to any 80 out via tun0 setup keep-state</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ipfw -q add allow tcp from any to 192.0.2.11 53 out via tun0 setup keep-state</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ipfw -q add 00611 allow udp from any to 192.0.2.11 53 out via tun0 keep-state</code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="firewalls-ipfw-kernelconfig"></a>30.4.6. <span class="application">IPFW</span> 核心選項</h3></div></div></div><a id="idp86513336" class="indexterm"></a><a id="idp86514232" class="indexterm"></a><a id="idp86515128" class="indexterm"></a><a id="idp86516024" class="indexterm"></a><p xml:lang="en" lang="en">In order to statically compile
	<span class="application">IPFW</span> support into a custom kernel,
	refer to the instructions in <a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a>.
	The following options are available for the
	custom kernel configuration file:</p><pre xml:lang="en" class="programlisting" lang="en">options    IPFIREWALL			# enables IPFW
options    IPFIREWALL_VERBOSE		# enables logging for rules with log keyword to syslogd(8)
options    IPFIREWALL_VERBOSE_LIMIT=5	# limits number of logged packets per-entry
options    IPFIREWALL_DEFAULT_TO_ACCEPT # sets default policy to pass what is not explicitly denied
options    IPFIREWALL_NAT		# enables in-kernel NAT support
options    IPFIREWALL_NAT64		# enables in-kernel NAT64 support
options    IPFIREWALL_NPTV6		# enables in-kernel IPv6 NPT support
options    IPFIREWALL_PMOD		# enables protocols modification module support
options    IPDIVERT			# enables NAT through natd(8)</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><span class="application">IPFW</span> can be loaded as
	  a kernel module: options above are built by default
	  as modules or can be set at runtime using tunables.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="firewalls-ipf"></a>30.5. IPFILTER (IPF)</h2></div></div></div><a id="idp86542136" class="indexterm"></a><p><span class="application">IPFILTER</span> 即為 <span class="application">IPF</span>，是一套跨平台、開放源碼的防火牆，已被移植到各種作業系統，包含 FreeBSD, NetBSD, OpenBSD 與 <span class="trademark">Solaris</span>™。</p><p><span class="application">IPFILTER</span> 是核心端 (Kernel-side) 的防火牆且 <acronym class="acronym">NAT</acronym> 機制可由 Userland 的程式控制與監控，防火牆規則可以使用 <span class="application">ipf</span> 設定或刪除，<acronym class="acronym">NAT</acronym> 規則可以使用 <span class="application">ipnat</span> 設定或刪除，可使用 <span class="application">ipfstat</span> 來列出 <span class="application">IPFILTER</span> 在核心部份的執行期統計資訊，可使用 <span class="application">ipmon</span> 來記錄 <span class="application">IPFILTER</span> 動作到系統記錄檔。</p><p><span class="application">IPF</span> 原來是以 <span class="quote">“<span class="quote">最後一個符合的條件優先</span>”</span> 的規則處理邏輯所撰寫並只能使用無狀態 (Stateless) 的規則，之後 <span class="application">IPF</span> 才被加強支援快速 (<code class="literal">quick</code>) 與保留狀態 (<code class="literal">keep state</code>) 的選項。</p><p><span class="application">IPF</span> FAQ 位於 <code class="uri"><a class="uri" href="http://www.phildev.net/ipf/index.html" target="_top">http://www.phildev.net/ipf/index.html</a></code>，可搜尋的 IPFilter 郵遞論壇封存資料可至 <code class="uri"><a class="uri" href="http://marc.info/?l=ipfilter" target="_top">http://marc.info/?l=ipfilter</a></code> 取得。</p><p>由於 FreeBSD 也支援 <span class="application">IPF</span> 因此操作手冊特別在此章節對此介紹，本節提供幾個有使用快速 (<code class="literal">quick</code>) 與保留狀態 (<code class="literal">keep state</code>) 選項的規則範例。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86558264"></a>30.5.1. 開啟 <span class="application">IPF</span></h3></div></div></div><a id="idp86559160" class="indexterm"></a><p xml:lang="en" lang="en"><span class="application">IPF</span> is included in the basic
	FreeBSD install as a kernel loadable module, meaning that a
	custom kernel is not needed in order to enable
	<span class="application">IPF</span>.</p><a id="idp86561720" class="indexterm"></a><a id="idp86562744" class="indexterm"></a><a id="idp86563640" class="indexterm"></a><a id="idp86564536" class="indexterm"></a><p xml:lang="en" lang="en">For users who prefer to statically compile
	<span class="application">IPF</span> support into a custom kernel,
	refer to the instructions in <a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a>.
	The following kernel options are available:</p><pre xml:lang="en" class="programlisting" lang="en">options IPFILTER
options IPFILTER_LOG
options IPFILTER_LOOKUP
options IPFILTER_DEFAULT_BLOCK</pre><p xml:lang="en" lang="en">where <code class="literal">options IPFILTER</code> enables support
	for <span class="application">IPFILTER</span>,
	<code class="literal">options IPFILTER_LOG</code> enables
	<span class="application">IPF</span> logging using the
	<code class="filename">ipl</code> packet logging pseudo-device for
	every rule that has the <code class="literal">log</code> keyword,
	<code class="literal">IPFILTER_LOOKUP</code> enables
	<acronym class="acronym">IP</acronym> pools in order to speed up
	<acronym class="acronym">IP</acronym> lookups, and <code class="literal">options
	  IPFILTER_DEFAULT_BLOCK</code> changes the default
	behavior so that any packet not matching a firewall
	<code class="literal">pass</code> rule gets blocked.</p><p xml:lang="en" lang="en">To configure the system to enable
	<span class="application">IPF</span> at boot time, add the following
	entries to <code class="filename">/etc/rc.conf</code>.  These entries
	will also enable logging and <code class="literal">default pass
	  all</code>.  To change the default policy to
	<code class="literal">block all</code> without  compiling a custom
	kernel, remember to add a <code class="literal">block all</code> rule at
	the end of the ruleset.</p><pre xml:lang="en" class="programlisting" lang="en">ipfilter_enable="YES"             # Start ipf firewall
ipfilter_rules="/etc/ipf.rules"   # loads rules definition text file
ipmon_enable="YES"                # Start IP monitor log
ipmon_flags="-Ds"                 # D = start as daemon
                                  # s = log to syslog
                                  # v = log tcp window, ack, seq
                                  # n = map IP &amp; port to names</pre><p xml:lang="en" lang="en">If <acronym class="acronym">NAT</acronym> functionality is needed, also
	add these lines:</p><pre xml:lang="en" class="programlisting" lang="en">gateway_enable="YES"              # Enable as LAN gateway
ipnat_enable="YES"                # Start ipnat function
ipnat_rules="/etc/ipnat.rules"    # rules definition file for ipnat</pre><p xml:lang="en" lang="en">Then, to start <span class="application">IPF</span> now:</p><pre xml:lang="en" class="programlisting" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service ipfilter start</code></strong></pre><p xml:lang="en" lang="en">To load the firewall rules, specify the name of the
	ruleset file using <code class="command">ipf</code>.  The following
	command can be used to replace the currently running firewall
	rules:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ipf -Fa -f /etc/ipf.rules</code></strong></pre><p xml:lang="en" lang="en">where <code class="option">-Fa</code> flushes all the internal rules
	tables and <code class="option">-f</code> specifies the file containing
	the rules to load.</p><p xml:lang="en" lang="en">This provides the ability to make changes to a custom
	ruleset and update the running firewall with a fresh copy of
	the rules without having to reboot the system.  This method is
	convenient for testing new rules as the procedure can be
	executed as many times as needed.</p><p xml:lang="en" lang="en">Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipf</span>(8)</span></a> for details on the other flags
	available with this command.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86596152"></a>30.5.2. <span class="application">IPF</span> 規則語法</h3></div></div></div><a id="idp86597048" class="indexterm"></a><p xml:lang="en" lang="en">This section describes the <span class="application">IPF</span>
	rule syntax used to create stateful rules.  When creating
	rules, keep in mind that unless the <code class="literal">quick</code>
	keyword appears in a rule, every rule is read in order, with
	the <span class="emphasis"><em>last  matching rule</em></span> being the one
	that is applied.  This means that even if the first rule to
	match a packet is a <code class="literal">pass</code>, if there is a
	later matching rule that is a <code class="literal">block</code>, the
	packet will be dropped.  Sample rulesets can be found in
	<code class="filename">/usr/share/examples/ipfilter</code>.</p><p xml:lang="en" lang="en">When creating rules, a <code class="literal">#</code> character is
	used to mark the start of a comment and may appear at the end
	of a rule, to explain that rule's function, or on its own
	line.  Any blank lines are ignored.</p><p xml:lang="en" lang="en">The keywords which are used in rules must be written in a
	specific order, from left to right.  Some keywords are
	mandatory while others are optional.  Some keywords have
	sub-options which may be keywords themselves and also include
	more sub-options.  The keyword order is as follows, where the
	words shown in uppercase represent a variable and the words
	shown in lowercase must precede the variable that follows
	it:</p><p xml:lang="en" lang="en"><em class="replaceable"><code>ACTION DIRECTION OPTIONS proto PROTO_TYPE
	  from SRC_ADDR SRC_PORT to DST_ADDR DST_PORT
	  TCP_FLAG|ICMP_TYPE keep state STATE</code></em></p><p xml:lang="en" lang="en">This section describes each of these keywords and their
	options.  It is not an exhaustive list of every possible
	option.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipf</span>(5)</span></a> for a complete description of
	the rule syntax that can be used when creating
	<span class="application">IPF</span> rules and examples for using
	each keyword.</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en">ACTION</span></dt><dd><p xml:lang="en" lang="en">The action keyword indicates what to do with the
	      packet if it matches that rule.  Every rule
	      <span class="emphasis"><em>must</em></span> have an action.  The
	      following actions are recognized:</p><p xml:lang="en" lang="en"><code class="literal">block</code>: drops the packet.</p><p xml:lang="en" lang="en"><code class="literal">pass</code>: allows the packet.</p><p xml:lang="en" lang="en"><code class="literal">log</code>: generates a log
	      record.</p><p xml:lang="en" lang="en"><code class="literal">count</code>: counts the number of
	      packets and bytes which can provide an indication of
	      how often a rule is used.</p><p xml:lang="en" lang="en"><code class="literal">auth</code>: queues the packet for
	      further processing by another program.</p><p xml:lang="en" lang="en"><code class="literal">call</code>: provides access to
	      functions built into <span class="application">IPF</span> that
	      allow more complex actions.</p><p xml:lang="en" lang="en"><code class="literal">decapsulate</code>: removes any headers
	      in order to process the contents of the packet.</p></dd><dt><span xml:lang="en" class="term" lang="en">DIRECTION</span></dt><dd><p xml:lang="en" lang="en">Next, each rule must explicitly state the direction
	      of traffic using one of these keywords:</p><p xml:lang="en" lang="en"><code class="literal">in</code>: the rule is applied against
	      an inbound packet.</p><p xml:lang="en" lang="en"><code class="literal">out</code>: the rule is applied against
	      an outbound packet.</p><p xml:lang="en" lang="en"><code class="literal">all</code>: the rule applies to either
	      direction.</p><p xml:lang="en" lang="en">If the system has multiple interfaces, the interface
	      can be specified along with the direction.  An example
	      would be <code class="literal">in on fxp0</code>.</p></dd><dt><span xml:lang="en" class="term" lang="en">OPTIONS</span></dt><dd><p xml:lang="en" lang="en">Options are optional.  However, if multiple options
	      are specified, they must be used in the order shown
	      here.</p><p xml:lang="en" lang="en"><code class="literal">log</code>: when performing the
	      specified ACTION, the contents of the packet's headers
	      will be written to the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipl&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipl</span>(4)</span></a> packet log
	      pseudo-device.</p><p xml:lang="en" lang="en"><code class="literal">quick</code>: if a packet matches this
	      rule, the ACTION specified by the rule occurs and no
	      further processing of any following rules will occur for
	      this packet.</p><p xml:lang="en" lang="en"><code class="literal">on</code>: must be followed by the
	      interface name as displayed by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>.  The
	      rule will only match if the packet is going through the
	      specified interface in the specified direction.</p><p xml:lang="en" lang="en">When using the
	      <code class="literal">log</code> keyword, the following qualifiers
	      may be used in this order:</p><p xml:lang="en" lang="en"><code class="literal">body</code>: indicates that the first
	      128 bytes of the packet contents will be logged after
	      the headers.</p><p xml:lang="en" lang="en"><code class="literal">first</code>:  if the
	      <code class="literal">log</code> keyword is being used in
	      conjunction with a <code class="literal">keep state</code> option,
	      this option is recommended so that only the triggering
	      packet is logged and not every packet which matches the
	      stateful connection.</p><p xml:lang="en" lang="en">Additional options are available to specify error
	      return messages.  Refer to  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipf</span>(5)</span></a> for more
	      details.</p></dd><dt><span xml:lang="en" class="term" lang="en">PROTO_TYPE</span></dt><dd><p xml:lang="en" lang="en">The protocol type is optional.  However, it is
	      mandatory if the rule needs to specify a SRC_PORT or
	      a DST_PORT as it defines the type of protocol.  When
	      specifying the type of protocol, use the
	      <code class="literal">proto</code> keyword followed by either a
	      protocol number or name from
	      <code class="filename">/etc/protocols</code>.
	      Example protocol names include <code class="literal">tcp</code>,
	      <code class="literal">udp</code>, or <code class="literal">icmp</code>.  If
	      PROTO_TYPE is specified but no SRC_PORT or DST_PORT is
	      specified, all port numbers for that protocol will match
	      that rule.</p></dd><dt><span xml:lang="en" class="term" lang="en">SRC_ADDR</span></dt><dd><p xml:lang="en" lang="en">The <code class="literal">from</code> keyword is mandatory and
	      is followed by a keyword which represents the source of
	      the packet.  The source can be a hostname, an
	      <acronym class="acronym">IP</acronym> address followed by the
	      <acronym class="acronym">CIDR</acronym> mask, an address pool, or the
	      keyword <code class="literal">all</code>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipf</span>(5)</span></a>
	      for examples.</p><p xml:lang="en" lang="en">There is no way to match ranges of
	      <acronym class="acronym">IP</acronym> addresses which do not express
	      themselves easily using the dotted numeric form /
	      mask-length notation.  The
	      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/ipcalc/pkg-descr">net-mgmt/ipcalc</a> package or port may
	      be used to ease the calculation of the
	      <acronym class="acronym">CIDR</acronym> mask.  Additional information is
	      available at the utility's web page: <code class="uri"><a class="uri" href="http://jodies.de/ipcalc" target="_top">http://jodies.de/ipcalc</a></code>.</p></dd><dt><span xml:lang="en" class="term" lang="en">SRC_PORT</span></dt><dd><p xml:lang="en" lang="en">The port number of the source is optional.  However,
	      if it is used, it requires PROTO_TYPE to be first
	      defined in the rule.  The port number must also be
	      preceded by the <code class="literal">proto</code> keyword.</p><p xml:lang="en" lang="en">A number of different comparison operators are
	      supported: <code class="literal">=</code> (equal to),
	      <code class="literal">!=</code> (not equal to),
	      <code class="literal">&lt;</code> (less than),
	      <code class="literal">&gt;</code> (greater than),
	      <code class="literal">&lt;=</code> (less than or equal to), and
	      <code class="literal">&gt;=</code> (greater than or equal
	      to).</p><p xml:lang="en" lang="en">To specify port ranges, place the two port numbers
	      between <code class="literal">&lt;&gt;</code> (less than and
	      greater than ), <code class="literal">&gt;&lt;</code> (greater
	      than and less than ), or <code class="literal">:</code> (greater
	      than or equal to and less than or equal to).</p></dd><dt><span xml:lang="en" class="term" lang="en">DST_ADDR</span></dt><dd><p xml:lang="en" lang="en">The <code class="literal">to</code> keyword is mandatory and
	      is followed by a keyword which represents the
	      destination of the packet.  Similar to SRC_ADDR, it can
	      be a hostname, an  <acronym class="acronym">IP</acronym> address
	      followed by the <acronym class="acronym">CIDR</acronym> mask, an address
	      pool, or the keyword <code class="literal">all</code>.</p></dd><dt><span xml:lang="en" class="term" lang="en">DST_PORT</span></dt><dd><p xml:lang="en" lang="en">Similar to SRC_PORT, the port number of the
	      destination is optional.  However, if it is used, it
	      requires PROTO_TYPE to be first defined in the rule.
	      The port number must also be preceded by the
	      <code class="literal">proto</code> keyword.</p></dd><dt><span xml:lang="en" class="term" lang="en">TCP_FLAG|ICMP_TYPE</span></dt><dd><p xml:lang="en" lang="en">If <code class="literal">tcp</code> is specified as the
	      PROTO_TYPE, flags can be specified as letters, where
	      each letter represents one of the possible
	      <acronym class="acronym">TCP</acronym> flags used to determine the state
	      of a connection.  Possible values are:
	      <code class="literal">S</code> (SYN),
	      <code class="literal">A</code> (ACK),
	      <code class="literal">P</code> (PSH),
	      <code class="literal">F</code> (FIN),
	      <code class="literal">U</code> (URG),
	      <code class="literal">R</code> (RST),
	      <code class="literal">C</code> (CWN), and
	      <code class="literal">E</code> (ECN).</p><p xml:lang="en" lang="en">If <code class="literal">icmp</code> is specified as the
	      PROTO_TYPE, the <acronym class="acronym">ICMP</acronym> type to match
	      can be specified.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipf</span>(5)</span></a> for the
	      allowable types.</p></dd><dt><span xml:lang="en" class="term" lang="en">STATE</span></dt><dd><p xml:lang="en" lang="en">If a <code class="literal">pass</code> rule contains
	      <code class="literal">keep state</code>,
	      <span class="application">IPF</span> will add an entry to its
	      dynamic state table and allow subsequent packets that
	      match the connection.
	      <span class="application">IPF</span> can track state for
	      <acronym class="acronym">TCP</acronym>, <acronym class="acronym">UDP</acronym>, and
	      <acronym class="acronym">ICMP</acronym> sessions.  Any packet that
	      <span class="application">IPF</span> can be certain is part of
	      an active session, even if it is a different protocol,
	      will be allowed.</p><p xml:lang="en" lang="en">In <span class="application">IPF</span>, packets destined
	      to go out through the interface connected to the public
	      Internet are first checked against the dynamic state
	      table.  If the packet matches the next expected packet
	      comprising an active session conversation, it exits the
	      firewall and the state of the session conversation flow
	      is updated in the dynamic state table.  Packets that do
	      not belong to an already active session are checked
	      against the outbound ruleset.  Packets coming in from
	      the interface connected to the public Internet are first
	      checked against the dynamic state table.  If the packet
	      matches the next expected packet comprising an active
	      session, it exits the firewall and the state of the
	      session conversation flow is updated in the dynamic
	      state table.  Packets that do not belong to an already
	      active session are checked against the inbound
	      ruleset.</p><p xml:lang="en" lang="en">Several keywords can be added after
	      <code class="literal">keep state</code>.  If used, these keywords
	      set various options that control stateful filtering,
	      such as setting connection limits or connection age.
	      Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipf</span>(5)</span></a> for the list of available options
	      and their descriptions.</p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86691256"></a>30.5.3. 範例規則集</h3></div></div></div><p xml:lang="en" lang="en">This section demonstrates how to create an example ruleset
	which only allows services matching
	<code class="literal">pass</code> rules and blocks all others.</p><p xml:lang="en" lang="en">FreeBSD uses the loopback interface
	(<code class="filename">lo0</code>) and the <acronym class="acronym">IP</acronym>
	address <code class="systemitem">127.0.0.1</code>
	for internal communication.  The firewall ruleset must contain
	rules to allow free movement of these internally used
	packets:</p><pre xml:lang="en" class="programlisting" lang="en"># no restrictions on loopback interface
pass in quick on lo0 all
pass out quick on lo0 all</pre><p xml:lang="en" lang="en">The public interface connected to the Internet is used to
	authorize and control access of all outbound and inbound
	connections.  If one or more interfaces are cabled to private
	networks, those internal interfaces may require rules to allow
	packets originating from the <acronym class="acronym">LAN</acronym> to flow
	between the internal networks or to the interface attached to
	the Internet.  The ruleset should be organized into three
	major sections: any trusted internal interfaces, outbound
	connections through the public interface, and inbound
	connections through the public interface.</p><p xml:lang="en" lang="en">These two rules allow all traffic to pass through a
	trusted <acronym class="acronym">LAN</acronym> interface named
	<code class="filename">xl0</code>:</p><pre xml:lang="en" class="programlisting" lang="en"># no restrictions on inside LAN interface for private network
pass out quick on xl0 all
pass in quick on xl0 all</pre><p xml:lang="en" lang="en">The rules for the public interface's outbound and inbound
	sections should have the most frequently matched rules placed
	before less commonly matched rules, with the last rule in the
	section blocking and logging all packets for that interface
	and direction.</p><p xml:lang="en" lang="en">This set of rules defines the outbound section of the
	public interface named <code class="filename">dc0</code>.  These rules
	keep state and identify the specific services that internal
	systems are authorized for public Internet access.  All the
	rules use <code class="literal">quick</code> and specify the
	appropriate port numbers and, where applicable, destination
	addresses.</p><pre xml:lang="en" class="programlisting" lang="en"># interface facing Internet (outbound)
# Matches session start requests originating from or behind the
# firewall, destined for the Internet.

# Allow outbound access to public DNS servers.
# Replace x.x.x. with address listed in /etc/resolv.conf.
# Repeat for each DNS server.
pass out quick on dc0 proto tcp from any to x.x.x. port = 53 flags S keep state
pass out quick on dc0 proto udp from any to xxx port = 53 keep state

# Allow access to ISP's specified DHCP server for cable or DSL networks.
# Use the first rule, then check log for the IP address of DHCP server.
# Then, uncomment the second rule, replace z.z.z.z with the IP address,
# and comment out the first rule
pass out log quick on dc0 proto udp from any to any port = 67 keep state
#pass out quick on dc0 proto udp from any to z.z.z.z port = 67 keep state

# Allow HTTP and HTTPS
pass out quick on dc0 proto tcp from any to any port = 80 flags S keep state
pass out quick on dc0 proto tcp from any to any port = 443 flags S keep state

# Allow email
pass out quick on dc0 proto tcp from any to any port = 110 flags S keep state
pass out quick on dc0 proto tcp from any to any port = 25 flags S keep state

# Allow NTP
pass out quick on dc0 proto tcp from any to any port = 37 flags S keep state

# Allow FTP
pass out quick on dc0 proto tcp from any to any port = 21 flags S keep state

# Allow SSH
pass out quick on dc0 proto tcp from any to any port = 22 flags S keep state

# Allow ping
pass out quick on dc0 proto icmp from any to any icmp-type 8 keep state

# Block and log everything else
block out log first quick on dc0 all</pre><p xml:lang="en" lang="en">This example of the rules in the inbound section of the
	public interface blocks all undesirable packets first.  This
	reduces the number of packets that are logged by the last
	rule.</p><pre xml:lang="en" class="programlisting" lang="en"># interface facing Internet (inbound)
# Block all inbound traffic from non-routable or reserved address spaces
block in quick on dc0 from 192.168.0.0/16 to any    #RFC 1918 private IP
block in quick on dc0 from 172.16.0.0/12 to any     #RFC 1918 private IP
block in quick on dc0 from 10.0.0.0/8 to any        #RFC 1918 private IP
block in quick on dc0 from 127.0.0.0/8 to any       #loopback
block in quick on dc0 from 0.0.0.0/8 to any         #loopback
block in quick on dc0 from 169.254.0.0/16 to any    #DHCP auto-config
block in quick on dc0 from 192.0.2.0/24 to any      #reserved for docs
block in quick on dc0 from 204.152.64.0/23 to any   #Sun cluster interconnect
block in quick on dc0 from 224.0.0.0/3 to any       #Class D &amp; E multicast

# Block fragments and too short tcp packets
block in quick on dc0 all with frags
block in quick on dc0 proto tcp all with short

# block source routed packets
block in quick on dc0 all with opt lsrr
block in quick on dc0 all with opt ssrr

# Block OS fingerprint attempts and log first occurrence
block in log first quick on dc0 proto tcp from any to any flags FUP

# Block anything with special options
block in quick on dc0 all with ipopts

# Block public pings and ident
block in quick on dc0 proto icmp all icmp-type 8
block in quick on dc0 proto tcp from any to any port = 113

# Block incoming Netbios services
block in log first quick on dc0 proto tcp/udp from any to any port = 137
block in log first quick on dc0 proto tcp/udp from any to any port = 138
block in log first quick on dc0 proto tcp/udp from any to any port = 139
block in log first quick on dc0 proto tcp/udp from any to any port = 81</pre><p xml:lang="en" lang="en">Any time there are logged messages on a rule with
	the <code class="literal">log first</code> option, run
	<code class="command">ipfstat -hio</code> to evaluate how many times the
	rule has been matched.  A large number of matches may indicate
	that the system is under attack.</p><p xml:lang="en" lang="en">The rest of the rules in the inbound section define which
	connections are allowed to be initiated from the Internet.
	The last rule denies all connections which were not explicitly
	allowed by previous rules in this section.</p><pre xml:lang="en" class="programlisting" lang="en"># Allow traffic in from ISP's DHCP server. Replace z.z.z.z with
# the same IP address used in the outbound section.
pass in quick on dc0 proto udp from z.z.z.z to any port = 68 keep state

# Allow public connections to specified internal web server
pass in quick on dc0 proto tcp from any to x.x.x.x port = 80 flags S keep state

# Block and log only first occurrence of all remaining traffic.
block in log first quick on dc0 all</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86740536"></a>30.5.4. 設定 <acronym class="acronym">NAT</acronym></h3></div></div></div><a id="idp86741432" class="indexterm"></a><a id="idp86742072" class="indexterm"></a><a id="idp86747448" class="indexterm"></a><a id="idp86748728" class="indexterm"></a><p xml:lang="en" lang="en">To enable <acronym class="acronym">NAT</acronym>, add these statements
	to <code class="filename">/etc/rc.conf</code> and specify the name of
	the file containing the <acronym class="acronym">NAT</acronym> rules:</p><pre xml:lang="en" class="programlisting" lang="en">gateway_enable="YES"
ipnat_enable="YES"
ipnat_rules="/etc/ipnat.rules"</pre><p xml:lang="en" lang="en"><acronym class="acronym">NAT</acronym> rules are flexible and can
	accomplish many different things to fit the needs of both
	commercial and home users.  The rule syntax presented here has
	been simplified to demonstrate common usage.  For a complete
	rule syntax description, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipnat&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipnat</span>(5)</span></a>.</p><p xml:lang="en" lang="en">The basic syntax for a <acronym class="acronym">NAT</acronym> rule is as
	follows, where <code class="literal">map</code> starts the rule and
	<em class="replaceable"><code>IF</code></em> should be replaced with the
	name of the external interface:</p><pre xml:lang="en" class="programlisting" lang="en">map <em class="replaceable"><code>IF</code></em> <em class="replaceable"><code>LAN_IP_RANGE</code></em> -&gt; <em class="replaceable"><code>PUBLIC_ADDRESS</code></em></pre><p xml:lang="en" lang="en">The <em class="replaceable"><code>LAN_IP_RANGE</code></em> is the range
	of <acronym class="acronym">IP</acronym> addresses used by internal clients.
	Usually, it is a private address range such as <code class="systemitem">192.168.1.0/24</code>.  The
	<em class="replaceable"><code>PUBLIC_ADDRESS</code></em> can either be the
	static external <acronym class="acronym">IP</acronym> address or the keyword
	<code class="literal">0/32</code> which represents the
	<acronym class="acronym">IP</acronym> address assigned to
	<em class="replaceable"><code>IF</code></em>.</p><p xml:lang="en" lang="en">In <span class="application">IPF</span>, when a packet arrives
	at the firewall from the <acronym class="acronym">LAN</acronym> with a public
	destination, it first passes through the outbound rules of the
	firewall ruleset.  Then, the packet is passed to the
	<acronym class="acronym">NAT</acronym> ruleset which is read from the top
	down, where the first matching rule wins.
	<span class="application">IPF</span> tests each
	<acronym class="acronym">NAT</acronym> rule against the packet's interface
	name and source <acronym class="acronym">IP</acronym> address.  When a
	packet's interface name matches a <acronym class="acronym">NAT</acronym> rule,
	the packet's source <acronym class="acronym">IP</acronym> address in the
	private <acronym class="acronym">LAN</acronym> is checked to see if it falls
	within the <acronym class="acronym">IP</acronym> address range specified in
	<em class="replaceable"><code>LAN_IP_RANGE</code></em>.  On a match, the
	packet has its source <acronym class="acronym">IP</acronym> address rewritten
	with the public <acronym class="acronym">IP</acronym> address specified by
	<em class="replaceable"><code>PUBLIC_ADDRESS</code></em>.
	<span class="application">IPF</span> posts an entry in its internal
	<acronym class="acronym">NAT</acronym> table so that when the packet returns
	from the Internet, it can be mapped back to its original
	private <acronym class="acronym">IP</acronym> address before being passed to
	the firewall rules for further processing.</p><p xml:lang="en" lang="en">For networks that have large numbers of internal systems
	or multiple subnets, the process of funneling every private
	<acronym class="acronym">IP</acronym> address into a single public
	<acronym class="acronym">IP</acronym> address becomes a resource problem.
	Two methods are available to relieve this issue.</p><p xml:lang="en" lang="en">The first method is to assign a range of ports to use as
	source ports.  By adding the <code class="literal">portmap</code>
	keyword, <acronym class="acronym">NAT</acronym> can be directed to only use
	source ports in the specified range:</p><pre xml:lang="en" class="programlisting" lang="en">map dc0 192.168.1.0/24 -&gt; 0/32 portmap tcp/udp 20000:60000</pre><p xml:lang="en" lang="en">Alternately, use the <code class="literal">auto</code> keyword
	which tells <acronym class="acronym">NAT</acronym> to determine the ports
	that are available for use:</p><pre xml:lang="en" class="programlisting" lang="en">map dc0 192.168.1.0/24 -&gt; 0/32 portmap tcp/udp auto</pre><p xml:lang="en" lang="en">The second method is to use a pool of public addresses.
	This is useful when there are too many
	<acronym class="acronym">LAN</acronym> addresses to fit into a single public
	address and a block of public <acronym class="acronym">IP</acronym> addresses
	is available.  These public addresses can be used as a pool
	from which <acronym class="acronym">NAT</acronym> selects an
	<acronym class="acronym">IP</acronym> address as a packet's address is
	mapped on its way out.</p><p xml:lang="en" lang="en">The range of public <acronym class="acronym">IP</acronym> addresses can
	be specified using a netmask or <acronym class="acronym">CIDR</acronym>
	notation.  These two rules are equivalent:</p><pre xml:lang="en" class="programlisting" lang="en">map dc0 192.168.1.0/24 -&gt; 204.134.75.0/255.255.255.0
map dc0 192.168.1.0/24 -&gt; 204.134.75.0/24</pre><p xml:lang="en" lang="en">A common practice is to have a publically accessible web
	server or mail server segregated to an internal network
	segment.  The traffic from these servers still has to undergo
	<acronym class="acronym">NAT</acronym>, but port redirection is needed to
	direct inbound traffic to the correct server.  For example, to
	map a web server using the internal address <code class="systemitem">10.0.10.25</code> to its public
	<acronym class="acronym">IP</acronym> address of <code class="systemitem">20.20.20.5</code>, use this
	rule:</p><pre xml:lang="en" class="programlisting" lang="en">rdr dc0 20.20.20.5/32 port 80 -&gt; 10.0.10.25 port 80</pre><p xml:lang="en" lang="en">If it is the only web server, this rule would also work as
	it redirects all external <acronym class="acronym">HTTP</acronym> requests to
	<code class="literal">10.0.10.25</code>:</p><pre xml:lang="en" class="programlisting" lang="en">rdr dc0 0.0.0.0/0 port 80 -&gt; 10.0.10.25 port 80</pre><p xml:lang="en" lang="en"><span class="application">IPF</span> has a built in
	<acronym class="acronym">FTP</acronym> proxy which can be used with
	<acronym class="acronym">NAT</acronym>.  It monitors all outbound traffic for
	active or passive <acronym class="acronym">FTP</acronym> connection requests
	and dynamically creates temporary filter rules containing the
	port number used by the <acronym class="acronym">FTP</acronym> data channel.
	This eliminates the need to open large ranges of high order
	ports for <acronym class="acronym">FTP</acronym> connections.</p><p xml:lang="en" lang="en">In this example, the first rule calls the proxy for
	outbound <acronym class="acronym">FTP</acronym> traffic from the internal
	<acronym class="acronym">LAN</acronym>.  The second rule passes the
	<acronym class="acronym">FTP</acronym> traffic from the firewall to the
	Internet, and the third rule handles all
	non-<acronym class="acronym">FTP</acronym> traffic from the internal
	<acronym class="acronym">LAN</acronym>:</p><pre xml:lang="en" class="programlisting" lang="en">map dc0 10.0.10.0/29 -&gt; 0/32 proxy port 21 ftp/tcp
map dc0 0.0.0.0/0 -&gt; 0/32 proxy port 21 ftp/tcp
map dc0 10.0.10.0/29 -&gt; 0/32</pre><p xml:lang="en" lang="en">The <acronym class="acronym">FTP</acronym> <code class="literal">map</code> rules go
	before the <acronym class="acronym">NAT</acronym> rule so that when a packet
	matches an <acronym class="acronym">FTP</acronym> rule, the
	<acronym class="acronym">FTP</acronym> proxy creates temporary filter rules to
	let the <acronym class="acronym">FTP</acronym> session packets pass and
	undergo <acronym class="acronym">NAT</acronym>.  All LAN packets that are not
	<acronym class="acronym">FTP</acronym> will not match the
	<acronym class="acronym">FTP</acronym> rules but will undergo
	<acronym class="acronym">NAT</acronym> if they match the third rule.</p><p xml:lang="en" lang="en">Without the <acronym class="acronym">FTP</acronym> proxy, the following
	firewall rules would instead be needed.  Note that without the
	proxy, all ports above <code class="literal">1024</code> need to be
	allowed:</p><pre xml:lang="en" class="programlisting" lang="en"># Allow out LAN PC client FTP to public Internet
# Active and passive modes
pass out quick on rl0 proto tcp from any to any port = 21 flags S keep state

# Allow out passive mode data channel high order port numbers
pass out quick on rl0 proto tcp from any to any port &gt; 1024 flags S keep state

# Active mode let data channel in from FTP server
pass in quick on rl0 proto tcp from any to any port = 20 flags S keep state</pre><p xml:lang="en" lang="en">Whenever the file containing the <acronym class="acronym">NAT</acronym>
	rules is edited, run <code class="command">ipnat</code> with
	<code class="option">-CF</code> to delete the current
	<acronym class="acronym">NAT</acronym> rules and flush the contents of the
	dynamic translation table.  Include <code class="option">-f</code> and
	specify the name of the <acronym class="acronym">NAT</acronym> ruleset to
	load:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ipnat -CF -f /etc/ipnat.rules</code></strong></pre><p xml:lang="en" lang="en">To display the <acronym class="acronym">NAT</acronym> statistics:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ipnat -s</code></strong></pre><p xml:lang="en" lang="en">To list the <acronym class="acronym">NAT</acronym> table's current
	mappings:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ipnat -l</code></strong></pre><p xml:lang="en" lang="en">To turn verbose mode on and display information relating
	to rule processing and active rules and table entries:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ipnat -v</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86838968"></a>30.5.5. 檢視 <span class="application">IPF</span> 統計資訊</h3></div></div></div><a id="idp86839992" class="indexterm"></a><a id="idp86840760" class="indexterm"></a><p xml:lang="en" lang="en"><span class="application">IPF</span> includes <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfstat&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfstat</span>(8)</span></a>
	which can be used to retrieve
	and display statistics which are gathered
	as packets match rules as they go through the
	firewall.  Statistics are accumulated since the firewall was
	last started or since the last time they
	were reset to zero using <code class="command">ipf
	  -Z</code>.</p><p xml:lang="en" lang="en">The default <code class="command">ipfstat</code> output looks
	like this:</p><pre xml:lang="en" class="screen" lang="en">input packets: blocked 99286 passed 1255609 nomatch 14686 counted 0
 output packets: blocked 4200 passed 1284345 nomatch 14687 counted 0
 input packets logged: blocked 99286 passed 0
 output packets logged: blocked 0 passed 0
 packets logged: input 0 output 0
 log failures: input 3898 output 0
 fragment state(in): kept 0 lost 0
 fragment state(out): kept 0 lost 0
 packet state(in): kept 169364 lost 0
 packet state(out): kept 431395 lost 0
 ICMP replies: 0 TCP RSTs sent: 0
 Result cache hits(in): 1215208 (out): 1098963
 IN Pullups succeeded: 2 failed: 0
 OUT Pullups succeeded: 0 failed: 0
 Fastroute successes: 0 failures: 0
 TCP cksum fails(in): 0 (out): 0
 Packet log flags set: (0)</pre><p xml:lang="en" lang="en">Several options are available.  When supplied with either
	<code class="option">-i</code> for inbound or <code class="option">-o</code> for
	outbound, the command will retrieve and display the
	appropriate list of filter rules currently installed and in
	use by the kernel.  To also see the rule numbers, include
	<code class="option">-n</code>.  For example, <code class="command">ipfstat
	  -on</code> displays the outbound rules table with rule
	numbers:</p><pre xml:lang="en" class="screen" lang="en">@1 pass out on xl0 from any to any
@2 block out on dc0 from any to any
@3 pass out quick on dc0 proto tcp/udp from any to any keep state</pre><p xml:lang="en" lang="en">Include <code class="option">-h</code> to prefix each rule with a
	count of how many times the rule was matched.  For example,
	<code class="command">ipfstat -oh</code> displays the outbound internal
	rules table, prefixing each rule with its usage count:</p><pre xml:lang="en" class="screen" lang="en">2451423 pass out on xl0 from any to any
354727 block out on dc0 from any to any
430918 pass out quick on dc0 proto tcp/udp from any to any keep state</pre><p xml:lang="en" lang="en">To display the state table in a format similar to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a>, use <code class="command">ipfstat -t</code>.  When the
	firewall is under attack, this option provides the ability to
	identify and see the attacking packets.  The optional
	sub-flags give the ability to select the destination or source
	<acronym class="acronym">IP</acronym>, port, or protocol to be monitored in
	real time.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfstat&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfstat</span>(8)</span></a> for details.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86533304"></a>30.5.6. <span class="application">IPF</span> 日誌</h3></div></div></div><a id="idp86534200" class="indexterm"></a><a id="idp86534968" class="indexterm"></a><p xml:lang="en" lang="en"><span class="application">IPF</span> provides
	<code class="command">ipmon</code>, which can be used to write the
	firewall's logging information in a human readable format.  It
	requires that <code class="literal">options IPFILTER_LOG</code> be first
	added to a custom kernel using the instructions in <a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a>.</p><p xml:lang="en" lang="en">This command is typically run in daemon mode in order to
	provide a continuous system log file so that logging of past
	events may be reviewed.  Since FreeBSD has a built in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a> facility to automatically rotate system logs,
	the default <code class="filename">rc.conf</code>
	<code class="literal">ipmon_flags</code> statement uses
	<code class="option">-Ds</code>:</p><pre xml:lang="en" class="programlisting" lang="en">ipmon_flags="-Ds" # D = start as daemon
                  # s = log to syslog
                  # v = log tcp window, ack, seq
                  # n = map IP &amp; port to names</pre><p xml:lang="en" lang="en">Logging provides the ability to review, after the fact,
	information such as which packets were dropped, what addresses
	they came from, and where they were going.  This information
	is useful in tracking down attackers.</p><p xml:lang="en" lang="en">Once the logging facility is enabled in
	<code class="filename">rc.conf</code> and started with <code class="command">service
	  ipmon start</code>, <span class="application">IPF</span> will
	only log the rules which contain the <code class="literal">log</code>
	keyword.  The firewall administrator decides which rules in
	the ruleset should be logged and normally only deny rules are
	logged.  It is customary to include the
	<code class="literal">log</code> keyword in the last rule in the
	ruleset.  This makes it possible to see all the packets that
	did not match any of the rules in the ruleset.</p><p xml:lang="en" lang="en">By default, <code class="command">ipmon -Ds</code> mode uses
	<code class="literal">local0</code> as the logging facility.  The
	following logging levels can be used to further segregate the
	logged data:</p><pre xml:lang="en" class="screen" lang="en">LOG_INFO - packets logged using the "log" keyword as the action rather than pass or block.
LOG_NOTICE - packets logged which are also passed
LOG_WARNING - packets logged which are also blocked
LOG_ERR - packets which have been logged and which can be considered short due to an incomplete header</pre><p xml:lang="en" lang="en">In order to setup <span class="application">IPF</span> to
	log all data to <code class="filename">/var/log/ipfilter.log</code>,
	first create the empty file:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>touch /var/log/ipfilter.log</code></strong></pre><p xml:lang="en" lang="en">Then, to write all logged messages to the specified file,
	add the following statement to
	<code class="filename">/etc/syslog.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">local0.* /var/log/ipfilter.log</pre><p xml:lang="en" lang="en">To activate the changes and instruct <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a>
	to read the modified <code class="filename">/etc/syslog.conf</code>,
	run <code class="command">service syslogd reload</code>.</p><p xml:lang="en" lang="en">Do not forget to edit
	<code class="filename">/etc/newsyslog.conf</code> to rotate the new
	log file.</p><p xml:lang="en" lang="en">Messages generated by <code class="command">ipmon</code> consist
	of data fields separated by white space.  Fields common to
	all messages are:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p xml:lang="en" lang="en">The date of packet receipt.</p></li><li class="listitem"><p xml:lang="en" lang="en">The time of packet receipt.  This is in the form
	    HH:MM:SS.F, for hours, minutes, seconds, and fractions
	    of a second.</p></li><li class="listitem"><p xml:lang="en" lang="en">The name of the interface that processed the
	    packet.</p></li><li class="listitem"><p xml:lang="en" lang="en">The group and rule number of the rule in the format
	    <code class="literal">@0:17</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en">The action: <code class="literal">p</code> for passed,
	    <code class="literal">b</code> for blocked, <code class="literal">S</code> for
	    a short packet, <code class="literal">n</code> did not match any
	    rules, and <code class="literal">L</code> for a log rule.</p></li><li class="listitem"><p xml:lang="en" lang="en">The addresses written as three fields: the source
	    address and port separated by a comma, the -&gt; symbol,
	    and the destination address and port.  For example:
	    <code class="literal">209.53.17.22,80 -&gt;
	      198.73.220.17,1722</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">PR</code> followed by the protocol name
	    or number: for example, <code class="literal">PR tcp</code>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><code class="literal">len</code> followed by the header length
	    and total length of the packet: for example,
	    <code class="literal">len 20 40</code>.</p></li></ol></div><p xml:lang="en" lang="en">If the packet is a <acronym class="acronym">TCP</acronym> packet, there
	will be an additional field starting with a hyphen followed by
	letters corresponding to any flags that were set.  Refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipf</span>(5)</span></a> for a list of letters and their flags.</p><p xml:lang="en" lang="en">If the packet is an <acronym class="acronym">ICMP</acronym> packet, there
	will be two fields at the end:  the first always being
	<span class="quote">“<span class="quote">icmp</span>”</span> and the next being the
	<acronym class="acronym">ICMP</acronym> message and sub-message type,
	separated by a slash.  For example:
	<code class="literal">icmp 3/3</code> for a port unreachable
	message.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="firewalls-blacklistd"></a>30.6. Blacklistd</h2></div></div></div><p xml:lang="en" lang="en">Blacklistd is a daemon listening to sockets to receive
      notifications from other daemons about connection attempts
      that failed or were successful.  It is most widely used in
      blocking too many connection attempts on open ports.  A
      prime example is <span class="application">SSH</span> running on
      the internet getting a lot of requests from bots or scripts
      trying to guess passwords and gain access.  Using
      <span class="application">blacklistd</span>, the daemon can notify
      the firewall to create a filter rule to block excessive
      connection attempts from a single source after a number of
      tries.  Blacklistd was first developed on
      NetBSD and appeared there in version 7.  FreeBSD 11
      imported blacklistd from NetBSD.</p><p xml:lang="en" lang="en">This chapter describes how to set up blacklistd,
      configure it, and provides examples on how to use it.
      Readers should be familiar with basic firewall concepts like
      rules.  For details, refer to the firewall chapter.  PF is
      used in the examples, but other firewalls available on
      FreeBSD should be able to work with blacklistd, too.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86916152"></a>30.6.1. 開啟 Blacklistd</h3></div></div></div><p xml:lang="en" lang="en">The main configuration for blacklistd is stored in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=blacklistd.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">blacklistd.conf</span>(5)</span></a>.  Various command line options are
	also available to change blacklistd's run-time behavior.
	Persistent configuration across reboots should be stored
	in <code class="filename">/etc/blacklistd.conf</code>.  To enable
	the daemon during system boot, add a
	<code class="literal">blacklistd_enable</code> line to
	<code class="filename">/etc/rc.conf</code> like this:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysrc blacklistd_enable=yes</code></strong></pre><p xml:lang="en" lang="en">To start the service manually, run this command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service blacklistd start</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86954680"></a>30.6.2. 建立 Blacklistd 規則集</h3></div></div></div><p xml:lang="en" lang="en">Rules for blacklistd are configured in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=blacklistd.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">blacklistd.conf</span>(5)</span></a> with one entry per line.  Each
	rule contains a tuple separated by spaces or tabs.  Rules
	either belong to a <code class="literal">local</code> or a
	<code class="literal">remote</code>, which applies to the machine
	where blacklistd is running or an outside source,
	respectively.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86957368"></a>30.6.2.1. 本地規則</h4></div></div></div><p xml:lang="en" lang="en">An example blacklistd.conf entry for a local rule
	  looks like this:</p><pre xml:lang="en" class="programlisting" lang="en">[local]
ssh             stream  *       *               *       3       24h</pre><p xml:lang="en" lang="en">All rules that follow the <code class="literal">[local]</code>
	  section are treated as local rules (which is the
	  default), applying to the local machine.  When a
	  <code class="literal">[remote]</code> section is encountered, all
	  rules that follow it are handled as remote machine
	  rules.</p><p xml:lang="en" lang="en">Seven fields define a rule separated by either tabs
	  or spaces.  The first four fields identify the traffic
	  that should be blacklisted.  The three fields that
	  follow define backlistd's behavior.  Wildcards are
	  denoted as asterisks (<code class="literal">*</code>), matching
	  anything in this field.  The first field defines the
	  location.  In local rules, these are the network ports.
	  The syntax for the location field is as follows:</p><pre xml:lang="en" class="programlisting" lang="en">[<em class="replaceable"><code>address</code></em>|<em class="replaceable"><code>interface</code></em>][/<em class="replaceable"><code>mask</code></em>][:<em class="replaceable"><code>port</code></em>]</pre><p xml:lang="en" lang="en">Adressses can be specified as IPv4 in numeric format
	    or IPv6 in square brackets.  An interface name like
	    <code class="literal"><em class="replaceable"><code>em0</code></em></code> can also
	    be used.</p><p xml:lang="en" lang="en">The socket type is defined by the second field.  TCP
	    sockets are of type <code class="literal">stream</code>, whereas UDP
	    is denoted as <code class="literal">dgram</code>.  The example above
	    uses TCP, since SSH is using that protocol.</p><p xml:lang="en" lang="en">A protocol can be used in the third field of a
	    blacklistd rule.  The following protocols can be used:
	    <code class="literal">tcp</code>, <code class="literal">udp</code>,
	    <code class="literal">tcp6</code>, <code class="literal">udp6</code>, or
	    numeric.  A wildcard, like in the example, is typically
	    used to match all protocols unless there is a reason to
	    distinguish traffic by a certain protocol.</p><p xml:lang="en" lang="en">In the fourth field, the effective user or owner of
	    the daemon process that is reporting the event is defined.
	    The username or <acronym class="acronym">UID</acronym> can be used here,
	    as well as a wildcard (see example rule above).</p><p xml:lang="en" lang="en">The packet filter rule name is declared by the fifth
	    field, which starts the behavior part of the rule.  By
	    default, blacklistd puts all blocks under a pf anchor
	    called <code class="literal">blacklistd</code> in
	    <code class="filename">pf.conf</code> like this:</p><pre xml:lang="en" class="programlisting" lang="en">anchor "blacklistd/*" in on $ext_if
block in
pass out</pre><p xml:lang="en" lang="en">For separate blacklists, an anchor name can be used in
	    this field.  In other cases, the wildcard will suffice.
	    When a name starts with a hyphen (<code class="literal">-</code>) it
	    means that an anchor with the default rule name prepended
	    should be used.  A modified example from the above using
	    the hyphen would look like this:</p><pre xml:lang="en" class="programlisting" lang="en">ssh             stream  *       *               -ssh       3       24h</pre><p xml:lang="en" lang="en">With such a rule, any new blacklist rules are added to
	    an anchor called <code class="literal">blacklistd-ssh</code>.</p><p xml:lang="en" lang="en">To block whole subnets for a single rule violation, a
	    <code class="literal">/</code> in the rule name can be used.  This
	    causes the remaining portion of the name to be interpreted
	    as the mask to be applied to the address specified in
	    the rule.  For example, this rule would block every
	    address adjoining <code class="literal">/24</code>.</p><pre xml:lang="en" class="programlisting" lang="en">22              stream  tcp       *               */24    3       24h</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">It is important to specify the proper
	      protocol here.  IPv4 and IPv6 treat /24 differently,
	      that is the reason why <code class="literal">*</code> cannot be
	      used in the third field for this rule.</p></div><p xml:lang="en" lang="en">This rule defines that if any one host in that network
	    is misbehaving, everything else on that network will be
	    blocked, too.</p><p xml:lang="en" lang="en">The sixth field, called <code class="literal">nfail</code>, sets
	    the number of login failures required to blacklist the
	    remote IP in question.  When a wildcard is used at this
	    position, it means that blocks will never happen.  In the
	    example rule above, a limit of three is defined meaning
	    that after three attempts to log into
	    <span class="application">SSH</span> on one connection, the IP
	    is blocked.</p><p xml:lang="en" lang="en">The last field in a blacklistd rule definition
	    specifies how long a host is blacklisted.  The default
	    unit is seconds, but suffixes like <code class="literal">m</code>,
	    <code class="literal">h</code>, and <code class="literal">d</code> can also be
	    specified for minutes, hours, and days,
	    respectively.</p><p xml:lang="en" lang="en">The example rule in its entirety means that after
	    three times authenticating to
	    <span class="application">SSH</span> will result in a new PF
	    block rule for that host.  Rule matches are performed by
	    first checking local rules one after another, from most
	    specific to least specific.  When a match occurs, the
	    <code class="literal">remote</code> rules are applied and the name,
	    <code class="literal">nfail</code>, and disable fields are changed
	    by the <code class="literal">remote</code> rule that matched.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87002040"></a>30.6.2.2. 遠端規則</h4></div></div></div><p xml:lang="en" lang="en">Remote rules are used to specify how blacklistd
	    changes its behavior depending on the remote host
	    currently being evaluated.  Each field in a remote rule
	    is the same as in a local rule.  The only difference is
	    in the way blacklistd is using them.  To explain it,
	    this example rule is used:</p><pre xml:lang="en" class="programlisting" lang="en">[remote]
203.0.113.128/25 *      *       *               =/25    =       48h</pre><p xml:lang="en" lang="en">The address field can be an IP address (either v4 or
	    v6), a port or both.  This allows setting special rules
	    for a specific remote address range like in this example.
	    The fields for type, protocol and owner are identically
	    interpreted as in the local rule.</p><p xml:lang="en" lang="en">The name fields is different though: the equal sign
	    (<code class="literal">=</code>) in a remote rule tells blacklistd
	    to use the value from the matching local rule.  It means
	    that the firewall rule entry is taken and the
	    <code class="systemitem">/25</code> prefix (a
	    netmask of <code class="systemitem">255.255.255.128</code>) is added.
	    When a connection from that address range is blacklisted,
	    the entire subnet is affected.  A PF anchor name can also
	    be used here, in which case blacklistd will add rules for
	    this address block to the anchor of that name.  The
	    default table is used when a wildcard is specified.</p><p xml:lang="en" lang="en">A custom number of failures in the
	    <code class="literal">nfail</code> column can be defined for an
	    address.  This is useful for exceptions to a specific
	    rule, to maybe allow someone a less strict application
	    of rules or a bit more leniency in login tries.
	    Blocking is disabled when an asterisk is used in this
	    sixth field.</p><p xml:lang="en" lang="en">Remote rules allow a stricter enforcement of limits
	    on attempts to log in compared to attempts coming from a
	    local network like an office.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87020088"></a>30.6.3. Blacklistd 客戶端設定</h3></div></div></div><p xml:lang="en" lang="en">There are a few software packages in FreeBSD that can
	  utilize blacklistd's functionality.  The two most
	  prominent ones are <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ftpd</span>(8)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> to block
	  excessive connection attempts.  To activate blacklistd in
	  the SSH daemon, add the following line to
	  <code class="filename">/etc/ssh/sshd_config</code>:</p><pre xml:lang="en" class="programlisting" lang="en">UseBlacklist yes</pre><p>接著重新啟動 sshd 來使變更生效。</p><p xml:lang="en" lang="en">Blacklisting for <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ftpd</span>(8)</span></a> is enabled using
	  <code class="literal">-B</code>, either in
	  <code class="filename">/etc/inetd.conf</code> or as a
	  flag in <code class="filename">/etc/rc.conf</code> like
	  this:</p><pre xml:lang="en" class="programlisting" lang="en">ftpd_flags="-B"</pre><p xml:lang="en" lang="en">That is all that is needed to make these programs
	  talk to blacklistd.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87027768"></a>30.6.4. Blacklistd 管理</h3></div></div></div><p xml:lang="en" lang="en">Blacklistd provides the user with a management utility
	  called <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=blacklistctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">blacklistctl</span>(8)</span></a>.  It displays blocked
	  addresses and networks that are blacklisted by the rules
	  defined in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=blacklistd.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">blacklistd.conf</span>(5)</span></a>.  To see the
	  list of currently blocked hosts, use
	  <code class="command">dump</code> combined with <code class="option">-b</code>
	  like this.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>blacklistctl dump -b</code></strong>
      address/ma:port id      nfail   last access
213.0.123.128/25:22   OK      6/3     2019/06/08 14:30:19</pre><p xml:lang="en" lang="en">This example shows that there were 6 out of three
	  permitted attempts on port 22 coming from the address
	  range <code class="systemitem">213.0.123.128/25</code>.  There
	  are more attempts listed than are allowed because SSH
	  allows a client to try multiple logins on a single TCP
	  connection.  A connection that is currently going on is
	  not stopped by blacklistd.  The last connection attempt is
	  listed in the <code class="literal">last access</code> column of the
	  output.</p><p xml:lang="en" lang="en">To see the remaining time that this host will be on
	  the blacklist, add <code class="option">-r</code> to the previous
	  command.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>blacklistctl dump -br</code></strong>
      address/ma:port id      nfail   remaining time
213.0.123.128/25:22   OK      6/3     36s</pre><p xml:lang="en" lang="en">In this example, there are 36s seconds left until this
	  host will not be blocked any more.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87040696"></a>30.6.5. 從封鎖清單移除主機</h3></div></div></div><p xml:lang="en" lang="en">Sometimes it is necessary to remove a host from the
	  block list before the remaining time expires.
	  Unfortunately, there is no functionality in blacklistd to
	  do that.  However, it is possible to remove the address
	  from the PF table using pfctl.  For each blocked port,
	  there is a child anchor inside the blacklistd anchor
	  defined in <code class="filename">/etc/pf.conf</code>.  For
	  example, if there is a child anchor for blocking port 22
	  it is called <code class="literal">blacklistd/22</code>.  There is a
	  table inside that child anchor that contains the blocked
	  addresses.  This table is called port followed by the port
	  number.  In this example, it would be called
	  <code class="literal">port22</code>.  With that information at hand,
	  it is now possible to use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pfctl</span>(8)</span></a> to display all
	  addresses listed like this:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pfctl -a <em class="replaceable"><code>blacklistd/22</code></em> -t <em class="replaceable"><code>port22</code></em> -T show</code></strong>
...
213.0.123.128/25
...</pre><p xml:lang="en" lang="en">After identifying the address to be unblocked from the
	  list, the following command removes it from the list:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pfctl -a <em class="replaceable"><code>blacklistd/22</code></em> -T delete <em class="replaceable"><code>213.0.123.128/25</code></em></code></strong></pre><p xml:lang="en" lang="en">The address is now removed from PF, but will still
	  show up in the blacklistctl list, since it does not know
	  about any changes made in PF.  The entry in blacklistd's
	  database will eventually expire and be removed from its
	  output eventually.  The entry will be added again if the
	  host is matching one of the block rules in blacklistd
	  again.</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="advanced-networking"></a>章 31. 進階網路設定</h2></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#advanced-networking-synopsis">31.1. 概述</a></span></dt><dt><span class="sect1"><a href="#network-routing">31.2. 通訊閘與路由</a></span></dt><dd><dl><dt><span class="sect2"><a href="#network-routing-default">31.2.1. 路由基礎概念</a></span></dt><dt><span class="sect2"><a href="#network-static-routes">31.2.2. 設定路由器使用靜態路由</a></span></dt><dt><span class="sect2"><a href="#network-routing-troubleshooting">31.2.3. 疑難排解</a></span></dt><dt><span class="sect2"><a href="#network-routing-multicast">31.2.4. 群播 (Multicast) 注意事項</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-wireless">31.3. 無線網路</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp87243320">31.3.1. 無線網路基礎</a></span></dt><dt><span class="sect2"><a href="#network-wireless-quick-start">31.3.2. 快速開始</a></span></dt><dt><span class="sect2"><a href="#network-wireless-basic">31.3.3. 基礎設定</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp87286712">31.3.3.1. 核心設定</a></span></dt><dt><span class="sect3"><a href="#idp87329208">31.3.3.2. 設定正確的區域</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp87336632">31.3.4. 主從式 (Infrastructure)</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp87338552">31.3.4.1. FreeBSD 客戶端</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idp87339192">31.3.4.1.1. 如何尋找存取點</a></span></dt><dt><span class="sect4"><a href="#idp87386168">31.3.4.1.2. 基礎設定</a></span></dt><dd><dl><dt><span class="sect5"><a href="#idp87388728">31.3.4.1.2.1. 選擇存取點</a></span></dt><dt><span class="sect5"><a href="#idp87404088">31.3.4.1.2.2. 認證</a></span></dt><dt><span class="sect5"><a href="#idp87419064">31.3.4.1.2.3. 使用 <acronym class="acronym">DHCP</acronym> 取得 <acronym class="acronym">IP</acronym> 位址</a></span></dt><dt><span class="sect5"><a href="#idp87434296">31.3.4.1.2.4. 靜態 <acronym class="acronym">IP</acronym> 位址</a></span></dt></dl></dd><dt><span class="sect4"><a href="#network-wireless-wpa">31.3.4.1.3. <acronym class="acronym">WPA</acronym></a></span></dt><dd><dl><dt><span class="sect5"><a href="#network-wireless-wpa-wpa-psk">31.3.4.1.3.1. <acronym class="acronym">WPA-PSK</acronym></a></span></dt><dt><span class="sect5"><a href="#network-wireless-wpa-eap-tls">31.3.4.1.3.2. <acronym class="acronym">WPA</acronym> 加上 <acronym class="acronym">EAP-TLS</acronym></a></span></dt><dt><span class="sect5"><a href="#network-wireless-wpa-eap-ttls">31.3.4.1.3.3. <acronym class="acronym">WPA</acronym> 加上 <acronym class="acronym">EAP-TTLS</acronym></a></span></dt><dt><span class="sect5"><a href="#network-wireless-wpa-eap-peap">31.3.4.1.3.4. <acronym class="acronym">WPA</acronym> 加上 <acronym class="acronym">EAP-PEAP</acronym></a></span></dt></dl></dd><dt><span class="sect4"><a href="#network-wireless-wep">31.3.4.1.4. <acronym class="acronym">WEP</acronym></a></span></dt></dl></dd></dl></dd><dt><span class="sect2"><a href="#idp87783736">31.3.5. 對等式 (Ad-hoc)</a></span></dt><dt><span class="sect2"><a href="#network-wireless-ap">31.3.6. FreeBSD 主機存取點</a></span></dt><dd><dl><dt><span class="sect3"><a href="#network-wireless-ap-basic">31.3.6.1. 基礎設定</a></span></dt><dt><span class="sect3"><a href="#idp87848120">31.3.6.2. 無認證或加密的 Host-based 存取點</a></span></dt><dt><span class="sect3"><a href="#network-wireless-ap-wpa">31.3.6.3. <acronym class="acronym">WPA2</acronym> Host-based 存取點</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idp87893176">31.3.6.3.1. <acronym class="acronym">WPA2-PSK</acronym></a></span></dt></dl></dd><dt><span class="sect3"><a href="#idp87945912">31.3.6.4. <acronym class="acronym">WEP</acronym> Host-based 存取點</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp87997240">31.3.7. 同時使用有線及無線連線</a></span></dt><dt><span class="sect2"><a href="#idp88000696">31.3.8. 疑難排解</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-usb-tethering">31.4. USB 網路共享</a></span></dt><dt><span class="sect1"><a href="#network-bluetooth">31.5. 藍牙</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp88042936">31.5.1. 載入藍牙支援</a></span></dt><dt><span class="sect2"><a href="#idp88083384">31.5.2. 尋找其他藍牙裝置</a></span></dt><dt><span class="sect2"><a href="#idp88114104">31.5.3. 裝置配對</a></span></dt><dt><span class="sect2"><a href="#idp88148792">31.5.4. 使用 <acronym class="acronym">PPP</acronym> Profile 存取網路</a></span></dt><dt><span class="sect2"><a href="#idp88180920">31.5.5. 藍牙通訊協定</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idp88182200">31.5.5.1. Logical Link Control and Adaptation Protocol
	  (<acronym class="acronym">L2CAP</acronym>)</a></span></dt><dt><span class="sect3"><a href="#idp88217400">31.5.5.2. Radio Frequency Communication
	  (<acronym class="acronym">RFCOMM</acronym>)</a></span></dt><dt><span class="sect3"><a href="#idp88236344">31.5.5.3. Service Discovery Protocol
	  (<acronym class="acronym">SDP</acronym>)</a></span></dt><dt><span class="sect3"><a href="#idp88296120">31.5.5.4. <acronym class="acronym">OBEX</acronym> Object Push
	  (<acronym class="acronym">OPUSH</acronym>)</a></span></dt><dt><span class="sect3"><a href="#idp88329528">31.5.5.5. Serial Port Profile (<acronym class="acronym">SPP</acronym>)</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idp88339128">31.5.6. 疑難排解</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-bridging">31.6. 橋接</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp88386232">31.6.1. 開啟橋接</a></span></dt><dt><span class="sect2"><a href="#idp88423480">31.6.2. 開啟 Spanning Tree</a></span></dt><dt><span class="sect2"><a href="#idp88441912">31.6.3. 橋接介面參數</a></span></dt><dt><span class="sect2"><a href="#idp88489272">31.6.4. <acronym class="acronym">SNMP</acronym> 監視</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-aggregation">31.7. Link Aggregation 與容錯移轉</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp88574520">31.7.1. 設定範例</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-diskless">31.8. <acronym class="acronym">PXE</acronym> 無磁碟作業</a></span></dt><dd><dl><dt><span class="sect2"><a href="#network-pxe-nfs">31.8.1. 設定 <acronym class="acronym">PXE</acronym> 環境</a></span></dt><dt><span class="sect2"><a href="#network-pxe-setting-up-dhcp">31.8.2. 設定 <acronym class="acronym">DHCP</acronym> 伺服器</a></span></dt><dt><span class="sect2"><a href="#idp88879032">31.8.3. <acronym class="acronym">PXE</acronym> 問題除錯</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-ipv6">31.9. <acronym class="acronym">IPv6</acronym></a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp89022008">31.9.1. <acronym class="acronym">IPv6</acronym> 位址的背景知識</a></span></dt><dt><span class="sect2"><a href="#idp89099448">31.9.2. 設定 <acronym class="acronym">IPv6</acronym></a></span></dt><dt><span class="sect2"><a href="#idp89107896">31.9.3. 連線到 Provider</a></span></dt><dt><span class="sect2"><a href="#idp89142840">31.9.4. Router Advertisement 與 Host Auto Configuration</a></span></dt><dt><span class="sect2"><a href="#idp89166392">31.9.5. <acronym class="acronym">IPv6</acronym> 與 <acronym class="acronym">IPv6</acronym> 位址對應表</a></span></dt></dl></dd><dt><span class="sect1"><a href="#carp">31.10. 共用位址備援協定 (<acronym class="acronym">CARP</acronym>)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#carp-10x">31.10.1. 使用 <acronym class="acronym">CARP</acronym> 於 FreeBSD 10 及之後版本</a></span></dt><dt><span class="sect2"><a href="#carp-9x">31.10.2. 使用 <acronym class="acronym">CARP</acronym> 於 FreeBSD 9 及先前版本</a></span></dt></dl></dd><dt><span class="sect1"><a href="#network-vlan">31.11. VLANs</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="advanced-networking-synopsis"></a>31.1. 概述</h2></div></div></div><p xml:lang="en" lang="en">This chapter covers a number of advanced networking
      topics.</p><p>讀完這章，您將了解：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">The basics of gateways and routes.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to set up USB tethering.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to set up <span class="trademark">IEEE</span>® 802.11 and <span class="trademark">Bluetooth</span>®
	  devices.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to make FreeBSD act as a bridge.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to set up network <acronym class="acronym">PXE</acronym>
	  booting.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to set up <acronym class="acronym">IPv6</acronym> on a FreeBSD
	  machine.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to enable and utilize the features of the Common
	  Address Redundancy Protocol (<acronym class="acronym">CARP</acronym>) in
	  FreeBSD.</p></li><li class="listitem"><p>如何在 FreeBSD 上設定多個 <acronym class="acronym">VLAN</acronym>。</p></li><li class="listitem"><p xml:lang="en" lang="en">Configure bluetooth headset.</p></li></ul></div><p>在開始閱讀這章之前，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Understand the basics of the
	  <code class="filename">/etc/rc</code> scripts.</p></li><li class="listitem"><p>熟悉基本網路術語。</p></li><li class="listitem"><p xml:lang="en" lang="en">Know how to configure and install a new FreeBSD kernel
	  (<a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a>).</p></li><li class="listitem"><p>了解如何安裝其他第三方軟體 (<a class="xref" href="#ports" title="章 4. 安裝應用程式：套件與 Port">章 4, <em>安裝應用程式：套件與 Port</em></a>)。</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-routing"></a>31.2. 通訊閘與路由</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Coranth</span> <span class="surname">Gryphon</span></span>. </span></div></div></div><a id="idp86706872" class="indexterm"></a><a id="idp86707768" class="indexterm"></a><a id="idp86708664" class="indexterm"></a><p xml:lang="en" lang="en"><em class="firstterm">Routing</em> is the mechanism that allows
      a system to find the network path to another system.  A
      <em class="firstterm">route</em> is a defined pair of addresses
      which represent the <span class="quote">“<span class="quote">destination</span>”</span> and a
      <span class="quote">“<span class="quote">gateway</span>”</span>.  The route indicates that when trying
      to get to the specified destination, send the packets through
      the specified gateway.  There are three types of destinations:
      individual hosts, subnets, and <span class="quote">“<span class="quote">default</span>”</span>.  The
      <span class="quote">“<span class="quote">default route</span>”</span> is used if no other routes apply.
      There are also three types of gateways: individual hosts,
      interfaces, also called links, and Ethernet hardware
      (<acronym class="acronym">MAC</acronym>) addresses.  Known routes are stored in
      a routing table.</p><p xml:lang="en" lang="en">This section provides an overview of routing basics.  It
      then demonstrates how to configure a FreeBSD system as a router and
      offers some troubleshooting tips.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-routing-default"></a>31.2.1. 路由基礎概念</h3></div></div></div><p xml:lang="en" lang="en">To view the routing table of a FreeBSD system, use
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=netstat&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">netstat</span>(1)</span></a>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>netstat -r</code></strong>
Routing tables

Internet:
Destination      Gateway            Flags     Refs     Use     Netif Expire
default          outside-gw         UGS        37      418       em0
localhost        localhost          UH          0      181       lo0
test0            0:e0:b5:36:cf:4f   UHLW        5    63288       re0     77
10.20.30.255     link#1             UHLW        1     2421
example.com      link#1             UC          0        0
host1            0:e0:a8:37:8:1e    UHLW        3     4601       lo0
host2            0:e0:a8:37:8:1e    UHLW        0        5       lo0 =&gt;
host2.example.com link#1            UC          0        0
224              link#1             UC          0        0</pre><p xml:lang="en" lang="en">The entries in this example are as follows:</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en">default</span></dt><dd><p xml:lang="en" lang="en">The first route in this table specifies the
	      <code class="literal">default</code> route.  When the local system
	      needs to make a connection to a remote host, it checks
	      the routing table to determine if a known path exists.
	      If the remote host matches an entry in the table, the
	      system checks to see if it can connect using the
	      interface specified in that entry.</p><p xml:lang="en" lang="en">If the destination does not match an entry, or if
	      all known paths fail, the system uses the entry for the
	      default route.  For hosts on a local area network, the
	      <code class="literal">Gateway</code> field in the default route is
	      set to the system which has a direct connection to the
	      Internet.  When reading this entry, verify that the
	      <code class="literal">Flags</code> column indicates that the
	      gateway is usable (<code class="literal">UG</code>).</p><p xml:lang="en" lang="en">The default route for a machine which itself is
	      functioning as the gateway to the outside world will be
	      the gateway machine at the Internet Service Provider
	      (<acronym class="acronym">ISP</acronym>).</p></dd><dt><span xml:lang="en" class="term" lang="en">localhost</span></dt><dd><p xml:lang="en" lang="en">The second route is the <code class="literal">localhost</code>
	      route.  The interface specified in the
	      <code class="literal">Netif</code> column for
	      <code class="literal">localhost</code> is
	      <code class="filename">lo0</code>, also known as the loopback
	      device.  This indicates that all traffic for this
	      destination should be internal, rather than sending it
	      out over the network.</p></dd><dt><span xml:lang="en" class="term" lang="en">MAC address</span></dt><dd><p xml:lang="en" lang="en">The addresses beginning with <code class="systemitem">0:e0:</code> are
	      <acronym class="acronym">MAC</acronym> addresses.  FreeBSD will
	      automatically identify any hosts,
	      <code class="systemitem">test0</code> in the example, on the
	      local Ethernet and add a route for that host over the
	      Ethernet interface, <code class="filename">re0</code>.  This type
	      of route has a timeout, seen in the
	      <code class="literal">Expire</code> column, which is used if the
	      host does not respond in a specific amount of time.
	      When this happens, the route to this host will be
	      automatically deleted.  These hosts are identified using
	      the Routing Information Protocol
	      (<acronym class="acronym">RIP</acronym>), which calculates routes to
	      local hosts based upon a shortest path
	      determination.</p></dd><dt><span xml:lang="en" class="term" lang="en">subnet</span></dt><dd><p xml:lang="en" lang="en">FreeBSD will automatically add subnet routes for the
	      local subnet.  In this example, <code class="systemitem">10.20.30.255</code> is the
	      broadcast address for the subnet <code class="systemitem">10.20.30</code> and
	      <code class="systemitem">example.com</code> is the
	      domain name associated with that subnet.  The
	      designation <code class="literal">link#1</code> refers to the
	      first Ethernet card in the machine.</p><p xml:lang="en" lang="en">Local network hosts and local subnets have their
	      routes automatically configured by a daemon called
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=routed&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">routed</span>(8)</span></a>.  If it is not running, only routes which
	      are statically defined by the administrator will
	      exist.</p></dd><dt><span xml:lang="en" class="term" lang="en">host</span></dt><dd><p xml:lang="en" lang="en">The <code class="literal">host1</code> line refers to the host
	      by its Ethernet address.  Since it is the sending host,
	      FreeBSD knows to use the loopback interface
	      (<code class="filename">lo0</code>) rather than the Ethernet
	      interface.</p><p xml:lang="en" lang="en">The two <code class="literal">host2</code> lines represent
	      aliases which were created using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>.  The
	      <code class="literal">=&gt;</code> symbol after the
	      <code class="filename">lo0</code> interface says that an alias
	      has been set in addition to the loopback address.  Such
	      routes only show up on the host that supports the alias
	      and all other hosts on the local network will have a
	      <code class="literal">link#1</code> line for such routes.</p></dd><dt><span xml:lang="en" class="term" lang="en">224</span></dt><dd><p xml:lang="en" lang="en">The final line (destination subnet <code class="systemitem">224</code>) deals with
	      multicasting.</p></dd></dl></div><p xml:lang="en" lang="en">Various attributes of each route can be seen in the
	<code class="literal">Flags</code> column.  <a class="xref" href="#routeflags" title="表格 31.1. 常見路由表標記">表格 31.1, “常見路由表標記”</a>
	summarizes some of these flags and their meanings:</p><div class="table"><a id="routeflags"></a><div class="table-title">表格 31.1. 常見路由表標記</div><div class="table-contents"><table summary="常見路由表標記" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>指令</th><th>用途</th></tr></thead><tbody><tr><td xml:lang="en" lang="en">U</td><td xml:lang="en" lang="en">The route is active (up).</td></tr><tr><td xml:lang="en" lang="en">H</td><td xml:lang="en" lang="en">The route destination is a single host.</td></tr><tr><td xml:lang="en" lang="en">G</td><td xml:lang="en" lang="en">Send anything for this destination on to this
		gateway, which will figure out from there where to
		send it.</td></tr><tr><td xml:lang="en" lang="en">S</td><td xml:lang="en" lang="en">This route was statically configured.</td></tr><tr><td xml:lang="en" lang="en">C</td><td xml:lang="en" lang="en">Clones a new route based upon this route for
		machines to connect to.  This type of route is
		normally used for local networks.</td></tr><tr><td xml:lang="en" lang="en">W</td><td xml:lang="en" lang="en">The route was auto-configured based upon a local
		area network (clone) route.</td></tr><tr><td xml:lang="en" lang="en">L</td><td xml:lang="en" lang="en">Route involves references to Ethernet (link)
		hardware.</td></tr></tbody></table></div></div><br class="table-break" /><p xml:lang="en" lang="en">On a FreeBSD system, the default route can defined in
	<code class="filename">/etc/rc.conf</code> by specifying the
	<acronym class="acronym">IP</acronym> address of the default gateway:</p><pre xml:lang="en" class="programlisting" lang="en">defaultrouter="10.20.30.1"</pre><p xml:lang="en" lang="en">It is also possible to manually add the route using
	<code class="command">route</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>route add default 10.20.30.1</code></strong></pre><p xml:lang="en" lang="en">Note that manually added routes will not survive a reboot.
	For more information on manual manipulation of network
	routing tables, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=route&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">route</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-static-routes"></a>31.2.2. 設定路由器使用靜態路由</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Al</span> <span class="surname">Hoang</span></span>. </span></div></div></div><a id="idp86860472" class="indexterm"></a><p xml:lang="en" lang="en">A FreeBSD system can be configured as the default gateway, or
	router, for a network if it is a dual-homed system.  A
	dual-homed system is a host which resides on at least two
	different networks.  Typically, each network is connected to a
	separate network interface, though <acronym class="acronym">IP</acronym>
	aliasing can be used to bind multiple addresses, each on a
	different subnet, to one physical interface.</p><a id="idp87165368" class="indexterm"></a><p xml:lang="en" lang="en">In order for the system to forward packets between
	interfaces, FreeBSD must be configured as a router.  Internet
	standards and good engineering practice prevent the FreeBSD
	Project from enabling this feature by default, but it can be
	configured to start at boot by adding this line to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">gateway_enable="YES"          # Set to YES if this host will be a gateway</pre><p xml:lang="en" lang="en">To enable routing now, set the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variable
	<code class="varname">net.inet.ip.forwarding</code> to
	<code class="literal">1</code>.  To stop routing, reset this variable to
	<code class="literal">0</code>.</p><a id="idp87169720" class="indexterm"></a><a id="idp87170616" class="indexterm"></a><a id="idp87171512" class="indexterm"></a><p xml:lang="en" lang="en">The routing table of a router needs additional routes so
	it knows how to reach other networks.  Routes can be either
	added manually using static routes or routes can be
	automatically learned using a routing protocol.  Static routes
	are appropriate for small networks and this section describes
	how to add a static routing entry for a small network.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">For large networks, static routes quickly become
	  unscalable.  FreeBSD comes with the standard
	  <acronym class="acronym">BSD</acronym> routing daemon <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=routed&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">routed</span>(8)</span></a>, which
	  provides the routing protocols <acronym class="acronym">RIP</acronym>,
	  versions 1 and 2, and <acronym class="acronym">IRDP</acronym>.  Support for
	  the <acronym class="acronym">BGP</acronym> and <acronym class="acronym">OSPF</acronym>
	  routing protocols can be installed using the
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/zebra/pkg-descr">net/zebra</a> package or port.</p></div><p xml:lang="en" lang="en">Consider the following network:</p><div class="mediaobject"><img src="advanced-networking/static-routes.png" /></div><p xml:lang="en" lang="en">In this scenario, <code class="systemitem">RouterA</code> is a
	FreeBSD machine that is acting as a router to the rest of the
	Internet.  It has a default route set to <code class="systemitem">10.0.0.1</code> which allows it to
	connect with the outside world.
	<code class="systemitem">RouterB</code> is already configured to use
	<code class="systemitem">192.168.1.1</code> as its
	default gateway.</p><p xml:lang="en" lang="en">Before adding any static routes, the routing table on
	<code class="systemitem">RouterA</code> looks like this:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>netstat -nr</code></strong>
Routing tables

Internet:
Destination        Gateway            Flags    Refs      Use  Netif  Expire
default            10.0.0.1           UGS         0    49378    xl0
127.0.0.1          127.0.0.1          UH          0        6    lo0
10.0.0.0/24        link#1             UC          0        0    xl0
192.168.1.0/24     link#2             UC          0        0    xl1</pre><p xml:lang="en" lang="en">With the current routing table,
	<code class="systemitem">RouterA</code> does not have a route to the
	<code class="systemitem">192.168.2.0/24</code>
	network.  The following command adds the <code class="literal">Internal Net
	  2</code> network to <code class="systemitem">RouterA</code>'s
	routing table using <code class="systemitem">192.168.1.2</code> as the next
	hop:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>route add -net 192.168.2.0/24 192.168.1.2</code></strong></pre><p xml:lang="en" lang="en">Now, <code class="systemitem">RouterA</code> can reach any host
	on the <code class="systemitem">192.168.2.0/24</code> network.
	However, the routing information will not persist if the FreeBSD
	system reboots.  If a static route needs to be persistent, add
	it to <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en"># Add Internal Net 2 as a persistent static route
static_routes="internalnet2"
route_internalnet2="-net 192.168.2.0/24 192.168.1.2"</pre><p xml:lang="en" lang="en">The <code class="literal">static_routes</code> configuration
	variable is a list of strings separated by a space, where each
	string references a route name.  The variable
	<code class="literal">route_<em class="replaceable"><code>internalnet2</code></em></code>
	contains the static route for that route name.</p><p xml:lang="en" lang="en">Using more than one string in
	<code class="literal">static_routes</code> creates multiple static
	routes.  The following shows an example of adding static
	routes for the <code class="systemitem">192.168.0.0/24</code> and
	<code class="systemitem">192.168.1.0/24</code>
	networks:</p><pre xml:lang="en" class="programlisting" lang="en">static_routes="net1 net2"
route_net1="-net 192.168.0.0/24 192.168.0.1"
route_net2="-net 192.168.1.0/24 192.168.1.1"</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-routing-troubleshooting"></a>31.2.3. 疑難排解</h3></div></div></div><p xml:lang="en" lang="en">When an address space is assigned to a network, the
	service provider configures their routing tables so that all
	traffic for the network will be sent to the link for the site.
	But how do external sites know to send their packets to the
	network's <acronym class="acronym">ISP</acronym>?</p><p xml:lang="en" lang="en">There is a system that keeps track of all assigned
	address spaces and defines their point of connection to the
	Internet backbone, or the main trunk lines that carry Internet
	traffic across the country and around the world.  Each
	backbone machine has a copy of a master set of tables, which
	direct traffic for a particular network to a specific
	backbone carrier, and from there down the chain of service
	providers until it reaches a particular network.</p><p xml:lang="en" lang="en">It is the task of the service provider to advertise to
	the backbone sites that they are the point of connection, and
	thus the path inward, for a site.  This is known as route
	propagation.</p><a id="idp87201080" class="indexterm"></a><p xml:lang="en" lang="en">Sometimes, there is a problem with route propagation and
	some sites are unable to connect.  Perhaps the most useful
	command for trying to figure out where routing is breaking
	down is <code class="command">traceroute</code>.  It is useful when
	<code class="command">ping</code> fails.</p><p xml:lang="en" lang="en">When using <code class="command">traceroute</code>, include the
	address of the remote host to connect to.  The output will
	show the gateway hosts along the path of the attempt,
	eventually either reaching the target host, or terminating
	because of a lack of connection.  For more information, refer
	to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=traceroute&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">traceroute</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-routing-multicast"></a>31.2.4. 群播 (Multicast) 注意事項</h3></div></div></div><a id="idp87222712" class="indexterm"></a><a id="idp87223608" class="indexterm"></a><p xml:lang="en" lang="en">FreeBSD natively supports both multicast applications and
	multicast routing.  Multicast applications do not require any
	special configuration in order to run on FreeBSD.  Support for
	multicast routing requires that the following option be
	compiled into a custom kernel:</p><pre xml:lang="en" class="programlisting" lang="en">options MROUTING</pre><p xml:lang="en" lang="en">The multicast routing daemon,
	<span class="application">mrouted</span> can be installed using the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/mrouted/pkg-descr">net/mrouted</a> package or port.  This daemon
	implements the <acronym class="acronym">DVMRP</acronym> multicast routing
	protocol and is configured by editing
	<code class="filename">/usr/local/etc/mrouted.conf</code> in order to
	set up the tunnels and <acronym class="acronym">DVMRP</acronym>.  The
	installation of <span class="application">mrouted</span> also
	installs <span class="application">map-mbone</span> and
	<span class="application">mrinfo</span>, as well as their associated
	man pages.  Refer to these for configuration examples.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><acronym class="acronym">DVMRP</acronym> has largely been replaced by
	  the <acronym class="acronym">PIM</acronym> protocol in many multicast
	  installations.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pim&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pim</span>(4)</span></a> for more
	  information.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-wireless"></a>31.3. 無線網路</h2></div><div><span class="authorgroup"><span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="othername">Loader</span></span>, <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Murray</span> <span class="surname">Stokely</span></span>. </span></div></div></div><a id="idp87237816" class="indexterm"></a><a id="idp87238328" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87243320"></a>31.3.1. 無線網路基礎</h3></div></div></div><p xml:lang="en" lang="en">Most wireless networks are based on the <span class="trademark">IEEE</span>® 802.11
	standards.  A basic wireless network consists of multiple
	stations communicating with radios that broadcast in either
	the 2.4GHz or 5GHz band, though this varies according to the
	locale and is also changing to enable communication in the
	2.3GHz and 4.9GHz ranges.</p><p xml:lang="en" lang="en">802.11 networks are organized in two ways.  In
	<span class="emphasis"><em>infrastructure mode</em></span>, one station acts as
	a
	master with all the other stations associating to it, the
	network is known as a <acronym class="acronym">BSS</acronym>, and the master
	station is termed an access point (<acronym class="acronym">AP</acronym>).
	In a <acronym class="acronym">BSS</acronym>, all communication passes through
	the <acronym class="acronym">AP</acronym>; even when one station wants to
	communicate with another wireless station, messages must go
	through the <acronym class="acronym">AP</acronym>.  In the second form of
	network, there is no master and stations communicate directly.
	This form of network is termed an <acronym class="acronym">IBSS</acronym>
	and is commonly known as an <span class="emphasis"><em>ad-hoc
	  network</em></span>.</p><p xml:lang="en" lang="en">802.11 networks were first deployed in the 2.4GHz band
	using protocols defined by the <span class="trademark">IEEE</span>® 802.11 and 802.11b
	standard.  These specifications include the operating
	frequencies and the <acronym class="acronym">MAC</acronym> layer
	characteristics, including framing and transmission rates,
	as communication can occur at various rates.  Later, the
	802.11a standard defined operation in the 5GHz band, including
	different signaling mechanisms and higher transmission rates.
	Still later, the 802.11g standard defined the use of 802.11a
	signaling and transmission mechanisms in the 2.4GHz band in
	such a way as to be backwards compatible with 802.11b
	networks.</p><p xml:lang="en" lang="en">Separate from the underlying transmission techniques,
	802.11 networks have a variety of security mechanisms.  The
	original 802.11 specifications defined a simple security
	protocol called <acronym class="acronym">WEP</acronym>.  This protocol uses a
	fixed pre-shared key and the RC4 cryptographic cipher to
	encode data transmitted on a network.  Stations must all
	agree on the fixed key in order to communicate.  This scheme
	was shown to be easily broken and is now rarely used except
	to discourage transient users from joining networks.  Current
	security practice is given by the <span class="trademark">IEEE</span>® 802.11i specification
	that defines new cryptographic ciphers and an additional
	protocol to authenticate stations to an access point and
	exchange keys for data communication.  Cryptographic keys
	are periodically refreshed and there are mechanisms for
	detecting and countering intrusion attempts.  Another
	security protocol specification commonly used in wireless
	networks is termed <acronym class="acronym">WPA</acronym>, which was a
	precursor to 802.11i.  <acronym class="acronym">WPA</acronym> specifies a
	subset of the requirements found in 802.11i and is designed
	for implementation on legacy hardware.  Specifically,
	<acronym class="acronym">WPA</acronym> requires only the
	<acronym class="acronym">TKIP</acronym> cipher that is derived from the
	original <acronym class="acronym">WEP</acronym> cipher.  802.11i permits use
	of <acronym class="acronym">TKIP</acronym> but also requires support for a
	stronger cipher, AES-CCM, for encrypting data.  The
	<acronym class="acronym">AES</acronym> cipher was not required in
	<acronym class="acronym">WPA</acronym> because it was deemed too
	computationally costly to be implemented on legacy
	hardware.</p><p xml:lang="en" lang="en">The other standard to be aware of is 802.11e.  It defines
	protocols for deploying multimedia applications, such as
	streaming video and voice over IP (<acronym class="acronym">VoIP</acronym>),
	in an 802.11 network.  Like 802.11i, 802.11e also has a
	precursor specification termed <acronym class="acronym">WME</acronym> (later
	renamed <acronym class="acronym">WMM</acronym>) that has been defined by an
	industry group as a subset of 802.11e that can be deployed now
	to enable multimedia applications while waiting for the final
	ratification of 802.11e.  The most important thing to know
	about 802.11e and
	<acronym class="acronym">WME</acronym>/<acronym class="acronym">WMM</acronym> is that it
	enables prioritized traffic over a wireless network through
	Quality of Service (<acronym class="acronym">QoS</acronym>) protocols and
	enhanced media access protocols.  Proper implementation of
	these protocols enables high speed bursting of data and
	prioritized traffic flow.</p><p xml:lang="en" lang="en">FreeBSD supports networks that operate using 802.11a,
	802.11b, and 802.11g.  The <acronym class="acronym">WPA</acronym> and 802.11i
	security protocols are likewise supported (in conjunction with
	any of 11a, 11b, and 11g) and <acronym class="acronym">QoS</acronym> and
	traffic prioritization required by the
	<acronym class="acronym">WME</acronym>/<acronym class="acronym">WMM</acronym> protocols are
	supported for a limited set of wireless devices.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-quick-start"></a>31.3.2. 快速開始</h3></div></div></div><p xml:lang="en" lang="en">Connecting a computer to an existing wireless network is
	a very common situation.  This procedure shows the steps
	required.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">Obtain the <acronym class="acronym">SSID</acronym> (Service Set
	    Identifier) and <acronym class="acronym">PSK</acronym> (Pre-Shared Key)
	    for the wireless network from the network
	    administrator.</p></li><li class="step"><p xml:lang="en" lang="en">Identify the wireless adapter.  The FreeBSD
	    <code class="filename">GENERIC</code> kernel includes drivers for
	    many common wireless adapters.  If the wireless adapter is
	    one of those models, it will be shown in the output from
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>ifconfig | grep -B3 -i wireless</code></strong></pre><p xml:lang="en" lang="en">On FreeBSD 11 or higher, use this command
	    instead:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>sysctl net.wlan.devices</code></strong></pre><p xml:lang="en" lang="en">If a wireless adapter is not listed, an additional
	    kernel module might be required, or it might be a model
	    not supported by FreeBSD.</p><p xml:lang="en" lang="en">This example shows the Atheros <code class="literal">ath0</code>
	    wireless adapter.</p></li><li class="step"><p xml:lang="en" lang="en">Add an entry for this network to
	    <code class="filename">/etc/wpa_supplicant.conf</code>.  If the
	    file does not exist, create it.  Replace
	    <em class="replaceable"><code>myssid</code></em> and
	    <em class="replaceable"><code>mypsk</code></em> with the
	    <acronym class="acronym">SSID</acronym> and <acronym class="acronym">PSK</acronym>
	    provided by the network administrator.</p><pre xml:lang="en" class="programlisting" lang="en">network={
	ssid="<em class="replaceable"><code>myssid</code></em>"
	psk="<em class="replaceable"><code>mypsk</code></em>"
}</pre></li><li class="step"><p xml:lang="en" lang="en">Add entries to <code class="filename">/etc/rc.conf</code> to
	    configure the network on startup:</p><pre xml:lang="en" class="programlisting" lang="en">wlans_<em class="replaceable"><code>ath0</code></em>="wlan0"
ifconfig_wlan0="WPA SYNCDHCP"</pre></li><li class="step"><p xml:lang="en" lang="en">Restart the computer, or restart the network service
	    to connect to the network:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service netif restart</code></strong></pre></li></ol></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-basic"></a>31.3.3. 基礎設定</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87286712"></a>31.3.3.1. 核心設定</h4></div></div></div><p xml:lang="en" lang="en">To use wireless networking, a wireless networking card
	  is needed and the kernel needs to be configured with the
	  appropriate wireless networking support.  The kernel is
	  separated into multiple modules so that only the required
	  support needs to be configured.</p><p xml:lang="en" lang="en">The most
	  commonly used wireless devices are those that use parts made
	  by Atheros.  These devices are supported by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ath&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ath</span>(4)</span></a>
	  and require the following line to be added to
	  <code class="filename">/boot/loader.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">if_ath_load="YES"</pre><p xml:lang="en" lang="en">The Atheros driver is split up into three separate
	  pieces: the driver (<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ath&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ath</span>(4)</span></a>), the hardware support
	  layer that handles chip-specific functions
	  (<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ath_hal&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ath_hal</span>(4)</span></a>), and an algorithm for selecting the
	  rate for transmitting frames.  When this support is loaded
	  as kernel modules, any dependencies are automatically
	  handled.  To load support for a different type of wireless
	  device, specify the module for that device.  This example
	  is for devices based on the Intersil Prism parts
	  (<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wi&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wi</span>(4)</span></a>) driver:</p><pre xml:lang="en" class="programlisting" lang="en">if_wi_load="YES"</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The examples in this section use an <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ath&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ath</span>(4)</span></a>
	    device and the device name in the examples must be
	    changed according to the configuration.  A list of
	    available wireless drivers and supported adapters can be
	    found in the FreeBSD Hardware Notes, available on
	    the <a class="link" href="https://www.FreeBSD.org/releases/index.html" target="_top">Release
	      Information</a> page of the FreeBSD website.  If a
	    native FreeBSD driver for the wireless device does not
	    exist, it may be possible to use the <span class="trademark">Windows</span>® driver
	    with the help of the <a class="link" href="#config-network-ndis" title="11.5.1.1. 使用 Windows® NDIS 驅動程式">NDIS</a> driver
	    wrapper.</p></div><p xml:lang="en" lang="en">In addition, the modules that implement cryptographic
	  support for the security protocols to use must be loaded.
	  These are intended to be dynamically loaded on demand by
	  the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan</span>(4)</span></a> module, but for now they must be manually
	  configured.  The following modules are available:
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan_wep&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan_wep</span>(4)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan_ccmp&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan_ccmp</span>(4)</span></a>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan_tkip&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan_tkip</span>(4)</span></a>.
	  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan_ccmp&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan_ccmp</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan_tkip&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan_tkip</span>(4)</span></a> drivers are
	  only needed when using the <acronym class="acronym">WPA</acronym> or
	  802.11i security protocols.  If the network does not use
	  encryption, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan_wep&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan_wep</span>(4)</span></a> support is not needed.  To
	  load these modules at boot time, add the following lines to
	  <code class="filename">/boot/loader.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">wlan_wep_load="YES"
wlan_ccmp_load="YES"
wlan_tkip_load="YES"</pre><p xml:lang="en" lang="en">Once this information has been added to
	  <code class="filename">/boot/loader.conf</code>, reboot the FreeBSD
	  box.  Alternately, load the modules by hand using
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">For users who do not want to use modules, it is
	    possible to compile these drivers into the kernel by
	    adding the following lines to a custom kernel
	    configuration file:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="programlisting" lang="en">device wlan              # 802.11 support
device wlan_wep          # 802.11 WEP support
device wlan_ccmp         # 802.11 CCMP support
device wlan_tkip         # 802.11 TKIP support
device wlan_amrr         # AMRR transmit rate control algorithm
device ath               # Atheros pci/cardbus NIC's
device ath_hal           # pci/cardbus chip support
options AH_SUPPORT_AR5416 # enable AR5416 tx/rx descriptors
device ath_rate_sample   # SampleRate tx rate control for ath</pre><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">With this information in the kernel configuration
	    file, recompile the kernel and reboot the FreeBSD
	    machine.</p></div><p xml:lang="en" lang="en">Information about the wireless device should appear
	  in the boot messages, like this:</p><pre xml:lang="en" class="screen" lang="en">ath0: &lt;Atheros 5212&gt; mem 0x88000000-0x8800ffff irq 11 at device 0.0 on cardbus1
ath0: [ITHREAD]
ath0: AR2413 mac 7.9 RF2413 phy 4.5</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87329208"></a>31.3.3.2. 設定正確的區域</h4></div></div></div><p xml:lang="en" lang="en">Since the regulatory situation is different
	  in various parts of the world, it is necessary to
	  correctly set the domains that apply to your location to
	  have the correct information about what channels can be
	  used.</p><p xml:lang="en" lang="en">The available region definitions can be found in
	  <code class="filename">/etc/regdomain.xml</code>.  To set the data at
	  runtime, use <code class="command">ifconfig</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> regdomain <em class="replaceable"><code>ETSI</code></em> country <em class="replaceable"><code>AT</code></em></code></strong></pre><p xml:lang="en" lang="en">To persist the settings, add it to
	  <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sysrc create_args_wlan0="country <em class="replaceable"><code>AT</code></em> regdomain <em class="replaceable"><code>ETSI</code></em>"</code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87336632"></a>31.3.4. 主從式 (Infrastructure)</h3></div></div></div><p xml:lang="en" lang="en">Infrastructure (<acronym class="acronym">BSS</acronym>) mode is the
	mode that is typically used.  In this mode, a number of
	wireless access points are connected to a wired network.
	Each wireless network has its own name, called the
	<acronym class="acronym">SSID</acronym>.  Wireless clients connect to the
	wireless access points.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87338552"></a>31.3.4.1. FreeBSD 客戶端</h4></div></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87339192"></a>31.3.4.1.1. 如何尋找存取點</h5></div></div></div><p xml:lang="en" lang="en">To scan for available networks, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>.
	    This request may take a few moments to complete as it
	    requires the system to switch to each available wireless
	    frequency and probe for available access points.  Only
	    the superuser can initiate a scan:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> up scan</code></strong>
SSID/MESH ID    BSSID              CHAN RATE   S:N     INT CAPS
dlinkap         00:13:46:49:41:76   11   54M -90:96   100 EPS  WPA WME
freebsdap       00:11:95:c3:0d:ac    1   54M -83:96   100 EPS  WPA</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The interface must be <code class="option">up</code> before
	      it can scan.  Subsequent scan requests do not require
	      the interface to be marked as up again.</p></div><p xml:lang="en" lang="en">The output of a scan request lists each
	    <acronym class="acronym">BSS</acronym>/<acronym class="acronym">IBSS</acronym> network
	    found.  Besides listing the name of the network, the
	    <code class="literal">SSID</code>, the output also shows the
	    <code class="literal">BSSID</code>, which is the
	    <acronym class="acronym">MAC</acronym> address of the access point.  The
	    <code class="literal">CAPS</code> field identifies the type of
	    each network and the capabilities of the stations
	    operating there:</p><div class="table"><a id="idp87360568"></a><div class="table-title">表格 31.2. 站台功能代號</div><div class="table-contents"><table summary="站台功能代號" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>功能代號</th><th>意義</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><code class="literal">E</code></td><td xml:lang="en" lang="en">Extended Service Set
		    (<acronym class="acronym">ESS</acronym>).  Indicates that
		    the station is part of an infrastructure network
		    rather than an <acronym class="acronym">IBSS</acronym>/ad-hoc
		    network.</td></tr><tr><td xml:lang="en" lang="en"><code class="literal">I</code></td><td xml:lang="en" lang="en"><acronym class="acronym">IBSS</acronym>/ad-hoc network.
		    Indicates that the station is part of an ad-hoc
		    network rather than an <acronym class="acronym">ESS</acronym>
		    network.</td></tr><tr><td xml:lang="en" lang="en"><code class="literal">P</code></td><td xml:lang="en" lang="en">Privacy.  Encryption is required for all
		    data frames exchanged within the
		    <acronym class="acronym">BSS</acronym> using cryptographic means
		    such as <acronym class="acronym">WEP</acronym>,
		    <acronym class="acronym">TKIP</acronym> or
		    <acronym class="acronym">AES</acronym>-<acronym class="acronym">CCMP</acronym>.</td></tr><tr><td xml:lang="en" lang="en"><code class="literal">S</code></td><td xml:lang="en" lang="en">Short Preamble.  Indicates that the network
		    is using short preambles, defined in 802.11b High
		    Rate/DSSS PHY, and utilizes a 56 bit sync field
		    rather than the 128 bit field used in long
		    preamble mode.</td></tr><tr><td xml:lang="en" lang="en"><code class="literal">s</code></td><td xml:lang="en" lang="en">Short slot time.  Indicates that the 802.11g
		    network is using a short slot time because there
		    are no legacy (802.11b) stations present.</td></tr></tbody></table></div></div><br class="table-break" /><p xml:lang="en" lang="en">One can also display the current list of known
	    networks with:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> list scan</code></strong></pre><p xml:lang="en" lang="en">This information may be updated automatically by the
	    adapter or manually with a <code class="option">scan</code> request.
	    Old data is automatically removed from the cache, so over
	    time this list may shrink unless more scans are
	    done.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87386168"></a>31.3.4.1.2. 基礎設定</h5></div></div></div><p xml:lang="en" lang="en">This section provides a simple example of how to make
	    the wireless network adapter work in FreeBSD without
	    encryption.  Once familiar with these concepts, it is
	    strongly recommend to use <a class="link" href="#network-wireless-wpa" title="31.3.4.1.3. WPA">WPA</a> to set up
	    the wireless network.</p><p xml:lang="en" lang="en">There are three basic steps to configure a wireless
	    network: select an access point, authenticate the
	    station, and configure an <acronym class="acronym">IP</acronym> address.
	    The following sections discuss each step.</p><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87388728"></a>31.3.4.1.2.1. 選擇存取點</h6></div></div></div><p xml:lang="en" lang="en">Most of the time, it is sufficient to let the system
	      choose an access point using the builtin heuristics.
	      This is the default behavior when an interface is
	      marked as up or it is listed in
	      <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">wlans_ath0="wlan0"
ifconfig_wlan0="DHCP"</pre><p xml:lang="en" lang="en">If there are multiple access points, a specific
	      one can be selected by its
	      <acronym class="acronym">SSID</acronym>:</p><pre xml:lang="en" class="programlisting" lang="en">wlans_ath0="wlan0"
ifconfig_wlan0="ssid <em class="replaceable"><code>your_ssid_here</code></em> DHCP"</pre><p xml:lang="en" lang="en">In an environment where there are multiple access
	      points with the same <acronym class="acronym">SSID</acronym>, which
	      is often done to simplify roaming, it may be necessary
	      to associate to one specific device.  In this case, the
	      <acronym class="acronym">BSSID</acronym> of the access point can be
	      specified, with or without the
	      <acronym class="acronym">SSID</acronym>:</p><pre xml:lang="en" class="programlisting" lang="en">wlans_ath0="wlan0"
ifconfig_wlan0="ssid <em class="replaceable"><code>your_ssid_here</code></em> bssid <em class="replaceable"><code>xx:xx:xx:xx:xx:xx</code></em> DHCP"</pre><p xml:lang="en" lang="en">There are other ways to constrain the choice of an
	      access point, such as limiting the set of frequencies
	      the system will scan on.  This may be useful for a
	      multi-band wireless card as scanning all the possible
	      channels can be time-consuming.  To limit operation to a
	      specific band, use the <code class="option">mode</code>
	      parameter:</p><pre xml:lang="en" class="programlisting" lang="en">wlans_ath0="wlan0"
ifconfig_wlan0="mode <em class="replaceable"><code>11g</code></em> ssid <em class="replaceable"><code>your_ssid_here</code></em> DHCP"</pre><p xml:lang="en" lang="en">This example will force the card to operate in
	      802.11g, which is defined only for 2.4GHz frequencies
	      so any 5GHz channels will not be considered.  This can
	      also be achieved with the
	      <code class="option">channel</code> parameter, which locks
	      operation to one specific frequency, and the
	      <code class="option">chanlist</code> parameter, to specify a list
	      of channels for scanning.  More information about these
	      parameters can be found in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>.</p></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87404088"></a>31.3.4.1.2.2. 認證</h6></div></div></div><p xml:lang="en" lang="en">Once an access point is selected, the station
	      needs to authenticate before it can pass data.
	      Authentication can happen in several ways.  The most
	      common scheme, open authentication, allows any station
	      to join the network and communicate.  This is the
	      authentication to use for test purposes the first time
	      a wireless network is setup.  Other schemes require
	      cryptographic handshakes to be completed before data
	      traffic can flow, either using pre-shared keys or
	      secrets, or more complex schemes that involve backend
	      services such as <acronym class="acronym">RADIUS</acronym>.  Open
	      authentication is the default setting.  The next most
	      common setup is <acronym class="acronym">WPA-PSK</acronym>, also
	      known as <acronym class="acronym">WPA</acronym> Personal, which is
	      described in <a class="xref" href="#network-wireless-wpa-wpa-psk" title="31.3.4.1.3.1. WPA-PSK">節 31.3.4.1.3.1, “<acronym class="acronym">WPA-PSK</acronym>”</a>.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">If using an <span class="trademark">Apple</span>® <span class="trademark">AirPort</span>® Extreme base
		station for an access point, shared-key authentication
		together with a <acronym class="acronym">WEP</acronym> key needs to
		be configured.  This can be configured in
		<code class="filename">/etc/rc.conf</code> or by using
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a>.  For a single <span class="trademark">AirPort</span>® base
		station, access can be configured with:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="programlisting" lang="en">wlans_ath0="wlan0"
ifconfig_wlan0="authmode shared wepmode on weptxkey <em class="replaceable"><code>1</code></em> wepkey <em class="replaceable"><code>01234567</code></em> DHCP"</pre><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">In general, shared key authentication should be
		avoided because it uses the <acronym class="acronym">WEP</acronym> key
		material in a highly-constrained manner, making it
		even easier to crack the key.  If
		<acronym class="acronym">WEP</acronym> must be used for compatibility
		with legacy devices, it is better to use
		<acronym class="acronym">WEP</acronym> with <code class="literal">open</code>
		authentication.  More information regarding
		<acronym class="acronym">WEP</acronym> can be found in <a class="xref" href="#network-wireless-wep" title="31.3.4.1.4. WEP">節 31.3.4.1.4, “<acronym class="acronym">WEP</acronym>”</a>.</p></div></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87419064"></a>31.3.4.1.2.3. 使用 <acronym class="acronym">DHCP</acronym> 取得 <acronym class="acronym">IP</acronym> 位址</h6></div></div></div><p xml:lang="en" lang="en">Once an access point is selected and the
	      authentication parameters are set, an
	      <acronym class="acronym">IP</acronym> address must be obtained in
	      order to communicate.  Most of the time, the
	      <acronym class="acronym">IP</acronym> address is obtained via
	      <acronym class="acronym">DHCP</acronym>.  To achieve that, edit
	      <code class="filename">/etc/rc.conf</code> and add
	      <code class="literal">DHCP</code> to the configuration for the
	      device:</p><pre xml:lang="en" class="programlisting" lang="en">wlans_ath0="wlan0"
ifconfig_wlan0="DHCP"</pre><p xml:lang="en" lang="en">The
	      wireless interface is now ready to bring up:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service netif start</code></strong></pre><p xml:lang="en" lang="en">Once the interface is running, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>
	      to see the status of the interface
	      <code class="filename">ath0</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        ether 00:11:95:d5:43:62
        inet 192.168.1.100 netmask 0xffffff00 broadcast 192.168.1.255
        media: IEEE 802.11 Wireless Ethernet OFDM/54Mbps mode 11g
        status: associated
        ssid dlinkap channel 11 (2462 Mhz 11g) bssid 00:13:46:49:41:76
        country US ecm authmode OPEN privacy OFF txpower 21.5 bmiss 7
        scanvalid 60 bgscan bgscanintvl 300 bgscanidle 250 roam:rssi 7
        roam:rate 5 protmode CTS wme burst</pre><p xml:lang="en" lang="en">The <code class="literal">status: associated</code> line means
	      that it is connected to the wireless network.  The
	      <code class="literal">bssid 00:13:46:49:41:76</code> is the
	      <acronym class="acronym">MAC</acronym> address of the access point and
	      <code class="literal">authmode OPEN</code> indicates that the
	      communication is not encrypted.</p></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87434296"></a>31.3.4.1.2.4. 靜態 <acronym class="acronym">IP</acronym> 位址</h6></div></div></div><p xml:lang="en" lang="en">If an <acronym class="acronym">IP</acronym> address cannot be
	      obtained from a <acronym class="acronym">DHCP</acronym> server, set a
	      fixed <acronym class="acronym">IP</acronym> address.  Replace the
	      <code class="literal">DHCP</code> keyword shown above with the
	      address information.  Be sure to retain any other
	      parameters for selecting the access point:</p><pre xml:lang="en" class="programlisting" lang="en">wlans_ath0="wlan0"
ifconfig_wlan0="inet <em class="replaceable"><code>192.168.1.100</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> ssid <em class="replaceable"><code>your_ssid_here</code></em>"</pre></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-wpa"></a>31.3.4.1.3. <acronym class="acronym">WPA</acronym></h5></div></div></div><p xml:lang="en" lang="en">Wi-Fi Protected Access (<acronym class="acronym">WPA</acronym>) is a
	    security protocol used together with 802.11 networks to
	    address the lack of proper authentication and the weakness
	    of <acronym class="acronym">WEP</acronym>.  WPA leverages the 802.1X
	    authentication protocol and uses one of several ciphers
	    instead of <acronym class="acronym">WEP</acronym> for data integrity.
	    The only cipher required by <acronym class="acronym">WPA</acronym> is the
	    Temporary Key Integrity Protocol
	    (<acronym class="acronym">TKIP</acronym>).  <acronym class="acronym">TKIP</acronym> is a
	    cipher that extends the basic RC4 cipher used by
	    <acronym class="acronym">WEP</acronym> by adding integrity checking,
	    tamper detection, and measures for responding to detected
	    intrusions.  <acronym class="acronym">TKIP</acronym> is designed to work
	    on legacy hardware with only software modification.  It
	    represents a compromise that improves security but is
	    still not entirely immune to attack.
	    <acronym class="acronym">WPA</acronym> also specifies the
	    <acronym class="acronym">AES-CCMP</acronym> cipher as an alternative to
	    <acronym class="acronym">TKIP</acronym>, and that is preferred when
	    possible.  For this specification, the term
	    <acronym class="acronym">WPA2</acronym> or <acronym class="acronym">RSN</acronym> is
	    commonly used.</p><p xml:lang="en" lang="en"><acronym class="acronym">WPA</acronym> defines authentication and
	    encryption protocols.  Authentication is most commonly
	    done using one of two techniques: by 802.1X and a backend
	    authentication service such as <acronym class="acronym">RADIUS</acronym>,
	    or by a minimal handshake between the station and the
	    access point using a pre-shared secret.  The former is
	    commonly termed <acronym class="acronym">WPA</acronym> Enterprise and the
	    latter is known as <acronym class="acronym">WPA</acronym> Personal.  Since
	    most people will not set up a <acronym class="acronym">RADIUS</acronym>
	    backend server for their wireless network,
	    <acronym class="acronym">WPA-PSK</acronym> is by far the most commonly
	    encountered configuration for
	    <acronym class="acronym">WPA</acronym>.</p><p xml:lang="en" lang="en">The control of the wireless connection and the key
	    negotiation or authentication with a server is done using
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a>.  This program requires a
	    configuration file,
	    <code class="filename">/etc/wpa_supplicant.conf</code>, to run.
	    More information regarding this file can be found in
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant.conf</span>(5)</span></a>.</p><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-wpa-wpa-psk"></a>31.3.4.1.3.1. <acronym class="acronym">WPA-PSK</acronym></h6></div></div></div><p xml:lang="en" lang="en"><acronym class="acronym">WPA-PSK</acronym>, also known as
	      <acronym class="acronym">WPA</acronym> Personal, is based on a
	      pre-shared key (<acronym class="acronym">PSK</acronym>) which is
	      generated from a given password and used as the master
	      key in the wireless network.  This means every wireless
	      user will share the same key.
	      <acronym class="acronym">WPA-PSK</acronym> is intended for small
	      networks where the use of an authentication server is
	      not possible or desired.</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Always use strong passwords that are sufficiently
		long and made from a rich alphabet so that they will
		not be easily guessed or attacked.</p></div><p xml:lang="en" lang="en">The first step is the configuration of
	      <code class="filename">/etc/wpa_supplicant.conf</code> with
	      the <acronym class="acronym">SSID</acronym> and the pre-shared key of
	      the network:</p><pre xml:lang="en" class="programlisting" lang="en">network={
  ssid="freebsdap"
  psk="freebsdmall"
}</pre><p xml:lang="en" lang="en">Then, in <code class="filename">/etc/rc.conf</code>,
	      indicate that the wireless device configuration will be
	      done with <acronym class="acronym">WPA</acronym> and the
	      <acronym class="acronym">IP</acronym> address will be obtained with
	      <acronym class="acronym">DHCP</acronym>:</p><pre xml:lang="en" class="programlisting" lang="en">wlans_ath0="wlan0"
ifconfig_wlan0="WPA DHCP"</pre><p xml:lang="en" lang="en">Then, bring up the interface:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service netif start</code></strong>
Starting wpa_supplicant.
DHCPDISCOVER on wlan0 to 255.255.255.255 port 67 interval 5
DHCPDISCOVER on wlan0 to 255.255.255.255 port 67 interval 6
DHCPOFFER from 192.168.0.1
DHCPREQUEST on wlan0 to 255.255.255.255 port 67
DHCPACK from 192.168.0.1
bound to 192.168.0.254 -- renewal in 300 seconds.
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet OFDM/36Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</pre><p xml:lang="en" lang="en">Or, try to configure the interface manually using
	      the information in
	      <code class="filename">/etc/wpa_supplicant.conf</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>wpa_supplicant -i <em class="replaceable"><code>wlan0</code></em> -c /etc/wpa_supplicant.conf</code></strong>
Trying to associate with 00:11:95:c3:0d:ac (SSID='freebsdap' freq=2412 MHz)
Associated with 00:11:95:c3:0d:ac
WPA: Key negotiation completed with 00:11:95:c3:0d:ac [PTK=CCMP GTK=CCMP]
CTRL-EVENT-CONNECTED - Connection to 00:11:95:c3:0d:ac completed (auth) [id=0 id_str=]</pre><p xml:lang="en" lang="en">The next operation is to launch <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dhclient&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dhclient</span>(8)</span></a>
	      to get the <acronym class="acronym">IP</acronym> address from the
	      <acronym class="acronym">DHCP</acronym> server:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>dhclient <em class="replaceable"><code>wlan0</code></em></code></strong>
DHCPREQUEST on wlan0 to 255.255.255.255 port 67
DHCPACK from 192.168.0.1
bound to 192.168.0.254 -- renewal in 300 seconds.
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet OFDM/36Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">If <code class="filename">/etc/rc.conf</code> has an
		<code class="literal">ifconfig_wlan0="DHCP"</code> entry,
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dhclient&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dhclient</span>(8)</span></a> will be launched automatically after
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a> associates with the access
		point.</p></div><p xml:lang="en" lang="en">If <acronym class="acronym">DHCP</acronym> is not possible or
	      desired, set a static <acronym class="acronym">IP</acronym> address
	      after <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a> has authenticated the
	      station:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.0.100</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.100 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet OFDM/36Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</pre><p xml:lang="en" lang="en">When <acronym class="acronym">DHCP</acronym> is not used, the
	      default gateway and the nameserver also have to be
	      manually set:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>route add default <em class="replaceable"><code>your_default_router</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>echo "nameserver <em class="replaceable"><code>your_DNS_server</code></em>" &gt;&gt; /etc/resolv.conf</code></strong></pre></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-wpa-eap-tls"></a>31.3.4.1.3.2. <acronym class="acronym">WPA</acronym> 加上 <acronym class="acronym">EAP-TLS</acronym></h6></div></div></div><p xml:lang="en" lang="en">The second way to use <acronym class="acronym">WPA</acronym> is with
	      an 802.1X backend authentication server.  In this case,
	      <acronym class="acronym">WPA</acronym> is called
	      <acronym class="acronym">WPA</acronym> Enterprise to differentiate it
	      from the less secure <acronym class="acronym">WPA</acronym> Personal.
	      Authentication in <acronym class="acronym">WPA</acronym> Enterprise is
	      based on the Extensible Authentication Protocol
	      (<acronym class="acronym">EAP</acronym>).</p><p xml:lang="en" lang="en"><acronym class="acronym">EAP</acronym> does not come with an
	      encryption method.  Instead, <acronym class="acronym">EAP</acronym> is
	      embedded inside an encrypted tunnel.  There are many
	      <acronym class="acronym">EAP</acronym> authentication methods, but
	      <acronym class="acronym">EAP-TLS</acronym>, <acronym class="acronym">EAP-TTLS</acronym>,
	      and <acronym class="acronym">EAP-PEAP</acronym> are the most
	      common.</p><p xml:lang="en" lang="en">EAP with Transport Layer Security
	      (<acronym class="acronym">EAP-TLS</acronym>) is a well-supported
	      wireless authentication protocol since it was the
	      first <acronym class="acronym">EAP</acronym> method to be certified
	      by the <a class="link" href="http://www.wi-fi.org/" target="_top">Wi-Fi
		Alliance</a>.  <acronym class="acronym">EAP-TLS</acronym> requires
	      three certificates to run: the certificate of the
	      Certificate Authority (<acronym class="acronym">CA</acronym>) installed
	      on all machines, the server certificate for the
	      authentication server, and one client certificate for
	      each wireless client.  In this <acronym class="acronym">EAP</acronym>
	      method, both the authentication server and wireless
	      client authenticate each other by presenting their
	      respective certificates, and then verify that these
	      certificates were signed by the organization's
	      <acronym class="acronym">CA</acronym>.</p><p xml:lang="en" lang="en">As previously, the configuration is done via
	      <code class="filename">/etc/wpa_supplicant.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">network={
  ssid="freebsdap" <a id="co-tls-ssid"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
  proto=RSN  <a id="co-tls-proto"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
  key_mgmt=WPA-EAP <a id="co-tls-kmgmt"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
  eap=TLS <a id="co-tls-eap"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
  identity="loader" <a id="co-tls-id"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
  ca_cert="/etc/certs/cacert.pem" <a id="co-tls-cacert"></a><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span>
  client_cert="/etc/certs/clientcert.pem" <a id="co-tls-clientcert"></a><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span>
  private_key="/etc/certs/clientkey.pem" <a id="co-tls-pkey"></a><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span>
  private_key_passwd="freebsdmallclient" <a id="co-tls-pwd"></a><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span>
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-ssid"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">This field indicates the network name
		  (<acronym class="acronym">SSID</acronym>).</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-proto"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">This example uses the <acronym class="acronym">RSN</acronym>
		  <span class="trademark">IEEE</span>® 802.11i protocol, also known as
		  <acronym class="acronym">WPA2</acronym>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-kmgmt"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The <code class="literal">key_mgmt</code> line refers to
		  the key management protocol to use.  In this
		  example, it is <acronym class="acronym">WPA</acronym> using
		  <acronym class="acronym">EAP</acronym> authentication.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-eap"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">This field indicates the <acronym class="acronym">EAP</acronym>
		  method for the connection.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-id"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The <code class="literal">identity</code> field contains
		  the identity string for
		  <acronym class="acronym">EAP</acronym>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-cacert"><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The <code class="literal">ca_cert</code> field indicates
		  the pathname of the <acronym class="acronym">CA</acronym>
		  certificate file.  This file is needed to verify
		  the server certificate.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-clientcert"><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The <code class="literal">client_cert</code> line gives
		  the pathname to the client certificate file.  This
		  certificate is unique to each wireless client of the
		  network.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-pkey"><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The <code class="literal">private_key</code> field is the
		  pathname to the client certificate private key
		  file.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-pwd"><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The <code class="literal">private_key_passwd</code> field
		  contains the passphrase for the private key.</p></td></tr></table></div><p xml:lang="en" lang="en">Then, add the following lines to
	      <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">wlans_ath0="wlan0"
ifconfig_wlan0="WPA DHCP"</pre><p xml:lang="en" lang="en">The next step is to bring up the interface:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service netif start</code></strong>
Starting wpa_supplicant.
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 7
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 15
DHCPACK from 192.168.0.20
bound to 192.168.0.254 -- renewal in 300 seconds.
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet DS/11Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</pre><p xml:lang="en" lang="en">It is also possible to bring up the interface
	      manually using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a> and
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>.</p></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-wpa-eap-ttls"></a>31.3.4.1.3.3. <acronym class="acronym">WPA</acronym> 加上 <acronym class="acronym">EAP-TTLS</acronym></h6></div></div></div><p xml:lang="en" lang="en">With <acronym class="acronym">EAP-TLS</acronym>, both the
	      authentication server and the client need a certificate.
	      With <acronym class="acronym">EAP-TTLS</acronym>, a client certificate
	      is optional.  This method is similar to a web server
	      which creates a secure <acronym class="acronym">SSL</acronym> tunnel
	      even if visitors do not have client-side certificates.
	      <acronym class="acronym">EAP-TTLS</acronym> uses an encrypted
	      <acronym class="acronym">TLS</acronym> tunnel for safe transport of
	      the authentication data.</p><p xml:lang="en" lang="en">The required configuration can be added to
	      <code class="filename">/etc/wpa_supplicant.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">network={
  ssid="freebsdap"
  proto=RSN
  key_mgmt=WPA-EAP
  eap=TTLS <a id="co-ttls-eap"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
  identity="test" <a id="co-ttls-id"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
  password="test" <a id="co-ttls-passwd"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
  ca_cert="/etc/certs/cacert.pem" <a id="co-ttls-cacert"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
  phase2="auth=MD5" <a id="co-ttls-pha2"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttls-eap"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">This field specifies the <acronym class="acronym">EAP</acronym>
		  method for the connection.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttls-id"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The <code class="literal">identity</code> field contains
		  the identity string for <acronym class="acronym">EAP</acronym>
		  authentication inside the encrypted
		  <acronym class="acronym">TLS</acronym> tunnel.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttls-passwd"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The <code class="literal">password</code> field contains
		  the passphrase for the <acronym class="acronym">EAP</acronym>
		  authentication.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttls-cacert"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The <code class="literal">ca_cert</code> field indicates
		  the pathname of the <acronym class="acronym">CA</acronym>
		  certificate file.  This file is needed to verify
		  the server certificate.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttls-pha2"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">This field specifies the authentication
		  method used in the encrypted <acronym class="acronym">TLS</acronym>
		  tunnel.  In this example,
		  <acronym class="acronym">EAP</acronym> with MD5-Challenge is used.
		  The <span class="quote">“<span class="quote">inner authentication</span>”</span> phase is
		  often called <span class="quote">“<span class="quote">phase2</span>”</span>.</p></td></tr></table></div><p xml:lang="en" lang="en">Next, add the following lines to
	      <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">wlans_ath0="wlan0"
ifconfig_wlan0="WPA DHCP"</pre><p xml:lang="en" lang="en">The next step is to bring up the interface:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service netif start</code></strong>
Starting wpa_supplicant.
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 7
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 15
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 21
DHCPACK from 192.168.0.20
bound to 192.168.0.254 -- renewal in 300 seconds.
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet DS/11Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</pre></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-wpa-eap-peap"></a>31.3.4.1.3.4. <acronym class="acronym">WPA</acronym> 加上 <acronym class="acronym">EAP-PEAP</acronym></h6></div></div></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><acronym class="acronym">PEAPv0/EAP-MSCHAPv2</acronym> is the most
		common <acronym class="acronym">PEAP</acronym> method.  In this
		chapter, the term <acronym class="acronym">PEAP</acronym> is used to
		refer to that method.</p></div><p xml:lang="en" lang="en">Protected EAP (<acronym class="acronym">PEAP</acronym>) is designed
	      as an alternative to <acronym class="acronym">EAP-TTLS</acronym> and
	      is the most used <acronym class="acronym">EAP</acronym> standard after
	      <acronym class="acronym">EAP-TLS</acronym>.  In a network with mixed
	      operating systems, <acronym class="acronym">PEAP</acronym> should be
	      the most supported standard after
	      <acronym class="acronym">EAP-TLS</acronym>.</p><p xml:lang="en" lang="en"><acronym class="acronym">PEAP</acronym> is similar to
	      <acronym class="acronym">EAP-TTLS</acronym> as it uses a server-side
	      certificate to authenticate clients by creating an
	      encrypted <acronym class="acronym">TLS</acronym> tunnel between the
	      client and the authentication server, which protects
	      the ensuing exchange of authentication information.
	      <acronym class="acronym">PEAP</acronym> authentication differs from
	      <acronym class="acronym">EAP-TTLS</acronym> as it broadcasts the
	      username in the clear and only the password is sent
	      in the encrypted <acronym class="acronym">TLS</acronym> tunnel.
	      <acronym class="acronym">EAP-TTLS</acronym> will use the
	      <acronym class="acronym">TLS</acronym> tunnel for both the username
	      and password.</p><p xml:lang="en" lang="en">Add the following lines to
	      <code class="filename">/etc/wpa_supplicant.conf</code> to
	      configure the <acronym class="acronym">EAP-PEAP</acronym> related
	      settings:</p><pre xml:lang="en" class="programlisting" lang="en">network={
  ssid="freebsdap"
  proto=RSN
  key_mgmt=WPA-EAP
  eap=PEAP <a id="co-peap-eap"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
  identity="test" <a id="co-peap-id"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
  password="test" <a id="co-peap-passwd"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
  ca_cert="/etc/certs/cacert.pem" <a id="co-peap-cacert"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
  phase1="peaplabel=0" <a id="co-peap-pha1"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
  phase2="auth=MSCHAPV2" <a id="co-peap-pha2"></a><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span>
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-peap-eap"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">This field specifies the <acronym class="acronym">EAP</acronym>
		  method for the connection.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-peap-id"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The <code class="literal">identity</code> field contains
		  the identity string for <acronym class="acronym">EAP</acronym>
		  authentication inside the encrypted
		  <acronym class="acronym">TLS</acronym> tunnel.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-peap-passwd"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The <code class="literal">password</code> field contains
		  the passphrase for the <acronym class="acronym">EAP</acronym>
		  authentication.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-peap-cacert"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The <code class="literal">ca_cert</code> field indicates
		  the pathname of the <acronym class="acronym">CA</acronym>
		  certificate file.  This file is needed to verify
		  the server certificate.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-peap-pha1"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">This field contains the parameters for the
		  first phase of authentication, the
		  <acronym class="acronym">TLS</acronym> tunnel.  According to the
		  authentication server used, specify a specific
		  label for authentication.  Most of the time, the
		  label will be <span class="quote">“<span class="quote">client <acronym class="acronym">EAP</acronym>
		    encryption</span>”</span> which is set by using
		  <code class="literal">peaplabel=0</code>.  More information
		  can be found in  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant.conf</span>(5)</span></a>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-peap-pha2"><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">This field specifies the authentication
		  protocol used in the encrypted
		  <acronym class="acronym">TLS</acronym> tunnel.  In the
		  case of <acronym class="acronym">PEAP</acronym>, it is
		  <code class="literal">auth=MSCHAPV2</code>.</p></td></tr></table></div><p xml:lang="en" lang="en">Add the following to
	      <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">wlans_ath0="wlan0"
ifconfig_wlan0="WPA DHCP"</pre><p xml:lang="en" lang="en">Then, bring up the interface:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service netif start</code></strong>
Starting wpa_supplicant.
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 7
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 15
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 21
DHCPACK from 192.168.0.20
bound to 192.168.0.254 -- renewal in 300 seconds.
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet DS/11Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</pre></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-wep"></a>31.3.4.1.4. <acronym class="acronym">WEP</acronym></h5></div></div></div><p xml:lang="en" lang="en">Wired Equivalent Privacy (<acronym class="acronym">WEP</acronym>) is
	    part of the original 802.11 standard.  There is no
	    authentication mechanism, only a weak form of access
	    control which is easily cracked.</p><p xml:lang="en" lang="en"><acronym class="acronym">WEP</acronym> can be set up using
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.1.100</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> \
	    ssid <em class="replaceable"><code>my_net</code></em> wepmode on weptxkey <em class="replaceable"><code>3</code></em> wepkey <em class="replaceable"><code>3:0x3456789012</code></em></code></strong></pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">The <code class="literal">weptxkey</code> specifies which
		<acronym class="acronym">WEP</acronym> key will be used in the
		transmission.  This example uses the third key.
		This must match the setting on the access point.
		When unsure which key is used by the access point,
		try <code class="literal">1</code> (the first key) for this
		value.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <code class="literal">wepkey</code> selects one of the
		<acronym class="acronym">WEP</acronym> keys.  It should be in the
		format <em class="replaceable"><code>index:key</code></em>.  Key
		<code class="literal">1</code> is used by default; the index
		only needs to be set when using a key other than the
		first key.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Replace the <code class="literal">0x3456789012</code>
		  with the key configured for use on the access
		  point.</p></div></li></ul></div><p xml:lang="en" lang="en">Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> for further
	    information.</p><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a> facility can be used to
	    configure a wireless interface with
	    <acronym class="acronym">WEP</acronym>.  The example above can be set up
	    by adding the following lines to
	    <code class="filename">/etc/wpa_supplicant.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">network={
  ssid="my_net"
  key_mgmt=NONE
  wep_key3=3456789012
  wep_tx_keyidx=3
}</pre><p xml:lang="en" lang="en">Then:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>wpa_supplicant -i <em class="replaceable"><code>wlan0</code></em> -c /etc/wpa_supplicant.conf</code></strong>
Trying to associate with 00:13:46:49:41:76 (SSID='dlinkap' freq=2437 MHz)
Associated with 00:13:46:49:41:76</pre></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87783736"></a>31.3.5. 對等式 (Ad-hoc)</h3></div></div></div><p xml:lang="en" lang="en"><acronym class="acronym">IBSS</acronym> mode, also called ad-hoc mode, is
	designed for point to point connections.  For example, to
	establish an ad-hoc network between the machines
	<code class="systemitem">A</code> and <code class="systemitem">B</code>,
	choose two <acronym class="acronym">IP</acronym> addresses and a
	<acronym class="acronym">SSID</acronym>.</p><p xml:lang="en" lang="en">On <code class="systemitem">A</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em> wlanmode adhoc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.0.1</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> ssid <em class="replaceable"><code>freebsdap</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:c3:0d:ac
	  inet 192.168.0.1 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;adhoc&gt;
	  status: running
	  ssid freebsdap channel 2 (2417 Mhz 11g) bssid 02:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 scanvalid 60
	  protmode CTS wme burst</pre><p xml:lang="en" lang="en">The <code class="literal">adhoc</code> parameter indicates that the
	interface is running in <acronym class="acronym">IBSS</acronym> mode.</p><p xml:lang="en" lang="en"><code class="systemitem">B</code> should now be able to detect
	<code class="systemitem">A</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em> wlanmode adhoc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> up scan</code></strong>
  SSID/MESH ID    BSSID              CHAN RATE   S:N     INT CAPS
  freebsdap       02:11:95:c3:0d:ac    2   54M -64:-96  100 IS   WME</pre><p xml:lang="en" lang="en">The <code class="literal">I</code> in the output confirms that
	<code class="systemitem">A</code> is in ad-hoc mode.  Now, configure
	<code class="systemitem">B</code> with a different
	<acronym class="acronym">IP</acronym> address:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.0.2</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> ssid <em class="replaceable"><code>freebsdap</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:d5:43:62
	  inet 192.168.0.2 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;adhoc&gt;
	  status: running
	  ssid freebsdap channel 2 (2417 Mhz 11g) bssid 02:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 scanvalid 60
	  protmode CTS wme burst</pre><p xml:lang="en" lang="en">Both <code class="systemitem">A</code> and
	<code class="systemitem">B</code> are now ready to exchange
	information.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-ap"></a>31.3.6. FreeBSD 主機存取點</h3></div></div></div><p xml:lang="en" lang="en">FreeBSD can act as an Access Point (<acronym class="acronym">AP</acronym>)
	which eliminates the need to buy a hardware
	<acronym class="acronym">AP</acronym> or run an ad-hoc network.  This can
	be particularly useful when a FreeBSD machine is acting as a
	gateway to another network such as the Internet.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-ap-basic"></a>31.3.6.1. 基礎設定</h4></div></div></div><p xml:lang="en" lang="en">Before configuring a FreeBSD machine as an
	  <acronym class="acronym">AP</acronym>, the kernel must be configured with
	  the appropriate networking support for the wireless card
	  as well as the security protocols being used.  For more
	  details, see <a class="xref" href="#network-wireless-basic" title="31.3.3. 基礎設定">節 31.3.3, “基礎設定”</a>.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The <acronym class="acronym">NDIS</acronym> driver wrapper for
	    <span class="trademark">Windows</span>® drivers does not currently support
	    <acronym class="acronym">AP</acronym> operation.  Only native FreeBSD
	    wireless drivers support <acronym class="acronym">AP</acronym>
	    mode.</p></div><p xml:lang="en" lang="en">Once wireless networking support is loaded, check if
	  the wireless device supports the host-based access point
	  mode, also known as hostap mode:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> list caps</code></strong>
drivercaps=6f85edc1&lt;STA,FF,TURBOP,IBSS,HOSTAP,AHDEMO,TXPMGT,SHSLOT,SHPREAMBLE,MONITOR,MBSS,WPA1,WPA2,BURST,WME,WDS,BGSCAN,TXFRAG&gt;
cryptocaps=1f&lt;WEP,TKIP,AES,AES_CCM,TKIPMIC&gt;</pre><p xml:lang="en" lang="en">This output displays the card's capabilities.  The
	  <code class="literal">HOSTAP</code> word confirms that this wireless
	  card can act as an <acronym class="acronym">AP</acronym>.  Various supported
	  ciphers are also listed: <acronym class="acronym">WEP</acronym>,
	  <acronym class="acronym">TKIP</acronym>, and <acronym class="acronym">AES</acronym>.  This
	  information indicates which security protocols can be used
	  on the <acronym class="acronym">AP</acronym>.</p><p xml:lang="en" lang="en">The wireless device can only be put into hostap mode
	  during the creation of the network pseudo-device, so a
	  previously created device must be destroyed first:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> destroy</code></strong></pre><p xml:lang="en" lang="en">then regenerated with the correct option before setting
	  the other parameters:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em> wlanmode hostap</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.0.1</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> ssid <em class="replaceable"><code>freebsdap</code></em> mode 11g channel 1</code></strong></pre><p xml:lang="en" lang="en">Use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> again to see the status of the
	  <code class="filename">wlan0</code> interface:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:c3:0d:ac
	  inet 192.168.0.1 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;hostap&gt;
	  status: running
	  ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 scanvalid 60
	  protmode CTS wme burst dtimperiod 1 -dfs</pre><p xml:lang="en" lang="en">The <code class="literal">hostap</code> parameter indicates the
	  interface is running in the host-based access point
	  mode.</p><p xml:lang="en" lang="en">The interface configuration can be done automatically at
	  boot time by adding the following lines to
	  <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">wlans_ath0="wlan0"
create_args_wlan0="wlanmode hostap"
ifconfig_wlan0="inet <em class="replaceable"><code>192.168.0.1</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> ssid <em class="replaceable"><code>freebsdap</code></em> mode 11g channel <em class="replaceable"><code>1</code></em>"</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87848120"></a>31.3.6.2. 無認證或加密的 Host-based 存取點</h4></div></div></div><p xml:lang="en" lang="en">Although it is not recommended to run an
	  <acronym class="acronym">AP</acronym> without any authentication or
	  encryption, this is a simple way to check if the
	  <acronym class="acronym">AP</acronym> is working.  This configuration is
	  also important for debugging client issues.</p><p xml:lang="en" lang="en">Once the <acronym class="acronym">AP</acronym> is configured, initiate
	  a scan from another wireless machine to find the
	  <acronym class="acronym">AP</acronym>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> up scan</code></strong>
SSID/MESH ID    BSSID              CHAN RATE   S:N     INT CAPS
freebsdap       00:11:95:c3:0d:ac    1   54M -66:-96  100 ES   WME</pre><p xml:lang="en" lang="en">The client machine found the <acronym class="acronym">AP</acronym> and
	  can be associated with it:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.0.2</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> ssid <em class="replaceable"><code>freebsdap</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:d5:43:62
	  inet 192.168.0.2 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet OFDM/54Mbps mode 11g
	  status: associated
	  ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 bmiss 7
	  scanvalid 60 bgscan bgscanintvl 300 bgscanidle 250 roam:rssi 7
	  roam:rate 5 protmode CTS wme burst</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-ap-wpa"></a>31.3.6.3. <acronym class="acronym">WPA2</acronym> Host-based 存取點</h4></div></div></div><p xml:lang="en" lang="en">This section focuses on setting up a FreeBSD
	  access point using the <acronym class="acronym">WPA2</acronym>
	  security protocol.  More details regarding
	  <acronym class="acronym">WPA</acronym> and the configuration of
	  <acronym class="acronym">WPA</acronym>-based wireless clients can be found
	  in <a class="xref" href="#network-wireless-wpa" title="31.3.4.1.3. WPA">節 31.3.4.1.3, “<acronym class="acronym">WPA</acronym>”</a>.</p><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd</span>(8)</span></a> daemon is used to deal with client
	  authentication and key management on the
	  <acronym class="acronym">WPA2</acronym>-enabled
	  <acronym class="acronym">AP</acronym>.</p><p xml:lang="en" lang="en">The following configuration operations are performed
	  on the FreeBSD machine acting as the <acronym class="acronym">AP</acronym>.
	  Once the <acronym class="acronym">AP</acronym> is correctly working,
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd</span>(8)</span></a> can be automatically started at boot
	  with this line in
	  <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">hostapd_enable="YES"</pre><p xml:lang="en" lang="en">Before trying to configure <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd</span>(8)</span></a>, first
	  configure the basic settings introduced in <a class="xref" href="#network-wireless-ap-basic" title="31.3.6.1. 基礎設定">節 31.3.6.1, “基礎設定”</a>.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87893176"></a>31.3.6.3.1. <acronym class="acronym">WPA2-PSK</acronym></h5></div></div></div><p xml:lang="en" lang="en"><acronym class="acronym">WPA2-PSK</acronym> is intended for small
	    networks where the use of a backend authentication server
	    is not possible or desired.</p><p xml:lang="en" lang="en">The configuration is done in
	    <code class="filename">/etc/hostapd.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">interface=wlan0                  <a id="co-ap-wpapsk-iface"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
debug=1                          <a id="co-ap-wpapsk-dbug"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
ctrl_interface=/var/run/hostapd  <a id="co-ap-wpapsk-ciface"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
ctrl_interface_group=wheel       <a id="co-ap-wpapsk-cifacegrp"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
ssid=freebsdap                   <a id="co-ap-wpapsk-ssid"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
wpa=2                            <a id="co-ap-wpapsk-wpa"></a><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span>
wpa_passphrase=freebsdmall       <a id="co-ap-wpapsk-pass"></a><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span>
wpa_key_mgmt=WPA-PSK             <a id="co-ap-wpapsk-kmgmt"></a><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span>
wpa_pairwise=CCMP                <a id="co-ap-wpapsk-pwise"></a><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-iface"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">Wireless interface used
		for the access point.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-dbug"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">Level of verbosity used during the
		execution of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd</span>(8)</span></a>.  A value of
		<code class="literal">1</code> represents the minimal
		level.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-ciface"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">Pathname of the directory used by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd</span>(8)</span></a>
		to store domain socket files for communication
		with external programs such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd_cli&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd_cli</span>(8)</span></a>.
		The default value is used in this example.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-cifacegrp"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The group allowed to access the control
		interface files.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-ssid"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The wireless network name, or
		<acronym class="acronym">SSID</acronym>, that will appear in wireless
		scans.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-wpa"><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">Enable
		<acronym class="acronym">WPA</acronym> and specify which
		<acronym class="acronym">WPA</acronym> authentication protocol will
		be required.  A value of <code class="literal">2</code>
		configures the <acronym class="acronym">AP</acronym> for
		<acronym class="acronym">WPA2</acronym> and is recommended.
		Set to <code class="literal">1</code> only if the obsolete
		<acronym class="acronym">WPA</acronym> is required.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-pass"><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">ASCII passphrase for
		<acronym class="acronym">WPA</acronym> authentication.</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Always use strong passwords that are at least
		  8 characters long and made from a rich alphabet so
		  that they will not be easily guessed or
		  attacked.</p></div></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-kmgmt"><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The
		key management protocol to use.  This example
		sets <acronym class="acronym">WPA-PSK</acronym>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-pwise"><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span></a> </p></td><td valign="top" align="left"><p xml:lang="en" lang="en">Encryption algorithms accepted by
		the access point.  In this example, only
		the
		<acronym class="acronym">CCMP</acronym> (<acronym class="acronym">AES</acronym>)
		cipher is accepted.  <acronym class="acronym">CCMP</acronym>
		is an alternative to <acronym class="acronym">TKIP</acronym>
		and is strongly preferred when possible.
		<acronym class="acronym">TKIP</acronym> should be allowed only when
		there are stations incapable of using
		<acronym class="acronym">CCMP</acronym>.</p></td></tr></table></div><p xml:lang="en" lang="en">The next step is to start <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd</span>(8)</span></a>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service hostapd forcestart</code></strong></pre><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
wlan0: flags=8943&lt;UP,BROADCAST,RUNNING,PROMISC,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	ether 04:f0:21:16:8e:10
	inet6 fe80::6f0:21ff:fe16:8e10%wlan0 prefixlen 64 scopeid 0x9
	nd6 options=21&lt;PERFORMNUD,AUTO_LINKLOCAL&gt;
	media: IEEE 802.11 Wireless Ethernet autoselect mode 11na &lt;hostap&gt;
	status: running
	ssid No5ignal channel 36 (5180 MHz 11a ht/40+) bssid 04:f0:21:16:8e:10
	country US ecm authmode WPA2/802.11i privacy MIXED deftxkey 2
	AES-CCM 2:128-bit AES-CCM 3:128-bit txpower 17 mcastrate 6 mgmtrate 6
	scanvalid 60 ampdulimit 64k ampdudensity 8 shortgi wme burst
	dtimperiod 1 -dfs
	groups: wlan</pre><p xml:lang="en" lang="en">Once the <acronym class="acronym">AP</acronym> is running, the
	    clients can associate with it.  See <a class="xref" href="#network-wireless-wpa" title="31.3.4.1.3. WPA">節 31.3.4.1.3, “<acronym class="acronym">WPA</acronym>”</a> for more details.  It
	    is possible to see the stations associated with the
	    <acronym class="acronym">AP</acronym> using <code class="command">ifconfig
	      <em class="replaceable"><code>wlan0</code></em> list
	      sta</code>.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87945912"></a>31.3.6.4. <acronym class="acronym">WEP</acronym> Host-based 存取點</h4></div></div></div><p xml:lang="en" lang="en">It is not recommended to use <acronym class="acronym">WEP</acronym> for
	  setting up an <acronym class="acronym">AP</acronym> since there is no
	  authentication mechanism and the encryption is easily
	  cracked.  Some legacy wireless cards only support
	  <acronym class="acronym">WEP</acronym> and these cards will only support
	  an <acronym class="acronym">AP</acronym> without authentication or
	  encryption.</p><p xml:lang="en" lang="en">The wireless device can now be put into hostap mode and
	  configured with the correct <acronym class="acronym">SSID</acronym> and
	  <acronym class="acronym">IP</acronym> address:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em> wlanmode hostap</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.0.1</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> \
	ssid <em class="replaceable"><code>freebsdap</code></em> wepmode on weptxkey <em class="replaceable"><code>3</code></em> wepkey <em class="replaceable"><code>3:0x3456789012</code></em> mode 11g</code></strong></pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">The <code class="literal">weptxkey</code> indicates which
	      <acronym class="acronym">WEP</acronym> key will be used in the
	      transmission.  This example uses the third key as key
	      numbering starts with <code class="literal">1</code>.  This
	      parameter must be specified in order to encrypt the
	      data.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <code class="literal">wepkey</code> sets the selected
	      <acronym class="acronym">WEP</acronym> key.  It should be in the format
	      <em class="replaceable"><code>index:key</code></em>.  If the index is
	      not given, key <code class="literal">1</code> is set.  The index
	      needs to be set when using keys other than the first
	      key.</p></li></ul></div><p xml:lang="en" lang="en">Use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> to see the status of the
	  <code class="filename">wlan0</code> interface:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:c3:0d:ac
	  inet 192.168.0.1 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;hostap&gt;
	  status: running
	  ssid freebsdap channel 4 (2427 Mhz 11g) bssid 00:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy ON deftxkey 3 wepkey 3:40-bit
	  txpower 21.5 scanvalid 60 protmode CTS wme burst dtimperiod 1 -dfs</pre><p xml:lang="en" lang="en">From another wireless machine, it is now possible to
	  initiate a scan to find the <acronym class="acronym">AP</acronym>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> up scan</code></strong>
SSID            BSSID              CHAN RATE  S:N   INT CAPS
freebsdap       00:11:95:c3:0d:ac    1   54M 22:1   100 EPS</pre><p xml:lang="en" lang="en">In this example, the client machine found the
	  <acronym class="acronym">AP</acronym> and can associate with it using the
	  correct parameters.  See <a class="xref" href="#network-wireless-wep" title="31.3.4.1.4. WEP">節 31.3.4.1.4, “<acronym class="acronym">WEP</acronym>”</a> for more details.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87997240"></a>31.3.7. 同時使用有線及無線連線</h3></div></div></div><p xml:lang="en" lang="en">A wired connection provides better performance and
	reliability, while a wireless connection provides flexibility
	and mobility.  Laptop users typically want to roam seamlessly
	between the two types of connections.</p><p xml:lang="en" lang="en">On FreeBSD, it is possible to combine two or even more
	network interfaces together in a <span class="quote">“<span class="quote">failover</span>”</span>
	fashion.  This type of configuration uses the most preferred
	and available connection from a group of network interfaces,
	and the operating system switches automatically when the link
	state changes.</p><p xml:lang="en" lang="en">Link aggregation and failover is covered in <a class="xref" href="#network-aggregation" title="31.7. Link Aggregation 與容錯移轉">節 31.7, “Link Aggregation 與容錯移轉”</a> and an example for using
	both wired and wireless connections is provided at <a class="xref" href="#networking-lagg-wired-and-wireless" title="範例 31.3. 乙太網路與無線介面間的容錯移轉模式">範例 31.3, “乙太網路與無線介面間的容錯移轉模式”</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88000696"></a>31.3.8. 疑難排解</h3></div></div></div><p xml:lang="en" lang="en">This section describes
	a number of steps to help troubleshoot common wireless
	networking problems.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">If the access point is not listed when scanning,
	    check that the configuration has not limited the wireless
	    device to a limited set of channels.</p></li><li class="listitem"><p xml:lang="en" lang="en">If the device cannot associate with an access point,
	    verify that the configuration matches the settings on the
	    access point.  This includes the authentication scheme and
	    any security protocols.  Simplify the configuration as
	    much as possible.  If using a security protocol such as
	    <acronym class="acronym">WPA</acronym> or <acronym class="acronym">WEP</acronym>,
	    configure the access point for open authentication and
	    no security to see if traffic will pass.</p><p xml:lang="en" lang="en">Debugging support is provided by
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a>.  Try running this utility manually
	    with <code class="option">-dd</code> and look at the
	    system logs.</p></li><li class="listitem"><p xml:lang="en" lang="en">Once the system can associate with the access point,
	    diagnose the network configuration using tools like
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a>.</p></li><li class="listitem"><p xml:lang="en" lang="en">There are many lower-level debugging tools.
	    Debugging messages can be enabled in the 802.11 protocol
	    support layer using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlandebug&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlandebug</span>(8)</span></a>.
	    For example, to enable console messages related to
	    scanning for access points and the 802.11 protocol
	    handshakes required to arrange communication:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>wlandebug -i <em class="replaceable"><code>wlan0</code></em> +scan+auth+debug+assoc</code></strong>
  net.wlan.0.debug: 0 =&gt; 0xc80000&lt;assoc,auth,scan&gt;</pre><p xml:lang="en" lang="en">Many useful statistics are maintained by the 802.11
	    layer and <code class="command">wlanstats</code>, found in <code class="filename">/usr/src/tools/tools/net80211</code>,
	    will dump this information.  These statistics should
	    display all errors identified by the 802.11 layer.
	    However, some errors are identified in the device drivers
	    that lie below the 802.11 layer so they may not show up.
	    To diagnose device-specific problems, refer to the
	    drivers' documentation.</p></li></ul></div><p xml:lang="en" lang="en">If the above information does not help to clarify the
	problem, submit a problem report and include output from the
	above tools.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-usb-tethering"></a>31.4. USB 網路共享</h2></div></div></div><a id="idp88018744" class="indexterm"></a><p xml:lang="en" lang="en">Many cellphones provide the option to share their data
      connection over USB (often called "tethering").  This feature
      uses either the <acronym class="acronym">RNDIS</acronym>, <acronym class="acronym">CDC</acronym>
      or a custom <span class="trademark">Apple</span>® <span class="trademark">iPhone</span>®/<span class="trademark">iPad</span>®
      protocol.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><span class="trademark">Android</span>™ devices generally use the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=urndis&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">urndis</span>(4)</span></a>
	  driver.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="trademark">Apple</span>® devices use the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipheth&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipheth</span>(4)</span></a> driver.</p></li><li class="listitem"><p xml:lang="en" lang="en">Older devices will often use the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cdce&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cdce</span>(4)</span></a>
	  driver.</p></li></ul></div><p xml:lang="en" lang="en">Before attaching a device, load the appropriate driver
      into the kernel:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload if_urndis
<code class="prompt">#</code> kldload if_cdce
<code class="prompt">#</code> kldload if_ipheth</code></strong></pre><p xml:lang="en" lang="en">Once the device is attached
      <code class="literal">ue</code><em class="replaceable"><code>0</code></em> will be
      available for use like a normal network device.  Be sure that
      the <span class="quote">“<span class="quote">USB tethering</span>”</span> option is enabled on the
      device.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-bluetooth"></a>31.5. 藍牙</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Pav</span> <span class="surname">Lucistnik</span></span>. </span></div></div></div><a id="idp88040504" class="indexterm"></a><p xml:lang="en" lang="en">Bluetooth is a wireless technology for creating personal
      networks operating in the 2.4 GHz unlicensed band, with a
      range of 10 meters.  Networks are usually formed ad-hoc from
      portable devices such as cellular phones, handhelds, and
      laptops.  Unlike Wi-Fi wireless technology, Bluetooth offers
      higher level service profiles, such as
      <acronym class="acronym">FTP</acronym>-like file servers, file pushing, voice
      transport, serial line emulation, and more.</p><p xml:lang="en" lang="en">This section describes the use of a <acronym class="acronym">USB</acronym>
      Bluetooth dongle on a FreeBSD system.  It then describes the
      various Bluetooth protocols and utilities.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88042936"></a>31.5.1. 載入藍牙支援</h3></div></div></div><p xml:lang="en" lang="en">The Bluetooth stack in FreeBSD is implemented using the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=netgraph&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">netgraph</span>(4)</span></a> framework.  A broad variety of Bluetooth
	<acronym class="acronym">USB</acronym> dongles is supported by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ng_ubt&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ng_ubt</span>(4)</span></a>.
	Broadcom BCM2033 based Bluetooth devices are supported by the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ubtbcmfw&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ubtbcmfw</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ng_ubt&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ng_ubt</span>(4)</span></a> drivers.  The 3Com
	Bluetooth PC Card 3CRWB60-A is supported by the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ng_bt3c&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ng_bt3c</span>(4)</span></a> driver.  Serial and UART based Bluetooth
	devices are supported by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sio&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sio</span>(4)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ng_h4&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ng_h4</span>(4)</span></a>, and
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hcseriald&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hcseriald</span>(8)</span></a>.</p><p xml:lang="en" lang="en">Before attaching a device, determine which of the above
	drivers it uses, then load the driver.  For example, if the
	device uses the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ng_ubt&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ng_ubt</span>(4)</span></a> driver:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload ng_ubt</code></strong></pre><p xml:lang="en" lang="en">If the Bluetooth device will be attached to the system
	during system startup, the system can be configured to load
	the module at boot time by adding the driver to
	<code class="filename">/boot/loader.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">ng_ubt_load="YES"</pre><p xml:lang="en" lang="en">Once the driver is loaded, plug in the
	<acronym class="acronym">USB</acronym> dongle.  If the driver load was
	successful, output similar to the following should appear on
	the console and in
	<code class="filename">/var/log/messages</code>:</p><pre xml:lang="en" class="screen" lang="en">ubt0: vendor 0x0a12 product 0x0001, rev 1.10/5.25, addr 2
ubt0: Interface 0 endpoints: interrupt=0x81, bulk-in=0x82, bulk-out=0x2
ubt0: Interface 1 (alt.config 5) endpoints: isoc-in=0x83, isoc-out=0x3,
      wMaxPacketSize=49, nframes=6, buffer size=294</pre><p xml:lang="en" lang="en">To start and stop the Bluetooth stack, use its startup
	script.  It is a good idea to stop the stack before unplugging
	the device.  Starting the bluetooth stack might require
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hcsecd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hcsecd</span>(8)</span></a> to be started.  When starting the stack, the
	output should be similar to the following:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service bluetooth start ubt0</code></strong>
BD_ADDR: 00:02:72:00:d4:1a
Features: 0xff 0xff 0xf 00 00 00 00 00
&lt;3-Slot&gt; &lt;5-Slot&gt; &lt;Encryption&gt; &lt;Slot offset&gt;
&lt;Timing accuracy&gt; &lt;Switch&gt; &lt;Hold mode&gt; &lt;Sniff mode&gt;
&lt;Park mode&gt; &lt;RSSI&gt; &lt;Channel quality&gt; &lt;SCO link&gt;
&lt;HV2 packets&gt; &lt;HV3 packets&gt; &lt;u-law log&gt; &lt;A-law log&gt; &lt;CVSD&gt;
&lt;Paging scheme&gt; &lt;Power control&gt; &lt;Transparent SCO data&gt;
Max. ACL packet size: 192 bytes
Number of ACL packets: 8
Max. SCO packet size: 64 bytes
Number of SCO packets: 8</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88083384"></a>31.5.2. 尋找其他藍牙裝置</h3></div></div></div><a id="idp88084024" class="indexterm"></a><p xml:lang="en" lang="en">The Host Controller Interface (<acronym class="acronym">HCI</acronym>)
	provides a uniform method for accessing Bluetooth baseband
	capabilities.  In FreeBSD, a netgraph <acronym class="acronym">HCI</acronym> node
	is created for each Bluetooth device.  For more details, refer
	to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ng_hci&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ng_hci</span>(4)</span></a>.</p><p xml:lang="en" lang="en">One of the most common tasks is discovery of Bluetooth
	devices within <acronym class="acronym">RF</acronym> proximity.  This
	operation is called <span class="emphasis"><em>inquiry</em></span>.  Inquiry and
	other <acronym class="acronym">HCI</acronym> related operations are done using
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hccontrol&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hccontrol</span>(8)</span></a>.  The example below shows how to find out
	which Bluetooth devices are in range.  The list of devices
	should be displayed in a few seconds.  Note that a remote
	device will only answer the inquiry if it is set to
	<span class="emphasis"><em>discoverable</em></span> mode.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>hccontrol -n ubt0hci inquiry</code></strong>
Inquiry result, num_responses=1
Inquiry result #0
       BD_ADDR: 00:80:37:29:19:a4
       Page Scan Rep. Mode: 0x1
       Page Scan Period Mode: 00
       Page Scan Mode: 00
       Class: 52:02:04
       Clock offset: 0x78ef
Inquiry complete. Status: No error [00]</pre><p xml:lang="en" lang="en">The <code class="literal">BD_ADDR</code> is the unique address of a
	Bluetooth device, similar to the <acronym class="acronym">MAC</acronym>
	address of a network card.  This address is needed for further
	communication with a device and it is possible to assign a
	human readable name to a <code class="literal">BD_ADDR</code>.
	Information regarding the known Bluetooth hosts is contained
	in <code class="filename">/etc/bluetooth/hosts</code>.  The following
	example shows how to obtain the human readable name that was
	assigned to the remote device:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>hccontrol -n ubt0hci remote_name_request 00:80:37:29:19:a4</code></strong>
BD_ADDR: 00:80:37:29:19:a4
Name: Pav's T39</pre><p xml:lang="en" lang="en">If an inquiry is performed on a remote Bluetooth device,
	it will find the computer as
	<span class="quote">“<span class="quote">your.host.name (ubt0)</span>”</span>.  The name assigned to
	the local device can be changed at any time.</p><p xml:lang="en" lang="en">Remote devices can be assigned aliases in
	<code class="filename">/etc/bluetooth/hosts</code>.  More information
	about <code class="filename">/etc/bluetooth/hosts</code> file might be
	found in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bluetooth.hosts&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bluetooth.hosts</span>(5)</span></a>.</p><p xml:lang="en" lang="en">The Bluetooth system provides a point-to-point connection
	between two Bluetooth units, or a point-to-multipoint
	connection which is shared among several Bluetooth devices.
	The following example shows how to create a connection to a
	remote device:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>hccontrol -n ubt0hci create_connection <em class="replaceable"><code>BT_ADDR</code></em></code></strong></pre><p xml:lang="en" lang="en"><code class="literal">create_connection</code> accepts
	<code class="literal">BT_ADDR</code> as well as host aliases in
	<code class="filename">/etc/bluetooth/hosts</code>.</p><p xml:lang="en" lang="en">The following example shows how to obtain the list of
	active baseband connections for the local device:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>hccontrol -n ubt0hci read_connection_list</code></strong>
Remote BD_ADDR    Handle Type Mode Role Encrypt Pending Queue State
00:80:37:29:19:a4     41  ACL    0 MAST    NONE       0     0 OPEN</pre><p xml:lang="en" lang="en">A <span class="emphasis"><em>connection handle</em></span> is useful when
	termination of the baseband connection is required, though
	it is normally not required to do this by hand.  The stack
	will automatically terminate inactive baseband
	connections.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>hccontrol -n ubt0hci disconnect 41</code></strong>
Connection handle: 41
Reason: Connection terminated by local host [0x16]</pre><p xml:lang="en" lang="en">Type <code class="command">hccontrol help</code> for a complete
	listing of available <acronym class="acronym">HCI</acronym> commands.  Most
	of the <acronym class="acronym">HCI</acronym> commands do not require
	superuser privileges.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88114104"></a>31.5.3. 裝置配對</h3></div></div></div><p xml:lang="en" lang="en">By default, Bluetooth communication is not authenticated,
	and any device can talk to any other device.  A Bluetooth
	device, such as a cellular phone, may choose to require
	authentication to provide a particular service.  Bluetooth
	authentication is normally done with a
	<span class="emphasis"><em><acronym class="acronym">PIN</acronym> code</em></span>, an ASCII
	string up to 16 characters in length.  The user is required
	to enter the same <acronym class="acronym">PIN</acronym> code on both devices.
	Once the user has entered the <acronym class="acronym">PIN</acronym> code,
	both devices will generate a <span class="emphasis"><em>link key</em></span>.
	After that, the link key can be stored either in the devices
	or in a persistent storage.  Next time, both devices will
	use the previously generated link key.  This procedure is
	called <span class="emphasis"><em>pairing</em></span>.  Note that if the link
	key is lost by either device, the pairing must be
	repeated.</p><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hcsecd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hcsecd</span>(8)</span></a> daemon is responsible for handling
	Bluetooth authentication requests.  The default configuration
	file is <code class="filename">/etc/bluetooth/hcsecd.conf</code>.  An
	example section for a cellular phone with the
	<acronym class="acronym">PIN</acronym> code set to <code class="literal">1234</code> is
	shown below:</p><pre xml:lang="en" class="programlisting" lang="en">device {
        bdaddr  00:80:37:29:19:a4;
        name    "Pav's T39";
        key     nokey;
        pin     "1234";
      }</pre><p xml:lang="en" lang="en">The only limitation on <acronym class="acronym">PIN</acronym> codes is
	length.  Some devices, such as Bluetooth headsets, may have
	a fixed <acronym class="acronym">PIN</acronym> code built in.  The
	<code class="option">-d</code> switch forces <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hcsecd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hcsecd</span>(8)</span></a> to stay in
	the foreground, so it is easy to see what is happening.  Set
	the remote device to receive pairing and initiate the
	Bluetooth connection to the remote device.  The remote device
	should indicate that pairing was accepted and request the
	<acronym class="acronym">PIN</acronym> code.  Enter the same
	<acronym class="acronym">PIN</acronym> code listed in
	<code class="filename">hcsecd.conf</code>.  Now the computer and the
	remote device are paired.  Alternatively, pairing can be
	initiated on the remote device.</p><p xml:lang="en" lang="en">The following line can be added to
	<code class="filename">/etc/rc.conf</code> to configure <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hcsecd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hcsecd</span>(8)</span></a>
	to start automatically on system start:</p><pre xml:lang="en" class="programlisting" lang="en">hcsecd_enable="YES"</pre><p xml:lang="en" lang="en">The following is a sample of the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hcsecd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hcsecd</span>(8)</span></a> daemon
	output:</p><pre xml:lang="en" class="programlisting" lang="en">hcsecd[16484]: Got Link_Key_Request event from 'ubt0hci', remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Found matching entry, remote bdaddr 0:80:37:29:19:a4, name 'Pav's T39', link key doesn't exist
hcsecd[16484]: Sending Link_Key_Negative_Reply to 'ubt0hci' for remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Got PIN_Code_Request event from 'ubt0hci', remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Found matching entry, remote bdaddr 0:80:37:29:19:a4, name 'Pav's T39', PIN code exists
hcsecd[16484]: Sending PIN_Code_Reply to 'ubt0hci' for remote bdaddr 0:80:37:29:19:a4</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88148792"></a>31.5.4. 使用 <acronym class="acronym">PPP</acronym> Profile 存取網路</h3></div></div></div><p xml:lang="en" lang="en">A Dial-Up Networking (<acronym class="acronym">DUN</acronym>) profile can
	be used to configure a cellular phone as a wireless modem for
	connecting to a dial-up Internet access server.  It can also
	be used to configure a computer to receive data calls from a
	cellular phone.</p><p xml:lang="en" lang="en">Network access with a <acronym class="acronym">PPP</acronym> profile can
	be used to provide <acronym class="acronym">LAN</acronym> access for a single
	Bluetooth device or multiple Bluetooth devices.  It can also
	provide <acronym class="acronym">PC</acronym> to <acronym class="acronym">PC</acronym>
	connection using <acronym class="acronym">PPP</acronym> networking over serial
	cable emulation.</p><p xml:lang="en" lang="en">In FreeBSD, these profiles are implemented with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>
	and the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a> wrapper which converts a
	Bluetooth connection into something
	<acronym class="acronym">PPP</acronym> can use.  Before a profile can be used,
	a new <acronym class="acronym">PPP</acronym> label must be created in
	<code class="filename">/etc/ppp/ppp.conf</code>.  Consult
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a> for examples.</p><p xml:lang="en" lang="en">In this example, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a> is used to open a
	connection to a remote device with a
	<code class="literal">BD_ADDR</code> of
	<code class="literal">00:80:37:29:19:a4</code> on a
	<acronym class="acronym">DUN</acronym> <acronym class="acronym">RFCOMM</acronym>
	channel:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>rfcomm_pppd -a 00:80:37:29:19:a4 -c -C dun -l rfcomm-dialup</code></strong></pre><p xml:lang="en" lang="en">The actual channel number will be obtained from the remote
	device using the <acronym class="acronym">SDP</acronym> protocol.  It is
	possible to specify the <acronym class="acronym">RFCOMM</acronym> channel by
	hand, and in this case <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a> will not perform
	the <acronym class="acronym">SDP</acronym> query.  Use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sdpcontrol&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sdpcontrol</span>(8)</span></a> to
	find out the <acronym class="acronym">RFCOMM</acronym> channel on the remote
	device.</p><p xml:lang="en" lang="en">In order to provide network access with the
	<acronym class="acronym">PPP</acronym> <acronym class="acronym">LAN</acronym> service,
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sdpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sdpd</span>(8)</span></a> must be running and a new entry for
	<acronym class="acronym">LAN</acronym> clients must be created in
	<code class="filename">/etc/ppp/ppp.conf</code>.  Consult
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a> for examples.  Finally, start the
	<acronym class="acronym">RFCOMM</acronym> <acronym class="acronym">PPP</acronym> server on a
	valid <acronym class="acronym">RFCOMM</acronym> channel number.  The
	<acronym class="acronym">RFCOMM</acronym> <acronym class="acronym">PPP</acronym> server will
	automatically register the Bluetooth <acronym class="acronym">LAN</acronym>
	service with the local <acronym class="acronym">SDP</acronym> daemon.  The
	example below shows how to start the <acronym class="acronym">RFCOMM</acronym>
	<acronym class="acronym">PPP</acronym> server.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>rfcomm_pppd -s -C 7 -l rfcomm-server</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88180920"></a>31.5.5. 藍牙通訊協定</h3></div></div></div><p xml:lang="en" lang="en">This section provides an overview of the various Bluetooth
	protocols, their function, and associated utilities.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88182200"></a>31.5.5.1. Logical Link Control and Adaptation Protocol
	  (<acronym class="acronym">L2CAP</acronym>)</h4></div></div></div><a id="idp88183352" class="indexterm"></a><p xml:lang="en" lang="en">The Logical Link Control and Adaptation Protocol
	  (<acronym class="acronym">L2CAP</acronym>) provides connection-oriented and
	  connectionless data services to upper layer protocols.
	  <acronym class="acronym">L2CAP</acronym> permits higher level protocols and
	  applications to transmit and receive
	  <acronym class="acronym">L2CAP</acronym> data packets up to 64 kilobytes in
	  length.</p><p xml:lang="en" lang="en"><acronym class="acronym">L2CAP</acronym> is based around the concept of
	  <span class="emphasis"><em>channels</em></span>.  A channel is a logical
	  connection on top of a baseband connection, where each
	  channel is bound to a single protocol in a many-to-one
	  fashion.  Multiple channels can be bound to the same
	  protocol, but a channel cannot be bound to multiple
	  protocols.  Each <acronym class="acronym">L2CAP</acronym> packet received on
	  a channel is directed to the appropriate higher level
	  protocol.  Multiple channels can share the same baseband
	  connection.</p><p xml:lang="en" lang="en">In FreeBSD, a netgraph <acronym class="acronym">L2CAP</acronym> node is
	  created for each Bluetooth device.  This node is normally
	  connected to the downstream Bluetooth <acronym class="acronym">HCI</acronym>
	  node and upstream Bluetooth socket nodes.  The default name
	  for the <acronym class="acronym">L2CAP</acronym> node is
	  <span class="quote">“<span class="quote">devicel2cap</span>”</span>.  For more details refer to
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ng_l2cap&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ng_l2cap</span>(4)</span></a>.</p><p xml:lang="en" lang="en">A useful command is <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=l2ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">l2ping</span>(8)</span></a>, which can be used to
	  ping other devices.  Some Bluetooth implementations might
	  not return all of the data sent to them, so <code class="literal">0
	    bytes</code> in the following example is normal.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>l2ping -a 00:80:37:29:19:a4</code></strong>
0 bytes from 0:80:37:29:19:a4 seq_no=0 time=48.633 ms result=0
0 bytes from 0:80:37:29:19:a4 seq_no=1 time=37.551 ms result=0
0 bytes from 0:80:37:29:19:a4 seq_no=2 time=28.324 ms result=0
0 bytes from 0:80:37:29:19:a4 seq_no=3 time=46.150 ms result=0</pre><p xml:lang="en" lang="en">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=l2control&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">l2control</span>(8)</span></a> utility is used to perform various
	  operations on <acronym class="acronym">L2CAP</acronym> nodes.  This example
	  shows how to obtain the list of logical connections
	  (channels) and the list of baseband connections for the
	  local device:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>l2control -a 00:02:72:00:d4:1a read_channel_list</code></strong>
L2CAP channels:
Remote BD_ADDR     SCID/ DCID   PSM  IMTU/ OMTU State
00:07:e0:00:0b:ca    66/   64     3   132/  672 OPEN
<code class="prompt">%</code> <strong class="userinput"><code>l2control -a 00:02:72:00:d4:1a read_connection_list</code></strong>
L2CAP connections:
Remote BD_ADDR    Handle Flags Pending State
00:07:e0:00:0b:ca     41 O           0 OPEN</pre><p xml:lang="en" lang="en">Another diagnostic tool is <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=btsockstat&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">btsockstat</span>(1)</span></a>.  It is
	  similar to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=netstat&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">netstat</span>(1)</span></a>, but for Bluetooth
	  network-related data structures.  The example below shows
	  the same logical connection as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=l2control&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">l2control</span>(8)</span></a>
	  above.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>btsockstat</code></strong>
Active L2CAP sockets
PCB      Recv-Q Send-Q Local address/PSM       Foreign address   CID   State
c2afe900      0      0 00:02:72:00:d4:1a/3     00:07:e0:00:0b:ca 66    OPEN
Active RFCOMM sessions
L2PCB    PCB      Flag MTU   Out-Q DLCs State
c2afe900 c2b53380 1    127   0     Yes  OPEN
Active RFCOMM sockets
PCB      Recv-Q Send-Q Local address     Foreign address   Chan DLCI State
c2e8bc80      0    250 00:02:72:00:d4:1a 00:07:e0:00:0b:ca 3    6    OPEN</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88217400"></a>31.5.5.2. Radio Frequency Communication
	  (<acronym class="acronym">RFCOMM</acronym>)</h4></div></div></div><p xml:lang="en" lang="en">The <acronym class="acronym">RFCOMM</acronym> protocol provides
	  emulation of serial ports over the <acronym class="acronym">L2CAP</acronym>
	  protocol.  <acronym class="acronym">RFCOMM</acronym> is a simple transport
	  protocol, with additional provisions for emulating the 9
	  circuits of RS-232 (EIATIA-232-E) serial ports.  It
	  supports up to 60 simultaneous connections
	  (<acronym class="acronym">RFCOMM</acronym> channels) between two Bluetooth
	  devices.</p><p xml:lang="en" lang="en">For the purposes of <acronym class="acronym">RFCOMM</acronym>, a
	  complete communication path involves two applications
	  running on the communication endpoints with a communication
	  segment between them.  <acronym class="acronym">RFCOMM</acronym> is intended
	  to cover applications that make use of the serial ports of
	  the devices in which they reside.  The communication segment
	  is a direct connect Bluetooth link from one device to
	  another.</p><p xml:lang="en" lang="en"><acronym class="acronym">RFCOMM</acronym> is only concerned with the
	  connection between the devices in the direct connect case,
	  or between the device and a modem in the network case.
	  <acronym class="acronym">RFCOMM</acronym> can support other configurations,
	  such as modules that communicate via Bluetooth wireless
	  technology on one side and provide a wired interface on the
	  other side.</p><p xml:lang="en" lang="en">In FreeBSD, <acronym class="acronym">RFCOMM</acronym> is implemented at the
	  Bluetooth sockets layer.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88236344"></a>31.5.5.3. Service Discovery Protocol
	  (<acronym class="acronym">SDP</acronym>)</h4></div></div></div><a id="idp88237496" class="indexterm"></a><p xml:lang="en" lang="en">The Service Discovery Protocol (<acronym class="acronym">SDP</acronym>)
	  provides the means for client applications to discover the
	  existence of services provided by server applications as
	  well as the attributes of those services.  The attributes of
	  a service include the type or class of service offered and
	  the mechanism or protocol information needed to utilize the
	  service.</p><p xml:lang="en" lang="en"><acronym class="acronym">SDP</acronym> involves communication between a
	  <acronym class="acronym">SDP</acronym> server and a <acronym class="acronym">SDP</acronym>
	  client.  The server maintains a list of service records that
	  describe the characteristics of services associated with the
	  server.  Each service record contains information about a
	  single service.  A client may retrieve information from a
	  service record maintained by the <acronym class="acronym">SDP</acronym>
	  server by issuing a <acronym class="acronym">SDP</acronym> request.  If the
	  client, or an application associated with the client,
	  decides to use a service, it must open a separate connection
	  to the service provider in order to utilize the service.
	  <acronym class="acronym">SDP</acronym> provides a mechanism for discovering
	  services and their attributes, but it does not provide a
	  mechanism for utilizing those services.</p><p xml:lang="en" lang="en">Normally, a <acronym class="acronym">SDP</acronym> client searches for
	  services based on some desired characteristics of the
	  services.  However, there are times when it is desirable to
	  discover which types of services are described by an
	  <acronym class="acronym">SDP</acronym> server's service records without any
	  prior information about the services.  This process of
	  looking for any offered services is called
	  <span class="emphasis"><em>browsing</em></span>.</p><p xml:lang="en" lang="en">The Bluetooth <acronym class="acronym">SDP</acronym> server,
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sdpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sdpd</span>(8)</span></a>, and command line client, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sdpcontrol&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sdpcontrol</span>(8)</span></a>,
	  are included in the standard FreeBSD installation.  The
	  following example shows how to perform a
	  <acronym class="acronym">SDP</acronym> browse query.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>sdpcontrol -a 00:01:03:fc:6e:ec browse</code></strong>
Record Handle: 00000000
Service Class ID List:
        Service Discovery Server (0x1000)
Protocol Descriptor List:
        L2CAP (0x0100)
                Protocol specific parameter #1: u/int/uuid16 1
                Protocol specific parameter #2: u/int/uuid16 1

Record Handle: 0x00000001
Service Class ID List:
        Browse Group Descriptor (0x1001)

Record Handle: 0x00000002
Service Class ID List:
        LAN Access Using PPP (0x1102)
Protocol Descriptor List:
        L2CAP (0x0100)
        RFCOMM (0x0003)
                Protocol specific parameter #1: u/int8/bool 1
Bluetooth Profile Descriptor List:
        LAN Access Using PPP (0x1102) ver. 1.0</pre><p xml:lang="en" lang="en">Note that each service has a list of attributes, such
	  as the <acronym class="acronym">RFCOMM</acronym> channel.  Depending on the
	  service, the user might need to make note of some of the
	  attributes.  Some Bluetooth implementations do not support
	  service browsing and may return an empty list.  In this
	  case, it is possible to search for the specific service.
	  The example below shows how to search for the
	  <acronym class="acronym">OBEX</acronym> Object Push
	  (<acronym class="acronym">OPUSH</acronym>) service:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>sdpcontrol -a 00:01:03:fc:6e:ec search OPUSH</code></strong></pre><p xml:lang="en" lang="en">Offering services on FreeBSD to Bluetooth clients is done
	  with the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sdpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sdpd</span>(8)</span></a> server.  The following line can be
	  added to <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">sdpd_enable="YES"</pre><p xml:lang="en" lang="en">Then the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sdpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sdpd</span>(8)</span></a> daemon can be started with:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service sdpd start</code></strong></pre><p xml:lang="en" lang="en">The local server application that wants to provide a
	  Bluetooth service to remote clients will register the
	  service with the local <acronym class="acronym">SDP</acronym> daemon.  An
	  example of such an application is <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a>.  Once
	  started, it will register the Bluetooth LAN service with the
	  local <acronym class="acronym">SDP</acronym> daemon.</p><p xml:lang="en" lang="en">The list of services registered with the local
	  <acronym class="acronym">SDP</acronym> server can be obtained by issuing a
	  <acronym class="acronym">SDP</acronym> browse query via the local control
	  channel:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>sdpcontrol -l browse</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88296120"></a>31.5.5.4. <acronym class="acronym">OBEX</acronym> Object Push
	  (<acronym class="acronym">OPUSH</acronym>)</h4></div></div></div><a id="idp88297528" class="indexterm"></a><p xml:lang="en" lang="en">Object Exchange (<acronym class="acronym">OBEX</acronym>) is a widely
	  used protocol for simple file transfers between mobile
	  devices.  Its main use is in infrared communication, where
	  it is used for generic file transfers between notebooks or
	  <acronym class="acronym">PDA</acronym>s, and for sending business cards or
	  calendar entries between cellular phones and other devices
	  with Personal Information Manager (<acronym class="acronym">PIM</acronym>)
	  applications.</p><p xml:lang="en" lang="en">The <acronym class="acronym">OBEX</acronym> server and client are
	  implemented by <span class="application">obexapp</span>, which can
	  be installed using the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/comms/obexapp/pkg-descr">comms/obexapp</a>
	  package or port.</p><p xml:lang="en" lang="en">The <acronym class="acronym">OBEX</acronym> client is used to push
	  and/or pull objects from the <acronym class="acronym">OBEX</acronym> server.
	  An example object is a business card or an appointment.
	  The <acronym class="acronym">OBEX</acronym> client can obtain the
	  <acronym class="acronym">RFCOMM</acronym> channel number from the remote
	  device via <acronym class="acronym">SDP</acronym>.  This can be done by
	  specifying the service name instead of the
	  <acronym class="acronym">RFCOMM</acronym> channel number.  Supported service
	  names are: <code class="literal">IrMC</code>, <code class="literal">FTRN</code>,
	  and <code class="literal">OPUSH</code>.  It is also possible to
	  specify the <acronym class="acronym">RFCOMM</acronym> channel as a number.
	  Below is an example of an <acronym class="acronym">OBEX</acronym> session
	  where the device information object is pulled from the
	  cellular phone, and a new object, the business card, is
	  pushed into the phone's directory.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>obexapp -a 00:80:37:29:19:a4 -C IrMC</code></strong>
obex&gt; get telecom/devinfo.txt devinfo-t39.txt
Success, response: OK, Success (0x20)
obex&gt; put new.vcf
Success, response: OK, Success (0x20)
obex&gt; di
Success, response: OK, Success (0x20)</pre><p xml:lang="en" lang="en">In order to provide the <acronym class="acronym">OPUSH</acronym>
	  service, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sdpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sdpd</span>(8)</span></a> must be running and a root folder,
	  where all incoming objects will be stored, must be created.
	  The default path to the root folder is
	  <code class="filename">/var/spool/obex</code>.  Finally, start the
	  <acronym class="acronym">OBEX</acronym> server on a valid
	  <acronym class="acronym">RFCOMM</acronym> channel number.  The
	  <acronym class="acronym">OBEX</acronym> server will automatically register
	  the <acronym class="acronym">OPUSH</acronym> service with the local
	  <acronym class="acronym">SDP</acronym> daemon.  The example below shows how
	  to start the <acronym class="acronym">OBEX</acronym> server.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>obexapp -s -C 10</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88329528"></a>31.5.5.5. Serial Port Profile (<acronym class="acronym">SPP</acronym>)</h4></div></div></div><p xml:lang="en" lang="en">The Serial Port Profile (<acronym class="acronym">SPP</acronym>) allows
	  Bluetooth devices to perform serial cable emulation.  This
	  profile allows legacy applications to use Bluetooth as a
	  cable replacement, through a virtual serial port
	  abstraction.</p><p xml:lang="en" lang="en">In FreeBSD, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_sppd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rfcomm_sppd</span>(1)</span></a> implements
	  <acronym class="acronym">SPP</acronym> and a pseudo tty is used as a virtual
	  serial port abstraction.  The example below shows how to
	  connect to a remote device's serial port service.  A
	  <acronym class="acronym">RFCOMM</acronym> channel does not have to be
	  specified as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_sppd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rfcomm_sppd</span>(1)</span></a> can obtain it from the
	  remote device via <acronym class="acronym">SDP</acronym>.  To override this,
	  specify a <acronym class="acronym">RFCOMM</acronym> channel on the command
	  line.</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>rfcomm_sppd -a 00:07:E0:00:0B:CA -t</code></strong>
rfcomm_sppd[94692]: Starting on /dev/pts/6...
/dev/pts/6</pre><p xml:lang="en" lang="en">Once connected, the pseudo tty can be used as serial
	  port:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cu -l /dev/pts/6</code></strong></pre><p xml:lang="en" lang="en">The pseudo tty is printed on stdout and can be read by
	  wrapper scripts:</p><pre xml:lang="en" class="programlisting" lang="en">PTS=`rfcomm_sppd -a 00:07:E0:00:0B:CA -t`
cu -l $PTS</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88339128"></a>31.5.6. 疑難排解</h3></div></div></div><p xml:lang="en" lang="en">By default, when FreeBSD is accepting a new connection, it
	tries to perform a role switch and become master.  Some older
	Bluetooth devices which do not support role switching will not
	be able to connect.  Since role switching is performed when a
	new connection is being established, it is not possible to ask
	the remote device if it supports role switching.  However,
	there is a <acronym class="acronym">HCI</acronym> option to disable role
	switching on the local side:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>hccontrol -n ubt0hci write_node_role_switch 0</code></strong></pre><p xml:lang="en" lang="en">To display Bluetooth packets, use the third-party package
	<span class="application">hcidump</span>, which can be installed
	using the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/comms/hcidump/pkg-descr">comms/hcidump</a> package or port.
	This utility is similar to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tcpdump&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tcpdump</span>(1)</span></a> and can be used to
	display the contents of Bluetooth packets on the terminal and
	to dump the Bluetooth packets to a file.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-bridging"></a>31.6. 橋接</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Andrew</span> <span class="surname">Thompson</span></span>. </span></div></div></div><a id="idp88351800" class="indexterm"></a><a id="idp88352568" class="indexterm"></a><p xml:lang="en" lang="en">It is sometimes useful to divide a network, such as an
      Ethernet segment, into network segments without having to
      create <acronym class="acronym">IP</acronym> subnets and use a router to connect
      the segments together.  A device that connects two networks
      together in this fashion is called a
      <span class="quote">“<span class="quote">bridge</span>”</span>.</p><p xml:lang="en" lang="en">A bridge works by learning the <acronym class="acronym">MAC</acronym>
      addresses of the devices on each of its network interfaces.  It
      forwards traffic between networks only when the source and
      destination <acronym class="acronym">MAC</acronym> addresses are on different
      networks.  In many respects, a bridge is like an Ethernet switch
      with very few ports.    A FreeBSD system with multiple network
      interfaces can be configured to act as a bridge.</p><p xml:lang="en" lang="en">Bridging can be useful in the following situations:</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en">Connecting Networks</span></dt><dd><p xml:lang="en" lang="en">The basic operation of a bridge is to join two or more
	    network segments.  There are many reasons to use a
	    host-based bridge instead of networking equipment, such as
	    cabling constraints or firewalling.  A bridge can also
	    connect a wireless interface running in hostap mode to a
	    wired network and act as an access point.</p></dd><dt><span xml:lang="en" class="term" lang="en">Filtering/Traffic Shaping Firewall</span></dt><dd><p xml:lang="en" lang="en">A bridge can be used when firewall functionality is
	    needed without routing or Network Address Translation
	    (<acronym class="acronym">NAT</acronym>).</p><p xml:lang="en" lang="en">An example is a small company that is connected via
	    <acronym class="acronym">DSL</acronym> or <acronym class="acronym">ISDN</acronym> to an
	    <acronym class="acronym">ISP</acronym>.  There are thirteen public
	    <acronym class="acronym">IP</acronym> addresses from the
	    <acronym class="acronym">ISP</acronym> and ten computers on the network.
	    In this situation, using a router-based firewall is
	    difficult because of subnetting issues.  A bridge-based
	    firewall can be configured without any
	    <acronym class="acronym">IP</acronym> addressing issues.</p></dd><dt><span xml:lang="en" class="term" lang="en">Network Tap</span></dt><dd><p xml:lang="en" lang="en">A bridge can join two network segments in order to
	    inspect all Ethernet frames that pass between them using
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tcpdump&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tcpdump</span>(1)</span></a> on the bridge interface or
	    by sending a copy of all frames out an additional
	    interface known as a span port.</p></dd><dt><span xml:lang="en" class="term" lang="en">Layer 2 <acronym class="acronym">VPN</acronym></span></dt><dd><p xml:lang="en" lang="en">Two Ethernet networks can be joined across an
	    <acronym class="acronym">IP</acronym> link by bridging the networks to an
	    EtherIP tunnel or a <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tap&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tap</span>(4)</span></a> based solution such as
	    <span class="application">OpenVPN</span>.</p></dd><dt><span xml:lang="en" class="term" lang="en">Layer 2 Redundancy</span></dt><dd><p xml:lang="en" lang="en">A network can be connected together with multiple
	    links and use the Spanning Tree Protocol
	    (<acronym class="acronym">STP</acronym>) to block redundant paths.</p></dd></dl></div><p xml:lang="en" lang="en">This section describes how to configure a FreeBSD system as a
      bridge using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=if_bridge&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">if_bridge</span>(4)</span></a>.  A netgraph bridging driver is
      also available, and is described in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ng_bridge&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ng_bridge</span>(4)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Packet filtering can be used with any firewall package
	that hooks into the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pfil&amp;sektion=9&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pfil</span>(9)</span></a> framework.  The bridge can be
	used as a traffic shaper with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=altq&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">altq</span>(4)</span></a> or
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dummynet&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dummynet</span>(4)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88386232"></a>31.6.1. 開啟橋接</h3></div></div></div><p xml:lang="en" lang="en">In FreeBSD, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=if_bridge&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">if_bridge</span>(4)</span></a> is a kernel module which is
	automatically loaded by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> when creating a
	bridge interface.  It is also possible to compile bridge
	support into a custom kernel by adding
	<code class="literal">device if_bridge</code> to the custom kernel
	configuration file.</p><p xml:lang="en" lang="en">The bridge is created using interface cloning.  To create
	the bridge interface:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge create</code></strong>
bridge0
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0</code></strong>
bridge0: flags=8802&lt;BROADCAST,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether 96:3d:4b:f1:79:7a
        id 00:00:00:00:00:00 priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 timeout 1200
        root id 00:00:00:00:00:00 priority 0 ifcost 0 port 0</pre><p xml:lang="en" lang="en">When a bridge interface is created, it is automatically
	assigned a randomly generated Ethernet address.  The
	<code class="literal">maxaddr</code> and <code class="literal">timeout</code>
	parameters control how many <acronym class="acronym">MAC</acronym> addresses
	the bridge will keep in its forwarding table and how many
	seconds before each entry is removed after it is last seen.
	The other parameters control how <acronym class="acronym">STP</acronym>
	operates.</p><p xml:lang="en" lang="en">Next, specify which network interfaces to add as members
	of the bridge.  For the bridge to forward packets, all member
	interfaces and the bridge need to be up:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 addm fxp0 addm fxp1 up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig fxp0 up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig fxp1 up</code></strong></pre><p xml:lang="en" lang="en">The bridge can now forward Ethernet frames between
	<code class="filename">fxp0</code> and <code class="filename">fxp1</code>.  Add
	the following lines to <code class="filename">/etc/rc.conf</code> so
	the bridge is created at startup:</p><pre xml:lang="en" class="programlisting" lang="en">cloned_interfaces="bridge0"
ifconfig_bridge0="addm fxp0 addm fxp1 up"
ifconfig_fxp0="up"
ifconfig_fxp1="up"</pre><p xml:lang="en" lang="en">If the bridge host needs an <acronym class="acronym">IP</acronym>
	address, set it on the bridge interface, not on the member
	interfaces.  The address can be set statically or via
	<acronym class="acronym">DHCP</acronym>.  This example sets a static
	<acronym class="acronym">IP</acronym> address:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 inet 192.168.0.1/24</code></strong></pre><p xml:lang="en" lang="en">It is also possible to assign an <acronym class="acronym">IPv6</acronym>
	address to a bridge interface.  To make the changes permanent,
	add the addressing information to
	<code class="filename">/etc/rc.conf</code>.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">When packet filtering is enabled, bridged packets will
	  pass through the filter inbound on the originating interface
	  on the bridge interface, and outbound on the appropriate
	  interfaces.  Either stage can be disabled.  When direction
	  of the packet flow is important, it is best to firewall on
	  the member interfaces rather than the bridge itself.</p><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">The bridge has several configurable settings for passing
	  non-<acronym class="acronym">IP</acronym> and <acronym class="acronym">IP</acronym> packets,
	  and layer2 firewalling with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a>.  See
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=if_bridge&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">if_bridge</span>(4)</span></a> for more information.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88423480"></a>31.6.2. 開啟 Spanning Tree</h3></div></div></div><p xml:lang="en" lang="en">For an Ethernet network to function properly, only one
	active path can exist between two devices.  The
	<acronym class="acronym">STP</acronym> protocol detects loops and puts
	redundant links into a blocked state.  Should one of the
	active links fail, <acronym class="acronym">STP</acronym> calculates a
	different tree and enables one of the blocked paths to restore
	connectivity to all points in the network.</p><p xml:lang="en" lang="en">The Rapid Spanning Tree Protocol (<acronym class="acronym">RSTP</acronym>
	or 802.1w) provides backwards compatibility with legacy
	<acronym class="acronym">STP</acronym>.  <acronym class="acronym">RSTP</acronym> provides
	faster convergence and exchanges information with neighboring
	switches to quickly transition to forwarding mode without
	creating loops.  FreeBSD supports <acronym class="acronym">RSTP</acronym> and
	<acronym class="acronym">STP</acronym> as operating modes, with
	<acronym class="acronym">RSTP</acronym> being the default mode.</p><p xml:lang="en" lang="en"><acronym class="acronym">STP</acronym> can be enabled on member interfaces
	using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>.  For a bridge with
	<code class="filename">fxp0</code> and <code class="filename">fxp1</code> as the
	current interfaces, enable <acronym class="acronym">STP</acronym> with:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 stp fxp0 stp fxp1</code></strong>
bridge0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether d6:cf:d5:a0:94:6d
        id 00:01:02:4b:d4:50 priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 timeout 1200
        root id 00:01:02:4b:d4:50 priority 32768 ifcost 0 port 0
        member: fxp0 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 3 priority 128 path cost 200000 proto rstp
                role designated state forwarding
        member: fxp1 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 4 priority 128 path cost 200000 proto rstp
                role designated state forwarding</pre><p xml:lang="en" lang="en">This bridge has a spanning tree ID of
	<code class="literal">00:01:02:4b:d4:50</code> and a priority of
	<code class="literal">32768</code>.  As the <code class="literal">root id</code>
	is the same, it indicates that this is the root bridge for the
	tree.</p><p xml:lang="en" lang="en">Another bridge on the network also has
	<acronym class="acronym">STP</acronym> enabled:</p><pre xml:lang="en" class="screen" lang="en">bridge0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether 96:3d:4b:f1:79:7a
        id 00:13:d4:9a:06:7a priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 timeout 1200
        root id 00:01:02:4b:d4:50 priority 32768 ifcost 400000 port 4
        member: fxp0 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 4 priority 128 path cost 200000 proto rstp
                role root state forwarding
        member: fxp1 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 5 priority 128 path cost 200000 proto rstp
                role designated state forwarding</pre><p xml:lang="en" lang="en">The line <code class="literal">root id 00:01:02:4b:d4:50 priority 32768
	  ifcost 400000 port 4</code> shows that the root bridge is
	<code class="literal">00:01:02:4b:d4:50</code> and has a path cost of
	<code class="literal">400000</code> from this bridge.  The path to the
	root bridge is via <code class="literal">port 4</code> which is
	<code class="filename">fxp0</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88441912"></a>31.6.3. 橋接介面參數</h3></div></div></div><p xml:lang="en" lang="en">Several <code class="command">ifconfig</code> parameters are unique
	to bridge interfaces.  This section summarizes some common
	uses for these parameters.  The complete list of available
	parameters is described in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>.</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en">private</span></dt><dd><p xml:lang="en" lang="en">A private interface does not forward any traffic to
	      any other port that is also designated as a private
	      interface.  The traffic is blocked unconditionally so no
	      Ethernet frames will be forwarded, including
	      <acronym class="acronym">ARP</acronym> packets.  If traffic needs to be
	      selectively blocked, a firewall should be used
	      instead.</p></dd><dt><span xml:lang="en" class="term" lang="en">span</span></dt><dd><p xml:lang="en" lang="en">A span port transmits a copy of every Ethernet frame
	      received by the bridge.  The number of span ports
	      configured on a bridge is unlimited, but if an
	      interface is designated as a span port, it cannot also
	      be used as a regular bridge port.  This is most useful
	      for snooping a bridged network passively on another host
	      connected to one of the span ports of the bridge.  For
	      example, to send a copy of all frames out the interface
	      named <code class="filename">fxp4</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 span fxp4</code></strong></pre></dd><dt><span xml:lang="en" class="term" lang="en">sticky</span></dt><dd><p xml:lang="en" lang="en">If a bridge member interface is marked as sticky,
	      dynamically learned address entries are treated as
	      static entries in the forwarding cache.  Sticky entries
	      are never aged out of the cache or replaced, even if the
	      address is seen on a different interface.  This gives
	      the benefit of static address entries without the need
	      to pre-populate the forwarding table.  Clients learned
	      on a particular segment of the bridge cannot roam to
	      another segment.</p><p xml:lang="en" lang="en">An example of using sticky addresses is to combine
	      the bridge with <acronym class="acronym">VLAN</acronym>s in order to
	      isolate customer networks without wasting
	      <acronym class="acronym">IP</acronym> address space.  Consider that
	      <code class="systemitem">CustomerA</code>
	      is on <code class="literal">vlan100</code>, <code class="systemitem">CustomerB</code> is on
	      <code class="literal">vlan101</code>, and the bridge has the
	      address <code class="systemitem">192.168.0.1</code>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 addm vlan100 sticky vlan100 addm vlan101 sticky vlan101</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 inet 192.168.0.1/24</code></strong></pre><p xml:lang="en" lang="en">In this example, both clients see <code class="systemitem">192.168.0.1</code> as their
	      default gateway.  Since the bridge cache is sticky, one
	      host cannot spoof the <acronym class="acronym">MAC</acronym> address of
	      the other customer in order to intercept their
	      traffic.</p><p xml:lang="en" lang="en">Any communication between the
	      <acronym class="acronym">VLAN</acronym>s can be blocked using a firewall
	      or, as seen in this example, private interfaces:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 private vlan100 private vlan101</code></strong></pre><p xml:lang="en" lang="en">The customers are completely isolated from each
	      other and the full <code class="systemitem">/24</code> address range can be
	      allocated without subnetting.</p><p xml:lang="en" lang="en">The number of unique source <acronym class="acronym">MAC</acronym>
	      addresses behind an interface can be limited.  Once the
	      limit is reached, packets with unknown source addresses
	      are dropped until an existing host cache entry expires
	      or is removed.</p><p xml:lang="en" lang="en">The following example sets the maximum number of
	      Ethernet devices for <code class="systemitem">CustomerA</code> on
	      <code class="literal">vlan100</code> to 10:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 ifmaxaddr vlan100 10</code></strong></pre></dd></dl></div><p xml:lang="en" lang="en">Bridge interfaces also support monitor mode, where the
	packets are discarded after <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a> processing and are not
	processed or forwarded further.  This can be used to
	multiplex the input of two or more interfaces into a single
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a> stream.  This is useful for reconstructing the
	traffic for network taps that transmit the RX/TX signals out
	through two separate interfaces.  For example, to read the
	input from four network interfaces as one stream:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 addm fxp0 addm fxp1 addm fxp2 addm fxp3 monitor up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>tcpdump -i bridge0</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88489272"></a>31.6.4. <acronym class="acronym">SNMP</acronym> 監視</h3></div></div></div><p xml:lang="en" lang="en">The bridge interface and <acronym class="acronym">STP</acronym>
	parameters can be monitored via <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bsnmpd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bsnmpd</span>(1)</span></a> which is
	included in the FreeBSD base system.  The exported bridge
	<acronym class="acronym">MIB</acronym>s conform to <acronym class="acronym">IETF</acronym>
	standards so any <acronym class="acronym">SNMP</acronym> client or monitoring
	package can be used to retrieve the data.</p><p xml:lang="en" lang="en">To enable monitoring on the bridge, uncomment this line in
	<code class="filename">/etc/snmpd.config</code> by removing the
	beginning <code class="literal">#</code> symbol:</p><pre xml:lang="en" class="programlisting" lang="en">begemotSnmpdModulePath."bridge" = "/usr/lib/snmp_bridge.so"</pre><p xml:lang="en" lang="en">Other configuration settings, such as community names and
	access lists, may need to be modified in this file.  See
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bsnmpd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bsnmpd</span>(1)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=snmp_bridge&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">snmp_bridge</span>(3)</span></a> for more information.
	Once these edits are saved, add this line to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">bsnmpd_enable="YES"</pre><p xml:lang="en" lang="en">Then, start  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bsnmpd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bsnmpd</span>(1)</span></a>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service bsnmpd start</code></strong></pre><p xml:lang="en" lang="en">The following examples use the
	<span class="application">Net-SNMP</span> software
	(<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/net-snmp/pkg-descr">net-mgmt/net-snmp</a>) to query a bridge
	from a client system.  The
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/bsnmptools/pkg-descr">net-mgmt/bsnmptools</a> port can also be used.
	From the <acronym class="acronym">SNMP</acronym> client which is running
	<span class="application">Net-SNMP</span>, add the following lines
	to <code class="filename">$HOME/.snmp/snmp.conf</code> in order to
	import the bridge <acronym class="acronym">MIB</acronym> definitions:</p><pre xml:lang="en" class="programlisting" lang="en">mibdirs +/usr/share/snmp/mibs
mibs +BRIDGE-MIB:RSTP-MIB:BEGEMOT-MIB:BEGEMOT-BRIDGE-MIB</pre><p xml:lang="en" lang="en">To monitor a single bridge using the IETF BRIDGE-MIB
	(RFC4188):</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>snmpwalk -v 2c -c public bridge1.example.com mib-2.dot1dBridge</code></strong>
BRIDGE-MIB::dot1dBaseBridgeAddress.0 = STRING: 66:fb:9b:6e:5c:44
BRIDGE-MIB::dot1dBaseNumPorts.0 = INTEGER: 1 ports
BRIDGE-MIB::dot1dStpTimeSinceTopologyChange.0 = Timeticks: (189959) 0:31:39.59 centi-seconds
BRIDGE-MIB::dot1dStpTopChanges.0 = Counter32: 2
BRIDGE-MIB::dot1dStpDesignatedRoot.0 = Hex-STRING: 80 00 00 01 02 4B D4 50
...
BRIDGE-MIB::dot1dStpPortState.3 = INTEGER: forwarding(5)
BRIDGE-MIB::dot1dStpPortEnable.3 = INTEGER: enabled(1)
BRIDGE-MIB::dot1dStpPortPathCost.3 = INTEGER: 200000
BRIDGE-MIB::dot1dStpPortDesignatedRoot.3 = Hex-STRING: 80 00 00 01 02 4B D4 50
BRIDGE-MIB::dot1dStpPortDesignatedCost.3 = INTEGER: 0
BRIDGE-MIB::dot1dStpPortDesignatedBridge.3 = Hex-STRING: 80 00 00 01 02 4B D4 50
BRIDGE-MIB::dot1dStpPortDesignatedPort.3 = Hex-STRING: 03 80
BRIDGE-MIB::dot1dStpPortForwardTransitions.3 = Counter32: 1
RSTP-MIB::dot1dStpVersion.0 = INTEGER: rstp(2)</pre><p xml:lang="en" lang="en">The <code class="literal">dot1dStpTopChanges.0</code> value is two,
	indicating that the <acronym class="acronym">STP</acronym> bridge topology has
	changed twice.  A topology change means that one or more links
	in the network have changed or failed and a new tree has been
	calculated.  The
	<code class="literal">dot1dStpTimeSinceTopologyChange.0</code> value
	will show when this happened.</p><p xml:lang="en" lang="en">To monitor multiple bridge interfaces, the private
	BEGEMOT-BRIDGE-MIB can be used:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>snmpwalk -v 2c -c public bridge1.example.com</code></strong>
enterprises.fokus.begemot.begemotBridge
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseName."bridge0" = STRING: bridge0
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseName."bridge2" = STRING: bridge2
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseAddress."bridge0" = STRING: e:ce:3b:5a:9e:13
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseAddress."bridge2" = STRING: 12:5e:4d:74:d:fc
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseNumPorts."bridge0" = INTEGER: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseNumPorts."bridge2" = INTEGER: 1
...
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTimeSinceTopologyChange."bridge0" = Timeticks: (116927) 0:19:29.27 centi-seconds
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTimeSinceTopologyChange."bridge2" = Timeticks: (82773) 0:13:47.73 centi-seconds
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTopChanges."bridge0" = Counter32: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTopChanges."bridge2" = Counter32: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeStpDesignatedRoot."bridge0" = Hex-STRING: 80 00 00 40 95 30 5E 31
BEGEMOT-BRIDGE-MIB::begemotBridgeStpDesignatedRoot."bridge2" = Hex-STRING: 80 00 00 50 8B B8 C6 A9</pre><p xml:lang="en" lang="en">To change the bridge interface being monitored via the
	<code class="literal">mib-2.dot1dBridge</code> subtree:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">%</code> <strong class="userinput"><code>snmpset -v 2c -c private bridge1.example.com</code></strong>
BEGEMOT-BRIDGE-MIB::begemotBridgeDefaultBridgeIf.0 s bridge2</pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-aggregation"></a>31.7. Link Aggregation 與容錯移轉</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Andrew</span> <span class="surname">Thompson</span></span>. </span></div></div></div><a id="idp88076472" class="indexterm"></a><a id="idp88077368" class="indexterm"></a><a id="idp88077880" class="indexterm"></a><a id="idp88078904" class="indexterm"></a><a id="idp88079928" class="indexterm"></a><a id="idp88080824" class="indexterm"></a><p xml:lang="en" lang="en">FreeBSD provides the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a> interface which can be used
      to aggregate multiple network interfaces into one virtual
      interface in order to provide failover and link aggregation.
      Failover allows traffic to continue to flow as long as at least
      one aggregated network interface has an established link.  Link
      aggregation works best on switches which support
      <acronym class="acronym">LACP</acronym>, as this protocol distributes traffic
      bi-directionally while responding to the failure of individual
      links.</p><p xml:lang="en" lang="en">The aggregation protocols supported by the lagg interface
      determine which ports are used for outgoing traffic and whether
      or not a specific port accepts incoming traffic.  The following
      protocols are supported by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a>:</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en">failover</span></dt><dd><p xml:lang="en" lang="en">This mode sends and receives traffic only through
	    the master port.  If the master port becomes
	    unavailable, the next active port is used.  The first
	    interface added to the virtual interface is the master
	    port and all subsequently added interfaces are used as
	    failover devices.  If failover to a non-master port
	    occurs, the original port becomes master once it
	    becomes available again.</p></dd><dt><span xml:lang="en" class="term" lang="en">fec / loadbalance</span></dt><dd><p xml:lang="en" lang="en"><span class="trademark">Cisco</span>® Fast <span class="trademark">EtherChannel</span>® (<acronym class="acronym">FEC</acronym>)
	    is found on older <span class="trademark">Cisco</span>® switches.  It provides a
	    static setup and does not negotiate aggregation with the
	    peer or exchange frames to monitor the link.  If the
	    switch supports <acronym class="acronym">LACP</acronym>, that should be
	    used instead.</p></dd><dt><span xml:lang="en" class="term" lang="en"><acronym class="acronym">lacp</acronym></span></dt><dd><p xml:lang="en" lang="en">The <span class="trademark">IEEE</span>® 802.3ad Link Aggregation Control Protocol
	    (<acronym class="acronym">LACP</acronym>) negotiates a set of
	    aggregable links with the peer into one or more Link
	    Aggregated Groups (<acronym class="acronym">LAG</acronym>s).  Each
	    <acronym class="acronym">LAG</acronym> is composed of ports of the same
	    speed, set to full-duplex operation, and traffic is
	    balanced across the ports in the
	    <acronym class="acronym">LAG</acronym> with the greatest total speed.
	    Typically, there is only one <acronym class="acronym">LAG</acronym>
	    which contains all the ports.  In the event of changes
	    in physical connectivity,
	    <acronym class="acronym">LACP</acronym> will quickly converge to a new
	    configuration.</p><p xml:lang="en" lang="en"><acronym class="acronym">LACP</acronym> balances outgoing traffic
	    across the active ports based on hashed protocol header
	    information and accepts incoming traffic from any active
	    port.  The hash includes the Ethernet source and
	    destination address and, if available, the
	    <acronym class="acronym">VLAN</acronym> tag, and the
	    <acronym class="acronym">IPv4</acronym> or <acronym class="acronym">IPv6</acronym>
	    source and destination address.</p></dd><dt><span xml:lang="en" class="term" lang="en">roundrobin</span></dt><dd><p xml:lang="en" lang="en">This mode distributes outgoing traffic using a
	    round-robin scheduler through all active ports and
	    accepts incoming traffic from any active port.  Since
	    this mode violates Ethernet frame ordering, it should be
	    used with caution.</p></dd></dl></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88574520"></a>31.7.1. 設定範例</h3></div></div></div><p xml:lang="en" lang="en">This section demonstrates how to configure a <span class="trademark">Cisco</span>®
	switch and a FreeBSD system for <acronym class="acronym">LACP</acronym> load
	balancing.  It then shows how to configure two Ethernet
	interfaces in failover mode as well as how to configure
	failover mode between an Ethernet and a wireless
	interface.</p><div class="example"><a id="networking-lacp-aggregation-cisco"></a><div class="example-title">範例 31.1. <span class="trademark">Cisco</span>® 交換器上設定 <acronym class="acronym">LACP</acronym> Aggregation</div><div class="example-contents"><p xml:lang="en" lang="en">This example connects two <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fxp&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fxp</span>(4)</span></a> Ethernet
	  interfaces on a FreeBSD machine to the first two Ethernet ports
	  on a <span class="trademark">Cisco</span>® switch as a single load balanced and fault
	  tolerant link.  More interfaces can be added to increase
	  throughput and fault tolerance.  Replace the names of the
	  <span class="trademark">Cisco</span>® ports, Ethernet devices, channel group number, and
	  <acronym class="acronym">IP</acronym> address shown in the example to match
	  the local configuration.</p><p xml:lang="en" lang="en">Frame ordering is mandatory on Ethernet links and any
	  traffic between two stations always flows over the same
	  physical link, limiting the maximum speed to that of one
	  interface.  The transmit algorithm attempts to use as much
	  information as it can to distinguish different traffic flows
	  and balance the flows across the available
	  interfaces.</p><p xml:lang="en" lang="en">On the <span class="trademark">Cisco</span>® switch, add the
	  <em class="replaceable"><code>FastEthernet0/1</code></em> and
	  <em class="replaceable"><code>FastEthernet0/2</code></em> interfaces to
	  channel group <em class="replaceable"><code>1</code></em>:</p><pre xml:lang="en" class="screen" lang="en"><strong class="userinput"><code>interface <em class="replaceable"><code>FastEthernet0/1</code></em>
 channel-group <em class="replaceable"><code>1</code></em> mode active
 channel-protocol lacp</code></strong>
!
<strong class="userinput"><code>interface <em class="replaceable"><code>FastEthernet0/2</code></em>
 channel-group <em class="replaceable"><code>1</code></em> mode active
 channel-protocol lacp</code></strong></pre><p xml:lang="en" lang="en">On the FreeBSD system, create the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a> interface
	  using the physical interfaces
	  <em class="replaceable"><code>fxp0</code></em> and
	  <em class="replaceable"><code>fxp1</code></em> and bring the interfaces up
	  with an <acronym class="acronym">IP</acronym> address of
	  <em class="replaceable"><code>10.0.0.3/24</code></em>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>fxp0</code></em> up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>fxp1</code></em> up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <code class="literal">lagg<em class="replaceable"><code>0</code></em></code> create </code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <code class="literal">lagg<em class="replaceable"><code>0</code></em></code> up laggproto lacp laggport <em class="replaceable"><code>fxp0</code></em> laggport <em class="replaceable"><code>fxp1</code></em> <em class="replaceable"><code>10.0.0.3/24</code></em></code></strong></pre><p xml:lang="en" lang="en">Next, verify the status of the virtual interface:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <code class="literal">lagg<em class="replaceable"><code>0</code></em></code></code></strong>
lagg0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=8&lt;VLAN_MTU&gt;
        ether 00:05:5d:71:8d:b8
        inet 10.0.0.3 netmask 0xffffff00 broadcast 10.0.0.255
        media: Ethernet autoselect
        status: active
        laggproto lacp
        laggport: fxp1 flags=1c&lt;ACTIVE,COLLECTING,DISTRIBUTING&gt;
        laggport: fxp0 flags=1c&lt;ACTIVE,COLLECTING,DISTRIBUTING&gt;</pre><p xml:lang="en" lang="en">Ports
	  marked as <code class="literal">ACTIVE</code> are part of the
	  <acronym class="acronym">LAG</acronym> that has been negotiated with the
	  remote switch.  Traffic will be transmitted and received
	  through these active ports.  Add <code class="option">-v</code> to the
	  above command to view the <acronym class="acronym">LAG</acronym>
	  identifiers.</p><p xml:lang="en" lang="en">To see the port status on the <span class="trademark">Cisco</span>® switch:</p><pre xml:lang="en" class="screen" lang="en">switch# <strong class="userinput"><code>show lacp neighbor</code></strong>
Flags:  S - Device is requesting Slow LACPDUs
        F - Device is requesting Fast LACPDUs
        A - Device is in Active mode       P - Device is in Passive mode

Channel group 1 neighbors

Partner's information:

                  LACP port                        Oper    Port     Port
Port      Flags   Priority  Dev ID         Age     Key     Number   State
Fa0/1     SA      32768     0005.5d71.8db8  29s    0x146   0x3      0x3D
Fa0/2     SA      32768     0005.5d71.8db8  29s    0x146   0x4      0x3D</pre><p xml:lang="en" lang="en">For more detail, type <strong class="userinput"><code>show lacp neighbor
	  detail</code></strong>.</p><p xml:lang="en" lang="en">To retain this configuration across reboots, add the
	  following entries to
	  <code class="filename">/etc/rc.conf</code> on the FreeBSD system:</p><pre xml:lang="en" class="programlisting" lang="en">ifconfig_<em class="replaceable"><code>fxp0</code></em>="up"
ifconfig_<em class="replaceable"><code>fxp1</code></em>="up"
cloned_interfaces="<code class="literal">lagg<em class="replaceable"><code>0</code></em></code>"
ifconfig_<code class="literal">lagg<em class="replaceable"><code>0</code></em></code>="laggproto lacp laggport <em class="replaceable"><code>fxp0</code></em> laggport <em class="replaceable"><code>fxp1</code></em> <em class="replaceable"><code>10.0.0.3/24</code></em>"</pre></div></div><br class="example-break" /><div class="example"><a id="networking-lagg-failover"></a><div class="example-title">範例 31.2. 容錯移轉模式</div><div class="example-contents"><p xml:lang="en" lang="en">Failover mode can be used to switch over to a secondary
	  interface if the link is lost on the master interface.  To
	  configure failover, make sure that the underlying physical
	  interfaces are up, then create the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a> interface.
	  In this example, <em class="replaceable"><code>fxp0</code></em> is the
	  master interface, <em class="replaceable"><code>fxp1</code></em> is the
	  secondary interface, and the virtual interface is assigned
	  an <acronym class="acronym">IP</acronym> address of
	  <em class="replaceable"><code>10.0.0.15/24</code></em>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>fxp0</code></em> up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>fxp1</code></em> up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <code class="literal">lagg<em class="replaceable"><code>0</code></em></code> create</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <code class="literal">lagg<em class="replaceable"><code>0</code></em></code> up laggproto failover laggport <em class="replaceable"><code>fxp0</code></em> laggport <em class="replaceable"><code>fxp1</code></em> <em class="replaceable"><code>10.0.0.15/24</code></em></code></strong></pre><p xml:lang="en" lang="en">The virtual interface should look something like
	  this:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <code class="literal">lagg<em class="replaceable"><code>0</code></em></code></code></strong>
lagg0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=8&lt;VLAN_MTU&gt;
        ether 00:05:5d:71:8d:b8
        inet 10.0.0.15 netmask 0xffffff00 broadcast 10.0.0.255
        media: Ethernet autoselect
        status: active
        laggproto failover
        laggport: fxp1 flags=0&lt;&gt;
        laggport: fxp0 flags=5&lt;MASTER,ACTIVE&gt;</pre><p xml:lang="en" lang="en">Traffic will be transmitted and received on
	  <em class="replaceable"><code>fxp0</code></em>.  If the link is lost on
	  <em class="replaceable"><code>fxp0</code></em>,
	  <em class="replaceable"><code>fxp1</code></em> will become the active link.
	  If the link is restored on the master interface, it will
	  once again become the active link.</p><p xml:lang="en" lang="en">To retain this configuration across reboots, add the
	  following entries to
	  <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">ifconfig_<em class="replaceable"><code>fxp0</code></em>="up"
ifconfig_<em class="replaceable"><code>fxp1</code></em>="up"
cloned_interfaces="<code class="literal">lagg<em class="replaceable"><code>0</code></em></code>"
ifconfig_<code class="literal">lagg<em class="replaceable"><code>0</code></em></code>="laggproto failover laggport <em class="replaceable"><code>fxp0</code></em> laggport <em class="replaceable"><code>fxp1</code></em> <em class="replaceable"><code>10.0.0.15/24</code></em>"</pre></div></div><br class="example-break" /><div class="example"><a id="networking-lagg-wired-and-wireless"></a><div class="example-title">範例 31.3. 乙太網路與無線介面間的容錯移轉模式</div><div class="example-contents"><p xml:lang="en" lang="en">For laptop users, it is usually desirable to configure
	  the wireless device as a secondary which is only used when
	  the Ethernet connection is not available.  With
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a>, it is possible to configure a failover which
	  prefers the Ethernet connection for both performance and
	  security reasons, while maintaining the ability to transfer
	  data over the wireless connection.</p><p xml:lang="en" lang="en">This is achieved by overriding the physical wireless
	  interface's <acronym class="acronym">MAC</acronym> address with that of the
	  Ethernet interface.</p><p xml:lang="en" lang="en">In this example, the Ethernet interface,
	  <em class="replaceable"><code>bge0</code></em>, is the master and the
	  wireless interface, <em class="replaceable"><code>wlan0</code></em>, is
	  the failover.  The <em class="replaceable"><code>wlan0</code></em> device
	  was created from <em class="replaceable"><code>iwn0</code></em> wireless
	  interface, which will be configured with the
	  <acronym class="acronym">MAC</acronym> address of the Ethernet interface.
	  First, determine the <acronym class="acronym">MAC</acronym> address of the
	  Ethernet interface:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>bge0</code></em></code></strong>
bge0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	options=19b&lt;RXCSUM,TXCSUM,VLAN_MTU,VLAN_HWTAGGING,VLAN_HWCSUM,TSO4&gt;
	ether 00:21:70:da:ae:37
	inet6 fe80::221:70ff:feda:ae37%bge0 prefixlen 64 scopeid 0x2
	nd6 options=29&lt;PERFORMNUD,IFDISABLED,AUTO_LINKLOCAL&gt;
	media: Ethernet autoselect (1000baseT &lt;full-duplex&gt;)
	status: active</pre><p xml:lang="en" lang="en">Replace <em class="replaceable"><code>bge0</code></em> to match the
	  system's Ethernet interface name.  The
	  <code class="literal">ether</code> line will contain the
	  <acronym class="acronym">MAC</acronym> address of the specified interface.
	  Now, change the <acronym class="acronym">MAC</acronym> address of the
	  underlying wireless interface:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>iwn0</code></em> ether <em class="replaceable"><code>00:21:70:da:ae:37</code></em></code></strong></pre><p xml:lang="en" lang="en">Bring the wireless interface up, but do not set an
	  <acronym class="acronym">IP</acronym> address:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>iwn0</code></em> ssid <em class="replaceable"><code>my_router</code></em> up</code></strong></pre><p xml:lang="en" lang="en">Make sure the <em class="replaceable"><code>bge0</code></em> interface
	  is up, then create the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a> interface with
	  <em class="replaceable"><code>bge0</code></em> as master with failover to
	  <em class="replaceable"><code>wlan0</code></em>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>bge0</code></em> up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <code class="literal">lagg<em class="replaceable"><code>0</code></em></code> create</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <code class="literal">lagg<em class="replaceable"><code>0</code></em></code> up laggproto failover laggport <em class="replaceable"><code>bge0</code></em> laggport <em class="replaceable"><code>wlan0</code></em></code></strong></pre><p xml:lang="en" lang="en">The virtual interface should look something like
	  this:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <code class="literal">lagg<em class="replaceable"><code>0</code></em></code></code></strong>
lagg0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=8&lt;VLAN_MTU&gt;
        ether 00:21:70:da:ae:37
        media: Ethernet autoselect
        status: active
        laggproto failover
        laggport: wlan0 flags=0&lt;&gt;
        laggport: bge0 flags=5&lt;MASTER,ACTIVE&gt;</pre><p xml:lang="en" lang="en">Then, start the <acronym class="acronym">DHCP</acronym> client to
	  obtain an <acronym class="acronym">IP</acronym> address:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>dhclient <code class="literal">lagg<em class="replaceable"><code>0</code></em></code></code></strong></pre><p xml:lang="en" lang="en">To retain this configuration across reboots, add the
	  following entries to
	  <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">ifconfig_bge0="up"
wlans_<em class="replaceable"><code>iwn0</code></em>="wlan0"
ifconfig_wlan0="WPA"
create_args_wlan0="<em class="replaceable"><code>wlanaddr 00:21:70:da:ae:37</code></em>"
cloned_interfaces="<code class="literal">lagg<em class="replaceable"><code>0</code></em></code>"
ifconfig_<code class="literal">lagg<em class="replaceable"><code>0</code></em></code>="up laggproto failover laggport bge0 laggport wlan0 DHCP"</pre></div></div><br class="example-break" /></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-diskless"></a>31.8. <acronym class="acronym">PXE</acronym> 無磁碟作業</h2></div><div><span class="authorgroup">Updated by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Jean-François</span> <span class="surname">Dockès</span></span>. </span></div><div><span class="authorgroup">Reorganized and enhanced by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Alex</span> <span class="surname">Dupre</span></span>. </span></div></div></div><a id="idp88375352" class="indexterm"></a><a id="idp88375864" class="indexterm"></a><p xml:lang="en" lang="en">The <span class="trademark">Intel</span>® Preboot eXecution Environment
      (<acronym class="acronym">PXE</acronym>) allows an operating system to boot over
      the network.  For example, a FreeBSD system can boot over the
      network and operate without a local disk, using file systems
      mounted from an <acronym class="acronym">NFS</acronym> server.
      <acronym class="acronym">PXE</acronym> support is usually available in the
      <acronym class="acronym">BIOS</acronym>.  To use <acronym class="acronym">PXE</acronym> when the
      machine starts, select the <code class="literal">Boot from network</code>
      option in the <acronym class="acronym">BIOS</acronym> setup or type a function
      key during system initialization.</p><p xml:lang="en" lang="en">In order to provide the files needed for an operating system
      to boot over the network, a <acronym class="acronym">PXE</acronym> setup also
      requires properly configured <acronym class="acronym">DHCP</acronym>,
      <acronym class="acronym">TFTP</acronym>, and <acronym class="acronym">NFS</acronym> servers,
      where:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Initial parameters, such as an <acronym class="acronym">IP</acronym>
	  address, executable boot filename and location, server name,
	  and root path are obtained from the
	  <acronym class="acronym">DHCP</acronym> server.</p></li><li class="listitem"><p xml:lang="en" lang="en">The operating system loader file is booted using
	  <acronym class="acronym">TFTP</acronym>.</p></li><li class="listitem"><p xml:lang="en" lang="en">The file systems are loaded using
	  <acronym class="acronym">NFS</acronym>.</p></li></ul></div><p xml:lang="en" lang="en">When a computer <acronym class="acronym">PXE</acronym> boots, it receives
      information over <acronym class="acronym">DHCP</acronym> about where to obtain
      the initial boot loader file.  After the host computer receives
      this information, it downloads the boot loader via
      <acronym class="acronym">TFTP</acronym> and then executes the boot loader.  In
      FreeBSD, the boot loader file is
      <code class="filename">/boot/pxeboot</code>.  After
      <code class="filename">/boot/pxeboot</code> executes, the FreeBSD kernel is
      loaded and the rest of the FreeBSD bootup sequence proceeds, as
      described in <a class="xref" href="#boot" title="章 12. FreeBSD 開機程序">章 12, <em>FreeBSD 開機程序</em></a>.</p><p xml:lang="en" lang="en">This section describes how to configure these services on a
      FreeBSD system so that other systems can <acronym class="acronym">PXE</acronym>
      boot into FreeBSD.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=diskless&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">diskless</span>(8)</span></a> for more
      information.</p><div xmlns="" class="caution"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">As described, the system providing these services is
	insecure.  It should live in a protected area of a network and
	be untrusted by other hosts.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-pxe-nfs"></a>31.8.1. 設定 <acronym class="acronym">PXE</acronym> 環境</h3></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Craig</span> <span class="surname">Rodrigues</span></span>. </span></div></div></div><p xml:lang="en" lang="en">The steps shown in this section configure the built-in
	<acronym class="acronym">NFS</acronym> and <acronym class="acronym">TFTP</acronym> servers.
	The next section demonstrates how to install and configure the
	<acronym class="acronym">DHCP</acronym> server.  In this example, the
	directory which will contain the files used by
	<acronym class="acronym">PXE</acronym> users is
	<code class="filename">/b/tftpboot/FreeBSD/install</code>.  It is
	important that this directory exists and that the same
	directory name is set in both
	<code class="filename">/etc/inetd.conf</code> and
	<code class="filename">/usr/local/etc/dhcpd.conf</code>.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">Create the root directory which will contain a FreeBSD
	    installation to be <acronym class="acronym">NFS</acronym> mounted:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>export NFSROOTDIR=/b/tftpboot/FreeBSD/install</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p ${NFSROOTDIR}</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">Enable the <acronym class="acronym">NFS</acronym> server by adding
	    this line to <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">nfs_server_enable="YES"</pre></li><li class="step"><p xml:lang="en" lang="en">Export the diskless root directory via
	    <acronym class="acronym">NFS</acronym> by adding the following to
	    <code class="filename">/etc/exports</code>:</p><pre xml:lang="en" class="programlisting" lang="en">/b -ro -alldirs -maproot=root</pre></li><li class="step"><p xml:lang="en" lang="en">Start the <acronym class="acronym">NFS</acronym> server:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service nfsd start</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">Enable <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> by adding the following line to
	    <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">inetd_enable="YES"</pre></li><li class="step"><p xml:lang="en" lang="en">Uncomment the following line in
	    <code class="filename">/etc/inetd.conf</code> by making sure it
	    does not start with a <code class="literal">#</code> symbol:</p><pre xml:lang="en" class="programlisting" lang="en">tftp dgram udp wait root /usr/libexec/tftpd tftpd -l -s /b/tftpboot</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Some <acronym class="acronym">PXE</acronym> versions require the
	      <acronym class="acronym">TCP</acronym> version of
	      <acronym class="acronym">TFTP</acronym>.  In this case, uncomment the
	      second <code class="literal">tftp</code> line which contains
	      <code class="literal">stream tcp</code>.</p></div></li><li class="step"><p xml:lang="en" lang="en">Start <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service inetd start</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">Install the base system into
		<code class="filename">${NFSROOTDIR}</code>, either by
		decompressing the official archives or by rebuilding
		the FreeBSD kernel and userland (refer to
		<a class="xref" href="#makeworld" title="23.5. 從原始碼更新 FreeBSD">節 23.5, “從原始碼更新 FreeBSD”</a> for more detailed
		instructions, but do not forget to add
		<code class="option">DESTDIR=<em class="replaceable"><code>${NFSROOTDIR}</code></em></code>
		when running the
		<code class="command">make installkernel</code> and
		<code class="command">make installworld</code> commands.</p></li><li class="step"><p xml:lang="en" lang="en">Test that the <acronym class="acronym">TFTP</acronym> server works and
	    can download the boot loader which will be obtained via
	    <acronym class="acronym">PXE</acronym>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>tftp localhost</code></strong>
tftp&gt; <strong class="userinput"><code>get FreeBSD/install/boot/pxeboot</code></strong>
Received 264951 bytes in 0.1 seconds</pre></li><li class="step"><p xml:lang="en" lang="en">Edit <code class="filename">${NFSROOTDIR}/etc/fstab</code> and
	    create an entry to mount the root file system over
	    <acronym class="acronym">NFS</acronym>:</p><pre xml:lang="en" class="programlisting" lang="en"># Device                                         Mountpoint    FSType   Options  Dump Pass
<em class="replaceable"><code>myhost.example.com</code></em>:/b/tftpboot/FreeBSD/install       /         nfs      ro        0    0</pre><p xml:lang="en" lang="en">Replace <em class="replaceable"><code>myhost.example.com</code></em>
	    with the hostname or <acronym class="acronym">IP</acronym> address of the
	    <acronym class="acronym">NFS</acronym> server.  In this example, the root
	    file system is mounted read-only in order to prevent
	    <acronym class="acronym">NFS</acronym> clients from potentially deleting
	    the contents of the root file system.</p></li><li class="step"><p xml:lang="en" lang="en">Set the root password in the <acronym class="acronym">PXE</acronym>
	    environment for client machines which are
	    <acronym class="acronym">PXE</acronym> booting :</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>chroot ${NFSROOTDIR}</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>passwd</code></strong></pre></li><li class="step"><p xml:lang="en" lang="en">If needed, enable <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> root logins for client
	    machines which are <acronym class="acronym">PXE</acronym> booting by
	    editing
	    <code class="filename">${NFSROOTDIR}/etc/ssh/sshd_config</code> and
	    enabling <code class="literal">PermitRootLogin</code>.  This option
	    is documented in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd_config&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd_config</span>(5)</span></a>.</p></li><li class="step"><p xml:lang="en" lang="en">Perform any other needed customizations of the
	    <acronym class="acronym">PXE</acronym> environment in
	    <code class="filename">${NFSROOTDIR}</code>.  These customizations
	    could include things like installing packages or editing
	    the password file with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vipw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vipw</span>(8)</span></a>.</p></li></ol></div><p xml:lang="en" lang="en">When booting from an <acronym class="acronym">NFS</acronym> root volume,
	<code class="filename">/etc/rc</code> detects the
	<acronym class="acronym">NFS</acronym> boot and runs
	<code class="filename">/etc/rc.initdiskless</code>.  In this case,
	<code class="filename">/etc</code> and <code class="filename">/var</code> need
	to be memory backed file systems so that these directories are
	writable but the <acronym class="acronym">NFS</acronym> root directory is
	read-only:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>chroot ${NFSROOTDIR}</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p conf/base</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>tar -c -v -f conf/base/etc.cpio.gz --format cpio --gzip etc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>tar -c -v -f conf/base/var.cpio.gz --format cpio --gzip var</code></strong></pre><p xml:lang="en" lang="en">When the system boots, memory file systems for
	<code class="filename">/etc</code> and <code class="filename">/var</code> will
	be created and mounted and the contents of the
	<code class="filename">cpio.gz</code> files will be copied into
	them.  By default, these file systems have a maximum capacity
	of 5 megabytes.  If your archives do not fit, which is
	usually the case for <code class="filename">/var</code> when binary
	packages have been installed, request a larger size by putting
	the number of 512 byte sectors needed (e.g., 5 megabytes
	is 10240 sectors) in
	<code class="filename">${NFSROOTDIR}/conf/base/etc/md_size</code> and
	<code class="filename">${NFSROOTDIR}/conf/base/var/md_size</code>
	files for <code class="filename">/etc</code> and
	<code class="filename">/var</code> file systems respectively.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-pxe-setting-up-dhcp"></a>31.8.2. 設定 <acronym class="acronym">DHCP</acronym> 伺服器</h3></div></div></div><a id="idp88518200" class="indexterm"></a><p xml:lang="en" lang="en">The <acronym class="acronym">DHCP</acronym> server does not need to be the
	same machine as the <acronym class="acronym">TFTP</acronym> and
	<acronym class="acronym">NFS</acronym> server, but it needs to be accessible
	in the network.</p><p xml:lang="en" lang="en"><acronym class="acronym">DHCP</acronym> is not part of the FreeBSD base
	system but can be installed using the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/isc-dhcp43-server/pkg-descr">net/isc-dhcp43-server</a> port or
	package.</p><p xml:lang="en" lang="en">Once installed, edit the configuration file,
	<code class="filename">/usr/local/etc/dhcpd.conf</code>.  Configure
	the <code class="literal">next-server</code>,
	<code class="literal">filename</code>, and
	<code class="literal">root-path</code> settings as seen in this
	example:</p><pre xml:lang="en" class="programlisting" lang="en">subnet 192.168.0.0 netmask 255.255.255.0 {
   range 192.168.0.2 192.168.0.3 ;
   option subnet-mask 255.255.255.0 ;
   option routers 192.168.0.1 ;
   option broadcast-address 192.168.0.255 ;
   option domain-name-servers 192.168.35.35, 192.168.35.36 ;
   option domain-name "example.com";

   # IP address of TFTP server
   next-server <em class="replaceable"><code>192.168.0.1</code></em> ;

   # path of boot loader obtained via tftp
   filename "<em class="replaceable"><code>FreeBSD/install/boot/pxeboot</code></em>" ;

   # pxeboot boot loader will try to NFS mount this directory for root FS
   option root-path "<em class="replaceable"><code>192.168.0.1:/b/tftpboot/FreeBSD/install/</code></em>" ;

}</pre><p xml:lang="en" lang="en">The <code class="literal">next-server</code> directive is used to
	specify the <acronym class="acronym">IP</acronym> address of the
	<acronym class="acronym">TFTP</acronym> server.</p><p xml:lang="en" lang="en">The <code class="literal">filename</code> directive defines the path
	to <code class="filename">/boot/pxeboot</code>.  A relative filename is
	used, meaning that <code class="filename">/b/tftpboot</code> is not
	included in the path.</p><p xml:lang="en" lang="en">The <code class="literal">root-path</code> option defines the path
	to the <acronym class="acronym">NFS</acronym> root file system.</p><p xml:lang="en" lang="en">Once the edits are saved, enable <acronym class="acronym">DHCP</acronym>
	at boot time by adding the following line to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">dhcpd_enable="YES"</pre><p xml:lang="en" lang="en">Then start the <acronym class="acronym">DHCP</acronym> service:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>service isc-dhcpd start</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88879032"></a>31.8.3. <acronym class="acronym">PXE</acronym> 問題除錯</h3></div></div></div><p xml:lang="en" lang="en">Once all of the services are configured and started,
	<acronym class="acronym">PXE</acronym> clients should be able to
	automatically load FreeBSD over the network.  If a particular
	client is unable to connect, when that client machine boots
	up, enter the <acronym class="acronym">BIOS</acronym> configuration menu and
	confirm that it is set to boot from the network.</p><p xml:lang="en" lang="en">This section describes some troubleshooting tips for
	isolating the source of the configuration problem should no
	clients be able to <acronym class="acronym">PXE</acronym> boot.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p xml:lang="en" lang="en">Use the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/wireshark/pkg-descr">net/wireshark</a> package or
	    port to debug the network traffic involved during the
	    <acronym class="acronym">PXE</acronym> booting process, which is
	    illustrated in the diagram below.</p><div class="figure"><a id="idp88937144"></a><div class="figure-title">圖形 31.1. 使用 <acronym class="acronym">NFS</acronym> Root Mount 進行 <acronym class="acronym">PXE</acronym> 開機程序</div><div class="figure-contents"><div class="mediaobject"><img border="0" usemap="#idp88939064" src="advanced-networking/pxe-nfs.png" alt="使用 NFS Root Mount 進行 PXE 開機程序" /><map name="idp88939064" id="idp88939064"><area shape="rect" coords="155,98,179,67" /><area shape="rect" coords="190,162,210,132" /><area shape="rect" coords="258,173,276,149" /><area shape="rect" coords="259,230,276,204" /><area shape="rect" coords="168,295,190,264" /></map><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></p></td><td valign="top" align="left"><p xml:lang="en" lang="en">Client broadcasts a
		      <code class="literal">DHCPDISCOVER</code> message.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The <acronym class="acronym">DHCP</acronym> server responds
		      with the <acronym class="acronym">IP</acronym> address,
		      <code class="literal">next-server</code>,
		      <code class="literal">filename</code>, and
		      <code class="literal">root-path</code> values.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The client sends a <acronym class="acronym">TFTP</acronym>
		      request to <code class="literal">next-server</code>,
		      asking to retrieve
		      <code class="literal">filename</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The <acronym class="acronym">TFTP</acronym> server responds
		      and sends <code class="literal">filename</code> to
		      client.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></p></td><td valign="top" align="left"><p xml:lang="en" lang="en">The client executes
		      <code class="literal">filename</code>, which is
		      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pxeboot&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pxeboot</span>(8)</span></a>, which then loads the kernel.
		      When the kernel executes, the root file system
		      specified by <code class="literal">root-path</code> is
		      mounted over <acronym class="acronym">NFS</acronym>.</p></td></tr></table></div></div></div></div><br class="figure-break" /></li><li class="step"><p xml:lang="en" lang="en">On the
	    <acronym class="acronym">TFTP</acronym> server, read
	    <code class="filename">/var/log/xferlog</code> to ensure that
	    <code class="filename">pxeboot</code> is being retrieved from
	    the correct location.  To test this example
	    configuration:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>tftp 192.168.0.1</code></strong>
tftp&gt; <strong class="userinput"><code>get FreeBSD/install/boot/pxeboot</code></strong>
Received 264951 bytes in 0.1 seconds</pre><p xml:lang="en" lang="en">The <code class="literal">BUGS</code> sections in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tftpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tftpd</span>(8)</span></a>
	    and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tftp&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tftp</span>(1)</span></a> document some limitations with
	    <acronym class="acronym">TFTP</acronym>.</p></li><li class="step"><p xml:lang="en" lang="en">Make sure that the root file system can be mounted
	    via <acronym class="acronym">NFS</acronym>.  To test this example
	    configuration:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>mount -t nfs 192.168.0.1:/b/tftpboot/FreeBSD/install /mnt</code></strong></pre></li></ol></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-ipv6"></a>31.9. <acronym class="acronym">IPv6</acronym></h2></div><div><span class="authorgroup">Originally Written by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Aaron</span> <span class="surname">Kaplan</span></span>. </span></div><div><span class="authorgroup">Restructured and Added by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div><div><span class="authorgroup">Extended by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Brad</span> <span class="surname">Davis</span></span>. </span></div></div></div><p xml:lang="en" lang="en"><acronym class="acronym">IPv6</acronym> is the new version of the well known
      <acronym class="acronym">IP</acronym> protocol, also known as
      <acronym class="acronym">IPv4</acronym>.  <acronym class="acronym">IPv6</acronym> provides
      several advantages over <acronym class="acronym">IPv4</acronym> as well as many
      new features:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Its 128-bit address space allows for
	  340,282,366,920,938,463,463,374,607,431,768,211,456
	  addresses.  This addresses the <acronym class="acronym">IPv4</acronym>
	  address shortage and eventual <acronym class="acronym">IPv4</acronym>
	  address exhaustion.</p></li><li class="listitem"><p xml:lang="en" lang="en">Routers only store network aggregation addresses in
	  their routing tables, thus reducing the average space of a
	  routing table to 8192 entries.  This addresses the
	  scalability issues associated with <acronym class="acronym">IPv4</acronym>,
	  which required every allocated block of
	  <acronym class="acronym">IPv4</acronym> addresses to be exchanged between
	  Internet routers, causing their routing tables to become too
	  large to allow efficient routing.</p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Address autoconfiguration (<a class="link" href="http://www.ietf.org/rfc/rfc2462.txt" target="_top">RFC2462</a>).</p></li><li class="listitem"><p xml:lang="en" lang="en">Mandatory multicast addresses.</p></li><li class="listitem"><p xml:lang="en" lang="en">Built-in <acronym class="acronym">IPsec</acronym> (<acronym class="acronym">IP</acronym>
	  security).</p></li><li class="listitem"><p xml:lang="en" lang="en">Simplified header structure.</p></li><li class="listitem"><p xml:lang="en" lang="en">Support for mobile <acronym class="acronym">IP</acronym>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><acronym class="acronym">IPv6</acronym>-to-<acronym class="acronym">IPv4</acronym>
	  transition mechanisms.</p></li></ul></div><p xml:lang="en" lang="en">FreeBSD includes the <a class="link" href="http://www.kame.net/" target="_top">http://www.kame.net/</a>
      <acronym class="acronym">IPv6</acronym> reference implementation and comes
      with everything needed to use <acronym class="acronym">IPv6</acronym>.  This
      section focuses on getting <acronym class="acronym">IPv6</acronym> configured
      and running.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89022008"></a>31.9.1. <acronym class="acronym">IPv6</acronym> 位址的背景知識</h3></div></div></div><p xml:lang="en" lang="en">There are three different types of <acronym class="acronym">IPv6</acronym>
	addresses:</p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en">Unicast</span></dt><dd><p xml:lang="en" lang="en">A packet sent to a unicast address arrives at the
	      interface belonging to the address.</p></dd><dt><span xml:lang="en" class="term" lang="en">Anycast</span></dt><dd><p xml:lang="en" lang="en">These addresses are syntactically indistinguishable
	      from unicast addresses but they address a group of
	      interfaces.  The packet destined for an anycast address
	      will arrive at the nearest router interface.  Anycast
	      addresses are only used by routers.</p></dd><dt><span xml:lang="en" class="term" lang="en">Multicast</span></dt><dd><p xml:lang="en" lang="en">These addresses identify a group of interfaces.  A
	      packet destined for a multicast address will arrive at
	      all interfaces belonging to the multicast group.  The
	      <acronym class="acronym">IPv4</acronym> broadcast address, usually
	      <code class="systemitem">xxx.xxx.xxx.255</code>, is
	      expressed by multicast addresses in
	      <acronym class="acronym">IPv6</acronym>.</p></dd></dl></div><p xml:lang="en" lang="en">When reading an <acronym class="acronym">IPv6</acronym> address, the
	canonical form is represented as
	<code class="systemitem">x:x:x:x:x:x:x:x</code>, where each
	<code class="literal">x</code> represents a 16 bit hex value.  An
	example is
	<code class="systemitem">FEBC:A574:382B:23C1:AA49:4592:4EFE:9982</code>.</p><p xml:lang="en" lang="en">Often, an address will have long substrings of all zeros.
	A <code class="literal">::</code> (double colon) can be used to replace
	one substring per address.  Also, up to three leading
	<code class="literal">0</code>s per hex value can be omitted.  For
	example, <code class="systemitem">fe80::1</code> corresponds to the
	canonical form
	<code class="systemitem">fe80:0000:0000:0000:0000:0000:0000:0001</code>.</p><p xml:lang="en" lang="en">A third form is to write the last 32 bits using the well
	known <acronym class="acronym">IPv4</acronym> notation.  For example,
	<code class="systemitem">2002::10.0.0.1</code> corresponds to the
	hexadecimal canonical representation
	<code class="systemitem">2002:0000:0000:0000:0000:0000:0a00:0001</code>,
	which in turn is equivalent to
	<code class="systemitem">2002::a00:1</code>.</p><p xml:lang="en" lang="en">To view a FreeBSD system's <acronym class="acronym">IPv6 </acronym> address,
	use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig</code></strong></pre><pre xml:lang="en" class="programlisting" lang="en">rl0: flags=8943&lt;UP,BROADCAST,RUNNING,PROMISC,SIMPLEX,MULTICAST&gt; mtu 1500
         inet 10.0.0.10 netmask 0xffffff00 broadcast 10.0.0.255
         inet6 fe80::200:21ff:fe03:8e1%rl0 prefixlen 64 scopeid 0x1
         ether 00:00:21:03:08:e1
         media: Ethernet autoselect (100baseTX )
         status: active</pre><p xml:lang="en" lang="en">In this example, the <code class="filename">rl0</code> interface is
	using <code class="systemitem">fe80::200:21ff:fe03:8e1%rl0</code>, an
	auto-configured link-local address which was automatically
	generated from the <acronym class="acronym">MAC</acronym> address.</p><p xml:lang="en" lang="en">Some <acronym class="acronym">IPv6</acronym> addresses are reserved.  A
	summary of these reserved addresses is seen in <a class="xref" href="#reservedip6" title="表格 31.3. 已保留的 IPv6 位址">表格 31.3, “已保留的 <acronym class="acronym">IPv6</acronym> 位址”</a>:</p><div class="table"><a id="reservedip6"></a><div class="table-title">表格 31.3. 已保留的 <acronym class="acronym">IPv6</acronym> 位址</div><div class="table-contents"><table summary="已保留的 IPv6 位址" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th xml:lang="en" lang="en"><acronym class="acronym">IPv6</acronym> address</th><th xml:lang="en" lang="en">Prefixlength (Bits)</th><th>說明</th><th>說明</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><code class="systemitem">::</code></td><td xml:lang="en" lang="en">128 bits</td><td xml:lang="en" lang="en">unspecified</td><td xml:lang="en" lang="en">Equivalent to <code class="systemitem">0.0.0.0</code> in
		<acronym class="acronym">IPv4</acronym>.</td></tr><tr><td xml:lang="en" lang="en"><code class="systemitem">::1</code></td><td xml:lang="en" lang="en">128 bits</td><td xml:lang="en" lang="en">loopback address</td><td xml:lang="en" lang="en">Equivalent to <code class="systemitem">127.0.0.1</code> in
		<acronym class="acronym">IPv4</acronym>.</td></tr><tr><td xml:lang="en" lang="en"><code class="systemitem">::00:xx:xx:xx:xx</code></td><td xml:lang="en" lang="en">96 bits</td><td xml:lang="en" lang="en">embedded <acronym class="acronym">IPv4</acronym></td><td xml:lang="en" lang="en">The lower 32 bits are the compatible
		<acronym class="acronym">IPv4</acronym> address.</td></tr><tr><td xml:lang="en" lang="en"><code class="systemitem">::ff:xx:xx:xx:xx</code></td><td xml:lang="en" lang="en">96 bits</td><td xml:lang="en" lang="en"><acronym class="acronym">IPv4</acronym> mapped
		<acronym class="acronym">IPv6</acronym> address</td><td xml:lang="en" lang="en">The lower 32 bits are the <acronym class="acronym">IPv4</acronym>
		address for hosts which do not support
		<acronym class="acronym">IPv6</acronym>.</td></tr><tr><td xml:lang="en" lang="en"><code class="systemitem">fe80::/10</code></td><td xml:lang="en" lang="en">10 bits</td><td xml:lang="en" lang="en">link-local</td><td xml:lang="en" lang="en">Equivalent to 169.254.0.0/16 in
		<acronym class="acronym">IPv4</acronym>.</td></tr><tr><td xml:lang="en" lang="en"><code class="systemitem">fc00::/7</code></td><td xml:lang="en" lang="en">7 bits</td><td xml:lang="en" lang="en">unique-local</td><td xml:lang="en" lang="en">Unique local addresses are intended for local
		communication and are only routable within a set of
		cooperating sites.</td></tr><tr><td xml:lang="en" lang="en"><code class="systemitem">ff00::</code></td><td xml:lang="en" lang="en">8 bits</td><td xml:lang="en" lang="en">multicast</td><td> </td></tr><tr><td xml:lang="en" lang="en"><code class="systemitem">2000::-3fff:: </code></td><td xml:lang="en" lang="en">3 bits</td><td xml:lang="en" lang="en">global unicast</td><td xml:lang="en" lang="en">All global unicast addresses are assigned from
		this pool.  The first 3 bits are
		<code class="literal">001</code>.</td></tr></tbody></table></div></div><br class="table-break" /><p xml:lang="en" lang="en">For further information on the structure of
	<acronym class="acronym">IPv6</acronym> addresses, refer to <a class="link" href="http://www.ietf.org/rfc/rfc3513.txt" target="_top">RFC3513</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89099448"></a>31.9.2. 設定 <acronym class="acronym">IPv6</acronym></h3></div></div></div><p xml:lang="en" lang="en">To configure a FreeBSD system as an <acronym class="acronym">IPv6</acronym>
	client, add these two lines to
	<code class="filename">rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">ifconfig_<em class="replaceable"><code>rl0</code></em>_ipv6="inet6 accept_rtadv"
rtsold_enable="YES"</pre><p xml:lang="en" lang="en">The first line enables the specified interface to receive
	router advertisement messages.  The second line enables the
	router solicitation daemon, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rtsol&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rtsol</span>(8)</span></a>.</p><p xml:lang="en" lang="en">If the interface needs a statically assigned
	<acronym class="acronym">IPv6</acronym> address, add an entry to specify the
	static address and associated prefix length:</p><pre xml:lang="en" class="programlisting" lang="en">ifconfig_<em class="replaceable"><code>rl0</code></em>_ipv6="inet6 <em class="replaceable"><code>2001:db8:4672:6565:2026:5043:2d42:5344</code></em> prefixlen <em class="replaceable"><code>64</code></em>"</pre><p xml:lang="en" lang="en">To assign a default router, specify its address:</p><pre xml:lang="en" class="programlisting" lang="en">ipv6_defaultrouter="<em class="replaceable"><code>2001:db8:4672:6565::1</code></em>"</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89107896"></a>31.9.3. 連線到 Provider</h3></div></div></div><p xml:lang="en" lang="en">In order to connect to other <acronym class="acronym">IPv6</acronym>
	networks, one must have a provider or a tunnel that supports
	<acronym class="acronym">IPv6</acronym>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Contact an Internet Service Provider to see if they
	    offer <acronym class="acronym">IPv6</acronym>.</p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www.tunnelbroker.net" target="_top">Hurricane
	      Electric</a> offers tunnels with end-points all
	    around the globe.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Install the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/freenet6/pkg-descr">net/freenet6</a> package or
	  port for a dial-up connection.</p></div><p xml:lang="en" lang="en">This section demonstrates how to take the directions from
	a tunnel provider and convert them into
	<code class="filename">/etc/rc.conf</code> settings that will persist
	through reboots.</p><p xml:lang="en" lang="en">The first <code class="filename">/etc/rc.conf</code> entry creates
	the generic tunneling interface
	<code class="filename"><em class="replaceable"><code>gif0</code></em></code>:</p><pre xml:lang="en" class="programlisting" lang="en">cloned_interfaces="gif<em class="replaceable"><code>0</code></em>"</pre><p xml:lang="en" lang="en">Next, configure that interface with the
	<acronym class="acronym">IPv4</acronym> addresses of the local and remote
	endpoints.  Replace <em class="replaceable"><code>MY_IPv4_ADDR</code></em>
	and <em class="replaceable"><code>REMOTE_IPv4_ADDR</code></em> with the
	actual <acronym class="acronym">IPv4</acronym> addresses:</p><pre xml:lang="en" class="programlisting" lang="en">create_args_gif0="tunnel <em class="replaceable"><code>MY_IPv4_ADDR REMOTE_IPv4_ADDR</code></em>"</pre><p xml:lang="en" lang="en">To apply the <acronym class="acronym">IPv6</acronym> address that has been
	assigned for use as the <acronym class="acronym">IPv6</acronym> tunnel
	endpoint, add this line, replacing
	<em class="replaceable"><code>MY_ASSIGNED_IPv6_TUNNEL_ENDPOINT_ADDR</code></em>
	with the assigned address:</p><pre xml:lang="en" class="programlisting" lang="en">ifconfig_gif0_ipv6="inet6 <em class="replaceable"><code>MY_ASSIGNED_IPv6_TUNNEL_ENDPOINT_ADDR</code></em>"</pre><p xml:lang="en" lang="en">Then, set the default route for the other side of the
	<acronym class="acronym">IPv6</acronym> tunnel.  Replace
	<em class="replaceable"><code>MY_IPv6_REMOTE_TUNNEL_ENDPOINT_ADDR</code></em>
	with the default gateway address assigned by the
	provider:</p><pre xml:lang="en" class="programlisting" lang="en">ipv6_defaultrouter="<em class="replaceable"><code>MY_IPv6_REMOTE_TUNNEL_ENDPOINT_ADDR</code></em>"</pre><p xml:lang="en" lang="en">If the FreeBSD system will route <acronym class="acronym">IPv6</acronym>
	packets between the rest of the network and the world, enable
	the gateway using this line:</p><pre xml:lang="en" class="programlisting" lang="en">ipv6_gateway_enable="YES"</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89142840"></a>31.9.4. Router Advertisement 與 Host Auto Configuration</h3></div></div></div><p xml:lang="en" lang="en">This section demonstrates how to setup <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rtadvd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rtadvd</span>(8)</span></a> to
	advertise the <acronym class="acronym">IPv6</acronym> default route.</p><p xml:lang="en" lang="en">To enable <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rtadvd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rtadvd</span>(8)</span></a>, add the following to
	<code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">rtadvd_enable="YES"</pre><p xml:lang="en" lang="en">It is important to specify the interface on which to
	do <acronym class="acronym">IPv6</acronym> router advertisement.  For example,
	to tell <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rtadvd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rtadvd</span>(8)</span></a> to use
	<code class="filename">rl0</code>:</p><pre xml:lang="en" class="programlisting" lang="en">rtadvd_interfaces="rl0"</pre><p xml:lang="en" lang="en">Next, create the configuration file,
	<code class="filename">/etc/rtadvd.conf</code> as seen in this
	example:</p><pre xml:lang="en" class="programlisting" lang="en">rl0:\
	:addrs#1:addr="2001:db8:1f11:246::":prefixlen#64:tc=ether:</pre><p xml:lang="en" lang="en">Replace <code class="filename">rl0</code> with the interface
	to be used and <code class="systemitem">2001:db8:1f11:246::</code>
	with the prefix of the allocation.</p><p xml:lang="en" lang="en">For a dedicated <code class="systemitem">/64</code> subnet, nothing else needs
	to be changed.  Otherwise, change the
	<code class="literal">prefixlen#</code> to the correct value.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89166392"></a>31.9.5. <acronym class="acronym">IPv6</acronym> 與 <acronym class="acronym">IPv6</acronym> 位址對應表</h3></div></div></div><p xml:lang="en" lang="en">When <acronym class="acronym">IPv6</acronym> is enabled on a server, there
	may be a need to enable <acronym class="acronym">IPv4</acronym> mapped
	<acronym class="acronym">IPv6</acronym> address communication.  This
	compatibility option allows for <acronym class="acronym">IPv4</acronym>
	addresses to be represented as <acronym class="acronym">IPv6</acronym>
	addresses.  Permitting <acronym class="acronym">IPv6</acronym> applications
	to communicate with <acronym class="acronym">IPv4</acronym> and vice versa
	may be a security issue.</p><p xml:lang="en" lang="en">This option may not be required in most cases and is
	available only for compatibility.  This option will allow
	<acronym class="acronym">IPv6</acronym>-only applications to work with
	<acronym class="acronym">IPv4</acronym> in a dual stack environment.  This
	is most useful for third party applications which may not
	support an <acronym class="acronym">IPv6</acronym>-only environment.  To
	enable this feature,
	add the following to <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">ipv6_ipv4mapping="YES"</pre><p xml:lang="en" lang="en">Reviewing the information in <acronym class="acronym">RFC</acronym> 3493,
	section 3.6 and 3.7 as well as <acronym class="acronym">RFC</acronym> 4038
	section 4.2 may be useful to some administrators.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="carp"></a>31.10. 共用位址備援協定 (<acronym class="acronym">CARP</acronym>)</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div><div><span class="authorgroup">Updated by <span xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="author" lang="en"><span class="firstname">Allan</span> <span class="surname">Jude</span></span>. </span></div></div></div><a id="idp89210424" class="indexterm"></a><a id="idp89211448" class="indexterm"></a><p xml:lang="en" lang="en">The Common Address Redundancy Protocol
      (<acronym class="acronym">CARP</acronym>) allows multiple hosts to share the
      same <acronym class="acronym">IP</acronym> address and Virtual Host ID
      (<acronym class="acronym">VHID</acronym>) in order to provide <em class="firstterm">high
      availability</em> for one or more services.  This means
      that one or more hosts can fail, and the other hosts will
      transparently take over so that users do not see a service
      failure.</p><p xml:lang="en" lang="en">In addition to the shared <acronym class="acronym">IP</acronym> address,
      each host has its own <acronym class="acronym">IP</acronym> address for
      management and configuration.  All of the machines that share an
      <acronym class="acronym">IP</acronym> address have the same
      <acronym class="acronym">VHID</acronym>.  The <acronym class="acronym">VHID</acronym> for each
      virtual <acronym class="acronym">IP</acronym> address must be unique across the
      broadcast domain of the network interface.</p><p xml:lang="en" lang="en">High availability using <acronym class="acronym">CARP</acronym> is built
      into FreeBSD, though the steps to configure it vary slightly
      depending upon the FreeBSD version.  This section provides the same
      example configuration for versions before and equal to or after
      FreeBSD 10.</p><p xml:lang="en" lang="en">This example configures failover support with three hosts,
      all with unique <acronym class="acronym">IP</acronym> addresses, but providing
      the same web content.  It has two different masters named
      <code class="systemitem">hosta.example.org</code> and
      <code class="systemitem">hostb.example.org</code>, with a shared backup
      named <code class="systemitem">hostc.example.org</code>.</p><p xml:lang="en" lang="en">These machines are load balanced with a Round Robin
      <acronym class="acronym">DNS</acronym> configuration.  The master and backup
      machines are configured identically except for their hostnames
      and management <acronym class="acronym">IP</acronym> addresses.  These servers
      must have the same configuration and run the same services.
      When the failover occurs, requests to the service on the shared
      <acronym class="acronym">IP</acronym> address can only be answered correctly if
      the backup server has access to the same content.  The backup
      machine has two additional <acronym class="acronym">CARP</acronym> interfaces,
      one for each of the master content server's
      <acronym class="acronym">IP</acronym> addresses.  When a failure occurs, the
      backup server will pick up the failed master machine's
      <acronym class="acronym">IP</acronym> address.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="carp-10x"></a>31.10.1. 使用 <acronym class="acronym">CARP</acronym> 於 FreeBSD 10 及之後版本</h3></div></div></div><p xml:lang="en" lang="en">Enable boot-time support for <acronym class="acronym">CARP</acronym> by
	adding an entry for the <code class="filename">carp.ko</code> kernel
	module in <code class="filename">/boot/loader.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">carp_load="YES"</pre><p xml:lang="en" lang="en">To load the module now without rebooting:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload carp</code></strong></pre><p xml:lang="en" lang="en">For users who prefer to use a custom kernel, include the
	following line in the custom kernel configuration file and
	compile the kernel as described in <a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a>:</p><pre xml:lang="en" class="programlisting" lang="en">device	carp</pre><p xml:lang="en" lang="en">The hostname, management <acronym class="acronym">IP</acronym> address and
	subnet mask, shared <acronym class="acronym">IP</acronym> address, and
	<acronym class="acronym">VHID</acronym> are all set by adding entries to
	<code class="filename">/etc/rc.conf</code>.  This example is for
	<code class="systemitem">hosta.example.org</code>:</p><pre xml:lang="en" class="programlisting" lang="en">hostname="<em class="replaceable"><code>hosta.example.org</code></em>"
ifconfig_<em class="replaceable"><code>em0</code></em>="inet <em class="replaceable"><code>192.168.1.3</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em>"
ifconfig_<em class="replaceable"><code>em0</code></em>_alias0="inet vhid <em class="replaceable"><code>1</code></em> pass <em class="replaceable"><code>testpass</code></em> alias <em class="replaceable"><code>192.168.1.50</code></em>/32"</pre><p xml:lang="en" lang="en">The next set of entries are for
	<code class="systemitem">hostb.example.org</code>.  Since it
	represents a second master, it uses a different shared
	<acronym class="acronym">IP</acronym> address and <acronym class="acronym">VHID</acronym>.
	However, the passwords specified with <code class="option">pass</code>
	must be identical as <acronym class="acronym">CARP</acronym> will only listen
	to and accept advertisements from machines with the correct
	password.</p><pre xml:lang="en" class="programlisting" lang="en">hostname="<em class="replaceable"><code>hostb.example.org</code></em>"
ifconfig_<em class="replaceable"><code>em0</code></em>="inet <em class="replaceable"><code>192.168.1.4</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em>"
ifconfig_<em class="replaceable"><code>em0</code></em>_alias0="inet vhid <em class="replaceable"><code>2</code></em> pass <em class="replaceable"><code>testpass</code></em> alias <em class="replaceable"><code>192.168.1.51</code></em>/32"</pre><p xml:lang="en" lang="en">The third machine,
	<code class="systemitem">hostc.example.org</code>, is configured to
	handle failover from either master.  This machine is
	configured with two <acronym class="acronym">CARP</acronym>
	<acronym class="acronym">VHID</acronym>s, one to handle the virtual
	<acronym class="acronym">IP</acronym> address for each of the master hosts.
	The <acronym class="acronym">CARP</acronym> advertising skew,
	<code class="option">advskew</code>, is set to ensure that the backup
	host advertises later than the master, since
	<code class="option">advskew</code> controls the order of precedence when
	there are multiple backup servers.</p><pre xml:lang="en" class="programlisting" lang="en">hostname="hostc.example.org"
ifconfig_<em class="replaceable"><code>em0</code></em>="inet <em class="replaceable"><code>192.168.1.5</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em>"
ifconfig_<em class="replaceable"><code>em0</code></em>_alias0="inet vhid <em class="replaceable"><code>1</code></em> advskew <em class="replaceable"><code>100</code></em> pass <em class="replaceable"><code>testpass</code></em> alias <em class="replaceable"><code>192.168.1.50</code></em>/32"
ifconfig_<em class="replaceable"><code>em0</code></em>_alias1="inet vhid <em class="replaceable"><code>2</code></em> advskew <em class="replaceable"><code>100</code></em> pass <em class="replaceable"><code>testpass</code></em> alias <em class="replaceable"><code>192.168.1.51</code></em>/32"</pre><p xml:lang="en" lang="en">Having two <acronym class="acronym">CARP</acronym>
	<acronym class="acronym">VHID</acronym>s configured means that
	<code class="systemitem">hostc.example.org</code> will notice if
	either of the master servers becomes unavailable.  If a master
	fails to advertise before the backup server, the backup server
	will pick up the shared <acronym class="acronym">IP</acronym> address until
	the master becomes available again.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">If the original master server becomes available again,
	  <code class="systemitem">hostc.example.org</code>  will not release
	  the virtual <acronym class="acronym">IP</acronym> address back to it
	  automatically.  For this to happen, preemption has to be
	  enabled.  The feature is disabled by default,
	  it is controlled via the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variable
	  <code class="varname">net.inet.carp.preempt</code>.  The administrator
	  can force the backup server to return the
	  <acronym class="acronym">IP</acronym> address to the master:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig em0 vhid 1 state backup</code></strong></pre></div><p xml:lang="en" lang="en">Once the configuration is complete, either restart
	networking or reboot each system.  High availability is now
	enabled.</p><p xml:lang="en" lang="en"><acronym class="acronym">CARP</acronym> functionality can be controlled
	via several <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variables documented in the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=carp&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">carp</span>(4)</span></a> manual pages.  Other actions can be triggered
	from <acronym class="acronym">CARP</acronym> events by using
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="carp-9x"></a>31.10.2. 使用 <acronym class="acronym">CARP</acronym> 於 FreeBSD 9 及先前版本</h3></div></div></div><p xml:lang="en" lang="en">The configuration for these versions of FreeBSD is similar to
	the one described in the previous section, except that a
	<acronym class="acronym">CARP</acronym> device must first be created and
	referred to in the configuration.</p><p xml:lang="en" lang="en">Enable boot-time support for <acronym class="acronym">CARP</acronym> by
	loading the <code class="filename">if_carp.ko</code> kernel module in
	<code class="filename">/boot/loader.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">if_carp_load="YES"</pre><p xml:lang="en" lang="en">To load the module now without rebooting:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>kldload carp</code></strong></pre><p xml:lang="en" lang="en">For users who prefer to use a custom kernel, include the
	following line in the custom kernel configuration file and
	compile the kernel as described in <a class="xref" href="#kernelconfig" title="章 8. 設定 FreeBSD 核心">章 8, <em>設定 FreeBSD 核心</em></a>:</p><pre xml:lang="en" class="programlisting" lang="en">device	carp</pre><p xml:lang="en" lang="en">Next, on each host, create a <acronym class="acronym">CARP</acronym>
	device:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig carp0 create</code></strong></pre><p xml:lang="en" lang="en">Set the hostname, management <acronym class="acronym">IP</acronym>
	address, the shared <acronym class="acronym">IP</acronym> address, and
	<acronym class="acronym">VHID</acronym> by adding the required lines to
	<code class="filename">/etc/rc.conf</code>.  Since a virtual
	<acronym class="acronym">CARP</acronym> device is used instead of an alias,
	the actual subnet mask of <code class="literal">/24</code> is used
	instead of <code class="literal">/32</code>.  Here are the entries for
	<code class="systemitem">hosta.example.org</code>:</p><pre xml:lang="en" class="programlisting" lang="en">hostname="<em class="replaceable"><code>hosta.example.org</code></em>"
ifconfig_<em class="replaceable"><code>fxp0</code></em>="inet <em class="replaceable"><code>192.168.1.3</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em>"
cloned_interfaces="carp0"
ifconfig_carp0="vhid <em class="replaceable"><code>1</code></em> pass <em class="replaceable"><code>testpass</code></em> <em class="replaceable"><code>192.168.1.50/24</code></em>"</pre><p xml:lang="en" lang="en">On <code class="systemitem">hostb.example.org</code>:</p><pre xml:lang="en" class="programlisting" lang="en">hostname="<em class="replaceable"><code>hostb.example.org</code></em>"
ifconfig_<em class="replaceable"><code>fxp0</code></em>="inet <em class="replaceable"><code>192.168.1.4</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em>"
cloned_interfaces="carp0"
ifconfig_carp0="vhid <em class="replaceable"><code>2</code></em> pass <em class="replaceable"><code>testpass</code></em> <em class="replaceable"><code>192.168.1.51/24</code></em>"</pre><p xml:lang="en" lang="en">The third machine,
	<code class="systemitem">hostc.example.org</code>, is configured to
	handle failover from either of the master hosts:</p><pre xml:lang="en" class="programlisting" lang="en">hostname="<em class="replaceable"><code>hostc.example.org</code></em>"
ifconfig_<em class="replaceable"><code>fxp0</code></em>="inet <em class="replaceable"><code>192.168.1.5</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em>"
cloned_interfaces="carp0 carp1"
ifconfig_carp0="vhid <em class="replaceable"><code>1</code></em> advskew <em class="replaceable"><code>100</code></em> pass <em class="replaceable"><code>testpass</code></em> <em class="replaceable"><code>192.168.1.50/24</code></em>"
ifconfig_carp1="vhid <em class="replaceable"><code>2</code></em> advskew <em class="replaceable"><code>100</code></em> pass <em class="replaceable"><code>testpass</code></em> <em class="replaceable"><code>192.168.1.51/24</code></em>"</pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Preemption is disabled in the
	  <code class="filename">GENERIC</code> FreeBSD kernel.  If
	  preemption has been enabled with a custom kernel,
	  <code class="systemitem">hostc.example.org</code> may not release
	  the <acronym class="acronym">IP</acronym> address back to the original
	  content server.  The administrator can force the backup
	  server to return the <acronym class="acronym">IP</acronym> address to the
	  master with the command:</p><pre xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig carp0 down &amp;&amp; ifconfig carp0 up</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">This should be done on the <code class="filename">carp</code>
	  interface which corresponds to the correct host.</p></div><p xml:lang="en" lang="en">Once the configuration is complete, either restart
	networking or reboot each system.  High availability is now
	enabled.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-vlan"></a>31.11. VLANs</h2></div></div></div><a id="idp88842680" class="indexterm"></a><a id="idp88843704" class="indexterm"></a><p xml:lang="en" lang="en"><acronym class="acronym">VLANs</acronym> are a way of virtually dividing up
      a network into many different subnetworks, also referred
      to as segmenting.  Each segment will have its
      own broadcast domain and be isolated from other
      <acronym class="acronym">VLANs</acronym>.</p><p>在 FreeBSD 上，要使用 <acronym class="acronym">VLANs</acronym> 必須有網路卡驅動程式的支援，要查看那些驅動程式支援 vlan，請參考 <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vlan&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vlan</span>(4)</span></a> 操作手冊。</p><p xml:lang="en" lang="en">When configuring a <acronym class="acronym">VLAN</acronym>, a couple pieces
      of information must be known.  First, which network interface?
      Second, what is the <acronym class="acronym">VLAN</acronym> tag?</p><p xml:lang="en" lang="en">To configure <acronym class="acronym">VLANs</acronym> at run time, with a
      <acronym class="acronym">NIC</acronym> of <code class="literal">em0</code> and a
      <acronym class="acronym">VLAN</acronym> tag of <code class="systemitem">5</code> the
      command would look like this:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>em0.5</code></em> create vlan <em class="replaceable"><code>5</code></em> vlandev <em class="replaceable"><code>em0</code></em> inet 192.168.20.20/24</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">See how the interface name includes the
	<acronym class="acronym">NIC</acronym> driver name and the
	<acronym class="acronym">VLAN</acronym> tag, separated by a period?  This is a
	best practice to make maintaining the <acronym class="acronym">VLAN</acronym>
	configuration easy when many <acronym class="acronym">VLANs</acronym> are
	present on a machine.</p></div><p xml:lang="en" lang="en">To configure <acronym class="acronym">VLANs</acronym> at boot time,
      <code class="filename">/etc/rc.conf</code> must be updated.  To duplicate
      the configuration above, the following will need to be
      added:</p><pre xml:lang="en" class="programlisting" lang="en">vlans_<em class="replaceable"><code>em0</code></em>="<em class="replaceable"><code>5</code></em>"
ifconfig_<em class="replaceable"><code>em0</code></em>_<em class="replaceable"><code>5</code></em>="inet 192.168.20.20/24"</pre><p xml:lang="en" lang="en">Additional <acronym class="acronym">VLANs</acronym> may be added, by simply
      adding the tag to the
      <code class="literal">vlans_<em class="replaceable"><code>em0</code></em></code>
      field and adding an additional line configuring the network on
      that <acronym class="acronym">VLAN</acronym> tag's interface.</p><p xml:lang="en" lang="en">It is useful to assign a symbolic name to an interface so
      that when the associated hardware is changed, only a few
      configuration variables need to be updated.  For example,
      security cameras need to be run over VLAN 1 on
      <code class="literal">em0</code>.  Later, if the <code class="literal">em0</code>
      card is replaced with a card that uses the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ixgb&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ixgb</span>(4)</span></a> driver,
      all references to <code class="literal">em0.1</code> will not have to
      change to <code class="literal">ixgb0.1</code>.</p><p xml:lang="en" lang="en">To configure <acronym class="acronym">VLAN</acronym>
      <code class="systemitem">5</code>, on the
      <acronym class="acronym">NIC</acronym> <code class="literal">em0</code>, assign the
      interface name <code class="literal">cameras</code>, and assign the
      interface an IP address of <code class="systemitem"><em class="replaceable"><code>192.168.20.20</code></em></code>
      with a <code class="systemitem">24</code>-bit prefix,
      use this command:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>em0.5</code></em> create vlan <em class="replaceable"><code>5</code></em> vlandev <em class="replaceable"><code>em0</code></em> name <em class="replaceable"><code>cameras</code></em> inet <em class="replaceable"><code>192.168.20.20/24</code></em></code></strong></pre><p xml:lang="en" lang="en">For an interface named <code class="literal">video</code>, use the
    following:</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>video.5</code></em> create vlan <em class="replaceable"><code>5</code></em> vlandev <em class="replaceable"><code>video</code></em> name <em class="replaceable"><code>cameras inet 192.168.20.20/24</code></em></code></strong></pre><p xml:lang="en" lang="en">To apply the changes at boot time, add the following lines to
  <code class="filename">/etc/rc.conf</code>:</p><pre xml:lang="en" class="programlisting" lang="en">vlans_<em class="replaceable"><code>video</code></em>="<em class="replaceable"><code>camera</code></em>"
create_args_<em class="replaceable"><code>camera</code></em>="vlan <em class="replaceable"><code>5</code></em>"
ifconfig_<em class="replaceable"><code>camera</code></em>="inet <em class="replaceable"><code>192.168.20.20/24</code></em>"</pre></div></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="appendices"></a>部 V. 附錄</h1></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="appendix"><a href="#mirrors">A. 取得 FreeBSD</a></span></dt><dd><dl><dt><span class="sect1"><a href="#mirrors-cdrom">A.1. <acronym class="acronym">CD</acronym> 與 <acronym class="acronym">DVD</acronym> 合集</a></span></dt><dt><span class="sect1"><a href="#mirrors-ftp">A.2. <acronym class="acronym">FTP</acronym> 站</a></span></dt><dt><span class="sect1"><a href="#svn">A.3. 使用 <span class="application">Subversion</span></a></span></dt><dd><dl><dt><span class="sect2"><a href="#svn-intro">A.3.1. 簡介</a></span></dt><dt><span class="sect2"><a href="#svn-ssl-certificates">A.3.2. 根 <acronym class="acronym">SSL</acronym> 憑證</a></span></dt><dt><span class="sect2"><a href="#svn-svnlite">A.3.3. <span class="application">Svnlite</span></a></span></dt><dt><span class="sect2"><a href="#svn-install">A.3.4. 安裝</a></span></dt><dt><span class="sect2"><a href="#svn-usage">A.3.5. 執行 <span class="application">Subversion</span></a></span></dt><dt><span class="sect2"><a href="#svn-mirrors">A.3.6. <span class="application">Subversion</span> 鏡像站</a></span></dt><dt><span class="sect2"><a href="#idp89943864">A.3.7. 取得更多資訊</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mirrors-rsync">A.4. 使用 <span class="application">rsync</span></a></span></dt></dl></dd><dt><span class="appendix"><a href="#bibliography">B. 參考書目</a></span></dt><dd><dl><dt><span class="sect1"><a href="#bibliography-freebsd">B.1. FreeBSD 相關書籍</a></span></dt><dt><span class="sect1"><a href="#bibliography-userguides">B.2. 使用指南</a></span></dt><dt><span class="sect1"><a href="#bibliography-adminguides">B.3. 管理指南</a></span></dt><dt><span class="sect1"><a href="#bibliography-programmers">B.4. 開發指南</a></span></dt><dt><span class="sect1"><a href="#bibliography-osinternals">B.5. 深入作業系統</a></span></dt><dt><span class="sect1"><a href="#bibliography-security">B.6. 安全性參考文獻</a></span></dt><dt><span class="sect1"><a href="#bibliography-hardware">B.7. 硬體參考文獻</a></span></dt><dt><span class="sect1"><a href="#bibliography-history">B.8. <span class="trademark">UNIX</span>® 歷史</a></span></dt><dt><span class="sect1"><a href="#bibliography-journals">B.9. 期刊與雜誌</a></span></dt></dl></dd><dt><span class="appendix"><a href="#eresources">C. 網路資源</a></span></dt><dd><dl><dt><span class="sect1"><a href="#eresources-www">C.1. 網站</a></span></dt><dt><span class="sect1"><a href="#eresources-mail">C.2. 郵遞論壇 (Mailing List)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#eresources-summary">C.2.1. 論壇摘要</a></span></dt><dt><span class="sect2"><a href="#eresources-subscribe">C.2.2. 如何訂閱</a></span></dt><dt><span class="sect2"><a href="#eresources-charters">C.2.3. 論壇章程</a></span></dt><dt><span class="sect2"><a href="#eresources-mailfiltering">C.2.4. 郵遞論壇過濾項目</a></span></dt></dl></dd><dt><span class="sect1"><a href="#eresources-news">C.3. Usenet 新聞群組</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp91154232">C.3.1. BSD 專屬新聞群組</a></span></dt><dt><span class="sect2"><a href="#idp91164344">C.3.2. 其他相關的 <span class="trademark">UNIX</span>® 新聞群組</a></span></dt><dt><span class="sect2"><a href="#idp91174072">C.3.3. X 視窗系統</a></span></dt></dl></dd><dt><span class="sect1"><a href="#eresources-web">C.4. 官方鏡像站</a></span></dt></dl></dd><dt><span class="appendix"><a href="#pgpkeys">D. Open<acronym class="acronym">PGP</acronym> 金鑰</a></span></dt><dd><dl><dt><span class="sect1"><a href="#pgpkeys-officers">D.1. 人員</a></span></dt><dd><dl><dt><span class="sect2"><a href="#pgpkey-security-officer">D.1.1. Security Officer Team <code class="email">&lt;<a xmlns="" class="email" href="mailto:security-officer@FreeBSD.org">security-officer@FreeBSD.org</a>&gt;</code></a></span></dt><dt><span class="sect2"><a href="#pgpkey-secteam-secretary">D.1.2. Security Team Secretary <code class="email">&lt;<a xmlns="" class="email" href="mailto:secteam-secretary@FreeBSD.org">secteam-secretary@FreeBSD.org</a>&gt;</code></a></span></dt><dt><span class="sect2"><a href="#pgpkey-core-secretary">D.1.3. Core Team Secretary <code class="email">&lt;<a xmlns="" class="email" href="mailto:core-secretary@FreeBSD.org">core-secretary@FreeBSD.org</a>&gt;</code></a></span></dt><dt><span class="sect2"><a href="#pgpkey-portmgr-secretary">D.1.4. Ports Management Team Secretary <code class="email">&lt;<a xmlns="" class="email" href="mailto:portmgr-secretary@FreeBSD.org">portmgr-secretary@FreeBSD.org</a>&gt;</code></a></span></dt><dt><span class="sect2"><a href="#pgpkey-doceng-secretary">D.1.5. <code class="email">&lt;<a xmlns="" class="email" href="mailto:doceng-secretary@FreeBSD.org">doceng-secretary@FreeBSD.org</a>&gt;</code></a></span></dt></dl></dd></dl></dd></dl></div><div class="appendix"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirrors"></a>附錄 A. 取得 FreeBSD</h2></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#mirrors-cdrom">A.1. <acronym class="acronym">CD</acronym> 與 <acronym class="acronym">DVD</acronym> 合集</a></span></dt><dt><span class="sect1"><a href="#mirrors-ftp">A.2. <acronym class="acronym">FTP</acronym> 站</a></span></dt><dt><span class="sect1"><a href="#svn">A.3. 使用 <span class="application">Subversion</span></a></span></dt><dd><dl><dt><span class="sect2"><a href="#svn-intro">A.3.1. 簡介</a></span></dt><dt><span class="sect2"><a href="#svn-ssl-certificates">A.3.2. 根 <acronym class="acronym">SSL</acronym> 憑證</a></span></dt><dt><span class="sect2"><a href="#svn-svnlite">A.3.3. <span class="application">Svnlite</span></a></span></dt><dt><span class="sect2"><a href="#svn-install">A.3.4. 安裝</a></span></dt><dt><span class="sect2"><a href="#svn-usage">A.3.5. 執行 <span class="application">Subversion</span></a></span></dt><dt><span class="sect2"><a href="#svn-mirrors">A.3.6. <span class="application">Subversion</span> 鏡像站</a></span></dt><dt><span class="sect2"><a href="#idp89943864">A.3.7. 取得更多資訊</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mirrors-rsync">A.4. 使用 <span class="application">rsync</span></a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mirrors-cdrom"></a>A.1. <acronym class="acronym">CD</acronym> 與 <acronym class="acronym">DVD</acronym> 合集</h2></div></div></div><p>FreeBSD <acronym class="acronym">CD</acronym> 以及 <acronym class="acronym">DVD</acronym> 組可從以下幾個線上零售商取得：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><div xml:lang="en" class="address" lang="en"><p>FreeBSD Mall, Inc.<br />
	  <span class="street">2420 Sand Creek Rd C-1 #347</span><br />
	  <span class="city">Brentwood</span>, <span class="state">CA</span><br />
	  <span class="postcode">94513</span><br />
	  <span class="country">USA</span><br />
	  Phone: <span class="phone">+1 925 240-6652</span><br />
	  Fax: <span class="fax">+1 925 674-0821</span><br />
	  Email: <code class="email">&lt;<a xmlns="" class="email" href="mailto:info@freebsdmall.com">info@freebsdmall.com</a>&gt;</code><br />
	  WWW: <span class="otheraddr"><a class="otheraddr" href="https://www.freebsdmall.com" target="_top">https://www.freebsdmall.com</a></span><br />
	</p></div></li><li class="listitem"><div xml:lang="en" class="address" lang="en"><p>Getlinux<br />
	  <span class="street">78 Rue de la Croix Rochopt</span><br />
	  <span class="city">Épinay-sous-Sénart</span><br />
	  <span class="postcode">91860</span><br />
	  <span class="country">France</span><br />
	  Email: <code class="email">&lt;<a xmlns="" class="email" href="mailto:contact@getlinux.fr">contact@getlinux.fr</a>&gt;</code><br />
	  WWW: <span class="otheraddr"><a class="otheraddr" href="http://www.getlinux.fr" target="_top">http://www.getlinux.fr/</a></span><br />
	</p></div></li><li class="listitem"><div xml:lang="en" class="address" lang="en"><p>Dr. Hinner EDV<br />
	  <span class="street">Kochelseestr. 11</span><br />
	  <span class="postcode">D-81371</span> <span class="city">München</span><br />
	  <span class="country">Germany</span><br />
	  Phone: <span class="phone">(0177) 428 419 0</span><br />
	  Email: <code class="email">&lt;<a xmlns="" class="email" href="mailto:infow@hinner.de">infow@hinner.de</a>&gt;</code><br />
	  WWW: <span class="otheraddr"><a class="otheraddr" href="http://www.hinner.de/linux/freebsd.html" target="_top">http://www.hinner.de/linux/freebsd.html</a></span><br />
	</p></div></li><li class="listitem"><div xml:lang="en" class="address" lang="en"><p>Linux Center<br />
	  <span class="street">Galernaya Street, 55</span><br />
	  <span class="city">Saint-Petersburg</span><br />
	  <span class="postcode">190000</span><br />
	  <span class="country">Russia</span><br />
	  Phone: <span class="phone">+7-812-309-06-86</span><br />
	  Email: <code class="email">&lt;<a xmlns="" class="email" href="mailto:info@linuxcenter.ru">info@linuxcenter.ru</a>&gt;</code><br />
	  WWW: <span class="otheraddr"><a class="otheraddr" href="http://linuxcenter.ru/shop/freebsd" target="_top">http://linuxcenter.ru/shop/freebsd</a></span><br />
	</p></div></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mirrors-ftp"></a>A.2. <acronym class="acronym">FTP</acronym> 站</h2></div></div></div><p>FreeBSD 的官方原始碼可從全球任一鏡像站透過匿名 <acronym class="acronym">FTP</acronym> 取得。其中 <code class="uri"><a class="uri" href="ftp://ftp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.FreeBSD.org/pub/FreeBSD/</a></code> 站可使用 <acronym class="acronym">HTTP</acronym> 及 <acronym class="acronym">FTP</acronym>，該站是由多台由計畫叢集管理員所維護的主機所組成，且在 GeoDNS 之後，可導向使用者到最近可用的鏡像站。</p><p>除此之外，FreeBSD 也可透過匿名 <acronym class="acronym">FTP</acronym> 從下列鏡像站取得。要透過匿名 <acronym class="acronym">FTP</acronym> 取得 FreeBSD 時，請先嘗試使用臨近的站台。列在 <span class="quote">“<span class="quote">主要鏡像站</span>”</span> 中的鏡像站通常會有完整的 FreeBSD 封存檔 (每一個架構目前所有可用的版本)，但若要考慮下載速度，可能要使用您所在國家或區域的站台。區域的站台會有熱門架構最近期的版本，但不會有完整的 FreeBSD 封存檔。所有站台皆提供匿名 <acronym class="acronym">FTP</acronym> 存取只有部份站台會以其他方式提供存取。每個站台可用的存取方式會列在主機名稱後的括號當中。</p><p><a class="link" href="#central-ftp">中央伺服器</a>、<a class="link" href="#mirrors-primary-ftp">主要鏡像站</a>、<a class="link" href="#mirrors-am-ftp">亞美尼亞 (Armenia)</a>、<a class="link" href="#mirrors-au-ftp">澳洲 (Australia)</a>、<a class="link" href="#mirrors-at-ftp">奧地利 (Austria)</a>、<a class="link" href="#mirrors-br-ftp">巴西 (Brazil)</a>、<a class="link" href="#mirrors-cz-ftp">捷克 (Czech Republic)</a>、<a class="link" href="#mirrors-dk-ftp">丹麥 (Denmark)</a>、<a class="link" href="#mirrors-ee-ftp">愛沙尼亞 (Estonia)</a>、<a class="link" href="#mirrors-fi-ftp">芬蘭 (Finland)</a>、<a class="link" href="#mirrors-fr-ftp">法國 (France)</a>、<a class="link" href="#mirrors-de-ftp">德國 (Germany)</a>、<a class="link" href="#mirrors-gr-ftp">希臘 (Greece)</a>、<a class="link" href="#mirrors-hk-ftp">香港 (Hong Kong)</a>、<a class="link" href="#mirrors-ie-ftp">愛爾蘭 (Ireland)</a>、<a class="link" href="#mirrors-jp-ftp">日本 (Japan)</a>、<a class="link" href="#mirrors-kr-ftp">韓國 (Korea)</a>、<a class="link" href="#mirrors-lv-ftp">拉脫維亞 (Latvia)</a>、<a class="link" href="#mirrors-lt-ftp">立陶宛 (Lithuania)</a>、<a class="link" href="#mirrors-nl-ftp">荷蘭 (Netherlands)</a>、<a class="link" href="#mirrors-nz-ftp">紐西蘭 (New Zealand)</a>、<a class="link" href="#mirrors-no-ftp">挪威 (Norway)</a>、<a class="link" href="#mirrors-pl-ftp">波蘭 (Poland)</a>、<a class="link" href="#mirrors-ru-ftp">俄羅斯 (Russia)</a>、<a class="link" href="#mirrors-sa-ftp">沙烏地阿拉伯 (Saudi Arabia)</a>、<a class="link" href="#mirrors-si-ftp">斯洛維尼亞 (Slovenia)</a>、<a class="link" href="#mirrors-za-ftp">南非 (South Africa)</a>、<a class="link" href="#mirrors-es-ftp">西班牙 (Spain)</a>、<a class="link" href="#mirrors-se-ftp">瑞典 (Sweden)</a>、<a class="link" href="#mirrors-ch-ftp">瑞士 (Switzerland)</a>、<a class="link" href="#mirrors-tw-ftp">台灣 (Taiwan)</a>、<a class="link" href="#mirrors-ua-ftp">烏克蘭 (Ukraine)</a>、<a class="link" href="#mirrors-uk-ftp">英國 (United Kingdom)</a>、<a class="link" href="#mirrors-us-ftp">美國 (USA)</a>。</p><p xml:lang="en" lang="en">(as of   UTC)</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><a id="central-ftp"></a>中央伺服器</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.FreeBSD.org/pub/FreeBSD/</a> (ftp / ftpv6 / <a class="link" href="http://ftp.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-primary-ftp"></a>主要鏡像站</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:mirror-admin@FreeBSD.org">mirror-admin@FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp1.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp1.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp2.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp3.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp4.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.FreeBSD.org/pub/FreeBSD/</a> (ftp / ftpv6 / <a class="link" href="http://ftp4.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp4.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp4.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp4.FreeBSD.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp5.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp5.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp6.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp6.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp7.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp7.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp10.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp10.FreeBSD.org/pub/FreeBSD/</a> (ftp / ftpv6 / <a class="link" href="http://ftp10.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp10.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp10.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp10.FreeBSD.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp11.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp11.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp13.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp13.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp14.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp14.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp14.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp14.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-am-ftp"></a>亞美尼亞 (Armenia)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@am.FreeBSD.org">hostmaster@am.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp1.am.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp1.am.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp1.am.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp1.am.FreeBSD.org/pub/FreeBSD/</a> / rsync) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-au-ftp"></a>澳洲 (Australia)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@au.FreeBSD.org">hostmaster@au.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.au.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.au.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp2.au.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.au.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp3.au.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.au.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-at-ftp"></a>奧地利 (Austria)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@at.FreeBSD.org">hostmaster@at.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.at.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.at.FreeBSD.org/pub/FreeBSD/</a> (ftp / ftpv6 / <a class="link" href="http://ftp.at.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.at.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp.at.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.at.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-br-ftp"></a>巴西 (Brazil)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@br.FreeBSD.org">hostmaster@br.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp2.br.FreeBSD.org/FreeBSD/" target="_top">ftp://ftp2.br.FreeBSD.org/FreeBSD/</a> (ftp / <a class="link" href="http://ftp2.br.FreeBSD.org/" target="_top">http://ftp2.br.FreeBSD.org/</a>) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp3.br.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.br.FreeBSD.org/pub/FreeBSD/</a> (ftp / rsync) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp4.br.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.br.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-cz-ftp"></a>捷克 (Czech Republic)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@cz.FreeBSD.org">hostmaster@cz.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.cz.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.cz.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="ftp://ftp.cz.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.cz.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp.cz.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.cz.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp.cz.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.cz.FreeBSD.org/pub/FreeBSD/</a> / rsync / rsyncv6) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp2.cz.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.cz.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp2.cz.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp2.cz.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-dk-ftp"></a>丹麥 (Denmark)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@dk.FreeBSD.org">hostmaster@dk.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.dk.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.dk.FreeBSD.org/pub/FreeBSD/</a> (ftp / ftpv6 / <a class="link" href="http://ftp.dk.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.dk.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp.dk.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.dk.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-ee-ftp"></a>愛沙尼亞 (Estonia)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@ee.FreeBSD.org">hostmaster@ee.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.ee.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.ee.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-fi-ftp"></a>芬蘭 (Finland)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@fi.FreeBSD.org">hostmaster@fi.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.fi.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.fi.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-fr-ftp"></a>法國 (France)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@fr.FreeBSD.org">hostmaster@fr.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.fr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp1.fr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp1.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp1.fr.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp1.fr.FreeBSD.org/pub/FreeBSD/</a> / rsync) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp3.fr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp5.fr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp5.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp6.fr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp6.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp / rsync) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp7.fr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp7.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp8.fr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp8.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-de-ftp"></a>德國 (Germany)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@de.FreeBSD.org">hostmaster@de.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.de.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.de.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp1.de.FreeBSD.org/freebsd/" target="_top">ftp://ftp1.de.FreeBSD.org/freebsd/</a> (ftp / <a class="link" href="http://www1.de.FreeBSD.org/freebsd/" target="_top">http://www1.de.FreeBSD.org/freebsd/</a> / <a class="link" href="rsync://rsync3.de.FreeBSD.org/freebsd/" target="_top">rsync://rsync3.de.FreeBSD.org/freebsd/</a>) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp2.de.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.de.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp2.de.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp2.de.FreeBSD.org/pub/FreeBSD/</a> / rsync) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp4.de.FreeBSD.org/FreeBSD/" target="_top">ftp://ftp4.de.FreeBSD.org/FreeBSD/</a> (ftp / <a class="link" href="http://ftp4.de.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp4.de.FreeBSD.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp5.de.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp5.de.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp7.de.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp7.de.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp7.de.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp7.de.FreeBSD.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp8.de.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp8.de.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-gr-ftp"></a>希臘 (Greece)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@gr.FreeBSD.org">hostmaster@gr.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.gr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.gr.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp2.gr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.gr.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-hk-ftp"></a>香港 (Hong Kong)</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.hk.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.hk.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-ie-ftp"></a>愛爾蘭 (Ireland)</span></dt><dd><p xml:lang="en" lang="en">In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@ie.FreeBSD.org">hostmaster@ie.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp3.ie.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.ie.FreeBSD.org/pub/FreeBSD/</a> (ftp / rsync) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-jp-ftp"></a>日本 (Japan)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@jp.FreeBSD.org">hostmaster@jp.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.jp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp2.jp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp3.jp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp4.jp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp5.jp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp5.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp6.jp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp6.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp7.jp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp7.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp8.jp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp8.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp9.jp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp9.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-kr-ftp"></a>韓國 (Korea)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@kr.FreeBSD.org">hostmaster@kr.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.kr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.kr.FreeBSD.org/pub/FreeBSD/</a> (ftp / rsync) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp2.kr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.kr.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp2.kr.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp2.kr.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-lv-ftp"></a>拉脫維亞 (Latvia)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@lv.FreeBSD.org">hostmaster@lv.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.lv.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.lv.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp.lv.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.lv.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-lt-ftp"></a>立陶宛 (Lithuania)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@lt.FreeBSD.org">hostmaster@lt.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.lt.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.lt.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp.lt.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.lt.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-nl-ftp"></a>荷蘭 (Netherlands)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@nl.FreeBSD.org">hostmaster@nl.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.nl.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.nl.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp.nl.FreeBSD.org/os/FreeBSD/" target="_top">http://ftp.nl.FreeBSD.org/os/FreeBSD/</a> / rsync) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp2.nl.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.nl.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-nz-ftp"></a>紐西蘭 (New Zealand)</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.nz.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.nz.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp.nz.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.nz.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-no-ftp"></a>挪威 (Norway)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@no.FreeBSD.org">hostmaster@no.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.no.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.no.FreeBSD.org/pub/FreeBSD/</a> (ftp / rsync) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-pl-ftp"></a>波蘭 (Poland)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@pl.FreeBSD.org">hostmaster@pl.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.pl.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.pl.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en">ftp2.pl.FreeBSD.org</p></li></ul></div></dd><dt><span class="term"><a id="mirrors-ru-ftp"></a>俄羅斯 (Russia)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@ru.FreeBSD.org">hostmaster@ru.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.ru.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.ru.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp.ru.FreeBSD.org/FreeBSD/" target="_top">http://ftp.ru.FreeBSD.org/FreeBSD/</a> / rsync) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp2.ru.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.ru.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp2.ru.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp2.ru.FreeBSD.org/pub/FreeBSD/</a> / rsync) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp4.ru.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.ru.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp5.ru.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp5.ru.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp5.ru.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp5.ru.FreeBSD.org/pub/FreeBSD/</a> / rsync) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp6.ru.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp6.ru.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-sa-ftp"></a>沙烏地阿拉伯 (Saudi Arabia)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:ftpadmin@isu.net.sa">ftpadmin@isu.net.sa</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.isu.net.sa/pub/ftp.freebsd.org/" target="_top">ftp://ftp.isu.net.sa/pub/ftp.freebsd.org/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-si-ftp"></a>斯洛維尼亞 (Slovenia)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@si.FreeBSD.org">hostmaster@si.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.si.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.si.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-za-ftp"></a>南非 (South Africa)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@za.FreeBSD.org">hostmaster@za.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.za.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.za.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp2.za.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.za.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp4.za.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.za.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-es-ftp"></a>西班牙 (Spain)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@es.FreeBSD.org">hostmaster@es.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.es.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.es.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp.es.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.es.FreeBSD.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp3.es.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.es.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-se-ftp"></a>瑞典 (Sweden)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@se.FreeBSD.org">hostmaster@se.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.se.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.se.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp2.se.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.se.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="rsync://ftp2.se.FreeBSD.org/" target="_top">rsync://ftp2.se.FreeBSD.org/</a>) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp3.se.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.se.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp4.se.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.se.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="ftp://ftp4.se.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.se.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp4.se.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp4.se.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp4.se.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp4.se.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="rsync://ftp4.se.FreeBSD.org/pub/FreeBSD/" target="_top">rsync://ftp4.se.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="rsync://ftp4.se.FreeBSD.org/pub/FreeBSD/" target="_top">rsync://ftp4.se.FreeBSD.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp6.se.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp6.se.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp6.se.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp6.se.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-ch-ftp"></a>瑞士 (Switzerland)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@ch.FreeBSD.org">hostmaster@ch.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.ch.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.ch.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp.ch.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.ch.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-tw-ftp"></a>台灣 (Taiwan)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@tw.FreeBSD.org">hostmaster@tw.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="ftp://ftp.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.tw.FreeBSD.org/pub/FreeBSD/</a> / rsync / rsyncv6) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp2.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="ftp://ftp2.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.tw.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp2.tw.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp2.tw.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp2.tw.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp2.tw.FreeBSD.org/pub/FreeBSD/</a> / rsync / rsyncv6) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp4.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp5.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp5.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp6.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp6.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp6.tw.FreeBSD.org/" target="_top">http://ftp6.tw.FreeBSD.org/</a> / rsync) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp7.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp7.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp8.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp8.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp11.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp11.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp11.tw.FreeBSD.org/FreeBSD/" target="_top">http://ftp11.tw.FreeBSD.org/FreeBSD/</a>) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp12.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp12.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp13.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp13.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp14.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp14.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp15.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp15.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-ua-ftp"></a>烏克蘭 (Ukraine)</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.ua.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.ua.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp.ua.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.ua.FreeBSD.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp6.ua.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp6.ua.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp6.ua.FreeBSD.org/pub/FreeBSD" target="_top">http://ftp6.ua.FreeBSD.org/pub/FreeBSD</a> / <a class="link" href="rsync://ftp6.ua.FreeBSD.org/FreeBSD/" target="_top">rsync://ftp6.ua.FreeBSD.org/FreeBSD/</a>) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp7.ua.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp7.ua.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-uk-ftp"></a>英國 (United Kingdom)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@uk.FreeBSD.org">hostmaster@uk.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp.uk.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.uk.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp2.uk.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.uk.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="rsync://ftp2.uk.FreeBSD.org/ftp.freebsd.org/pub/FreeBSD/" target="_top">rsync://ftp2.uk.FreeBSD.org/ftp.freebsd.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp3.uk.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.uk.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp4.uk.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.uk.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp5.uk.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp5.uk.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-us-ftp"></a>美國 (USA)</span></dt><dd><p>若有任何問題，請聯絡此區域的主機管理者 <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@us.FreeBSD.org">hostmaster@us.FreeBSD.org</a>&gt;</code>。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp1.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp1.us.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp2.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.us.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp3.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.us.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp4.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.us.FreeBSD.org/pub/FreeBSD/</a> (ftp / ftpv6 / <a class="link" href="http://ftp4.us.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp4.us.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp4.us.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp4.us.FreeBSD.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp5.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp5.us.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp6.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp6.us.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp8.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp8.us.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp10.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp10.us.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp11.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp11.us.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp13.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp13.us.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp13.us.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp13.us.FreeBSD.org/pub/FreeBSD/</a> / rsync) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp14.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp14.us.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp14.us.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp14.us.FreeBSD.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="ftp://ftp15.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp15.us.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd></dl></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="svn"></a>A.3. 使用 <span class="application">Subversion</span></h2></div></div></div><a id="idp89852728" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-intro"></a>A.3.1. 簡介</h3></div></div></div><p>自 2012 年 7 月起，FreeBSD 儲存所有 FreeBSD 的原始碼、文件與 Port 套件集均使用 <span class="application">Subversion</span> 作為其唯一的版本控制系統。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml"><span class="application">Subversion</span> 只是一套開發人員工具。一般使用者可能會較喜歡使用 <code class="command">freebsd-update</code> (<a class="xref" href="#updating-upgrading-freebsdupdate" title="23.2. FreeBSD 更新">節 23.2, “FreeBSD 更新”</a>) 來更新 FreeBSD 基礎系統及 <code class="command">portsnap</code> (<a class="xref" href="#ports-using" title="4.5. 使用 Port 套件集">節 4.5, “使用 Port 套件集”</a>) 來更新 FreeBSD Port 套件集。</p></div><p>本節將示範如何在 FreeBSD 系統安裝 <span class="application">Subversion</span> 以及使用它建立一個本地的 FreeBSD 檔案庫複本，也包含使用 <span class="application">Subversion</span> 的其他資訊。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-ssl-certificates"></a>A.3.2. 根 <acronym class="acronym">SSL</acronym> 憑證</h3></div></div></div><p>安裝 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/ca_root_nss/pkg-descr">security/ca_root_nss</a> 可讓 <span class="application">Subversion</span> 能夠驗証 <acronym class="acronym">HTTPS</acronym> 檔案庫伺服器的身份。root <acronym class="acronym">SSL</acronym> 憑証可從 Port 安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/security/ca_root_nss</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>或從套件：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install ca_root_nss</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-svnlite"></a>A.3.3. <span class="application">Svnlite</span></h3></div></div></div><p>輕量化版的 <span class="application">Subversion</span> <code class="command">svnlite</code> 已會隨 FreeBSD 安裝。Port 或套件版的 <span class="application">Subversion</span> 僅在要使用其 Python 或 Perl <acronym class="acronym">API</acronym> 時需要，或是新想要使用最新版本 Subversion 時才需要。</p><p>與正常 <span class="application">Subversion</span> 唯一的差別只是指令名稱改為 <code class="literal">svnlite</code>。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-install"></a>A.3.4. 安裝</h3></div></div></div><p>若無法使用 <code class="command">svnlite</code> 或需要完整版本的 <span class="application">Subversion</span> 就必須安裝。</p><p><span class="application">Subversion</span> 可從 Port 套件集安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/devel/subversion</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p><span class="application">Subversion</span> 也可以以套件安裝：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>pkg install subversion</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-usage"></a>A.3.5. 執行 <span class="application">Subversion</span></h3></div></div></div><p>要下載原始碼乾淨的複本到本地目錄可使用 <code class="command">svn</code>。在此目錄中的檔案稱作 <span class="emphasis"><em>本地工作複本 (Local working copy)</em></span>。</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">在第一次使用 <code class="command">checkout</code> 前請先移動或刪除目地現有的目錄。</p><p xmlns="http://www.w3.org/1999/xhtml">在現有非 <code class="command">svn</code> 目錄存在的情況下做取出 (Checkout) 的動作會導致現有檔案與檔案庫中的檔案發生衝突。</p></div><p><span class="application">Subversion</span> 使用 <acronym class="acronym">URL</acronym> 來指定檔案庫，使用的格式為 <em class="replaceable"><code>protocol://hostname/path</code></em>。路徑的第一個部份為要存取的 FreeBSD 檔案庫，目前有三個檔案庫，<code class="literal">base</code> 為 FreeBSD 基礎系統原始碼、<code class="literal">ports</code> 為 Port 套件集以及 <code class="literal">doc</code> 為說明文件。舉例來說，URL <code class="literal">https://svn.FreeBSD.org/ports/head/</code> 代表 Port 檔案庫的主要分支，使用 <code class="literal">https</code> 通訊協定。</p><p>使用指令從指定的檔案庫取出 (Checkout) 原始碼如下：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>svn checkout https://svn.FreeBSD.org/<em class="replaceable"><code>repository</code></em>/<em class="replaceable"><code>branch</code></em> <em class="replaceable"><code>lwcdir</code></em></code></strong></pre><p xml:lang="en" lang="en">where:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><em class="replaceable"><code>repository</code></em> 要是下列專案檔案庫其中之一：<code class="literal">base</code>, <code class="literal">ports</code> 或 <code class="literal">doc</code>。</p></li><li class="listitem"><p><em class="replaceable"><code>branch</code></em> 則依據使用的檔案庫來決定。<code class="literal">ports</code> 與 <code class="literal">doc</code> 大部份的更新皆在 <code class="literal">head</code> 分支，而 <code class="literal">base</code> 則會將 -CURRENT 的最新版本存放在 <code class="literal">head</code> 下，-STABLE 分支各自最新的版本則會放在 <code class="literal">stable/9</code> (9.<em class="replaceable"><code>x</code></em>) 與 <code class="literal">stable/10</code> (10.<em class="replaceable"><code>x</code></em>) 下。</p></li><li class="listitem"><p><em class="replaceable"><code>lwcdir</code></em> 則是要存放指定分支內容的目標目錄，通常 <code class="literal">ports</code> 會置於 <code class="filename">/usr/ports</code>，<code class="literal">base</code> 會置於 <code class="filename">/usr/src</code> 以及 <code class="literal">doc</code> 會置於 <code class="filename">/usr/doc</code>。</p></li></ul></div><p>以下範例會使用 <acronym class="acronym">HTTPS</acronym> 協定從 FreeBSD 的檔案庫取出 Port 套件集，並將本地工作複本放置於 <code class="filename">/usr/ports</code>。若 <code class="filename">/usr/ports</code> 已存在，且不是由 <code class="command">svn</code> 所建立的，記得要在取出之前重新命名或刪除。</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>svn checkout https://svn.FreeBSD.org/ports/head /usr/ports</code></strong></pre><p>由於首次取出的動作必須下載遠端檔案庫中完整的分支，會需要花費一段時間，請耐心等候。</p><p>首次取出之後，往後要更新本地工作複本可以執行：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>svn update <em class="replaceable"><code>lwcdir</code></em></code></strong></pre><p>要更新上述範例所建立的 <code class="filename">/usr/ports</code> 可執行：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>svn update /usr/ports</code></strong></pre><p>因為只會傳輸有更新過的檔案，更新的動作會比取出還要快速。</p><p>另一種在取出之後更新本地工作複本的方式是透過 <code class="filename">/usr/ports</code>, <code class="filename">/usr/src</code> 以及 <code class="filename">/usr/doc</code> 目錄所提供的 <code class="filename">Makefile</code>。設定 <code class="varname">SVN_UPDATE</code> 並使用 <code class="buildtarget">update</code> 目標。例如要更新 <code class="filename">/usr/src</code>：</p><pre xml:lang="en" class="screen" lang="en"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make update SVN_UPDATE=yes</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-mirrors"></a>A.3.6. <span class="application">Subversion</span> 鏡像站</h3></div></div></div><a id="idp89938744" class="indexterm"></a><p>FreeBSD <span class="application">Subversion</span> 的檔案庫為：</p><pre xml:lang="en" class="programlisting" lang="en">svn.FreeBSD.org</pre><p>這是可公開存取的鏡像站，使用了 GeoDNS 會自動選擇適合的後端伺服器。若要由瀏覽器檢視 <span class="application">Subversion</span> 檔案庫可以使用 <a class="link" href="https://svnweb.FreeBSD.org/" target="_top">https://svnweb.FreeBSD.org/</a>。</p><p xml:lang="en" lang="en">HTTPS is the preferred protocol, but the
	<code class="filename">security/ca_root_nss</code>
	package will need to be installed in order to automatically
	validate certificates.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89943864"></a>A.3.7. 取得更多資訊</h3></div></div></div><p>要取得其他有關使用 <span class="application">Subversion</span> 的資訊請參考 <span class="quote">“<span class="quote">Subversion Book</span>”</span>，其書名為 <a class="link" href="http://svnbook.red-bean.com/" target="_top">Version Control with Subversion</a> 或是 <a class="link" href="http://subversion.apache.org/docs/" target="_top">Subversion Documentation</a>。</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mirrors-rsync"></a>A.4. 使用 <span class="application">rsync</span></h2></div></div></div><p>這些站台讓 FreeBSD 可透過 rsync 通訊協定取得。<span class="application">rsync</span> 工具只會傳輸兩個檔案集之間的差異，所以能夠大大的加快在網路上同步的速度，這對大多數 FreeBSD <acronym class="acronym">FTP</acronym> 伺服器的鏡像站非常有用。<span class="application">rsync</span> 在許多作業系統上也可以使用，在 FreeBSD 上請參考 <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/rsync/pkg-descr">net/rsync</a> Port 或使用套件。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">捷克 (Czech Republic)</span></dt><dd><p xml:lang="en" lang="en">rsync://ftp.cz.FreeBSD.org/</p><p>可用的檔案集：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ftp: FreeBSD <acronym class="acronym">FTP</acronym> 伺服器的部份鏡像。</p></li><li class="listitem"><p>FreeBSD: FreeBSD <acronym class="acronym">FTP</acronym> 伺服器的完整鏡像。</p></li></ul></div></dd><dt><span class="term">荷蘭 (Netherlands)</span></dt><dd><p xml:lang="en" lang="en">rsync://ftp.nl.FreeBSD.org/</p><p>可用的檔案集：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FreeBSD: FreeBSD <acronym class="acronym">FTP</acronym> 伺服器的完整鏡像。</p></li></ul></div></dd><dt><span class="term">俄羅斯 (Russia)</span></dt><dd><p xml:lang="en" lang="en">rsync://ftp.mtu.ru/</p><p>可用的檔案集：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FreeBSD: FreeBSD <acronym class="acronym">FTP</acronym> 伺服器的完整鏡像。</p></li><li class="listitem"><p>FreeBSD-Archive: FreeBSD 封存 <acronym class="acronym">FTP</acronym> 伺服器的鏡像。</p></li></ul></div></dd><dt><span class="term">瑞典 (Sweden)</span></dt><dd><p xml:lang="en" lang="en">rsync://ftp4.se.freebsd.org/</p><p>可用的檔案集：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FreeBSD: FreeBSD <acronym class="acronym">FTP</acronym> 伺服器的完整鏡像。</p></li></ul></div></dd><dt><span class="term">台灣 (Taiwan)</span></dt><dd><p xml:lang="en" lang="en">rsync://ftp.tw.FreeBSD.org/</p><p xml:lang="en" lang="en">rsync://ftp2.tw.FreeBSD.org/</p><p xml:lang="en" lang="en">rsync://ftp6.tw.FreeBSD.org/</p><p>可用的檔案集：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FreeBSD: FreeBSD <acronym class="acronym">FTP</acronym> 伺服器的完整鏡像。</p></li></ul></div></dd><dt><span class="term">英國 (United Kingdom)</span></dt><dd><p xml:lang="en" lang="en">rsync://rsync.mirrorservice.org/</p><p>可用的檔案集：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ftp.freebsd.org: FreeBSD <acronym class="acronym">FTP</acronym> 伺服器的完整鏡像。</p></li></ul></div></dd><dt><span class="term">美國 (USA)</span></dt><dd><p xml:lang="en" lang="en">rsync://ftp-master.FreeBSD.org/</p><p>此伺服器僅供 FreeBSD 主要鏡像站使用。</p><p>可用的檔案集：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FreeBSD: FreeBSD <acronym class="acronym">FTP</acronym> 伺服器的主要封存。</p></li><li class="listitem"><p>acl: FreeBSD 主要 ACL 清單。</p></li></ul></div><p xml:lang="en" lang="en">rsync://ftp13.FreeBSD.org/</p><p>可用的檔案集：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FreeBSD: FreeBSD <acronym class="acronym">FTP</acronym> 伺服器的完整鏡像。</p></li></ul></div></dd></dl></div></div></div><div class="appendix"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bibliography"></a>附錄 B. 參考書目</h2></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#bibliography-freebsd">B.1. FreeBSD 相關書籍</a></span></dt><dt><span class="sect1"><a href="#bibliography-userguides">B.2. 使用指南</a></span></dt><dt><span class="sect1"><a href="#bibliography-adminguides">B.3. 管理指南</a></span></dt><dt><span class="sect1"><a href="#bibliography-programmers">B.4. 開發指南</a></span></dt><dt><span class="sect1"><a href="#bibliography-osinternals">B.5. 深入作業系統</a></span></dt><dt><span class="sect1"><a href="#bibliography-security">B.6. 安全性參考文獻</a></span></dt><dt><span class="sect1"><a href="#bibliography-hardware">B.7. 硬體參考文獻</a></span></dt><dt><span class="sect1"><a href="#bibliography-history">B.8. <span class="trademark">UNIX</span>® 歷史</a></span></dt><dt><span class="sect1"><a href="#bibliography-journals">B.9. 期刊與雜誌</a></span></dt></dl></div><p>雖然操作手冊提供 FreeBSD 作業系統各個部分完整的說明，卻難免有「小學而大遺」之憾，像是如何讓整個作業系統運作順暢。因此，身邊有 <span class="trademark">UNIX</span>® 系統管理的好書以及好的使用手冊是不可或缺的。</p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bibliography-freebsd"></a>B.1. FreeBSD 相關書籍</h2></div></div></div><p>國際書籍：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://jdli.tw.FreeBSD.org/publication/book/freebsd2/index.htm" target="_top">FreeBSD 入門與應用 (光碟豪華版)</a> (繁體中文), <a class="link" href="http://www.drmaster.com.tw/" target="_top">博碩文化</a>出版, 1997. ISBN 9-578-39435-7。</p></li><li class="listitem"><p>FreeBSD 技術內幕 (FreeBSD Unleashed 簡體中譯版), <a class="link" href="http://www.hzbook.com/" target="_top">機械工業出版社</a>出版. ISBN 7-111-10201-0。</p></li><li class="listitem"><p>FreeBSD 使用大全第二版 (簡體中文), 機械工業出版社出版. ISBN 7-111-10286-X。</p></li><li class="listitem"><p>FreeBSD Handbook 第二版 (簡體中譯版), <a class="link" href="http://www.ptpress.com.cn/" target="_top">人民郵電出版社</a>出版. ISBN 7-115-10541-3。</p></li><li class="listitem"><p>FreeBSD &amp; Windows 集成組網實務 (簡體中文), <a class="link" href="http://www.tdpress.com/" target="_top">中國鐵道出版社</a>出版. ISBN 7-113-03845-X。</p></li><li class="listitem"><p>FreeBSD 網站架設實務 (簡體中文), 中國鐵道出版社出版. ISBN 7-113-03423-3。</p></li><li class="listitem"><p>FreeBSD (日文), CUTT 出版. ISBN 4-906391-22-2 C3055 P2400E。</p></li><li class="listitem"><p><a class="link" href="http://www.shoeisha.com/book/Detail.asp?bid=650" target="_top">Complete Introduction to FreeBSD</a> (日文), <a class="link" href="http://www.shoeisha.co.jp/" target="_top">Shoeisha Co., Ltd</a> 出版. ISBN 4-88135-473-6 P3600E。</p></li><li class="listitem"><p><a class="link" href="http://www.ascii.co.jp/pb/book1/shinkan/detail/1322785.html" target="_top">Personal UNIX Starter Kit FreeBSD</a> (日文), <a class="link" href="http://www.ascii.co.jp/" target="_top">ASCII</a> 出版. ISBN 4-7561-1733-3 P3000E。</p></li><li class="listitem"><p>FreeBSD Handbook (日譯版), <a class="link" href="http://www.ascii.co.jp/" target="_top">ASCII</a> 出版. ISBN 4-7561-1580-2 P3800E。</p></li><li class="listitem"><p>FreeBSD mit Methode (德文), <a class="link" href="http://www.cul.de" target="_top">Computer und Literatur Verlag</a>/Vertrieb Hanser 出版, 1998. ISBN 3-932311-31-0。</p></li><li class="listitem"><p><a class="link" href="http://www.mitp.de/vmi/mitp/detail/pWert/1343/" target="_top"> FreeBSD de Luxe</a> (德文), <a class="link" href="http://www.mitp.de" target="_top">Verlag Modere Industrie</a> 出版, 2003. ISBN 3-8266-1343-0。</p></li><li class="listitem"><p><a class="link" href="http://www.pc.mycom.co.jp/FreeBSD/install-manual.html" target="_top">FreeBSD Install and Utilization Manual</a> (日文), <a class="link" href="http://www.pc.mycom.co.jp/" target="_top">Mainichi Communications Inc.</a> 出版, 1998. ISBN 4-8399-0112-0。</p></li><li class="listitem"><p>Onno W Purbo, Dodi Maryanto, Syahrial Hubbany, Widjil Widodo <span class="emphasis"><em><a class="link" href="http://maxwell.itb.ac.id/" target="_top">Building Internet Server with FreeBSD</a></em></span> (印尼文), <a class="link" href="http://www.elexmedia.co.id/" target="_top">Elex Media Komputindo</a> 出版。</p></li><li class="listitem"><p>FreeBSD 完全探索 (Absolute BSD: The Ultimate Guide to FreeBSD 繁體中譯版), <a class="link" href="http://www.grandtech.com.tw/" target="_top">GrandTech Press</a> 出版, 2003. ISBN 986-7944-92-5。</p></li><li class="listitem"><p><a class="link" href="http://www.twbsd.org/cht/book/" target="_top">FreeBSD 6.0 架設管理與應用</a> (繁體中文), 博碩出版, 2006. ISBN 9-575-27878-X。</p></li></ul></div><p>英文書籍：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www.absoluteFreeBSD.com/" target="_top">Absolute
	    FreeBSD, 2nd Edition: The Complete Guide to
	    FreeBSD</a>, published by
	  <a class="link" href="http://www.nostarch.com/" target="_top">No Starch
	    Press</a>, 2007.  ISBN: 978-1-59327-151-0</p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www.freebsdmall.com/cgi-bin/fm/bsdcomp" target="_top">
	    The Complete FreeBSD</a>, published by
	  <a class="link" href="http://www.oreilly.com/" target="_top">O'Reilly</a>,
	  2003. ISBN: 0596005164</p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www.freebsd-corp-net-guide.com/" target="_top">The
	    FreeBSD Corporate Networker's Guide</a>, published by
	  <a class="link" href="http://www.awl.com/aw/" target="_top">Addison-Wesley</a>,
	  2000.  ISBN: 0201704811</p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://andrsn.stanford.edu/FreeBSD/introbook/" target="_top">
	    FreeBSD: An Open-Source Operating System for Your Personal
	    Computer</a>, published by The Bit Tree Press, 2001.
	  ISBN: 0971204500</p></li><li class="listitem"><p xml:lang="en" lang="en">Teach Yourself FreeBSD in 24 Hours, published by <a class="link" href="http://www.samspublishing.com/" target="_top">Sams</a>,
	  2002.  ISBN: 0672324245</p></li><li class="listitem"><p xml:lang="en" lang="en">FreeBSD 6 Unleashed, published by <a class="link" href="http://www.samspublishing.com/" target="_top">Sams</a>,
	  2006.  ISBN: 0672328755</p></li><li class="listitem"><p xml:lang="en" lang="en">FreeBSD: The Complete Reference, published by <a class="link" href="http://books.mcgraw-hill.com" target="_top">McGrawHill</a>,
	  2003.  ISBN: 0072224096</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bibliography-userguides"></a>B.2. 使用指南</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Ohio State University has written a <a class="link" href="http://www.cs.duke.edu/csl/docs/unix_course/" target="_top">UNIX
	    Introductory Course</a> which is available online in
	  HTML and PostScript format.</p><p xml:lang="en" lang="en">An Italian <a class="link" href="../../../../doc/it_IT.ISO8859-15/books/unix-introduction/index.html" target="_top">translation</a>
	  of this document is available as part of the FreeBSD Italian
	  Documentation Project.</p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www.ed.ac.uk/" target="_top">Edinburgh
	    University</a> has written an <a class="link" href="http://www.ed.ac.uk/information-services/help-consultancy/is-skills/catalogue/program-op-sys-catalogue/unix1" target="_top">Online
	    Guide</a> for newcomers to the UNIX environment.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bibliography-adminguides"></a>B.3. 管理指南</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www.jp.FreeBSD.org/" target="_top">Jpman
	    Project, Japan FreeBSD Users Group</a>.  <a class="link" href="http://www.pc.mycom.co.jp/FreeBSD/sam.html" target="_top">FreeBSD
	    System Administrator's Manual</a> (Japanese
	  translation).
	  <a class="link" href="http://www.pc.mycom.co.jp/" target="_top">Mainichi
	    Communications Inc.</a>, 1998.  ISBN4-8399-0109-0
	  P3300E.</p></li><li class="listitem"><p xml:lang="en" lang="en">Dreyfus, Emmanuel.  <a class="link" href="http://www.eyrolles.com/Informatique/Livre/9782212114638/" target="_top">Cahiers
	    de l'Admin: BSD</a> 2nd Ed. (in French), Eyrolles,
	  2004.  ISBN 2-212-11463-X</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bibliography-programmers"></a>B.4. 開發指南</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Computer Systems Research Group, UC Berkeley.
	  <span class="emphasis"><em>4.4BSD Programmer's Reference Manual</em></span>.
	  O'Reilly &amp; Associates, Inc., 1994.  ISBN
	  1-56592-078-3</p></li><li class="listitem"><p xml:lang="en" lang="en">Computer Systems Research Group, UC Berkeley.
	  <span class="emphasis"><em>4.4BSD Programmer's Supplementary
	    Documents</em></span>.  O'Reilly &amp; Associates, Inc.,
	  1994.  ISBN 1-56592-079-1</p></li><li class="listitem"><p xml:lang="en" lang="en">Harbison, Samuel P. and Steele, Guy L. Jr.  <span class="emphasis"><em>C:
	    A Reference Manual</em></span>.  4th Ed. Prentice Hall,
	  1995.  ISBN 0-13-326224-3</p></li><li class="listitem"><p xml:lang="en" lang="en">Kernighan, Brian and Dennis M. Ritchie.  <span class="emphasis"><em>The C
	    Programming Language</em></span>.  2nd Ed. PTR Prentice
	  Hall, 1988.  ISBN 0-13-110362-8</p></li><li class="listitem"><p xml:lang="en" lang="en">Lehey, Greg.  <span class="emphasis"><em>Porting UNIX
	    Software</em></span>.  O'Reilly &amp; Associates, Inc.,
	  1995.  ISBN 1-56592-126-7</p></li><li class="listitem"><p xml:lang="en" lang="en">Plauger, P. J. <span class="emphasis"><em>The Standard C
	    Library</em></span>.  Prentice Hall, 1992.  ISBN
	  0-13-131509-9</p></li><li class="listitem"><p xml:lang="en" lang="en">Spinellis, Diomidis.  <a class="link" href="http://www.spinellis.gr/codereading/" target="_top"><span class="emphasis"><em>Code
	      Reading: The Open Source Perspective</em></span></a>.
	  Addison-Wesley, 2003.  ISBN 0-201-79940-5</p></li><li class="listitem"><p xml:lang="en" lang="en">Spinellis, Diomidis.  <a class="link" href="http://www.spinellis.gr/codequality/" target="_top"><span class="emphasis"><em>Code
	      Quality: The Open Source Perspective</em></span></a>.
	  Addison-Wesley, 2006.  ISBN 0-321-16607-8</p></li><li class="listitem"><p xml:lang="en" lang="en">Stevens, W. Richard and Stephen A. Rago.
	  <span class="emphasis"><em>Advanced Programming in the UNIX
	    Environment</em></span>.  2nd Ed. Reading, Mass. :
	  Addison-Wesley, 2005.  ISBN 0-201-43307-9</p></li><li class="listitem"><p xml:lang="en" lang="en">Stevens, W. Richard.  <span class="emphasis"><em>UNIX Network
	    Programming</em></span>.  2nd Ed, PTR Prentice Hall, 1998.
	  ISBN 0-13-490012-X</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bibliography-osinternals"></a>B.5. 深入作業系統</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Andleigh, Prabhat K.  <span class="emphasis"><em>UNIX System
	    Architecture</em></span>.  Prentice-Hall, Inc., 1990.  ISBN
	  0-13-949843-5</p></li><li class="listitem"><p xml:lang="en" lang="en">Jolitz, William.  <span class="quote">“<span class="quote">Porting UNIX to the
	    386</span>”</span>.  <span class="emphasis"><em>Dr. Dobb's Journal</em></span>.
	  January 1991-July 1992.</p></li><li class="listitem"><p xml:lang="en" lang="en">Leffler, Samuel J., Marshall Kirk McKusick, Michael J
	  Karels and John Quarterman <span class="emphasis"><em>The Design and
	    Implementation of the 4.3BSD UNIX Operating
	    System</em></span>.  Reading, Mass. : Addison-Wesley, 1989.
	  ISBN 0-201-06196-1</p></li><li class="listitem"><p xml:lang="en" lang="en">Leffler, Samuel J., Marshall Kirk McKusick,
	  <span class="emphasis"><em>The Design and Implementation of the 4.3BSD UNIX
	    Operating System: Answer Book</em></span>.  Reading, Mass.
	  : Addison-Wesley, 1991.  ISBN 0-201-54629-9</p></li><li class="listitem"><p xml:lang="en" lang="en">McKusick, Marshall Kirk, Keith Bostic, Michael J Karels,
	  and John Quarterman.  <span class="emphasis"><em>The Design and
	    Implementation of the 4.4BSD Operating System</em></span>.
	  Reading, Mass. : Addison-Wesley, 1996.  ISBN
	  0-201-54979-4</p><p xml:lang="en" lang="en">(Chapter 2 of this book is available <a class="link" href="../../../../doc/en_US.ISO8859-1/books/design-44bsd/book.html" target="_top">online</a>
	  as part of the FreeBSD Documentation Project.)</p></li><li class="listitem"><p xml:lang="en" lang="en">Marshall Kirk McKusick, George V. Neville-Neil
	  <span class="emphasis"><em>The Design and Implementation of the FreeBSD
	    Operating System</em></span>.  Boston, Mass. :
	  Addison-Wesley, 2004.  ISBN 0-201-70245-2</p></li><li class="listitem"><p xml:lang="en" lang="en">Marshall Kirk McKusick, George V. Neville-Neil,
	  Robert N. M. Watson <span class="emphasis"><em>The Design and Implementation
	    of the FreeBSD Operating System, 2nd Ed.</em></span>.
	  Westford, Mass. : Pearson Education, Inc., 2014.
	  ISBN 0-321-96897-2</p></li><li class="listitem"><p xml:lang="en" lang="en">Stevens, W. Richard.  <span class="emphasis"><em>TCP/IP Illustrated,
	    Volume 1: The Protocols</em></span>.  Reading, Mass. :
	  Addison-Wesley, 1996.  ISBN 0-201-63346-9</p></li><li class="listitem"><p xml:lang="en" lang="en">Schimmel, Curt.  <span class="emphasis"><em>Unix Systems for Modern
	    Architectures</em></span>.  Reading, Mass. :
	  Addison-Wesley, 1994.  ISBN 0-201-63338-8</p></li><li class="listitem"><p xml:lang="en" lang="en">Stevens, W. Richard.  <span class="emphasis"><em>TCP/IP Illustrated,
	    Volume 3: TCP for Transactions, HTTP, NNTP and the UNIX
	    Domain Protocols</em></span>.  Reading, Mass. :
	  Addison-Wesley, 1996.  ISBN 0-201-63495-3</p></li><li class="listitem"><p xml:lang="en" lang="en">Vahalia, Uresh.  <span class="emphasis"><em>UNIX Internals -- The New
	    Frontiers</em></span>.  Prentice Hall, 1996.  ISBN
	  0-13-101908-2</p></li><li class="listitem"><p xml:lang="en" lang="en">Wright, Gary R. and W. Richard Stevens.
	  <span class="emphasis"><em>TCP/IP Illustrated, Volume 2: The
	    Implementation</em></span>.  Reading, Mass. :
	  Addison-Wesley, 1995.  ISBN 0-201-63354-X</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bibliography-security"></a>B.6. 安全性參考文獻</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Cheswick, William R. and Steven M. Bellovin.
	  <span class="emphasis"><em>Firewalls and Internet Security: Repelling the
	    Wily Hacker</em></span>.  Reading, Mass. : Addison-Wesley,
	  1995.  ISBN 0-201-63357-4</p></li><li class="listitem"><p xml:lang="en" lang="en">Garfinkel, Simson.  <span class="emphasis"><em>PGP Pretty Good
	    Privacy</em></span> O'Reilly &amp; Associates, Inc., 1995.
	  ISBN 1-56592-098-8</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bibliography-hardware"></a>B.7. 硬體參考文獻</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Anderson, Don and Tom Shanley.  <span class="emphasis"><em>Pentium
	    Processor System Architecture</em></span>.  2nd Ed.
	  Reading, Mass. : Addison-Wesley, 1995.  ISBN
	  0-201-40992-5</p></li><li class="listitem"><p xml:lang="en" lang="en">Ferraro, Richard F.  <span class="emphasis"><em>Programmer's Guide to the
	    EGA, VGA, and Super VGA Cards</em></span>.  3rd ed.
	  Reading, Mass. : Addison-Wesley, 1995.  ISBN
	  0-201-62490-7</p></li><li class="listitem"><p xml:lang="en" lang="en">Intel Corporation publishes documentation on their CPUs,
	  chipsets and standards on their
	  <a class="link" href="http://developer.intel.com/" target="_top">developer web
	    site</a>, usually as PDF files.</p></li><li class="listitem"><p xml:lang="en" lang="en">Shanley, Tom.  <span class="emphasis"><em>80486 System
	    Architecture</em></span>.  3rd Ed. Reading, Mass. :
	  Addison-Wesley, 1995.  ISBN 0-201-40994-1</p></li><li class="listitem"><p xml:lang="en" lang="en">Shanley, Tom.  <span class="emphasis"><em>ISA System
	    Architecture</em></span>.  3rd Ed. Reading, Mass. :
	  Addison-Wesley, 1995.  ISBN 0-201-40996-8</p></li><li class="listitem"><p xml:lang="en" lang="en">Shanley, Tom.  <span class="emphasis"><em>PCI System
	    Architecture</em></span>.  4th Ed. Reading, Mass. :
	  Addison-Wesley, 1999.  ISBN 0-201-30974-2</p></li><li class="listitem"><p xml:lang="en" lang="en">Van Gilluwe, Frank.  <span class="emphasis"><em>The Undocumented
	    PC</em></span>, 2nd Ed.  Reading, Mass: Addison-Wesley Pub.
	  Co., 1996.  ISBN 0-201-47950-8</p></li><li class="listitem"><p xml:lang="en" lang="en">Messmer, Hans-Peter.  <span class="emphasis"><em>The Indispensable PC
	    Hardware Book</em></span>, 4th Ed. Reading, Mass :
	  Addison-Wesley Pub. Co., 2002.  ISBN 0-201-59616-4</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bibliography-history"></a>B.8. <span class="trademark">UNIX</span>® 歷史</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">Lion, John <span class="emphasis"><em>Lion's Commentary on UNIX, 6th Ed.
	    With Source Code</em></span>.  ITP Media Group, 1996.  ISBN
	  1573980137</p></li><li class="listitem"><p xml:lang="en" lang="en">Raymond, Eric S.  <span class="emphasis"><em>The New Hacker's Dictionary,
	    3rd edition</em></span>.  MIT Press, 1996.  ISBN
	  0-262-68092-0.  Also known as the <a class="link" href="http://www.catb.org/~esr/jargon/html/index.html" target="_top">Jargon
	    File</a></p></li><li class="listitem"><p xml:lang="en" lang="en">Salus, Peter H.  <span class="emphasis"><em>A quarter century of
	    UNIX</em></span>.  Addison-Wesley Publishing Company, Inc.,
	  1994.  ISBN 0-201-54777-5</p></li><li class="listitem"><p xml:lang="en" lang="en">Simon Garfinkel, Daniel Weise, Steven Strassmann.
	  <span class="emphasis"><em>The UNIX-HATERS Handbook</em></span>.  IDG Books
	  Worldwide, Inc., 1994.  ISBN 1-56884-203-1.  Out of print,
	  but available <a class="link" href="http://www.simson.net/ref/ugh.pdf" target="_top">online</a>.</p></li><li class="listitem"><p xml:lang="en" lang="en">Don Libes, Sandy Ressler <span class="emphasis"><em>Life with
	    UNIX</em></span> — special edition.  Prentice-Hall,
	  Inc., 1989.  ISBN 0-13-536657-7</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>The BSD family tree</em></span>.
	  <code class="uri"><a class="uri" href="https://svnweb.freebsd.org/base/head/share/misc/bsd-family-tree?view=co" target="_top">https://svnweb.freebsd.org/base/head/share/misc/bsd-family-tree?view=co</a></code>
	  or <a class="link" href="file://localhost/usr/share/misc/bsd-family-tree" target="_top"><code class="filename">/usr/share/misc/bsd-family-tree</code></a>
	  on a FreeBSD machine.</p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>Networked Computer Science Technical Reports
	    Library</em></span>.  <code class="uri"><a class="uri" href="http://www.ncstrl.org/" target="_top">http://www.ncstrl.org/</a></code></p></li><li class="listitem"><p xml:lang="en" lang="en"><span class="emphasis"><em>Old BSD releases from the Computer Systems
	    Research group (CSRG)</em></span>.  <code class="uri"><a class="uri" href="http://www.mckusick.com/csrg/" target="_top">http://www.mckusick.com/csrg/</a></code>:
	  The 4CD set covers all BSD versions from 1BSD to 4.4BSD and
	  4.4BSD-Lite2 (but not 2.11BSD, unfortunately).  The last
	  disk also holds the final sources plus the SCCS
	  files.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bibliography-journals"></a>B.9. 期刊與雜誌</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www.admin-magazin.de/" target="_top">Admin
	    Magazin</a> (in German), published by
	  Medialinx AG. ISSN: 2190-1066</p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www.bsdmag.org/" target="_top">BSD
	    Magazine</a>, published by Software Press Sp. z o.o.
	  SK. ISSN: 1898-9144</p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www.bsdnow.tv/" target="_top">BSD Now
	    — Video Podcast</a>, published by
	  Jupiter Broadcasting LLC</p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://bsdtalk.blogspot.com/" target="_top">BSD
	    Talk Podcast</a>, by Will Backman</p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://freebsdjournal.com/" target="_top">FreeBSD
	    Journal</a>, published by S&amp;W
	  Publishing, sponsored by The FreeBSD Foundation.
	  ISBN: 978-0-615-88479-0</p></li></ul></div></div></div><div class="appendix"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="eresources"></a>附錄 C. 網路資源</h2></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#eresources-www">C.1. 網站</a></span></dt><dt><span class="sect1"><a href="#eresources-mail">C.2. 郵遞論壇 (Mailing List)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#eresources-summary">C.2.1. 論壇摘要</a></span></dt><dt><span class="sect2"><a href="#eresources-subscribe">C.2.2. 如何訂閱</a></span></dt><dt><span class="sect2"><a href="#eresources-charters">C.2.3. 論壇章程</a></span></dt><dt><span class="sect2"><a href="#eresources-mailfiltering">C.2.4. 郵遞論壇過濾項目</a></span></dt></dl></dd><dt><span class="sect1"><a href="#eresources-news">C.3. Usenet 新聞群組</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp91154232">C.3.1. BSD 專屬新聞群組</a></span></dt><dt><span class="sect2"><a href="#idp91164344">C.3.2. 其他相關的 <span class="trademark">UNIX</span>® 新聞群組</a></span></dt><dt><span class="sect2"><a href="#idp91174072">C.3.3. X 視窗系統</a></span></dt></dl></dd><dt><span class="sect1"><a href="#eresources-web">C.4. 官方鏡像站</a></span></dt></dl></div><p xml:lang="en" lang="en">The rapid pace of FreeBSD progress makes print media
    impractical as a means of following the latest developments.
    Electronic resources are the best, if not often the only, way to
    stay informed of the latest advances.  Since FreeBSD is a volunteer
    effort, the user community itself also generally serves as a
    <span class="quote">“<span class="quote">technical support department</span>”</span> of sorts, with
    electronic mail, web forums, and USENET news being the most
    effective way of reaching that community.</p><p xml:lang="en" lang="en">The most important points of contact with the FreeBSD user
    community are outlined below.  Please send other resources not
    mentioned here to the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-doc" target="_top">FreeBSD documentation project mailing list</a> so that they may also be
    included.</p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="eresources-www"></a>C.1. 網站</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="https://forums.FreeBSD.org/" target="_top">The
	    FreeBSD Forums</a> provide a web based discussion forum
	  for FreeBSD questions and technical
	  discussion.</p></li><li class="listitem"><p xml:lang="en" lang="en">The <a class="link" href="http://www.youtube.com/bsdconferences" target="_top">BSDConferences
	    YouTube Channel</a> provides a collection of high
	  quality videos from BSD conferences around the world.
	  This is a great way to watch key developers give
	  presentations about new work in FreeBSD.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="eresources-mail"></a>C.2. 郵遞論壇 (Mailing List)</h2></div></div></div><p xml:lang="en" lang="en">The mailing lists are the most direct way of addressing
      questions or opening a technical discussion to a concentrated
      FreeBSD audience.  There are a wide variety of lists on a number of
      different FreeBSD topics.  Sending questions to the most
      appropriate mailing list will invariably assure a faster and
      more accurate response.</p><p xml:lang="en" lang="en">The charters for the various lists are given at the bottom
      of this document.  <span class="emphasis"><em>Please read the charter before
      joining or sending mail to any list</em></span>.  Most list
      subscribers receive many hundreds of FreeBSD related messages every
      day, and the charters and rules for use are meant to keep the
      signal-to-noise ratio of the lists high.  To do less would see
      the mailing lists ultimately fail as an effective communications
      medium for the Project.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><span class="emphasis"><em>To test the ability to send email to FreeBSD lists,
	  send a test message to <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-test" target="_top">freebsd-test</a>.</em></span>  Please do
	not send test messages to any other list.</p></div><p xml:lang="en" lang="en">When in doubt about what list to post a question to, see
      <a class="link" href="../../../../doc/en_US.ISO8859-1/articles/freebsd-questions" target="_top">How to get
	best results from the FreeBSD-questions mailing
	list</a>.</p><p xml:lang="en" lang="en">Before posting to any list, please learn about how to best
      use the mailing lists, such as how to help avoid
      frequently-repeated discussions, by reading the
      <a class="link" href="../../../../doc/en_US.ISO8859-1/articles/mailing-list-faq" target="_top">Mailing List
	Frequently Asked Questions</a> (FAQ) document.</p><p xml:lang="en" lang="en">Archives are kept for all of the mailing lists and can be
      searched using the
      <a class="link" href="../../../../search/index.html" target="_top">FreeBSD World Wide
	Web server</a>.  The keyword searchable archive offers an
      excellent way of finding answers to frequently asked questions
      and should be consulted before posting a question.  Note that
      this also means that messages sent to FreeBSD mailing lists are
      archived in perpetuity.  When protecting privacy is a concern,
      consider using a disposable secondary email address and posting
      only public information.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="eresources-summary"></a>C.2.1. 論壇摘要</h3></div></div></div><p xml:lang="en" lang="en"><span class="emphasis"><em>General lists:</em></span> The following are
	general lists which anyone is free (and encouraged) to
	join:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th xml:lang="en" lang="en">List</th><th>用途</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-advocacy" target="_top">freebsd-advocacy</a></td><td xml:lang="en" lang="en">FreeBSD Evangelism</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-announce" target="_top">freebsd-announce</a></td><td xml:lang="en" lang="en">Important events and Project milestones
		(moderated)</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-arch" target="_top">freebsd-arch</a></td><td xml:lang="en" lang="en">Architecture and design discussions</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-bugbusters" target="_top">freebsd-bugbusters</a></td><td xml:lang="en" lang="en">Discussions pertaining to the maintenance of
		the FreeBSD problem report database and related
		tools</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-bugs" target="_top">freebsd-bugs</a></td><td xml:lang="en" lang="en">Bug reports</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chat" target="_top">freebsd-chat</a></td><td xml:lang="en" lang="en">Non-technical items related to the FreeBSD
		community</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chromium" target="_top">freebsd-chromium</a></td><td xml:lang="en" lang="en">FreeBSD-specific Chromium issues</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">freebsd-current</a></td><td xml:lang="en" lang="en">Discussion concerning the use of
		FreeBSD-CURRENT</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-isp" target="_top">freebsd-isp</a></td><td xml:lang="en" lang="en">Issues for Internet Service Providers using
		FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-jobs" target="_top">freebsd-jobs</a></td><td xml:lang="en" lang="en">FreeBSD employment and consulting
		opportunities</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions" target="_top">freebsd-questions</a></td><td xml:lang="en" lang="en">User questions and technical support</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security-notifications" target="_top">freebsd-security-notifications</a></td><td xml:lang="en" lang="en">Security notifications (moderated)</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-stable" target="_top">freebsd-stable</a></td><td xml:lang="en" lang="en">Discussion concerning the use of
		FreeBSD-STABLE</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-test" target="_top">freebsd-test</a></td><td xml:lang="en" lang="en">Where to send test messages instead of to
		one of the actual lists</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-women" target="_top">freebsd-women</a></td><td xml:lang="en" lang="en">FreeBSD advocacy for women</td></tr></tbody></table></div><p xml:lang="en" lang="en"><span class="emphasis"><em>Technical lists:</em></span> The following lists
	are for technical discussion.  Read the charter for each list
	carefully before joining or sending mail to one as there are
	firm guidelines for their use and content.</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th xml:lang="en" lang="en">List</th><th>用途</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a></td><td xml:lang="en" lang="en">ACPI and power management development</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-afs" target="_top">freebsd-afs</a></td><td xml:lang="en" lang="en">Porting AFS to FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-amd64" target="_top">freebsd-amd64</a></td><td xml:lang="en" lang="en">Porting FreeBSD to AMD64 systems (moderated)</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-apache" target="_top">freebsd-apache</a></td><td xml:lang="en" lang="en">Discussion about
		<span class="application">Apache</span> related
		ports</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-arm" target="_top">freebsd-arm</a></td><td xml:lang="en" lang="en">Porting FreeBSD to <span class="trademark">ARM</span>® processors</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-atm" target="_top">freebsd-atm</a></td><td xml:lang="en" lang="en">Using ATM networking with FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-bluetooth" target="_top">freebsd-bluetooth</a></td><td xml:lang="en" lang="en">Using <span class="trademark">Bluetooth</span>® technology in FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-cloud" target="_top">freebsd-cloud</a></td><td xml:lang="en" lang="en">FreeBSD on cloud platforms (EC2, GCE, Azure,
		etc.)</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-cluster" target="_top">freebsd-cluster</a></td><td xml:lang="en" lang="en">Using FreeBSD in a clustered environment</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-database" target="_top">freebsd-database</a></td><td xml:lang="en" lang="en">Discussing database use and development under
		FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-desktop" target="_top">freebsd-desktop</a></td><td xml:lang="en" lang="en">Using and improving FreeBSD on the desktop</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/dev-ci" target="_top">dev-ci</a></td><td xml:lang="en" lang="en">Build and test reports from the Continuous
		Integration servers</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/dev-reviews" target="_top">dev-reviews</a></td><td xml:lang="en" lang="en">Notifications of the FreeBSD review
		system</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-doc" target="_top">freebsd-doc</a></td><td xml:lang="en" lang="en">Creating FreeBSD related documents</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-drivers" target="_top">freebsd-drivers</a></td><td xml:lang="en" lang="en">Writing device drivers for FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-dtrace" target="_top">freebsd-dtrace</a></td><td xml:lang="en" lang="en">Using and working on DTrace in FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-eclipse" target="_top">freebsd-eclipse</a></td><td xml:lang="en" lang="en">FreeBSD users of Eclipse IDE, tools, rich client
		applications and ports.</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-elastic" target="_top">freebsd-elastic</a></td><td xml:lang="en" lang="en">FreeBSD-specific ElasticSearch discussions</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-embedded" target="_top">freebsd-embedded</a></td><td xml:lang="en" lang="en">Using FreeBSD in embedded applications</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-eol" target="_top">freebsd-eol</a></td><td xml:lang="en" lang="en">Peer support of FreeBSD-related software that
		is no longer supported by the FreeBSD Project.</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-emulation" target="_top">freebsd-emulation</a></td><td xml:lang="en" lang="en">Emulation of other systems such as
		Linux/<span class="trademark">MS-DOS</span>®/<span class="trademark">Windows</span>®</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-enlightenment" target="_top">freebsd-enlightenment</a></td><td xml:lang="en" lang="en">Porting <span class="application">Enlightenment</span>
		and <span class="application">Enlightenment</span>
		applications</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-erlang" target="_top">freebsd-erlang</a></td><td xml:lang="en" lang="en">FreeBSD-specific Erlang discussions</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-firewire" target="_top">freebsd-firewire</a></td><td xml:lang="en" lang="en">FreeBSD <span class="trademark">FireWire</span>® (iLink, IEEE 1394) technical
		discussion</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-fortran" target="_top">freebsd-fortran</a></td><td xml:lang="en" lang="en">Fortran on FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-fs" target="_top">freebsd-fs</a></td><td xml:lang="en" lang="en">File systems</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-games" target="_top">freebsd-games</a></td><td xml:lang="en" lang="en">Support for Games on FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-gecko" target="_top">freebsd-gecko</a></td><td xml:lang="en" lang="en"><span class="application">Gecko Rendering
		  Engine</span> issues</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-geom" target="_top">freebsd-geom</a></td><td xml:lang="en" lang="en">GEOM-specific discussions and
		implementations</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-git" target="_top">freebsd-git</a></td><td xml:lang="en" lang="en">Discussion of git use in the FreeBSD project</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-gnome" target="_top">freebsd-gnome</a></td><td xml:lang="en" lang="en">Porting <span class="application">GNOME</span> and
		<span class="application">GNOME</span> applications</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hackers" target="_top">freebsd-hackers</a></td><td xml:lang="en" lang="en">General technical discussion</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-haskell" target="_top">freebsd-haskell</a></td><td xml:lang="en" lang="en">FreeBSD-specific Haskell issues and
		discussions</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hardware" target="_top">freebsd-hardware</a></td><td xml:lang="en" lang="en">General discussion of hardware for running
		FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-i18n" target="_top">freebsd-i18n</a></td><td xml:lang="en" lang="en">FreeBSD Internationalization</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ia32" target="_top">freebsd-ia32</a></td><td xml:lang="en" lang="en">FreeBSD on the IA-32 (<span class="trademark">Intel</span>® x86)
		platform</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ia64" target="_top">freebsd-ia64</a></td><td xml:lang="en" lang="en">Porting FreeBSD to <span class="trademark">Intel</span>®'s upcoming IA64
		systems</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-infiniband" target="_top">freebsd-infiniband</a></td><td xml:lang="en" lang="en">Infiniband on FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ipfw" target="_top">freebsd-ipfw</a></td><td xml:lang="en" lang="en">Technical discussion concerning the redesign
		of the IP firewall code</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-isdn" target="_top">freebsd-isdn</a></td><td xml:lang="en" lang="en">ISDN developers</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-jail" target="_top">freebsd-jail</a></td><td xml:lang="en" lang="en">Discussion about the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>
		facility</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-java" target="_top">freebsd-java</a></td><td xml:lang="en" lang="en"><span class="trademark">Java</span>™ developers and people porting <span class="trademark">JDK</span>™s to
		FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="https://mail.kde.org/mailman/listinfo/kde-freebsd" target="_top">freebsd-kde</a></td><td xml:lang="en" lang="en">Porting <span class="application">KDE</span> and
		<span class="application">KDE</span> applications</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-lfs" target="_top">freebsd-lfs</a></td><td xml:lang="en" lang="en">Porting LFS to FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-mips" target="_top">freebsd-mips</a></td><td xml:lang="en" lang="en">Porting FreeBSD to <span class="trademark">MIPS</span>®</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-mobile" target="_top">freebsd-mobile</a></td><td xml:lang="en" lang="en">Discussions about mobile computing</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-mono" target="_top">freebsd-mono</a></td><td xml:lang="en" lang="en">Mono and C# applications on FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-multimedia" target="_top">freebsd-multimedia</a></td><td xml:lang="en" lang="en">Multimedia applications</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-new-bus" target="_top">freebsd-new-bus</a></td><td xml:lang="en" lang="en">Technical discussions about bus
		architecture</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-net" target="_top">freebsd-net</a></td><td xml:lang="en" lang="en">Networking discussion and TCP/IP source
		code</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-numerics" target="_top">freebsd-numerics</a></td><td xml:lang="en" lang="en">Discussions of high quality implementation of
		libm functions</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ocaml" target="_top">freebsd-ocaml</a></td><td xml:lang="en" lang="en">FreeBSD-specific OCaml discussions</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-office" target="_top">freebsd-office</a></td><td xml:lang="en" lang="en">Office applications on FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-performance" target="_top">freebsd-performance</a></td><td xml:lang="en" lang="en">Performance tuning questions for high
		performance/load installations</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-perl" target="_top">freebsd-perl</a></td><td xml:lang="en" lang="en">Maintenance of a number of
		Perl-related ports</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pf" target="_top">freebsd-pf</a></td><td xml:lang="en" lang="en">Discussion and questions about the packet filter
		firewall system</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pkg" target="_top">freebsd-pkg</a></td><td xml:lang="en" lang="en">Binary package management and package
		tools discussion</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pkg-fallout" target="_top">freebsd-pkg-fallout</a></td><td xml:lang="en" lang="en">Fallout logs from package building</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pkgbase" target="_top">freebsd-pkgbase</a></td><td xml:lang="en" lang="en">Packaging the FreeBSD base system</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-platforms" target="_top">freebsd-platforms</a></td><td xml:lang="en" lang="en">Concerning ports to non <span class="trademark">Intel</span>® architecture
		platforms</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports" target="_top">freebsd-ports</a></td><td xml:lang="en" lang="en">Discussion of the Ports Collection</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports-announce" target="_top">freebsd-ports-announce</a></td><td xml:lang="en" lang="en">Important news and instructions about the Ports
		Collection (moderated)</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports-bugs" target="_top">freebsd-ports-bugs</a></td><td xml:lang="en" lang="en">Discussion of the ports bugs/PRs</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ppc" target="_top">freebsd-ppc</a></td><td xml:lang="en" lang="en">Porting FreeBSD to the <span class="trademark">PowerPC</span>®</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-proliant" target="_top">freebsd-proliant</a></td><td xml:lang="en" lang="en">Technical discussion of FreeBSD on HP ProLiant
		server platforms</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-python" target="_top">freebsd-python</a></td><td xml:lang="en" lang="en">FreeBSD-specific Python issues</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-rc" target="_top">freebsd-rc</a></td><td xml:lang="en" lang="en">Discussion related to the
		<code class="filename">rc.d</code> system and its
		development</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-realtime" target="_top">freebsd-realtime</a></td><td xml:lang="en" lang="en">Development of realtime extensions to
		FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ruby" target="_top">freebsd-ruby</a></td><td xml:lang="en" lang="en">FreeBSD-specific Ruby discussions</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-scsi" target="_top">freebsd-scsi</a></td><td xml:lang="en" lang="en">The SCSI subsystem</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security" target="_top">freebsd-security</a></td><td xml:lang="en" lang="en">Security issues affecting FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-small" target="_top">freebsd-small</a></td><td xml:lang="en" lang="en">Using FreeBSD in embedded applications
		(obsolete; use <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-embedded" target="_top">freebsd-embedded</a> instead)</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-snapshots" target="_top">freebsd-snapshots</a></td><td xml:lang="en" lang="en">FreeBSD Development Snapshot Announcements</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-sparc64" target="_top">freebsd-sparc64</a></td><td xml:lang="en" lang="en">Porting FreeBSD to <span class="trademark">SPARC</span>® based systems</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-standards" target="_top">freebsd-standards</a></td><td xml:lang="en" lang="en">FreeBSD's conformance to the C99 and the <span class="trademark">POSIX</span>®
		standards</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-sysinstall" target="_top">freebsd-sysinstall</a></td><td xml:lang="en" lang="en"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysinstall</span>(8)</span></a> development</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-tcltk" target="_top">freebsd-tcltk</a></td><td xml:lang="en" lang="en">FreeBSD-specific Tcl/Tk discussions</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-testing" target="_top">freebsd-testing</a></td><td xml:lang="en" lang="en">Testing on FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-tex" target="_top">freebsd-tex</a></td><td xml:lang="en" lang="en">Porting <span class="application">TeX</span> and its
		applications to FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-threads" target="_top">freebsd-threads</a></td><td xml:lang="en" lang="en">Threading in FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-tilera" target="_top">freebsd-tilera</a></td><td xml:lang="en" lang="en">Porting FreeBSD to the Tilera family of
		CPUs</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-tokenring" target="_top">freebsd-tokenring</a></td><td xml:lang="en" lang="en">Support Token Ring in FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-toolchain" target="_top">freebsd-toolchain</a></td><td xml:lang="en" lang="en">Maintenance of FreeBSD's integrated
		toolchain</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-translators" target="_top">freebsd-translators</a></td><td xml:lang="en" lang="en">Translating FreeBSD documents and programs</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-transport" target="_top">freebsd-transport</a></td><td xml:lang="en" lang="en">Discussions of transport level network protocols
		in FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-usb" target="_top">freebsd-usb</a></td><td xml:lang="en" lang="en">Discussing FreeBSD support for USB</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-virtualization" target="_top">freebsd-virtualization</a></td><td xml:lang="en" lang="en">Discussion of various virtualization techniques
		supported by FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-vuxml" target="_top">freebsd-vuxml</a></td><td xml:lang="en" lang="en">Discussion on VuXML infrastructure</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-x11" target="_top">freebsd-x11</a></td><td xml:lang="en" lang="en">Maintenance and support of X11 on FreeBSD</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-xen" target="_top">freebsd-xen</a></td><td xml:lang="en" lang="en">Discussion of the FreeBSD port to <span class="trademark">Xen</span>™ —
		implementation and usage</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-xfce" target="_top">freebsd-xfce</a></td><td xml:lang="en" lang="en"><span class="application">XFCE</span> for FreeBSD —
		porting and maintaining</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-zope" target="_top">freebsd-zope</a></td><td xml:lang="en" lang="en"><span class="application">Zope</span> for FreeBSD —
		porting and maintaining</td></tr></tbody></table></div><p xml:lang="en" lang="en"><span class="emphasis"><em>Limited lists:</em></span>  The following lists
	are for more specialized (and demanding) audiences and are
	probably not of interest to the general public.  It is also a
	good idea to establish a presence in the technical lists
	before joining one of these limited lists in order to
	understand the communications etiquette involved.</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th xml:lang="en" lang="en">List</th><th>用途</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hubs" target="_top">freebsd-hubs</a></td><td xml:lang="en" lang="en">People running mirror sites (infrastructural
		support)</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-user-groups" target="_top">freebsd-user-groups</a></td><td xml:lang="en" lang="en">User group coordination</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-wip-status" target="_top">freebsd-wip-status</a></td><td xml:lang="en" lang="en">FreeBSD Work-In-Progress Status</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-wireless" target="_top">freebsd-wireless</a></td><td xml:lang="en" lang="en">Discussions of 802.11 stack, tools, device driver
		development</td></tr></tbody></table></div><p xml:lang="en" lang="en"><span class="emphasis"><em>Digest lists:</em></span>  All of the above lists
	are available in a digest format.  Once subscribed to a list,
	the digest options can be changed in the account options
	section.</p><p xml:lang="en" lang="en"><span class="emphasis"><em>SVN lists:</em></span> The following lists are
	for people interested in seeing the log messages for changes
	to various areas of the source tree.  They are
	<span class="emphasis"><em>Read-Only</em></span> lists and should not have mail
	sent to them.</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th xml:lang="en" lang="en">List</th><th xml:lang="en" lang="en">Source area</th><th xml:lang="en" lang="en">Area Description (source for)</th></tr></thead><tbody><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-doc-all" target="_top">svn-doc-all</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/doc</code></td><td xml:lang="en" lang="en">All changes to the doc Subversion repository
		(except for <code class="filename">user</code>,
		<code class="filename">projects</code> and
		<code class="filename">translations</code>)</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-doc-head" target="_top">svn-doc-head</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/doc</code></td><td xml:lang="en" lang="en">All changes to the <span class="quote">“<span class="quote">head</span>”</span> branch of
		the doc Subversion repository</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-doc-projects" target="_top">svn-doc-projects</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/doc/projects</code></td><td xml:lang="en" lang="en">All changes to the <code class="filename">projects</code>
		area of the doc Subversion repository</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-doc-svnadmin" target="_top">svn-doc-svnadmin</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/doc</code></td><td xml:lang="en" lang="en">All changes to the administrative scripts, hooks,
		and other configuration data of the doc Subversion
		repository</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-ports-all" target="_top">svn-ports-all</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/ports</code></td><td xml:lang="en" lang="en">All changes to the ports Subversion
		repository</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-ports-head" target="_top">svn-ports-head</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/ports</code></td><td xml:lang="en" lang="en">All changes to the <span class="quote">“<span class="quote">head</span>”</span> branch
		of the ports Subversion repository</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-ports-svnadmin" target="_top">svn-ports-svnadmin</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/ports</code></td><td xml:lang="en" lang="en">All changes to the administrative scripts, hooks,
		and other configuration data of the ports Subversion
		repository</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-all" target="_top">svn-src-all</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/src</code></td><td xml:lang="en" lang="en">All changes to the src Subversion repository
		(except for <code class="filename">user</code>
		and <code class="filename">projects</code>)</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-head" target="_top">svn-src-head</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/src</code></td><td xml:lang="en" lang="en">All changes to the <span class="quote">“<span class="quote">head</span>”</span> branch
		of the src Subversion repository (the FreeBSD-CURRENT
		branch)</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-projects" target="_top">svn-src-projects</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/projects</code></td><td xml:lang="en" lang="en">All changes to the <code class="filename">projects</code>
		area of the src Subversion repository</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-release" target="_top">svn-src-release</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/src</code></td><td xml:lang="en" lang="en">All changes to the <code class="filename">releases</code>
		area of the src Subversion repository</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-releng" target="_top">svn-src-releng</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/src</code></td><td xml:lang="en" lang="en">All changes to the <code class="filename">releng</code>
		branches of the src Subversion repository (the
		security / release engineering branches)</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable" target="_top">svn-src-stable</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/src</code></td><td xml:lang="en" lang="en">All changes to the all stable branches of the src
		Subversion repository</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-6" target="_top">svn-src-stable-6</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/src</code></td><td xml:lang="en" lang="en">All changes to the <code class="filename">stable/6</code>
		branch of the src Subversion repository</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-7" target="_top">svn-src-stable-7</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/src</code></td><td xml:lang="en" lang="en">All changes to the <code class="filename">stable/7</code>
		branch of the src Subversion repository</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-8" target="_top">svn-src-stable-8</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/src</code></td><td xml:lang="en" lang="en">All changes to the <code class="filename">stable/8</code>
		branch of the src Subversion repository</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-9" target="_top">svn-src-stable-9</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/src</code></td><td xml:lang="en" lang="en">All changes to the <code class="filename">stable/9</code>
		branch of the src Subversion repository</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-10" target="_top">svn-src-stable-10</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/src</code></td><td xml:lang="en" lang="en">All changes to the <code class="filename">stable/10</code>
		branch of the src Subversion repository</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-11" target="_top">svn-src-stable-11</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/src</code></td><td xml:lang="en" lang="en">All changes to the <code class="filename">stable/11</code>
		branch of the src Subversion repository</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-12" target="_top">svn-src-stable-12</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/src</code></td><td xml:lang="en" lang="en">All changes to the <code class="filename">stable/12</code>
		branch of the src Subversion repository</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-other" target="_top">svn-src-stable-other</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/src</code></td><td xml:lang="en" lang="en">All changes to the
		older <code class="filename">stable</code> branches of the src
		Subversion repository</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-svnadmin" target="_top">svn-src-svnadmin</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/src</code></td><td xml:lang="en" lang="en">All changes to the administrative scripts, hooks,
		and other configuration data of the src Subversion
		repository</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-user" target="_top">svn-src-user</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/src</code></td><td xml:lang="en" lang="en">All changes to the
		experimental <code class="filename">user</code> area of the src
		Subversion repository</td></tr><tr><td xml:lang="en" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-vendor" target="_top">svn-src-vendor</a></td><td xml:lang="en" lang="en"><code class="filename">/usr/src</code></td><td xml:lang="en" lang="en">All changes to the vendor work area of the src
		Subversion repository</td></tr></tbody></table></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="eresources-subscribe"></a>C.2.2. 如何訂閱</h3></div></div></div><p xml:lang="en" lang="en">To subscribe to a list, click the list name at
	<a class="link" href="http://lists.FreeBSD.org/mailman/listinfo" target="_top">http://lists.FreeBSD.org/mailman/listinfo</a>.  The page that is displayed should
	contain all of the necessary subscription instructions for
	that list.</p><p xml:lang="en" lang="en">To actually post to a given list, send mail to
	<code class="email">&lt;<a xmlns="" class="email" href="mailto:listname@FreeBSD.org"><em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>listname</code></em>@FreeBSD.org</a>&gt;</code>.
	It will then be redistributed to mailing list members
	world-wide.</p><p xml:lang="en" lang="en">To unsubscribe from a list, click on the URL found at the
	bottom of every email received from the list.  It is also
	possible to send an email to
	<code class="email">&lt;<a xmlns="" class="email" href="mailto:listname-unsubscribe@FreeBSD.org"><em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>listname</code></em>-unsubscribe@FreeBSD.org</a>&gt;</code>
	to unsubscribe.</p><p xml:lang="en" lang="en">It is important to keep discussion in the technical
	mailing lists on a technical track.  To only receive important
	announcements, instead join the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-announce" target="_top">FreeBSD announcements mailing list</a>, which is
	intended for infrequent traffic.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="eresources-charters"></a>C.2.3. 論壇章程</h3></div></div></div><p xml:lang="en" lang="en"><span class="emphasis"><em>All</em></span> FreeBSD mailing lists have certain
	basic rules which must be adhered to by anyone using them.
	Failure to comply with these guidelines will result in two (2)
	written warnings from the FreeBSD Postmaster
	<code class="email">&lt;<a xmlns="" class="email" href="mailto:postmaster@FreeBSD.org">postmaster@FreeBSD.org</a>&gt;</code>, after which, on a third
	offense, the poster will removed from all FreeBSD mailing lists
	and filtered from further posting to them.  We regret that
	such rules and measures are necessary at all, but today's
	Internet is a pretty harsh environment, it would seem, and
	many fail to appreciate just how fragile some of its
	mechanisms are.</p><p xml:lang="en" lang="en">Rules of the road:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">The topic of any posting should adhere to the basic
	    charter of the list it is posted to.  If the list is about
	    technical issues, the posting should contain technical
	    discussion.  Ongoing irrelevant chatter or flaming only
	    detracts from the value of the mailing list for everyone
	    on it and will not be tolerated.  For free-form discussion
	    on no particular topic, the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chat" target="_top">FreeBSD chat mailing list</a> is freely available
	    and should be used instead.</p></li><li class="listitem"><p xml:lang="en" lang="en">No posting should be made to more than 2 mailing
	    lists, and only to 2 when a clear and obvious need to post
	    to both lists exists.  For most lists, there is already a
	    great deal of subscriber overlap and except for the most
	    esoteric mixes (say <span class="quote">“<span class="quote">-stable &amp; -scsi</span>”</span>),
	    there really is no reason to post to more than one list at
	    a time.  If a message is received with multiple mailing
	    lists on the <code class="literal">Cc</code> line, trim the
	    <code class="literal">Cc</code> line before replying.  <span class="emphasis"><em>The
	      person who replies is still responsible for
	      cross-posting, no matter who the originator might have
	      been.</em></span></p></li><li class="listitem"><p xml:lang="en" lang="en">Personal attacks and profanity (in the context of an
	    argument) are not allowed, and that includes users and
	    developers alike.  Gross breaches of netiquette, like
	    excerpting or reposting private mail when permission to do
	    so was not and would not be forthcoming, are frowned upon
	    but not specifically enforced.
	    <span class="emphasis"><em>However</em></span>, there are also very few
	    cases where such content would fit within the charter of a
	    list and it would therefore probably rate a warning (or
	    ban) on that basis alone.</p></li><li class="listitem"><p xml:lang="en" lang="en">Advertising of non-FreeBSD related products or services
	    is strictly prohibited and will result in an immediate ban
	    if it is clear that the offender is advertising by
	    spam.</p></li></ul></div><p xml:lang="en" lang="en"><span class="emphasis"><em>Individual list charters:</em></span></p><div class="variablelist"><dl class="variablelist"><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>ACPI and power management
		development</em></span></p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-afs" target="_top">freebsd-afs</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Andrew File System</em></span></p><p xml:lang="en" lang="en">This list is for discussion on porting and using
	      AFS from CMU/Transarc</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-announce" target="_top">freebsd-announce</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Important events /
		milestones</em></span></p><p xml:lang="en" lang="en">This is the mailing list for people interested only
	      in occasional announcements of significant FreeBSD events.
	      This includes announcements about snapshots and other
	      releases.  It contains announcements of new FreeBSD
	      capabilities.  It may contain calls for volunteers etc.
	      This is a low volume, strictly moderated mailing
	      list.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-arch" target="_top">freebsd-arch</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Architecture and design
		discussions</em></span></p><p xml:lang="en" lang="en">This list is for discussion of the FreeBSD
	      architecture.  Messages will mostly be kept strictly
	      technical in nature.  Examples of suitable topics
	      are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">How to re-vamp the build system to have several
		  customized builds running at the same time.</p></li><li class="listitem"><p xml:lang="en" lang="en">What needs to be fixed with VFS to make
		  Heidemann layers work.</p></li><li class="listitem"><p xml:lang="en" lang="en">How do we change the device driver interface
		  to be able to use the same drivers cleanly on many
		  buses and architectures.</p></li><li class="listitem"><p xml:lang="en" lang="en">How to write a network driver.</p></li></ul></div></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-bluetooth" target="_top">freebsd-bluetooth</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em><span class="trademark">Bluetooth</span>® in FreeBSD</em></span></p><p xml:lang="en" lang="en">This is the forum where FreeBSD's <span class="trademark">Bluetooth</span>® users
	      congregate.  Design issues, implementation details,
	      patches, bug reports, status reports, feature requests,
	      and all matters related to <span class="trademark">Bluetooth</span>® are fair
	      game.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-bugbusters" target="_top">freebsd-bugbusters</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Coordination of the Problem Report
		handling effort</em></span></p><p xml:lang="en" lang="en">The purpose of this list is to serve as a
	      coordination and discussion forum for the Bugmeister,
	      his Bugbusters, and any other parties who have a genuine
	      interest in the PR database.  This list is not for
	      discussions about specific bugs, patches or PRs.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-bugs" target="_top">freebsd-bugs</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Bug reports</em></span></p><p xml:lang="en" lang="en">This is the mailing list for reporting bugs in FreeBSD.
	      Whenever possible, bugs should be submitted using the
	      <a class="link" href="https://bugs.freebsd.org/bugzilla/enter_bug.cgi" target="_top">web
		interface</a> to it.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chat" target="_top">freebsd-chat</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Non technical items related to the FreeBSD
		community</em></span></p><p xml:lang="en" lang="en">This list contains the overflow from the other lists
	      about non-technical, social information.  It includes
	      discussion about whether Jordan looks like a toon ferret
	      or not, whether or not to type in capitals, who is
	      drinking too much coffee, where the best beer is brewed,
	      who is brewing beer in their basement, and so on.
	      Occasional announcements of important events (such as
	      upcoming parties, weddings, births, new jobs, etc) can
	      be made to the technical lists, but the follow ups
	      should be directed to this -chat list.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chromium" target="_top">freebsd-chromium</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>FreeBSD-specific Chromium
		issues</em></span></p><p xml:lang="en" lang="en">This is a list for the discussion of Chromium
	      support for FreeBSD.  This is a technical list to
	      discuss development and installation of Chromium.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-cloud" target="_top">freebsd-cloud</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Running FreeBSD on various cloud
		platforms</em></span></p><p xml:lang="en" lang="en">This list discusses running FreeBSD on Amazon EC2,
	      Google Compute Engine, Microsoft Azure, and other cloud
	      computing platforms.</p></dd><dt><span xml:lang="en" class="term" lang="en">freebsd-core</span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>FreeBSD core team</em></span></p><p xml:lang="en" lang="en">This is an internal mailing list for use by the core
	      members.  Messages can be sent to it when a serious
	      FreeBSD-related matter requires arbitration or
	      high-level scrutiny.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">freebsd-current</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Discussions about the use of
		FreeBSD-CURRENT</em></span></p><p xml:lang="en" lang="en">This is the mailing list for users of FreeBSD-CURRENT.
	      It includes warnings about new features coming out in
	      -CURRENT that will affect the users, and instructions
	      on steps that must be taken to remain -CURRENT.  Anyone
	      running <span class="quote">“<span class="quote">CURRENT</span>”</span> must subscribe to this
	      list.  This is a technical mailing list for which
	      strictly technical content is expected.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-desktop" target="_top">freebsd-desktop</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Using and improving FreeBSD on the
		desktop</em></span></p><p xml:lang="en" lang="en">This is a forum for discussion of FreeBSD on the
	      desktop.  It is primarily a place for desktop porters
	      and users to discuss issues and improve FreeBSD's desktop
	      support.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/dev-ci" target="_top">dev-ci</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Continuous Integration reports of build
		and test results</em></span></p><p xml:lang="en" lang="en">All Continuous Integration reports of build and test
	      results</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/dev-reviews" target="_top">dev-reviews</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Notifications of work in progress in
		FreeBSD's review tool</em></span></p><p xml:lang="en" lang="en">Automated notifications of work in progress for
	      review in FreeBSD's review tools, including
	      patches.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-doc" target="_top">freebsd-doc</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Documentation Project</em></span></p><p xml:lang="en" lang="en">This mailing list is for the discussion of issues
	      and projects related to the creation of documentation
	      for FreeBSD.  The members of this mailing list are
	      collectively referred to as <span class="quote">“<span class="quote">The FreeBSD
	      Documentation Project</span>”</span>.  It is an open list; feel
	      free to join and contribute!</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-drivers" target="_top">freebsd-drivers</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Writing device drivers for
		FreeBSD</em></span></p><p xml:lang="en" lang="en">This is a forum for technical discussions related to
	      device drivers on FreeBSD.  It is primarily a place for
	      device driver writers to ask questions about how to
	      write device drivers using the APIs in the FreeBSD
	      kernel.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-dtrace" target="_top">freebsd-dtrace</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Using and working on DTrace in
		FreeBSD</em></span></p><p xml:lang="en" lang="en">DTrace is an integrated component of FreeBSD that
	      provides a framework for understanding the kernel as
	      well as user space programs at run time.  The mailing
	      list is an archived discussion for developers of the
	      code as well as those using it.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-eclipse" target="_top">freebsd-eclipse</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>FreeBSD users of Eclipse IDE, tools, rich
		client applications and ports.</em></span></p><p xml:lang="en" lang="en">The intention of this list is to provide mutual
	      support for everything to do with choosing, installing,
	      using, developing and maintaining the Eclipse IDE,
	      tools, rich client applications on the FreeBSD platform and
	      assisting with the porting of Eclipse IDE and plugins to
	      the FreeBSD environment.</p><p xml:lang="en" lang="en">The intention is also to facilitate exchange of
	      information between the Eclipse community and the FreeBSD
	      community to the mutual benefit of both.</p><p xml:lang="en" lang="en">Although this list is focused primarily on the needs
	      of Eclipse users it will also provide a forum for those
	      who would like to develop FreeBSD specific applications
	      using the Eclipse framework.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-embedded" target="_top">freebsd-embedded</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Using FreeBSD in embedded
		applications</em></span></p><p xml:lang="en" lang="en">This list discusses topics related to using FreeBSD in
	      embedded systems.  This is a technical mailing list for
	      which strictly technical content is expected.  For the
	      purpose of this list, embedded systems are those
	      computing devices which are not desktops and which
	      usually serve a single purpose as opposed to being
	      general computing environments.  Examples include, but
	      are not limited to, all kinds of phone handsets, network
	      equipment such as routers, switches and PBXs, remote
	      measuring equipment, PDAs, Point Of Sale systems, and so
	      on.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-emulation" target="_top">freebsd-emulation</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Emulation of other systems such as
		Linux/<span class="trademark">MS-DOS</span>®/<span class="trademark">Windows</span>®</em></span></p><p xml:lang="en" lang="en">This is a forum for technical discussions related
	      to running programs written for other operating systems
	      on FreeBSD.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-enlightenment" target="_top">freebsd-enlightenment</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Enlightenment</em></span></p><p xml:lang="en" lang="en">Discussions concerning the
	      <span class="application">Enlightenment</span> Desktop
	      Environment for FreeBSD systems.  This is a technical
	      mailing list for which strictly technical content is
	      expected.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-eol" target="_top">freebsd-eol</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Peer support of FreeBSD-related software
		that is no longer supported by the FreeBSD
		Project.</em></span></p><p xml:lang="en" lang="en">This list is for those interested in providing or
	      making use of peer support of FreeBSD-related software for
	      which the FreeBSD Project no longer provides official
	      support in the form of security advisories and
	      patches.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-firewire" target="_top">freebsd-firewire</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em><span class="trademark">FireWire</span>® (iLink, IEEE
		1394)</em></span></p><p xml:lang="en" lang="en">This is a mailing list for discussion of the design
	      and implementation of a <span class="trademark">FireWire</span>® (aka IEEE 1394 aka
	      iLink) subsystem for FreeBSD.  Relevant topics specifically
	      include the standards, bus devices and their protocols,
	      adapter boards/cards/chips sets, and the architecture
	      and implementation of code for their proper
	      support.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-fortran" target="_top">freebsd-fortran</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Fortran on FreeBSD</em></span></p><p xml:lang="en" lang="en">This is the mailing list for discussion of Fortran
	      related ports on FreeBSD: compilers, libraries, scientific
	      and engineering applications from laptops to HPC
	      clusters.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-fs" target="_top">freebsd-fs</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>File systems</em></span></p><p xml:lang="en" lang="en">Discussions concerning FreeBSD filesystems.  This is a
	      technical mailing list for which strictly technical
	      content is expected.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-games" target="_top">freebsd-games</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Games on FreeBSD</em></span></p><p xml:lang="en" lang="en">This is a technical list for discussions related to
	      bringing games to FreeBSD.  It is for individuals actively
	      working on porting games to FreeBSD, to bring up problems
	      or discuss alternative solutions.  Individuals
	      interested in following the technical discussion are
	      also welcome.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-gecko" target="_top">freebsd-gecko</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Gecko Rendering Engine</em></span></p><p xml:lang="en" lang="en">This is a forum about
	      <span class="application">Gecko</span> applications using
	      FreeBSD.</p><p xml:lang="en" lang="en">Discussion centers around Gecko Ports applications,
	      their installation, their development and their support
	      within FreeBSD.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-geom" target="_top">freebsd-geom</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>GEOM</em></span></p><p xml:lang="en" lang="en">Discussions specific to GEOM and related
	      implementations.  This is a technical mailing list for
	      which strictly technical content is expected.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-git" target="_top">freebsd-git</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Use of git in the FreeBSD
		project</em></span></p><p xml:lang="en" lang="en">Discussions of how to use git in FreeBSD
	      infrastructure including the github mirror and other
	      uses of git for project collaboration.  Discussion area
	      for people using git against the FreeBSD github mirror.
	      People wanting to get started with the mirror or git
	      in general on FreeBSD can ask here.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-gnome" target="_top">freebsd-gnome</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>GNOME</em></span></p><p xml:lang="en" lang="en">Discussions concerning The
	      <span class="application">GNOME</span> Desktop Environment
	      for FreeBSD systems.  This is a technical mailing list
	      for which strictly technical content is expected.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-infiniband" target="_top">freebsd-infiniband</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Infiniband on FreeBSD</em></span></p><p xml:lang="en" lang="en">Technical mailing list discussing Infiniband, OFED,
	      and OpenSM on FreeBSD.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ipfw" target="_top">freebsd-ipfw</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>IP Firewall</em></span></p><p xml:lang="en" lang="en">This is the forum for technical discussions
	      concerning the redesign of the IP firewall code in
	      FreeBSD.  This is a technical mailing list for which
	      strictly technical content is expected.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ia64" target="_top">freebsd-ia64</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Porting FreeBSD to IA64</em></span></p><p xml:lang="en" lang="en">This is a technical mailing list for individuals
	      actively working on porting FreeBSD to the IA-64 platform
	      from <span class="trademark">Intel</span>®, to bring up problems or discuss
	      alternative solutions.  Individuals interested in
	      following the technical discussion are also
	      welcome.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-isdn" target="_top">freebsd-isdn</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>ISDN Communications</em></span></p><p xml:lang="en" lang="en">This is the mailing list for people discussing the
	      development of ISDN support for FreeBSD.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-java" target="_top">freebsd-java</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em><span class="trademark">Java</span>™ Development</em></span></p><p xml:lang="en" lang="en">This is the mailing list for people discussing the
	      development of significant <span class="trademark">Java</span>™ applications for FreeBSD
	      and the porting and maintenance of <span class="trademark">JDK</span>™s.</p></dd><dt><a id="eresources-charters-jobs"></a><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-jobs" target="_top">freebsd-jobs</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Jobs offered and sought</em></span></p><p xml:lang="en" lang="en">This is a forum for posting employment notices
	      specifically related to FreeBSD and resumes from those
	      seeking FreeBSD-related employment.  This is
	      <span class="emphasis"><em>not</em></span> a mailing list for general
	      employment issues since adequate forums for that already
	      exist elsewhere.</p><p xml:lang="en" lang="en">Note that this list, like other <code class="systemitem">FreeBSD.org</code>
	      mailing lists, is distributed worldwide.  Be clear about
	      the geographic location and the extent to which
	      telecommuting or assistance with relocation is
	      available.</p><p xml:lang="en" lang="en">Email should use open formats only —
	      preferably plain text, but basic Portable Document
	      Format (<acronym class="acronym">PDF</acronym>), HTML, and a few others
	      are acceptable to many readers.  Closed formats such as
	      <span class="trademark">Microsoft</span>® Word (<code class="filename">.doc</code>) will be
	      rejected by the mailing list server.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="https://mail.kde.org/mailman/listinfo/kde-freebsd" target="_top">freebsd-kde</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>KDE</em></span></p><p xml:lang="en" lang="en">Discussions concerning
	      <span class="application">KDE</span> on FreeBSD systems.
	      This is a technical mailing list for which strictly
	      technical content is expected.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hackers" target="_top">freebsd-hackers</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Technical discussions</em></span></p><p xml:lang="en" lang="en">This is a forum for technical discussions related
	      to FreeBSD.  This is the primary technical mailing list.
	      It is for individuals actively working on FreeBSD, to bring
	      up problems or discuss alternative solutions.
	      Individuals interested in following the technical
	      discussion are also welcome.  This is a technical
	      mailing list for which strictly technical content is
	      expected.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hardware" target="_top">freebsd-hardware</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>General discussion of FreeBSD
		hardware</em></span></p><p xml:lang="en" lang="en">General discussion about the types of hardware that
	      FreeBSD runs on, various problems and suggestions
	      concerning what to buy or avoid.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hubs" target="_top">freebsd-hubs</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Mirror sites</em></span></p><p xml:lang="en" lang="en">Announcements and discussion for people who run FreeBSD
	      mirror sites.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-isp" target="_top">freebsd-isp</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Issues for Internet Service
		Providers</em></span></p><p xml:lang="en" lang="en">This mailing list is for discussing topics relevant
	      to Internet Service Providers (ISPs) using FreeBSD.  This
	      is a technical mailing list for which strictly technical
	      content is expected.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-mono" target="_top">freebsd-mono</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Mono and C# applications on
		FreeBSD</em></span></p><p xml:lang="en" lang="en">This is a list for discussions related to the Mono
	      development framework on FreeBSD.  This is a technical
	      mailing list.  It is for individuals actively working on
	      porting Mono or C# applications to FreeBSD, to bring up
	      problems or discuss alternative solutions.  Individuals
	      interested in following the technical discussion are
	      also welcome.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ocaml" target="_top">freebsd-ocaml</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>FreeBSD-specific OCaml
		discussions</em></span></p><p xml:lang="en" lang="en">This is a list for discussions related to the OCaml
	      support on FreeBSD.  This is a technical mailing list. It
	      is for individuals working on OCaml ports, 3rd party
	      libraries and frameworks.  Individuals interested in the
	      technical discussion are also welcome.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-office" target="_top">freebsd-office</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Office applications on
		FreeBSD</em></span></p><p xml:lang="en" lang="en">Discussion centers around office applications, their
	      installation, their development and their support within
	      FreeBSD.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ops-announce" target="_top">freebsd-ops-announce</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Project Infrastructure
		Announcements</em></span></p><p xml:lang="en" lang="en">This is the mailing list for people interested in
	      changes and issues related to the FreeBSD.org Project
	      infrastructure.</p><p xml:lang="en" lang="en">This moderated list is strictly for announcements:
	      no replies, requests, discussions, or opinions.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-performance" target="_top">freebsd-performance</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Discussions about tuning or speeding up
		FreeBSD</em></span></p><p xml:lang="en" lang="en">This mailing list exists to provide a place for
	      hackers, administrators, and/or concerned parties to
	      discuss performance related topics pertaining to FreeBSD.
	      Acceptable topics includes talking about FreeBSD
	      installations that are either under high load, are
	      experiencing performance problems, or are pushing the
	      limits of FreeBSD.  Concerned parties that are willing to
	      work toward improving the performance of FreeBSD are highly
	      encouraged to subscribe to this list.  This is a highly
	      technical list ideally suited for experienced FreeBSD
	      users, hackers, or administrators interested in keeping
	      FreeBSD fast, robust, and scalable.  This list is not a
	      question-and-answer list that replaces reading through
	      documentation, but it is a place to make contributions
	      or inquire about unanswered performance related
	      topics.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pf" target="_top">freebsd-pf</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Discussion and questions about the packet
		filter firewall system</em></span></p><p xml:lang="en" lang="en">Discussion concerning the packet filter (pf)
	      firewall system in terms of FreeBSD.  Technical discussion
	      and user questions are both welcome.  This list is also
	      a place to discuss the ALTQ QoS framework.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pkg" target="_top">freebsd-pkg</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Binary package management and package
		tools discussion</em></span></p><p xml:lang="en" lang="en">Discussion of all aspects of managing FreeBSD systems
	      by using binary packages to install software, including
	      binary package toolkits and formats, their development
	      and support within FreeBSD, package repository management,
	      and third party packages.</p><p xml:lang="en" lang="en">Note that discussion of ports which fail to generate
	      packages correctly should generally be considered as
	      ports problems, and so inappropriate for this
	      list.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pkg-fallout" target="_top">freebsd-pkg-fallout</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Fallout logs from package
		building</em></span></p><p xml:lang="en" lang="en">All packages building failures logs from the package
	      building clusters</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pkgbase" target="_top">freebsd-pkgbase</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Packaging the FreeBSD base
		system.</em></span></p><p xml:lang="en" lang="en">Discussions surrounding implementation and issues
	      regarding packaging the FreeBSD base system.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-platforms" target="_top">freebsd-platforms</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Porting to Non <span class="trademark">Intel</span>®
		platforms</em></span></p><p xml:lang="en" lang="en">Cross-platform FreeBSD issues, general discussion and
	      proposals for non <span class="trademark">Intel</span>® FreeBSD ports.  This is a
	      technical mailing list for which strictly technical
	      content is expected.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports" target="_top">freebsd-ports</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Discussion of
		<span class="quote">“<span class="quote">ports</span>”</span></em></span></p><p xml:lang="en" lang="en">Discussions concerning FreeBSD's <span class="quote">“<span class="quote">ports
		collection</span>”</span> (<code class="filename">/usr/ports</code>),
	      ports infrastructure, and general ports coordination
	      efforts.  This is a technical mailing list for which
	      strictly technical content is expected.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports-announce" target="_top">freebsd-ports-announce</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Important news and instructions about the
		FreeBSD <span class="quote">“<span class="quote">Ports
		  Collection</span>”</span></em></span></p><p xml:lang="en" lang="en">Important news for developers, porters, and users of
	      the <span class="quote">“<span class="quote">Ports Collection</span>”</span>
	      (<code class="filename">/usr/ports</code>), including
	      architecture/infrastructure changes, new capabilities,
	      critical upgrade instructions, and release engineering
	      information.  This is a low-volume mailing list,
	      intended for announcements.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports-bugs" target="_top">freebsd-ports-bugs</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Discussion of
		<span class="quote">“<span class="quote">ports</span>”</span> bugs</em></span></p><p xml:lang="en" lang="en">Discussions concerning problem reports for FreeBSD's
	      <span class="quote">“<span class="quote">ports collection</span>”</span>
	      (<code class="filename">/usr/ports</code>), proposed ports, or
	      modifications to ports.  This is a technical mailing
	      list for which strictly technical content is
	      expected.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-proliant" target="_top">freebsd-proliant</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Technical discussion of FreeBSD on HP
		ProLiant server platforms</em></span></p><p xml:lang="en" lang="en">This mailing list is to be used for the technical
	      discussion of the usage of FreeBSD on HP ProLiant servers,
	      including the discussion of ProLiant-specific drivers,
	      management software, configuration tools, and BIOS
	      updates.  As such, this is the primary place to discuss
	      the hpasmd, hpasmcli, and hpacucli modules.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-python" target="_top">freebsd-python</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Python on FreeBSD</em></span></p><p xml:lang="en" lang="en">This is a list for discussions related to improving
	      Python-support on FreeBSD.  This is a technical mailing
	      list.  It is for individuals working on porting Python,
	      its third party modules and
	      <span class="application">Zope</span> stuff to FreeBSD.
	      Individuals interested in following the technical
	      discussion are also welcome.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions" target="_top">freebsd-questions</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>User questions</em></span></p><p xml:lang="en" lang="en">This is the mailing list for questions about FreeBSD.
	      Do not send <span class="quote">“<span class="quote">how to</span>”</span> questions to the
	      technical lists unless the question is quite
	      technical.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ruby" target="_top">freebsd-ruby</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>FreeBSD-specific Ruby
		discussions</em></span></p><p xml:lang="en" lang="en">This is a list for discussions related to the Ruby
	      support on FreeBSD.  This is a technical mailing list.  It
	      is for individuals working on Ruby ports, third party
	      libraries and frameworks.</p><p xml:lang="en" lang="en">Individuals interested in the technical discussion
	      are also welcome.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-scsi" target="_top">freebsd-scsi</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>SCSI subsystem</em></span></p><p xml:lang="en" lang="en">This is the mailing list for people working on the
	      SCSI subsystem for FreeBSD.  This is a technical mailing
	      list for which strictly technical content is
	      expected.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security" target="_top">freebsd-security</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Security issues</em></span></p><p xml:lang="en" lang="en">FreeBSD computer security issues (DES, Kerberos, known
	      security holes and fixes, etc).  This is a technical
	      mailing list for which strictly technical discussion is
	      expected.  Note that this is not a question-and-answer
	      list, but that contributions (BOTH question AND answer)
	      to the FAQ are welcome.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security-notifications" target="_top">freebsd-security-notifications</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Security Notifications</em></span></p><p xml:lang="en" lang="en">Notifications of FreeBSD security problems and fixes.
	      This is not a discussion list.  The discussion list is
	      FreeBSD-security.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-small" target="_top">freebsd-small</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Using FreeBSD in embedded
		applications</em></span></p><p xml:lang="en" lang="en">This list discusses topics related to unusually
	      small and embedded FreeBSD installations.  This is a
	      technical mailing list for which strictly technical
	      content is expected.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">This list has been obsoleted by
		<a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-embedded" target="_top">freebsd-embedded</a>.</p></div></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-snapshots" target="_top">freebsd-snapshots</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>FreeBSD Development Snapshot
		Announcements</em></span></p><p xml:lang="en" lang="en">This list provides notifications about the
	      availability of new FreeBSD development snapshots for the
	      head/ and stable/ branches.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-stable" target="_top">freebsd-stable</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Discussions about the use of
		FreeBSD-STABLE</em></span></p><p xml:lang="en" lang="en">This is the mailing list for users of FreeBSD-STABLE.
	      <span class="quote">“<span class="quote">STABLE</span>”</span> is the branch where development
	      continues after a RELEASE, including bug fixes and new
	      features.  The ABI is kept stable for binary
	      compatibility.  It includes warnings about new features
	      coming out in -STABLE that will affect the users, and
	      instructions on steps that must be taken to remain
	      -STABLE.  Anyone running <span class="quote">“<span class="quote">STABLE</span>”</span> should
	      subscribe to this list.  This is a technical mailing
	      list for which strictly technical content is
	      expected.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-standards" target="_top">freebsd-standards</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>C99 &amp; POSIX
		Conformance</em></span></p><p xml:lang="en" lang="en">This is a forum for technical discussions related to
	      FreeBSD Conformance to the C99 and the POSIX
	      standards.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-teaching" target="_top">freebsd-teaching</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Teaching with FreeBSD</em></span></p><p xml:lang="en" lang="en">Non technical mailing list discussing teaching
	      with FreeBSD.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-testing" target="_top">freebsd-testing</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Testing on FreeBSD</em></span></p><p xml:lang="en" lang="en">Technical mailing list discussing testing on FreeBSD,
	      including ATF/Kyua, test build infrastructure, port
	      tests to FreeBSD from other operating systems (NetBSD,
	      ...), etc.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-tex" target="_top">freebsd-tex</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Porting <span class="application">TeX</span> and
		its applications to FreeBSD</em></span></p><p xml:lang="en" lang="en">This is a technical mailing list for discussions
	      related to TeX and its applications on FreeBSD.  It is for
	      individuals actively working on porting TeX to FreeBSD,
	      to bring up problems or discuss alternative solutions.
	      Individuals interested in following the technical
	      discussion are also welcome.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-toolchain" target="_top">freebsd-toolchain</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Maintenance of FreeBSD's integrated
		toolchain</em></span></p><p xml:lang="en" lang="en">This is the mailing list for discussions related to
	      the maintenance of the toolchain shipped with FreeBSD.
	      This could include the state of Clang and GCC, but also
	      pieces of software such as assemblers, linkers and
	      debuggers.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-transport" target="_top">freebsd-transport</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Discussions of transport level network
		protocols in FreeBSD</em></span></p><p xml:lang="en" lang="en">The transport mailing list exists for the discussion
	      of issues and designs around the transport level
	      protocols in the FreeBSD network stack, including TCP,
	      SCTP and UDP.  Other networking topics, including
	      driver specific and network protocol issues should be
	      discussed on the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-net" target="_top">FreeBSD networking mailing list</a>.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-translators" target="_top">freebsd-translators</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Translating FreeBSD documents and
		programs</em></span></p><p xml:lang="en" lang="en">A discussion list where translators of FreeBSD
	      documents from English into other languages can talk
	      about translation methods and tools.  New members are
	      asked to introduce themselves and mention the languages
	      they are interested in translating.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-usb" target="_top">freebsd-usb</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Discussing FreeBSD support for
		USB</em></span></p><p xml:lang="en" lang="en">This is a mailing list for technical discussions
	      related to FreeBSD support for USB.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-user-groups" target="_top">freebsd-user-groups</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>User Group Coordination
		List</em></span></p><p xml:lang="en" lang="en">This is the mailing list for the coordinators from
	      each of the local area Users Groups to discuss matters
	      with each other and a designated individual from the
	      Core Team.  This mail list should be limited to meeting
	      synopsis and coordination of projects that span User
	      Groups.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-virtualization" target="_top">freebsd-virtualization</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Discussion of various virtualization
		techniques supported by FreeBSD</em></span></p><p xml:lang="en" lang="en">A list to discuss the various virtualization
	      techniques supported by FreeBSD.  On one hand the focus
	      will be on the implementation of the basic functionality
	      as well as adding new features.  On the other hand users
	      will have a forum to ask for help in case of problems or
	      to discuss their use cases.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-wip-status" target="_top">freebsd-wip-status</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>FreeBSD Work-In-Progress
		Status</em></span></p><p xml:lang="en" lang="en">This mailing list can be used by developers to
	      announce the creation and progress of FreeBSD related work.
	      Messages will be moderated.  It is suggested to send the
	      message "To:" a more topical FreeBSD list and only "BCC:"
	      this list.  This way the WIP can also be discussed on
	      the topical list, as no discussion is allowed on this
	      list.</p><p xml:lang="en" lang="en">Look inside the archives for examples of suitable
	      messages.</p><p xml:lang="en" lang="en">An editorial digest of the messages to this list
	      might be posted to the FreeBSD website every few months as
	      part of the Status Reports
	      <a href="#ftn.idp91107384" class="footnote" id="idp91107384"><sup class="footnote">[3]</sup></a>.
	      Past reports are archived.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-wireless" target="_top">freebsd-wireless</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Discussions of 802.11 stack, tools device
		driver development</em></span></p><p xml:lang="en" lang="en">The FreeBSD-wireless list focuses on 802.11 stack
	      (sys/net80211), device driver and tools development.
	      This includes bugs, new features and maintenance.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-xen" target="_top">freebsd-xen</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Discussion of the FreeBSD port to <span class="trademark">Xen</span>™
		— implementation and usage</em></span></p><p xml:lang="en" lang="en">A list that focuses on the FreeBSD <span class="trademark">Xen</span>™ port.  The
	      anticipated traffic level is small enough that it is
	      intended as a forum for both technical discussions of
	      the implementation and design details as well as
	      administrative deployment issues.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-xfce" target="_top">freebsd-xfce</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>XFCE</em></span></p><p xml:lang="en" lang="en">This is a forum for discussions related to bring the
	      <span class="application">XFCE</span> environment to FreeBSD.
	      This is a technical mailing list.  It is for individuals
	      actively working on porting
	      <span class="application">XFCE</span> to FreeBSD, to bring up
	      problems or discuss alternative solutions.  Individuals
	      interested in following the technical discussion are
	      also welcome.</p></dd><dt><span xml:lang="en" class="term" lang="en"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-zope" target="_top">freebsd-zope</a></span></dt><dd><p xml:lang="en" lang="en"><span class="emphasis"><em>Zope</em></span></p><p xml:lang="en" lang="en">This is a forum for discussions related to bring the
	      <span class="application">Zope</span> environment to FreeBSD.
	      This is a technical mailing list.  It is for individuals
	      actively working on porting
	      <span class="application">Zope</span> to FreeBSD, to bring up
	      problems or discuss alternative solutions.  Individuals
	      interested in following the technical discussion are
	      also welcome.</p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="eresources-mailfiltering"></a>C.2.4. 郵遞論壇過濾項目</h3></div></div></div><p xml:lang="en" lang="en">The FreeBSD mailing lists are filtered in multiple ways to
	avoid the distribution of spam, viruses, and other unwanted
	emails.  The filtering actions described in this section do
	not include all those used to protect the mailing
	lists.</p><p xml:lang="en" lang="en">Only certain types of attachments are allowed on the
	mailing lists.  All attachments with a MIME content type not
	found in the list below will be stripped before an email is
	distributed on the mailing lists.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en">application/octet-stream</p></li><li class="listitem"><p xml:lang="en" lang="en">application/pdf</p></li><li class="listitem"><p xml:lang="en" lang="en">application/pgp-signature</p></li><li class="listitem"><p xml:lang="en" lang="en">application/x-pkcs7-signature</p></li><li class="listitem"><p xml:lang="en" lang="en">message/rfc822</p></li><li class="listitem"><p xml:lang="en" lang="en">multipart/alternative</p></li><li class="listitem"><p xml:lang="en" lang="en">multipart/related</p></li><li class="listitem"><p xml:lang="en" lang="en">multipart/signed</p></li><li class="listitem"><p xml:lang="en" lang="en">text/html</p></li><li class="listitem"><p xml:lang="en" lang="en">text/plain</p></li><li class="listitem"><p xml:lang="en" lang="en">text/x-diff</p></li><li class="listitem"><p xml:lang="en" lang="en">text/x-patch</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">Some of the mailing lists might allow attachments of
	  other MIME content types, but the above list should be
	  applicable for most of the mailing lists.</p></div><p xml:lang="en" lang="en">If an email contains both an HTML and a plain text
	version, the HTML version will be removed.  If an email
	contains only an HTML version, it will be converted to plain
	text.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="eresources-news"></a>C.3. Usenet 新聞群組</h2></div></div></div><p xml:lang="en" lang="en">In addition to two FreeBSD specific newsgroups, there are
      many others in which FreeBSD is discussed or are otherwise
      relevant to FreeBSD users.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91154232"></a>C.3.1. BSD 專屬新聞群組</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="news:comp.unix.bsd.freebsd.announce" target="_top">comp.unix.bsd.freebsd.announce</a></p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="news:comp.unix.bsd.freebsd.misc" target="_top">comp.unix.bsd.freebsd.misc</a></p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="news:de.comp.os.unix.bsd" target="_top">de.comp.os.unix.bsd</a>
	    (German)</p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="news:fr.comp.os.bsd" target="_top">fr.comp.os.bsd</a>
	    (French)</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91164344"></a>C.3.2. 其他相關的 <span class="trademark">UNIX</span>® 新聞群組</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="news:comp.unix" target="_top">comp.unix</a></p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="news:comp.unix.questions" target="_top">comp.unix.questions</a></p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="news:comp.unix.admin" target="_top">comp.unix.admin</a></p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="news:comp.unix.programmer" target="_top">comp.unix.programmer</a></p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="news:comp.unix.shell" target="_top">comp.unix.shell</a></p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="news:comp.unix.misc" target="_top">comp.unix.misc</a></p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="news:comp.unix.bsd" target="_top">comp.unix.bsd</a></p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91174072"></a>C.3.3. X 視窗系統</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="news:comp.windows.x" target="_top">comp.windows.x</a></p></li></ul></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="eresources-web"></a>C.4. 官方鏡像站</h2></div></div></div><p><a class="link" href="#central-www">中央伺服器</a>、<a class="link" href="#mirrors-am-www">亞美尼亞 (Armenia)</a>、<a class="link" href="#mirrors-au-www">澳洲 (Australia)</a>、<a class="link" href="#mirrors-at-www">奧地利 (Austria)</a>、<a class="link" href="#mirrors-cz-www">捷克 (Czech Republic)</a>、<a class="link" href="#mirrors-dk-www">丹麥 (Denmark)</a>、<a class="link" href="#mirrors-fi-www">芬蘭 (Finland)</a>、<a class="link" href="#mirrors-fr-www">法國 (France)</a>、<a class="link" href="#mirrors-de-www">德國 (Germany)</a>、<a class="link" href="#mirrors-hk-www">香港 (Hong Kong)</a>、<a class="link" href="#mirrors-ie-www">愛爾蘭 (Ireland)</a>、<a class="link" href="#mirrors-jp-www">日本 (Japan)</a>、<a class="link" href="#mirrors-lv-www">拉脫維亞 (Latvia)</a>、<a class="link" href="#mirrors-lt-www">立陶宛 (Lithuania)</a>、<a class="link" href="#mirrors-nl-www">荷蘭 (Netherlands)</a>、<a class="link" href="#mirrors-no-www">挪威 (Norway)</a>、<a class="link" href="#mirrors-ru-www">俄羅斯 (Russia)</a>、<a class="link" href="#mirrors-si-www">斯洛維尼亞 (Slovenia)</a>、<a class="link" href="#mirrors-za-www">南非 (South Africa)</a>、<a class="link" href="#mirrors-es-www">西班牙 (Spain)</a>、<a class="link" href="#mirrors-se-www">瑞典 (Sweden)</a>、<a class="link" href="#mirrors-ch-www">瑞士 (Switzerland)</a>、<a class="link" href="#mirrors-tw-www">台灣 (Taiwan)</a>、<a class="link" href="#mirrors-uk-www">英國 (United Kingdom)</a>、<a class="link" href="#mirrors-us-www">美國 (USA)</a>。</p><p xml:lang="en" lang="en">(as of   UTC)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a id="central-www"></a><p>中央伺服器</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><a class="link" href="https://www.FreeBSD.org/" target="_top">https://www.FreeBSD.org/</a></p></li></ul></div></li><li class="listitem"><a id="mirrors-am-www"></a><p>亞美尼亞 (Armenia)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www1.am.FreeBSD.org/" target="_top">http://www1.am.FreeBSD.org/</a> (IPv6)</p></li></ul></div></li><li class="listitem"><a id="mirrors-au-www"></a><p>澳洲 (Australia)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www.au.FreeBSD.org/" target="_top">http://www.au.FreeBSD.org/</a>
        </p></li><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www2.au.FreeBSD.org/" target="_top">http://www2.au.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-at-www"></a><p>奧地利 (Austria)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www.at.FreeBSD.org/" target="_top">http://www.at.FreeBSD.org/</a> (IPv6)</p></li></ul></div></li><li class="listitem"><a id="mirrors-cz-www"></a><p>捷克 (Czech Republic)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www.cz.FreeBSD.org/" target="_top">http://www.cz.FreeBSD.org/</a> (IPv6)</p></li></ul></div></li><li class="listitem"><a id="mirrors-dk-www"></a><p>丹麥 (Denmark)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www.dk.FreeBSD.org/" target="_top">http://www.dk.FreeBSD.org/</a> (IPv6)</p></li></ul></div></li><li class="listitem"><a id="mirrors-fi-www"></a><p>芬蘭 (Finland)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www.fi.FreeBSD.org/" target="_top">http://www.fi.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-fr-www"></a><p>法國 (France)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www1.fr.FreeBSD.org/" target="_top">http://www1.fr.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-de-www"></a><p>德國 (Germany)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www.de.FreeBSD.org/" target="_top">http://www.de.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-hk-www"></a><p>香港 (Hong Kong)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www.hk.FreeBSD.org/" target="_top">http://www.hk.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-ie-www"></a><p>愛爾蘭 (Ireland)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www.ie.FreeBSD.org/" target="_top">http://www.ie.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-jp-www"></a><p>日本 (Japan)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www.jp.FreeBSD.org/www.FreeBSD.org/" target="_top">http://www.jp.FreeBSD.org/www.FreeBSD.org/</a> (IPv6)</p></li></ul></div></li><li class="listitem"><a id="mirrors-lv-www"></a><p>拉脫維亞 (Latvia)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www.lv.FreeBSD.org/" target="_top">http://www.lv.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-lt-www"></a><p>立陶宛 (Lithuania)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www.lt.FreeBSD.org/" target="_top">http://www.lt.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-nl-www"></a><p>荷蘭 (Netherlands)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www.nl.FreeBSD.org/" target="_top">http://www.nl.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-no-www"></a><p>挪威 (Norway)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www.no.FreeBSD.org/" target="_top">http://www.no.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-ru-www"></a><p>俄羅斯 (Russia)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www.ru.FreeBSD.org/" target="_top">http://www.ru.FreeBSD.org/</a> (IPv6)</p></li></ul></div></li><li class="listitem"><a id="mirrors-si-www"></a><p>斯洛維尼亞 (Slovenia)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www.si.FreeBSD.org/" target="_top">http://www.si.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-za-www"></a><p>南非 (South Africa)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www.za.FreeBSD.org/" target="_top">http://www.za.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-es-www"></a><p>西班牙 (Spain)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www.es.FreeBSD.org/" target="_top">http://www.es.FreeBSD.org/</a>
        </p></li><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www2.es.FreeBSD.org/" target="_top">http://www2.es.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-se-www"></a><p>瑞典 (Sweden)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www.se.FreeBSD.org/" target="_top">http://www.se.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-ch-www"></a><p>瑞士 (Switzerland)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www.ch.FreeBSD.org/" target="_top">http://www.ch.FreeBSD.org/</a> (IPv6)</p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www2.ch.FreeBSD.org/" target="_top">http://www2.ch.FreeBSD.org/</a> (IPv6)</p></li></ul></div></li><li class="listitem"><a id="mirrors-tw-www"></a><p>台灣 (Taiwan)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www.tw.FreeBSD.org/" target="_top">http://www.tw.FreeBSD.org/</a>
        </p></li><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www2.tw.FreeBSD.org/" target="_top">http://www2.tw.FreeBSD.org/</a>
        </p></li><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www4.tw.FreeBSD.org/" target="_top">http://www4.tw.FreeBSD.org/</a>
        </p></li><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www5.tw.FreeBSD.org/" target="_top">http://www5.tw.FreeBSD.org/</a> (IPv6)</p></li></ul></div></li><li class="listitem"><a id="mirrors-uk-www"></a><p>英國 (United Kingdom)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www1.uk.FreeBSD.org/" target="_top">http://www1.uk.FreeBSD.org/</a>
        </p></li><li class="listitem"><p xml:lang="en" lang="en">
          <a class="link" href="http://www3.uk.FreeBSD.org/" target="_top">http://www3.uk.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-us-www"></a><p>美國 (USA)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p xml:lang="en" lang="en"><a class="link" href="http://www5.us.FreeBSD.org/" target="_top">http://www5.us.FreeBSD.org/</a> (IPv6)</p></li></ul></div></li></ul></div></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp91107384" class="footnote"><p xml:lang="en" lang="en"><a href="#idp91107384" class="para"><sup class="para">[3] </sup></a><code class="uri"><a class="uri" href="https://www.freebsd.org/news/status/" target="_top">https://www.freebsd.org/news/status/</a></code></p></div></div></div><div class="appendix"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pgpkeys"></a>附錄 D. Open<acronym class="acronym">PGP</acronym> 金鑰</h2></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="#pgpkeys-officers">D.1. 人員</a></span></dt><dd><dl><dt><span class="sect2"><a href="#pgpkey-security-officer">D.1.1. Security Officer Team <code class="email">&lt;<a xmlns="" class="email" href="mailto:security-officer@FreeBSD.org">security-officer@FreeBSD.org</a>&gt;</code></a></span></dt><dt><span class="sect2"><a href="#pgpkey-secteam-secretary">D.1.2. Security Team Secretary <code class="email">&lt;<a xmlns="" class="email" href="mailto:secteam-secretary@FreeBSD.org">secteam-secretary@FreeBSD.org</a>&gt;</code></a></span></dt><dt><span class="sect2"><a href="#pgpkey-core-secretary">D.1.3. Core Team Secretary <code class="email">&lt;<a xmlns="" class="email" href="mailto:core-secretary@FreeBSD.org">core-secretary@FreeBSD.org</a>&gt;</code></a></span></dt><dt><span class="sect2"><a href="#pgpkey-portmgr-secretary">D.1.4. Ports Management Team Secretary <code class="email">&lt;<a xmlns="" class="email" href="mailto:portmgr-secretary@FreeBSD.org">portmgr-secretary@FreeBSD.org</a>&gt;</code></a></span></dt><dt><span class="sect2"><a href="#pgpkey-doceng-secretary">D.1.5. <code class="email">&lt;<a xmlns="" class="email" href="mailto:doceng-secretary@FreeBSD.org">doceng-secretary@FreeBSD.org</a>&gt;</code></a></span></dt></dl></dd></dl></div><a id="idp91332408" class="indexterm"></a><p xml:lang="en" lang="en">The Open<acronym class="acronym">PGP</acronym> keys of the
    <code class="systemitem">FreeBSD.org</code> officers
    are shown here.  These keys can be used to verify a signature or
    send encrypted email to one of the officers.  A full list of FreeBSD
    Open<acronym class="acronym">PGP</acronym> keys is available in the
    <a class="link" href="../../../../doc/en_US.ISO8859-1/articles/pgpkeys" target="_top"><acronym class="acronym">PGP</acronym>
      Keys</a> article.  The complete keyring can be downloaded
    at <a class="link" href="https://www.FreeBSD.org/doc/pgpkeyring.txt" target="_top">https://www.FreeBSD.org/doc/pgpkeyring.txt</a>.</p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="pgpkeys-officers"></a>D.1. 人員</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pgpkey-security-officer"></a>D.1.1. Security Officer Team <code class="email">&lt;<a xmlns="" class="email" href="mailto:security-officer@FreeBSD.org">security-officer@FreeBSD.org</a>&gt;</code></h3></div></div></div><pre class="programlisting">
pub   rsa4096/D39792F49EA7E5C2 2017-08-16 [SC] [expires: 2023-01-02]
      Key fingerprint = FC0E 878A E5AF E788 028D  6355 D397 92F4 9EA7 E5C2
uid                            FreeBSD Security Officer &lt;security-officer@FreeBSD.org&gt;
sub   rsa4096/6DD0A349F26ADEFD 2017-08-16 [E] [expires: 2023-01-02]

</pre><pre class="programlisting">
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBFmT2+ABEACrTVJ7Z/MuDeyKFqoTFnm5FrGG55k66RLeKivzQzq/tT/6RKO9
K8DaEvSIqD9b0/xgK02KgLSdp0Bucq8HLDFYUk3McFa6Z3YwjobNCWkxc72ipvVl
uAOGN4H6fuoYOpeg4cLK1H9pktUIrzONTCixaZzc/Bu6X+aX4ywGeCfsuu8g5v03
fLCPBLLgf3Bm5wsyZ6ZaGmsmILrWzd+d/rbr35Mcc5BekdgywUI4R191qo1bdrw9
mEJP1V7Ik3jpExOsNnuhMTvm5OQMeCTfUvVEOtBU15QtbT+1LXF5FIOgML0LwS5v
RHZN+5w/xvzSnEULpj24UuMKLDs/u9rj8U/zET8QaE+oG7m/mr4jJWZEmdX8HKdO
WrpnVj6UAppk72qdBIEfLsOW2xB/NOjJpppbCQH3+sw7DRYA2UnKE9Mptj/KKiE4
cs4c8Cupo2WSu93lEZDC5rCrULpT2lFeEXnRYlC/5oIgY5w9sFide9VI4CzHkkWX
Z2NPW/i1w3mFhoXjvnNLGOYMfAMKPxsRC2/Bn3bY0IhKvuIZ4rAeu7FTmKDDqFKQ
YEcrUOW74ZVng17AB29xzjWr4zNJVvp/CybFiUb8JoKkwtVWRqAVZIEgenAjU40d
G5+W4e+ccL0mfTQfEBbXRjnL2BL2tnaoBR42cTfbZGRucPHz7MrlKBEeZQARAQAB
tDdGcmVlQlNEIFNlY3VyaXR5IE9mZmljZXIgPHNlY3VyaXR5LW9mZmljZXJARnJl
ZUJTRC5vcmc+iQJUBBMBCgA+FiEE/A6HiuWv54gCjWNV05eS9J6n5cIFAlmT2+AC
GwMFCQoek4AFCwkIBwMFFQoJCAsFFgIDAQACHgECF4AACgkQ05eS9J6n5cKd9A/9
Fz3uGjNy28D0ALT1d/JJGzdQ2R3YwspHk9KHBr1LePkog9wf1WRalwCeNtPmA+g5
cn24psuzOeh1tRElImTZ2eE2ENPZ9XzK/J0ok0nK42MvmIwmMCyz+CaWv9GXW+FK
0oXnFmHi4YaQUVN3p+45TGkD9T+O5biVww7P47n/NnWsTfhLx0bzC7LyjPKXINai
/LgPgtlcOgY65/YhW/qhADCkoU7qMp9is41jMjTu1WB3OBPJkUkNpHfu6r15y8FN
Wqsk7K4W6Obr/WQ6VKGGXgh/a5mTcaEoFGMO16uHijAY4nXeb2HGZlBKxgmPH9Ur
aT4A9Pz/n+rIRMrK+rs+msFPemQHHNBYxy+x99uBpRBNyT2Su6GouZIxu5J16aIM
V0ZyOy/dy7m/uJ4sMhJPqKkd8a+MoQs/2L1M1y1EAzsO/QZqIrKrCluaftNN9k/B
qU0XClSDqB6sRMF7HFzYqb+f+M6cwSL/3Cp1Yx4rZ/onEE/MdWp64+3R87dETTXd
5tWXQw04qOhfPri5cBTI7r3t/qMO1iNXCGSG5RJbGkas6N6t6Mj83L4ItjI8doLf
aSIWZjj1XP3/me2hFJ6h2G5y5A+khO4ZwhC0ATFSq1fYbVGHw5AtfthIgNn8FoWu
+Sb8h7/RqTr7F6LgWagAoAh0GtVj02SVABZjcNZz/AKJAjcEEAEKACEWIQQc9/9v
rfXKn74bjLLtZ+zWXc9q5wUCWZPcTAMFAngACgkQ7Wfs1l3PauflkRAAgYcaBX0Y
ic4btxKoP/eOVpgUciOPPKEhDCiloQDyf4XQnZFDoMfjgcHpbLTBZ6kiAz2UzDGr
fJ4yUqrD+xfixUfCd5YpwzsaSpCGzDzSxOBcP/SpuAFhe40awSOIf5MruQar9Mlf
33JyslDLULXXeewAq2pcGk0/WrrOragI6Cs2vPGy9XP96VvLxyhjrWjlKmnO+//w
UF8oIO5hhKoqbtoxxlcqJgsWVyHch0mnPzvr6GWwoPhFXocnh1oPdbLjX1AwmGm9
ltEYMge4QxONIXlXJR0TvuDuJOaLNvTOC3OI8L97fdBcZS7eNJrG5FAYR5Ft3ISf
KJowIsSLGDt/cYApqpyP2pv7FpCvnwHgXHYar7/q4zhngCFRxQ2DPUx1cIJQ3Bgh
HZolKyK1X7XE5ZVDfZ3s3gcHSVKS89pipgHHZNr4sSmOanA8rXHcyHS4o2zSi1ie
r4iBwnOk6cCd6UNzEIiq0y/XhP/sc7xeL0mn3wDuV7jDBP9sp65sexL1qtIAfnzL
pLQevm0z41ifrUH5nNeL6RdbXpaoXc8M4PJJeQKJDu04KzLcQpZdUdCJsbS6QO9w
srWR8enQXPEhz2CO4L77bM9TgYO29222jTqEPcbXcmxF/klxO1rpssTTHUnHHi1Z
LUGYCbZPjt+laTJ2YPHTjUtN1Jw85vSKCEuJATMEEAEKAB0WIQS7KNQLNg7uk2rt
FW/l97zLo73d+AUCWjSYRwAKCRDl97zLo73d+JKyB/9N5Ytao12nD5QzMLvceGh5
otCLN99TUryYiDVDLoNkBivq3jHQA/hOX2rwEueFq0+LF8/2DnglJuUICNtCxIzL
WXXf/Hr5iWBUQ0JxYNPQzzjdMSXGE0WMwYVpAbCGxHpIsetKLdHUCwneYhaywe3I
KzmRJSDJGV1IJB0sAfoFtgybZXHgIR61jQjtnNmmyYXliYCd0wmIhXQDFN91tzzG
+EZdJ3Fao9JsMC+x55jO6EOLVySZgRF5E8vCeKUWemQciKFC7EhKcljILPYAA21u
NmHCAgRHKWU9JMdFK0w9lQuN2HQaNfkahjarTNM/Q6LwxY0dLG0vVYifE085WFAf
uQINBFmT2+ABEACxi39m5nQZexzY3c9sg/w5mUYCD89ZNSkj427gduQMYYGn7YW6
jSPfVJ/V3+PDK824c0a0XasyDapQFY1CPTZYrReRPoyjb8tJjsSVGXXCTFpJZlFU
br6kS9mgcx58Sypke2PMVk73+W1N1Yco+nahfTECRuM2/T2zHHr0AdKuBPF28U+H
TxyLatKoIgQwHDs4E/f4ZTbAoHvu3PixAl7XHVXCgz0cHaLhRljXizbZDXngOdGm
lqdFlAIpL6/l8E3m1Er0m3IfFo6qSzWRHg/KaBGIL4YKetJ6ACjlkCe5qbatDpmk
gWlg3Ux4RBVjyCK834Xh7eZpEcNf2iwpm28glWh7XMHGUplTHkU3PWQ4vGfNxXB8
HBOd9r02/cHL6MiHwhCAfIzZGVtqR0i9Ira57TMdXTpJWNXUcgsCMsi/Bg2a+hsn
aiYLrZc18uNL5nqOqsqKG3c1TcmeN7nbxVgnrNST4AjteulkhmB9p8tNOXA3u979
OO0T5LPwdqIpobdZ0lfw4URnAGw4Wd4Sm9PtRw0RvuAk2M2e5KXNyxPWAuMVkoRR
a7wG6h/R8pki54Gexyc+JkfB4ZcOrzHNLurw6DhxroyfRs8WEgX0wNIGmJvCXSBG
54jb5w9qudYwzIg4YPfvuX8sfeY8MTNhal3rF0tvVloGj3l709wlaWlBYwARAQAB
iQI8BBgBCgAmFiEE/A6HiuWv54gCjWNV05eS9J6n5cIFAlmT2+ACGwwFCQoek4AA
CgkQ05eS9J6n5cKhWw/+PT0R4r2gPAxI8ESEe380BYOmneNAH24MFOgWXqWCj4zX
Uz992BVnW2aL5nH4O5d822LGeCrYUC7SCpQvlifdHZHjobgtizLTwuu40bc3gSOz
cxWlx2jKfx3Ezn6QQz2mhhK6fZ1AO0ObiQxQq25ldURep95L78E/C8XkCe11YlUR
ng3wQKeHM7awZWRw/QBC92haHuVtU3cx7At+zQL7jTBKSZqd34zzs0uoXIhk2h94
O07MMDZ8z8MeU337vdL+RKYtD2bljLwpf7/kqg1D/q44RJ4ZpZcha9G0GvtLaQg2
+MAPlLg1vOWZ8wOTLaQHm+uzYRpkqxkIV8OuVd4UikCd8t3VNjNG5rG/YRNIAX0A
UEzs6oMF5YOFE8LmykesbUHAbC07Vcb0AsT5u3XKixDiIpPdnYSwGlkvoOVVLdeh
q/aXLK9V8BpViG5+a8xP2fdF1eMqdnrKAsiO4GEiq193PN/FA049VeIs3fd0izAa
x7+ag1MGtoF5Pij5iTVJm6phH5SUd1P3FY3OmclxWj/MbL4ba/G/6FWcy5NXxdw9
L1bRqaM2KEHJ67aF6NZz7UMldwExAWzFbUon1LUpKysAukxVf0EnntydBeVOQ+JO
HdqEpirrVLMpxPttUB2xxbo947nMj7/Bnme2gvb0vxaC9xSGVxrpW9cg5iCwSdc=
=8rds
-----END PGP PUBLIC KEY BLOCK-----
</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pgpkey-secteam-secretary"></a>D.1.2. Security Team Secretary <code class="email">&lt;<a xmlns="" class="email" href="mailto:secteam-secretary@FreeBSD.org">secteam-secretary@FreeBSD.org</a>&gt;</code></h3></div></div></div><pre class="programlisting">
pub   4096R/3CB2EAFCC3D6C666 2013-09-24 [expires: 2018-01-01]
      Key fingerprint = FA97 AA04 4DF9 0969 D5EF  4ADA 3CB2 EAFC C3D6 C666
uid                          FreeBSD Security Team Secretary &lt;secteam-secretary@FreeBSD.org&gt;
sub   4096R/509B26612335EB65 2013-09-24 [expires: 2018-01-01]
</pre><pre class="programlisting">
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBFJBjIIBEADadvvpXSkdnBOGV2xcsFwBBcSwAdryWuLk6v2VxjwsPcY6Lwqz
NAZr2Ox1BaSgX7106Psa6v9si8nxoOtMc5BCM/ps/fmedFU48YtqOTGF+utxvACg
Ou6SKintEMUa1eoPcww1jzDZ3mxx49bQaNAJLjVxeiAZoYHe9loTe1fxsprCONnx
Era1hrI+YA2KjMWDORcwa0sSXRCI3V+b4PUnbMUOQa3fFVUriM4QjjUBU6hW0Ub0
GDPcZq45nd7PoPPtb3/EauaYfk/zdx8Xt0OmuKTi9/vMkvB09AEUyShbyzoebaKH
dKtXlzyAPCZoH9dihFM67rhUg4umckFLc8vc5P2tNblwYrnhgL8ymUaOIjZB/fOi
Z2OZLVCiDeHNjjK3VZ6jLAiPyiYTG1Hrk9E8NaZDeUgIb9X/K06JXVBQIKNSGfX5
LLp/j2wr+Kbg3QtEBkcStlUGBOzfcbhKpE2nySnuIyspfDb/6JbhD/qYqMJerX0T
d5ekkJ1tXtM6aX2iTXgZ8cqv+5gyouEF5akrkLi1ySgZetQfjm+zhy/1x/NjGd0u
35QbUye7sTbfSimwzCXKIIpy06zIO4iNA0P/vgG4v7ydjMvXsW8FRULSecDT19Gq
xOZGfSPVrSRSAhgNxHzwUivxJbr05NNdwhJSbx9m57naXouLfvVPAMeJYwARAQAB
tD9GcmVlQlNEIFNlY3VyaXR5IFRlYW0gU2VjcmV0YXJ5IDxzZWN0ZWFtLXNlY3Jl
dGFyeUBGcmVlQlNELm9yZz6JAj0EEwEKACcFAlJBjIICGwMFCQgH7b8FCwkIBwMF
FQoJCAsFFgIDAQACHgECF4AACgkQPLLq/MPWxmYt8Q/+IfFhPIbqglh4rwFzgR58
8YonMZcq+5Op3qiUBh6tE6yRz6VEqBqTahyCQGIk4xGzrHSIOIj2e6gEk5a4zYtf
0jNJprk3pxu2Og05USJmd8lPSbyBF20FVm5W0dhWMKHagL5dGS8zInlwRYxr6mMi
UuJjj+2Hm3PoUNGAwL1SH2BVOeAeudtzu80vAlbRlujYVmjIDn/dWVjqnWgEBNHT
SD+WpA3yW4mBJyxWil0sAJQbTlt5EM/XPORVZ2tvETxJIrXea/Sda9mFwvJ02pJn
gHi6TGyOYydmbu0ob9Ma9AvUrRlxv8V9eN7eZUtvNa6n+IT8WEJj2+snJlO4SpHL
D3Z+l7zwfYeM8FOdzGZdVFgxeyBU7t3AnPjYfHmoneqgLcCO0nJDKq/98ohz5T9i
FbNR/vtLaEiYFBeX3C9Ee96pP6BU26BXhw+dRSnFeyIhD+4g+/AZ0XJ1CPF19D+5
z0ojanJkh7lZn4JL+V6+mF1eOExiGrydIiiSXDA/p5FhavMMu8Om4S0sn5iaQ2aX
wRUv2SUKhbHDqhIILLeQKlB3X26obx1Vg0nRhy47qNQn/xc9oSWLAQSVOgsShQeC
6DSzrKIBdKB3V8uWOmuM7lWAoCP53bDRW+XIOu9wfpSaXN2VTyqzU7zpTq5BHX1a
+XRw8KNHZGnCSAOCofZWnKyJAhwEEAEKAAYFAlJBjYgACgkQ7Wfs1l3PaudFcQ//
UiM7EXsIHLwHxez32TzA/0uNMPWFHQN4Ezzg4PKB6Cc4amva5qbgbhoeCPuP+XPI
2ELfRviAHbmyZ/zIgqplDC4nmyisMoKlpK0Yo1w4qbix9EVVZr2ztL8F43qN3Xe/
NUSMTBgt/Jio7l5lYyhuVS3JQCfDlYGbq6NPk0xfYoYOMOZASoPhEquCxM5D4D0Z
3J3CBeAjyVzdF37HUw9rVQe2IRlxGn1YAyMb5EpR2Ij612GFad8c/5ikzDh5q6JD
tB9ApdvLkr0czTBucDljChSpFJ7ENPjAgZuH9N5Dmx2rRUj2mdBmi7HKqxAN9Kdm
+pg/6vZ3vM18rBlXmw1poQdc3srAL+6MHmIfHHrq49oksLyHwyeL8T6BO4d4nTZU
xObP7PLAeWrdrd1Sb3EWlZJ9HB/m2UL9w9Om1c6cb6X2DoCzQAStVypAE6SQCMBK
pxkWRj90L41BS62snja+BlZTELuuLTHULRkWqS3fFkUxlDSMUn96QksWlwZLcxCv
hKxJXOX+pHAiUuMIImaPQ0TBDBWWf5d8zOQlNPsyhSGFR5Skwzlg+m9ErQ+jy7Uz
UmNCNztlYgRKeckXuvr73seoKoNXHrn7vWQ6qB1IRURj2bfphsqlmYuITmcBhfFS
Dw0fdYXSDXrmG9wad98g49g4HwCJhPAl0j55f93gHLGIRgQQEQoABgUCUkGO5gAK
CRAV1ogEymzfsol4AKCI7rOnptuoXgwYx2Z9HkUKuugSRwCgkyW9pxa5EovDijEF
j1jG/cdxTOaJAhwEEAEKAAYFAlJBkdUACgkQkshDRW2mpm6aLxAAzpWNHMZVFt7e
wQnCJnf/FMLTjduGTEhVFnVCkEtI+YKarveE6pclqKJfSRFDxruZ6PHGG2CDfMig
J6mdDdmXCkN//TbIlRGowVgsxpIRg4jQVh4S3D0Nz50h+Zb7CHbjp6WAPVoWZz7b
Myp+pN7qx/miJJwEiw22Eet4Hjj1QymKwjWyY146V928BV/wDBS/xiwfg3xIVPZr
RqtiOGN/AGpMGeGQKKplkeITY7AXiAd+mL4H/eNf8b+o0Ce2Z9oSxSsGPF3DzMTL
kIX7sWD3rjy3Xe2BM20stIDrJS2a1fbnIwFvqszS3Z3sF5bLc6W0iyPJdtbQ0pt6
nekRl9nboAdUs0R+n/6QNYBkj4AcSh3jpZKe82NwnD/6WyzHWtC0SDRTVkcQWXPW
EaWLmv8VqfzdBiw6aLcxlmXQSAr0cUA6zo6/bMQZosKwiCfGl3tR4Pbwgvbyjoii
pF+ZXfz7rWWUqZ2C79hy3YTytwIlVMOnp3MyOV+9ubOsFhLuRDxAksIMaRTsO7ii
5J4z1d+jzWMW4g1B50CoQ8W+FyAfVp/8qGwzvGN7wxN8P1iR+DZjtpCt7J+Xb9Pt
L+lRKSO/aOgOfDksyt2fEKY4yEWdzq9A3VkRo1HCdUQY6SJ/qt7IyQHumxvL90F6
vbB3edrR/fVGeJsz4vE10hzy7kI1QT65Ag0EUkGMggEQAMTsvyKEdUsgEehymKz9
MRn9wiwfHEX5CLmpJAvnX9MITgcsTX8MKiPyrTBnyY/QzA0rh+yyhzkY/y55yxMP
INdpL5xgJCS1SHyJK85HOdN77uKDCkwHfphlWYGlBPuaXyxkiWYXJTVUggSjuO4b
jeKwDqFl/4Xc0XeZNgWVjqHtKF91wwgdXXgAzUL1/nwN3IglxiIR31y10GQdOQEG
4T3ufx6gv73+qbFc0RzgZUQiJykQ3tZK1+Gw6aDirgjQYOc90o2Je0RJHjdObyZQ
aQc4PTZ2DC7CElFEt2EHJCXLyP/taeLq+IdpKe6sLPckwakqtbqwunWVoPTbgkxo
Q1eCMzgrkRu23B2TJaY9zbZAFP3cpL65vQAVJVQISqJvDL8K5hvAWJ3vi92qfBcz
jqydAcbhjkzJUI9t44v63cIXTI0+QyqTQhqkvEJhHZkbb8MYoimebDVxFVtQ3I1p
EynOYPfn4IMvaItLFbkgZpR/zjHYau5snErR9NC4AOIfNFpxM+fFFJQ7W88JP3cG
JLl9dcRGERq28PDU/CTDH9rlk1kZ0xzpRDkJijKDnFIxT2ajijVOZx7l2jPL1njx
s4xa1jK0/39kh6XnrCgK49WQsJM5IflVR2JAi8BLi2q/e0NQG2pgn0QL695Sqbbp
NbrrJGRcRJD9sUkQTpMsLlQTABEBAAGJAiUEGAEKAA8FAlJBjIICGwwFCQgH7b8A
CgkQPLLq/MPWxmZAew//et/LToMVR3q6/qP/pf9ob/QwQ3MgejkC0DY3Md7JBRl/
6GWfySYnO0Vm5IoJofcv1hbhc/y3OeZTvK4s+BOQsNokYe34mCxZG4dypNaepkQi
x0mLujeU/n4Y0p0LTLjhGLVdKina2dM9HmllgYr4KumT58g6eGjxs2oZD6z5ty0L
viU5tx3lz3o0c3I9soH2RN2zNHVjXNW0EvWJwFLxFeLJbk/Y3UY1/kXCtcyMzLua
S5L5012eUOEvaZr5iYDKjy+wOxY4SUCNYf0GPmSej8CBbwHOF2XCwXytSzm6hNb3
5TRgCGbOSFTIy9MxfV5lpddQcdzijmuFSl8LySkL2yuJxjlI7uKNDN+NlfODIPMg
rdH0hBSyKci6Uz7Nz/Up3qdE+aISq68k+Hk1fiKJG1UcBRJidheds29FCzj3hoyZ
VDmf6OL60hL0YI1/4GjIkJyetlPzjMp8J7K3GweOUkfHcFihYZlbiMe7z+oIWEc7
0fNScrAGF/+JN3L6mjXKB6Pv+ER5ztzpfuhBJ/j7AV5BaNMmDXAVO4aTphWl7Dje
iecENuGTpkK8Ugv5cMJc4QJaWDkj/9sACc0EFgigPo68KjegvKg5R8jUPwb8E7T6
lIjBtlclVhaUrE2uLx/yTz2Apbm+GAmD8M0dQ7IYsOFlZNBW9zjgLLCtWDW+p1A=
=5gJ7
-----END PGP PUBLIC KEY BLOCK-----
</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pgpkey-core-secretary"></a>D.1.3. Core Team Secretary <code class="email">&lt;<a xmlns="" class="email" href="mailto:core-secretary@FreeBSD.org">core-secretary@FreeBSD.org</a>&gt;</code></h3></div></div></div><pre class="programlisting">
pub   rsa2048/0CB403E4E95B96EC 2018-06-30 [SC] [expires: 2020-06-29]
      Key fingerprint = 9F02 836F 50D3 AD5A B75A  C588 0CB4 03E4 E95B 96EC
uid                            FreeBSD Core Team Secretary &lt;core-secretary@freebsd.org&gt;
sub   rsa2048/133C3338A5B95A60 2018-06-30 [E] [expires: 2020-06-29]
      Key fingerprint = FA37 B8AA C667 C3AA D310  751D 133C 3338 A5B9 5A60

</pre><pre class="programlisting">
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQENBFs3wcYBCAC7nlaUTMqyT7PBSFLtW/LleSz7BNUwqSTo8LfUVJOY5G/pzWt5
Mqjqh4oJcW/MvKFTDeRaJ2mHp+vELxIP7wO3gcP36dXgImw6sXwBTkPlKpmmFRm1
M+QqnCCrrLHtCznWaDg+1fTHmyQpFHpg37XzA1Z5ev6PryEUYJkcBP77oNCTY933
86sXOqRAJRywvN/LEkAoaawqBz0CpkNTOBACoJZRV8i9CIklEOy8J+hNzGtJpHkg
FxUOXWj7z+2y6UOR4GzSpYAWJGbtwEcpGPfhqJk5M5eZ6PJcwzZ6LeLKgGFzNi6r
tlShQh5LT7wAKkTrBsZ9vckyyuTEtqgdGCmhABEBAAG0OEZyZWVCU0QgQ29yZSBU
ZWFtIFNlY3JldGFyeSA8Y29yZS1zZWNyZXRhcnlAZnJlZWJzZC5vcmc+iQFUBBMB
CgA+FiEEnwKDb1DTrVq3WsWIDLQD5OlbluwFAls3wcYCGwMFCQPCZwAFCwkIBwMF
FQoJCAsFFgMCAQACHgECF4AACgkQDLQD5OlbluyRZAf/VG9VWpIsofcoHwDxhYAL
mm+xbuP/eq1/Q8HeO3XVhA/HZF5nvSKZbD8F+ujaHDH/waNStWb3wUK87l9AfB6G
QFMVYjVQWrPwgpwFtGjL9zLMCBS3T+ysuub+xSuPhr1KQHgKB4+t6NLoBlSwP+76
sLLx0SILGwTpsb0r84etaECgp5ymAXijbzIB0Pu44Y+DjZimBEVuw2YRZ4/Ug/3z
pcNQqpjbrHNYjU6AOZEHXftbXwuWfgdjINnrWpvTwkKVnU0FhGXV9UYWP2UAxE5u
OyAvIyYFbX10iSFQGUXle3eg6IuHncT5u6P1IxQM++d/TJIbKrQW+xdr+1I+vUrS
rokCMwQQAQoAHRYhBHLPrCF5vLAktbVFkANvbJ7n856/BQJbOJDdAAoJEANvbJ7n
856/1swQAN2QKGe1riRm9jKVxC8AMy57+Tzu1ITGDDUf6dH2+gxx0K5GoVmtdhLL
2qrmDJEqP7K232T25cU5zStQnaTHpEIUklY8Rn1Fati8+IZBdpemG4BXTzGnNDQ0
FS6PxuxOFvcELOFvuUil3PP7ArMKI9jfjxisEkOWFuwQVyIPeApcQuf8vyqrfTnV
/Qes/XhySrvsEL+ehq2OEorl6YjMB2/lVK2lVWYrWJ91Oq8Vwp0G09whZEMhMabQ
D1OxlmM6kofkTioM8DOmbGTbOXhiiiiCUI41pOAOzF9SrCqCpLV2OyrPFz7J+GU9
6u+DPPZyy7O8NmjdDsyrDg2hhbTwWC4dvW+QMJSWZ8Bo8eMx8b5ti9RX0XPEIwao
KrCKh3aemGgkP8zcVbFWOzOji8aXrpWrRr/oxQmJxE49d2j1oF4LydIfhDxOnfOF
428pVhDXDLjf0xdUIVQqCsOBQvzwVPWTQVOFSakVFNRYP6/SXyF5eUf5E6iSExKn
fn+G4FtrJd6QNwNUquI2LF8CEhJBpLNBqjJW3WEv1tDzU+rqS9QpHzSmLzLqtiE+
5HqynvOPXGRRsAcUOLmV4fMUGRH8tpNoH4iBEc7LmoFTQXIf6oJClaiwRkFKuT9c
2XlkJ4ca6fxU4KyoHtR6pmMNkLIcehfpoL11+TPyyBjNd2TwLpLbiQIzBBABCgAd
FiEEwHv14xCuZL9hILD2NqfAX+Hs+bsFAls4kV0ACgkQNqfAX+Hs+bvRrw//QVea
9diHHbzxq84yp4eOGQoj86usPSV+IOZN27+e6QDYR8ZsxqFE5wQycSAdyqo0n42Q
EDE6tnn+/HhyFogr7kF8CRJMtsSlwKgDrMMYjVPnP2fP5VFxAF36epSRgcGC0Lqh
Ris+xjfSzXM2oNiiebPu2MOe8qOe8LVGJMyuxJZbb/OuEfgLGLKtjcJ1SujKhzLl
TVS8JSSVRbxk62huh/Mo80eCKHMV+/NmbHP4QKZBOVSWn0U/lrm+SyDR78l3EhtN
x/KIfhiPZENYTjSBSxa8F/Vg19bcmUedLapcN9J8q2KVNx7VuiPz+X2ww/dOKFR0
FxwOvCweGFRNRyoytF4ziw0Gwt78RHw4OdhQg8YH38kbrRFvf2YqiddGUA2UWwKi
HRdj9ZGemzL++OE/MZvgODVhZA6V5QU/B9bR3xfnVcBsPyGTrlQ8XZ9aY1wBMTrS
TTbS3sD7HuyS4PO8rt3iZy50UDMc5v55Pr5SIPiaUdyV8Y401oOWnKvKgKtHzBtC
2ADT+iZk/I4a3iDj4hw07Y+O1Voqp72LaACGhqWqkN0zqoKq3TvD/ukEZwgsvDdP
ErzPUanN31gn055PlpWYQBVoLjupH8SXahrdTmo15Xjdr97VHCuABNT4Kh3QDELU
vQtF0IB+S+VQfTVR5wkC1OLj8J1edvoXlsVzREW5AQ0EWzfBxgEIAMZxwaI3hZ2G
je7L8N1TFfPJA62kMGzzFDvFqeH8mDPOXkd4JC4y2EIBySPS36y0c1MJM79oOkKI
6DQLyUb3p4hGZbEVKidAwXvp4t5x1QJ0bpodHc/7xh95EP11Lf8C/DFP5Js3YVPl
MsdeVhx7J8itQuivoLJrZVTgKSgFepatLuXXKUttYAJNcU11ziPwTlzjEuTx4X6V
RimPrp8+/dbkRmPhsDqMXrqJmjeNarYK9F0xKlaWnIhtyZnNXtHrdtQE/VOBjoXN
0NXiuJg02JZGqZuBM80Ig7yBdmUlZdPrxkYw92+kxHIdySM3+WYbGu/e6T/VY6wx
7KW2IV3u3b8AEQEAAYkBPAQYAQoAJhYhBJ8Cg29Q061at1rFiAy0A+TpW5bsBQJb
N8HGAhsMBQkDwmcAAAoJEAy0A+TpW5bsp0AH/Rht32xeJQk59UgDf7BPHiiphgg8
P1qmRVd6OZJ6GoVYWjJ87+gU9sChbZUTCFioiIYLWPbhm9AJKy1KDrcnP0zYjWL2
SKjezMbru9cgFYk6R3LO+mK5DwtGMgyzipKAN8Kh92pX2WERUeMFulkYa4+rdVkP
kBtB49hmDj25GPw/72Vuksg5m7sbpEZzt6JjXQN0ynDjBuizE/HYm2E8VW5tH1aH
wdzVGruNVIOMMF3gHKbJbrxKiq/SPJfph0YGeL6v5bF9mgizGamEUn9YHVkCqZ7z
wDuSIDVTSiQQOJesD58WOADCDINEP3uXFhlI1A0Au7X+XYyjIjHCdyTNhBI=
=5VKx
-----END PGP PUBLIC KEY BLOCK-----
</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pgpkey-portmgr-secretary"></a>D.1.4. Ports Management Team Secretary <code class="email">&lt;<a xmlns="" class="email" href="mailto:portmgr-secretary@FreeBSD.org">portmgr-secretary@FreeBSD.org</a>&gt;</code></h3></div></div></div><pre class="programlisting">
pub   rsa2048/D8294EC3BBC4D7D5 2012-07-24 [SC]
      Key fingerprint = FB37 45C8 6F15 E8ED AC81  32FC D829 4EC3 BBC4 D7D5
uid                            FreeBSD Ports Management Team Secretary &lt;portmgr-secretary@FreeBSD.org&gt;
sub   rsa2048/5CC117965F65CFE7 2012-07-24 [E]

</pre><pre class="programlisting">
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQENBFAOzqYBCACYd+KGv0/DduIRpSEKWZG2yfDILStzWfdaQMD+8zdWihB0x7dd
JDBUpV0o0Ixzt9mvu5CHybx+9lOHeFRhZshFXc+bIJOPyi+JrSs100o7Lo6jg6+c
Si2vME0ixG4x9YjCi8DisXIGJ1kZiDXhmVWwCvL+vLInpeXrtJnK8yFkmszCOr4Y
Q3GXuvdU0BF2tL/Wo/eCbSf+3U9syopVS2L2wKcP76bbYU0ioO35Y503rJEK6R5G
TchwYvYjSXuhv4ec7N1/j3thrMC9GNpoqjVninTynOk2kn+YZuMpO3c6b/pfoNcq
MxoizGlTu8VT4OO/SF1y52OkKjpAsENbFaNTABEBAAG0R0ZyZWVCU0QgUG9ydHMg
TWFuYWdlbWVudCBUZWFtIFNlY3JldGFyeSA8cG9ydG1nci1zZWNyZXRhcnlARnJl
ZUJTRC5vcmc+iQE4BBMBAgAiBQJQDs6mAhsDBgsJCAcDAgYVCAIJCgsEFgIDAQIe
AQIXgAAKCRDYKU7Du8TX1QW2B/0coHe8utbTfGKpeM4BY9IyC+PFgkE58Hq50o8d
shoB9gfommcUaK9PNwJPxTEJNlwiKPZy+VoKs/+dO8gahovchbRdSyP1ejn3CFy+
H8pol0hDDU4n7Ldc50q54GLuZijdcJZqlgOloZqWOYtXFklKPZjdUvYN8KHAntgf
u361rwM4DZ40HngYY9fdGc4SbXurGA5m+vLAURLzPv+QRQqHfaI1DZF6gzMgY49x
qS1JBF4kPoicpgvs3o6CuX8MD9ewGFSAMM3EdzV6ZdC8pnpXC8+8Q+p6FjNqmtjk
GpW39Zq/p8SJVg1RortCH6qWLe7dW7TaFYov7gF1V/DYwDN5iEYEEBECAAYFAlN2
WksACgkQtzkaJjSHbFtuMwCg0MXdQTcGMMOma7LC3L5b4MEoZ+wAn0WyUHpHwHnn
pn2oYDlfAbwTloWIiQEcBBABAgAGBQJQDuVrAAoJENk3EJekc8mQ3KwIAImNDMXA
F8ajPwCZFpM6KDi3F/jpwyBPISGY1oWuYPEi1zN94k5jS90aZb3W8Y8x4JTh35Ew
b6XODi3uGLSLCmnlqu2a80yPfXf5IuWmIQdFNQxvosj9UHrg+icZGFmm+f0hPJxM
TsZREv3AvivQfnb/N3xIICxW4SjKSYXQcq4hr4ObhUx7GKnjayq+ofU2cRlujr87
uOH0fO3xhOJG4+cX5mI1HGK38k0Csc1zqYa/66Qe5dnIZz+sNXpEPMLAHIt1a45U
B967igJdZSDFN33bPl1QWmf3aUXU3d1VttiSyHkpm4kb9KgsDkUk1IJ5nUe9OXyd
WtoqNW5afDa5N0aIRgQQEQIABgUCUA7lwwAKCRB59uBxdBRinNh2AJ41+zfsaQSR
HWvSkqOXGcP/fgOduwCfUJDT+M1eXe2udmKof/9yzGYMirKJASIEEAECAAwFAlAa
IT8FAwASdQAACgkQlxC4m8pXrXwCHAf+J7l+L7AvRpqlQcezjnjFS/zG1098qkDf
lThHZlpVnrBMJZaXdvL6LzVgiIYVWZC5CSSazW9EWFjp9VjM7FBHdWFZNMV7GAuU
t0jzx6gGXOWwi+/v/hs1P11RyDZN5hICHdPNmyZVupciDxe+sIEP9aEbVxcaiccq
zM/pFzIVIMMP5tCiA42q6Mz3h0hy6hntUKptS8Uon6sje5cDVcVlKAUj1wO2cphC
qkYlwMQfZV5J9f/hcW5ODriD3cBwK8SocA2Cq5JYF8kYDL1+pXnUutGnvAHUYt87
RWvQdKmfXjzBcMFJ2LlPUB1+IFvwQ13V9R8j9B/EdLmSWQYT9qRA2okCHAQTAQoA
BgUCV1XMpwAKCRCtu/hhCjeJt2CyD/9JLe+Ck23CJkeRSF8oC+4SFOUdSAmejSzn
klPwmEClffABYd/kckO1T6um+2FUcXuJZQE1nKKUNvZ8pBWwsm1RDHsyroKi/XB1
0a1Tdx/rvlU88ytbeLfUCLzoCrf6pkMQWoU6/3qS6elV0WwOlDufk+XjD1sja2wu
sshG8y+1WCA5JjP3rZdD9NVdzo5DgkotTRUfuYN1LJIN4zlDgHj7FVP7wW7+R0cZ
FoOiNsLJCA0FN8SiyU98UysjawLiIY9dTJz6XVA0DgB0TZWO3mWiDjITeKrdGcqf
PNiJhmvUKBkn07YpTPNfkoTT/p/q5ChYmu0ubGeyS1ELKjmklJ+DzynfZLzvnXYX
Ngo5ckeuqEqUNxM0J63v8lmfhDRROFveqHWdp0XMxXVmR5bMunSldg5EZsoLyQbN
+ScIPnDTAEPGrCtf0t84RQxNQeET6/WBbZfzeSeAFmpBFCdicsZ6Mjwtwjr4+o15
n1QMTZco1NaTqf8vXwzl9wM4aYtg1OkF4z8HdHuy50CHCet4mT5eJgwZUfFvXdbM
pHXprEI0Y9OOL4aMinC1egF3dXt/0n57i6CE+E2k3UJPNvMrtp0HaDEnKZ8cfkBU
EBzkUYi5wwqntHV2JRisqoRnHdvJT7ImlHMe7WaJsifBK874PnToaKg8P6K1Tph+
FyLxULaYjYkCHAQSAQgABgUCVBg2zwAKCRDqsDxYv9xHj1klEADXYJdHC3zsdx7w
DsJsttWdykcZoOd/VUKUdN0BAU72nLV0tLn4uFjETA6MhHZVxzwIDTeLB8kqyEpc
fZnoVbqJIUJz1sJXMdOty7CwZzlZlAwmUaIfFiazJY1p398JbyYfSrVKNOpw9wCm
Db7WP9dBritwvjaLzu8HQsiztO0S/5ha/EDfTU3qocBUTjbCtGR9LqAmPE4X8+li
F2EfZMEoJd3rJWsYv2y/k6pSgC/MpQewnyr6f+JQ/781UoZB6PpxCxfu4D6xlOyd
ERBUg+FfDAWYR+KX+DGOalRlUyaSz8Nvxl8/b0Im/AQhx9afqyEZxIDpg52zt8jJ
t3wx23YP8EQGUgwF8pIrj3wFSBSG3a/cskiBNUIhChIR9hQrVPUahN/jx7DGAGxk
/Ka9qsRGYTHfSr9jjTUQ+htfeFBRDR0nkZKMo5+Wk/cAcBKVbPlBpwvnzT3fh+wL
cF3ErBbx5jp+BoFee8D6ATeUvQxMcgVbDPUkgMsy3EtKMVO10jhIoXoVV+Sg9GZ8
zMEy1tORKn0zsd2ZgXC2sRJOm5ttCSdYQ4ddbM1A9jg6tiRx4hES16GDywvkL8P2
M9+qyIfjQxjGU33f/r8zp9DyNT1VlrtwhFxtOoMdmrsbYOCTja4Xg14hK1hRac0k
GB7bj6w97p8uMrQT3PlSMtoyrRyo7bkBDQRQDs6mAQgAzNxJYpf5PrqV8pdRXkn3
6Fe45q671YtbZ2WrT7D0CVZ8Z+AZsxnP/tiY1SrM2MepCeA2xBAhKGsWBWo1aRk5
mfZOksKsiXsi2XeBVhdZlCkrOMKBTVian7I1lH59ZnNIMX0Nl0tlj3L1IjeWWNvf
ej43URV81S9EmSwpjaWboatr2A+1oJku5m7nPD9JIOckE1TzBsyhx7zIUN9w6MKr
7gFw8DCzypwUKyYgKYToVm8QlkT/L3B0fuQHWhT6ROGk4o8SC71ia5tc1TzUzGEZ
1AQO8bbnbmJLBDKveWHCoaeAkRzINzoD9wAn9z4pnilze59QtKC1cOqUksTvBSDh
6wARAQABiQEfBBgBAgAJBQJQDs6mAhsMAAoJENgpTsO7xNfVOHoH/i5VyggVdwpq
PX8YBmN5mXQziYZNQoiON8IhOsxpX4W2nXCj5m6MACV6nJDVV6wyUH8/VvDQC9nH
arCe1oaNsHXJz0HamYt5gHJ0G1bYuBcuJp/FEjLa48XFI7nXQjJHn8rlwZMjK/PW
j1lw2WZiekviuzTEDH8c3YStGJSa+gYe8Eyq3XJVAe2VQOhImoWgGDR3tWfgrya/
IdEFb/jmjHSG5XUfbI0vNwqlf832BqSQKPG/Zix4MmBJgvAz4R71PH8WBmbmNFjD
elxVyfz80+iMgEb9aL91MfeBNC2KB1pFmg91mQTsiq7ajwVLVJK8NplHAkdLmkBC
O8MgMjzGhlE=
=iw7d
-----END PGP PUBLIC KEY BLOCK-----
</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pgpkey-doceng-secretary"></a>D.1.5. <code class="email">&lt;<a xmlns="" class="email" href="mailto:doceng-secretary@FreeBSD.org">doceng-secretary@FreeBSD.org</a>&gt;</code></h3></div></div></div><pre class="programlisting">
pub   rsa2048/E1C03580AEB45E58 2019-10-31 [SC] [expires: 2022-10-30]
      Key fingerprint = F24D 7B32 B864 625E 5541  A0E4 E1C0 3580 AEB4 5E58
uid                            FreeBSD Doceng Team Secretary &lt;doceng-secretary@freebsd.org&gt;
sub   rsa2048/9EA8D713509472FC 2019-10-31 [E] [expires: 2022-10-30]

</pre><pre class="programlisting">
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQENBF27FFcBCADeoSsIgyQUY8vREwkTikwFFlNg31MVy5s/Nq1cNK1PRfRMnprS
yfB62KqbYuz16bmQKaA9zHN4FGfiTvR6tl66LVHm1s/5HPiLv8sP14GsruLro9zN
v72dO7a9i68bMw+jarPOnu9dGiDFEI0dACOkdCGEYKEUapQeNpmWRrQ46BeXyFwF
JcNx76bJJUkwk6fWC0W63D762e6lCEX6ndoaPjjLBnFvtx13heNGUc8RukBwe2mA
U5pSGHj47J05bdWiRSwZaXa8PcW+20zTWaP755w7zWe4h60GANY7OsT9nuOqsioJ
QonxTrJuZweKRV8fNQ1EfDws3HZr7/7iXvO3ABEBAAG0PEZyZWVCU0QgRG9jZW5n
IFRlYW0gU2VjcmV0YXJ5IDxkb2Nlbmctc2VjcmV0YXJ5QGZyZWVic2Qub3JnPokB
VAQTAQoAPhYhBPJNezK4ZGJeVUGg5OHANYCutF5YBQJduxRXAhsDBQkFo5qABQsJ
CAcDBRUKCQgLBRYDAgEAAh4BAheAAAoJEOHANYCutF5YB2IIALw+EPYmOz9qlqIn
oTFmk/5MrcdzC5iLEfxubbF6TopDWsWPiOh5mAuvfEmROSGf6ctvdYe9UtQV3VNY
KeeyskeFrIBOFo2KG/dFqKPAWef6IfhbW3HWDWo5uOBg01jHzQ/pB1n6SMKiXfsM
idL9wN+UQKxF3Y7S/bVrZTV0isRUolO9+8kQeSYT/NMojVM0H2fWrTP/TaNEW4fY
JBDAl5hsktzdl8sdbNqdC0GiX3xb4GvgVzGGQELagsxjfuXk6PfOyn6Wx2d+yRcI
FrKojmhihBp5VGFQkntBIXQkaW0xhW+WBGxwXdaAl0drQlZ3W+edgdOl705x73kf
Uw3Fh2a5AQ0EXbsUVwEIANEPAsltM4vFj2pi5xEuHEcZIrIX/ZJhoaBtZkqvkB+H
4pu3/eQHK5hg0Dw12ugffPMz8mi57iGNI9TXd8ZYMJxAdvEZSDHCKZTX9G+FcxWa
/AzKNiG25uSISzz7rMB/lV1gofCdGtpHFRFTiNxFcoacugTdlYDiscgJZMJSg/hC
GXBdEKXR5WRAgAGandcL8llCToOt1lZEOkd5vJM861w6evgDhAZ2HGhRuG8/NDxG
r4UtlnYGUCFof/Q4oPNbDJzmZXF+8OQyTNcEpVD3leEOWG1Uv5XWS2XKVHcHZZ++
ISo/B5Q6Oi3SJFCVV9f+g09YF+PgfP/mVMBgif2fT20AEQEAAYkBPAQYAQoAJhYh
BPJNezK4ZGJeVUGg5OHANYCutF5YBQJduxRXAhsMBQkFo5qAAAoJEOHANYCutF5Y
kecIAMTh2VHQqjXHTszQMsy3NjiTVVITI3z+pzY0u2EYmLytXQ2pZMzLHMcklmub
5po0X4EvL6bZiJcLMI2mSrOs0Gp8P3hyMI40IkqoLMp7VA2LFlPgIJ7K5W4oVwf8
khY6lw7qg2l69APm/MM3xAyiL4p6MU8tpvWg5AncZ6lxyy27rxVflzEtCrKQuG/a
oVaOlMjH3uxvOK6IIxlhvWD0nKs/e2h2HIAZ+ILE6ytS5ZEg2GXuigoQZdEnv71L
xyvE9JANwGZLkDxnS5pgN2ikfkQYlFpJEkrNTQleCOHIIIp8vgJngEaP51xOIbQM
CiG/y3cmKQ/ZfH7BBvlZVtZKQsI=
=MQKT
-----END PGP PUBLIC KEY BLOCK-----
</pre></div></div></div></div><div class="glossary"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsd-glossary"></a>FreeBSD 詞彙表</h1></div></div></div><p xml:lang="en" lang="en">This glossary contains terms and acronyms used within the FreeBSD
    community and documentation.</p><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">A</h3><dl><dt><span xml:lang="en" class="glossterm" lang="en">ACL</span></dt><dd><p>參見 <a class="glosssee" href="#acl-glossary">Access Control List</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">ACPI</span></dt><dd><p>參見 <a class="glosssee" href="#acpi-glossary">Advanced Configuration and Power Interface</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">AMD</span></dt><dd><p>參見 <a class="glosssee" href="#amd-glossary">Automatic Mount Daemon</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">AML</span></dt><dd><p>參見 <a class="glosssee" href="#aml-glossary"><acronym class="acronym">ACPI</acronym> Machine Language</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">API</span></dt><dd><p>參見 <a class="glosssee" href="#api-glossary">Application Programming Interface</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">APIC</span></dt><dd><p>參見 <a class="glosssee" href="#apic-glossary">Advanced Programmable Interrupt Controller</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">APM</span></dt><dd><p>參見 <a class="glosssee" href="#apm-glossary">Advanced Power Management</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">APOP</span></dt><dd><p>參見 <a class="glosssee" href="#apop-glossary">Authenticated Post Office Protocol</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">ASL</span></dt><dd><p>參見 <a class="glosssee" href="#asl-glossary"><acronym class="acronym">ACPI</acronym> Source Language</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">ATA</span></dt><dd><p>參見 <a class="glosssee" href="#ata-glossary">Advanced Technology Attachment</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">ATM</span></dt><dd><p>參見 <a class="glosssee" href="#atm-glossary">Asynchronous Transfer Mode</a>.</p></dd><dt><a id="aml-glossary"></a><span xml:lang="en" class="glossterm" lang="en"><acronym class="acronym">ACPI</acronym> Machine Language</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">Pseudocode, interpreted by a virtual machine within an
	  <acronym class="acronym">ACPI</acronym>-compliant operating system, providing a
	  layer between the underlying hardware and the documented
	  interface presented to the <acronym class="acronym">OS</acronym>.</p></dd><dt><a id="asl-glossary"></a><span xml:lang="en" class="glossterm" lang="en"><acronym class="acronym">ACPI</acronym> Source Language</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">The programming language <acronym class="acronym">AML</acronym> is written in.</p></dd><dt><a id="acl-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Access Control List</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A list of permissions attached to an object, usually either a
	  file or a network device.</p></dd><dt><a id="acpi-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Advanced Configuration and Power Interface</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A specification which provides an abstraction of the
	  interface the hardware presents to the operating system, so
	  that the operating system should need to know nothing about
	  the underlying hardware to make the most of it.  <acronym class="acronym">ACPI</acronym>
	  evolves and supersedes the functionality provided previously by
	  <acronym class="acronym">APM</acronym>, <acronym class="acronym">PNPBIOS</acronym> and other technologies, and
	  provides facilities for controlling power consumption, machine
	  suspension, device enabling and disabling, etc.</p></dd><dt><a id="api-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Application Programming Interface</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A set of procedures, protocols and tools that specify the
	  canonical interaction of one or more program parts; how, when
	  and why they do work together, and what data they share or
	  operate on.</p></dd><dt><a id="apm-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Advanced Power Management</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">An <acronym class="acronym">API</acronym> enabling the operating system to work
	  in conjunction with the <acronym class="acronym">BIOS</acronym> in order to achieve
	  power management.  <acronym class="acronym">APM</acronym> has been superseded by
	  the much more generic and powerful <acronym class="acronym">ACPI</acronym>
	  specification for most applications.</p></dd><dt><a id="apic-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Advanced Programmable Interrupt Controller</span></dt><dd class="glossdef"><p></p></dd><dt><a id="ata-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Advanced Technology Attachment</span></dt><dd class="glossdef"><p></p></dd><dt><a id="atm-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Asynchronous Transfer Mode</span></dt><dd class="glossdef"><p></p></dd><dt><a id="apop-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Authenticated Post Office Protocol</span></dt><dd class="glossdef"><p></p></dd><dt><a id="amd-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Automatic Mount Daemon</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A daemon that automatically mounts a filesystem when a file
          or directory within that filesystem is accessed.</p></dd></dl></div><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">B</h3><dl><dt><span xml:lang="en" class="glossterm" lang="en">BAR</span></dt><dd><p>參見 <a class="glosssee" href="#bar-glossary">Base Address Register</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">BIND</span></dt><dd><p>參見 <a class="glosssee" href="#bind-glossary">Berkeley Internet Name Domain</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">BIOS</span></dt><dd><p>參見 <a class="glosssee" href="#bios-glossary">Basic Input/Output System</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">BSD</span></dt><dd><p>參見 <a class="glosssee" href="#bsd-glossary">Berkeley Software Distribution</a>.</p></dd><dt><a id="bar-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Base Address Register</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">The registers that determine which address range a <acronym class="acronym">PCI</acronym> device
	  will respond to.</p></dd><dt><a id="bios-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Basic Input/Output System</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">The definition of <acronym class="acronym">BIOS</acronym> depends a bit on
	  the context. Some people refer to it as the <acronym class="acronym">ROM</acronym>
	  chip with a basic set of routines to provide an interface between
	  software and hardware.  Others refer to it as the set of routines
	  contained in the chip that help in bootstrapping the system.  Some
	  might also refer to it as the screen used to configure the
	  bootstrapping process. The <acronym class="acronym">BIOS</acronym> is PC-specific
	  but other systems have something similar.</p></dd><dt><a id="bind-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Berkeley Internet Name Domain</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">An implementation of the <acronym class="acronym">DNS</acronym> protocols.</p></dd><dt><a id="bsd-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Berkeley Software Distribution</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">This is the name that the Computer Systems Research Group
	  (CSRG) at <a class="link" href="http://www.berkeley.edu" target="_top">The University
	  of California at Berkeley</a>
	  gave to their improvements and modifications to
	  AT&amp;T's 32V <span class="trademark">UNIX</span>®.
	  FreeBSD is a descendant of the CSRG work.</p></dd><dt><a id="bikeshed-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Bikeshed Building</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A phenomenon whereby many people will give an opinion on
	  an uncomplicated topic, whilst a complex topic receives little
	  or no discussion.  See the
	  <a class="link" href="../../../../doc/en_US.ISO8859-1/books/faq/misc.html#BIKESHED-PAINTING" target="_top">FAQ</a> for
	  the origin of the term.</p></dd></dl></div><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">C</h3><dl><dt><span xml:lang="en" class="glossterm" lang="en">CD</span></dt><dd><p>參見 <a class="glosssee" href="#cd-glossary">Carrier Detect</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">CHAP</span></dt><dd><p>參見 <a class="glosssee" href="#chap-glossary">Challenge Handshake Authentication Protocol</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">CLIP</span></dt><dd><p>參見 <a class="glosssee" href="#clip-glossary">Classical <acronym class="acronym">IP</acronym> over <acronym class="acronym">ATM</acronym></a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">COFF</span></dt><dd><p>參見 <a class="glosssee" href="#coff-glossary">Common Object File Format</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">CPU</span></dt><dd><p>參見 <a class="glosssee" href="#cpu-glossary">Central Processing Unit</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">CTS</span></dt><dd><p>參見 <a class="glosssee" href="#cts-glossary">Clear To Send</a>.</p></dd><dt><a id="cd-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Carrier Detect</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">An <acronym class="acronym">RS232C</acronym> signal indicating that a carrier
	  has been detected.</p></dd><dt><a id="cpu-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Central Processing Unit</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">Also known as the processor.  This is the brain of the
	  computer where all calculations take place.  There are a number of
	  different architectures with different instruction sets.  Among
	  the more well-known are the Intel-x86 and derivatives, Sun SPARC,
	  PowerPC, and Alpha.</p></dd><dt><a id="chap-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Challenge Handshake Authentication Protocol</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A method of authenticating a user, based on a secret shared
	  between client and server.</p></dd><dt><a id="clip-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Classical <acronym class="acronym">IP</acronym> over <acronym class="acronym">ATM</acronym></span></dt><dd class="glossdef"><p></p></dd><dt><a id="cts-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Clear To Send</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">An <acronym class="acronym">RS232C</acronym> signal giving the remote system
          permission to send data.</p><p>另參見 <a class="glossseealso" href="#rts-glossary">Request To Send</a>.</p></dd><dt><a id="coff-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Common Object File Format</span></dt><dd class="glossdef"><p></p></dd></dl></div><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">D</h3><dl><dt><span xml:lang="en" class="glossterm" lang="en">DAC</span></dt><dd><p>參見 <a class="glosssee" href="#dac-glossary">Discretionary Access Control</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">DDB</span></dt><dd><p>參見 <a class="glosssee" href="#ddb-glossary">Debugger</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">DES</span></dt><dd><p>參見 <a class="glosssee" href="#des-glossary">Data Encryption Standard</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">DHCP</span></dt><dd><p>參見 <a class="glosssee" href="#dhcp-glossary">Dynamic Host Configuration Protocol</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">DNS</span></dt><dd><p>參見 <a class="glosssee" href="#dns-glossary">Domain Name System</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">DSDT</span></dt><dd><p>參見 <a class="glosssee" href="#dsdt-glossary">Differentiated System Description Table</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">DSR</span></dt><dd><p>參見 <a class="glosssee" href="#dsr-glossary">Data Set Ready</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">DTR</span></dt><dd><p>參見 <a class="glosssee" href="#dtr-glossary">Data Terminal Ready</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">DVMRP</span></dt><dd><p>參見 <a class="glosssee" href="#dvmrp-glossary">Distance-Vector Multicast Routing Protocol</a>.</p></dd><dt><a id="dac-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Discretionary Access Control</span></dt><dd class="glossdef"><p></p></dd><dt><a id="des-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Data Encryption Standard</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A method of encrypting information, traditionally used as the
	  method of encryption for <span class="trademark">UNIX</span>® passwords and the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=crypt&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">crypt</span>(3)</span></a>
	  function.</p></dd><dt><a id="dsr-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Data Set Ready</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">An <acronym class="acronym">RS232C</acronym> signal sent from the modem to the
	  computer or terminal indicating a readiness to send and receive
	  data.</p><p>另參見 <a class="glossseealso" href="#dtr-glossary">Data Terminal Ready</a>.</p></dd><dt><a id="dtr-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Data Terminal Ready</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">An <acronym class="acronym">RS232C</acronym> signal sent from the computer or
	  terminal to the modem indicating a readiness to send and receive
	  data.</p></dd><dt><a id="ddb-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Debugger</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">An interactive in-kernel facility for examining the status of
	  a system, often used after a system has crashed to establish the
	  events surrounding the failure.</p></dd><dt><a id="dsdt-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Differentiated System Description Table</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">An <acronym class="acronym">ACPI</acronym> table, supplying basic configuration
	  information about the base system.</p></dd><dt><a id="dvmrp-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Distance-Vector Multicast Routing Protocol</span></dt><dd class="glossdef"><p></p></dd><dt><a id="dns-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Domain Name System</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">The system that converts humanly readable hostnames (i.e.,
	  mail.example.net) to Internet addresses and vice versa.</p></dd><dt><a id="dhcp-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Dynamic Host Configuration Protocol</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A protocol that dynamically assigns IP addresses to a computer
	  (host) when it requests one from the server.  The address assignment
	  is called a <span class="quote">“<span class="quote">lease</span>”</span>.</p></dd></dl></div><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">E</h3><dl><dt><span xml:lang="en" class="glossterm" lang="en">ECOFF</span></dt><dd><p>參見 <a class="glosssee" href="#ecoff-glossary">Extended <acronym class="acronym">COFF</acronym></a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">ELF</span></dt><dd><p>參見 <a class="glosssee" href="#elf-glossary">Executable and Linking Format</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">ESP</span></dt><dd><p>參見 <a class="glosssee" href="#esp-glossary">Encapsulated Security Payload</a>.</p></dd><dt><a id="esp-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Encapsulated Security Payload</span></dt><dd class="glossdef"><p></p></dd><dt><a id="elf-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Executable and Linking Format</span></dt><dd class="glossdef"><p></p></dd><dt><a id="ecoff-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Extended <acronym class="acronym">COFF</acronym></span></dt><dd class="glossdef"><p></p></dd></dl></div><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">F</h3><dl><dt><span xml:lang="en" class="glossterm" lang="en">FADT</span></dt><dd><p>參見 <a class="glosssee" href="#fadt-glossary">Fixed <acronym class="acronym">ACPI</acronym> Description Table</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">FAT</span></dt><dd><p>參見 <a class="glosssee" href="#fat-glossary">File Allocation Table</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">FAT16</span></dt><dd><p>參見 <a class="glosssee" href="#fat16-glossary">File Allocation Table (16-bit)</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">FTP</span></dt><dd><p>參見 <a class="glosssee" href="#ftp-glossary">File Transfer Protocol</a>.</p></dd><dt><a id="fat-glossary"></a><span xml:lang="en" class="glossterm" lang="en">File Allocation Table</span></dt><dd class="glossdef"><p></p></dd><dt><a id="fat16-glossary"></a><span xml:lang="en" class="glossterm" lang="en">File Allocation Table (16-bit)</span></dt><dd class="glossdef"><p></p></dd><dt><a id="ftp-glossary"></a><span xml:lang="en" class="glossterm" lang="en">File Transfer Protocol</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A member of the family of high-level protocols implemented
	  on top of <acronym class="acronym">TCP</acronym> which can be used to transfer
	  files over a <acronym class="acronym">TCP/IP</acronym> network.</p></dd><dt><a id="fadt-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Fixed <acronym class="acronym">ACPI</acronym> Description Table</span></dt><dd class="glossdef"><p></p></dd></dl></div><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">G</h3><dl><dt><span xml:lang="en" class="glossterm" lang="en">GUI</span></dt><dd><p>參見 <a class="glosssee" href="#gui-glossary">Graphical User Interface</a>.</p></dd><dt><a id="giant-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Giant</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">The name of a mutual exclusion mechanism
	  (a <code class="literal">sleep mutex</code>) that protects a large
	  set of kernel resources.  Although a simple locking mechanism
	  was adequate in the days where a machine might have only
	  a few dozen processes, one networking card, and certainly
	  only one processor, in current times it is an unacceptable
	  performance bottleneck.  FreeBSD developers are actively working
	  to replace it with locks that protect individual resources,
	  which will allow a much greater degree of parallelism for
	  both single-processor and multi-processor machines.</p></dd><dt><a id="gui-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Graphical User Interface</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A system where the user and computer interact with
          graphics.</p></dd></dl></div><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">H</h3><dl><dt><span xml:lang="en" class="glossterm" lang="en">HTML</span></dt><dd><p>參見 <a class="glosssee" href="#html-glossary">HyperText Markup Language</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">HUP</span></dt><dd><p>參見 <a class="glosssee" href="#hup-glossary">HangUp</a>.</p></dd><dt><a id="hup-glossary"></a><span xml:lang="en" class="glossterm" lang="en">HangUp</span></dt><dd class="glossdef"><p></p></dd><dt><a id="html-glossary"></a><span xml:lang="en" class="glossterm" lang="en">HyperText Markup Language</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">The markup language used to create web pages.</p></dd></dl></div><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">I</h3><dl><dt><span xml:lang="en" class="glossterm" lang="en">I/O</span></dt><dd><p>參見 <a class="glosssee" href="#io-glossary">Input/Output</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">IASL</span></dt><dd><p>參見 <a class="glosssee" href="#iasl-glossary">Intel’s <acronym class="acronym">ASL</acronym> compiler</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">IMAP</span></dt><dd><p>參見 <a class="glosssee" href="#imap-glossary">Internet Message Access Protocol</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">IP</span></dt><dd><p>參見 <a class="glosssee" href="#ip-glossary">Internet Protocol</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">IPFW</span></dt><dd><p>參見 <a class="glosssee" href="#ipfw-glossary"><acronym class="acronym">IP</acronym> Firewall</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">IPP</span></dt><dd><p>參見 <a class="glosssee" href="#ipp-glossary">Internet Printing Protocol</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">IPv4</span></dt><dd><p>參見 <a class="glosssee" href="#ipv4-glossary"><acronym class="acronym">IP</acronym> Version 4</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">IPv6</span></dt><dd><p>參見 <a class="glosssee" href="#ipv6-glossary"><acronym class="acronym">IP</acronym> Version 6</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">ISP</span></dt><dd><p>參見 <a class="glosssee" href="#isp-glossary">Internet Service Provider</a>.</p></dd><dt><a id="ipfw-glossary"></a><span xml:lang="en" class="glossterm" lang="en"><acronym class="acronym">IP</acronym> Firewall</span></dt><dd class="glossdef"><p></p></dd><dt><a id="ipv4-glossary"></a><span xml:lang="en" class="glossterm" lang="en"><acronym class="acronym">IP</acronym> Version 4</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">The <acronym class="acronym">IP</acronym> protocol version 4, which uses 32 bits
	  for addressing.  This version is still the most widely used, but it
	  is slowly being replaced with <acronym class="acronym">IPv6</acronym>.</p><p>另參見 <a class="glossseealso" href="#ipv6-glossary"><acronym class="acronym">IP</acronym> Version 6</a>.</p></dd><dt><a id="ipv6-glossary"></a><span xml:lang="en" class="glossterm" lang="en"><acronym class="acronym">IP</acronym> Version 6</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">The new <acronym class="acronym">IP</acronym> protocol. Invented because the
	  address space in <acronym class="acronym">IPv4</acronym> is running out.  Uses 128
	  bits for addressing.</p></dd><dt><a id="io-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Input/Output</span></dt><dd class="glossdef"><p></p></dd><dt><a id="iasl-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Intel’s <acronym class="acronym">ASL</acronym> compiler</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">Intel’s compiler for converting <acronym class="acronym">ASL</acronym> into
	  <acronym class="acronym">AML</acronym>.</p></dd><dt><a id="imap-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Internet Message Access Protocol</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A protocol for accessing email messages on a mail server,
	  characterised by the messages usually being kept on the server as
	  opposed to being downloaded to the mail reader client.</p><p>另參見 <a class="glossseealso" href="#pop3-glossary">Post Office Protocol Version 3</a>.</p></dd><dt><a id="ipp-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Internet Printing Protocol</span></dt><dd class="glossdef"><p></p></dd><dt><a id="ip-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Internet Protocol</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">The packet transmitting protocol that is the basic protocol on
	  the Internet.  Originally developed at the U.S. Department of
	  Defense and an extremely important part of the <acronym class="acronym">TCP/IP
	  </acronym> stack.  Without the Internet Protocol, the Internet
	  would not have become what it is today.  For more information, see
	  <a class="link" href="ftp://ftp.rfc-editor.org/in-notes/rfc791.txt" target="_top">
	  RFC 791</a>.</p></dd><dt><a id="isp-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Internet Service Provider</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A company that provides access to the Internet.</p></dd></dl></div><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">K</h3><dl><dt><a id="kame-glossary"></a><span xml:lang="en" class="glossterm" lang="en">KAME</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">Japanese for <span class="quote">“<span class="quote">turtle</span>”</span>, the term KAME is used
	  in computing circles to refer to the <a class="link" href="http://www.kame.net/" target="_top">KAME Project</a>, who work on
	  an implementation of <acronym class="acronym">IPv6</acronym>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">KDC</span></dt><dd><p>參見 <a class="glosssee" href="#kdc-glossary">Key Distribution Center</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">KLD</span></dt><dd><p>參見 <a class="glosssee" href="#kld-glossary">Kernel ld(1)</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">KSE</span></dt><dd><p>參見 <a class="glosssee" href="#kse-glossary">Kernel Scheduler Entities</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">KVA</span></dt><dd><p>參見 <a class="glosssee" href="#kva-glossary">Kernel Virtual Address</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">Kbps</span></dt><dd><p>參見 <a class="glosssee" href="#kbps-glossary">Kilo Bits Per Second</a>.</p></dd><dt><a id="kld-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Kernel <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ld&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ld</span>(1)</span></a></span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A method of dynamically loading functionality into a FreeBSD kernel
	  without rebooting the system.</p></dd><dt><a id="kse-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Kernel Scheduler Entities</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A kernel-supported threading system.  See the <a class="link" href="http://www.FreeBSD.org/kse" target="_top">project home page</a>
	  for further details.</p></dd><dt><a id="kva-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Kernel Virtual Address</span></dt><dd class="glossdef"><p></p></dd><dt><a id="kdc-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Key Distribution Center</span></dt><dd class="glossdef"><p></p></dd><dt><a id="kbps-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Kilo Bits Per Second</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">Used to measure bandwidth (how much data can pass a given
	  point at a specified amount of time).  Alternates to the Kilo
	  prefix include Mega, Giga, Tera, and so forth.</p></dd></dl></div><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">L</h3><dl><dt><span xml:lang="en" class="glossterm" lang="en">LAN</span></dt><dd><p>參見 <a class="glosssee" href="#lan-glossary">Local Area Network</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">LOR</span></dt><dd><p>參見 <a class="glosssee" href="#lor-glossary">Lock Order Reversal</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">LPD</span></dt><dd><p>參見 <a class="glosssee" href="#lpd-glossary">Line Printer Daemon</a>.</p></dd><dt><a id="lpd-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Line Printer Daemon</span></dt><dd class="glossdef"><p></p></dd><dt><a id="lan-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Local Area Network</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A network used on a local area, e.g. office, home, or so forth.
	  </p></dd><dt><a id="lor-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Lock Order Reversal</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">The FreeBSD kernel uses a number of resource locks to
	  arbitrate contention for those resources.  A run-time
	  lock diagnostic system found in FreeBSD-CURRENT kernels
	  (but removed for releases), called <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=witness&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">witness</span>(4)</span></a>,
	  detects the potential for deadlocks due to locking errors.
	  (<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=witness&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">witness</span>(4)</span></a> is actually slightly conservative, so
	  it is possible to get false positives.)  A true positive
	  report indicates that <span class="quote">“<span class="quote">if you were unlucky, a deadlock would
	  have happened here</span>”</span>.</p><p xml:lang="en" lang="en">True positive LORs tend to get fixed quickly, so
	  check http://lists.FreeBSD.org/mailman/listinfo/freebsd-current and the
	  <a class="link" href="http://sources.zabbadoz.net/freebsd/lor.html" target="_top">
	  LORs Seen</a> page before posting to the mailing lists.</p></dd></dl></div><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">M</h3><dl><dt><span xml:lang="en" class="glossterm" lang="en">MAC</span></dt><dd><p>參見 <a class="glosssee" href="#mac-glossary">強制存取控制 (MAC)</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">MADT</span></dt><dd><p>參見 <a class="glosssee" href="#madt-glossary">Multiple <acronym class="acronym">APIC</acronym> Description Table</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">MFC</span></dt><dd><p>參見 <a class="glosssee" href="#mfc-glossary">Merge From Current</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">MFH</span></dt><dd><p>參見 <a class="glosssee" href="#mfh-glossary">Merge From Head</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">MFS</span></dt><dd><p>參見 <a class="glosssee" href="#mfs-glossary">Merge From Stable</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">MIT</span></dt><dd><p>參見 <a class="glosssee" href="#mit-glossary">Massachusetts Institute of Technology</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">MLS</span></dt><dd><p>參見 <a class="glosssee" href="#mls-glossary">Multi-Level Security</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">MOTD</span></dt><dd><p>參見 <a class="glosssee" href="#motd-glossary">Message Of The Day</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">MTA</span></dt><dd><p>參見 <a class="glosssee" href="#mta-glossary">Mail Transfer Agent</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">MUA</span></dt><dd><p>參見 <a class="glosssee" href="#mua-glossary">Mail User Agent</a>.</p></dd><dt><a id="mta-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Mail Transfer Agent</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">An application used to transfer email.  An
	  <acronym class="acronym">MTA</acronym> has traditionally been part of the BSD
	  base system.  Today Sendmail is included in the base system, but
	  there are many other <acronym class="acronym">MTA</acronym>s, such as postfix,
	  qmail and Exim.</p></dd><dt><a id="mua-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Mail User Agent</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">An application used by users to display and write email.</p></dd><dt><a id="mac-glossary"></a><span class="glossterm">強制存取控制 (MAC)</span></dt><dd class="glossdef"><p></p></dd><dt><a id="mit-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Massachusetts Institute of Technology</span></dt><dd class="glossdef"><p></p></dd><dt><a id="mfc-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Merge From Current</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">To merge functionality or a patch from the -CURRENT
	  branch to another, most often -STABLE.</p></dd><dt><a id="mfh-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Merge From Head</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">To merge functionality or a patch from a repository HEAD
	  to an earlier branch.</p></dd><dt><a id="mfs-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Merge From Stable</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">In the normal course of FreeBSD development, a change will
	  be committed to the -CURRENT branch for testing before being
	  merged to -STABLE.  On rare occasions, a change will go into
	  -STABLE first and then be merged to -CURRENT.</p><p xml:lang="en" lang="en">This term is also used when a patch is merged from -STABLE
	  to a security branch.</p><p>另參見 <a class="glossseealso" href="#mfc-glossary">Merge From Current</a>.</p></dd><dt><a id="motd-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Message Of The Day</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A message, usually shown on login, often used to
	  distribute information to users of the system.</p></dd><dt><a id="mls-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Multi-Level Security</span></dt><dd class="glossdef"><p></p></dd><dt><a id="madt-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Multiple <acronym class="acronym">APIC</acronym> Description Table</span></dt><dd class="glossdef"><p></p></dd></dl></div><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">N</h3><dl><dt><span xml:lang="en" class="glossterm" lang="en">NAT</span></dt><dd><p>參見 <a class="glosssee" href="#nat-glossary">Network Address Translation</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">NDISulator</span></dt><dd><p>參見 <a class="glosssee" href="#projectevil-glossary">Project Evil</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">NFS</span></dt><dd><p>參見 <a class="glosssee" href="#nfs-glossary">Network File System</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">NTFS</span></dt><dd><p>參見 <a class="glosssee" href="#ntfs-glossary">New Technology File System</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">NTP</span></dt><dd><p>參見 <a class="glosssee" href="#ntp-glossary">Network Time Protocol</a>.</p></dd><dt><a id="nat-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Network Address Translation</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A technique where <acronym class="acronym">IP</acronym> packets are rewritten
	  on the way through a gateway, enabling many machines behind the
	  gateway to effectively share a single <acronym class="acronym">IP</acronym> address.</p></dd><dt><a id="nfs-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Network File System</span></dt><dd class="glossdef"><p></p></dd><dt><a id="ntfs-glossary"></a><span xml:lang="en" class="glossterm" lang="en">New Technology File System</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A filesystem developed by Microsoft and available in its
	  <span class="quote">“<span class="quote">New Technology</span>”</span> operating systems, such as
	  <span class="trademark">Windows</span>® 2000, <span class="trademark">Windows NT</span>® and <span class="trademark">Windows</span>® XP.</p></dd><dt><a id="ntp-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Network Time Protocol</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A means of synchronizing clocks over a network.</p></dd></dl></div><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">O</h3><dl><dt><span xml:lang="en" class="glossterm" lang="en">OBE</span></dt><dd><p>參見 <a class="glosssee" href="#obe-glossary">Overtaken By Events</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">ODMR</span></dt><dd><p>參見 <a class="glosssee" href="#odmr-glossary">On-Demand Mail Relay</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">OS</span></dt><dd><p>參見 <a class="glosssee" href="#os-glossary">Operating System</a>.</p></dd><dt><a id="odmr-glossary"></a><span xml:lang="en" class="glossterm" lang="en">On-Demand Mail Relay</span></dt><dd class="glossdef"><p></p></dd><dt><a id="os-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Operating System</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A set of programs, libraries and tools that provide access to
	  the hardware resources of a computer.  Operating systems range
	  today from simplistic designs that support only one program
	  running at a time, accessing only one device to fully
	  multi-user, multi-tasking and multi-process systems that can
	  serve thousands of users simultaneously, each of them running
	  dozens of different applications.</p></dd><dt><a id="obe-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Overtaken By Events</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">Indicates a suggested change (such as a Problem Report
	  or a feature request) which is no longer relevant or
	  applicable due to such things as later changes to FreeBSD,
	  changes in networking standards, the affected hardware
	  having since become obsolete, and so forth.</p></dd></dl></div><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">P</h3><dl><dt><span xml:lang="en" class="glossterm" lang="en">PAE</span></dt><dd><p>參見 <a class="glosssee" href="#pae-glossary">Physical Address Extensions</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">PAM</span></dt><dd><p>參見 <a class="glosssee" href="#pam-glossary">Pluggable Authentication Modules</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">PAP</span></dt><dd><p>參見 <a class="glosssee" href="#pap-glossary">Password Authentication Protocol</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">PC</span></dt><dd><p>參見 <a class="glosssee" href="#pc-glossary">Personal Computer</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">PCNSFD</span></dt><dd><p>參見 <a class="glosssee" href="#pcnfsd-glossary">Personal Computer Network File System Daemon</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">PDF</span></dt><dd><p>參見 <a class="glosssee" href="#pdf-glossary">Portable Document Format</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">PID</span></dt><dd><p>參見 <a class="glosssee" href="#pid-glossary">Process ID</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">POLA</span></dt><dd><p>參見 <a class="glosssee" href="#pola-glossary">Principle Of Least Astonishment</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">POP</span></dt><dd><p>參見 <a class="glosssee" href="#pop-glossary">Post Office Protocol</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">POP3</span></dt><dd><p>參見 <a class="glosssee" href="#pop3-glossary">Post Office Protocol Version 3</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">PPD</span></dt><dd><p>參見 <a class="glosssee" href="#ppd-glossary">PostScript Printer Description</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">PPP</span></dt><dd><p>參見 <a class="glosssee" href="#ppp-glossary">Point-to-Point Protocol</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">PPPoA</span></dt><dd><p>參見 <a class="glosssee" href="#pppoa-glossary"><acronym class="acronym">PPP</acronym> over <acronym class="acronym">ATM</acronym></a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">PPPoE</span></dt><dd><p>參見 <a class="glosssee" href="#pppoe-glossary"><acronym class="acronym">PPP</acronym> over <acronym class="acronym">Ethernet</acronym></a>.</p></dd><dt><a id="pppoa-glossary"></a><span xml:lang="en" class="glossterm" lang="en"><acronym class="acronym">PPP</acronym> over <acronym class="acronym">ATM</acronym></span></dt><dd class="glossdef"><p></p></dd><dt><a id="pppoe-glossary"></a><span xml:lang="en" class="glossterm" lang="en"><acronym class="acronym">PPP</acronym> over <acronym class="acronym">Ethernet</acronym></span></dt><dd class="glossdef"><p></p></dd><dt><span xml:lang="en" class="glossterm" lang="en">PR</span></dt><dd><p>參見 <a class="glosssee" href="#pr-glossary">Problem Report</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">PXE</span></dt><dd><p>參見 <a class="glosssee" href="#pxe-glossary">Preboot eXecution Environment</a>.</p></dd><dt><a id="pap-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Password Authentication Protocol</span></dt><dd class="glossdef"><p></p></dd><dt><a id="pc-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Personal Computer</span></dt><dd class="glossdef"><p></p></dd><dt><a id="pcnfsd-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Personal Computer Network File System Daemon</span></dt><dd class="glossdef"><p></p></dd><dt><a id="pae-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Physical Address Extensions</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A method of enabling access to up to 64 GB of <acronym class="acronym">RAM</acronym> on
	  systems which only physically have a 32-bit wide address space
	  (and would therefore be limited to 4 GB without PAE).</p></dd><dt><a id="pam-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Pluggable Authentication Modules</span></dt><dd class="glossdef"><p></p></dd><dt><a id="ppp-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Point-to-Point Protocol</span></dt><dd class="glossdef"><p></p></dd><dt><a id="pointyhat"></a><span xml:lang="en" class="glossterm" lang="en">Pointy Hat</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A mythical piece of headgear, much like a
	  <code class="literal">dunce cap</code>, awarded to any FreeBSD
	  committer who breaks the build, makes revision numbers
	  go backwards, or creates any other kind of havoc in
	  the source base.  Any committer worth his or her salt
	  will soon accumulate a large collection.  The usage is
	  (almost always?) humorous.</p></dd><dt><a id="pdf-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Portable Document Format</span></dt><dd class="glossdef"><p></p></dd><dt><a id="pop-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Post Office Protocol</span></dt><dd class="glossdef"><p></p><p>另參見 <a class="glossseealso" href="#pop3-glossary">Post Office Protocol Version 3</a>.</p></dd><dt><a id="pop3-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Post Office Protocol Version 3</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A protocol for accessing email messages on a mail server,
	  characterised by the messages usually being downloaded from the
	  server to the client, as opposed to remaining on the server.</p><p>另參見 <a class="glossseealso" href="#imap-glossary">Internet Message Access Protocol</a>.</p></dd><dt><a id="ppd-glossary"></a><span xml:lang="en" class="glossterm" lang="en">PostScript Printer Description</span></dt><dd class="glossdef"><p></p></dd><dt><a id="pxe-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Preboot eXecution Environment</span></dt><dd class="glossdef"><p></p></dd><dt><a id="pola-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Principle Of Least Astonishment</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">As FreeBSD evolves, changes visible to the user should be
	  kept as unsurprising as possible.  For example, arbitrarily
	  rearranging system startup variables in
	  <code class="filename">/etc/defaults/rc.conf</code> violates
	  <acronym class="acronym">POLA</acronym>.  Developers consider
	  <acronym class="acronym">POLA</acronym> when contemplating user-visible
	  system changes.</p></dd><dt><a id="pr-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Problem Report</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A description of some kind of problem that has been
	  found in either the FreeBSD source or documentation.  See
	  <a class="link" href="../../../../doc/en_US.ISO8859-1/articles/problem-reports/index.html" target="_top">
	  Writing FreeBSD Problem Reports</a>.</p></dd><dt><a id="pid-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Process ID</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A number, unique to a particular process on a system,
	  which identifies it and allows actions to be taken against it.</p></dd><dt><a id="projectevil-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Project Evil</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">The working title for the <acronym class="acronym">NDISulator</acronym>,
	  written by Bill Paul, who named it referring to how awful
	  it is (from a philosophical standpoint) to need to have
	  something like this in the first place.  The
	  <acronym class="acronym">NDISulator</acronym> is a special compatibility
	  module to allow Microsoft Windows™ NDIS miniport
	  network drivers to be used with FreeBSD/i386.  This is usually
	  the only way to use cards where the driver is closed-source.
	  See <code class="filename">src/sys/compat/ndis/subr_ndis.c</code>.</p></dd></dl></div><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">R</h3><dl><dt><span xml:lang="en" class="glossterm" lang="en">RA</span></dt><dd><p>參見 <a class="glosssee" href="#ra-glossary">Router Advertisement</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">RAID</span></dt><dd><p>參見 <a class="glosssee" href="#raid-glossary">Redundant Array of Inexpensive Disks</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">RAM</span></dt><dd><p>參見 <a class="glosssee" href="#ram-glossary">Random Access Memory</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">RD</span></dt><dd><p>參見 <a class="glosssee" href="#rd-glossary">Received Data</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">RFC</span></dt><dd><p>參見 <a class="glosssee" href="#rfc-glossary">Request For Comments</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">RISC</span></dt><dd><p>參見 <a class="glosssee" href="#risc-glossary">Reduced Instruction Set Computer</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">RPC</span></dt><dd><p>參見 <a class="glosssee" href="#rpc-glossary">Remote Procedure Call</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">RS232C</span></dt><dd><p>參見 <a class="glosssee" href="#rs232c-glossary">Recommended Standard 232C</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">RTS</span></dt><dd><p>參見 <a class="glosssee" href="#rts-glossary">Request To Send</a>.</p></dd><dt><a id="ram-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Random Access Memory</span></dt><dd class="glossdef"><p></p></dd><dt><a id="rcs-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Revision Control System</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">The <span class="emphasis"><em>Revision Control System</em></span>
          (<acronym class="acronym">RCS</acronym>) is one of the oldest software suites
          that implement <span class="quote">“<span class="quote">revision control</span>”</span> for plain
          files.  It allows the storage, retrieval, archival, logging,
          identification and merging of multiple revisions for each
          file.  RCS consists of many small tools that work together.
          It lacks some of the features found in more modern revision
          control systems, like Git, but it is very simple
          to install, configure, and start using for a small set of
          files.</p><p>另參見 <a class="glossseealso" href="#svn-glossary">Subversion</a>.</p></dd><dt><a id="rd-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Received Data</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">An <acronym class="acronym">RS232C</acronym> pin or wire that data is
	  received on.</p><p>另參見 <a class="glossseealso" href="#td-glossary">Transmitted Data</a>.</p></dd><dt><a id="rs232c-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Recommended Standard 232C</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A standard for communications between serial devices.</p></dd><dt><a id="risc-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Reduced Instruction Set Computer</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">An approach to processor design where the operations the hardware
	  can perform are simplified but made as general purpose as possible.
	  This can lead to lower power consumption, fewer transistors and in
	  some cases, better performance and increased code density.  Examples
	  of RISC processors include the Alpha, <span class="trademark">SPARC</span>®, <span class="trademark">ARM</span>® and
	  <span class="trademark">PowerPC</span>®.</p></dd><dt><a id="raid-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Redundant Array of Inexpensive Disks</span></dt><dd class="glossdef"><p></p></dd><dt><a id="rpc-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Remote Procedure Call</span></dt><dd class="glossdef"><p></p></dd><dt><a id="rfc-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Request For Comments</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A set of documents defining Internet standards, protocols, and
	  so forth.  See
	  <a class="link" href="http://www.rfc-editor.org/" target="_top">www.rfc-editor.org</a>.
	  </p><p xml:lang="en" lang="en">Also used as a general term when someone has a suggested change
	  and wants feedback.</p></dd><dt><a id="rts-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Request To Send</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">An <acronym class="acronym">RS232C</acronym> signal requesting that the remote
	  system commences transmission of data.</p><p>另參見 <a class="glossseealso" href="#cts-glossary">Clear To Send</a>.</p></dd><dt><a id="ra-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Router Advertisement</span></dt><dd class="glossdef"><p></p></dd></dl></div><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">S</h3><dl><dt><span xml:lang="en" class="glossterm" lang="en">SCI</span></dt><dd><p>參見 <a class="glosssee" href="#sci-glossary">System Control Interrupt</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">SCSI</span></dt><dd><p>參見 <a class="glosssee" href="#scsi-glossary">Small Computer System Interface</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">SG</span></dt><dd><p>參見 <a class="glosssee" href="#sg-glossary">Signal Ground</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">SMB</span></dt><dd><p>參見 <a class="glosssee" href="#smb-glossary">Server Message Block</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">SMP</span></dt><dd><p>參見 <a class="glosssee" href="#smp-glossary">Symmetric MultiProcessor</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">SMTP</span></dt><dd><p>參見 <a class="glosssee" href="#smtp-glossary">Simple Mail Transfer Protocol</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">SMTP AUTH</span></dt><dd><p>參見 <a class="glosssee" href="#smtpauth-glossary"><acronym class="acronym">SMTP</acronym> Authentication</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">SSH</span></dt><dd><p>參見 <a class="glosssee" href="#ssh-glossary">Secure Shell</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">STR</span></dt><dd><p>參見 <a class="glosssee" href="#str-glossary">Suspend To <acronym class="acronym">RAM</acronym></a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">SVN</span></dt><dd><p>參見 <a class="glosssee" href="#svn-glossary">Subversion</a>.</p></dd><dt><a id="smtpauth-glossary"></a><span xml:lang="en" class="glossterm" lang="en"><acronym class="acronym">SMTP</acronym> Authentication</span></dt><dd class="glossdef"><p></p></dd><dt><a id="smb-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Server Message Block</span></dt><dd class="glossdef"><p></p></dd><dt><a id="sg-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Signal Ground</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">An <acronym class="acronym">RS232</acronym> pin or wire that is the ground
	  reference for the signal.</p></dd><dt><a id="smtp-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Simple Mail Transfer Protocol</span></dt><dd class="glossdef"><p></p></dd><dt><a id="ssh-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Secure Shell</span></dt><dd class="glossdef"><p></p></dd><dt><a id="scsi-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Small Computer System Interface</span></dt><dd class="glossdef"><p></p></dd><dt><a id="svn-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Subversion</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">Subversion is a version control system
          currently used by the FreeBSD project.</p></dd><dt><a id="str-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Suspend To <acronym class="acronym">RAM</acronym></span></dt><dd class="glossdef"><p></p></dd><dt><a id="smp-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Symmetric MultiProcessor</span></dt><dd class="glossdef"><p></p></dd><dt><a id="sci-glossary"></a><span xml:lang="en" class="glossterm" lang="en">System Control Interrupt</span></dt><dd class="glossdef"><p></p></dd></dl></div><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">T</h3><dl><dt><span xml:lang="en" class="glossterm" lang="en">TCP</span></dt><dd><p>參見 <a class="glosssee" href="#tcp-glossary">Transmission Control Protocol</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">TCP/IP</span></dt><dd><p>參見 <a class="glosssee" href="#tcpip-glossary">Transmission Control Protocol/Internet Protocol</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">TD</span></dt><dd><p>參見 <a class="glosssee" href="#td-glossary">Transmitted Data</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">TFTP</span></dt><dd><p>參見 <a class="glosssee" href="#tftp-glossary">Trivial <acronym class="acronym">FTP</acronym></a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">TGT</span></dt><dd><p>參見 <a class="glosssee" href="#tgt-glossary">Ticket-Granting Ticket</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">TSC</span></dt><dd><p>參見 <a class="glosssee" href="#tsc-glossary">Time Stamp Counter</a>.</p></dd><dt><a id="tgt-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Ticket-Granting Ticket</span></dt><dd class="glossdef"><p></p></dd><dt><a id="tsc-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Time Stamp Counter</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A profiling counter internal to modern <span class="trademark">Pentium</span>® processors
	  that counts core frequency clock ticks.</p></dd><dt><a id="tcp-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Transmission Control Protocol</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A protocol that sits on top of (e.g.) the <acronym class="acronym">IP</acronym>
	  protocol and guarantees that packets are delivered in a reliable,
	  ordered, fashion.</p></dd><dt><a id="tcpip-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Transmission Control Protocol/Internet Protocol</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">The term for the combination of the <acronym class="acronym">TCP</acronym>
	  protocol running over the <acronym class="acronym">IP</acronym> protocol.  Much of
	  the Internet runs over <acronym class="acronym">TCP/IP</acronym>.</p></dd><dt><a id="td-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Transmitted Data</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">An <acronym class="acronym">RS232C</acronym> pin or wire that data is transmitted
	  on.</p><p>另參見 <a class="glossseealso" href="#rd-glossary">Received Data</a>.</p></dd><dt><a id="tftp-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Trivial <acronym class="acronym">FTP</acronym></span></dt><dd class="glossdef"><p></p></dd></dl></div><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">U</h3><dl><dt><span xml:lang="en" class="glossterm" lang="en">UDP</span></dt><dd><p>參見 <a class="glosssee" href="#udp-glossary">User Datagram Protocol</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">UFS1</span></dt><dd><p>參見 <a class="glosssee" href="#ufs1-glossary">Unix File System Version 1</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">UFS2</span></dt><dd><p>參見 <a class="glosssee" href="#ufs2-glossary">Unix File System Version 2</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">UID</span></dt><dd><p>參見 <a class="glosssee" href="#uid-glossary">User ID</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">URL</span></dt><dd><p>參見 <a class="glosssee" href="#url-glossary">Uniform Resource Locator</a>.</p></dd><dt><span xml:lang="en" class="glossterm" lang="en">USB</span></dt><dd><p>參見 <a class="glosssee" href="#usb-glossary">Universal Serial Bus</a>.</p></dd><dt><a id="url-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Uniform Resource Locator</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A method of locating a resource, such as a document on
	  the Internet and a means to identify that resource.</p></dd><dt><a id="ufs1-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Unix File System Version 1</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">The original <span class="trademark">UNIX</span>® file system, sometimes called the
	  Berkeley Fast File System.</p></dd><dt><a id="ufs2-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Unix File System Version 2</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">An extension to <acronym class="acronym">UFS1</acronym>, introduced in
	  FreeBSD 5-CURRENT.  <acronym class="acronym">UFS2</acronym> adds 64 bit block
	  pointers (breaking the 1T barrier), support for extended file
	  storage and other features.</p></dd><dt><a id="usb-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Universal Serial Bus</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A hardware standard used to connect a wide variety of
	  computer peripherals to a universal interface.</p></dd><dt><a id="uid-glossary"></a><span xml:lang="en" class="glossterm" lang="en">User ID</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A unique number assigned to each user of a computer,
	  by which the resources and permissions assigned to that
	  user can be identified.</p></dd><dt><a id="udp-glossary"></a><span xml:lang="en" class="glossterm" lang="en">User Datagram Protocol</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A simple, unreliable datagram protocol which is used
	  for exchanging data on a TCP/IP network.  <acronym class="acronym">UDP</acronym>
	  does not provide error checking and correction like
	  <acronym class="acronym">TCP</acronym>.</p></dd></dl></div><div class="glossdiv"><h3 xml:lang="en" class="title" lang="en">V</h3><dl><dt><span xml:lang="en" class="glossterm" lang="en">VPN</span></dt><dd><p>參見 <a class="glosssee" href="#vpn-glossary">Virtual Private Network</a>.</p></dd><dt><a id="vpn-glossary"></a><span xml:lang="en" class="glossterm" lang="en">Virtual Private Network</span></dt><dd class="glossdef"><p xml:lang="en" lang="en">A method of using a public telecommunication
	  such as the Internet, to provide remote access to a
	  localized network, such as a corporate
	  <acronym class="acronym">LAN</acronym>.</p></dd></dl></div></div><div class="index"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92327736"></a>索引</h1></div></div></div><div class="index"><div class="indexdiv"><h3>符號</h3><dl><dt>-CURRENT, <a class="indexterm" href="#current-stable">追蹤開發分支</a></dt><dd><dl><dt>compiling, <a class="indexterm" href="#current">使用 FreeBSD-CURRENT</a></dt><dt>使用, <a class="indexterm" href="#current">使用 FreeBSD-CURRENT</a></dt></dl></dd><dt>-STABLE, <a class="indexterm" href="#current-stable">追蹤開發分支</a></dt><dd><dl><dt>compiling, <a class="indexterm" href="#stable">使用 FreeBSD-STABLE</a></dt><dt>使用, <a class="indexterm" href="#stable">使用 FreeBSD-STABLE</a></dt></dl></dd><dt>.k5login, <a class="indexterm" href="#idp72064568">設定客戶端使用 Kerberos</a></dt><dt>.k5users, <a class="indexterm" href="#idp72064568">設定客戶端使用 Kerberos</a></dt><dt>.rhosts, <a class="indexterm" href="#idp75669816">檔案系統備份</a></dt><dt>/boot/kernel.old, <a class="indexterm" href="#kernelconfig-building">編譯與安裝自訂核心</a></dt><dt>/etc, <a class="indexterm" href="#configtuning-initial">規劃分割區配置</a></dt><dt>/etc/groups, <a class="indexterm" href="#users-groups">管理群組</a></dt><dt>/etc/login.conf, <a class="indexterm" href="#users-limiting">設定登入類別</a></dt><dt>/etc/mail/access, <a class="indexterm" href="#sendmail">Sendmail 設定檔</a></dt><dt>/etc/mail/aliases, <a class="indexterm" href="#sendmail">Sendmail 設定檔</a></dt><dt>/etc/mail/local-host-names, <a class="indexterm" href="#sendmail">Sendmail 設定檔</a></dt><dt>/etc/mail/mailer.conf, <a class="indexterm" href="#sendmail">Sendmail 設定檔</a></dt><dt>/etc/mail/mailertable, <a class="indexterm" href="#sendmail">Sendmail 設定檔</a></dt><dt>/etc/mail/sendmail.cf, <a class="indexterm" href="#sendmail">Sendmail 設定檔</a></dt><dt>/etc/mail/virtusertable, <a class="indexterm" href="#sendmail">Sendmail 設定檔</a></dt><dt>/etc/remote, <a class="indexterm" href="#direct-at">使用 AT 指令</a></dt><dt>/etc/ttys, <a class="indexterm" href="#dialup-ttys">數據機設定</a></dt><dt>/usr, <a class="indexterm" href="#configtuning-initial">規劃分割區配置</a></dt><dt>/usr/bin/login, <a class="indexterm" href="#dialup-ttys">數據機設定</a></dt><dt>/usr/share/skel, <a class="indexterm" href="#users-adduser">adduser</a></dt><dt>/var, <a class="indexterm" href="#configtuning-initial">規劃分割區配置</a></dt><dt>386BSD, <a class="indexterm" href="#intro-history">FreeBSD 歷史簡介</a></dt><dt>386BSD Patchkit, <a class="indexterm" href="#intro-history">FreeBSD 歷史簡介</a></dt><dt>4.3BSD-Lite, <a class="indexterm" href="#intro-history">FreeBSD 歷史簡介</a></dt><dt>4.4BSD-Lite, <a class="indexterm" href="#nutshell">歡迎使用 FreeBSD！</a></dt><dt>802.11 (參見 無線網路)</dt><dt>使用者</dt><dd><dl><dt>執行 FreeBSD 的大型站台, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt></dl></dd><dt>分割區配置, <a class="indexterm" href="#configtuning-initial">規劃分割區配置</a></dt><dt>在地化, <a class="indexterm" href="#l10n-synopsis">概述</a></dt><dt>套件, <a class="indexterm" href="#ports-synopsis">概述</a></dt><dt>安裝, <a class="indexterm" href="#bsdinstall-synopsis">概述</a></dt><dt>容錯移轉, <a class="indexterm" href="#network-aggregation">Link Aggregation 與容錯移轉</a></dt><dt>核心選項</dt><dd><dl><dt>COMPAT_LINUX, <a class="indexterm" href="#linuxemu-lbc-install">設定 Linux® Binary 相容性</a></dt><dt>IPFILTER, <a class="indexterm" href="#idp86558264">開啟 IPF</a></dt><dt>IPFILTER_DEFAULT_BLOCK, <a class="indexterm" href="#idp86558264">開啟 IPF</a></dt><dt>IPFILTER_LOG, <a class="indexterm" href="#idp86558264">開啟 IPF</a></dt><dt>IPFIREWALL, <a class="indexterm" href="#firewalls-ipfw-kernelconfig">IPFW 核心選項</a></dt><dt>IPFIREWALL_VERBOSE, <a class="indexterm" href="#firewalls-ipfw-kernelconfig">IPFW 核心選項</a></dt><dt>IPFIREWALL_VERBOSE_LIMIT, <a class="indexterm" href="#firewalls-ipfw-kernelconfig">IPFW 核心選項</a></dt><dt>IPSEC, <a class="indexterm" href="#ipsec">VPN over
	IPsec</a></dt><dt>IPSEC_DEBUG, <a class="indexterm" href="#ipsec">VPN over
	IPsec</a></dt><dt>MROUTING, <a class="indexterm" href="#network-routing-multicast">群播 (Multicast) 注意事項</a></dt><dt>SCSI DELAY, <a class="indexterm" href="#idp70456376">SCSI_DELAY
	  (kern.cam.scsi_delay)</a></dt></dl></dd><dt>橋接, <a class="indexterm" href="#network-bridging">橋接</a></dt><dt>無磁碟作業, <a class="indexterm" href="#network-diskless">PXE 無磁碟作業</a></dt><dt>無磁碟工作站, <a class="indexterm" href="#network-diskless">PXE 無磁碟作業</a></dt><dt>無線網路, <a class="indexterm" href="#network-wireless">無線網路</a></dt><dt>藍牙, <a class="indexterm" href="#network-bluetooth">藍牙</a></dt><dt>藍牙音訊, <a class="indexterm" href="#bluetooth-headset">設定藍芽音效裝置</a></dt><dt>虛擬 LAN, <a class="indexterm" href="#network-vlan">VLANs</a></dt><dt>試算表</dt><dd><dl><dt>Gnumeric, <a class="indexterm" href="#idp67760440">Gnumeric</a></dt><dt>KMyMoney, <a class="indexterm" href="#idp67769528">KMyMoney</a></dt></dl></dd><dt>路由器, <a class="indexterm" href="#network-static-routes">設定路由器使用靜態路由</a></dt><dt>防火牆, <a class="indexterm" href="#firewalls">防火牆</a></dt></dl></div><div class="indexdiv"><h3>A</h3><dl><dt>AbiWord, <a class="indexterm" href="#idp67534904">AbiWord</a></dt><dt>accounting</dt><dd><dl><dt>disk space, <a class="indexterm" href="#quotas">磁碟配額</a></dt></dl></dd><dt>accounts</dt><dd><dl><dt>adding, <a class="indexterm" href="#users-adduser">adduser</a></dt><dt>changing password, <a class="indexterm" href="#users-passwd">passwd</a></dt><dt>daemon, <a class="indexterm" href="#users-system">系統帳號</a></dt><dt>groups, <a class="indexterm" href="#users-groups">管理群組</a></dt><dt>limiting, <a class="indexterm" href="#users-limiting">設定登入類別</a></dt><dt>modifying, <a class="indexterm" href="#users-modifying">管理帳號</a></dt><dt>nobody, <a class="indexterm" href="#users-system">系統帳號</a></dt><dt>operator, <a class="indexterm" href="#users-system">系統帳號</a></dt><dt>removing, <a class="indexterm" href="#users-rmuser">rmuser</a></dt><dt>superuser (root), <a class="indexterm" href="#users-superuser">超級使用者帳號</a></dt><dt>system, <a class="indexterm" href="#users-system">系統帳號</a></dt><dt>user, <a class="indexterm" href="#users-user">使用者帳號</a></dt></dl></dd><dt>ACL, <a class="indexterm" href="#fs-acl">存取控制清單</a></dt><dt>ACPI, <a class="indexterm" href="#acpi-overview">電源與資源管理</a>, <a class="indexterm" href="#ACPI-comprob">常見問題</a></dt><dd><dl><dt>ASL, <a class="indexterm" href="#ACPI-aslanddump">BIOS 含有有問題的 Bytecode</a>, <a class="indexterm" href="#idp70851256">覆蓋預設的 AML</a></dt><dt>debugging, <a class="indexterm" href="#ACPI-submitdebug">取得與回報除錯資訊</a></dt><dt>problems, <a class="indexterm" href="#ACPI-comprob">常見問題</a>, <a class="indexterm" href="#ACPI-submitdebug">取得與回報除錯資訊</a></dt></dl></dd><dt>adduser, <a class="indexterm" href="#users-adduser">adduser</a>, <a class="indexterm" href="#idp79884344">變更登入類別的工具</a></dt><dt>AIX, <a class="indexterm" href="#network-nis">網路資訊系統 (NIS)</a></dt><dt>amd, <a class="indexterm" href="#network-amd">使用 amd(8) 自動掛載</a></dt><dt>anti-aliased fonts, <a class="indexterm" href="#antialias">反鋸齒字型</a></dt><dt>Apache, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a>, <a class="indexterm" href="#network-apache">Apache HTTP 伺服器</a></dt><dd><dl><dt>configuration file, <a class="indexterm" href="#idp84719672">設定並啟動 Apache</a></dt><dt>modules, <a class="indexterm" href="#idp84804792">Apache 模組</a></dt><dt>starting or stopping, <a class="indexterm" href="#idp84719672">設定並啟動 Apache</a></dt></dl></dd><dt>
	  Apache OpenOffice
	, <a class="indexterm" href="#idp67555640">Apache OpenOffice</a></dt><dt>APIC</dt><dd><dl><dt>disabling, <a class="indexterm" href="#idp70811064">系統無回應</a></dt></dl></dd><dt>APM, <a class="indexterm" href="#acpi-overview">電源與資源管理</a></dt><dt>Apple, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>ASCII, <a class="indexterm" href="#using-localization">使用語系</a></dt><dt>AT&amp;T, <a class="indexterm" href="#intro-history">FreeBSD 歷史簡介</a></dt><dt>AUDIT, <a class="indexterm" href="#audit-synopsis">概述</a></dt><dt>autofs, <a class="indexterm" href="#network-autofs">使用 autofs(5) 自動掛載</a></dt><dt>automatic mounter daemon, <a class="indexterm" href="#network-amd">使用 amd(8) 自動掛載</a></dt><dt>automounter subsystem, <a class="indexterm" href="#network-autofs">使用 autofs(5) 自動掛載</a></dt><dt>AutoPPP, <a class="indexterm" href="#userppp-mgetty">設定撥入服務</a></dt></dl></div><div class="indexdiv"><h3>B</h3><dl><dt>backup software, <a class="indexterm" href="#backups-programs-amanda">第三方備份工具</a></dt><dd><dl><dt>cpio, <a class="indexterm" href="#idp75722680">目錄備份</a></dt><dt>dump / restore, <a class="indexterm" href="#idp75669816">檔案系統備份</a></dt><dt>pax, <a class="indexterm" href="#idp75722680">目錄備份</a></dt><dt>tar, <a class="indexterm" href="#idp75722680">目錄備份</a></dt></dl></dd><dt>Basic Input/Output
	System (see BIOS)</dt><dt>BGP, <a class="indexterm" href="#network-static-routes">設定路由器使用靜態路由</a></dt><dt>binary compatibility</dt><dd><dl><dt>Linux, <a class="indexterm" href="#nutshell">歡迎使用 FreeBSD！</a></dt></dl></dd><dt>Binary 相容性</dt><dd><dl><dt>Linux, <a class="indexterm" href="#linuxemu-synopsis">概述</a></dt></dl></dd><dt>BIND, <a class="indexterm" href="#mail-trouble">疑難排解</a></dt><dt>BIOS, <a class="indexterm" href="#boot-introduction">FreeBSD 開機程序</a></dt><dt>bits-per-second, <a class="indexterm" href="#serial">序列術語與硬體</a></dt><dt>Boot Loader, <a class="indexterm" href="#boot-introduction">FreeBSD 開機程序</a></dt><dt>Boot Manager, <a class="indexterm" href="#boot-introduction">FreeBSD 開機程序</a>, <a class="indexterm" href="#boot-boot0">開機管理程式</a></dt><dt>boot-loader, <a class="indexterm" href="#boot-loader">階段三</a></dt><dt>booting, <a class="indexterm" href="#boot-synopsis">概述</a></dt><dt>bootstrap, <a class="indexterm" href="#boot-synopsis">概述</a></dt><dt>Bourne shells, <a class="indexterm" href="#shells">Shell</a></dt><dt>browsers</dt><dd><dl><dt>web, <a class="indexterm" href="#desktop-browsers">瀏覽器</a></dt></dl></dd><dt>BSD Router, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>BSD 版權, <a class="indexterm" href="#goals">FreeBSD 計劃目標</a></dt><dt>bsdlabel, <a class="indexterm" href="#idp75801912">緊急還原</a></dt></dl></div><div class="indexdiv"><h3>C</h3><dl><dt>Calligra, <a class="indexterm" href="#idp67520824">Calligra</a></dt><dt>CARP, <a class="indexterm" href="#carp">共用位址備援協定 (CARP)</a></dt><dt>CD burner</dt><dd><dl><dt>ATAPI, <a class="indexterm" href="#creating-cds">建立與使用 CD 媒體</a></dt><dt>ATAPI/CAM driver, <a class="indexterm" href="#atapicam">支援的裝置</a></dt></dl></dd><dt>CD-ROMs</dt><dd><dl><dt>burning, <a class="indexterm" href="#cdrecord">燒錄 CD</a></dt><dt>creating, <a class="indexterm" href="#creating-cds">建立與使用 CD 媒體</a></dt><dt>creating bootable, <a class="indexterm" href="#mkisofs">寫入資料到一個 ISO 檔案系統</a></dt></dl></dd><dt>CHAP, <a class="indexterm" href="#userppp-PAPnCHAP">PAP 與 CHAP 認證</a></dt><dt>chpass, <a class="indexterm" href="#users-chpass">chpass</a></dt><dt>Chromium, <a class="indexterm" href="#idp67462712">Chromium</a></dt><dt>Cisco, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>Citrix, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>command line, <a class="indexterm" href="#shells">Shell</a></dt><dt>Common Address Redundancy Protocol, <a class="indexterm" href="#carp">共用位址備援協定 (CARP)</a></dt><dt>Compiler, <a class="indexterm" href="#os-overview">FreeBSD 能做什麼？</a></dt><dt>Concurrent Versions System (參見 CVS)</dt><dt>console, <a class="indexterm" href="#consoles">虛擬 Console 與終端機</a>, <a class="indexterm" href="#boot-singleuser">單使用者模式</a></dt><dt>contributors, <a class="indexterm" href="#development">FreeBSD 開發模式</a></dt><dt>core team, <a class="indexterm" href="#development">FreeBSD 開發模式</a></dt><dt>country codes, <a class="indexterm" href="#using-localization">使用語系</a></dt><dt>cron</dt><dd><dl><dt>configuration, <a class="indexterm" href="#configtuning-cron">設定 cron(8)</a></dt></dl></dd><dt>cryptography, <a class="indexterm" href="#idp84809272">mod_ssl</a></dt><dt>cuau, <a class="indexterm" href="#serial-hw-config">序列埠設定</a></dt><dt>CVS, <a class="indexterm" href="#development">FreeBSD 開發模式</a></dt><dt>CVS Repository, <a class="indexterm" href="#development">FreeBSD 開發模式</a></dt></dl></div><div class="indexdiv"><h3>D</h3><dl><dt>dangerously dedicated, <a class="indexterm" href="#disk-organization">磁碟組織</a></dt><dt>DCE, <a class="indexterm" href="#serial">序列術語與硬體</a></dt><dt>device nodes, <a class="indexterm" href="#troubleshooting">疑難排解音效</a></dt><dt>device.hints, <a class="indexterm" href="#device-hints">裝置提示</a></dt><dt>DGA, <a class="indexterm" href="#video-interface">偵測影像處理能力</a></dt><dt>DHCP</dt><dd><dl><dt>configuration files, <a class="indexterm" href="#idp84500408">設定 DHCP 客戶端</a>, <a class="indexterm" href="#network-dhcp-server">安裝並設定 DHCP 伺服器</a></dt><dt>dhcpd.conf, <a class="indexterm" href="#network-dhcp-server">安裝並設定 DHCP 伺服器</a></dt><dt>diskless operation, <a class="indexterm" href="#network-pxe-setting-up-dhcp">設定 DHCP 伺服器</a></dt><dt>installation, <a class="indexterm" href="#network-dhcp-server">安裝並設定 DHCP 伺服器</a></dt><dt>server, <a class="indexterm" href="#network-dhcp-server">安裝並設定 DHCP 伺服器</a></dt></dl></dd><dt>dial-in service, <a class="indexterm" href="#dialup">撥入服務</a></dt><dt>dial-out service, <a class="indexterm" href="#dialout">撥出服務</a></dt><dt>directories, <a class="indexterm" href="#permissions">權限</a></dt><dt>directory hierarchy, <a class="indexterm" href="#dirstructure">目錄結構</a></dt><dt>Disk Labels, <a class="indexterm" href="#geom-glabel">磁碟裝置標籤</a></dt><dt>Disk Mirroring, <a class="indexterm" href="#geom-mirror">RAID1 - 鏡像 (Mirroring)</a></dt><dt>disk quotas, <a class="indexterm" href="#security-resourcelimits">限制資源</a>, <a class="indexterm" href="#quotas">磁碟配額</a></dt><dd><dl><dt>checking, <a class="indexterm" href="#idp75990968">開啟磁碟配額</a>, <a class="indexterm" href="#idp76034488">檢查配額限制與磁碟使用狀況</a></dt><dt>limits, <a class="indexterm" href="#idp76013240">設定配額限制</a></dt></dl></dd><dt>disks</dt><dd><dl><dt>adding, <a class="indexterm" href="#disks-adding">加入磁碟</a></dt><dt>detaching a memory disk, <a class="indexterm" href="#disks-mdconfig">連接與解除連接既有的映象檔</a></dt><dt>encrypting, <a class="indexterm" href="#disks-encrypting">磁碟分割區加密</a></dt><dt>memory, <a class="indexterm" href="#disks-mdconfig">連接與解除連接既有的映象檔</a></dt><dt>memory file system, <a class="indexterm" href="#disks-md-freebsd5">建立以檔案或記憶體為基底的磁碟</a></dt><dt>resizing, <a class="indexterm" href="#disks-growing">重設大小與擴增磁碟</a></dt></dl></dd><dt>Django, <a class="indexterm" href="#idp84880696">Django</a></dt><dt>DNS, <a class="indexterm" href="#idp70303416">主機名稱</a>, <a class="indexterm" href="#idp82200248">進階設定</a>, <a class="indexterm" href="#mail-using">郵件組成</a>, <a class="indexterm" href="#mail-domain">網域中的郵件</a>, <a class="indexterm" href="#network-dns">網域名稱系統 (DNS)</a></dt><dt>DNS Server, <a class="indexterm" href="#os-overview">FreeBSD 能做什麼？</a></dt><dt>Documentation (see Updating and Upgrading)</dt><dt>documentation package (see Updating and Upgrading)</dt><dt>DSP, <a class="indexterm" href="#troubleshooting">疑難排解音效</a></dt><dt>DTE, <a class="indexterm" href="#serial">序列術語與硬體</a></dt><dt>DTrace, <a class="indexterm" href="#dtrace-synopsis">概述</a></dt><dt>DTrace support (see DTrace)</dt><dt>dual homed hosts, <a class="indexterm" href="#network-static-routes">設定路由器使用靜態路由</a></dt><dt>dump, <a class="indexterm" href="#idp75669816">檔案系統備份</a></dt><dt>DVD</dt><dd><dl><dt>burning, <a class="indexterm" href="#creating-dvds">建立與使用 DVD 媒體</a></dt><dt>DVD+RW, <a class="indexterm" href="#idp75524408">使用 DVD+RW</a></dt><dt>DVD-RAM, <a class="indexterm" href="#creating-dvd-ram">使用 DVD-RAM</a></dt><dt>DVD-RW, <a class="indexterm" href="#idp75561784">使用 DVD-RW</a></dt><dt>DVD-Video, <a class="indexterm" href="#idp75514168">燒錄 DVD-Video</a></dt></dl></dd><dt>Dynamic Host Configuration Protocol (see DHCP)</dt></dl></div><div class="indexdiv"><h3>E</h3><dl><dt>editors, <a class="indexterm" href="#editors">文字編輯器</a></dt><dd><dl><dt>ee1, <a class="indexterm" href="#editors">文字編輯器</a></dt></dl></dd><dt>ee, <a class="indexterm" href="#editors">文字編輯器</a></dt><dt>electronic mail (參見 email)</dt><dt>ELF, <a class="indexterm" href="#linuxemu-advanced">進階主題</a></dt><dd><dl><dt>branding, <a class="indexterm" href="#linuxemu-advanced">進階主題</a></dt></dl></dd><dt>emacs, <a class="indexterm" href="#editors">文字編輯器</a></dt><dt>email, <a class="indexterm" href="#os-overview">FreeBSD 能做什麼？</a>, <a class="indexterm" href="#mail-synopsis">概述</a></dt><dd><dl><dt>change mta, <a class="indexterm" href="#mail-changingmta">更改郵件傳輸代理程式</a></dt><dt>configuration, <a class="indexterm" href="#mail-config">基礎設定</a></dt><dt>receiving, <a class="indexterm" href="#mail-using">郵件組成</a></dt><dt>troubleshooting, <a class="indexterm" href="#mail-trouble">疑難排解</a></dt></dl></dd><dt>embedded, <a class="indexterm" href="#os-overview">FreeBSD 能做什麼？</a></dt><dt>encodings, <a class="indexterm" href="#using-localization">使用語系</a></dt><dt>environment variables, <a class="indexterm" href="#shells">Shell</a></dt><dt>ePDFView, <a class="indexterm" href="#idp67688888">ePDFView</a></dt><dt>execution class loader, <a class="indexterm" href="#linuxemu-advanced">進階主題</a></dt></dl></div><div class="indexdiv"><h3>F</h3><dl><dt>FEC, <a class="indexterm" href="#network-aggregation">Link Aggregation 與容錯移轉</a></dt><dt>fetchmail, <a class="indexterm" href="#mail-fetchmail">使用 fetchmail</a></dt><dt>file permissions, <a class="indexterm" href="#permissions">權限</a></dt><dt>file server</dt><dd><dl><dt>UNIX clients, <a class="indexterm" href="#network-nfs">網路檔案系統 (NFS)</a></dt><dt>Windows clients, <a class="indexterm" href="#network-samba">Microsoft® Windows® 用戶端檔案與列印服務 (Samba)</a></dt></dl></dd><dt>file systems</dt><dd><dl><dt>ISO 9660, <a class="indexterm" href="#creating-cds">建立與使用 CD 媒體</a>, <a class="indexterm" href="#mkisofs">寫入資料到一個 ISO 檔案系統</a></dt><dt>Joliet, <a class="indexterm" href="#mkisofs">寫入資料到一個 ISO 檔案系統</a></dt><dt>mounted with fstab, <a class="indexterm" href="#disks-fstab">fstab 檔</a></dt><dt>mounting, <a class="indexterm" href="#disks-mount">使用 mount(8)</a></dt><dt>snapshots, <a class="indexterm" href="#snapshots">檔案系統快照</a></dt><dt>unmounting, <a class="indexterm" href="#disks-umount">使用 umount(8)</a></dt></dl></dd><dt>File Systems, <a class="indexterm" href="#filesystems-synopsis">概述</a></dt><dt>File Systems Support (see File Systems)</dt><dt>Firefox, <a class="indexterm" href="#idp67394744">Firefox</a></dt><dt>firewall, <a class="indexterm" href="#os-overview">FreeBSD 能做什麼？</a></dt><dd><dl><dt>IPFILTER, <a class="indexterm" href="#firewalls-ipf">IPFILTER (IPF)</a></dt><dt>IPFW, <a class="indexterm" href="#firewalls-ipfw">IPFW</a></dt><dt>PF, <a class="indexterm" href="#firewalls-pf">PF</a></dt><dt>rulesets, <a class="indexterm" href="#firewalls-concepts">防火牆概念</a></dt></dl></dd><dt>fonts</dt><dd><dl><dt>anti-aliased, <a class="indexterm" href="#antialias">反鋸齒字型</a></dt><dt>spacing, <a class="indexterm" href="#antialias">反鋸齒字型</a></dt><dt>TrueType, <a class="indexterm" href="#truetype">TrueType® 字型</a></dt></dl></dd><dt>Fonts</dt><dd><dl><dt>LCD screen, <a class="indexterm" href="#antialias">反鋸齒字型</a></dt></dl></dd><dt>Free Software
	  Foundation, <a class="indexterm" href="#intro-history">FreeBSD 歷史簡介</a>, <a class="indexterm" href="#basics-info">GNU Info 檔</a></dt><dt>FreeBSD Project</dt><dd><dl><dt>history, <a class="indexterm" href="#intro-history">FreeBSD 歷史簡介</a></dt></dl></dd><dt>FreeBSD Security Advisories, <a class="indexterm" href="#security-advisories">FreeBSD 安全報告</a></dt><dt>FreeBSD 專案</dt><dd><dl><dt>開發模式, <a class="indexterm" href="#development">FreeBSD 開發模式</a></dt></dl></dd><dt>FreeBSD 計劃</dt><dd><dl><dt>目標, <a class="indexterm" href="#goals">FreeBSD 計劃目標</a></dt></dl></dd><dt>freebsd-update (see updating-upgrading)</dt><dt>FreeNAS, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>FreshPorts, <a class="indexterm" href="#ports-finding-applications">搜尋軟體</a></dt><dt>FTP</dt><dd><dl><dt>anonymous, <a class="indexterm" href="#idp84905144">設定</a></dt></dl></dd><dt>FTP servers, <a class="indexterm" href="#os-overview">FreeBSD 能做什麼？</a>, <a class="indexterm" href="#network-ftp">檔案傳輸協定 (FTP)</a></dt></dl></div><div class="indexdiv"><h3>G</h3><dl><dt>gateway, <a class="indexterm" href="#network-routing">通訊閘與路由</a></dt><dt>Geeqie, <a class="indexterm" href="#idp67677496">Geeqie</a></dt><dt>GEOM, <a class="indexterm" href="#geom-synopsis">概述</a>, <a class="indexterm" href="#geom-striping">RAID0 - 串連 (Striping)</a>, <a class="indexterm" href="#geom-mirror">RAID1 - 鏡像 (Mirroring)</a>, <a class="indexterm" href="#geom-raid3">RAID3 - 位元級串連與獨立奇偶校驗</a>, <a class="indexterm" href="#geom-graid">軟體 RAID 裝置</a>, <a class="indexterm" href="#geom-glabel">磁碟裝置標籤</a>, <a class="indexterm" href="#geom-gjournal">UFS Journaling 透過 GEOM</a></dt><dt>GEOM Disk Framework (see GEOM)</dt><dt>getty, <a class="indexterm" href="#dialup-ttys">數據機設定</a></dt><dt>GhostBSD, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>GNOME, <a class="indexterm" href="#os-overview">FreeBSD 能做什麼？</a>, <a class="indexterm" href="#x11-wm-gnome">GNOME</a></dt><dt>GNU toolchain, <a class="indexterm" href="#idp69370168">安裝 Linux® ELF Binary</a></dt><dt>GNU 較寬鬆通用公共授權條款 (LGPL), <a class="indexterm" href="#goals">FreeBSD 計劃目標</a></dt><dt>GNU 通用公共授權條款 (GPL), <a class="indexterm" href="#goals">FreeBSD 計劃目標</a></dt><dt>GnuCash, <a class="indexterm" href="#idp67182008">GnuCash</a></dt><dt>Gnumeric, <a class="indexterm" href="#idp67760440">Gnumeric</a></dt><dt>gpart, <a class="indexterm" href="#disks-adding">加入磁碟</a>, <a class="indexterm" href="#disks-growing">重設大小與擴增磁碟</a></dt><dt>grace period, <a class="indexterm" href="#idp76034488">檢查配額限制與磁碟使用狀況</a></dt><dt>Greenman, David, <a class="indexterm" href="#intro-history">FreeBSD 歷史簡介</a></dt><dt>Grimes, Rod, <a class="indexterm" href="#intro-history">FreeBSD 歷史簡介</a></dt><dt>groups, <a class="indexterm" href="#users-groups">管理群組</a></dt><dt>gv, <a class="indexterm" href="#idp67662392">gv</a></dt></dl></div><div class="indexdiv"><h3>H</h3><dl><dt>hard limit, <a class="indexterm" href="#idp76013240">設定配額限制</a></dt><dt>HAST</dt><dd><dl><dt>high availability, <a class="indexterm" href="#disks-hast">高可用存儲空間 (HAST)</a></dt></dl></dd><dt>HCI, <a class="indexterm" href="#idp88083384">尋找其他藍牙裝置</a></dt><dt>hostname, <a class="indexterm" href="#idp70303416">主機名稱</a></dt><dt>hosts, <a class="indexterm" href="#idp70337848">/etc/hosts</a></dt><dt>HP-UX, <a class="indexterm" href="#network-nis">網路資訊系統 (NIS)</a></dt><dt>Hubbard, Jordan, <a class="indexterm" href="#intro-history">FreeBSD 歷史簡介</a></dt><dt>hw.ata.wc, <a class="indexterm" href="#idp70431928">hw.ata.wc</a></dt></dl></div><div class="indexdiv"><h3>I</h3><dl><dt>I/O port, <a class="indexterm" href="#troubleshooting">疑難排解音效</a></dt><dt>IEEE, <a class="indexterm" href="#idp75722680">目錄備份</a></dt><dt>image scanners, <a class="indexterm" href="#scanners">影像掃描器</a></dt><dt>IMAP, <a class="indexterm" href="#mail-using">郵件組成</a></dt><dt>init8, <a class="indexterm" href="#boot-introduction">FreeBSD 開機程序</a>, <a class="indexterm" href="#boot-init">最終階段</a></dt><dt>installation</dt><dd><dl><dt>troubleshooting, <a class="indexterm" href="#bsdinstall-install-trouble">疑難排解</a></dt></dl></dd><dt>Intel i810 graphic chipset, <a class="indexterm" href="#idp67319352">設定 Intel® i810 繪圖晶片組</a></dt><dt>internationalization (see localization)</dt><dt>Internet Systems Consortium (ISC), <a class="indexterm" href="#network-dhcp">動態主機設置協定 (DHCP)</a></dt><dt>interrupt storms, <a class="indexterm" href="#idp70811064">系統無回應</a></dt><dt>IP
	aliases, <a class="indexterm" href="#configtuning-virtual-hosts">虛擬主機</a></dt><dt>IP masquerading (see NAT)</dt><dt>IP 子網段, <a class="indexterm" href="#network-bridging">橋接</a></dt><dt>IPFILTER</dt><dd><dl><dt>enabling, <a class="indexterm" href="#idp86558264">開啟 IPF</a></dt><dt>kernel options, <a class="indexterm" href="#idp86558264">開啟 IPF</a></dt><dt>logging, <a class="indexterm" href="#idp86533304">IPF 日誌</a></dt><dt>rule syntax, <a class="indexterm" href="#idp86596152">IPF 規則語法</a></dt><dt>statistics, <a class="indexterm" href="#idp86838968">檢視 IPF 統計資訊</a></dt></dl></dd><dt>ipfstat, <a class="indexterm" href="#idp86838968">檢視 IPF 統計資訊</a></dt><dt>IPFW</dt><dd><dl><dt>enabling, <a class="indexterm" href="#firewalls-ipfw-enable">開啟 IPFW</a></dt><dt>kernel options, <a class="indexterm" href="#firewalls-ipfw-kernelconfig">IPFW 核心選項</a></dt><dt>logging, <a class="indexterm" href="#idp86450872">記錄防火牆訊息</a></dt><dt>rule processing order, <a class="indexterm" href="#firewalls-ipfw-rules">IPFW 規則語法</a></dt><dt>rule syntax, <a class="indexterm" href="#firewalls-ipfw-rules">IPFW 規則語法</a></dt></dl></dd><dt>ipfw, <a class="indexterm" href="#firewalls-ipfw-cmd">IPFW 指令</a></dt><dt>ipmon, <a class="indexterm" href="#idp86533304">IPF 日誌</a></dt><dt>ipnat, <a class="indexterm" href="#idp86740536">設定 NAT</a></dt><dt>IPsec, <a class="indexterm" href="#ipsec">VPN over
	IPsec</a></dt><dd><dl><dt>AH, <a class="indexterm" href="#ipsec">VPN over
	IPsec</a></dt><dt>ESP, <a class="indexterm" href="#ipsec">VPN over
	IPsec</a></dt></dl></dd><dt>IRQ, <a class="indexterm" href="#troubleshooting">疑難排解音效</a></dt><dt>Isilon, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>ISO
      9660, <a class="indexterm" href="#creating-cds">建立與使用 CD 媒體</a></dt><dt>iXsystems, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt></dl></div><div class="indexdiv"><h3>J</h3><dl><dt>jails, <a class="indexterm" href="#jails">Jail</a></dt><dt>Jolitz, Bill, <a class="indexterm" href="#intro-history">FreeBSD 歷史簡介</a></dt><dt>Journaling, <a class="indexterm" href="#geom-gjournal">UFS Journaling 透過 GEOM</a></dt><dt>Juniper, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt></dl></div><div class="indexdiv"><h3>K</h3><dl><dt>KDE, <a class="indexterm" href="#os-overview">FreeBSD 能做什麼？</a>, <a class="indexterm" href="#x11-wm-kde">KDE</a></dt><dd><dl><dt>display manager, <a class="indexterm" href="#x11-wm-kde">KDE</a></dt></dl></dd><dt>Kerberos5</dt><dd><dl><dt>configure clients, <a class="indexterm" href="#idp72064568">設定客戶端使用 Kerberos</a></dt><dt>enabling services, <a class="indexterm" href="#idp63142200">設定伺服器使用 Kerberos</a></dt><dt>external resources, <a class="indexterm" href="#idp72186296">相關資源與延伸資訊</a></dt><dt>Key Distribution Center, <a class="indexterm" href="#idp71986104">設定 Heimdal KDC</a></dt><dt>limitations and shortcomings, <a class="indexterm" href="#idp72161976">減輕 Kerberos 的限制</a></dt></dl></dd><dt>kern.cam.scsi_delay, <a class="indexterm" href="#idp70456376">SCSI_DELAY
	  (kern.cam.scsi_delay)</a></dt><dt>kern.ipc.soacceptqueue, <a class="indexterm" href="#idp70551992">kern.ipc.soacceptqueue</a></dt><dt>kern.maxfiles, <a class="indexterm" href="#kern-maxfiles">kern.maxfiles</a></dt><dt>kernel, <a class="indexterm" href="#boot-introduction">FreeBSD 開機程序</a></dt><dd><dl><dt>boot interaction, <a class="indexterm" href="#boot-loader">階段三</a></dt><dt>bootflags, <a class="indexterm" href="#boot-init">最終階段</a></dt><dt>building / installing, <a class="indexterm" href="#kernelconfig-building">編譯與安裝自訂核心</a></dt><dt>building a custom kernel, <a class="indexterm" href="#kernelconfig-synopsis">概述</a></dt><dt>configuration, <a class="indexterm" href="#sound-setup">設定音效卡</a></dt><dt>configuration file, <a class="indexterm" href="#kernelconfig-config">設定檔</a></dt><dt>NOTES, <a class="indexterm" href="#kernelconfig-config">設定檔</a></dt></dl></dd><dt>keymap, <a class="indexterm" href="#setting-console">Console 設定</a></dt><dt>KLD (kernel loadable
	    object), <a class="indexterm" href="#config-network-ndis">使用 Windows® NDIS 驅動程式</a></dt><dt>KMyMoney, <a class="indexterm" href="#idp67769528">KMyMoney</a></dt><dt>Konqueror, <a class="indexterm" href="#idp67448760">Konqueror</a></dt></dl></div><div class="indexdiv"><h3>L</h3><dl><dt>L2CAP, <a class="indexterm" href="#idp88182200">Logical Link Control and Adaptation Protocol
	  (L2CAP)</a></dt><dt>LACP, <a class="indexterm" href="#network-aggregation">Link Aggregation 與容錯移轉</a></dt><dt>lagg, <a class="indexterm" href="#network-aggregation">Link Aggregation 與容錯移轉</a></dt><dt>language codes, <a class="indexterm" href="#using-localization">使用語系</a></dt><dt>LCD screen, <a class="indexterm" href="#antialias">反鋸齒字型</a></dt><dt>LCP, <a class="indexterm" href="#userppp-mgetty">設定撥入服務</a></dt><dt>LDAP, <a class="indexterm" href="#network-ldap">輕量級目錄存取協定 (LDAP)</a>, <a class="indexterm" href="#idp85025080">安全性設定</a></dt><dt>LDAP Server, <a class="indexterm" href="#ldap-config">設定 LDAP 伺服器</a></dt><dt>LibreOffice, <a class="indexterm" href="#idp67592760">LibreOffice</a></dt><dt>limiting users, <a class="indexterm" href="#users-limiting">設定登入類別</a></dt><dd><dl><dt>coredumpsize, <a class="indexterm" href="#users-limiting">設定登入類別</a></dt><dt>cputime, <a class="indexterm" href="#users-limiting">設定登入類別</a></dt><dt>filesize, <a class="indexterm" href="#users-limiting">設定登入類別</a></dt><dt>maxproc, <a class="indexterm" href="#users-limiting">設定登入類別</a></dt><dt>memorylocked, <a class="indexterm" href="#users-limiting">設定登入類別</a></dt><dt>memoryuse, <a class="indexterm" href="#users-limiting">設定登入類別</a></dt><dt>openfiles, <a class="indexterm" href="#users-limiting">設定登入類別</a></dt><dt>quotas, <a class="indexterm" href="#security-resourcelimits">限制資源</a></dt><dt>sbsize, <a class="indexterm" href="#users-limiting">設定登入類別</a></dt><dt>stacksize, <a class="indexterm" href="#users-limiting">設定登入類別</a></dt></dl></dd><dt>Linux, <a class="indexterm" href="#network-nis">網路資訊系統 (NIS)</a></dt><dd><dl><dt>ELF binaries, <a class="indexterm" href="#idp69370168">安裝 Linux® ELF Binary</a></dt></dl></dd><dt>Linux binary compatibility, <a class="indexterm" href="#linuxemu-synopsis">概述</a></dt><dt>livefs
	  CD, <a class="indexterm" href="#idp75801912">緊急還原</a></dt><dt>loadbalance, <a class="indexterm" href="#network-aggregation">Link Aggregation 與容錯移轉</a></dt><dt>loader, <a class="indexterm" href="#boot-loader">階段三</a></dt><dt>loader configuration, <a class="indexterm" href="#boot-loader">階段三</a></dt><dt>locale, <a class="indexterm" href="#using-localization">使用語系</a>, <a class="indexterm" href="#setting-locale">設定登入 Shell 的語系</a></dt><dt>localization</dt><dd><dl><dt>German, <a class="indexterm" href="#idp80136632">其他特定語言資源</a></dt><dt>Greek, <a class="indexterm" href="#idp80136632">其他特定語言資源</a></dt><dt>Japanese, <a class="indexterm" href="#idp80136632">其他特定語言資源</a></dt><dt>Korean, <a class="indexterm" href="#idp80136632">其他特定語言資源</a></dt><dt>Russian, <a class="indexterm" href="#ru-localize">俄語 (KOI8-R 編碼)</a></dt><dt>Traditional Chinese, <a class="indexterm" href="#idp80136632">其他特定語言資源</a></dt></dl></dd><dt>log files</dt><dd><dl><dt>FTP, <a class="indexterm" href="#idp84905144">設定</a></dt></dl></dd><dt>log management, <a class="indexterm" href="#idp70118968">日誌管理與翻轉</a></dt><dt>log rotation, <a class="indexterm" href="#idp70118968">日誌管理與翻轉</a></dt><dt>login class, <a class="indexterm" href="#setting-locale">設定登入 Shell 的語系</a>, <a class="indexterm" href="#idp79884344">變更登入類別的工具</a></dt><dt>ls1, <a class="indexterm" href="#permissions">權限</a></dt></dl></div><div class="indexdiv"><h3>M</h3><dl><dt>MAC, <a class="indexterm" href="#mac-synopsis">概述</a></dt><dd><dl><dt>File System Firewall Policy, <a class="indexterm" href="#mac-bsdextended">MAC BSD Extended 政策</a></dt></dl></dd><dt>MAC Biba Integrity Policy, <a class="indexterm" href="#mac-biba">MAC Biba 模組</a></dt><dt>MAC Configuration Testing, <a class="indexterm" href="#idp74502584">測試設定</a></dt><dt>MAC Interface Silencing Policy, <a class="indexterm" href="#mac-ifoff">MAC Interface Silencing 政策</a></dt><dt>MAC LOMAC, <a class="indexterm" href="#mac-lomac">MAC Low-watermark 模組</a></dt><dt>MAC Multi-Level Security Policy, <a class="indexterm" href="#mac-mls">MAC Multi-Level Security 模組</a></dt><dt>MAC Port Access Control List Policy, <a class="indexterm" href="#mac-portacl">MAC Port Access Control 政策</a></dt><dt>MAC Process Partition Policy, <a class="indexterm" href="#mac-partition">MAC Partition 政策</a></dt><dt>MAC See Other UIDs Policy, <a class="indexterm" href="#mac-seeotheruids">MAC See Other UIDs 政策</a></dt><dt>MAC Troubleshooting, <a class="indexterm" href="#mac-troubleshoot">MAC 架構疑難排解</a></dt><dt>MacOS, <a class="indexterm" href="#idp71832248">產生單組一次性密碼</a></dt><dt>mail host, <a class="indexterm" href="#mail-using">郵件組成</a></dt><dt>mail server daemons</dt><dd><dl><dt>Exim, <a class="indexterm" href="#mail-using">郵件組成</a></dt><dt>Postfix, <a class="indexterm" href="#mail-using">郵件組成</a></dt><dt>qmail, <a class="indexterm" href="#mail-using">郵件組成</a></dt><dt>Sendmail, <a class="indexterm" href="#mail-using">郵件組成</a></dt></dl></dd><dt>Mail User Agents, <a class="indexterm" href="#mail-agents">郵件使用者代理程式</a></dt><dt>Mandatory Access Control (see MAC)</dt><dt>manual pages, <a class="indexterm" href="#basics-more-information">操作手冊</a></dt><dt>Master Boot Record
	(MBR), <a class="indexterm" href="#boot-introduction">FreeBSD 開機程序</a>, <a class="indexterm" href="#boot-boot0">開機管理程式</a></dt><dt>McAfee, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>mencoder, <a class="indexterm" href="#video-mplayer">MPlayer 與 MEncoder</a></dt><dt>mfsBSD, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>mgetty, <a class="indexterm" href="#userppp-mgetty">設定撥入服務</a></dt><dt>Microsoft Windows, <a class="indexterm" href="#network-samba">Microsoft® Windows® 用戶端檔案與列印服務 (Samba)</a></dt><dt>Microsoft Windows</dt><dd><dl><dt>device drivers, <a class="indexterm" href="#config-network-ndis">使用 Windows® NDIS 驅動程式</a></dt></dl></dd><dt>MIME, <a class="indexterm" href="#setting-locale">設定登入 Shell 的語系</a></dt><dt>modem, <a class="indexterm" href="#dialup">撥入服務</a></dt><dt>mod_perl</dt><dd><dl><dt>Perl, <a class="indexterm" href="#idp84815928">mod_perl</a></dt></dl></dd><dt>mod_php</dt><dd><dl><dt>PHP, <a class="indexterm" href="#idp84837944">mod_php</a></dt></dl></dd><dt>mountd, <a class="indexterm" href="#network-nfs">網路檔案系統 (NFS)</a></dt><dt>moused, <a class="indexterm" href="#setting-console">Console 設定</a></dt><dt>MPlayer, <a class="indexterm" href="#video-mplayer">MPlayer 與 MEncoder</a></dt><dt>MS-DOS, <a class="indexterm" href="#idp71832248">產生單組一次性密碼</a></dt><dt>multi-user mode, <a class="indexterm" href="#boot-multiuser">多使用者模式</a></dt><dt>multicast routing, <a class="indexterm" href="#network-routing-multicast">群播 (Multicast) 注意事項</a></dt><dt>MX record, <a class="indexterm" href="#mail-using">郵件組成</a>, <a class="indexterm" href="#mail-trouble">疑難排解</a>, <a class="indexterm" href="#mail-config">基礎設定</a></dt></dl></div><div class="indexdiv"><h3>N</h3><dl><dt>Nagios in a MAC Jail, <a class="indexterm" href="#mac-implementing">在 MAC Jail 中使用 Nagios</a></dt><dt>NAS4Free, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>NAT, <a class="indexterm" href="#os-overview">FreeBSD 能做什麼？</a>, <a class="indexterm" href="#idp86740536">設定 NAT</a></dt><dd><dl><dt>and IPFW, <a class="indexterm" href="#in-kernel-nat">核心內 NAT</a></dt></dl></dd><dt>NDIS, <a class="indexterm" href="#config-network-ndis">使用 Windows® NDIS 驅動程式</a></dt><dt>NDISulator, <a class="indexterm" href="#config-network-ndis">使用 Windows® NDIS 驅動程式</a></dt><dt>net.inet.ip.portrange.*, <a class="indexterm" href="#idp70591032">net.inet.ip.portrange.*</a></dt><dt>Net/2, <a class="indexterm" href="#intro-history">FreeBSD 歷史簡介</a></dt><dt>NetApp, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>NetBIOS, <a class="indexterm" href="#idp82200248">進階設定</a></dt><dt>NetBSD, <a class="indexterm" href="#network-nis">網路資訊系統 (NIS)</a></dt><dt>Netflix, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>netgroups, <a class="indexterm" href="#network-netgroups">使用 Netgroups</a></dt><dt>network address translation (see NAT)</dt><dt>network cards</dt><dd><dl><dt>configuration, <a class="indexterm" href="#config-network-setup">設定網路介面卡</a>, <a class="indexterm" href="#idp69475128">設定網路卡</a></dt><dt>driver, <a class="indexterm" href="#idp69940536">找到正確的驅動程式</a></dt><dt>testing, <a class="indexterm" href="#idp69555768">測試乙太網路卡</a></dt><dt>troubleshooting, <a class="indexterm" href="#idp70017208">疑難排解</a></dt></dl></dd><dt>newsyslog, <a class="indexterm" href="#idp70118968">日誌管理與翻轉</a></dt><dt>newsyslog.conf, <a class="indexterm" href="#idp70118968">日誌管理與翻轉</a></dt><dt>NFS, <a class="indexterm" href="#idp76050616">NFS 上的配額</a>, <a class="indexterm" href="#network-nfs">網路檔案系統 (NFS)</a></dt><dd><dl><dt>configuration, <a class="indexterm" href="#network-configuring-nfs">設定伺服器</a></dt><dt>export examples, <a class="indexterm" href="#network-configuring-nfs">設定伺服器</a></dt><dt>installing multiple machines, <a class="indexterm" href="#small-lan">多部機器追蹤</a></dt><dt>mounting, <a class="indexterm" href="#idp83702456">設定客戶端</a></dt><dt>server, <a class="indexterm" href="#network-nfs">網路檔案系統 (NFS)</a></dt></dl></dd><dt>nfsd, <a class="indexterm" href="#network-nfs">網路檔案系統 (NFS)</a></dt><dt>NIS, <a class="indexterm" href="#network-nis">網路資訊系統 (NIS)</a></dt><dd><dl><dt>client, <a class="indexterm" href="#idp83921080">主機類型</a></dt><dt>client configuration, <a class="indexterm" href="#idp84109752">設定 NIS 客戶端</a></dt><dt>domain name, <a class="indexterm" href="#idp83975608">選擇 NIS 網域名稱</a></dt><dt>domains, <a class="indexterm" href="#network-nis">網路資訊系統 (NIS)</a></dt><dt>maps, <a class="indexterm" href="#idp84030904">初始化 NIS 對應表</a></dt><dt>master server, <a class="indexterm" href="#idp83921080">主機類型</a></dt><dt>password formats, <a class="indexterm" href="#idp84315448">密碼格式</a></dt><dt>server configuration, <a class="indexterm" href="#idp84004152">設定 NIS Master 伺服器</a></dt><dt>slave server, <a class="indexterm" href="#idp83921080">主機類型</a>, <a class="indexterm" href="#idp84086200">設定 NIS Slave 伺服器</a></dt></dl></dd><dt>NIS+, <a class="indexterm" href="#idp85025080">安全性設定</a></dt><dt>NOTES, <a class="indexterm" href="#kernelconfig-config">設定檔</a></dt><dt>Novell, <a class="indexterm" href="#intro-history">FreeBSD 歷史簡介</a></dt><dt>NTP, <a class="indexterm" href="#idp85065656">NTP 設定</a></dt><dd><dl><dt>ntp.conf, <a class="indexterm" href="#idp85070136">/etc/ntp.conf 檔</a></dt><dt>ntpd, <a class="indexterm" href="#network-ntp">NTP 時間校對</a></dt><dt>rc.conf, <a class="indexterm" href="#idp85106488">在 /etc/rc.conf 中的 NTP 設定項目</a></dt></dl></dd><dt>null-modem cable, <a class="indexterm" href="#term-cables-null">序列線與埠</a>, <a class="indexterm" href="#serialconsole-howto">深入序列 Console 設定</a></dt></dl></div><div class="indexdiv"><h3>O</h3><dl><dt>OBEX, <a class="indexterm" href="#idp88296120">OBEX Object Push
	  (OPUSH)</a></dt><dt>office suite</dt><dd><dl><dt>
	  Apache OpenOffice
	, <a class="indexterm" href="#idp67555640">Apache OpenOffice</a></dt><dt>Calligra, <a class="indexterm" href="#idp67520824">Calligra</a></dt><dt>LibreOffice, <a class="indexterm" href="#idp67592760">LibreOffice</a></dt></dl></dd><dt>Okular, <a class="indexterm" href="#idp67698616">Okular</a></dt><dt>one-time passwords, <a class="indexterm" href="#one-time-passwords">一次性密碼</a></dt><dt>OpenBSD, <a class="indexterm" href="#network-nis">網路資訊系統 (NIS)</a></dt><dt>OpenSSH, <a class="indexterm" href="#openssh">OpenSSH</a></dt><dd><dl><dt>client, <a class="indexterm" href="#idp72454328">使用 SSH 客戶端工具</a></dt><dt>enabling, <a class="indexterm" href="#idp72610104">開啟 SSH 伺服器</a></dt><dt>secure copy, <a class="indexterm" href="#idp72454328">使用 SSH 客戶端工具</a></dt><dt>tunneling, <a class="indexterm" href="#security-ssh-tunneling">SSH 通道</a></dt></dl></dd><dt>OpenSSL</dt><dd><dl><dt>certificate generation, <a class="indexterm" href="#idp72220088">產生憑証</a></dt></dl></dd><dt>Opera, <a class="indexterm" href="#idp67410232">Opera</a></dt><dt>OPNsense, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>OSPF, <a class="indexterm" href="#network-static-routes">設定路由器使用靜態路由</a></dt></dl></div><div class="indexdiv"><h3>P</h3><dl><dt>PAP, <a class="indexterm" href="#userppp-PAPnCHAP">PAP 與 CHAP 認證</a></dt><dt>partitions, <a class="indexterm" href="#disk-organization">磁碟組織</a>, <a class="indexterm" href="#disks-adding">加入磁碟</a>, <a class="indexterm" href="#disks-growing">重設大小與擴增磁碟</a></dt><dt>passwd, <a class="indexterm" href="#users-passwd">passwd</a></dt><dt>password, <a class="indexterm" href="#userppp-PAPnCHAP">PAP 與 CHAP 認證</a></dt><dt>pax, <a class="indexterm" href="#idp75722680">目錄備份</a></dt><dt>PCI, <a class="indexterm" href="#sound-setup">設定音效卡</a></dt><dt>PDF</dt><dd><dl><dt>viewing, <a class="indexterm" href="#idp67637304">Xpdf</a>, <a class="indexterm" href="#idp67662392">gv</a>, <a class="indexterm" href="#idp67688888">ePDFView</a>, <a class="indexterm" href="#idp67698616">Okular</a></dt></dl></dd><dt>permissions, <a class="indexterm" href="#permissions">權限</a></dt><dd><dl><dt>symbolic, <a class="indexterm" href="#idp64837048">權限符號</a></dt></dl></dd><dt>pfSense, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>pgp keys, <a class="indexterm" href="#pgpkeys">OpenPGP 金鑰</a></dt><dt>pkg, <a class="indexterm" href="#security-pkg">監視第三方安全性問題</a></dt><dd><dl><dt>search, <a class="indexterm" href="#ports-finding-applications">搜尋軟體</a></dt></dl></dd><dt>POP, <a class="indexterm" href="#mail-using">郵件組成</a></dt><dt>portmap, <a class="indexterm" href="#idp83887672">NIS 術語與程序</a></dt><dt>portmaster, <a class="indexterm" href="#portmaster">使用 Portmaster 升級 Port</a></dt><dt>ports, <a class="indexterm" href="#ports-synopsis">概述</a></dt><dd><dl><dt>disk-space, <a class="indexterm" href="#ports-disk-space">Port 與磁碟空間</a></dt><dt>installing, <a class="indexterm" href="#ports-skeleton">安裝 Port</a></dt><dt>removing, <a class="indexterm" href="#ports-removing">移除已安裝的 Port</a></dt><dt>upgrading, <a class="indexterm" href="#ports-upgrading">升級 Port</a></dt><dt>upgrading-tools, <a class="indexterm" href="#ports-upgrading-tools">升級與管理 Port 的工具</a></dt></dl></dd><dt>Ports Collection, <a class="indexterm" href="#linuxemu-lbc-install">設定 Linux® Binary 相容性</a></dt><dt>portupgrade, <a class="indexterm" href="#portupgrade">使用 Portupgrade 升級 Port</a></dt><dt>POSIX, <a class="indexterm" href="#idp75722680">目錄備份</a>, <a class="indexterm" href="#setting-locale">設定登入 Shell 的語系</a></dt><dt>PostScript</dt><dd><dl><dt>viewing, <a class="indexterm" href="#idp67662392">gv</a></dt></dl></dd><dt>PPP, <a class="indexterm" href="#ppp-and-slip-synopsis">概述</a></dt><dd><dl><dt>configuration, <a class="indexterm" href="#userppp-final">最終系統設定</a></dt><dt>Microsoft extensions, <a class="indexterm" href="#idp82200248">進階設定</a></dt><dt>NAT, <a class="indexterm" href="#userppp-nat">使用 PPP 網路位址轉譯功能</a></dt><dt>over ATM, <a class="indexterm" href="#pppoa">在 ATM 使用 PPP (PPPoA)</a></dt><dt>over Ethernet, <a class="indexterm" href="#ppp-and-slip-synopsis">概述</a>, <a class="indexterm" href="#pppoe">在乙太網路使用 PPP (PPPoE)</a></dt><dt>troubleshooting, <a class="indexterm" href="#ppp-troubleshoot">PPP 連線疑難排解</a></dt><dt>with static IP
	    addresses, <a class="indexterm" href="#userppp-staticIP">基礎設定</a></dt></dl></dd><dt>PPPoA, <a class="indexterm" href="#pppoa">在 ATM 使用 PPP (PPPoA)</a></dt><dt>print server</dt><dd><dl><dt>Windows clients, <a class="indexterm" href="#network-samba">Microsoft® Windows® 用戶端檔案與列印服務 (Samba)</a></dt></dl></dd><dt>printers, <a class="indexterm" href="#ru-localize">俄語 (KOI8-R 編碼)</a></dt><dt>Process Accounting, <a class="indexterm" href="#security-accounting">程序追蹤</a></dt><dt>procmail, <a class="indexterm" href="#mail-procmail">使用 procmail</a></dt><dt>pw, <a class="indexterm" href="#users-pw">pw</a>, <a class="indexterm" href="#idp79884344">變更登入類別的工具</a></dt><dt>Python, <a class="indexterm" href="#idp84880696">Django</a></dt></dl></div><div class="indexdiv"><h3>Q</h3><dl><dt>Quest KACE, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>quotas, <a class="indexterm" href="#security-resourcelimits">限制資源</a></dt></dl></div><div class="indexdiv"><h3>R</h3><dl><dt>RAID1, <a class="indexterm" href="#geom-mirror">RAID1 - 鏡像 (Mirroring)</a></dt><dt>RAID3, <a class="indexterm" href="#geom-raid3">RAID3 - 位元級串連與獨立奇偶校驗</a></dt><dt>rc files, <a class="indexterm" href="#boot-multiuser">多使用者模式</a></dt><dd><dl><dt>rc.conf, <a class="indexterm" href="#configtuning-core-configuration">管理系統特定的設定</a></dt><dt>rc.serial, <a class="indexterm" href="#serial-hw-config">序列埠設定</a>, <a class="indexterm" href="#dialup-ttys">數據機設定</a></dt></dl></dd><dt>resolv.conf, <a class="indexterm" href="#idp70305336">/etc/resolv.conf</a></dt><dt>resolver, <a class="indexterm" href="#network-dns">網域名稱系統 (DNS)</a></dt><dt>Resource limits, <a class="indexterm" href="#security-resourcelimits">限制資源</a></dt><dt>restore, <a class="indexterm" href="#idp75669816">檔案系統備份</a></dt><dt>reverse
      DNS, <a class="indexterm" href="#network-dns">網域名稱系統 (DNS)</a></dt><dt>RIP, <a class="indexterm" href="#network-static-routes">設定路由器使用靜態路由</a></dt><dt>rmuser, <a class="indexterm" href="#users-rmuser">rmuser</a></dt><dt>root file system, <a class="indexterm" href="#mount-unmount">掛載與卸載檔案系統</a></dt><dt>root zone, <a class="indexterm" href="#network-dns">網域名稱系統 (DNS)</a></dt><dt>roundrobin, <a class="indexterm" href="#network-aggregation">Link Aggregation 與容錯移轉</a></dt><dt>routed, <a class="indexterm" href="#userppp-final">最終系統設定</a></dt><dt>router, <a class="indexterm" href="#os-overview">FreeBSD 能做什麼？</a></dt><dt>routing, <a class="indexterm" href="#network-routing">通訊閘與路由</a></dt><dt>rpcbind, <a class="indexterm" href="#network-nfs">網路檔案系統 (NFS)</a>, <a class="indexterm" href="#idp83887672">NIS 術語與程序</a></dt><dt>Ruby on Rails, <a class="indexterm" href="#idp84894904">Ruby on Rails</a></dt></dl></div><div class="indexdiv"><h3>S</h3><dl><dt>Samba server, <a class="indexterm" href="#network-samba">Microsoft® Windows® 用戶端檔案與列印服務 (Samba)</a></dt><dt>Sandvine, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>scp1, <a class="indexterm" href="#idp72454328">使用 SSH 客戶端工具</a></dt><dt>screenmap, <a class="indexterm" href="#setting-console">Console 設定</a></dt><dt>SDL, <a class="indexterm" href="#video-interface">偵測影像處理能力</a></dt><dt>SDP, <a class="indexterm" href="#idp88236344">Service Discovery Protocol
	  (SDP)</a></dt><dt>security, <a class="indexterm" href="#security">安全性</a></dt><dd><dl><dt>firewalls, <a class="indexterm" href="#firewalls">防火牆</a></dt><dt>one-time passwords, <a class="indexterm" href="#one-time-passwords">一次性密碼</a></dt><dt>OpenSSH, <a class="indexterm" href="#openssh">OpenSSH</a></dt><dt>OpenSSL, <a class="indexterm" href="#openssl">OpenSSL</a></dt></dl></dd><dt>Security</dt><dd><dl><dt>Sudo, <a class="indexterm" href="#security-sudo">使用 Sudo 分享管理權限</a></dt></dl></dd><dt>Security Event Auditing (see MAC)</dt><dt>sendmail, <a class="indexterm" href="#userppp-final">最終系統設定</a></dt><dt>Sendmail, <a class="indexterm" href="#sendmail">Sendmail 設定檔</a></dt><dt>serial communications, <a class="indexterm" href="#serial-synopsis">概述</a></dt><dt>serial console, <a class="indexterm" href="#serialconsole-setup">設定序列 Console</a></dt><dt>services, <a class="indexterm" href="#configtuning-starting-services">啟動服務</a></dt><dt>shared libraries, <a class="indexterm" href="#linuxemu-libs-manually">手動安裝其他程式庫</a></dt><dt>shells, <a class="indexterm" href="#shells">Shell</a></dt><dt>shutdown8, <a class="indexterm" href="#boot-shutdown">關機程序</a></dt><dt>single-user
	  mode, <a class="indexterm" href="#boot-loader">階段三</a>, <a class="indexterm" href="#boot-singleuser">單使用者模式</a></dt><dt>skeleton directory, <a class="indexterm" href="#users-adduser">adduser</a></dt><dt>slices, <a class="indexterm" href="#disk-organization">磁碟組織</a></dt><dt>SMTP, <a class="indexterm" href="#userppp-final">最終系統設定</a>, <a class="indexterm" href="#mail-config">基礎設定</a></dt><dt>soft limit, <a class="indexterm" href="#idp76013240">設定配額限制</a></dt><dt>Soft Updates, <a class="indexterm" href="#soft-updates">軟更新</a></dt><dd><dl><dt>details, <a class="indexterm" href="#idp70459448">有關軟更新的更多詳細資訊</a></dt></dl></dd><dt>Software RAID Devices</dt><dd><dl><dt>Hardware-assisted RAID, <a class="indexterm" href="#geom-graid">軟體 RAID 裝置</a></dt></dl></dd><dt>Solaris, <a class="indexterm" href="#linuxemu-advanced">進階主題</a>, <a class="indexterm" href="#network-nis">網路資訊系統 (NIS)</a></dt><dt>Sony, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>Sophos, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>sound cards, <a class="indexterm" href="#sound-setup">設定音效卡</a></dt><dt>SourceForge, <a class="indexterm" href="#ports-finding-applications">搜尋軟體</a></dt><dt>Spectra Logic, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>SQL database, <a class="indexterm" href="#idp85025080">安全性設定</a></dt><dt>SSL, <a class="indexterm" href="#idp84809272">mod_ssl</a></dt><dt>static IP address, <a class="indexterm" href="#userppp">設定 PPP</a></dt><dt>Stormshield, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>Striping, <a class="indexterm" href="#geom-striping">RAID0 - 串連 (Striping)</a></dt><dt>subnet, <a class="indexterm" href="#network-routing">通訊閘與路由</a></dt><dt>Subversion, <a class="indexterm" href="#development">FreeBSD 開發模式</a>, <a class="indexterm" href="#stable">使用 FreeBSD-STABLE</a>, <a class="indexterm" href="#svn">使用 Subversion</a></dt><dt>Subversion Repository, <a class="indexterm" href="#development">FreeBSD 開發模式</a></dt><dd><dl><dt>Mirror Sites, <a class="indexterm" href="#svn-mirrors">Subversion 鏡像站</a></dt></dl></dd><dt>SVN (參見 Subversion)</dt><dt>swap</dt><dd><dl><dt>encrypting, <a class="indexterm" href="#swap-encrypting">交換空間加密</a></dt></dl></dd><dt>swap partition, <a class="indexterm" href="#configtuning-initial">規劃分割區配置</a></dt><dt>swap sizing, <a class="indexterm" href="#configtuning-initial">規劃分割區配置</a></dt><dt>symbolic links, <a class="indexterm" href="#linuxemu-libs-manually">手動安裝其他程式庫</a></dt><dt>sysctl, <a class="indexterm" href="#configtuning-sysctl">使用 sysctl(8) 調校</a>, <a class="indexterm" href="#configtuning-sysctlconf">sysctl.conf</a></dt><dt>sysctl.conf, <a class="indexterm" href="#configtuning-sysctlconf">sysctl.conf</a></dt><dt>syslog, <a class="indexterm" href="#configtuning-syslog">設定系統日誌</a>, <a class="indexterm" href="#idp84905144">設定</a></dt><dt>syslog.conf, <a class="indexterm" href="#idp69424312">設定本地日誌</a></dt><dt>syslogd8, <a class="indexterm" href="#configtuning-syslog">設定系統日誌</a></dt><dt>system configuration, <a class="indexterm" href="#config-synopsis">概述</a></dt><dt>system logging, <a class="indexterm" href="#configtuning-syslog">設定系統日誌</a></dt><dt>system optimization, <a class="indexterm" href="#config-synopsis">概述</a></dt></dl></div><div class="indexdiv"><h3>T</h3><dl><dt>tape media, <a class="indexterm" href="#backups-tapebackups">使用資料磁帶備份</a></dt><dt>tar, <a class="indexterm" href="#idp75722680">目錄備份</a></dt><dt>TCP Bandwidth Delay Product
	      Limiting</dt><dd><dl><dt>net.inet.tcp.inflight.enable, <a class="indexterm" href="#idp70598840">TCP 頻寬延遲乘積</a></dt></dl></dd><dt>TCP Wrapper, <a class="indexterm" href="#tcpwrappers">TCP Wrapper</a>, <a class="indexterm" href="#idp84135992">NIS 安全性</a></dt><dt>TCP/IP
	      networking, <a class="indexterm" href="#nutshell">歡迎使用 FreeBSD！</a></dt><dt>terminals, <a class="indexterm" href="#consoles">虛擬 Console 與終端機</a>, <a class="indexterm" href="#term">終端機</a></dt><dt>tether, <a class="indexterm" href="#network-usb-tethering">USB 網路共享</a></dt><dt>text editors, <a class="indexterm" href="#editors">文字編輯器</a></dt><dt>The GIMP, <a class="indexterm" href="#idp67543736">The GIMP</a></dt><dt>The Weather Channel, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>traceroute8, <a class="indexterm" href="#network-routing-troubleshooting">疑難排解</a></dt><dt>Traditional Chinese</dt><dd><dl><dt>BIG-5 encoding, <a class="indexterm" href="#login-class">登入類別 (Login Class) 法</a></dt></dl></dd><dt>TrueOS, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>TrueType Fonts, <a class="indexterm" href="#truetype">TrueType® 字型</a></dt><dt>ttyu, <a class="indexterm" href="#serial-hw-config">序列埠設定</a></dt><dt>tunefs8, <a class="indexterm" href="#soft-updates">軟更新</a></dt><dt>tuning</dt><dd><dl><dt>kernel limits, <a class="indexterm" href="#configtuning-kernel-limits">調校核心限制</a></dt><dt>with sysctl, <a class="indexterm" href="#configtuning-sysctl">使用 sysctl(8) 調校</a></dt></dl></dd><dt>TV cards, <a class="indexterm" href="#tvcard">電視卡</a></dt></dl></div><div class="indexdiv"><h3>U</h3><dl><dt>U.C. Berkeley, <a class="indexterm" href="#intro-history">FreeBSD 歷史簡介</a></dt><dt>UDP, <a class="indexterm" href="#idp84500408">設定 DHCP 客戶端</a></dt><dt>UNIX, <a class="indexterm" href="#permissions">權限</a></dt><dt>Updating and Upgrading, <a class="indexterm" href="#updating-upgrading-freebsdupdate">FreeBSD 更新</a>, <a class="indexterm" href="#updating-upgrading-documentation">更新文件集</a>, <a class="indexterm" href="#doc-ports-install-package">自 Port 更新說明文件</a></dt><dt>USB</dt><dd><dl><dt>disks, <a class="indexterm" href="#usb-disks">USB 儲存裝置</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>V</h3><dl><dt>Verisign, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>vfs.hirunningspace, <a class="indexterm" href="#idp70416824">vfs.hirunningspace</a></dt><dt>vfs.vmiodirenable, <a class="indexterm" href="#idp70402616">vfs.vmiodirenable</a></dt><dt>vfs.write_behind, <a class="indexterm" href="#idp70408632">vfs.write_behind</a></dt><dt>vi, <a class="indexterm" href="#editors">文字編輯器</a></dt><dt>video packages, <a class="indexterm" href="#video-ports">可處理影像的 Port 與套件</a></dt><dt>video ports, <a class="indexterm" href="#video-ports">可處理影像的 Port 與套件</a></dt><dt>vipw, <a class="indexterm" href="#idp79884344">變更登入類別的工具</a></dt><dt>virtual consoles, <a class="indexterm" href="#consoles">虛擬 Console 與終端機</a></dt><dt>virtual hosts, <a class="indexterm" href="#configtuning-virtual-hosts">虛擬主機</a></dt><dt>virtual private network (see VPN)</dt><dt>VLANs, <a class="indexterm" href="#network-vlan">VLANs</a></dt><dt>vm.swap_idle_enabled, <a class="indexterm" href="#idp70427064">vm.swap_idle_enabled</a></dt><dt>Voxer, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>VPN, <a class="indexterm" href="#ipsec">VPN over
	IPsec</a></dt></dl></div><div class="indexdiv"><h3>W</h3><dl><dt>Walnut Creek CDROM, <a class="indexterm" href="#intro-history">FreeBSD 歷史簡介</a></dt><dt>web servers</dt><dd><dl><dt>dynamic, <a class="indexterm" href="#idp84876856">動態網站</a></dt><dt>secure, <a class="indexterm" href="#idp84809272">mod_ssl</a></dt><dt>setting up, <a class="indexterm" href="#network-apache">Apache HTTP 伺服器</a></dt></dl></dd><dt>WhatsApp, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>Wheel Systems, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt><dt>widescreen flatpanel configuration, <a class="indexterm" href="#idp67330744">加入寬螢幕平板顯示器到設定檔</a></dt><dt>Williams, Nate, <a class="indexterm" href="#intro-history">FreeBSD 歷史簡介</a></dt><dt>Windows, <a class="indexterm" href="#idp71832248">產生單組一次性密碼</a></dt><dt>Windows drivers, <a class="indexterm" href="#config-network-ndis">使用 Windows® NDIS 驅動程式</a></dt></dl></div><div class="indexdiv"><h3>X</h3><dl><dt>X Display Manager, <a class="indexterm" href="#x-xdm">X 顯示管理程式</a></dt><dt>X Input Method (XIM), <a class="indexterm" href="#idp80000184">Xorg 設定</a></dt><dt>X Window System, <a class="indexterm" href="#os-overview">FreeBSD 能做什麼？</a></dt><dt>XML, <a class="indexterm" href="#antialias">反鋸齒字型</a></dt><dt>Xorg, <a class="indexterm" href="#x-config">Xorg 設定</a></dt><dt>Xorg
	  tuning, <a class="indexterm" href="#x11-understanding">疑難排解</a></dt><dt>xorg.conf, <a class="indexterm" href="#x11-understanding">疑難排解</a></dt><dt>Xpdf, <a class="indexterm" href="#idp67637304">Xpdf</a></dt><dt>XVideo, <a class="indexterm" href="#video-interface">偵測影像處理能力</a></dt></dl></div><div class="indexdiv"><h3>Y</h3><dl><dt>yellow pages (see NIS)</dt></dl></div><div class="indexdiv"><h3>Z</h3><dl><dt>zones</dt><dd><dl><dt>examples, <a class="indexterm" href="#network-dns">網域名稱系統 (DNS)</a></dt></dl></dd><dt>ZRouter, <a class="indexterm" href="#introduction-nutshell-users">誰在用 FreeBSD？</a></dt></dl></div></div></div><div class="colophon"><h1 class="title"><a id="colophon"></a>版本記錄</h1><p>本手冊是由數以百計 <span class="quote">“<span class="quote">FreeBSD 文件計劃</span>”</span> 的志願工作者所合作而成。 這些文字是由依據 DocBook DTD 規範的 XML 所寫， 並由 XSLT 將 XML 轉換成其他不同格式。 要是沒有 Donald Knuth 的 <span class="application">TeX</span> 排版語言， Leslie Lamport 的 <span class="application">LaTeX</span> 或 Sebastian Rahtz 的 <span class="application">JadeTeX</span> 巨集套件的重要貢獻，本文件的印刷版本將無以完成。</p></div></div></body></html>